<html><head></head><body>
  <div id="_idContainer075">
   <h1 class="chapter-number" id="_idParaDest-42">
    <a id="_idTextAnchor043">
    </a>
    <span class="koboSpan" id="kobo.1.1">
     2
    </span>
   </h1>
   <h1 id="_idParaDest-43">
    <a id="_idTextAnchor044">
    </a>
    <span class="koboSpan" id="kobo.2.1">
     Access Management with IAM Policies and Roles
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.3.1">
     Secure access management is crucial for effectively managing who can access our AWS resources and what actions they can perform.
    </span>
    <span class="koboSpan" id="kobo.3.2">
     This knowledge ensures that our AWS environment remains secure and compliant by allowing us to precisely control permissions and minimize the risk of unauthorized access.
    </span>
    <span class="koboSpan" id="kobo.3.3">
     It empowers us to implement a robust security posture that safeguards our data and resources, while also enabling a scalable and efficient way to manage access for users and services across our AWS infrastructure.
    </span>
    <span class="koboSpan" id="kobo.3.4">
     In this chapter, we will learn about secure access
    </span>
    <a id="_idIndexMarker192">
    </a>
    <span class="koboSpan" id="kobo.4.1">
     management
    </span>
    <a id="_idIndexMarker193">
    </a>
    <span class="koboSpan" id="kobo.5.1">
     within the AWS cloud using
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.6.1">
      IAM policies
     </span>
    </strong>
    <span class="koboSpan" id="kobo.7.1">
     and
    </span>
    <span class="No-Break">
     <strong class="bold">
      <span class="koboSpan" id="kobo.8.1">
       IAM roles
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.9.1">
      .
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.10.1">
     AWS supports various policy types, such as
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.11.1">
      identity-based policies
     </span>
    </strong>
    <span class="koboSpan" id="kobo.12.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.13.1">
      resource-based policies
     </span>
    </strong>
    <span class="koboSpan" id="kobo.14.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.15.1">
      session policies
     </span>
    </strong>
    <span class="koboSpan" id="kobo.16.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.17.1">
      permissions boundaries
     </span>
    </strong>
    <span class="koboSpan" id="kobo.18.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.19.1">
      service control policies
     </span>
    </strong>
    <span class="koboSpan" id="kobo.20.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.21.1">
      SCPs
     </span>
    </strong>
    <span class="koboSpan" id="kobo.22.1">
     ), and
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.23.1">
      access control lists
     </span>
    </strong>
    <span class="koboSpan" id="kobo.24.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.25.1">
      ACLs
     </span>
    </strong>
    <span class="koboSpan" id="kobo.26.1">
     ).
    </span>
    <span class="koboSpan" id="kobo.26.2">
     While we will learn most of these policy types with detailed recipes.
    </span>
    <span class="koboSpan" id="kobo.26.3">
     ACLs are only discussed theoretically since ACLs are not recommended to be used anymore.
    </span>
    <span class="koboSpan" id="kobo.26.4">
     We will then learn about IAM roles and how to use them for implementing the cross-account access needed to implement identity account architecture, and how to use roles for cross-service access to allow one AWS service to access another service securely.
    </span>
    <span class="koboSpan" id="kobo.26.5">
     We will continue to explore IAM policies and roles in future chapters within
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.27.1">
      this book.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.28.1">
     This chapter will cover the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.29.1">
      following recipes:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.30.1">
      Creating a customer-managed
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.31.1">
       IAM policy
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.32.1">
      Using policy variables within
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.33.1">
       IAM policies
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.34.1">
      Creating customer-managed policies in IAM
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.35.1">
       Identity Center
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.36.1">
      Setting IAM permission boundaries for
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.37.1">
       IAM entities
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.38.1">
      Centralizing governance in AWS Organizations
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.39.1">
       with SCPs
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.40.1">
      IAM cross-account role switching and identity
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.41.1">
       account architecture
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.42.1">
      Cross-service access via IAM roles on
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.43.1">
       EC2 instances
      </span>
     </span>
    </li>
   </ul>
   <h1 id="_idParaDest-44">
    <a id="_idTextAnchor045">
    </a>
    <span class="koboSpan" id="kobo.44.1">
     Technical requirements
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.45.1">
     Before diving into the recipes of this chapter, we need to ensure we have the following requirements
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.46.1">
      in place:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.47.1">
      We need an active AWS account to complete most of the recipes within this chapter.
     </span>
     <span class="koboSpan" id="kobo.47.2">
      We can use an account that is part of an AWS organization or a standalone account for most of the recipes within this chapter.
     </span>
     <span class="koboSpan" id="kobo.47.3">
      I will be using the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.48.1">
       awsseccb-sandbox-1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.49.1">
      AWS organization
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.50.1">
       member account
      </span>
     </strong>
     <span class="koboSpan" id="kobo.51.1">
      that we created in the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.52.1">
       Multi-account management with AWS Organizations
      </span>
     </em>
     <span class="koboSpan" id="kobo.53.1">
      recipe from
     </span>
     <a href="B21384_01.xhtml#_idTextAnchor020">
      <span class="No-Break">
       <em class="italic">
        <span class="koboSpan" id="kobo.54.1">
         Chapter 1
        </span>
       </em>
      </span>
     </a>
     <span class="koboSpan" id="kobo.55.1">
      .
     </span>
     <span class="koboSpan" id="kobo.55.2">
      However, unless specified otherwise, I won’t be utilizing AWS Organizations features, meaning you can follow these steps with a standalone account, too.
     </span>
     <span class="koboSpan" id="kobo.55.3">
      Note that certain recipes may have different AWS account requirements, which will be specified in
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.56.1">
       those recipes.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.57.1">
      For administrative actions, we need a user who has
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.58.1">
       AdministratorAccess
      </span>
     </strong>
     <span class="koboSpan" id="kobo.59.1">
      permission to the AWS account we are working with.
     </span>
     <span class="koboSpan" id="kobo.59.2">
      This can be an IAM Identity Center user or an IAM user.
     </span>
     <span class="koboSpan" id="kobo.59.3">
      I will be using the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.60.1">
       awsseccbadmin1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.61.1">
      IAM Identity Center user we created in the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.62.1">
       User management and SSO with IAM Identity Center
      </span>
     </em>
     <span class="koboSpan" id="kobo.63.1">
      recipe from
     </span>
     <a href="B21384_01.xhtml#_idTextAnchor020">
      <span class="No-Break">
       <em class="italic">
        <span class="koboSpan" id="kobo.64.1">
         Chapter 1
        </span>
       </em>
      </span>
     </a>
     <span class="koboSpan" id="kobo.65.1">
      .
     </span>
     <span class="koboSpan" id="kobo.65.2">
      However, unless specified otherwise, I won’t be utilizing any IAM Identity Center features, meaning you can follow these steps with an IAM user, too, if the user has the required permissions in the account we are working with.
     </span>
     <span class="koboSpan" id="kobo.65.3">
      If you are using an IAM user, you can create the user following the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.66.1">
       Setting up IAM, account aliases, and billing alerts
      </span>
     </em>
     <span class="koboSpan" id="kobo.67.1">
      recipe from
     </span>
     <a href="B21384_01.xhtml#_idTextAnchor020">
      <span class="No-Break">
       <em class="italic">
        <span class="koboSpan" id="kobo.68.1">
         Chapter 1
        </span>
       </em>
      </span>
     </a>
     <span class="koboSpan" id="kobo.69.1">
      .
     </span>
     <span class="koboSpan" id="kobo.69.2">
      Note that certain recipes may have specific user requirements, which will be specified in
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.70.1">
       those recipes.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.71.1">
      To execute AWS
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.72.1">
       Command Line Interface
      </span>
     </strong>
     <span class="koboSpan" id="kobo.73.1">
      (
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.74.1">
       CLI
      </span>
     </strong>
     <span class="koboSpan" id="kobo.75.1">
      ) commands on a local machine or a virtual machine, we need AWS CLI v2 installed.
     </span>
     <span class="koboSpan" id="kobo.75.2">
      Configure the AWS CLI using IAM access keys for IAM users or utilize temporary credentials from the IAM Identity Center for IAM Identity Center users.
     </span>
     <a href="B21384_01.xhtml#_idTextAnchor020">
      <span class="No-Break">
       <em class="italic">
        <span class="koboSpan" id="kobo.76.1">
         Chapter 1
        </span>
       </em>
      </span>
     </a>
     <span class="koboSpan" id="kobo.77.1">
      details how to set up the CLI using both IAM and IAM Identity Center.
     </span>
     <span class="koboSpan" id="kobo.77.2">
      Unless specified, we can manage users with either IAM or IAM Identity Center, though AWS recommends using IAM Identity Center.
     </span>
     <span class="koboSpan" id="kobo.77.3">
      Additionally,
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.78.1">
       AWS CloudShell
      </span>
     </strong>
     <span class="koboSpan" id="kobo.79.1">
      , available through the AWS Console, offers a convenient way to perform most CLI commands discussed in this chapter.
     </span>
     <span class="koboSpan" id="kobo.79.2">
      With both IAM and IAM Identity Center, we need to create a profile per user per account.
     </span>
     <span class="koboSpan" id="kobo.79.3">
      Therefore, it is good to include the account name as part of the profile name.
     </span>
     <span class="koboSpan" id="kobo.79.4">
      For instance, for the administrator user for the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.80.1">
       awsseccb-sandbox-1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.81.1">
      sandbox account, we can set up a CLI
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.82.1">
       Sandbox1Admin1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.83.1">
      profile:
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.84.1">
       awsseccbadmin1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.85.1">
      .
     </span>
     <span class="koboSpan" id="kobo.85.2">
      For IAM Identity Center, we need to create a profile per user per account per permission set assignment, and hence we could include details of the assignment also in
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.86.1">
       its name.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.87.1">
      For certain recipes, we will need an Amazon
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.88.1">
       Simple Storage Service
      </span>
     </strong>
     <span class="koboSpan" id="kobo.89.1">
      (
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.90.1">
       S3
      </span>
     </strong>
     <span class="koboSpan" id="kobo.91.1">
      ) bucket to test the policies.
     </span>
     <span class="koboSpan" id="kobo.91.2">
      Hence, a basic understanding of Amazon S3 service is recommended.
     </span>
     <span class="koboSpan" id="kobo.91.3">
      Unless otherwise specified, we can create S3 buckets with the following configuration: For
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.92.1">
       Bucket name
      </span>
     </strong>
     <span class="koboSpan" id="kobo.93.1">
      , give a unique name as every bucket needs to have a unique name across AWS accounts.
     </span>
     <span class="koboSpan" id="kobo.93.2">
      For
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.94.1">
       Object Ownership
      </span>
     </strong>
     <span class="koboSpan" id="kobo.95.1">
      , select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.96.1">
       ACLs disabled (recommended)
      </span>
     </strong>
     <span class="koboSpan" id="kobo.97.1">
      .
     </span>
     <span class="koboSpan" id="kobo.97.2">
      For
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.98.1">
       Block Public Access settings for this bucket
      </span>
     </strong>
     <span class="koboSpan" id="kobo.99.1">
      , select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.100.1">
       Block all public access
      </span>
     </strong>
     <span class="koboSpan" id="kobo.101.1">
      .
     </span>
     <span class="koboSpan" id="kobo.101.2">
      For
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.102.1">
       Bucket Versioning
      </span>
     </strong>
     <span class="koboSpan" id="kobo.103.1">
      , select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.104.1">
       Disable
      </span>
     </strong>
     <span class="koboSpan" id="kobo.105.1">
      .
     </span>
     <span class="koboSpan" id="kobo.105.2">
      For
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.106.1">
       Default encryption
      </span>
     </strong>
     <span class="koboSpan" id="kobo.107.1">
      , select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.108.1">
       Server-side encryption with Amazon S3 managed keys (SSE-S3)
      </span>
     </strong>
     <span class="koboSpan" id="kobo.109.1">
      .
     </span>
     <span class="koboSpan" id="kobo.109.2">
      For
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.110.1">
       Object Lock under Advanced settings
      </span>
     </strong>
     <span class="koboSpan" id="kobo.111.1">
      ,
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.112.1">
       select
      </span>
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.113.1">
        Disable
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.114.1">
       .
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.115.1">
     The code files for this book are available at
    </span>
    <a href="https://github.com/PacktPublishing/AWS-Security-Cookbook-Second-Edition">
     <span class="koboSpan" id="kobo.116.1">
      https://github.com/PacktPublishing/AWS-Security-Cookbook-Second-Edition
     </span>
    </a>
    <span class="koboSpan" id="kobo.117.1">
     .
    </span>
    <span class="koboSpan" id="kobo.117.2">
     The code files for this chapter are available
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.118.1">
      at
     </span>
    </span>
    <a href="https://github.com/PacktPublishing/AWS-Security-Cookbook-Second-Edition/tree/main/Chapter02">
     <span class="No-Break">
      <span class="koboSpan" id="kobo.119.1">
       https://github.com/PacktPublishing/AWS-Security-Cookbook-Second-Edition/tree/main/Chapter02
      </span>
     </span>
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.120.1">
      .
     </span>
    </span>
   </p>
   <h1 id="_idParaDest-45">
    <a id="_idTextAnchor046">
    </a>
    <span class="koboSpan" id="kobo.121.1">
     Creating a customer-managed IAM policy
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.122.1">
     In this recipe, we will create
    </span>
    <a id="_idIndexMarker194">
    </a>
    <span class="koboSpan" id="kobo.123.1">
     a customer-managed identity-based IAM policy to manage access to an S3 bucket.
    </span>
    <span class="koboSpan" id="kobo.123.2">
     We will give permission to list all S3 buckets and will further use the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.124.1">
      Condition
     </span>
    </strong>
    <span class="koboSpan" id="kobo.125.1">
     policy element to restrict the permission based on the requester’s IP address.
    </span>
    <span class="koboSpan" id="kobo.125.2">
     We will use the AWS Management Console for this recipe, but you may do it from the AWS CLI by making use of the provided JSON code following the next recipe titled
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.126.1">
      Using policy variables within IAM policies
     </span>
    </em>
    <span class="koboSpan" id="kobo.127.1">
     from
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.128.1">
      this chapter.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.129.1">
     IAM policies can work with both IAM and IAM Identity Center.
    </span>
    <span class="koboSpan" id="kobo.129.2">
     Within this recipe, we will use the IAM policies with IAM entities.
    </span>
    <span class="koboSpan" id="kobo.129.3">
     In the recipe titled
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.130.1">
      Creating customer-managed policies in IAM Identity Center
     </span>
    </em>
    <span class="koboSpan" id="kobo.131.1">
     from this chapter, we will learn how to use the same policy with IAM Identity
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.132.1">
      Center entities.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-46">
    <a id="_idTextAnchor047">
    </a>
    <span class="koboSpan" id="kobo.133.1">
     Getting ready
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.134.1">
     We need the following to successfully complete
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.135.1">
      this recipe:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.136.1">
      A working AWS account,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.137.1">
       awsseccb-sandbox-1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.138.1">
      , and a user with
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.139.1">
       AdministratorAccess
      </span>
     </strong>
     <span class="koboSpan" id="kobo.140.1">
      permission to that account,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.141.1">
       awsseccbadmin1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.142.1">
      , following the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.143.1">
       Technical requirements
      </span>
     </em>
     <span class="koboSpan" id="kobo.144.1">
      section of
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.145.1">
       this chapter.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.146.1">
      For testing this recipe, we need an IAM user named
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.147.1">
       awsseccb_iam_user1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.148.1">
      with minimal or no permission and an S3 bucket, following the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.149.1">
       Technical requirements
      </span>
     </em>
     <span class="koboSpan" id="kobo.150.1">
      section of
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.151.1">
       this chapter.
      </span>
     </span>
    </li>
   </ul>
   <h2 id="_idParaDest-47">
    <a id="_idTextAnchor048">
    </a>
    <span class="koboSpan" id="kobo.152.1">
     How to do it...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.153.1">
     We will first create an IAM policy using the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.154.1">
      awsseccbadmin1
     </span>
    </strong>
    <span class="koboSpan" id="kobo.155.1">
     administrator user and then attach it to the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.156.1">
      awsseccb_iam_user1
     </span>
    </strong>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.157.1">
      IAM user.
     </span>
    </span>
   </p>
   <h3>
    <span class="koboSpan" id="kobo.158.1">
     Creating a customer-managed IAM policy from the AWS Management Console
    </span>
   </h3>
   <p>
    <span class="koboSpan" id="kobo.159.1">
     We can create
    </span>
    <a id="_idIndexMarker195">
    </a>
    <span class="koboSpan" id="kobo.160.1">
     a policy using the IAM
    </span>
    <a id="_idIndexMarker196">
    </a>
    <span class="koboSpan" id="kobo.161.1">
     from the AWS Management Console
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.162.1">
      as follows:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.163.1">
      Log in to the console of
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.164.1">
       awsseccb-sandbox-1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.165.1">
      as the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.166.1">
       awsseccbadmin1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.167.1">
      user with
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.168.1">
       AdministratorAccess
      </span>
     </strong>
     <span class="koboSpan" id="kobo.169.1">
      permission and go to the
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.170.1">
        IAM
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.171.1">
       dashboard.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.172.1">
      Click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.173.1">
       Policies
      </span>
     </strong>
     <span class="koboSpan" id="kobo.174.1">
      from the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.175.1">
       left sidebar.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.176.1">
      Click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.177.1">
       Create Policy
      </span>
     </strong>
     <span class="koboSpan" id="kobo.178.1">
      .
     </span>
     <span class="koboSpan" id="kobo.178.2">
      This will provide us with a visual editor as shown in the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.179.1">
       following figure.
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer044">
     <span class="koboSpan" id="kobo.180.1">
      <img alt="Figure 2.1 – Specifying permissions for policy" src="image/B21384_02_1.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.181.1">
     Figure 2.1 – Specifying permissions for policy
    </span>
   </p>
   <p class="list-inset">
    <span class="koboSpan" id="kobo.182.1">
     If we have already created
    </span>
    <a id="_idIndexMarker197">
    </a>
    <span class="koboSpan" id="kobo.183.1">
     the policy in JSON format, we can click
    </span>
    <a id="_idIndexMarker198">
    </a>
    <span class="koboSpan" id="kobo.184.1">
     on the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.185.1">
      JSON
     </span>
    </strong>
    <span class="koboSpan" id="kobo.186.1">
     tab, enter it directly, and save it.
    </span>
    <span class="koboSpan" id="kobo.186.2">
     In that case, we can skip
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.187.1">
      Steps 4
     </span>
    </em>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.188.1">
      to
     </span>
    </span>
    <span class="No-Break">
     <em class="italic">
      <span class="koboSpan" id="kobo.189.1">
       6
      </span>
     </em>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.190.1">
      .
     </span>
    </span>
   </p>
   <ol>
    <li value="4">
     <span class="koboSpan" id="kobo.191.1">
      Under the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.192.1">
       Select a service
      </span>
     </strong>
     <span class="koboSpan" id="kobo.193.1">
      section, click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.194.1">
       S3
      </span>
     </strong>
     <span class="koboSpan" id="kobo.195.1">
      .
     </span>
     <span class="koboSpan" id="kobo.195.2">
      We should now see a screen like
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.196.1">
       the following:
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer045">
     <span class="koboSpan" id="kobo.197.1">
      <img alt="Figure 2.2 – Configuring permissions for S3 resource" src="image/B21384_02_2.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.198.1">
     Figure 2.2 – Configuring permissions for S3 resource
    </span>
   </p>
   <ol>
    <li value="5">
     <span class="koboSpan" id="kobo.199.1">
      Under the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.200.1">
       Access level
      </span>
     </strong>
     <span class="koboSpan" id="kobo.201.1">
      heading, expand
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.202.1">
       List
      </span>
     </strong>
     <span class="koboSpan" id="kobo.203.1">
      and
     </span>
     <a id="_idIndexMarker199">
     </a>
     <span class="koboSpan" id="kobo.204.1">
      select
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.205.1">
       ListAllMyBuckets
      </span>
     </strong>
     <span class="koboSpan" id="kobo.206.1">
      as shown
     </span>
     <a id="_idIndexMarker200">
     </a>
     <span class="koboSpan" id="kobo.207.1">
      in the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.208.1">
       following figure:
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer046">
     <span class="koboSpan" id="kobo.209.1">
      <img alt="Figure 2.3 – Selecting access level permission" src="image/B21384_02_3.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.210.1">
     Figure 2.3 – Selecting access level permission
    </span>
   </p>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.211.1">
     Important note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.212.1">
     In the Resources section, the wildcard character (
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.213.1">
      *
     </span>
    </strong>
    <span class="koboSpan" id="kobo.214.1">
     ) will be chosen to signify all resources since the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.215.1">
      ListAllMyBuckets
     </span>
    </strong>
    <span class="koboSpan" id="kobo.216.1">
     action isn’t specific to any particular resource.
    </span>
    <span class="koboSpan" id="kobo.216.2">
     If an action such as
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.217.1">
      ListBucket
     </span>
    </strong>
    <span class="koboSpan" id="kobo.218.1">
     , which is specific to a particular bucket, is chosen and we desire to limit it to a single bucket, we need to select
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.219.1">
      Specific
     </span>
    </strong>
    <span class="koboSpan" id="kobo.220.1">
     , click on
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.221.1">
      Add ARN
     </span>
    </strong>
    <span class="koboSpan" id="kobo.222.1">
     , and input the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.223.1">
      Amazon Resource Name
     </span>
    </strong>
    <span class="koboSpan" id="kobo.224.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.225.1">
      ARN
     </span>
    </strong>
    <span class="koboSpan" id="kobo.226.1">
     ) of our targeted
    </span>
    <a id="_idIndexMarker201">
    </a>
    <span class="koboSpan" id="kobo.227.1">
     bucket, following the format
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.228.1">
      arn:aws:s3:::&lt;bucket_name&gt;
     </span>
    </strong>
    <span class="koboSpan" id="kobo.229.1">
     .
    </span>
    <span class="koboSpan" id="kobo.229.2">
     An ARN is a unique identifier that AWS uses to specify resources within its
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.230.1">
      cloud services.
     </span>
    </span>
   </p>
   <ol>
    <li value="6">
     <span class="koboSpan" id="kobo.231.1">
      Under the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.232.1">
       Request conditions
      </span>
     </strong>
     <span class="koboSpan" id="kobo.233.1">
      section, select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.234.1">
       Requested from IP
      </span>
     </strong>
     <span class="koboSpan" id="kobo.235.1">
      , provide our IP
     </span>
     <a id="_idIndexMarker202">
     </a>
     <span class="koboSpan" id="kobo.236.1">
      address, and
     </span>
     <a id="_idIndexMarker203">
     </a>
     <span class="koboSpan" id="kobo.237.1">
      click
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.238.1">
       Add Ip
      </span>
     </strong>
     <span class="koboSpan" id="kobo.239.1">
      .
     </span>
     <span class="koboSpan" id="kobo.239.2">
      We can also specify the IP
     </span>
     <a id="_idIndexMarker204">
     </a>
     <span class="koboSpan" id="kobo.240.1">
      address range in the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.241.1">
       Classless Inter-Domain Routing
      </span>
     </strong>
     <span class="koboSpan" id="kobo.242.1">
      (
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.243.1">
       CIDR
      </span>
     </strong>
     <span class="koboSpan" id="kobo.244.1">
      ) format as shown in the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.245.1">
       following figure.
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer047">
     <span class="koboSpan" id="kobo.246.1">
      <img alt="Figure 2.4 – Configuring request conditions" src="image/B21384_02_4.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.247.1">
     Figure 2.4 – Configuring request conditions
    </span>
   </p>
   <p class="list-inset">
    <span class="koboSpan" id="kobo.248.1">
     Optionally, we can
    </span>
    <a id="_idIndexMarker205">
    </a>
    <span class="koboSpan" id="kobo.249.1">
     click
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.250.1">
      + Add another condition
     </span>
    </strong>
    <span class="koboSpan" id="kobo.251.1">
     to add additional conditions
    </span>
    <a id="_idIndexMarker206">
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.252.1">
      as needed.
     </span>
    </span>
   </p>
   <ol>
    <li value="7">
     <span class="koboSpan" id="kobo.253.1">
      Click
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.254.1">
       Next
      </span>
     </strong>
     <span class="koboSpan" id="kobo.255.1">
      to go to the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.256.1">
       Review and
      </span>
     </strong>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.257.1">
        create
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.258.1">
       page.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.259.1">
      Enter
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.260.1">
       MyS3ListAllBucketsPolicy
      </span>
     </strong>
     <span class="koboSpan" id="kobo.261.1">
      in the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.262.1">
       Policy name
      </span>
     </strong>
     <span class="koboSpan" id="kobo.263.1">
      field and
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.264.1">
       My S3 List All Buckets Policy
      </span>
     </strong>
     <span class="koboSpan" id="kobo.265.1">
      in the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.266.1">
       Description – optional
      </span>
     </strong>
     <span class="koboSpan" id="kobo.267.1">
      field (or any name and description
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.268.1">
       we want).
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.269.1">
      Scroll down to review the policy details and click
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.270.1">
        Create policy
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.271.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.272.1">
      Go to the policy and verify the policy JSON that was generated from the
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.273.1">
        JSON
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.274.1">
       tab:
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer048">
     <span class="koboSpan" id="kobo.275.1">
      <img alt="Figure 2.5 – Generated policy as JSON" src="image/B21384_02_5.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.276.1">
     Figure 2.5 – Generated policy as JSON
    </span>
   </p>
   <p class="list-inset">
    <span class="koboSpan" id="kobo.277.1">
     Please make sure the IP address is yours and not copied from the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.278.1">
      sample code.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.279.1">
     We can follow the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.280.1">
      Attaching IAM policies to IAM group via AWS Management Console
     </span>
    </em>
    <span class="koboSpan" id="kobo.281.1">
     subsection to assign the policy we created to an IAM group.
    </span>
    <span class="koboSpan" id="kobo.281.2">
     If we are using IAM Identity Center, we can associate
    </span>
    <a id="_idIndexMarker207">
    </a>
    <span class="koboSpan" id="kobo.282.1">
     the policy with an IAM Identity Center
    </span>
    <a id="_idIndexMarker208">
    </a>
    <span class="koboSpan" id="kobo.283.1">
     group following the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.284.1">
      Creating Customer-Managed Policies in IAM Identity Center
     </span>
    </em>
    <span class="koboSpan" id="kobo.285.1">
     recipe from
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.286.1">
      this chapter.
     </span>
    </span>
   </p>
   <h3>
    <span class="koboSpan" id="kobo.287.1">
     Attaching IAM policies to IAM group via AWS Management Console
    </span>
   </h3>
   <p>
    <span class="koboSpan" id="kobo.288.1">
     It is good practice to add permissions
    </span>
    <a id="_idIndexMarker209">
    </a>
    <span class="koboSpan" id="kobo.289.1">
     to a user through
    </span>
    <a id="_idIndexMarker210">
    </a>
    <span class="koboSpan" id="kobo.290.1">
     a group.
    </span>
    <span class="koboSpan" id="kobo.290.2">
     Hence, create a group called
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.291.1">
      awsseccbusers
     </span>
    </strong>
    <span class="koboSpan" id="kobo.292.1">
     and add our
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.293.1">
      awsseccb_iam_user1
     </span>
    </strong>
    <span class="koboSpan" id="kobo.294.1">
     user to that group.
    </span>
    <span class="koboSpan" id="kobo.294.2">
     We can assign permissions to the IAM group
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.295.1">
      as follows:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.296.1">
      Log in to the console of
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.297.1">
       awsseccb-sandbox-1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.298.1">
      as the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.299.1">
       awsseccbadmin1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.300.1">
      administrator user and go to the
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.301.1">
        IAM
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.302.1">
       dashboard.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.303.1">
      Click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.304.1">
       User groups
      </span>
     </strong>
     <span class="koboSpan" id="kobo.305.1">
      from the left sidebar of the
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.306.1">
        IAM
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.307.1">
       dashboard.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.308.1">
      Click on the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.309.1">
       awsseccbusers
      </span>
     </strong>
     <span class="koboSpan" id="kobo.310.1">
      group to go to the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.311.1">
       group’s page.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.312.1">
      Go to the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.313.1">
       Permissions
      </span>
     </strong>
     <span class="koboSpan" id="kobo.314.1">
      tab, and from the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.315.1">
       Add permissions
      </span>
     </strong>
     <span class="koboSpan" id="kobo.316.1">
      dropdown menu, click
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.317.1">
        Attach policies
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.318.1">
       .
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer049">
     <span class="koboSpan" id="kobo.319.1">
      <img alt="Figure 2.6 – Configuring permissions for group" src="image/B21384_02_6.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.320.1">
     Figure 2.6 – Configuring permissions for group
    </span>
   </p>
   <ol>
    <li value="5">
     <span class="koboSpan" id="kobo.321.1">
      In the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.322.1">
       Add permissions
      </span>
     </strong>
     <span class="koboSpan" id="kobo.323.1">
      page, select the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.324.1">
       MyS3ListAllBucketsPolicy
      </span>
     </strong>
     <span class="koboSpan" id="kobo.325.1">
      policy, scroll down, and click on
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.326.1">
        Add permissions
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.327.1">
       .
      </span>
     </span>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.328.1">
       We should now be able to see the new policy added to the group under the
      </span>
      <span class="No-Break">
       <strong class="bold">
        <span class="koboSpan" id="kobo.329.1">
         Permissions
        </span>
       </strong>
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.330.1">
        tab.
       </span>
      </span>
     </p>
    </li>
   </ol>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.331.1">
     Important note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.332.1">
     We can also attach policies to groups or users from the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.333.1">
      Policy
     </span>
    </strong>
    <span class="koboSpan" id="kobo.334.1">
     tab of the
    </span>
    <span class="No-Break">
     <strong class="bold">
      <span class="koboSpan" id="kobo.335.1">
       IAM
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.336.1">
      dashboard.
     </span>
    </span>
   </p>
   <ol>
    <li value="6">
     <span class="koboSpan" id="kobo.337.1">
      We can now verify the changes
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.338.1">
       as follows:
      </span>
     </span>
     <ol>
      <li class="upper-roman">
       <span class="koboSpan" id="kobo.339.1">
        Log into the AWS Management Console
       </span>
       <a id="_idIndexMarker211">
       </a>
       <span class="koboSpan" id="kobo.340.1">
        as the
       </span>
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.341.1">
         awsseccb_iam_user1
        </span>
       </strong>
       <span class="koboSpan" id="kobo.342.1">
        user using the sign-in URL
       </span>
       <a id="_idIndexMarker212">
       </a>
       <span class="koboSpan" id="kobo.343.1">
        for IAM users for our account as we learned in the
       </span>
       <em class="italic">
        <span class="koboSpan" id="kobo.344.1">
         Setting up IAM, account aliases, and billing alerts
        </span>
       </em>
       <span class="koboSpan" id="kobo.345.1">
        recipe in
       </span>
       <a href="B21384_01.xhtml#_idTextAnchor020">
        <span class="No-Break">
         <em class="italic">
          <span class="koboSpan" id="kobo.346.1">
           Chapter 1
          </span>
         </em>
        </span>
       </a>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.347.1">
         .
        </span>
       </span>
      </li>
      <li class="upper-roman">
       <span class="koboSpan" id="kobo.348.1">
        Go to the
       </span>
       <span class="No-Break">
        <strong class="bold">
         <span class="koboSpan" id="kobo.349.1">
          S3
         </span>
        </strong>
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.350.1">
         service.
        </span>
       </span>
      </li>
      <li class="upper-roman">
       <span class="koboSpan" id="kobo.351.1">
        Click on
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.352.1">
         Buckets
        </span>
       </strong>
       <span class="koboSpan" id="kobo.353.1">
        from the
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.354.1">
         left sidebar.
        </span>
       </span>
      </li>
     </ol>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.355.1">
       We should be able to see all
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.356.1">
        the buckets:
       </span>
      </span>
     </p>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer050">
     <span class="koboSpan" id="kobo.357.1">
      <img alt="Figure 2.7 – Listing buckets in Amazon S3" src="image/B21384_02_7.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.358.1">
     Figure 2.7 – Listing buckets in Amazon S3
    </span>
   </p>
   <p class="list-inset">
    <span class="koboSpan" id="kobo.359.1">
     We had given only the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.360.1">
      ListAllMyBuckets
     </span>
    </strong>
    <span class="koboSpan" id="kobo.361.1">
     permission
    </span>
    <a id="_idIndexMarker213">
    </a>
    <span class="koboSpan" id="kobo.362.1">
     and hence we will see
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.363.1">
      Insufficient permissions
     </span>
    </strong>
    <span class="koboSpan" id="kobo.364.1">
     under
    </span>
    <a id="_idIndexMarker214">
    </a>
    <span class="koboSpan" id="kobo.365.1">
     the
    </span>
    <span class="No-Break">
     <strong class="bold">
      <span class="koboSpan" id="kobo.366.1">
       Access
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.367.1">
      column.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.368.1">
     In this section, we learned how to assign an IAM policy to an IAM group.
    </span>
    <span class="koboSpan" id="kobo.368.2">
     However, it is recommended to use IAM policies with IAM Identity Center, which we will explore in the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.369.1">
      upcoming recipe.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-48">
    <a id="_idTextAnchor049">
    </a>
    <span class="koboSpan" id="kobo.370.1">
     How it works...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.371.1">
     In this recipe, we created
    </span>
    <a id="_idIndexMarker215">
    </a>
    <span class="koboSpan" id="kobo.372.1">
     a customer-managed IAM policy.
    </span>
    <span class="koboSpan" id="kobo.372.2">
     There are different IAM policy types, as we saw in the chapter introduction.
    </span>
    <span class="koboSpan" id="kobo.372.3">
     We explored an identity-based policy within this recipe.
    </span>
    <span class="koboSpan" id="kobo.372.4">
     Identity-based policies define permissions for IAM entities such as users, groups, or roles.
    </span>
    <span class="koboSpan" id="kobo.372.5">
     Identity-based policies can be either managed policies or inline policies.
    </span>
    <span class="koboSpan" id="kobo.372.6">
     Managed policies are policies that can be reused by associating them with multiple IAM entities and inline policies are attached directly to an
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.373.1">
      IAM entity.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.374.1">
     Managed policies can be further divided into AWS-managed and customer-managed policies.
    </span>
    <span class="koboSpan" id="kobo.374.2">
     AWS-managed policies are created and maintained by AWS.
    </span>
    <span class="koboSpan" id="kobo.374.3">
     While we can view and use them, we cannot edit them.
    </span>
    <span class="koboSpan" id="kobo.374.4">
     Customer-managed policies are policies that we create for our needs when the AWS-managed policies are not sufficient.
    </span>
    <span class="koboSpan" id="kobo.374.5">
     Even though we can directly assign the managed policies to a user, it is recommended always to assign them to a group and then add users to that group.
    </span>
    <span class="koboSpan" id="kobo.374.6">
     Inline policies are attached directly to an IAM entity
    </span>
    <a id="_idIndexMarker216">
    </a>
    <span class="koboSpan" id="kobo.375.1">
     and cannot
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.376.1">
      be reused.
     </span>
    </span>
   </p>
   <h3>
    <span class="koboSpan" id="kobo.377.1">
     Understanding the IAM policy structure
    </span>
   </h3>
   <p>
    <strong class="bold">
     <span class="koboSpan" id="kobo.378.1">
      IAM policies
     </span>
    </strong>
    <span class="koboSpan" id="kobo.379.1">
     are JSON documents
    </span>
    <a id="_idIndexMarker217">
    </a>
    <span class="koboSpan" id="kobo.380.1">
     and follow a structure that is followed by most policy types within AWS, except ACLs, which
    </span>
    <a id="_idIndexMarker218">
    </a>
    <span class="koboSpan" id="kobo.381.1">
     are XML-based, and
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.382.1">
      virtual private cloud
     </span>
    </strong>
    <span class="koboSpan" id="kobo.383.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.384.1">
      VPC
     </span>
    </strong>
    <span class="koboSpan" id="kobo.385.1">
     ) endpoints.
    </span>
    <span class="koboSpan" id="kobo.385.2">
     The following is an example
    </span>
    <a id="_idIndexMarker219">
    </a>
    <span class="koboSpan" id="kobo.386.1">
     of an
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.387.1">
      IAM policy:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer051">
     <span class="koboSpan" id="kobo.388.1">
      <img alt="Figure 2.8 – An IAM policy example" src="image/B21384_02_8.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.389.1">
     Figure 2.8 – An IAM policy example
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.390.1">
     Here are the main elements
    </span>
    <a id="_idIndexMarker220">
    </a>
    <span class="koboSpan" id="kobo.391.1">
     of the IAM
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.392.1">
      policy document:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.393.1">
      The
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.394.1">
       Version
      </span>
     </strong>
     <span class="koboSpan" id="kobo.395.1">
      element Indicates
     </span>
     <a id="_idIndexMarker221">
     </a>
     <span class="koboSpan" id="kobo.396.1">
      the policy language version.
     </span>
     <span class="koboSpan" id="kobo.396.2">
      In
     </span>
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.397.1">
        Figure 2
       </span>
      </em>
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.398.1">
       .8
      </span>
     </em>
     <span class="koboSpan" id="kobo.399.1">
      , we are using the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.400.1">
       2012-10-17
      </span>
     </em>
     <span class="koboSpan" id="kobo.401.1">
      version of the policy language, which is the most
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.402.1">
       recent version.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.403.1">
      The optional
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.404.1">
       Id
      </span>
     </strong>
     <span class="koboSpan" id="kobo.405.1">
      element specifies an identifier for the policy, primarily used to distinguish between different versions or instances of a policy.
     </span>
     <span class="koboSpan" id="kobo.405.2">
      Here is an example:
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.406.1">
       "
      </span>
     </strong>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.407.1">
        Id": "S3ReadOnlyPolicyID1"
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.408.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.409.1">
      The
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.410.1">
       Statement
      </span>
     </strong>
     <span class="koboSpan" id="kobo.411.1">
      element contains the main policy information, including permissions, resources, and conditions.
     </span>
     <span class="koboSpan" id="kobo.411.2">
      Statements are added as arrays to the
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.412.1">
        Statement
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.413.1">
       element.
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.414.1">
     A
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.415.1">
      Statement
     </span>
    </strong>
    <span class="koboSpan" id="kobo.416.1">
     element for an IAM policy may contain the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.417.1">
      following sub-elements:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.418.1">
      The optional
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.419.1">
       Sid
      </span>
     </strong>
     <span class="koboSpan" id="kobo.420.1">
      element represents the statement ID.
     </span>
     <span class="koboSpan" id="kobo.420.2">
      This can be used to provide a description of
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.421.1">
       the policy.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.422.1">
      The
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.423.1">
       Effect
      </span>
     </strong>
     <span class="koboSpan" id="kobo.424.1">
      element specifies whether we want to allow or deny access to a resource.
     </span>
     <span class="koboSpan" id="kobo.424.2">
      The supported values are
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.425.1">
       Allow
      </span>
     </strong>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.426.1">
       and
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.427.1">
        Deny
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.428.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.429.1">
      The
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.430.1">
       Action
      </span>
     </strong>
     <span class="koboSpan" id="kobo.431.1">
      element specifies the permission or permissions (
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.432.1">
       s3:ListAllMyBuckets
      </span>
     </strong>
     <span class="koboSpan" id="kobo.433.1">
      ) for which this statement should be applied.
     </span>
     <span class="koboSpan" id="kobo.433.2">
      We can also specify
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.434.1">
       *
      </span>
     </strong>
     <span class="koboSpan" id="kobo.435.1">
      to denote
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.436.1">
       any action.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.437.1">
      The optional
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.438.1">
       NotAction
      </span>
     </strong>
     <span class="koboSpan" id="kobo.439.1">
      element is the opposite of the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.440.1">
       Action
      </span>
     </strong>
     <span class="koboSpan" id="kobo.441.1">
      element and specifies that the policy allows or denies all actions except those listed.
     </span>
     <span class="koboSpan" id="kobo.441.2">
      The
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.442.1">
       Action
      </span>
     </strong>
     <span class="koboSpan" id="kobo.443.1">
      and
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.444.1">
       NotAction
      </span>
     </strong>
     <span class="koboSpan" id="kobo.445.1">
      elements can be included in the same overall IAM policy but not within the same individual statement of that policy.
     </span>
     <span class="koboSpan" id="kobo.445.2">
      Each statement in the policy should either specify
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.446.1">
       Action
      </span>
     </strong>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.447.1">
       or
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.448.1">
        NotAction
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.449.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.450.1">
      The
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.451.1">
       Resource
      </span>
     </strong>
     <span class="koboSpan" id="kobo.452.1">
      element specifies
     </span>
     <a id="_idIndexMarker222">
     </a>
     <span class="koboSpan" id="kobo.453.1">
      the ARN of the resource (for example, S3 bucket) that the statement is applied to.
     </span>
     <span class="koboSpan" id="kobo.453.2">
      For S3 buckets, ARN should follow the following format:
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.454.1">
       arn:aws:s3:::&lt;bucket_name&gt;/&lt;key_name&gt;
      </span>
     </strong>
     <span class="koboSpan" id="kobo.455.1">
      .
     </span>
     <span class="koboSpan" id="kobo.455.2">
      To specify multiple values, use a comma to separate them.
     </span>
     <span class="koboSpan" id="kobo.455.3">
      We can specify
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.456.1">
       *
      </span>
     </strong>
     <span class="koboSpan" id="kobo.457.1">
      to denote any resources.
     </span>
     <span class="koboSpan" id="kobo.457.2">
      In this recipe, we used the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.458.1">
       ListAllMyBuckets
      </span>
     </strong>
     <span class="koboSpan" id="kobo.459.1">
      policy with
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.460.1">
       Resource
      </span>
     </strong>
     <span class="koboSpan" id="kobo.461.1">
      as
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.462.1">
       *
      </span>
     </strong>
     <span class="koboSpan" id="kobo.463.1">
      as the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.464.1">
       ListAllMyBuckets
      </span>
     </strong>
     <span class="koboSpan" id="kobo.465.1">
      policy is not a resource-specific policy.
     </span>
     <span class="koboSpan" id="kobo.465.2">
      We want to use a resource-specific policy such as
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.466.1">
       ListBucket
      </span>
     </strong>
     <span class="koboSpan" id="kobo.467.1">
      and restrict it to a bucket, as shown in
     </span>
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.468.1">
        Figure 2
       </span>
      </em>
     </span>
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.469.1">
        .8
       </span>
      </em>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.470.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.471.1">
      The optional
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.472.1">
       NotResource
      </span>
     </strong>
     <span class="koboSpan" id="kobo.473.1">
      element is the opposite of
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.474.1">
       Resource
      </span>
     </strong>
     <span class="koboSpan" id="kobo.475.1">
      and specifies all resources except the listed resources to which the actions apply.
     </span>
     <span class="koboSpan" id="kobo.475.2">
      A single statement will either contain
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.476.1">
       Resource
      </span>
     </strong>
     <span class="koboSpan" id="kobo.477.1">
      or
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.478.1">
       NotResource
      </span>
     </strong>
     <span class="koboSpan" id="kobo.479.1">
      but not both.
     </span>
     <span class="koboSpan" id="kobo.479.2">
      However, they can be included in the same overall IAM policy as part of two
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.480.1">
       different statements.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.481.1">
      The
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.482.1">
       Principal
      </span>
     </strong>
     <span class="koboSpan" id="kobo.483.1">
      element identifies AWS users, accounts, services, or other entities that are granted or denied access to a resource.
     </span>
     <span class="koboSpan" id="kobo.483.2">
      It is predominantly used in resource-based policies to specify which entities are allowed or denied access to a specific AWS resource.
     </span>
     <span class="koboSpan" id="kobo.483.3">
      Identity-based policies do not use the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.484.1">
       Principal
      </span>
     </strong>
     <span class="koboSpan" id="kobo.485.1">
      element, as these policies are directly attached to users, groups, or roles, thus rendering the inclusion of a
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.486.1">
       Principal
      </span>
     </strong>
     <span class="koboSpan" id="kobo.487.1">
      element unnecessary.
     </span>
     <span class="koboSpan" id="kobo.487.2">
      Permissions boundaries also do not include the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.488.1">
       Principal
      </span>
     </strong>
     <span class="koboSpan" id="kobo.489.1">
      element; instead, they serve as a ceiling to the permissions that IAM entities (including users and roles but excluding groups) can have.
     </span>
     <span class="koboSpan" id="kobo.489.2">
      SCPs also do not include the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.490.1">
       Principal
      </span>
     </strong>
     <span class="koboSpan" id="kobo.491.1">
      element.
     </span>
     <span class="koboSpan" id="kobo.491.2">
      Following is an example for a
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.492.1">
       Principal
      </span>
     </strong>
     <span class="koboSpan" id="kobo.493.1">
      element:
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.494.1">
       "Principal": {"
      </span>
     </strong>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.495.1">
        AWS": "arn:aws:iam::Account-ID-without-hyphens:user/Rick"}
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.496.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.497.1">
      The optional
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.498.1">
       NotPrincipal
      </span>
     </strong>
     <span class="koboSpan" id="kobo.499.1">
      element is the opposite of the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.500.1">
       Principal
      </span>
     </strong>
     <span class="koboSpan" id="kobo.501.1">
      element and specifies all principals except the listed principals who are allowed or denied by the policy.
     </span>
     <span class="koboSpan" id="kobo.501.2">
      Similar to the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.502.1">
       Principal
      </span>
     </strong>
     <span class="koboSpan" id="kobo.503.1">
      element, we cannot have it within SCPs or permissions boundaries.
     </span>
     <span class="koboSpan" id="kobo.503.2">
      We can use one or the other of
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.504.1">
       Principal
      </span>
     </strong>
     <span class="koboSpan" id="kobo.505.1">
      and
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.506.1">
       NotPrincipal
      </span>
     </strong>
     <span class="koboSpan" id="kobo.507.1">
      within a single policy statement but not both.
     </span>
     <span class="koboSpan" id="kobo.507.2">
      They can, however, be used in separate statements within the same
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.508.1">
       overall policy.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.509.1">
      The optional
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.510.1">
       Condition
      </span>
     </strong>
     <span class="koboSpan" id="kobo.511.1">
      element allows us to conditionally execute policies as we can see from
     </span>
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.512.1">
        Figure 2
       </span>
      </em>
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.513.1">
       .8
      </span>
     </em>
     <span class="koboSpan" id="kobo.514.1">
      .
     </span>
     <span class="koboSpan" id="kobo.514.2">
      We use Boolean operators to match the condition against values in the request.
     </span>
     <span class="koboSpan" id="kobo.514.3">
      For example, in this recipe, we used the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.515.1">
       IpAddress
      </span>
     </strong>
     <span class="koboSpan" id="kobo.516.1">
      condition along with the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.517.1">
       aws:SourceIp
      </span>
     </strong>
     <span class="koboSpan" id="kobo.518.1">
      parameter to allow the actions only if a request is made from the specified IP address.
     </span>
     <span class="koboSpan" id="kobo.518.2">
      We can also specify a range of IP addresses using the CIDR notation.
     </span>
     <span class="koboSpan" id="kobo.518.3">
      CIDR is a method for allocating and routing IP addresses without relying on traditional fixed class-based systems.
     </span>
     <span class="koboSpan" id="kobo.518.4">
      The following are some of the predefined condition keys that are supported by all AWS services
     </span>
     <a id="_idIndexMarker223">
     </a>
     <span class="koboSpan" id="kobo.519.1">
      that support IAM access control:
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.520.1">
       aws:CurrentTime
      </span>
     </strong>
     <span class="koboSpan" id="kobo.521.1">
      ,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.522.1">
       aws:EpochTime
      </span>
     </strong>
     <span class="koboSpan" id="kobo.523.1">
      ,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.524.1">
       aws:MultiFactorAuthAge
      </span>
     </strong>
     <span class="koboSpan" id="kobo.525.1">
      ,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.526.1">
       aws:MultiFactorAuthPresent
      </span>
     </strong>
     <span class="koboSpan" id="kobo.527.1">
      ,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.528.1">
       aws:PrincipalOrgID
      </span>
     </strong>
     <span class="koboSpan" id="kobo.529.1">
      ,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.530.1">
       aws:PrincipalArn
      </span>
     </strong>
     <span class="koboSpan" id="kobo.531.1">
      ,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.532.1">
       aws:RequestedRegion
      </span>
     </strong>
     <span class="koboSpan" id="kobo.533.1">
      ,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.534.1">
       aws:SecureTransport
      </span>
     </strong>
     <span class="koboSpan" id="kobo.535.1">
      ,
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.536.1">
       and
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.537.1">
        aws:UserAgent
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.538.1">
       .
      </span>
     </span>
    </li>
   </ul>
   <h2 id="_idParaDest-49">
    <a id="_idTextAnchor050">
    </a>
    <span class="koboSpan" id="kobo.539.1">
     There’s more...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.540.1">
     Let’s go through some core concepts related to policies in AWS, including AWS policy types and the policy
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.541.1">
      evaluation logic.
     </span>
    </span>
   </p>
   <h3>
    <span class="koboSpan" id="kobo.542.1">
     AWS policy types
    </span>
   </h3>
   <p>
    <span class="koboSpan" id="kobo.543.1">
     The following is a list of important policy types in AWS along with examples and
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.544.1">
      use cases:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.545.1">
        Identity-based policies
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.546.1">
       :
      </span>
     </span>
     <ul>
      <li>
       <strong class="bold">
        <span class="koboSpan" id="kobo.547.1">
         Example
        </span>
       </strong>
       <span class="koboSpan" id="kobo.548.1">
        : IAM policies attached
       </span>
       <a id="_idIndexMarker224">
       </a>
       <span class="koboSpan" id="kobo.549.1">
        to users, groups,
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.550.1">
         or roles.
        </span>
       </span>
      </li>
      <li>
       <strong class="bold">
        <span class="koboSpan" id="kobo.551.1">
         Use case
        </span>
       </strong>
       <span class="koboSpan" id="kobo.552.1">
        : They allow a developer read-only access to a specific
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.553.1">
         S3 bucket.
        </span>
       </span>
      </li>
     </ul>
    </li>
    <li>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.554.1">
        Resource-based policies
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.555.1">
       :
      </span>
     </span>
     <ul>
      <li>
       <strong class="bold">
        <span class="koboSpan" id="kobo.556.1">
         Example
        </span>
       </strong>
       <span class="koboSpan" id="kobo.557.1">
        : S3 bucket policies
       </span>
       <a id="_idIndexMarker225">
       </a>
       <span class="koboSpan" id="kobo.558.1">
        and IAM role
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.559.1">
         trust policies.
        </span>
       </span>
      </li>
      <li>
       <strong class="bold">
        <span class="koboSpan" id="kobo.560.1">
         Use case
        </span>
       </strong>
       <span class="koboSpan" id="kobo.561.1">
        : They grant a user in another AWS account read and write access to a
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.562.1">
         specified bucket.
        </span>
       </span>
      </li>
     </ul>
    </li>
    <li>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.563.1">
        Session policies
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.564.1">
       :
      </span>
     </span>
     <ul>
      <li>
       <strong class="bold">
        <span class="koboSpan" id="kobo.565.1">
         Example
        </span>
       </strong>
       <span class="koboSpan" id="kobo.566.1">
        : A policy limiting permissions
       </span>
       <a id="_idIndexMarker226">
       </a>
       <span class="koboSpan" id="kobo.567.1">
        when assuming a
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.568.1">
         role temporarily.
        </span>
       </span>
      </li>
      <li>
       <strong class="bold">
        <span class="koboSpan" id="kobo.569.1">
         Use case
        </span>
       </strong>
       <span class="koboSpan" id="kobo.570.1">
        : They provide a developer with temporary enhanced permissions for troubleshooting while limiting access to read-only to
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.571.1">
         ensure security.
        </span>
       </span>
      </li>
     </ul>
    </li>
    <li>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.572.1">
        Permissions boundaries
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.573.1">
       :
      </span>
     </span>
     <ul>
      <li>
       <strong class="bold">
        <span class="koboSpan" id="kobo.574.1">
         Example
        </span>
       </strong>
       <span class="koboSpan" id="kobo.575.1">
        : They set a maximum permission
       </span>
       <a id="_idIndexMarker227">
       </a>
       <span class="koboSpan" id="kobo.576.1">
        limit for IAM users
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.577.1">
         or roles.
        </span>
       </span>
      </li>
      <li>
       <strong class="bold">
        <span class="koboSpan" id="kobo.578.1">
         Use case
        </span>
       </strong>
       <span class="koboSpan" id="kobo.579.1">
        : They prevent an IAM user from escalating their own permissions beyond a defined boundary to ensure security
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.580.1">
         and compliance.
        </span>
       </span>
      </li>
     </ul>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.581.1">
       The following elements are not supported in permissions boundaries:
      </span>
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.582.1">
        Principal
       </span>
      </strong>
      <span class="koboSpan" id="kobo.583.1">
       ,
      </span>
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.584.1">
        NotPrincipal
       </span>
      </strong>
      <span class="koboSpan" id="kobo.585.1">
       ,
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.586.1">
        and
       </span>
      </span>
      <span class="No-Break">
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.587.1">
         NotResource
        </span>
       </strong>
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.588.1">
        .
       </span>
      </span>
     </p>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.589.1">
       Permissions boundaries operate as a mechanism for limiting the maximum permissions that can be granted by any attached policies, ensuring a layer of security and control over permissions allocation.
      </span>
      <span class="koboSpan" id="kobo.589.2">
       The permissions boundary does not grant access.
      </span>
      <span class="koboSpan" id="kobo.589.3">
       In essence, if an identity-based policy allows certain actions, those actions cannot be performed unless they are also within the confines of the permissions boundary.
      </span>
      <span class="koboSpan" id="kobo.589.4">
       If an identity-based policy attempts to grant permissions beyond what is allowed by the permissions boundary, those excess permissions will be restricted.
      </span>
      <span class="koboSpan" id="kobo.589.5">
       In other words, effective permissions are the intersection
      </span>
      <a id="_idIndexMarker228">
      </a>
      <span class="koboSpan" id="kobo.590.1">
       of the identity-based policy and the
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.591.1">
        permissions boundary.
       </span>
      </span>
     </p>
    </li>
    <li>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.592.1">
        SCPs
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.593.1">
       :
      </span>
     </span>
     <ul>
      <li>
       <strong class="bold">
        <span class="koboSpan" id="kobo.594.1">
         Example
        </span>
       </strong>
       <span class="koboSpan" id="kobo.595.1">
        : A policy that restricts the deletion
       </span>
       <a id="_idIndexMarker229">
       </a>
       <span class="koboSpan" id="kobo.596.1">
        of IAM roles across all accounts in an
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.597.1">
         AWS organization.
        </span>
       </span>
      </li>
      <li>
       <strong class="bold">
        <span class="koboSpan" id="kobo.598.1">
         Use case
        </span>
       </strong>
       <span class="koboSpan" id="kobo.599.1">
        : They enhance security by ensuring that certain IAM entities and policies are not modified
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.600.1">
         or deleted.
        </span>
       </span>
      </li>
     </ul>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.601.1">
       The following elements are not supported in SCPs:
      </span>
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.602.1">
        Principal
       </span>
      </strong>
      <span class="koboSpan" id="kobo.603.1">
       ,
      </span>
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.604.1">
        NotPrincipal
       </span>
      </strong>
      <span class="koboSpan" id="kobo.605.1">
       ,
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.606.1">
        and
       </span>
      </span>
      <span class="No-Break">
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.607.1">
         NotResource
        </span>
       </strong>
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.608.1">
        .
       </span>
      </span>
     </p>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.609.1">
       SCPs in AWS Organizations function similarly to permission boundaries, serving as guardrails that restrict the maximum permissions for IAM entities within AWS accounts in the organization.
      </span>
      <span class="koboSpan" id="kobo.609.2">
       SCPs don’t grant permissions but limit them, working alongside IAM permission policies.
      </span>
      <span class="koboSpan" id="kobo.609.3">
       Effective permissions are an intersection of the allowances of IAM policies and SCPs, and any explicit
      </span>
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.610.1">
        Deny
       </span>
      </strong>
      <span class="koboSpan" id="kobo.611.1">
       in either overrides the allowed permissions.
      </span>
      <span class="koboSpan" id="kobo.611.2">
       Thus, IAM entities can only perform actions allowed by both IAM policies
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.612.1">
        and SCPs.
       </span>
      </span>
     </p>
    </li>
    <li>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.613.1">
        ACLs
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.614.1">
       :
      </span>
     </span>
     <ul>
      <li>
       <strong class="bold">
        <span class="koboSpan" id="kobo.615.1">
         Example
        </span>
       </strong>
       <span class="koboSpan" id="kobo.616.1">
        : They specify which principals
       </span>
       <a id="_idIndexMarker230">
       </a>
       <span class="koboSpan" id="kobo.617.1">
        in another AWS account can access a specific
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.618.1">
         S3 bucket.
        </span>
       </span>
      </li>
      <li>
       <strong class="bold">
        <span class="koboSpan" id="kobo.619.1">
         Use case
        </span>
       </strong>
       <span class="koboSpan" id="kobo.620.1">
        : They enable secure data sharing between AWS accounts by granting specific permissions to access data stored in an
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.621.1">
         S3 bucket.
        </span>
       </span>
      </li>
     </ul>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.622.1">
     Each policy type serves as an essential tool in the AWS environment, contributing to the intricate ecosystem of access control and security, ensuring optimal operational efficiency and security.
    </span>
    <span class="koboSpan" id="kobo.622.2">
     We discussed identity-based policies in this chapter and will be discussing more variations of them and other policy types within subsequent recipes within this book.
    </span>
    <span class="koboSpan" id="kobo.622.3">
     Next, we will look into an overview of the IAM policy
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.623.1">
      evaluation logic.
     </span>
    </span>
   </p>
   <h3>
    <span class="koboSpan" id="kobo.624.1">
     IAM policy evaluation logic
    </span>
   </h3>
   <p>
    <strong class="bold">
     <span class="koboSpan" id="kobo.625.1">
      AWS IAM policy evaluation logic
     </span>
    </strong>
    <span class="koboSpan" id="kobo.626.1">
     determines whether a request
    </span>
    <a id="_idIndexMarker231">
    </a>
    <span class="koboSpan" id="kobo.627.1">
     is allowed or denied based on the policies attached to the IAM principal (user or role) making the request, and any permissions boundaries or resource-based policies
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.628.1">
      that apply.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.629.1">
     When SCPs and permissions boundaries are not present, a union of all permissions is considered for evaluation.
    </span>
    <span class="koboSpan" id="kobo.629.2">
     Here’s a brief outline of the steps involved in the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.630.1">
      evaluation process:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.631.1">
      The evaluation logic checks for any explicit
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.632.1">
       Deny
      </span>
     </strong>
     <span class="koboSpan" id="kobo.633.1">
      statements that apply to the request.
     </span>
     <span class="koboSpan" id="kobo.633.2">
      If there’s at least one explicit
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.634.1">
       Deny
      </span>
     </strong>
     <span class="koboSpan" id="kobo.635.1">
      , the request is denied irrespective of any
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.636.1">
        Allow
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.637.1">
       statements.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.638.1">
      If there are no explicit
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.639.1">
       Deny
      </span>
     </strong>
     <span class="koboSpan" id="kobo.640.1">
      statements, the logic checks for any explicit
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.641.1">
       Allow
      </span>
     </strong>
     <span class="koboSpan" id="kobo.642.1">
      statements.
     </span>
     <span class="koboSpan" id="kobo.642.2">
      If there’s at least one
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.643.1">
       Allow
      </span>
     </strong>
     <span class="koboSpan" id="kobo.644.1">
      , the request is allowed, provided there isn’t an
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.645.1">
       explicit
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.646.1">
        Deny
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.647.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.648.1">
      If there are no explicit
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.649.1">
       Allow
      </span>
     </strong>
     <span class="koboSpan" id="kobo.650.1">
      or
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.651.1">
       Deny
      </span>
     </strong>
     <span class="koboSpan" id="kobo.652.1">
      statements that apply to the request, the request is denied by default because IAM is a default
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.653.1">
       Deny
      </span>
     </strong>
     <span class="koboSpan" id="kobo.654.1">
      , explicit
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.655.1">
        Allow
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.656.1">
       system.
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.657.1">
     If we use SCPs or permissions
    </span>
    <a id="_idIndexMarker232">
    </a>
    <span class="koboSpan" id="kobo.658.1">
     boundaries, an intersection of other policies with SCPs or permissions boundaries is considered for evaluation.
    </span>
    <span class="koboSpan" id="kobo.658.2">
     This is because SCPs and permissions boundaries set the maximum permissions you can have.
    </span>
    <span class="koboSpan" id="kobo.658.3">
     Therefore, if an SCP or permission boundary gives permission for S3 access and an identity policy gives permission for EC2, our effective permission will be none.
    </span>
    <span class="koboSpan" id="kobo.658.4">
     To understand SCPs better, we can refer to the discussion about SCPs within the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.659.1">
      Multi-account management with AWS Organizations
     </span>
    </em>
    <span class="koboSpan" id="kobo.660.1">
     recipe in
    </span>
    <a href="B21384_01.xhtml#_idTextAnchor020">
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.661.1">
        Chapter 1
       </span>
      </em>
     </span>
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.662.1">
      .
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.663.1">
     Next, we will look into some additional concepts related to
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.664.1">
      IAM policies.
     </span>
    </span>
   </p>
   <h3>
    <span class="koboSpan" id="kobo.665.1">
     Additional notes on IAM policies
    </span>
   </h3>
   <p>
    <span class="koboSpan" id="kobo.666.1">
     Let’s quickly go through
    </span>
    <a id="_idIndexMarker233">
    </a>
    <span class="koboSpan" id="kobo.667.1">
     some additional concepts related to policies
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.668.1">
      in AWS:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.669.1">
       AWS managed - job function
      </span>
     </strong>
     <span class="koboSpan" id="kobo.670.1">
      type is a subset of
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.671.1">
       AWS managed
      </span>
     </strong>
     <span class="koboSpan" id="kobo.672.1">
      type and is designed to align with common IT job functions.
     </span>
     <span class="koboSpan" id="kobo.672.2">
      The current list of job functions includes administrator, billing, database administrator, data scientist, developer power user, network administrator, read-only access, security auditor, support user, system administrator, and
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.673.1">
       view-only user.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.674.1">
      The
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.675.1">
       AWS Policy Generator
      </span>
     </strong>
     <span class="koboSpan" id="kobo.676.1">
      can generate the
     </span>
     <a id="_idIndexMarker234">
     </a>
     <span class="koboSpan" id="kobo.677.1">
      following policy types:
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.678.1">
       Simple Queue Service
      </span>
     </strong>
     <span class="koboSpan" id="kobo.679.1">
      (
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.680.1">
       SQS
      </span>
     </strong>
     <span class="koboSpan" id="kobo.681.1">
      ) queue policy, S3 bucket
     </span>
     <a id="_idIndexMarker235">
     </a>
     <span class="koboSpan" id="kobo.682.1">
      policy, VPC endpoint
     </span>
     <a id="_idIndexMarker236">
     </a>
     <span class="koboSpan" id="kobo.683.1">
      policy, IAM policy, and
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.684.1">
       Simple Notification Service
      </span>
     </strong>
     <span class="koboSpan" id="kobo.685.1">
      (
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.686.1">
       SNS
      </span>
     </strong>
     <span class="koboSpan" id="kobo.687.1">
      ) topic policy.
     </span>
     <span class="koboSpan" id="kobo.687.2">
      It is currently available
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.688.1">
       at
      </span>
     </span>
     <a href="https://awspolicygen.s3.amazonaws.com/policygen.html">
      <span class="No-Break">
       <span class="koboSpan" id="kobo.689.1">
        https://awspolicygen.s3.amazonaws.com/policygen.html
       </span>
      </span>
     </a>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.690.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.691.1">
      If both
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.692.1">
       Allow
      </span>
     </strong>
     <span class="koboSpan" id="kobo.693.1">
      and
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.694.1">
       Deny
      </span>
     </strong>
     <span class="koboSpan" id="kobo.695.1">
      effects are set for the same action and resource in a policy,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.696.1">
       Deny
      </span>
     </strong>
     <span class="koboSpan" id="kobo.697.1">
      will always
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.698.1">
       override
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.699.1">
        Allow
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.700.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.701.1">
      An IAM policy cannot be used to grant permissions
     </span>
     <a id="_idIndexMarker237">
     </a>
     <span class="koboSpan" id="kobo.702.1">
      for anonymous
     </span>
     <a id="_idIndexMarker238">
     </a>
     <span class="koboSpan" id="kobo.703.1">
      users, unlike
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.704.1">
       S3 ACL
      </span>
     </strong>
     <span class="koboSpan" id="kobo.705.1">
      and the
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.706.1">
        Bucket policy
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.707.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.708.1">
      The IAM policy
     </span>
     <a id="_idIndexMarker239">
     </a>
     <span class="koboSpan" id="kobo.709.1">
      cannot be applied to a root user and can only be applied to
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.710.1">
       IAM users.
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.711.1">
     To truly master and make the most out of AWS IAM, it is essential to grasp the finer details of AWS policies.
    </span>
    <span class="koboSpan" id="kobo.711.2">
     With a comprehensive understanding of policy management and policy evaluation logic, we can try to strike a balance between security and operational efficiency.
    </span>
    <span class="koboSpan" id="kobo.711.3">
     For the latest on policy types, evaluation rules, and best practices, always refer to the official
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.712.1">
      AWS documentation.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-50">
    <a id="_idTextAnchor051">
    </a>
    <span class="koboSpan" id="kobo.713.1">
     See also
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.714.1">
     We can continue learning
    </span>
    <a id="_idIndexMarker240">
    </a>
    <span class="koboSpan" id="kobo.715.1">
     about AWS policies and permissions
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.716.1">
      here:
     </span>
    </span>
    <a href="https://www.cloudericks.com/blog/demystifying-aws-policies-and-permissions">
     <span class="No-Break">
      <span class="koboSpan" id="kobo.717.1">
       https://www.cloudericks.com/blog/demystifying-aws-policies-and-permissions
      </span>
     </span>
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.718.1">
      .
     </span>
    </span>
   </p>
   <h1 id="_idParaDest-51">
    <a id="_idTextAnchor052">
    </a>
    <span class="koboSpan" id="kobo.719.1">
     Using policy variables within IAM policies
    </span>
   </h1>
   <p>
    <strong class="bold">
     <span class="koboSpan" id="kobo.720.1">
      IAM policy variables
     </span>
    </strong>
    <span class="koboSpan" id="kobo.721.1">
     are a set of predefined placeholders
    </span>
    <a id="_idIndexMarker241">
    </a>
    <span class="koboSpan" id="kobo.722.1">
     that we can use in IAM policy documents, and they get replaced with the actual values at runtime.
    </span>
    <span class="koboSpan" id="kobo.722.2">
     They help in creating more dynamic and flexible policies.
    </span>
    <span class="koboSpan" id="kobo.722.3">
     In this recipe, we will create an S3 bucket with folders matching the usernames of IAM users.
    </span>
    <span class="koboSpan" id="kobo.722.4">
     With the help of the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.723.1">
      ${aws:username}
     </span>
    </strong>
    <span class="koboSpan" id="kobo.724.1">
     policy variable, we will allow the IAM user to list the contents of only the folder with their names.
    </span>
    <span class="koboSpan" id="kobo.724.2">
     We will use the AWS CLI for this recipe, but you may do it from the AWS Management Console by making use of the provided JSON code following the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.725.1">
      previous recipe.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-52">
    <a id="_idTextAnchor053">
    </a>
    <span class="koboSpan" id="kobo.726.1">
     Getting ready
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.727.1">
     We need the following
    </span>
    <a id="_idIndexMarker242">
    </a>
    <span class="koboSpan" id="kobo.728.1">
     to successfully complete
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.729.1">
      this recipe:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.730.1">
      A working
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.731.1">
       awsseccb-sandbox-1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.732.1">
      AWS account, a user with
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.733.1">
       AdministratorAccess
      </span>
     </strong>
     <span class="koboSpan" id="kobo.734.1">
      permission to that account,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.735.1">
       awsseccbadmin1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.736.1">
      , and a corresponding
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.737.1">
       Sandbox1Admin1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.738.1">
      CLI profile, following the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.739.1">
       Technical requirements
      </span>
     </em>
     <span class="koboSpan" id="kobo.740.1">
      section of
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.741.1">
       this chapter.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.742.1">
      For testing this recipe, we need two IAM users,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.743.1">
       awsseccb_iam_user1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.744.1">
      and
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.745.1">
       awsseccb_iam_user2
      </span>
     </strong>
     <span class="koboSpan" id="kobo.746.1">
      , with minimal or no permission in the sandbox account, and corresponding CLI profiles named
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.747.1">
       Sandbox1User1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.748.1">
      and
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.749.1">
       Sandbox1User2
      </span>
     </strong>
     <span class="koboSpan" id="kobo.750.1">
      .
     </span>
     <span class="koboSpan" id="kobo.750.2">
      Following the best practices, create a user group called
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.751.1">
       awsseccb_iam_users
      </span>
     </strong>
     <span class="koboSpan" id="kobo.752.1">
      and add these users to
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.753.1">
       the group.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.754.1">
      An S3 bucket following the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.755.1">
       Technical requirements
      </span>
     </em>
     <span class="koboSpan" id="kobo.756.1">
      section of this chapter.
     </span>
     <span class="koboSpan" id="kobo.756.2">
      Create folders in the S3 bucket with the names of the IAM users we created for testing this recipe, namely
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.757.1">
       awsseccb_iam_user1
      </span>
     </strong>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.758.1">
       and
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.759.1">
        awsseccb_iam_user2
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.760.1">
       .
      </span>
     </span>
    </li>
   </ul>
   <h2 id="_idParaDest-53">
    <a id="_idTextAnchor054">
    </a>
    <span class="koboSpan" id="kobo.761.1">
     How to do it...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.762.1">
     In this section, we will use the AWS CLI to create an IAM policy and then attach it to a group.
    </span>
    <span class="koboSpan" id="kobo.762.2">
     We will also explore the use of policy variables within this recipe.
    </span>
    <span class="koboSpan" id="kobo.762.3">
     Let us
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.763.1">
      get started:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.764.1">
      Create a file called
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.765.1">
       s3-list-user-folder-policy.json
      </span>
     </strong>
     <span class="koboSpan" id="kobo.766.1">
      with the following JSON policy, but replace my bucket name with your
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.767.1">
       bucket name:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.768.1">
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": "s3:ListBucket",
      "Resource": "arn:aws:s3:::cloudericks-demo",
      "Condition": {
        "StringLike": {
          "s3:prefix": "${aws:username}/*"
        }
      }
    }
  ]
}</span></pre>
    </li>
   </ol>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.769.1">
     Important note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.770.1">
     The policy JSON file and all the CLI commands are included with the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.771.1">
      code files.
     </span>
    </span>
   </p>
   <ol>
    <li value="2">
     <span class="koboSpan" id="kobo.772.1">
      Create the policy
     </span>
     <a id="_idIndexMarker243">
     </a>
     <span class="koboSpan" id="kobo.773.1">
      using the
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.774.1">
        create-policy
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.775.1">
       subcommand:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.776.1">aws iam create-policy --policy-name S3ListMyFolderPolicy --policy-document file://s3-list-user-folder-policy.json --profile Sandbox1Admin1</span></strong></pre>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.777.1">
       This should return the policy’s details, along with
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.778.1">
        its ARN:
       </span>
      </span>
     </p>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer052">
     <span class="koboSpan" id="kobo.779.1">
      <img alt="Figure 2.9 – The create-policy command response" src="image/B21384_02_9.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.780.1">
     Figure 2.9 – The create-policy command response
    </span>
   </p>
   <ol>
    <li value="3">
     <span class="koboSpan" id="kobo.781.1">
      Attach the policy to the group
     </span>
     <a id="_idIndexMarker244">
     </a>
     <span class="koboSpan" id="kobo.782.1">
      using the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.783.1">
       attach-group-policy
      </span>
     </strong>
     <span class="koboSpan" id="kobo.784.1">
      subcommand using the policy ARN from the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.785.1">
       previous command:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.786.1">aws iam attach-group-policy --group-name awsseccb_iam_users --policy-arn arn:aws:iam::207849759248:policy/S3ListMyFolderPolicy --profile Sandbox1Admin1</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.787.1">
      Verify the changes by running the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.788.1">
       aws s3 ls
      </span>
     </strong>
     <span class="koboSpan" id="kobo.789.1">
      command followed by the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.790.1">
       awsseccb_iam_user1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.791.1">
      bucket name and folder name with the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.792.1">
       AwsSecCbUser
      </span>
     </strong>
     <span class="koboSpan" id="kobo.793.1">
      profile for the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.794.1">
       awsseccb_iam_user1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.795.1">
      IAM user from the
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.796.1">
        awsseccb_users
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.797.1">
       group:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.798.1">aws s3 ls cloudericks-demo/awsseccb_iam_user1/ --profile Sandbox1User1</span></strong></pre>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.799.1">
       This should yield a successful response, listing all the objects from the
      </span>
      <span class="No-Break">
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.800.1">
         awsseccb_iam_user1
        </span>
       </strong>
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.801.1">
        folder.
       </span>
      </span>
     </p>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer053">
     <span class="koboSpan" id="kobo.802.1">
      <img alt="Figure 2.10 – Listing the S3 folder" src="image/B21384_02_10.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.803.1">
     Figure 2.10 – Listing the S3 folder
    </span>
   </p>
   <ol>
    <li value="5">
     <span class="koboSpan" id="kobo.804.1">
      Verify the changes by running
     </span>
     <a id="_idIndexMarker245">
     </a>
     <span class="koboSpan" id="kobo.805.1">
      the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.806.1">
       aws s3 ls
      </span>
     </strong>
     <span class="koboSpan" id="kobo.807.1">
      command followed by the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.808.1">
       awsseccb_iam_user1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.809.1">
      bucket name and folder name with the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.810.1">
       Sandbox1User2
      </span>
     </strong>
     <span class="koboSpan" id="kobo.811.1">
      profile for the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.812.1">
       awsseccb_iam_user2
      </span>
     </strong>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.813.1">
       IAM user:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.814.1">aws s3 ls cloudericks-demo/awsseccb_iam_user1/ --profile Sandbox1User2</span></strong></pre>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.815.1">
       This should yield an
      </span>
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.816.1">
        AccessDenied
       </span>
      </strong>
      <span class="koboSpan" id="kobo.817.1">
       response as
      </span>
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.818.1">
        awsseccb_iam_user2
       </span>
      </strong>
      <span class="koboSpan" id="kobo.819.1">
       cannot list the
      </span>
      <span class="No-Break">
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.820.1">
         awsseccb_iam_user1
        </span>
       </strong>
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.821.1">
        folder.
       </span>
      </span>
     </p>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer054">
     <span class="koboSpan" id="kobo.822.1">
      <img alt="Figure 2.11 – Listing other user’s S3 folders" src="image/B21384_02_11.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.823.1">
     Figure 2.11 – Listing other user’s S3 folders
    </span>
   </p>
   <p class="list-inset">
    <span class="koboSpan" id="kobo.824.1">
     If we try to list content of the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.825.1">
      awsseccb_iam_user2
     </span>
    </strong>
    <span class="koboSpan" id="kobo.826.1">
     folder with the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.827.1">
      Sandbox1User2
     </span>
    </strong>
    <span class="koboSpan" id="kobo.828.1">
     profile for the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.829.1">
      awsseccb_iam_user2
     </span>
    </strong>
    <span class="koboSpan" id="kobo.830.1">
     IAM user, we should get a successful response, listing all the objects from the
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.831.1">
       awsseccb_iam_user1
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.832.1">
      folder.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-54">
    <a id="_idTextAnchor055">
    </a>
    <span class="koboSpan" id="kobo.833.1">
     How it works...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.834.1">
     In this recipe, we created
    </span>
    <a id="_idIndexMarker246">
    </a>
    <span class="koboSpan" id="kobo.835.1">
     an IAM policy with the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.836.1">
      ${aws:username}
     </span>
    </strong>
    <span class="koboSpan" id="kobo.837.1">
     policy variable to restrict an IAM user to listing the contents of a folder within an S3 bucket only if that user’s username matches the folder name.
    </span>
    <span class="koboSpan" id="kobo.837.2">
     The policy variable
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.838.1">
      ${aws:username}
     </span>
    </strong>
    <span class="koboSpan" id="kobo.839.1">
     represents the IAM username of the user making the request.
    </span>
    <span class="koboSpan" id="kobo.839.2">
     This means that if we assign the policy to a user called
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.840.1">
      awsseccb_iam_user1
     </span>
    </strong>
    <span class="koboSpan" id="kobo.841.1">
     , then, the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.842.1">
      ${aws:username}
     </span>
    </strong>
    <span class="koboSpan" id="kobo.843.1">
     policy within the IAM policy will be replaced with
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.844.1">
      ${aws:username}
     </span>
    </strong>
    <span class="koboSpan" id="kobo.845.1">
     at runtime during policy evaluation, and the user will then get permission only to
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.846.1">
      this folder.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-55">
    <a id="_idTextAnchor056">
    </a>
    <span class="koboSpan" id="kobo.847.1">
     There’s more
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.848.1">
     AWS supports a set of predefined policy variables that can be used in IAM policies.
    </span>
    <span class="koboSpan" id="kobo.848.2">
     Here’s a list of commonly used IAM
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.849.1">
      policy variables:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.850.1">
       ${aws:username}
      </span>
     </strong>
     <span class="koboSpan" id="kobo.851.1">
      : This variable is replaced with the IAM username of the user making
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.852.1">
       the request.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.853.1">
       ${aws:userid}
      </span>
     </strong>
     <span class="koboSpan" id="kobo.854.1">
      : This variable represents the unique identifier of the IAM user or role making
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.855.1">
       the request.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.856.1">
       ${aws:CurrentTime}
      </span>
     </strong>
     <span class="koboSpan" id="kobo.857.1">
      : The current date and time in UTC, formatted
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.858.1">
       as YYYY-MM-DDTHH:MM:SSZ.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.859.1">
       ${aws:EpochTime}
      </span>
     </strong>
     <span class="koboSpan" id="kobo.860.1">
      : The current date and time in UTC, represented as the number of seconds since January 1, 1970 (the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.861.1">
       Unix epoch).
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.862.1">
       ${aws:principaltype}
      </span>
     </strong>
     <span class="koboSpan" id="kobo.863.1">
      : The type of principal (user, account, role, federated user, etc.) making
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.864.1">
       the request.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.865.1">
       ${aws:SecureTransport}
      </span>
     </strong>
     <span class="koboSpan" id="kobo.866.1">
      : A Boolean value indicating whether the request was sent
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.867.1">
       using SSL.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.868.1">
       ${aws:SourceIp}
      </span>
     </strong>
     <span class="koboSpan" id="kobo.869.1">
      : The IP address of the requester.
     </span>
     <span class="koboSpan" id="kobo.869.2">
      This is useful for restricting access to certain
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.870.1">
       IP ranges.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.871.1">
       ${aws:UserAgent}
      </span>
     </strong>
     <span class="koboSpan" id="kobo.872.1">
      : The user agent string of the requester’s
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.873.1">
       client application.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.874.1">
       ${aws:Requester}
      </span>
     </strong>
     <span class="koboSpan" id="kobo.875.1">
      : The AWS account ID of the requester.
     </span>
     <span class="koboSpan" id="kobo.875.2">
      Useful in
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.876.1">
       cross-account scenarios.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.877.1">
       ${aws:sourceVpc}
      </span>
     </strong>
     <span class="koboSpan" id="kobo.878.1">
      ,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.879.1">
       ${aws:sourceVpce}
      </span>
     </strong>
     <span class="koboSpan" id="kobo.880.1">
      , and
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.881.1">
       ${aws:sourceVpcIpv4CidrBlock}
      </span>
     </strong>
     <span class="koboSpan" id="kobo.882.1">
      are variables used for controlling access based on the source VPC, VPC endpoint, or the IPv4 CIDR block of
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.883.1">
       the request.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.884.1">
       ${aws:TagKeys}
      </span>
     </strong>
     <span class="koboSpan" id="kobo.885.1">
      and
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.886.1">
       ${aws:RequestTag/tag-key}
      </span>
     </strong>
     <span class="koboSpan" id="kobo.887.1">
      are used for matching the tags on
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.888.1">
       the request.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.889.1">
       ${aws:MultiFactorAuthPresent}
      </span>
     </strong>
     <span class="koboSpan" id="kobo.890.1">
      : A Boolean value
     </span>
     <a id="_idIndexMarker247">
     </a>
     <span class="koboSpan" id="kobo.891.1">
      indicating whether the request was made with
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.892.1">
       multi-factor
      </span>
     </strong>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.893.1">
        authentication
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.894.1">
       (
      </span>
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.895.1">
        MFA
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.896.1">
       ).
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.897.1">
       ${s3:x-amz-acl}
      </span>
     </strong>
     <span class="koboSpan" id="kobo.898.1">
      ,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.899.1">
       ${s3:x-amz-content-sha256}
      </span>
     </strong>
     <span class="koboSpan" id="kobo.900.1">
      ,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.901.1">
       ${s3:x-amz-copy-source}
      </span>
     </strong>
     <span class="koboSpan" id="kobo.902.1">
      , and so on, are service-specific variables for S3, allowing policies to match various conditions specific to
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.903.1">
       S3 requests.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.904.1">
       ${s3:prefix}
      </span>
     </strong>
     <span class="koboSpan" id="kobo.905.1">
      and
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.906.1">
       ${s3:max-keys}
      </span>
     </strong>
     <span class="koboSpan" id="kobo.907.1">
      are variables specifically for controlling access based
     </span>
     <a id="_idIndexMarker248">
     </a>
     <span class="koboSpan" id="kobo.908.1">
      on S3
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.909.1">
       request parameters.
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.910.1">
     This list isn’t exhaustive as AWS continually evolves and may introduce new variables or specific variables for different services beyond IAM.
    </span>
    <span class="koboSpan" id="kobo.910.2">
     For the most current and comprehensive list, it’s best to refer to the official
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.911.1">
      AWS documentation.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-56">
    <a id="_idTextAnchor057">
    </a>
    <span class="koboSpan" id="kobo.912.1">
     See also
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.913.1">
     We can read more about
    </span>
    <a id="_idIndexMarker249">
    </a>
    <span class="koboSpan" id="kobo.914.1">
     AWS policy variables
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.915.1">
      here:
     </span>
    </span>
    <a href="https://www.cloudericks.com/blog/understanding-aws-policy-variables-with-practical-examples">
     <span class="No-Break">
      <span class="koboSpan" id="kobo.916.1">
       https://www.cloudericks.com/blog/understanding-aws-policy-variables-with-practical-examples
      </span>
     </span>
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.917.1">
      .
     </span>
    </span>
   </p>
   <h1 id="_idParaDest-57">
    <a id="_idTextAnchor058">
    </a>
    <span class="koboSpan" id="kobo.918.1">
     Creating customer-managed policies in IAM Identity Center
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.919.1">
     To create customer-managed policies
    </span>
    <a id="_idIndexMarker250">
    </a>
    <span class="koboSpan" id="kobo.920.1">
     in IAM Identity Center, we need
    </span>
    <a id="_idIndexMarker251">
    </a>
    <span class="koboSpan" id="kobo.921.1">
     to first create a
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.922.1">
      custom permission set
     </span>
    </strong>
    <span class="koboSpan" id="kobo.923.1">
     and then assign users or groups
    </span>
    <a id="_idIndexMarker252">
    </a>
    <span class="koboSpan" id="kobo.924.1">
     to one or more AWS accounts with that permission set.
    </span>
    <span class="koboSpan" id="kobo.924.2">
     In the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.925.1">
      User management and SSO with IAM Identity Center
     </span>
    </em>
    <span class="koboSpan" id="kobo.926.1">
     recipe from
    </span>
    <a href="B21384_01.xhtml#_idTextAnchor020">
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.927.1">
        Chapter 1
       </span>
      </em>
     </span>
    </a>
    <span class="koboSpan" id="kobo.928.1">
     , we created a permission set using an AWS-managed policy.
    </span>
    <span class="koboSpan" id="kobo.928.2">
     In this recipe, we will create a custom permission set based on the customer-managed IAM policy we created in the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.929.1">
      Creating a customer-managed IAM policy
     </span>
    </em>
    <span class="koboSpan" id="kobo.930.1">
     recipe in this chapter, and then, we will assign a user to an AWS account with this permission set making use
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.931.1">
      of groups.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-58">
    <a id="_idTextAnchor059">
    </a>
    <span class="koboSpan" id="kobo.932.1">
     Getting ready
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.933.1">
     We need the following to successfully complete
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.934.1">
      this recipe:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.935.1">
      An AWS account where an IAM Identity Center instance is setup.
     </span>
     <span class="koboSpan" id="kobo.935.2">
      If we are using
     </span>
     <a id="_idIndexMarker253">
     </a>
     <span class="koboSpan" id="kobo.936.1">
      AWS Organizations, as we saw in
     </span>
     <a href="B21384_01.xhtml#_idTextAnchor020">
      <span class="No-Break">
       <em class="italic">
        <span class="koboSpan" id="kobo.937.1">
         Chapter 1
        </span>
       </em>
      </span>
     </a>
     <span class="koboSpan" id="kobo.938.1">
      , this will be the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.939.1">
       management account
      </span>
     </strong>
     <span class="koboSpan" id="kobo.940.1">
      .
     </span>
     <span class="koboSpan" id="kobo.940.2">
      We could also do this using a
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.941.1">
       delegated administrator
      </span>
     </strong>
     <span class="koboSpan" id="kobo.942.1">
      account in an AWS
     </span>
     <a id="_idIndexMarker254">
     </a>
     <span class="koboSpan" id="kobo.943.1">
      organization.
     </span>
     <span class="koboSpan" id="kobo.943.2">
      We learned about the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.944.1">
       delegated administrator
      </span>
     </strong>
     <span class="koboSpan" id="kobo.945.1">
      account in
     </span>
     <a href="B21384_01.xhtml#_idTextAnchor020">
      <span class="No-Break">
       <em class="italic">
        <span class="koboSpan" id="kobo.946.1">
         Chapter 1
        </span>
       </em>
      </span>
     </a>
     <span class="koboSpan" id="kobo.947.1">
      .
     </span>
     <span class="koboSpan" id="kobo.947.2">
      We can use the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.948.1">
       aws-sec-cookbook-1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.949.1">
      management account, which we set up in
     </span>
     <a href="B21384_01.xhtml#_idTextAnchor020">
      <span class="No-Break">
       <em class="italic">
        <span class="koboSpan" id="kobo.950.1">
         Chapter 1
        </span>
       </em>
      </span>
     </a>
     <span class="koboSpan" id="kobo.951.1">
      .
     </span>
     <span class="koboSpan" id="kobo.951.2">
      Alternatively, you may follow the steps from a standalone AWS account without AWS Organizations where an IAM Identity Center instance is set up, and in that case, just use that account when I refer to
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.952.1">
       aws-sec-cookbook-1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.953.1">
      in
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.954.1">
       the recipe.
      </span>
     </span>
    </li>
   </ul>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.955.1">
     Important note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.956.1">
     As a good practice, we can limit access to the management account by making administrative changes using a delegated administrator as we in the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.957.1">
      There’s more…
     </span>
    </em>
    <span class="koboSpan" id="kobo.958.1">
     section of the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.959.1">
      User management and SSO with IAM Identity Center
     </span>
    </em>
    <span class="koboSpan" id="kobo.960.1">
     recipe from
    </span>
    <a href="B21384_01.xhtml#_idTextAnchor020">
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.961.1">
        Chapter 1
       </span>
      </em>
     </span>
    </a>
    <span class="koboSpan" id="kobo.962.1">
     .
    </span>
    <span class="koboSpan" id="kobo.962.2">
     This is particularly advisable for larger organizations to restrict the number of people with access to the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.963.1">
      management account.
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.964.1">
      We need a user
     </span>
     <a id="_idIndexMarker255">
     </a>
     <span class="koboSpan" id="kobo.965.1">
      with
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.966.1">
       AdministratorAccess
      </span>
     </strong>
     <span class="koboSpan" id="kobo.967.1">
      permission
     </span>
     <a id="_idIndexMarker256">
     </a>
     <span class="koboSpan" id="kobo.968.1">
      for the account we plan to use for this recipe, which is
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.969.1">
       aws-sec-cookbook-1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.970.1">
      in our case.
     </span>
     <span class="koboSpan" id="kobo.970.2">
      I will be using the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.971.1">
       awsseccbadmin1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.972.1">
      user that we created in
     </span>
     <a href="B21384_01.xhtml#_idTextAnchor020">
      <span class="No-Break">
       <em class="italic">
        <span class="koboSpan" id="kobo.973.1">
         Chapter 1
        </span>
       </em>
      </span>
     </a>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.974.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.975.1">
      We can test the recipe using an
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.976.1">
       awsseccbuser1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.977.1">
      user with no assignments to our account,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.978.1">
       aws-sec-cookbook-1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.979.1">
      .
     </span>
     <span class="koboSpan" id="kobo.979.2">
      We may also assign the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.980.1">
       awsseccbadmin1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.981.1">
      user to another AWS account, say
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.982.1">
       awsseccb-sandbox-1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.983.1">
      , where the user does not already have any assignments with this permission set, and test
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.984.1">
       that assignment.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.985.1">
      We need to create a customer-managed IAM policy called
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.986.1">
       MyS3ListAllBucketsPolicy
      </span>
     </strong>
     <span class="koboSpan" id="kobo.987.1">
      following the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.988.1">
       Creating a customer-managed IAM policy from the AWS Management Console
      </span>
     </em>
     <span class="koboSpan" id="kobo.989.1">
      section of the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.990.1">
       Creating a customer-managed IAM policy
      </span>
     </em>
     <span class="koboSpan" id="kobo.991.1">
      recipe in this chapter, in all the accounts where we want to do the assignment.
     </span>
     <span class="koboSpan" id="kobo.991.2">
      As we are planning to make an assignment in the current
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.992.1">
       aws-sec-cookbook-1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.993.1">
      account itself, we need to create this policy within the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.994.1">
       aws-sec-cookbook-1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.995.1">
      account.
     </span>
     <span class="koboSpan" id="kobo.995.2">
      To make an assignment in the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.996.1">
       awsseccb-sandbox2
      </span>
     </strong>
     <span class="koboSpan" id="kobo.997.1">
      account, we need to create this policy within the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.998.1">
       awsseccb-sandbox2
      </span>
     </strong>
     <span class="koboSpan" id="kobo.999.1">
      account.
     </span>
     <span class="koboSpan" id="kobo.999.2">
      If you are following the recipes within this book, we had already created this in the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1000.1">
       awsseccb-sandbox-1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1001.1">
      account, and therefore, if we plan to assign the policy to that account, we do not have to create it again in that account.
     </span>
     <span class="koboSpan" id="kobo.1001.2">
      The policy JSON is included with the code files
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1002.1">
       as
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1003.1">
        s3-list-all-my-buckets-policy.json
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1004.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1005.1">
      An S3 bucket following the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.1006.1">
       Technical requirements
      </span>
     </em>
     <span class="koboSpan" id="kobo.1007.1">
      section of
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1008.1">
       this chapter.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1009.1">
      To execute the CLI commands, we need to configure a CLI profile using IAM Identity Center called
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1010.1">
       AWSSecCBAdmin1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1011.1">
      for the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1012.1">
       awsseccbadmin1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1013.1">
      user.
     </span>
     <span class="koboSpan" id="kobo.1013.2">
      After the customer-managed policy is assigned to the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1014.1">
       awsseccbuser1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1015.1">
      user for the same account, we will also need to configure a CLI profile called
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1016.1">
       AwsSecCbUser1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1017.1">
      for that user.
     </span>
     <span class="koboSpan" id="kobo.1017.2">
      It is important to note that CLI profiles must be configured for each user on a per-account, per-assignment basis, and it is a good practice to include the account name as part of the profile name.
     </span>
     <span class="koboSpan" id="kobo.1017.3">
      Therefore, if you want to assign
     </span>
     <a id="_idIndexMarker257">
     </a>
     <span class="koboSpan" id="kobo.1018.1">
      permissions for
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1019.1">
       awsseccbadmin1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1020.1">
      to another
     </span>
     <a id="_idIndexMarker258">
     </a>
     <span class="koboSpan" id="kobo.1021.1">
      account, say
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1022.1">
       awsseccb-sandbox-1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1023.1">
      , we can create a
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1024.1">
        Sandbox1Admin1
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1025.1">
       profile.
      </span>
     </span>
    </li>
   </ul>
   <h2 id="_idParaDest-59">
    <a id="_idTextAnchor060">
    </a>
    <span class="koboSpan" id="kobo.1026.1">
     How to do it...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1027.1">
     Initially, we will create a permission set from the Management Console and utilize it for assignment.
    </span>
    <span class="koboSpan" id="kobo.1027.2">
     Following that, we will replicate the process using the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1028.1">
      AWS CLI.
     </span>
    </span>
   </p>
   <h3>
    <span class="koboSpan" id="kobo.1029.1">
     Customer-managed IAM policy via the AWS Management Console
    </span>
   </h3>
   <p>
    <span class="koboSpan" id="kobo.1030.1">
     We will first create a permission set
    </span>
    <a id="_idIndexMarker259">
    </a>
    <span class="koboSpan" id="kobo.1031.1">
     with an existing IAM policy
    </span>
    <a id="_idIndexMarker260">
    </a>
    <span class="koboSpan" id="kobo.1032.1">
     and then assign it to an AWS account using that permission set.
    </span>
    <span class="koboSpan" id="kobo.1032.2">
     Let us
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1033.1">
      get started:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.1034.1">
      Log in to
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1035.1">
       aws-sec-cookbook-1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1036.1">
      as the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1037.1">
       awsseccbadmin1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1038.1">
      user and go to the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1039.1">
       IAM Identity
      </span>
     </strong>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1040.1">
        Center
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1041.1">
       dashboard.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1042.1">
      Change the Region to
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1043.1">
       us-east-1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1044.1">
      using the Region drop-down located
     </span>
     <a id="_idIndexMarker261">
     </a>
     <span class="koboSpan" id="kobo.1045.1">
      in the top-right corner of the screen
     </span>
     <a id="_idIndexMarker262">
     </a>
     <span class="koboSpan" id="kobo.1046.1">
      as we had configured the Region for IAM Identity Center as
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1047.1">
       us-east-1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1048.1">
      in the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.1049.1">
       User management and SSO with IAM Identity Center
      </span>
     </em>
     <span class="koboSpan" id="kobo.1050.1">
      recipe from
     </span>
     <a href="B21384_01.xhtml#_idTextAnchor020">
      <span class="No-Break">
       <em class="italic">
        <span class="koboSpan" id="kobo.1051.1">
         Chapter 1
        </span>
       </em>
      </span>
     </a>
     <span class="koboSpan" id="kobo.1052.1">
      .
     </span>
     <span class="koboSpan" id="kobo.1052.2">
      If you had selected a different Region, select that
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1053.1">
       Region instead.
      </span>
     </span>
    </li>
   </ol>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.1054.1">
     Important note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.1055.1">
     The AWS Organizations service permits the use of IAM Identity Center in just one AWS Region at any given time.
    </span>
    <span class="koboSpan" id="kobo.1055.2">
     If we wish to shift the IAM Identity Center to a different Region after setting it up in one Region, we need to first delete the existing configuration in the initially chosen Region and then set it up again in the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1056.1">
      new Region.
     </span>
    </span>
   </p>
   <ol>
    <li value="3">
     <span class="koboSpan" id="kobo.1057.1">
      Click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1058.1">
       Permission sets
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1059.1">
      from the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1060.1">
       left sidebar.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1061.1">
      On the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1062.1">
       Permission sets
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1063.1">
      page, click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1064.1">
       Create
      </span>
     </strong>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1065.1">
        permission set
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1066.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1067.1">
      In the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1068.1">
       Permission set type
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1069.1">
      page, select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1070.1">
       Custom permission set
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1071.1">
      and
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1072.1">
       click
      </span>
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1073.1">
        Next
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1074.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1075.1">
      In the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1076.1">
       Specify policies and permissions boundary
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1077.1">
      page, expand
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1078.1">
       Customer managed policies
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1079.1">
      , and click on
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1080.1">
        Attach policies
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1081.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1082.1">
      Enter the policy name as
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1083.1">
       MyS3ListAllBucketsPolicy
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1084.1">
      .
     </span>
     <span class="koboSpan" id="kobo.1084.2">
      If you gave a different name, provide that
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1085.1">
       name here.
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer055">
     <span class="koboSpan" id="kobo.1086.1">
      <img alt="Figure 2.12 – Selecting customer-managed IAM policy" src="image/B21384_02_12.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.1087.1">
     Figure 2.12 – Selecting customer-managed IAM policy
    </span>
   </p>
   <ol>
    <li value="8">
     <span class="koboSpan" id="kobo.1088.1">
      Scroll down and
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1089.1">
       click
      </span>
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1090.1">
        Next
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1091.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1092.1">
      In the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1093.1">
       Specify permission set details
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1094.1">
      page, give the value of
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1095.1">
       Permission set name
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1096.1">
      as
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1097.1">
       MyListAllBucketsPermission
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1098.1">
      , and
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1099.1">
       Description
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1100.1">
      as
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1101.1">
       My S3 List All Buckets Permission
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1102.1">
      , set
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1103.1">
       Session duration
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1104.1">
      as
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1105.1">
       1 hour
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1106.1">
      , leave values
     </span>
     <a id="_idIndexMarker263">
     </a>
     <span class="koboSpan" id="kobo.1107.1">
      for other fields
     </span>
     <a id="_idIndexMarker264">
     </a>
     <span class="koboSpan" id="kobo.1108.1">
      in the page empty, and click
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1109.1">
       Next
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1110.1">
      , which is located on the bottom-right of
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1111.1">
       the page.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1112.1">
      In the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1113.1">
       Review and create
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1114.1">
      page, review everything and click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1115.1">
       Create
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1116.1">
      .
     </span>
     <span class="koboSpan" id="kobo.1116.2">
      The new permission set should now appear on the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1117.1">
       Permission
      </span>
     </strong>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1118.1">
        sets
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1119.1">
       page.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1120.1">
      Assign the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1121.1">
       awsseccbuser1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1122.1">
      user (or a group that contains this user) to our
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1123.1">
       aws-sec-cookbook-1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1124.1">
      AWS account.
     </span>
     <span class="koboSpan" id="kobo.1124.2">
      Select the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1125.1">
       MyListAllBucketsPermission
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1126.1">
      permission set that we created earlier in this recipe.
     </span>
     <span class="koboSpan" id="kobo.1126.2">
      For detailed steps to assign permission sets, we can refer to the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.1127.1">
       User management and SSO with IAM Identity Center
      </span>
     </em>
     <span class="koboSpan" id="kobo.1128.1">
      recipe from
     </span>
     <a href="B21384_01.xhtml#_idTextAnchor020">
      <span class="No-Break">
       <em class="italic">
        <span class="koboSpan" id="kobo.1129.1">
         Chapter 1
        </span>
       </em>
      </span>
     </a>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1130.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1131.1">
      To verify the assignment, log into the AWS access portal as
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1132.1">
       awsseccbuser1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1133.1">
      using the AWS access portal URL of AWS Identity Center.
     </span>
     <span class="koboSpan" id="kobo.1133.2">
      We can get the URL from our
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1134.1">
       Identity Center
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1135.1">
      dashboard.
     </span>
     <span class="koboSpan" id="kobo.1135.2">
      It is also present in the invitation email sent to the user’s email when the user was created.
     </span>
     <span class="koboSpan" id="kobo.1135.3">
      We should now be able to see the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1136.1">
       aws-sec-cookbook-1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1137.1">
      account (or any other accounts we assigned to) after we log into the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1138.1">
       access portal.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1139.1">
      Log into the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1140.1">
       aws-sec-cookbook-1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1141.1">
      account from the access portal and go to the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1142.1">
       Amazon
      </span>
     </strong>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1143.1">
        S3
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1144.1">
       service.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1145.1">
      Click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1146.1">
       Buckets
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1147.1">
      from the left sidebar.
     </span>
     <span class="koboSpan" id="kobo.1147.2">
      We should be able to see all the buckets available in
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1148.1">
       the account.
      </span>
     </span>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.1149.1">
     We will now create a permission
    </span>
    <a id="_idIndexMarker265">
    </a>
    <span class="koboSpan" id="kobo.1150.1">
     set and assign
    </span>
    <a id="_idIndexMarker266">
    </a>
    <span class="koboSpan" id="kobo.1151.1">
     it to the AWS account using CLI.
    </span>
    <span class="koboSpan" id="kobo.1151.2">
     However, before moving forward, we should remove the assignment we made in this section as we will be doing the same assignment from the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1152.1">
      AWS CLI.
     </span>
    </span>
   </p>
   <h3>
    <span class="koboSpan" id="kobo.1153.1">
     Customer-managed IAM policy via the AWS CLI
    </span>
   </h3>
   <p>
    <span class="koboSpan" id="kobo.1154.1">
     In this section, we will first
    </span>
    <a id="_idIndexMarker267">
    </a>
    <span class="koboSpan" id="kobo.1155.1">
     create a permission set and then assign
    </span>
    <a id="_idIndexMarker268">
    </a>
    <span class="koboSpan" id="kobo.1156.1">
     a group that contains our user to an AWS account using that permission set.
    </span>
    <span class="koboSpan" id="kobo.1156.2">
     Let us
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1157.1">
      get started:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.1158.1">
      Configure CLI for the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1159.1">
       awsseccbadmin1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1160.1">
      user for the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1161.1">
       aws-sec-cookbook-1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1162.1">
      account with the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1163.1">
       AwsSecCbAdmin
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1164.1">
      profile name, and log in using that profile following the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.1165.1">
       User management and SSO with IAM Identity Center
      </span>
     </em>
     <span class="koboSpan" id="kobo.1166.1">
      recipe from
     </span>
     <a href="B21384_01.xhtml#_idTextAnchor020">
      <span class="No-Break">
       <em class="italic">
        <span class="koboSpan" id="kobo.1167.1">
         Chapter 1
        </span>
       </em>
      </span>
     </a>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1168.1">
       .
      </span>
     </span>
    </li>
   </ol>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.1169.1">
     Important note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.1170.1">
     As we learned in
    </span>
    <a href="B21384_01.xhtml#_idTextAnchor020">
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.1171.1">
        Chapter 1
       </span>
      </em>
     </span>
    </a>
    <span class="koboSpan" id="kobo.1172.1">
     , we can use the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1173.1">
      aws configure sso
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1174.1">
     command, which is primarily used to set up a profile initially using IAM Identity Center, which provides values for
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1175.1">
      sso_start_url
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1176.1">
     and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1177.1">
      sso_region
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1178.1">
     .
    </span>
    <span class="koboSpan" id="kobo.1178.2">
     This configuration is typically a one-time activity unless we need to change or update the profile’s settings.
    </span>
    <span class="koboSpan" id="kobo.1178.3">
     After that, we can utilize the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1179.1">
      aws sso login
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1180.1">
     command each time we want to start a session and use the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1181.1">
      aws sso logout
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1182.1">
     command to log out from
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1183.1">
      that session.
     </span>
    </span>
   </p>
   <ol>
    <li value="2">
     <span class="koboSpan" id="kobo.1184.1">
      Create a permission set using the
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1185.1">
        create-permission-set
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1186.1">
       command:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1187.1">aws sso-admin create-permission-set \</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1188.1">    --instance-arn &lt;Your-SSO-Instance-ARN&gt; \</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1189.1">    --name MyS3ListAllBucketsPermissionCLI \</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1190.1">    --description "S3 List All Buckets Permission" \</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1191.1">    --session-duration "PT1H" \</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1192.1">    --profile AwsSecCbAdmin</span></strong></pre>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.1193.1">
       We can get the value of
      </span>
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1194.1">
        &lt;Your-SSO-Instance-ARN&gt;
       </span>
      </strong>
      <span class="koboSpan" id="kobo.1195.1">
       from the
      </span>
      <strong class="bold">
       <span class="koboSpan" id="kobo.1196.1">
        Settings
       </span>
      </strong>
      <span class="koboSpan" id="kobo.1197.1">
       page within IAM Identity Center in the AWS
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.1198.1">
        Management Console.
       </span>
      </span>
     </p>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.1199.1">
       If the permission set is created successfully, we should get a response with the new permission set ARN like
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.1200.1">
        the following:
       </span>
      </span>
     </p>
    </li>
   </ol>
   <p class="IMG---Figure">
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer056">
     <span class="koboSpan" id="kobo.1201.1">
      <img alt="Figure 2.13 – Request and response for the create-permission-set subcommand" src="image/B21384_02_13.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.1202.1">
     Figure 2.13 – Request and response for the create-permission-set subcommand
    </span>
   </p>
   <ol>
    <li value="3">
     <span class="koboSpan" id="kobo.1203.1">
      Attach our customer-managed
     </span>
     <a id="_idIndexMarker269">
     </a>
     <span class="koboSpan" id="kobo.1204.1">
      policy to the permission
     </span>
     <a id="_idIndexMarker270">
     </a>
     <span class="koboSpan" id="kobo.1205.1">
      set using the
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1206.1">
        attach-customer-managed-policy-reference-to-permission-set
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1207.1">
       subcommand:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1208.1">aws sso-admin attach-customer-managed-policy-reference-to-permission-set \</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1209.1">    --instance-arn &lt;Your-SSO-Instance-ARN&gt; \</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1210.1">    --permission-set-arn &lt;Your-permission-set-ARN&gt; \</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1211.1">    --customer-managed-policy-reference Name=MyS3ListAllBucketsPolicy \</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1212.1">    --profile AwsSecCbAdmin</span></strong></pre>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.1213.1">
       For
      </span>
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1214.1">
        &lt;Your-permission-set-ARN&gt;
       </span>
      </strong>
      <span class="koboSpan" id="kobo.1215.1">
       , we need to use the permission set ARN we received from the previous command.
      </span>
      <span class="koboSpan" id="kobo.1215.2">
       This command gives us
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.1216.1">
        no response.
       </span>
      </span>
     </p>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1217.1">
      Assign the permission set
     </span>
     <a id="_idIndexMarker271">
     </a>
     <span class="koboSpan" id="kobo.1218.1">
      to our AWS account and group
     </span>
     <a id="_idIndexMarker272">
     </a>
     <span class="koboSpan" id="kobo.1219.1">
      using the
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1220.1">
        create-account-assignment
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1221.1">
       subcommand:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1222.1">aws sso-admin create-account-assignment \</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1223.1">    --instance-arn &lt;Your-SSO-Instance-ID&gt; \</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1224.1">    --permission-set-arn &lt;Your-Permission-Set-ARN&gt; \</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1225.1">    --target-id &lt;Target-Account-ID&gt; \</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1226.1">    --target-type AWS_ACCOUNT \</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1227.1">    --principal-id &lt;Your-Group-ID&gt; \</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1228.1">    --principal-type GROUP</span></strong></pre>
     <p class="list-inset">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1229.1">
        &lt;Target-Account-ID&gt;
       </span>
      </strong>
      <span class="koboSpan" id="kobo.1230.1">
       is the account ID of the account to which we want to make an assignment and
      </span>
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1231.1">
        &lt;Your-Group-ID&gt;
       </span>
      </strong>
      <span class="koboSpan" id="kobo.1232.1">
       is the ID of the group (not name), and both can be found within IAM Identity Center in the AWS Management Console.
      </span>
      <span class="koboSpan" id="kobo.1232.2">
       This command should immediately give a response with
      </span>
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1233.1">
        Status
       </span>
      </strong>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.1234.1">
        as
       </span>
      </span>
      <span class="No-Break">
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.1235.1">
         IN_PROGRESS
        </span>
       </strong>
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.1236.1">
        :
       </span>
      </span>
     </p>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer057">
     <span class="koboSpan" id="kobo.1237.1">
      <img alt="Figure 2.14 – Response for the create-account-assignment subcommand" src="image/B21384_02_14.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.1238.1">
     Figure 2.14 – Response for the create-account-assignment subcommand
    </span>
   </p>
   <ol>
    <li value="5">
     <span class="koboSpan" id="kobo.1239.1">
      Verify the assignment
     </span>
     <a id="_idIndexMarker273">
     </a>
     <span class="koboSpan" id="kobo.1240.1">
      using
     </span>
     <a id="_idIndexMarker274">
     </a>
     <span class="koboSpan" id="kobo.1241.1">
      the
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1242.1">
        list-account-assignments
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1243.1">
       subcommand:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1244.1">aws sso-admin list-account-assignments \</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1245.1">    --instance-arn &lt;Your-SSO-Instance-ARN&gt; \</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1246.1">    --account-id &lt;Assigned-Account-ID&gt; \</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1247.1">    --permission-set-arn &lt;Your-Permission-Set-ARN&gt; \</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1248.1">    --profile AwsSecCbAdmin</span></strong></pre>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.1249.1">
       This should give us a response with the
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.1250.1">
        assignment details:
       </span>
      </span>
     </p>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer058">
     <span class="koboSpan" id="kobo.1251.1">
      <img alt="Figure 2.15 – Response of the list-account-assignments subcommand" src="image/B21384_02_15.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.1252.1">
     Figure 2.15 – Response of the list-account-assignments subcommand
    </span>
   </p>
   <ol>
    <li value="6">
     <span class="koboSpan" id="kobo.1253.1">
      Configure a CLI profile called
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1254.1">
       AwsSecCbUser1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1255.1">
      for the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1256.1">
       awsseccbuser1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1257.1">
      user with a profile name of
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1258.1">
       AwsSecCbUser1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1259.1">
      and log in using that profile following the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.1260.1">
       User management and SSO with IAM Identity Center
      </span>
     </em>
     <span class="koboSpan" id="kobo.1261.1">
      recipe from
     </span>
     <a href="B21384_01.xhtml#_idTextAnchor020">
      <span class="No-Break">
       <em class="italic">
        <span class="koboSpan" id="kobo.1262.1">
         Chapter 1
        </span>
       </em>
      </span>
     </a>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1263.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1264.1">
      Next, verify access
     </span>
     <a id="_idIndexMarker275">
     </a>
     <span class="koboSpan" id="kobo.1265.1">
      by running
     </span>
     <a id="_idIndexMarker276">
     </a>
     <span class="koboSpan" id="kobo.1266.1">
      the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1267.1">
       aws s3
      </span>
     </strong>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1268.1">
        ls
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1269.1">
       command:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1270.1">aws s3 ls --profile AwsSecCbUser1</span></strong></pre>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.1271.1">
       This should list all the S3 buckets that
      </span>
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1272.1">
        awsseccb_user1
       </span>
      </strong>
      <span class="koboSpan" id="kobo.1273.1">
       has permissions to view, in line
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.1274.1">
        with
       </span>
      </span>
      <span class="No-Break">
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.1275.1">
         MyS3ListAllBucketsPolicy
        </span>
       </strong>
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.1276.1">
        :
       </span>
      </span>
     </p>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer059">
     <span class="koboSpan" id="kobo.1277.1">
      <img alt="Figure 2.16 – List all buckets after successful login" src="image/B21384_02_16.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.1278.1">
     Figure 2.16 – List all buckets after successful login
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1279.1">
     We completed the recipe from the management account of our AWS organization.
    </span>
    <span class="koboSpan" id="kobo.1279.2">
     We may also do this from a member account designated as a
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1280.1">
      delegated administrator.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-60">
    <a id="_idTextAnchor061">
    </a>
    <span class="koboSpan" id="kobo.1281.1">
     How it works...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1282.1">
     In this recipe, we learned
    </span>
    <a id="_idIndexMarker277">
    </a>
    <span class="koboSpan" id="kobo.1283.1">
     to create permission
    </span>
    <a id="_idIndexMarker278">
    </a>
    <span class="koboSpan" id="kobo.1284.1">
     sets based on a customer-managed policy that we had already created in the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.1285.1">
      Creating a customer-managed IAM policy
     </span>
    </em>
    <span class="koboSpan" id="kobo.1286.1">
     recipe from this chapter.
    </span>
    <span class="koboSpan" id="kobo.1286.2">
     In
    </span>
    <a href="B21384_01.xhtml#_idTextAnchor020">
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.1287.1">
        Chapter 1
       </span>
      </em>
     </span>
    </a>
    <span class="koboSpan" id="kobo.1288.1">
     , we delved into the AWS IAM Identity Center service and explored creating permission sets based on an
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1289.1">
      AWS-managed policy.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1290.1">
     We set
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1291.1">
      Region
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1292.1">
     as
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1293.1">
      us-east-1
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1294.1">
     , the same Region we configured when IAM Identity Center was created.
    </span>
    <span class="koboSpan" id="kobo.1294.2">
     The AWS Organizations service permits the use of IAM Identity Center in just one AWS Region at any given time.
    </span>
    <span class="koboSpan" id="kobo.1294.3">
     If we wish to shift IAM Identity Center to a different Region after setting it up in one, we need to first delete its existing configuration in the initially
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1295.1">
      chosen Region.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1296.1">
     In the AWS Management Console, we attached the customer-managed policy to the permission set during the permission set creation by specifying the name of the policy.
    </span>
    <span class="koboSpan" id="kobo.1296.2">
     In the command line, it was a two-step process.
    </span>
    <span class="koboSpan" id="kobo.1296.3">
     First, we created the permission set and then attached the customer-managed policy to the permission set.
    </span>
    <span class="koboSpan" id="kobo.1296.4">
     A policy with an identical name needs to be available in the member account where this permission set is assigned.
    </span>
    <span class="koboSpan" id="kobo.1296.5">
     The permission set can be created from the management account, or a member account designated as the IAM Identity Center delegated administrator.
    </span>
    <span class="koboSpan" id="kobo.1296.6">
     The customer-managed policy must reside in the member account receiving the permission set, not in the management or
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1297.1">
      administrator account.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1298.1">
     In the command line section of the recipe, we used two AWS CLI v2 command namespaces related to IAM Identity Center:
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1299.1">
      sso-admin
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1300.1">
     and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1301.1">
      sso
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1302.1">
     .
    </span>
    <span class="koboSpan" id="kobo.1302.2">
     We first used the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1303.1">
      aws configure sso
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1304.1">
     command to configure a CLI profile with values such as
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1305.1">
      sso_start_url
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1306.1">
     and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1307.1">
      sso_region
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1308.1">
     .
    </span>
    <span class="koboSpan" id="kobo.1308.2">
     This configuration is typically a one-time activity unless you need to change or update the profile’s settings.
    </span>
    <span class="koboSpan" id="kobo.1308.3">
     After that, we used the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1309.1">
      aws sso login
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1310.1">
     command, which we can use every time we want to
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1311.1">
      log in.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1312.1">
     The commands in the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1313.1">
      sso-admin
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1314.1">
     namespace help administrators manage the IAM Identity Center settings, such as assigning user groups to AWS accounts with specific permission sets or listing IAM Identity Center instances.
    </span>
    <span class="koboSpan" id="kobo.1314.2">
     On the other hand, the commands in the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1315.1">
      sso
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1316.1">
     namespace are designed for the end-user experience such as logging in and out of IAM Identity Center-enabled AWS accounts.
    </span>
    <span class="koboSpan" id="kobo.1316.2">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1317.1">
      sso
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1318.1">
     namespace commands authenticate through IAM Identity Center, making use of temporary AWS credentials without the need to enter the username and password again, thus making access to AWS services more secure
    </span>
    <a id="_idIndexMarker279">
    </a>
    <span class="koboSpan" id="kobo.1319.1">
     by eliminating the need
    </span>
    <a id="_idIndexMarker280">
    </a>
    <span class="koboSpan" id="kobo.1320.1">
     for managing
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1321.1">
      multiple credentials.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-61">
    <a id="_idTextAnchor062">
    </a>
    <span class="koboSpan" id="kobo.1322.1">
     There’s more...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1323.1">
     Although the AWS SSO service has been rebranded as AWS IAM Identity Center in the AWS Management Console, the CLI namespaces such as
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1324.1">
      sso-admin
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1325.1">
     and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1326.1">
      aws sso
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1327.1">
     remain unchanged to maintain
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1328.1">
      backward compatibility.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-62">
    <a id="_idTextAnchor063">
    </a>
    <span class="koboSpan" id="kobo.1329.1">
     See also
    </span>
   </h2>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.1330.1">
      We can find more details
     </span>
     <a id="_idIndexMarker281">
     </a>
     <span class="koboSpan" id="kobo.1331.1">
      about the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1332.1">
       sso-admin
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1333.1">
      namespace and its commands
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1334.1">
       at
      </span>
     </span>
     <a href="https://awscli.amazonaws.com/v2/documentation/api/latest/reference/sso-admin/index.html">
      <span class="No-Break">
       <span class="koboSpan" id="kobo.1335.1">
        https://awscli.amazonaws.com/v2/documentation/api/latest/reference/sso-admin/index.html
       </span>
      </span>
     </a>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1336.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1337.1">
      We can find more details
     </span>
     <a id="_idIndexMarker282">
     </a>
     <span class="koboSpan" id="kobo.1338.1">
      about the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1339.1">
       sso
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1340.1">
      namespace and its commands
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1341.1">
       at
      </span>
     </span>
     <a href="https://awscli.amazonaws.com/v2/documentation/api/latest/reference/sso/index.html">
      <span class="No-Break">
       <span class="koboSpan" id="kobo.1342.1">
        https://awscli.amazonaws.com/v2/documentation/api/latest/reference/sso/index.html
       </span>
      </span>
     </a>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1343.1">
       .
      </span>
     </span>
    </li>
   </ul>
   <h1 id="_idParaDest-63">
    <a id="_idTextAnchor064">
    </a>
    <span class="koboSpan" id="kobo.1344.1">
     Setting IAM permission boundaries for IAM entities
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.1345.1">
     This recipe demonstrates how to use
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1346.1">
      permissions boundaries
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1347.1">
     to set a maximum permission
    </span>
    <a id="_idIndexMarker283">
    </a>
    <span class="koboSpan" id="kobo.1348.1">
     limit for an IAM entity such as an IAM user or an IAM role.
    </span>
    <span class="koboSpan" id="kobo.1348.2">
     Initially, we will assign a user complete access to S3.
    </span>
    <span class="koboSpan" id="kobo.1348.3">
     Subsequently, we’ll apply a permission boundary to confine the user’s S3 permissions exclusively to read-only access.
    </span>
    <span class="koboSpan" id="kobo.1348.4">
     Similar to SCPs, permission boundaries do not grant permissions; they only define constraints.
    </span>
    <span class="koboSpan" id="kobo.1348.5">
     In other words, without an identity-based, resource-based, or session policy in place, actions permitted within the permission boundary or SCP cannot
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1349.1">
      be executed.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-64">
    <a id="_idTextAnchor065">
    </a>
    <span class="koboSpan" id="kobo.1350.1">
     Getting ready
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1351.1">
     We need the following to successfully complete
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1352.1">
      this recipe:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.1353.1">
      A working AWS account,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1354.1">
       awsseccb-sandbox-1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1355.1">
      , and a user with
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1356.1">
       AdministratorAccess
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1357.1">
      permission to that account,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1358.1">
       awsseccbadmin1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1359.1">
      , following the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.1360.1">
       Technical requirements
      </span>
     </em>
     <span class="koboSpan" id="kobo.1361.1">
      section of
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1362.1">
       this chapter.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1363.1">
      An IAM user,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1364.1">
       awsseccb_iam_user1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1365.1">
      , with
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1366.1">
       AmazonS3FullAccess
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1367.1">
      permission to the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1368.1">
       account,
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1369.1">
        awsseccb-sandbox-1
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1370.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1371.1">
      Understand how to create an Amazon
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1372.1">
       S3 bucket.
      </span>
     </span>
    </li>
   </ul>
   <h2 id="_idParaDest-65">
    <a id="_idTextAnchor066">
    </a>
    <span class="koboSpan" id="kobo.1373.1">
     How to do it...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1374.1">
     We can create a permission set
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1375.1">
      as follows:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.1376.1">
      Log into the AWS Management Console of
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1377.1">
       awsseccb-sandbox-1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1378.1">
      as
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1379.1">
       awsseccbadmin1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1380.1">
      and go to the
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1381.1">
        IAM
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1382.1">
       dashboard.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1383.1">
      Click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1384.1">
       Users
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1385.1">
      in the left sidebar and click on the name of the user to use for this recipe, which is
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1386.1">
       awsseccb_iam_user1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1387.1">
      in
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1388.1">
       our case.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1389.1">
      Scroll down to the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1390.1">
       Permissions boundary
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1391.1">
      section and click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1392.1">
       Set
      </span>
     </strong>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1393.1">
        permissions boundary
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1394.1">
       .
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer060">
     <span class="koboSpan" id="kobo.1395.1">
      <img alt="Figure 2.17 – Set permission boundary" src="image/B21384_02_17.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.1396.1">
     Figure 2.17 – Set permission boundary
    </span>
   </p>
   <ol>
    <li value="4">
     <span class="koboSpan" id="kobo.1397.1">
      Search for
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1398.1">
       AmazonS3ReadOnlyAcesss
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1399.1">
      , select it, and click on
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1400.1">
        Set boundary
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1401.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1402.1">
      Log into the AWS Management Console
     </span>
     <a id="_idIndexMarker284">
     </a>
     <span class="koboSpan" id="kobo.1403.1">
      of our account as the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1404.1">
       awsseccb_iam_user1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1405.1">
      user, go to the S3 service dashboard, and try to create a bucket with the default configuration.
     </span>
     <span class="koboSpan" id="kobo.1405.2">
      We should get an error message such as the following even if the user
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1406.1">
       has
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1407.1">
        AmazonS3FullPermission
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1408.1">
       .
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer061">
     <span class="koboSpan" id="kobo.1409.1">
      <img alt="Figure 2.18 – Failed to create bucket" src="image/B21384_02_18.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.1410.1">
     Figure 2.18 – Failed to create bucket
    </span>
   </p>
   <ol>
    <li value="6">
     <span class="koboSpan" id="kobo.1411.1">
      Log in to the account as
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1412.1">
       awsseccbadmin1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1413.1">
      , go to the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1414.1">
       awsseccb_iam_user1
      </span>
     </strong>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1415.1">
       Permissions boundary
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1416.1">
      section, and click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1417.1">
       Remove boundary
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1418.1">
      , as shown in the following figure.
     </span>
     <span class="koboSpan" id="kobo.1418.2">
      In the confirmation
     </span>
     <a id="_idIndexMarker285">
     </a>
     <span class="koboSpan" id="kobo.1419.1">
      dialog popup, click on
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1420.1">
        Remove boundary
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1421.1">
       .
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer062">
     <span class="koboSpan" id="kobo.1422.1">
      <img alt="Figure 2.19 – Remove permissions boundary" src="image/B21384_02_19.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.1423.1">
     Figure 2.19 – Remove permissions boundary
    </span>
   </p>
   <ol>
    <li value="7">
     <span class="koboSpan" id="kobo.1424.1">
      Log in to the AWS Management Console of our account as the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1425.1">
       awsseccb_iam_user1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1426.1">
      user, go to the S3 service dashboard, and try to create a bucket with the default configuration.
     </span>
     <span class="koboSpan" id="kobo.1426.2">
      We should be able to successfully create the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1427.1">
       bucket now.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1428.1">
      Log in to the Management Console as
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1429.1">
       awsseccbadmin1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1430.1">
      , go to the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1431.1">
       IAM
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1432.1">
      dashboard, and remove all existing permissions, directly assigned, or inherited.
     </span>
     <span class="koboSpan" id="kobo.1432.2">
      For inherited permissions from groups, this can be done by removing the user from all groups from the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1433.1">
       User groups membership
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1434.1">
      section under the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1435.1">
       Groups
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1436.1">
      tab.
     </span>
     <span class="koboSpan" id="kobo.1436.2">
      From the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1437.1">
       Users
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1438.1">
      pane, click on the name of our
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1439.1">
       awsseccb_iam_user1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1440.1">
      user, and go to the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1441.1">
       Groups
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1442.1">
      tab.
     </span>
     <span class="koboSpan" id="kobo.1442.2">
      Directly assigned permissions can be removed from the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1443.1">
       Permissions
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1444.1">
      tab.
     </span>
     <span class="koboSpan" id="kobo.1444.2">
      Verify that no permissions policies are attached to the user in the
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1445.1">
        Permissions
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1446.1">
       tab.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1447.1">
      Go to the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1448.1">
       Permissions boundary
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1449.1">
      section and click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1450.1">
       Set permissions boundary
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1451.1">
      , search for
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1452.1">
       AmazonS3FullAccess
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1453.1">
      , select it, and click on
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1454.1">
        Set boundary
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1455.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1456.1">
      Log into the AWS Management Console of our account as the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1457.1">
       awsseccb_iam_user1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1458.1">
      user, go to the S3 service dashboard, and try to create a bucket with the default configuration.
     </span>
     <span class="koboSpan" id="kobo.1458.2">
      We should get an error message like the one we got in
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.1459.1">
       Step 5
      </span>
     </em>
     <span class="koboSpan" id="kobo.1460.1">
      .
     </span>
     <span class="koboSpan" id="kobo.1460.2">
      This demonstrates that even if we allow permissions within the permission set, without an identity-based, resource-based, or session policy in place, actions permitted within the permission boundary are
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1461.1">
       not allowed.
      </span>
     </span>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.1462.1">
     You may remove the permissions boundary before proceeding with
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1463.1">
      further recipes.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-66">
    <a id="_idTextAnchor067">
    </a>
    <span class="koboSpan" id="kobo.1464.1">
     How it works...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1465.1">
     In AWS IAM, permission boundaries serve as a control mechanism to set the maximum permissions a user or group can have, regardless of any policies directly attached to them.
    </span>
    <span class="koboSpan" id="kobo.1465.2">
     By attaching a permission boundary to a user, we define the upper limit of their permissions.
    </span>
    <span class="koboSpan" id="kobo.1465.3">
     In the scenario described, the demo user initially inherits full S3 access permissions.
    </span>
    <span class="koboSpan" id="kobo.1465.4">
     However, when a permission boundary
    </span>
    <a id="_idIndexMarker286">
    </a>
    <span class="koboSpan" id="kobo.1466.1">
     policy, such as
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1467.1">
      AmazonS3ReadOnlyAccess
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1468.1">
     , is applied to the user, it restricts their S3 permissions to read-only access.
    </span>
    <span class="koboSpan" id="kobo.1468.2">
     When permission boundaries, SCPs, and identity-based policies are concurrently applied, an action is authorized only if it is explicitly allowed by all three components.
    </span>
    <span class="koboSpan" id="kobo.1468.3">
     In situations where only SCPs and a permissions boundary are in place without any identity-based or resource-based policies authorizing an action, the default outcome
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1469.1">
      is denial.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-67">
    <a id="_idTextAnchor068">
    </a>
    <span class="koboSpan" id="kobo.1470.1">
     There’s more...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1471.1">
     In situations where only SCPs and a permissions boundary are in place without any identity-based or resource-based policies authorizing an action, the default outcome
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1472.1">
      is denial.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-68">
    <a id="_idTextAnchor069">
    </a>
    <span class="koboSpan" id="kobo.1473.1">
     See also
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1474.1">
     We can read more about
    </span>
    <a id="_idIndexMarker287">
    </a>
    <span class="koboSpan" id="kobo.1475.1">
     permissions boundaries for IAM entities
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1476.1">
      at
     </span>
    </span>
    <a href="https://www.cloudericks.com/blog/getting-started-with-permissions-boundaries-in-aws">
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1477.1">
       https://www.cloudericks.com/blog/getting-started-with-permissions-boundaries-in-aws
      </span>
     </span>
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1478.1">
      .
     </span>
    </span>
   </p>
   <h1 id="_idParaDest-69">
    <a id="_idTextAnchor070">
    </a>
    <span class="koboSpan" id="kobo.1479.1">
     Centralizing governance in AWS Organizations with SCPs
    </span>
   </h1>
   <p>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1480.1">
      SCPs
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1481.1">
     in AWS allow us to manage permissions
    </span>
    <a id="_idIndexMarker288">
    </a>
    <span class="koboSpan" id="kobo.1482.1">
     across an entire
    </span>
    <a id="_idIndexMarker289">
    </a>
    <span class="koboSpan" id="kobo.1483.1">
     AWS organization,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1484.1">
      organizational units
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1485.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1486.1">
      OUs
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1487.1">
     ), or even individual accounts.
    </span>
    <span class="koboSpan" id="kobo.1487.2">
     SCPs fulfill the crucial need for centralized governance by allowing administrators
    </span>
    <a id="_idIndexMarker290">
    </a>
    <span class="koboSpan" id="kobo.1488.1">
     to implement consistent
    </span>
    <a id="_idIndexMarker291">
    </a>
    <span class="koboSpan" id="kobo.1489.1">
     compliance and security policies efficiently across multiple AWS accounts.
    </span>
    <span class="koboSpan" id="kobo.1489.2">
     By utilizing SCPs, organizations can enhance their security posture, manage risks more effectively, and ensure adherence to both internal policies and external regulatory requirements through a centralized policy management framework.
    </span>
    <span class="koboSpan" id="kobo.1489.3">
     In this recipe, we will use an SCP to restrict the creation of Amazon S3 buckets within a
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1490.1">
      specific Region.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-70">
    <a id="_idTextAnchor071">
    </a>
    <span class="koboSpan" id="kobo.1491.1">
     Getting ready
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1492.1">
     We need a working AWS account with AWS Organizations service enabled.
    </span>
    <span class="koboSpan" id="kobo.1492.2">
     I will be using the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1493.1">
      aws-sec-cookbook-1
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1494.1">
     account that we created in
    </span>
    <a href="B21384_01.xhtml#_idTextAnchor020">
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.1495.1">
        Chapter 1
       </span>
      </em>
     </span>
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1496.1">
      .
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-71">
    <a id="_idTextAnchor072">
    </a>
    <span class="koboSpan" id="kobo.1497.1">
     How to do it...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1498.1">
     We can explore SCPs
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1499.1">
      as follows:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.1500.1">
      Log in to the AWS Management Console
     </span>
     <a id="_idIndexMarker292">
     </a>
     <span class="koboSpan" id="kobo.1501.1">
      and navigate
     </span>
     <a id="_idIndexMarker293">
     </a>
     <span class="koboSpan" id="kobo.1502.1">
      to the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1503.1">
       AWS
      </span>
     </strong>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1504.1">
        Organizations
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1505.1">
       service.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1506.1">
      Click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1507.1">
       Policies
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1508.1">
      in the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1509.1">
       left sidebar.
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer063">
     <span class="koboSpan" id="kobo.1510.1">
      <img alt="Figure 2.20 – Policies dashboard" src="image/B21384_02_20.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.1511.1">
     Figure 2.20 – Policies dashboard
    </span>
   </p>
   <ol>
    <li value="3">
     <span class="koboSpan" id="kobo.1512.1">
      Click on the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1513.1">
       Service control policies
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1514.1">
      .
     </span>
     <span class="koboSpan" id="kobo.1514.2">
      If we are using SCPs for the first time, then click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1515.1">
       Enable service control policies
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1516.1">
      .
     </span>
     <span class="koboSpan" id="kobo.1516.2">
      In the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1517.1">
       Service control policies
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1518.1">
      pane, we can see that a policy called
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1519.1">
       FullAWSAccess
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1520.1">
      is
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1521.1">
       already present.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1522.1">
      In the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1523.1">
       Service control policies
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1524.1">
      pane, click on
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1525.1">
        Create policy
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1526.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1527.1">
      Enter
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1528.1">
       SandboxS3BucketCreate
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1529.1">
      for the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1530.1">
       Policy name
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1531.1">
      field and optionally enter
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1532.1">
       Sandbox S3 Bucket Create Policy
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1533.1">
      for the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1534.1">
       Policy description -
      </span>
     </strong>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1535.1">
        optional
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1536.1">
       field.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1537.1">
      Paste the given policy in the policy
     </span>
     <a id="_idIndexMarker294">
     </a>
     <span class="koboSpan" id="kobo.1538.1">
      section and then scroll down
     </span>
     <a id="_idIndexMarker295">
     </a>
     <span class="koboSpan" id="kobo.1539.1">
      and click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1540.1">
       Create policy
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1541.1">
      .
     </span>
     <span class="koboSpan" id="kobo.1541.2">
      The policy allows S3 bucket creation in any Region
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1542.1">
       except
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1543.1">
        us-east-1
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1544.1">
       .
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.1545.1">
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Sid": "Statement1",
      "Effect": "Deny",
      "Action": [
        "s3:CreateBucket"
      ],
      "Resource": [
        "*"
      ],
      "Condition": {
        "StringEquals": {
          "aws:RequestedRegion": "us-east-1"
        }
      }
    }
  ]
}</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1546.1">
      In the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1547.1">
       Service control policies
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1548.1">
      pane, select the policy we created, click on the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1549.1">
       Actions
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1550.1">
      dropdown, and then click on
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1551.1">
        Attach policy
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1552.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1553.1">
      Select the OU or account
     </span>
     <a id="_idIndexMarker296">
     </a>
     <span class="koboSpan" id="kobo.1554.1">
      to which we want
     </span>
     <a id="_idIndexMarker297">
     </a>
     <span class="koboSpan" id="kobo.1555.1">
      to attach the policy and then click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1556.1">
       Attach policy
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1557.1">
      .
     </span>
     <span class="koboSpan" id="kobo.1557.2">
      I have selected the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1558.1">
       awsseccb-sandbox-1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1559.1">
      account that I created in
     </span>
     <a href="B21384_01.xhtml#_idTextAnchor020">
      <span class="No-Break">
       <em class="italic">
        <span class="koboSpan" id="kobo.1560.1">
         Chapter 1
        </span>
       </em>
      </span>
     </a>
     <span class="koboSpan" id="kobo.1561.1">
      .
     </span>
     <span class="koboSpan" id="kobo.1561.2">
      We can select multiple OUs and accounts
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1562.1">
       as needed.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1563.1">
      Log in to the account we attached the policy to, which is
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1564.1">
       awsseccb-sandbox-1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1565.1">
      in my case, as a user with
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1566.1">
       AdministratorAccess
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1567.1">
      permission, and try to create an S3 bucket in the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1568.1">
       us-east-1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1569.1">
      Region.
     </span>
     <span class="koboSpan" id="kobo.1569.2">
      We should get an error message that we do not have the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1570.1">
       required permission.
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer064">
     <span class="koboSpan" id="kobo.1571.1">
      <img alt="Figure 2.21 – Insufficient permissions error" src="image/B21384_02_21.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.1572.1">
     Figure 2.21 – Insufficient permissions error
    </span>
   </p>
   <ol>
    <li value="10">
     <span class="koboSpan" id="kobo.1573.1">
      Create an S3 bucket in another Region, for instance,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1574.1">
       us-east-
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1575.1">
      2, and it should
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1576.1">
       be successful.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1577.1">
      To detach the policy, we can log
     </span>
     <a id="_idIndexMarker298">
     </a>
     <span class="koboSpan" id="kobo.1578.1">
      in to the management
     </span>
     <a id="_idIndexMarker299">
     </a>
     <span class="koboSpan" id="kobo.1579.1">
      account, navigate to the service control policy we created, go to the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1580.1">
       Targets
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1581.1">
      tab, select the account, and click
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1582.1">
       on
      </span>
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1583.1">
        Detach
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1584.1">
       .
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer065">
     <span class="koboSpan" id="kobo.1585.1">
      <img alt="Figure 2.22 – The Targets tab to detach policy from the account" src="image/B21384_02_22.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.1586.1">
     Figure 2.22 – The Targets tab to detach policy from the account
    </span>
   </p>
   <ol>
    <li value="12">
     <span class="koboSpan" id="kobo.1587.1">
      Once you detach the policy, navigate back to our test account,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1588.1">
       awsseccb-sandbox-1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1589.1">
      in my case, and try to create an S3 bucket in the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1590.1">
       us-east-1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1591.1">
      Region.
     </span>
     <span class="koboSpan" id="kobo.1591.2">
      This time we should be able to create
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1592.1">
       the bucket.
      </span>
     </span>
    </li>
   </ol>
   <h2 id="_idParaDest-72">
    <a id="_idTextAnchor073">
    </a>
    <span class="koboSpan" id="kobo.1593.1">
     How it works...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1594.1">
     We used an SCP to restrict S3 bucket creation
    </span>
    <a id="_idIndexMarker300">
    </a>
    <span class="koboSpan" id="kobo.1595.1">
     in a specific Region by defining a
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1596.1">
      Deny
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1597.1">
     statement within the SCP targeting
    </span>
    <a id="_idIndexMarker301">
    </a>
    <span class="koboSpan" id="kobo.1598.1">
     the action of creating S3 buckets (
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1599.1">
      s3:CreateBucket
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1600.1">
     ) and associating it with a condition that checks whether the requested Region is the one to be restricted (e.g.,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1601.1">
      us-east-1
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1602.1">
     ).
    </span>
    <span class="koboSpan" id="kobo.1602.2">
     This approach ensures centralized control and governance over S3 bucket deployments, enabling organizations to enforce regional compliance standards, enhance security posture, and optimize resource utilization within their
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1603.1">
      AWS environment.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1604.1">
     SCPs are disabled by default, but we can enable them.
    </span>
    <span class="koboSpan" id="kobo.1604.2">
     SCPs, if enabled, need to explicitly allow services and actions that are allowed.
    </span>
    <span class="koboSpan" id="kobo.1604.3">
     When we enable SCPs, AWS attaches an SCP called
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1605.1">
      FullAWSAccess
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1606.1">
     to all accounts and OUs within that organization.
    </span>
    <span class="koboSpan" id="kobo.1606.2">
     This SCP allows every action and service.
    </span>
    <span class="koboSpan" id="kobo.1606.3">
     We can then create additional SCPs to deny services or actions and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1607.1">
      Deny
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1608.1">
     always takes precedence.
    </span>
    <span class="koboSpan" id="kobo.1608.2">
     This is the default strategy.
    </span>
    <span class="koboSpan" id="kobo.1608.3">
     With this strategy, we do not have to do anything when new services or actions are introduced by AWS as they are allowed by the
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1609.1">
       FullAWSAccess
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1610.1">
      SCP.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1611.1">
     We may also replace the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1612.1">
      FullAWSAccess
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1613.1">
     SCP with another SCP that allows only a specific set of services and features.
    </span>
    <span class="koboSpan" id="kobo.1613.2">
     If we do this, we must explicitly add any new services or actions that AWS introduces later to this SCP.
    </span>
    <span class="koboSpan" id="kobo.1613.3">
     However, if we follow the strategy discussed in the previous point, which is having the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1614.1">
      FullAWSAccess
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1615.1">
     SCP and adding another SCP with the list of services and actions to deny, we do not have to do anything when new services or actions are introduced
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1616.1">
      by AWS.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1617.1">
     If SCPs are enabled, every account, root OU, and other OUs need to have at least one SCP attached.
    </span>
    <span class="koboSpan" id="kobo.1617.2">
     Therefore, if we need to replace the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1618.1">
      FullAWSAccess
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1619.1">
     SCP with another, we need to first create and attach another SCP, and then detach the
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1620.1">
       FullAWSAccess
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1621.1">
      SCP.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-73">
    <a id="_idTextAnchor074">
    </a>
    <span class="koboSpan" id="kobo.1622.1">
     There’s more...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1623.1">
     SCPs, similar to permission boundaries in IAM, define the maximum permissions an entity may hold but do not grant permissions on their own.
    </span>
    <span class="koboSpan" id="kobo.1623.2">
     Therefore, when permission boundaries, SCPs, and identity-based policies are concurrently applied, an action is authorized only if it’s explicitly allowed by all three components.
    </span>
    <span class="koboSpan" id="kobo.1623.3">
     Additionally, in situations where only SCPs and a permissions boundary are in place without any identity-based or resource-based policies authorizing an action, the default outcome is denial.
    </span>
    <span class="koboSpan" id="kobo.1623.4">
     This underlines the principle that permissions must be explicitly granted, and in the absence of such explicit permissions, access is not permitted.
    </span>
    <span class="koboSpan" id="kobo.1623.5">
     We discussed policy types earlier in
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1624.1">
      this chapter.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-74">
    <a id="_idTextAnchor075">
    </a>
    <span class="koboSpan" id="kobo.1625.1">
     See also
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1626.1">
     We can read more about
    </span>
    <a id="_idIndexMarker302">
    </a>
    <span class="koboSpan" id="kobo.1627.1">
     service control policy examples
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1628.1">
      here:
     </span>
    </span>
    <a href="https://www.cloudericks.com/blog/understanding-aws-scps-and-the-deny-list-and-allow-list-strategies">
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1629.1">
       https://www.cloudericks.com/blog/understanding-aws-scps-and-the-deny-list-and-allow-list-strategies
      </span>
     </span>
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1630.1">
      .
     </span>
    </span>
   </p>
   <h1 id="_idParaDest-75">
    <a id="_idTextAnchor076">
    </a>
    <span class="koboSpan" id="kobo.1631.1">
     IAM cross-account role switching and identity account architecture
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.1632.1">
     Many organizations use multiple AWS accounts
    </span>
    <a id="_idIndexMarker303">
    </a>
    <span class="koboSpan" id="kobo.1633.1">
     to distinctly manage
    </span>
    <a id="_idIndexMarker304">
    </a>
    <span class="koboSpan" id="kobo.1634.1">
     different operational environments, such as development, testing, and production.
    </span>
    <span class="koboSpan" id="kobo.1634.2">
     Users with varied job roles may need diverse access privileges across these environments.
    </span>
    <span class="koboSpan" id="kobo.1634.3">
     However, the task of managing multiple IAM users, each having different access credentials across various AWS accounts, can be complex and
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1635.1">
      time consuming.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1636.1">
     A role in AWS IAM grants a specific set of permissions, much like a user account.
    </span>
    <span class="koboSpan" id="kobo.1636.2">
     Unlike users, we do not directly log in to roles; instead, we can switch to a role either in our own account or another AWS account.
    </span>
    <span class="koboSpan" id="kobo.1636.3">
     This replaces our original permissions with the role’s permissions.
    </span>
    <span class="koboSpan" id="kobo.1636.4">
     Based on how the role switch happens, two primary strategies are often utilized to streamline user access management across multiple AWS accounts, negating the need for individual IAM users and access credentials for
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1637.1">
      each account.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1638.1">
     The first approach for role switching involves SSO, where users authenticate via a central access portal and are granted access to multiple accounts, each with distinct roles and permissions.
    </span>
    <span class="koboSpan" id="kobo.1638.2">
     In this model, the role switching happens automatically.
    </span>
    <span class="koboSpan" id="kobo.1638.3">
     The second approach for role switching leverages the identity account architecture where users log in to an identity or central account and use the AWS switch role feature to access resources across various accounts, each assigned specific roles
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1639.1">
      and permissions.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1640.1">
     After AWS rebranded AWS SSO as IAM Identity Center, AWS recommends using the IAM Identity Center service as a best practice over using IAM directly.
    </span>
    <span class="koboSpan" id="kobo.1640.2">
     Therefore, the first approach using SSO with IAM Identity Center is preferred today for managing multiple accounts.
    </span>
    <span class="koboSpan" id="kobo.1640.3">
     However, many, especially smaller, organizations, who do not want the overhead of maintaining the AWS Organizations service, still use the switch role feature extensively.
    </span>
    <span class="koboSpan" id="kobo.1640.4">
     We can use the switch role feature in conjunction with IAM Identity Center, and this compatibility facilitates a seamless shift from the traditional approach of using IAM users with the identity account architecture to employing IAM
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1641.1">
      Identity Center.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1642.1">
     In this recipe, we will learn to implement the second
    </span>
    <a id="_idIndexMarker305">
    </a>
    <span class="koboSpan" id="kobo.1643.1">
     approach that uses the identity
    </span>
    <a id="_idIndexMarker306">
    </a>
    <span class="koboSpan" id="kobo.1644.1">
     account architecture, making use of the switch role feature that will allow the switching of roles from a source account to a destination account.
    </span>
    <span class="koboSpan" id="kobo.1644.2">
     The first approach
    </span>
    <a id="_idIndexMarker307">
    </a>
    <span class="koboSpan" id="kobo.1645.1">
     of using IAM Identity Center (previously known as AWS SSO) was explored in the recipes in
    </span>
    <a href="B21384_01.xhtml#_idTextAnchor020">
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.1646.1">
        Chapter 1
       </span>
      </em>
     </span>
    </a>
    <span class="koboSpan" id="kobo.1647.1">
     and the earlier recipes in
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1648.1">
      this chapter.
     </span>
    </span>
   </p>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.1649.1">
     Important note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.1650.1">
     Switching roles can be performed by an IAM user, a user in the IAM Identity Center, a SAML-federated role, or even a web-identity federated role.
    </span>
    <span class="koboSpan" id="kobo.1650.2">
     However, switching roles is not permissible for the AWS account
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1651.1">
      root user.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1652.1">
     In AWS Organizations, an all-access role featuring a trust policy is automatically established in member accounts.
    </span>
    <span class="koboSpan" id="kobo.1652.2">
     This role facilitates the management account in switching roles to any member account created within AWS Organizations.
    </span>
    <span class="koboSpan" id="kobo.1652.3">
     Therefore, administrators intending to switch roles between a management and a member account in AWS Organizations can skip the setting up sections in this recipe.
    </span>
    <span class="koboSpan" id="kobo.1652.4">
     They can directly proceed to the sections
    </span>
    <a id="_idIndexMarker308">
    </a>
    <span class="koboSpan" id="kobo.1653.1">
     on switching roles, utilizing the role configured
    </span>
    <a id="_idIndexMarker309">
    </a>
    <span class="koboSpan" id="kobo.1654.1">
     during the AWS Organizations setup, as demonstrated in the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.1655.1">
      Multi-account management with AWS Organizations
     </span>
    </em>
    <span class="koboSpan" id="kobo.1656.1">
     recipe from
    </span>
    <a href="B21384_01.xhtml#_idTextAnchor020">
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.1657.1">
        Chapter 1
       </span>
      </em>
     </span>
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1658.1">
      .
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-76">
    <a id="_idTextAnchor077">
    </a>
    <span class="koboSpan" id="kobo.1659.1">
     Getting ready
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1660.1">
     We need the following to successfully complete
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1661.1">
      this recipe:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.1662.1">
      Two AWS accounts, one as the source account and the other as the destination account.
     </span>
     <span class="koboSpan" id="kobo.1662.2">
      These could be standalone accounts or ones that are part of an AWS organization.
     </span>
     <span class="koboSpan" id="kobo.1662.3">
      We can use the two member accounts we created in the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.1663.1">
       Multi-account management with AWS Organizations
      </span>
     </em>
     <span class="koboSpan" id="kobo.1664.1">
      recipe from
     </span>
     <a href="B21384_01.xhtml#_idTextAnchor020">
      <span class="No-Break">
       <em class="italic">
        <span class="koboSpan" id="kobo.1665.1">
         Chapter 1
        </span>
       </em>
      </span>
     </a>
     <span class="koboSpan" id="kobo.1666.1">
      , namely,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1667.1">
       awsseccb-sandbox-1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1668.1">
      as the source account and
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1669.1">
       awsseccb-sandbox-2
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1670.1">
      as the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1671.1">
       destination account.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1672.1">
      A user with administrative permissions is required in both the source and destination accounts to create roles and policies.
     </span>
     <span class="koboSpan" id="kobo.1672.2">
      Using IAM Identity Center, we can create a single user,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1673.1">
       awsseccbadmin1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1674.1">
      , and grant it
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1675.1">
       AdministratorAccess
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1676.1">
      permission to both accounts.
     </span>
     <span class="koboSpan" id="kobo.1676.2">
      If opting for traditional IAM, a separate user must be created in each account with
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1677.1">
       this permission.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1678.1">
      An IAM user named
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1679.1">
       awsseccb_iam_user1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1680.1">
      in the source account,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1681.1">
       awsseccb-sandbox-1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1682.1">
      in our case, with no permission or with the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1683.1">
       IAMUserChangePassword
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1684.1">
      permission if you selected the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1685.1">
       Users must create a new password at next sign-in - Recommended
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1686.1">
      option.
     </span>
     <span class="koboSpan" id="kobo.1686.2">
      We could also use IAM Identity Center.
     </span>
     <span class="koboSpan" id="kobo.1686.3">
      However, using IAM Identity Center may be considered redundant here as we can use the access portal with IAM Identity Center to log into multiple AWS accounts without the need to use the account switching functionality.
     </span>
     <span class="koboSpan" id="kobo.1686.4">
      Nevertheless, we can do that and to understand the concepts better, you may try that option
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1687.1">
       as well.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1688.1">
      An S3 bucket following the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.1689.1">
       Technical requirements
      </span>
     </em>
     <span class="koboSpan" id="kobo.1690.1">
      section of
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1691.1">
       this chapter.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1692.1">
      To execute the steps in sections related to the AWS CLI, we need to set up two AWS CLI profiles for the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1693.1">
       awsseccbadmin1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1694.1">
      admin user.
     </span>
     <span class="koboSpan" id="kobo.1694.2">
      First,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1695.1">
       AWSSecCBAdmin1D
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1696.1">
      for the destination account and second,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1697.1">
       AWSSecCBAdmin1S
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1698.1">
      for the source account.
     </span>
     <span class="koboSpan" id="kobo.1698.2">
      Additionally, we need a profile named
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1699.1">
       AWSSecCBUser1S
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1700.1">
      for the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1701.1">
       awsseccbuser1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1702.1">
      user in the source account.
     </span>
     <span class="koboSpan" id="kobo.1702.2">
      With regular IAM, users need AWS CLI profiles per user per account.
     </span>
     <span class="koboSpan" id="kobo.1702.3">
      With IAM Identity Center, users need AWS CLI profile per user per role (
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1703.1">
       PermissionSet
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1704.1">
      )
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1705.1">
       per account.
      </span>
     </span>
    </li>
   </ul>
   <h2 id="_idParaDest-77">
    <a id="_idTextAnchor078">
    </a>
    <span class="koboSpan" id="kobo.1706.1">
     How to do it...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1707.1">
     To switch roles, the destination
    </span>
    <a id="_idIndexMarker310">
    </a>
    <span class="koboSpan" id="kobo.1708.1">
     account must have an assignable role with
    </span>
    <a id="_idIndexMarker311">
    </a>
    <span class="koboSpan" id="kobo.1709.1">
     a trust policy that enables the source account to assume this role.
    </span>
    <span class="koboSpan" id="kobo.1709.2">
     Additionally, the source account needs a policy that authorizes this switch.
    </span>
    <span class="koboSpan" id="kobo.1709.3">
     We will first configure the destination and the source account from the AWS Management Console.
    </span>
    <span class="koboSpan" id="kobo.1709.4">
     We will also achieve this using the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1710.1">
      AWS CLI.
     </span>
    </span>
   </p>
   <h3>
    <span class="koboSpan" id="kobo.1711.1">
     Setting up a destination account via AWS Management Console
    </span>
   </h3>
   <p>
    <span class="koboSpan" id="kobo.1712.1">
     In the destination
    </span>
    <a id="_idIndexMarker312">
    </a>
    <span class="koboSpan" id="kobo.1713.1">
     account, we need a role
    </span>
    <a id="_idIndexMarker313">
    </a>
    <span class="koboSpan" id="kobo.1714.1">
     along with a trust policy that allows the source account to assume this role.
    </span>
    <span class="koboSpan" id="kobo.1714.2">
     We will create a role with an existing permissions policy and specify the source account ID for the trust relationship.
    </span>
    <span class="koboSpan" id="kobo.1714.3">
     Let us
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1715.1">
      get started:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.1716.1">
      Log into the AWS Management Console of the destination account, say
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1717.1">
       awsseccb-sandbox-2
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1718.1">
      , as the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1719.1">
       awsseccbadmin1
      </span>
     </strong>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1720.1">
       admin user.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1721.1">
      Go to the
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1722.1">
        IAM
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1723.1">
       dashboard.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1724.1">
      Click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1725.1">
       Roles
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1726.1">
      from the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1727.1">
       left sidebar.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1728.1">
      Click on
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1729.1">
        Create role
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1730.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1731.1">
      In the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1732.1">
       Select trusted entity
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1733.1">
      page, under
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1734.1">
       Trusted entity type
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1735.1">
      , select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1736.1">
       AWS account
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1737.1">
      as shown
     </span>
     <a id="_idIndexMarker314">
     </a>
     <span class="koboSpan" id="kobo.1738.1">
      in the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1739.1">
       following
      </span>
     </span>
     <span class="No-Break">
      <a id="_idIndexMarker315">
      </a>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1740.1">
       figure.
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer066">
     <span class="koboSpan" id="kobo.1741.1">
      <img alt="Figure 2.23 – Selecting trusted entity type for a role" src="image/B21384_02_23.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.1742.1">
     Figure 2.23 – Selecting trusted entity type for a role
    </span>
   </p>
   <ol>
    <li value="6">
     <span class="koboSpan" id="kobo.1743.1">
      Scroll down, select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1744.1">
       Another AWS Account
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1745.1">
      , enter the 12-digit
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1746.1">
       Account ID
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1747.1">
      of the source account (in my case, it will be the ID of the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1748.1">
       awsseccb-sandbox-1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1749.1">
      account), and click
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1750.1">
       Next
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1751.1">
      in the bottom-right corner of
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1752.1">
       the page.
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer067">
     <span class="koboSpan" id="kobo.1753.1">
      <img alt="Figure 2.24 – Configuring Account ID of source account" src="image/B21384_02_24.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.1754.1">
     Figure 2.24 – Configuring Account ID of source account
    </span>
   </p>
   <ol>
    <li value="7">
     <span class="koboSpan" id="kobo.1755.1">
      In the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1756.1">
       Add permissions
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1757.1">
      page, search for
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1758.1">
       S3
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1759.1">
      , select
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1760.1">
       AmazonS3ReadOnlyAccess
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1761.1">
      , and click
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1762.1">
       Next
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1763.1">
      in the bottom-right corner of
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1764.1">
       the page.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1765.1">
      In the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1766.1">
       Name, review, and create
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1767.1">
      page, enter
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1768.1">
       SA-S3ReadOnly
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1769.1">
      in the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1770.1">
       Role name
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1771.1">
      field and
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1772.1">
       Amazon S3 Read Only Access Role
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1773.1">
      in the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1774.1">
       Description
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1775.1">
      field.
     </span>
     <span class="koboSpan" id="kobo.1775.2">
      I have given
     </span>
     <a id="_idIndexMarker316">
     </a>
     <span class="koboSpan" id="kobo.1776.1">
      a prefix of
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1777.1">
       SA
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1778.1">
      to denote
     </span>
     <a id="_idIndexMarker317">
     </a>
     <span class="koboSpan" id="kobo.1779.1">
      that this is a switch
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1780.1">
       account role.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1781.1">
      Review the role details and click
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1782.1">
       Create role
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1783.1">
      in the bottom-right corner of
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1784.1">
       the page.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1785.1">
      Once we see a success message that says
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1786.1">
       Role SA-S3ReadOnly created
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1787.1">
      , click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1788.1">
       View role
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1789.1">
      , make note
     </span>
     <a id="_idIndexMarker318">
     </a>
     <span class="koboSpan" id="kobo.1790.1">
      of the role’s ARN, and
     </span>
     <a id="_idIndexMarker319">
     </a>
     <span class="koboSpan" id="kobo.1791.1">
      select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1792.1">
       Link to switch roles
      </span>
     </strong>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1793.1">
        in console
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1794.1">
       .
      </span>
     </span>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.1795.1">
     Next, we will create an IAM policy in the source account to grant users in the source account the ability to assume the newly
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1796.1">
      created role.
     </span>
    </span>
   </p>
   <h3>
    <span class="koboSpan" id="kobo.1797.1">
     Setting up source account via the AWS Management Console
    </span>
   </h3>
   <p>
    <span class="koboSpan" id="kobo.1798.1">
     When administrators
    </span>
    <a id="_idIndexMarker320">
    </a>
    <span class="koboSpan" id="kobo.1799.1">
     in the source account
    </span>
    <a id="_idIndexMarker321">
    </a>
    <span class="koboSpan" id="kobo.1800.1">
     are switching roles, only the creation of the role with a trust policy in the destination account is necessary.
    </span>
    <span class="koboSpan" id="kobo.1800.2">
     There is no requirement for a policy creation or attachment in the source account, as administrators already have the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1801.1">
      sts:AssumeRole
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1802.1">
     permission.
    </span>
    <span class="koboSpan" id="kobo.1802.2">
     Therefore, if we are an administrator in the source account, we can skip the setting up section for the source account in
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1803.1">
      this recipe.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1804.1">
     We can create the required IAM policy in the source account
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1805.1">
      as follows:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.1806.1">
      Log in to the AWS Management Console of the source account (
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1807.1">
       awsseccb-sandbox-1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1808.1">
      in my case), as the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1809.1">
       awsseccbadmin1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1810.1">
      admin user and go to the
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1811.1">
        IAM
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1812.1">
       dashboard.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1813.1">
      Click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1814.1">
       Policies
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1815.1">
      from the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1816.1">
       left sidebar.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1817.1">
      Click on
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1818.1">
        Create policy
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1819.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1820.1">
      Click on the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1821.1">
       JSON
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1822.1">
      tab and then paste
     </span>
     <a id="_idIndexMarker322">
     </a>
     <span class="koboSpan" id="kobo.1823.1">
      the following policy JSON in the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1824.1">
       policy editor
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1825.1">
      .
     </span>
     <span class="koboSpan" id="kobo.1825.2">
      Remember to replace
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1826.1">
       arn:aws:iam::DESTINATION_ACCOUNT_ID:role/ROLE_NAME
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1827.1">
      with the role’s ARN that we noted in the previous section.
     </span>
     <span class="koboSpan" id="kobo.1827.2">
      Alternatively, we can just replace
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1828.1">
       DESTINATION_ACCOUNT_ID
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1829.1">
      with the destination account’s ID and
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1830.1">
       ROLE_NAME
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1831.1">
      with the role name we created in the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1832.1">
       previous section:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1833.1">{</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1834.1">    "Version": "2012-10-17",</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1835.1">    "Statement": {</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1836.1">      "Effect": "Allow",</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1837.1">      "Action": "sts:AssumeRole",</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1838.1">      "Resource": "arn:aws:iam::DESTINATION_ACCOUNT_ID:role/ROLE_NAME"</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1839.1">    }</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1840.1">}</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1841.1">
      Click
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1842.1">
       Next
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1843.1">
      in the bottom-right corner of
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1844.1">
       the page.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1845.1">
      In the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1846.1">
       Review and create
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1847.1">
      page, enter
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1848.1">
       AR_Sandbox2_S3ReadOnly
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1849.1">
      in the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1850.1">
       Policy name
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1851.1">
      field, and enter
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1852.1">
       AssumeRole policy for S3ReadOnlyAccess in awsseccb-sandbox-2
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1853.1">
      in the
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1854.1">
        Description
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1855.1">
       field.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1856.1">
      Review the details
     </span>
     <a id="_idIndexMarker323">
     </a>
     <span class="koboSpan" id="kobo.1857.1">
      and click
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1858.1">
       Create policy
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1859.1">
      in the bottom-right corner
     </span>
     <a id="_idIndexMarker324">
     </a>
     <span class="koboSpan" id="kobo.1860.1">
      of the page.
     </span>
     <span class="koboSpan" id="kobo.1860.2">
      We should get a
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1861.1">
       Policy AR_Sandbox2_S3ReadOnly
      </span>
     </strong>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1862.1">
        created
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1863.1">
       message.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1864.1">
      Attach this policy to the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1865.1">
       awsseccbusers
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1866.1">
      group in the source account that has the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1867.1">
       awsseccbuser1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1868.1">
      user.
     </span>
     <span class="koboSpan" id="kobo.1868.2">
      With IAM, we can directly attach the policy to the group in the source account.
     </span>
     <span class="koboSpan" id="kobo.1868.3">
      With IAM Identity Center, we must first create a permission set with this policy and assign it to the group during the assignment of the source account as we saw in
     </span>
     <a href="B21384_01.xhtml#_idTextAnchor020">
      <span class="No-Break">
       <em class="italic">
        <span class="koboSpan" id="kobo.1869.1">
         Chapter 1
        </span>
       </em>
      </span>
     </a>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1870.1">
       .
      </span>
     </span>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.1871.1">
     Next, we will switch roles from the source account to the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1872.1">
      destination account.
     </span>
    </span>
   </p>
   <h3>
    <span class="koboSpan" id="kobo.1873.1">
     Switching roles via the AWS Management Console
    </span>
   </h3>
   <p>
    <span class="koboSpan" id="kobo.1874.1">
     For switching roles
    </span>
    <a id="_idIndexMarker325">
    </a>
    <span class="koboSpan" id="kobo.1875.1">
     from the source account
    </span>
    <a id="_idIndexMarker326">
    </a>
    <span class="koboSpan" id="kobo.1876.1">
     to the destination account, follow
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1877.1">
      these steps:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.1878.1">
      Log into the AWS Management Console of the source account, say
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1879.1">
       awsseccb-sandbox-1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1880.1">
      , as the user who was assigned the permission to switch roles, say
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1881.1">
       awsseccb_iam_user1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1882.1">
      .
     </span>
     <span class="koboSpan" id="kobo.1882.2">
      If we are logging in via the AWS IAM Identity Center access portal, we need to make sure we select the role for the source account with the
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1883.1">
        AssumeRole
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1884.1">
       policy.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1885.1">
      Click on the drop-down menu next to the username and click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1886.1">
       Switch role
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1887.1">
      as shown in the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1888.1">
       following figure:
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer068">
     <span class="koboSpan" id="kobo.1889.1">
      <img alt="Figure 2.25 – User menu with the Switch role button" src="image/B21384_02_25.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.1890.1">
     Figure 2.25 – User menu with the Switch role button
    </span>
   </p>
   <p class="list-inset">
    <span class="koboSpan" id="kobo.1891.1">
     Here, I am switching
    </span>
    <a id="_idIndexMarker327">
    </a>
    <span class="koboSpan" id="kobo.1892.1">
     roles for the second time
    </span>
    <a id="_idIndexMarker328">
    </a>
    <span class="koboSpan" id="kobo.1893.1">
     to show the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1894.1">
      Role history
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1895.1">
     details.
    </span>
    <span class="koboSpan" id="kobo.1895.2">
     On your first attempt, you will not see the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1896.1">
      Role
     </span>
    </strong>
    <span class="No-Break">
     <strong class="bold">
      <span class="koboSpan" id="kobo.1897.1">
       history
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1898.1">
      details.
     </span>
    </span>
   </p>
   <ol>
    <li value="3">
     <span class="koboSpan" id="kobo.1899.1">
      On the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1900.1">
       Switch Role
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1901.1">
      screen, for
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1902.1">
       Account
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1903.1">
      , enter the account number of the destination account and for
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1904.1">
       IAM role name
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1905.1">
      ,
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1906.1">
       enter
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1907.1">
        SA-S3ReadOnly
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1908.1">
       .
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer069">
     <span class="koboSpan" id="kobo.1909.1">
      <img alt="Figure 2.26 – The Switch Role screen" src="image/B21384_02_26.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.1910.1">
     Figure 2.26 – The Switch Role screen
    </span>
   </p>
   <p class="list-inset">
    <span class="koboSpan" id="kobo.1911.1">
     Once we are logged
    </span>
    <a id="_idIndexMarker329">
    </a>
    <span class="koboSpan" id="kobo.1912.1">
     in as the required
    </span>
    <a id="_idIndexMarker330">
    </a>
    <span class="koboSpan" id="kobo.1913.1">
     user (here,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1914.1">
      awsseccb_iam_user1
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1915.1">
     ) or the required source account (here,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1916.1">
      awsseccb-sandbox-1
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1917.1">
     ), we can also switch roles by pasting the link to switch roles in the console that we got in
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.1918.1">
      Step 10
     </span>
    </em>
    <span class="koboSpan" id="kobo.1919.1">
     in the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.1920.1">
      Setting up destination account via AWS Management
     </span>
    </em>
    <span class="No-Break">
     <em class="italic">
      <span class="koboSpan" id="kobo.1921.1">
       Console
      </span>
     </em>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1922.1">
      section.
     </span>
    </span>
   </p>
   <ol>
    <li value="4">
     <span class="koboSpan" id="kobo.1923.1">
      Click on
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1924.1">
        Switch Role
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1925.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1926.1">
      This time, we should be logged
     </span>
     <a id="_idIndexMarker331">
     </a>
     <span class="koboSpan" id="kobo.1927.1">
      in to the new
     </span>
     <a id="_idIndexMarker332">
     </a>
     <span class="koboSpan" id="kobo.1928.1">
      account.
     </span>
     <span class="koboSpan" id="kobo.1928.2">
      We can verify this from the drop-down menu next to our account name in
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1929.1">
       the taskbar:
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer070">
     <span class="koboSpan" id="kobo.1930.1">
      <img alt="Figure 2.27 – User menu after switching role" src="image/B21384_02_27.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.1931.1">
     Figure 2.27 – User menu after switching role
    </span>
   </p>
   <ol>
    <li value="6">
     <span class="koboSpan" id="kobo.1932.1">
      Go to the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1933.1">
       S3
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1934.1">
      service and verify that we can see all buckets and
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1935.1">
       their details.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1936.1">
      We can switch back
     </span>
     <a id="_idIndexMarker333">
     </a>
     <span class="koboSpan" id="kobo.1937.1">
      to the parent account
     </span>
     <a id="_idIndexMarker334">
     </a>
     <span class="koboSpan" id="kobo.1938.1">
      by clicking on the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1939.1">
       Switch back
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1940.1">
      button, as we can see in
     </span>
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.1941.1">
        Figure 2
       </span>
      </em>
     </span>
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.1942.1">
        .27
       </span>
      </em>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1943.1">
       .
      </span>
     </span>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.1944.1">
     Next, we will see how we can create a role from the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1945.1">
      command line.
     </span>
    </span>
   </p>
   <h3>
    <span class="koboSpan" id="kobo.1946.1">
     Setting up a destination account via the AWS CLI
    </span>
   </h3>
   <p>
    <span class="koboSpan" id="kobo.1947.1">
     With the AWS CLI, first, we need
    </span>
    <a id="_idIndexMarker335">
    </a>
    <span class="koboSpan" id="kobo.1948.1">
     to create a role embedded
    </span>
    <a id="_idIndexMarker336">
    </a>
    <span class="koboSpan" id="kobo.1949.1">
     with a trust policy in the destination account and then associate the permissions policy with this role.
    </span>
    <span class="koboSpan" id="kobo.1949.2">
     We will run the CLI commands using the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1950.1">
      AWSSecCBAdmin1D
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1951.1">
     CLI profile for the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1952.1">
      awsseccbadmin1
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1953.1">
     user, which is configured for the destination account (
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1954.1">
      awsseccb-sandbox-2
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1955.1">
     in my case) with
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1956.1">
      AdministratorAccess
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1957.1">
     permission.
    </span>
    <span class="koboSpan" id="kobo.1957.2">
     Let us
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1958.1">
      get started:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.1959.1">
      First, we need to create a
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1960.1">
       trust policy
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1961.1">
      allowing the destination account
     </span>
     <a id="_idIndexMarker337">
     </a>
     <span class="koboSpan" id="kobo.1962.1">
      to trust the source account and save the file
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1963.1">
       as
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1964.1">
        trust-policy.json
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1965.1">
       :
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1966.1">{</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1967.1">    "Version": "2012-10-17",</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1968.1">    "Statement": [</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1969.1">      {</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1970.1">        "Effect": "Allow",</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1971.1">        "Principal": {</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1972.1">          "AWS": "arn:aws:iam::&lt;SOURCE_ACCOUNT_ID&gt;:root"</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1973.1">        },</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1974.1">        "Action": "sts:AssumeRole"</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1975.1">      }</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1976.1">    ]</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1977.1">  }</span></strong></pre>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.1978.1">
       Replace
      </span>
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1979.1">
        &lt;SOURCE_ACCOUNT_ID&gt;
       </span>
      </strong>
      <span class="koboSpan" id="kobo.1980.1">
       with your source account’s 12-digit
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.1981.1">
        account ID.
       </span>
      </span>
     </p>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1982.1">
      Create a role using the trust
     </span>
     <a id="_idIndexMarker338">
     </a>
     <span class="koboSpan" id="kobo.1983.1">
      relationship file created
     </span>
     <a id="_idIndexMarker339">
     </a>
     <span class="koboSpan" id="kobo.1984.1">
      in the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1985.1">
       previous step:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1986.1">aws iam create-role \</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1987.1">    --role-name SA-S3ReadOnlyRoleCLI \</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1988.1">    --assume-role-policy-document file://trust-policy.json \</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1989.1">    --profile AWSSecCBAdmin1D</span></strong></pre>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.1990.1">
       If successful, the command will return an output with the details of the newly created role including
      </span>
      <strong class="bold">
       <span class="koboSpan" id="kobo.1991.1">
        RoleId
       </span>
      </strong>
      <span class="koboSpan" id="kobo.1992.1">
       , and
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.1993.1">
        role’s
       </span>
      </span>
      <span class="No-Break">
       <strong class="bold">
        <span class="koboSpan" id="kobo.1994.1">
         ARN
        </span>
       </strong>
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.1995.1">
        .
       </span>
      </span>
     </p>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1996.1">
      Attach the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1997.1">
       AmazonS3ReadOnlyAccess
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1998.1">
      permission policy to the newly
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1999.1">
       created role:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.2000.1">aws iam attach-role-policy \</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2001.1">    --role-name SA-S3ReadOnlyRoleCLI \</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2002.1">    --policy-arn arn:aws:iam::aws:policy/AmazonS3ReadOnlyAccess \</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2003.1">    --profile AWSSecCBAdmin1D</span></strong></pre>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.2004.1">
       There is no
      </span>
      <a id="_idIndexMarker340">
      </a>
      <span class="koboSpan" id="kobo.2005.1">
       output for
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.2006.1">
        this
       </span>
      </span>
      <span class="No-Break">
       <a id="_idIndexMarker341">
       </a>
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.2007.1">
        command.
       </span>
      </span>
     </p>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.2008.1">
     Next, we need to create a policy in the source account that authorizes the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.2009.1">
      role switch.
     </span>
    </span>
   </p>
   <h3>
    <span class="koboSpan" id="kobo.2010.1">
     Setting up a source account via the AWS CLI
    </span>
   </h3>
   <p>
    <span class="koboSpan" id="kobo.2011.1">
     We will run the CLI commands
    </span>
    <a id="_idIndexMarker342">
    </a>
    <span class="koboSpan" id="kobo.2012.1">
     using the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.2013.1">
      AWSSecCBAdmin1S
     </span>
    </strong>
    <span class="koboSpan" id="kobo.2014.1">
     CLI profile
    </span>
    <a id="_idIndexMarker343">
    </a>
    <span class="koboSpan" id="kobo.2015.1">
     for the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.2016.1">
      awsseccbadmin1
     </span>
    </strong>
    <span class="koboSpan" id="kobo.2017.1">
     user, which is configured for the source account (
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.2018.1">
      awsseccb-sandbox-1
     </span>
    </strong>
    <span class="koboSpan" id="kobo.2019.1">
     in my case) with
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.2020.1">
      AdministratorAccess
     </span>
    </strong>
    <span class="koboSpan" id="kobo.2021.1">
     permission.
    </span>
    <span class="koboSpan" id="kobo.2021.2">
     Let us
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.2022.1">
      get started:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.2023.1">
      Create a policy to allow source account identities to assume the role in the destination account and save the file
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.2024.1">
       as
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.2025.1">
        assume-role-policy-cli.json
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.2026.1">
       :
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.2027.1">{</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2028.1">    "Version": "2012-10-17",</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2029.1">    "Statement": {</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2030.1">      "Effect": "Allow",</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2031.1">      "Action": "sts:AssumeRole",</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2032.1">      "Resource": "arn:aws:iam::DESTINATION_ACCOUNT_ID:role/SA-S3ReadOnlyRoleCLI"</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2033.1">    }</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2034.1">}</span></strong></pre>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.2035.1">
       Replace
      </span>
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.2036.1">
        DESTINATION_ACCOUNT_ID
       </span>
      </strong>
      <span class="koboSpan" id="kobo.2037.1">
       with the destination account’s 12-digit
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.2038.1">
        Account ID.
       </span>
      </span>
     </p>
    </li>
    <li>
     <span class="koboSpan" id="kobo.2039.1">
      Create a policy that allows assuming the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.2040.1">
       S3ReadOnlyRoleCLI
      </span>
     </strong>
     <span class="koboSpan" id="kobo.2041.1">
      role in the destination account using the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.2042.1">
       assume-role-policy-cli.json
      </span>
     </strong>
     <span class="koboSpan" id="kobo.2043.1">
      file we created in
     </span>
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.2044.1">
        Step 1
       </span>
      </em>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.2045.1">
       :
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.2046.1">aws iam create-policy \</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2047.1">    --policy-name AR_Sandbox2_S3ReadOnly_CLI \</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2048.1">    --policy-document file://assume-role-policy-cli.json \</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2049.1">    --profile AWSSecCBAdmin1S</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.2050.1">
      Attach this policy to the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.2051.1">
       awsseccbusers
      </span>
     </strong>
     <span class="koboSpan" id="kobo.2052.1">
      group in the source account, which has the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.2053.1">
       awsseccbuser1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.2054.1">
      user.
     </span>
     <span class="koboSpan" id="kobo.2054.2">
      With IAM, we can directly attach the policy to the group in the source account.
     </span>
     <span class="koboSpan" id="kobo.2054.3">
      With IAM Identity Center, we must first create a permission set with this policy and assign
     </span>
     <a id="_idIndexMarker344">
     </a>
     <span class="koboSpan" id="kobo.2055.1">
      it to the group during the assignment to the source
     </span>
     <a id="_idIndexMarker345">
     </a>
     <span class="koboSpan" id="kobo.2056.1">
      account as we saw in
     </span>
     <a href="B21384_01.xhtml#_idTextAnchor020">
      <span class="No-Break">
       <em class="italic">
        <span class="koboSpan" id="kobo.2057.1">
         Chapter 1
        </span>
       </em>
      </span>
     </a>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.2058.1">
       .
      </span>
     </span>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.2059.1">
     Next, we will switch roles from the source account to the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.2060.1">
      destination account.
     </span>
    </span>
   </p>
   <h3>
    <span class="koboSpan" id="kobo.2061.1">
     Switching roles via the CLI
    </span>
   </h3>
   <p>
    <span class="koboSpan" id="kobo.2062.1">
     We need to use
    </span>
    <a id="_idIndexMarker346">
    </a>
    <span class="koboSpan" id="kobo.2063.1">
     the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.2064.1">
      AWSSecCBUser1S
     </span>
    </strong>
    <span class="koboSpan" id="kobo.2065.1">
     CLI profile
    </span>
    <a id="_idIndexMarker347">
    </a>
    <span class="koboSpan" id="kobo.2066.1">
     for the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.2067.1">
      awsseccbuser1
     </span>
    </strong>
    <span class="koboSpan" id="kobo.2068.1">
     user, configured for the source account for the role with the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.2069.1">
      sts:AssumeRole
     </span>
    </strong>
    <span class="koboSpan" id="kobo.2070.1">
     permission.
    </span>
    <span class="koboSpan" id="kobo.2070.2">
     Let us
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.2071.1">
      get started:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.2072.1">
      Establish a new profile for the role within the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.2073.1">
       .aws/config
      </span>
     </strong>
     <span class="koboSpan" id="kobo.2074.1">
      file.
     </span>
     <span class="koboSpan" id="kobo.2074.2">
      On Unix or Linux systems, this file is in the user’s home directory.
     </span>
     <span class="koboSpan" id="kobo.2074.3">
      For Windows users, we can find the file at
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.2075.1">
       C:\Users\USERNAME\.aws\config
      </span>
     </strong>
     <span class="koboSpan" id="kobo.2076.1">
      .
     </span>
     <span class="koboSpan" id="kobo.2076.2">
      Make sure to replace
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.2077.1">
       USERNAME
      </span>
     </strong>
     <span class="koboSpan" id="kobo.2078.1">
      with your actual
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.2079.1">
       Windows username:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.2080.1">[profile switchrole]</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2081.1">role_arn = arn:aws:iam::DESTINATION_ACCOUNT_ID:role/SA-S3ReadOnlyRoleCLI</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2082.1">source_profile = AWSSecCBUser1S</span></strong></pre>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.2083.1">
       We need to replace
      </span>
      <a id="_idIndexMarker348">
      </a>
      <span class="koboSpan" id="kobo.2084.1">
       the role’s ARN with the ARN of the role we created
      </span>
      <a id="_idIndexMarker349">
      </a>
      <span class="koboSpan" id="kobo.2085.1">
       in the destination account.
      </span>
      <span class="koboSpan" id="kobo.2085.2">
       Whether we want to do a cross-account role assumption or role assumption within the same account, we need to follow
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.2086.1">
        this step.
       </span>
      </span>
     </p>
    </li>
    <li>
     <span class="koboSpan" id="kobo.2087.1">
      Run the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.2088.1">
       aws s3 ls
      </span>
     </strong>
     <span class="koboSpan" id="kobo.2089.1">
      command with this new user profile
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.2090.1">
       as follows:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.2091.1">aws s3 ls –profile switchrole</span></strong></pre>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.2092.1">
       This should give us a successful response with the names of the buckets in the
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.2093.1">
        destination account.
       </span>
      </span>
     </p>
    </li>
   </ol>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.2094.1">
     Important note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.2095.1">
     To obtain the role’s credentials, the AWS CLI internally uses
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.2096.1">
      sts:AssumeRole
     </span>
    </strong>
    <span class="koboSpan" id="kobo.2097.1">
     for assuming the role utilizing the credentials associated with the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.2098.1">
      source_profile
     </span>
    </strong>
    <span class="koboSpan" id="kobo.2099.1">
     , which is
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.2100.1">
      AWSSecCBUser1S
     </span>
    </strong>
    <span class="koboSpan" id="kobo.2101.1">
     in our case.
    </span>
    <span class="koboSpan" id="kobo.2101.2">
     Therefore, the identity linked to
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.2102.1">
      source_profile
     </span>
    </strong>
    <span class="koboSpan" id="kobo.2103.1">
     should possess the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.2104.1">
      sts:AssumeRole
     </span>
    </strong>
    <span class="koboSpan" id="kobo.2105.1">
     permission for the role mentioned
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.2106.1">
      in
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.2107.1">
       role_arn
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.2108.1">
      .
     </span>
    </span>
   </p>
   <ol>
    <li value="3">
     <span class="koboSpan" id="kobo.2109.1">
      We can also verify the switch role changes within this recipe by running the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.2110.1">
       aws sts
      </span>
     </strong>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.2111.1">
        assume-role
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.2112.1">
       command:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.2113.1">aws sts assume-role \</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2114.1">    --role-arn ROLE_ARN \</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2115.1">    --role-session-name SESSION_NAME \</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2116.1">    --profile AWSSecCBUser1S</span></strong></pre>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.2117.1">
       The
      </span>
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.2118.1">
        aws sts assume-role
       </span>
      </strong>
      <span class="koboSpan" id="kobo.2119.1">
       command, if successful, should give us
      </span>
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.2120.1">
        AccessKeyId
       </span>
      </strong>
      <span class="koboSpan" id="kobo.2121.1">
       ,
      </span>
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.2122.1">
        SecretAccessKey
       </span>
      </strong>
      <span class="koboSpan" id="kobo.2123.1">
       , and
      </span>
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.2124.1">
        SessionToken
       </span>
      </strong>
      <span class="koboSpan" id="kobo.2125.1">
       .
      </span>
      <span class="koboSpan" id="kobo.2125.2">
       We can use the credentials returned
      </span>
      <a id="_idIndexMarker350">
      </a>
      <span class="koboSpan" id="kobo.2126.1">
       from the
      </span>
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.2127.1">
        sts assume-role
       </span>
      </strong>
      <span class="koboSpan" id="kobo.2128.1">
       command through
      </span>
      <a id="_idIndexMarker351">
      </a>
      <span class="koboSpan" id="kobo.2129.1">
       APIs, including from
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.2130.1">
        the CLI.
       </span>
      </span>
     </p>
    </li>
   </ol>
   <h2 id="_idParaDest-78">
    <a id="_idTextAnchor079">
    </a>
    <span class="koboSpan" id="kobo.2131.1">
     How it works...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.2132.1">
     In this recipe, we configured
    </span>
    <a id="_idIndexMarker352">
    </a>
    <span class="koboSpan" id="kobo.2133.1">
     two accounts, a source account and a destination
    </span>
    <a id="_idIndexMarker353">
    </a>
    <span class="koboSpan" id="kobo.2134.1">
     account, such that we can switch roles from the source account and log in to the destination account, assuming there’s a role in the destination.
    </span>
    <span class="koboSpan" id="kobo.2134.2">
     This feature is used in an identity account architecture where all IAM users are managed in a single AWS account, often referred to as the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.2135.1">
      identity account
     </span>
    </em>
    <span class="koboSpan" id="kobo.2136.1">
     , and can switch roles
    </span>
    <a id="_idIndexMarker354">
    </a>
    <span class="koboSpan" id="kobo.2137.1">
     to access resources across multiple accounts, thus eliminating the need for distinct login credentials for
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.2138.1">
      each account.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.2139.1">
     To switch roles between accounts, the account we are switching to must have a role set up for this purpose.
    </span>
    <span class="koboSpan" id="kobo.2139.2">
     The role in the destination account should include a trust policy that permits the source account to assume this role, and the source account must have a policy with the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.2140.1">
      sts:AssumeRole
     </span>
    </strong>
    <span class="koboSpan" id="kobo.2141.1">
     permission, which allows this role assumption.
    </span>
    <span class="koboSpan" id="kobo.2141.2">
     In summary, to switch roles between two AWS accounts – let us call them the source and destination accounts – the following configurations
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.2142.1">
      are needed:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.2143.1">
      First, a role that can be assumed by an identity (user or service) in the source account must exist in the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.2144.1">
       destination account.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.2145.1">
      Second, the identity in the source account must be granted the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.2146.1">
       sts:AssumeRole
      </span>
     </strong>
     <span class="koboSpan" id="kobo.2147.1">
      permission.
     </span>
     <span class="koboSpan" id="kobo.2147.2">
      This permission should specify the ARN of the role to be assumed in its policy.
     </span>
     <span class="koboSpan" id="kobo.2147.3">
      This step is needed for role-switching within a single account or between two
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.2148.1">
       different accounts.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.2149.1">
      For
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.2150.1">
       cross-account role switching
      </span>
     </strong>
     <span class="koboSpan" id="kobo.2151.1">
      , as seen in this recipe, the destination account must also have a trust policy attached to the role to allow the source account to assume
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.2152.1">
       that role.
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.2153.1">
     The trust policy attached
    </span>
    <a id="_idIndexMarker355">
    </a>
    <span class="koboSpan" id="kobo.2154.1">
     to the role in the destination account
    </span>
    <a id="_idIndexMarker356">
    </a>
    <span class="koboSpan" id="kobo.2155.1">
     is an example of a resource-based policy, while the policy within the source account authorizing the role switch is an example of an identity-based policy.
    </span>
    <span class="koboSpan" id="kobo.2155.2">
     Implicitly, session policies are used within the recipe.
    </span>
    <span class="koboSpan" id="kobo.2155.3">
     IAM policies attached to the role in the destination account serve as session policies.
    </span>
    <span class="koboSpan" id="kobo.2155.4">
     When a role is assumed, whether within the same
    </span>
    <a id="_idIndexMarker357">
    </a>
    <span class="koboSpan" id="kobo.2156.1">
     account or across accounts, AWS
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.2157.1">
      Security Token Service
     </span>
    </strong>
    <span class="koboSpan" id="kobo.2158.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.2159.1">
      STS
     </span>
    </strong>
    <span class="koboSpan" id="kobo.2160.1">
     ) generates temporary security credentials for the session.
    </span>
    <span class="koboSpan" id="kobo.2160.2">
     These credentials include session policies, defining the permissions available within the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.2161.1">
      temporary session.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.2162.1">
     Once a role is assumed, the permissions granted are determined solely by the session policies.
    </span>
    <span class="koboSpan" id="kobo.2162.2">
     Additionally, any permissions associated with the IAM identity assuming the role are temporarily relinquished, ensuring that the temporary session operates strictly within the boundaries of the assumed role’s permissions, mitigating the risk of unauthorized access.
    </span>
    <span class="koboSpan" id="kobo.2162.3">
     Furthermore, explicit use of the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.2163.1">
      aws sts assume-role
     </span>
    </strong>
    <span class="koboSpan" id="kobo.2164.1">
     command allows for the obtaining of temporary security credentials.
    </span>
    <span class="koboSpan" id="kobo.2164.2">
     Upon success, this command provides
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.2165.1">
      AccessKeyId
     </span>
    </strong>
    <span class="koboSpan" id="kobo.2166.1">
     ,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.2167.1">
      SecretAccessKey
     </span>
    </strong>
    <span class="koboSpan" id="kobo.2168.1">
     , and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.2169.1">
      SessionToken
     </span>
    </strong>
    <span class="koboSpan" id="kobo.2170.1">
     .
    </span>
    <span class="koboSpan" id="kobo.2170.2">
     These credentials can be used through APIs, including the AWS CLI, enabling controlled access to AWS resources based on the permissions defined by the assumed role’s
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.2171.1">
      session policies.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.2172.1">
     When we set up a new account within AWS Organizations, AWS automatically creates an IAM role in the new member account.
    </span>
    <span class="koboSpan" id="kobo.2172.2">
     This role is designed to allow administrators in the management account to assume the role and access the member accounts.
    </span>
    <span class="koboSpan" id="kobo.2172.3">
     This role is commonly named
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.2173.1">
      OrganizationAccountAccessRole
     </span>
    </strong>
    <span class="koboSpan" id="kobo.2174.1">
     but we can change it to a different one while creating an account under an AWS organization, as we saw in
    </span>
    <a href="B21384_01.xhtml#_idTextAnchor020">
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.2175.1">
        Chapter 1
       </span>
      </em>
     </span>
    </a>
    <span class="koboSpan" id="kobo.2176.1">
     .
    </span>
    <span class="koboSpan" id="kobo.2176.2">
     If we are using accounts that are not part of AWS Organizations, we need to create
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.2177.1">
      these manually.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.2178.1">
     If we are using AWS IAM Identity Center with AWS Organizations, we can easily log in to different AWS accounts from the access portal, and implementing the identity account architecture that we discussed in this recipe to switch roles and log in to different AWS accounts becomes
    </span>
    <a id="_idIndexMarker358">
    </a>
    <span class="koboSpan" id="kobo.2179.1">
     redundant.
    </span>
    <span class="koboSpan" id="kobo.2179.2">
     Nevertheless, roles are useful in a variety
    </span>
    <a id="_idIndexMarker359">
    </a>
    <span class="koboSpan" id="kobo.2180.1">
     of use cases, including cross-service access, as we will see in the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.2181.1">
      next recipe.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-79">
    <a id="_idTextAnchor080">
    </a>
    <span class="koboSpan" id="kobo.2182.1">
     There’s more...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.2183.1">
     Let us quickly explore
    </span>
    <a id="_idIndexMarker360">
    </a>
    <span class="koboSpan" id="kobo.2184.1">
     how we can use the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.2185.1">
      external ID
     </span>
    </strong>
    <span class="koboSpan" id="kobo.2186.1">
     feature while switching roles for
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.2187.1">
      enhanced security.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.2188.1">
     The
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.2189.1">
      confused deputy
     </span>
    </strong>
    <span class="koboSpan" id="kobo.2190.1">
     problem is a security vulnerability
    </span>
    <a id="_idIndexMarker361">
    </a>
    <span class="koboSpan" id="kobo.2191.1">
     where a program with restricted access unintentionally grants unauthorized access to its resources.
    </span>
    <span class="koboSpan" id="kobo.2191.2">
     This issue arises when a trusted entity delegates authority to a less-trusted one, which then acts on behalf of the trusted entity but in an unintended manner, potentially leading to security breaches.
    </span>
    <span class="koboSpan" id="kobo.2191.3">
     In the context of our recipe, where a source account tries to assume a role in a destination account, this vulnerability is pertinent due to the potential risk of unauthorized access to sensitive resources in the destination account by the less-trusted source account.
    </span>
    <span class="koboSpan" id="kobo.2191.4">
     This risk stems from the delegation of authority through role assumption mechanisms, where proper controls are necessary to prevent misuse and
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.2192.1">
      unauthorized access.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.2193.1">
     Now, let us see how we can solve the confused deputy problem with cross-account role switching using external IDs.
    </span>
    <span class="koboSpan" id="kobo.2193.2">
     An external ID serves as a unique key to establish a trust bond between two AWS accounts, commonly utilized when an AWS account intends to authorize third-party account access to its resources.
    </span>
    <span class="koboSpan" id="kobo.2193.3">
     Specifically, in scenarios involving cross-account IAM roles, such as the one we saw in this recipe, the resource-owning account (trusting account) designates an external ID.
    </span>
    <span class="koboSpan" id="kobo.2193.4">
     The third party (trusted account) must then use this external ID to assume the specified role.
    </span>
    <span class="koboSpan" id="kobo.2193.5">
     By requiring a matching external ID for both the role assumption and the requester, the system ensures that only authorized entities, verified through their external ID and proper permissions, can access the resources, thereby safeguarding against
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.2194.1">
      such vulnerabilities.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.2195.1">
     While setting up the destination account in
    </span>
    <span class="No-Break">
     <em class="italic">
      <span class="koboSpan" id="kobo.2196.1">
       Figure 2
      </span>
     </em>
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.2197.1">
      .24
     </span>
    </em>
    <span class="koboSpan" id="kobo.2198.1">
     , the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.2199.1">
      Require external ID (Best practice when a third party will assume this role)
     </span>
    </strong>
    <span class="koboSpan" id="kobo.2200.1">
     option was not selected.
    </span>
    <span class="koboSpan" id="kobo.2200.2">
     To use an external ID, we can select this option and add an external ID value of our choice.
    </span>
    <span class="koboSpan" id="kobo.2200.3">
     Once an external ID is configured, we need to provide the external ID while switching roles as given in the following command, otherwise, access will
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.2201.1">
      be denied:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.2202.1">
aws sts assume-role --role-arn ROLE_ARN --role-session-name SESSION_NAME --profile AWSSecCBUser1S --external-id awssecb-cust-0819</span></pre>
   <h2 id="_idParaDest-80">
    <a id="_idTextAnchor081">
    </a>
    <span class="koboSpan" id="kobo.2203.1">
     See also
    </span>
   </h2>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.2204.1">
      Read more about
     </span>
     <a id="_idIndexMarker362">
     </a>
     <span class="koboSpan" id="kobo.2205.1">
      using
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.2206.1">
       external-id
      </span>
     </strong>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.2207.1">
       at
      </span>
     </span>
     <a href="https://www.cloudericks.com/blog/mitigating-confused-deputy-problem-external-ids-secure-cross-account-access-aws">
      <span class="No-Break">
       <span class="koboSpan" id="kobo.2208.1">
        https://www.cloudericks.com/blog/mitigating-confused-deputy-problem-external-ids-secure-cross-account-access-aws
       </span>
      </span>
     </a>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.2209.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.2210.1">
      Read more about
     </span>
     <a id="_idIndexMarker363">
     </a>
     <span class="koboSpan" id="kobo.2211.1">
      identity account architecture within AWS
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.2212.1">
       at
      </span>
     </span>
     <a href="https://www.cloudericks.com/blog/implementing-identity-account-architecture-within-aws">
      <span class="No-Break">
       <span class="koboSpan" id="kobo.2213.1">
        https://www.cloudericks.com/blog/implementing-identity-account-architecture-within-aws
       </span>
      </span>
     </a>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.2214.1">
       .
      </span>
     </span>
    </li>
   </ul>
   <h1 id="_idParaDest-81">
    <a id="_idTextAnchor082">
    </a>
    <span class="koboSpan" id="kobo.2215.1">
     Cross-service access via IAM roles on EC2 instances
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.2216.1">
     In this recipe, we will create
    </span>
    <a id="_idIndexMarker364">
    </a>
    <span class="koboSpan" id="kobo.2217.1">
     an IAM role that allows
    </span>
    <a id="_idIndexMarker365">
    </a>
    <span class="koboSpan" id="kobo.2218.1">
     an EC2 instance to access S3 APIs and then attach it to an EC2 instance.
    </span>
    <span class="koboSpan" id="kobo.2218.2">
     IAM roles provide temporary permissions for an AWS service or user to access another AWS service.
    </span>
    <span class="koboSpan" id="kobo.2218.3">
     This avoids the need for hard coding credentials such as access keys and secret access keys within
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.2219.1">
      EC2 instances.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-82">
    <a id="_idTextAnchor083">
    </a>
    <span class="koboSpan" id="kobo.2220.1">
     Getting ready
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.2221.1">
     To complete the steps within this recipe, we need
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.2222.1">
      the following:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.2223.1">
      A working AWS account,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.2224.1">
       awsseccb-sandbox-1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.2225.1">
      , and a user with
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.2226.1">
       AdministratorAccess
      </span>
     </strong>
     <span class="koboSpan" id="kobo.2227.1">
      permission to that account,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.2228.1">
       awsseccbadmin1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.2229.1">
      , following the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.2230.1">
       Technical requirements
      </span>
     </em>
     <span class="koboSpan" id="kobo.2231.1">
      section of
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.2232.1">
       this chapter.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.2233.1">
      Working knowledge of IAM, EC2, and
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.2234.1">
       S3 services.
      </span>
     </span>
    </li>
   </ul>
   <h2 id="_idParaDest-83">
    <a id="_idTextAnchor084">
    </a>
    <span class="koboSpan" id="kobo.2235.1">
     How to do it...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.2236.1">
     We can create an IAM role
    </span>
    <a id="_idIndexMarker366">
    </a>
    <span class="koboSpan" id="kobo.2237.1">
     for an EC2 instance
    </span>
    <a id="_idIndexMarker367">
    </a>
    <span class="koboSpan" id="kobo.2238.1">
     with access to S3 APIs
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.2239.1">
      as follows:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.2240.1">
      Go to the
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.2241.1">
        IAM
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.2242.1">
       dashboard.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.2243.1">
      Click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.2244.1">
       Roles
      </span>
     </strong>
     <span class="koboSpan" id="kobo.2245.1">
      from the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.2246.1">
       left sidebar.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.2247.1">
      Click on
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.2248.1">
        Create role
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.2249.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.2250.1">
      Under
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.2251.1">
       Trusted entity type
      </span>
     </strong>
     <span class="koboSpan" id="kobo.2252.1">
      , select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.2253.1">
       AWS service
      </span>
     </strong>
     <span class="koboSpan" id="kobo.2254.1">
      , and under the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.2255.1">
       Service or use case
      </span>
     </strong>
     <span class="koboSpan" id="kobo.2256.1">
      , select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.2257.1">
       EC2
      </span>
     </strong>
     <span class="koboSpan" id="kobo.2258.1">
      as the service that will use this role, and
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.2259.1">
       click
      </span>
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.2260.1">
        Next
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.2261.1">
       .
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer071">
     <span class="koboSpan" id="kobo.2262.1">
      <img alt="Figure 2.28 – Select trusted entity" src="image/B21384_02_28.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.2263.1">
     Figure 2.28 – Select trusted entity
    </span>
   </p>
   <ol>
    <li value="5">
     <span class="koboSpan" id="kobo.2264.1">
      Select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.2265.1">
       AmazonS3FullAccess
      </span>
     </strong>
     <span class="koboSpan" id="kobo.2266.1">
      and
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.2267.1">
       click
      </span>
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.2268.1">
        Next
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.2269.1">
       .
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer072">
     <span class="koboSpan" id="kobo.2270.1">
      <img alt="Figure 2.29 – Permissions policies" src="image/B21384_02_29.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.2271.1">
     Figure 2.29 – Permissions policies
    </span>
   </p>
   <ol>
    <li value="6">
     <span class="koboSpan" id="kobo.2272.1">
      Give the role
     </span>
     <a id="_idIndexMarker368">
     </a>
     <span class="koboSpan" id="kobo.2273.1">
      name (for
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.2274.1">
       example,
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.2275.1">
        MyS3AccessRole
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.2276.1">
       ).
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.2277.1">
      Optionally add tags
     </span>
     <a id="_idIndexMarker369">
     </a>
     <span class="koboSpan" id="kobo.2278.1">
      and click on
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.2279.1">
        Create Role
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.2280.1">
       .
      </span>
     </span>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.2281.1">
       We can associate the role with an EC2 instance
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.2282.1">
        as follows:
       </span>
      </span>
     </p>
     <ol>
      <li class="upper-roman">
       <span class="koboSpan" id="kobo.2283.1">
        Go to the
       </span>
       <span class="No-Break">
        <strong class="bold">
         <span class="koboSpan" id="kobo.2284.1">
          EC2
         </span>
        </strong>
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.2285.1">
         dashboard.
        </span>
       </span>
      </li>
      <li class="upper-roman">
       <span class="koboSpan" id="kobo.2286.1">
        Click on
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.2287.1">
         Instances
        </span>
       </strong>
       <span class="koboSpan" id="kobo.2288.1">
        from the
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.2289.1">
         left sidebar.
        </span>
       </span>
      </li>
      <li class="upper-roman">
       <span class="koboSpan" id="kobo.2290.1">
        Select our instance, click on
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.2291.1">
         Actions
        </span>
       </strong>
       <span class="koboSpan" id="kobo.2292.1">
        , click on
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.2293.1">
         Security
        </span>
       </strong>
       <span class="koboSpan" id="kobo.2294.1">
        , and click on
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.2295.1">
         Modify
        </span>
       </strong>
       <span class="No-Break">
        <strong class="bold">
         <span class="koboSpan" id="kobo.2296.1">
          IAM role
         </span>
        </strong>
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.2297.1">
         :
        </span>
       </span>
      </li>
     </ol>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer073">
     <span class="koboSpan" id="kobo.2298.1">
      <img alt="Figure 2.30 – Attaching the IAM role to an instance" src="image/B21384_02_30.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.2299.1">
     Figure 2.30 – Attaching the IAM role to an instance
    </span>
   </p>
   <ol>
    <li class="upper-roman" value="4">
     <span class="koboSpan" id="kobo.2300.1">
      Select our new IAM
     </span>
     <a id="_idIndexMarker370">
     </a>
     <span class="koboSpan" id="kobo.2301.1">
      role and click
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.2302.1">
       Update IAM role
      </span>
     </strong>
     <span class="koboSpan" id="kobo.2303.1">
      .
     </span>
     <span class="koboSpan" id="kobo.2303.2">
      We should get a
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.2304.1">
       success
      </span>
     </span>
     <span class="No-Break">
      <a id="_idIndexMarker371">
      </a>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.2305.1">
       message.
      </span>
     </span>
    </li>
    <li class="upper-roman">
     <span class="koboSpan" id="kobo.2306.1">
      Connect to our instance via SSH and run the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.2307.1">
       following command:
      </span>
     </span>
    </li>
   </ol>
   <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.2308.1">  aws s3 ls</span></strong></pre>
   <ol>
    <li class="upper-roman" value="6">
     <span class="koboSpan" id="kobo.2309.1">
      You will get the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.2310.1">
       following output:
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer074">
     <span class="koboSpan" id="kobo.2311.1">
      <img alt="Figure 2.31 – Listing the S3 buckets" src="image/B21384_02_31.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.2312.1">
     Figure 2.31 – Listing the S3 buckets
    </span>
   </p>
   <p class="list-inset">
    <span class="koboSpan" id="kobo.2313.1">
     We should be able to see all the buckets in our account when we run this command from the instance because of the role
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.2314.1">
      we updated.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-84">
    <a id="_idTextAnchor085">
    </a>
    <span class="koboSpan" id="kobo.2315.1">
     How it works...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.2316.1">
     In this recipe, we have granted
    </span>
    <a id="_idIndexMarker372">
    </a>
    <span class="koboSpan" id="kobo.2317.1">
     S3 access permissions
    </span>
    <a id="_idIndexMarker373">
    </a>
    <span class="koboSpan" id="kobo.2318.1">
     to our EC2 instance, enabling the execution of supported S3 operations from within the instance, whether through CLI or code, without embedding credentials directly.
    </span>
    <span class="koboSpan" id="kobo.2318.2">
     Embedding AWS credentials within an EC2 machine poses a risk of exposure if the machine
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.2319.1">
      is compromised.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.2320.1">
     When creating an IAM role for an EC2 instance, as demonstrated in this recipe, AWS automatically generates an EC2 instance profile.
    </span>
    <span class="koboSpan" id="kobo.2320.2">
     This profile functions as a digital badge, clearly delineating the permitted services for the instance’s use.
    </span>
    <span class="koboSpan" id="kobo.2320.3">
     Essentially, it encompasses the IAM role, furnishing our EC2 instance with the necessary permissions for secure and efficient interaction with specific AWS services, such as S3.
    </span>
    <span class="koboSpan" id="kobo.2320.4">
     The EC2 instance “assumes” this role whenever it undertakes tasks requiring these permissions, such as interacting
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.2321.1">
      with S3.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-85">
    <a id="_idTextAnchor086">
    </a>
    <span class="koboSpan" id="kobo.2322.1">
     There’s more...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.2323.1">
     IAM roles are useful for facilitating
    </span>
    <a id="_idIndexMarker374">
    </a>
    <span class="koboSpan" id="kobo.2324.1">
     secure cross-service access within AWS environments.
    </span>
    <span class="koboSpan" id="kobo.2324.2">
     These roles can be utilized across various AWS services to grant temporary permissions to entities such as Lambda functions, ECS tasks, and even users or groups within AWS organizations.
    </span>
    <span class="koboSpan" id="kobo.2324.3">
     By defining granular permissions through IAM policies, roles enable seamless integration and collaboration between different services while adhering to the principle of
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.2325.1">
      least privilege.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.2326.1">
     For instance, IAM roles can be assigned to Lambda functions to access specific AWS resources such as S3 buckets or DynamoDB tables without requiring hard-coded credentials.
    </span>
    <span class="koboSpan" id="kobo.2326.2">
     Similarly, ECS tasks can assume IAM roles to interact with other AWS services during containerized application deployments.
    </span>
    <span class="koboSpan" id="kobo.2326.3">
     Moreover, IAM roles can be leveraged by AWS organizations to delegate permissions across multiple
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.2327.1">
      accounts securely.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.2328.1">
     Both IAM users and roles are IAM identities assigned specific permission policies.
    </span>
    <span class="koboSpan" id="kobo.2328.2">
     While users are associated with static credentials such as access keys, which pose a risk of exposure, IAM roles offer temporary security credentials for each session, reducing the reliance on long-term static credentials.
    </span>
    <span class="koboSpan" id="kobo.2328.3">
     Roles can be assumed by various entities including users, groups, applications, or
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.2329.1">
      AWS services.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.2330.1">
     In essence, IAM roles serve as a foundational element for implementing secure and efficient cross-service access controls within AWS ecosystems, promoting agility, scalability, and robust
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.2331.1">
      security practices.
     </span>
    </span>
   </p>
   <h3>
    <span class="koboSpan" id="kobo.2332.1">
     Important concepts related to IAM roles
    </span>
   </h3>
   <p>
    <span class="koboSpan" id="kobo.2333.1">
     Let us quickly go through some more important concepts
    </span>
    <a id="_idIndexMarker375">
    </a>
    <span class="koboSpan" id="kobo.2334.1">
     about
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.2335.1">
      IAM roles:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.2336.1">
      The trust policy for a role allows a user in the trusted account to switch to or assume
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.2337.1">
       that role.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.2338.1">
      A wildcard (
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.2339.1">
       *
      </span>
     </strong>
     <span class="koboSpan" id="kobo.2340.1">
      ) cannot be specified as a principal for a
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.2341.1">
       trust policy.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.2342.1">
      When a user assumes a role, it temporarily gives up its own permissions until the user stops using
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.2343.1">
       the role.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.2344.1">
      Some services allow attaching a policy directly to a resource without needing to use a role as a proxy.
     </span>
     <span class="koboSpan" id="kobo.2344.2">
      These resources include S3 buckets, Glacier vaults, Amazon SNS topics, and Amazon
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.2345.1">
       SQS queues.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.2346.1">
      Roles can be used by external users authenticated by an external identity provider service to get access to
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.2347.1">
       AWS resources.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.2348.1">
      Roles allow mobile apps to use AWS resources without embedding AWS access keys within
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.2349.1">
       the app.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.2350.1">
      Role chaining is the process where a role assumes a second role through the AWS CLI
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.2351.1">
       or API.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.2352.1">
      To pass the role information to an EC2 instance when the instance starts, we can add the role within an instance profile.
     </span>
     <span class="koboSpan" id="kobo.2352.2">
      An instance profile can be considered a container for an IAM role.
     </span>
     <span class="koboSpan" id="kobo.2352.3">
      The
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.2353.1">
       list-instance-profiles-for-role
      </span>
     </strong>
     <span class="koboSpan" id="kobo.2354.1">
      CLI command lists the instance profiles for
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.2355.1">
       a role.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.2356.1">
      The permissions boundary
     </span>
     <a id="_idIndexMarker376">
     </a>
     <span class="koboSpan" id="kobo.2357.1">
      is a feature we can use to set the maximum permissions that an identity-based policy can grant to an IAM entity, such as a user or role.
     </span>
     <span class="koboSpan" id="kobo.2357.2">
      The
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.2358.1">
       put-role-permissions-boundary
      </span>
     </strong>
     <span class="koboSpan" id="kobo.2359.1">
      CLI command can be used to create or update the permissions boundary for a role, while
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.2360.1">
       delete-role-permissions-boundary
      </span>
     </strong>
     <span class="koboSpan" id="kobo.2361.1">
      will delete the permissions boundary for
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.2362.1">
       the role.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.2363.1">
      The
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.2364.1">
       attach-role-policy
      </span>
     </strong>
     <span class="koboSpan" id="kobo.2365.1">
      CLI command attaches a policy to a role, while
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.2366.1">
       detach-role-policy
      </span>
     </strong>
     <span class="koboSpan" id="kobo.2367.1">
      detaches a policy from
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.2368.1">
       a role.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.2369.1">
      The
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.2370.1">
       put-role-policy
      </span>
     </strong>
     <span class="koboSpan" id="kobo.2371.1">
      CLI command creates or updates an inline policy,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.2372.1">
       get-role-policy
      </span>
     </strong>
     <span class="koboSpan" id="kobo.2373.1">
      retrieves the specified inline policy in a role, and
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.2374.1">
       delete-role-policy
      </span>
     </strong>
     <span class="koboSpan" id="kobo.2375.1">
      deletes
     </span>
     <a id="_idIndexMarker377">
     </a>
     <span class="koboSpan" id="kobo.2376.1">
      the specified
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.2377.1">
       inline policy.
      </span>
     </span>
    </li>
   </ul>
   <h2 id="_idParaDest-86">
    <a id="_idTextAnchor087">
    </a>
    <span class="koboSpan" id="kobo.2378.1">
     See also
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.2379.1">
     We can read more
    </span>
    <a id="_idIndexMarker378">
    </a>
    <span class="koboSpan" id="kobo.2380.1">
     about EC2 instance profiles and IAM roles
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.2381.1">
      at
     </span>
    </span>
    <a href="https://www.cloudericks.com/blog/secure-cross-service-access-ec2-instance-profiles-iam-roles">
     <span class="No-Break">
      <span class="koboSpan" id="kobo.2382.1">
       https://www.cloudericks.com/blog/secure-cross-service-access-ec2-instance-profiles-iam-roles
      </span>
     </span>
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.2383.1">
      .
     </span>
    </span>
   </p>
  </div>
 </body></html>