<html><head></head><body>
  <div id="_idContainer103">
   <h1 class="chapter-number" id="_idParaDest-87">
    <a id="_idTextAnchor088">
    </a>
    <span class="koboSpan" id="kobo.1.1">
     3
    </span>
   </h1>
   <h1 id="_idParaDest-88">
    <a id="_idTextAnchor089">
    </a>
    <span class="koboSpan" id="kobo.2.1">
     Key Management with KMS and CloudHSM
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.3.1">
     Encryption is like turning our message into a secret code so that only the intended recipient can understand it.
    </span>
    <span class="koboSpan" id="kobo.3.2">
     Imagine that we have a message that we do not want anyone else to read.
    </span>
    <span class="koboSpan" id="kobo.3.3">
     The message, in
    </span>
    <a id="_idIndexMarker379">
    </a>
    <span class="koboSpan" id="kobo.4.1">
     its original form, is called
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.5.1">
      plain text
     </span>
    </strong>
    <span class="koboSpan" id="kobo.6.1">
     .
    </span>
    <span class="koboSpan" id="kobo.6.2">
     After we encode it, it becomes
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.7.1">
      cipher text
     </span>
    </strong>
    <span class="koboSpan" id="kobo.8.1">
     , which looks like gibberish
    </span>
    <a id="_idIndexMarker380">
    </a>
    <span class="koboSpan" id="kobo.9.1">
     to anyone who does not know how to decode it.
    </span>
    <span class="koboSpan" id="kobo.9.2">
     Converting
    </span>
    <a id="_idIndexMarker381">
    </a>
    <span class="koboSpan" id="kobo.10.1">
     the plain text into cipher text is called
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.11.1">
      encryption
     </span>
    </strong>
    <span class="koboSpan" id="kobo.12.1">
     , and converting the cipher text back
    </span>
    <a id="_idIndexMarker382">
    </a>
    <span class="koboSpan" id="kobo.13.1">
     into plain text is called
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.14.1">
      decryption
     </span>
    </strong>
    <span class="koboSpan" id="kobo.15.1">
     .
    </span>
    <span class="koboSpan" id="kobo.15.2">
     To carry out encryption and decryption, we use
    </span>
    <a id="_idIndexMarker383">
    </a>
    <span class="koboSpan" id="kobo.16.1">
     a set of mathematical rules known as an
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.17.1">
      encryption algorithm
     </span>
    </strong>
    <span class="koboSpan" id="kobo.18.1">
     .
    </span>
    <span class="koboSpan" id="kobo.18.2">
     Examples of encryption algorithms include
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.19.1">
      Rivest-Shamir-Adleman
     </span>
    </strong>
    <span class="koboSpan" id="kobo.20.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.21.1">
      RSA
     </span>
    </strong>
    <span class="koboSpan" id="kobo.22.1">
     ),
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.23.1">
      Advanced Encryption Standard
     </span>
    </strong>
    <span class="koboSpan" id="kobo.24.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.25.1">
      AES
     </span>
    </strong>
    <span class="koboSpan" id="kobo.26.1">
     ),
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.27.1">
      Data Encryption Standard
     </span>
    </strong>
    <span class="koboSpan" id="kobo.28.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.29.1">
      DES
     </span>
    </strong>
    <span class="koboSpan" id="kobo.30.1">
     ),
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.31.1">
      Triple Data Encryption Standard
     </span>
    </strong>
    <span class="koboSpan" id="kobo.32.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.33.1">
      3DES
     </span>
    </strong>
    <span class="koboSpan" id="kobo.34.1">
     ),
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.35.1">
      Blowfish
     </span>
    </strong>
    <span class="koboSpan" id="kobo.36.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.37.1">
      Twofish
     </span>
    </strong>
    <span class="koboSpan" id="kobo.38.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.39.1">
      Elliptic Curve Cryptography
     </span>
    </strong>
    <span class="koboSpan" id="kobo.40.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.41.1">
      ECC
     </span>
    </strong>
    <span class="koboSpan" id="kobo.42.1">
     ),
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.43.1">
      International Data Encryption Algorithm
     </span>
    </strong>
    <span class="koboSpan" id="kobo.44.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.45.1">
      IDEA
     </span>
    </strong>
    <span class="koboSpan" id="kobo.46.1">
     ), and
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.47.1">
      Pretty Good
     </span>
    </strong>
    <span class="No-Break">
     <strong class="bold">
      <span class="koboSpan" id="kobo.48.1">
       Privacy
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.49.1">
      (
     </span>
    </span>
    <span class="No-Break">
     <strong class="bold">
      <span class="koboSpan" id="kobo.50.1">
       PGP
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.51.1">
      ).
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.52.1">
     You might be wondering, if encryption algorithms are public knowledge, what’s to prevent anyone from decrypting the data?
    </span>
    <span class="koboSpan" id="kobo.52.2">
     The answer
    </span>
    <a id="_idIndexMarker384">
    </a>
    <span class="koboSpan" id="kobo.53.1">
     lies in the use of
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.54.1">
      encryption keys
     </span>
    </strong>
    <span class="koboSpan" id="kobo.55.1">
     – unique strings of characters that safeguard data when used alongside the algorithm.
    </span>
    <span class="koboSpan" id="kobo.55.2">
     There are two primary types of encryptions:
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.56.1">
      symmetric
     </span>
    </strong>
    <span class="koboSpan" id="kobo.57.1">
     and
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.58.1">
      asymmetric
     </span>
    </strong>
    <span class="koboSpan" id="kobo.59.1">
     .
    </span>
    <span class="koboSpan" id="kobo.59.2">
     Symmetric encryption employs the same
    </span>
    <a id="_idIndexMarker385">
    </a>
    <span class="koboSpan" id="kobo.60.1">
     key for both encryption and decryption, necessitating that this key be kept confidential between the parties involved.
    </span>
    <span class="koboSpan" id="kobo.60.2">
     Asymmetric encryption, in contrast, utilizes
    </span>
    <a id="_idIndexMarker386">
    </a>
    <span class="koboSpan" id="kobo.61.1">
     a key pair – one key for encryption and the other for decryption.
    </span>
    <span class="koboSpan" id="kobo.61.2">
     For instance, a public key, which can be openly shared, can be used for encryption, and a private key, which is strictly guarded by the intended recipient, can be used for decryption.
    </span>
    <span class="koboSpan" id="kobo.61.3">
     Thus, the privacy of encrypted data remains protected, even with the widespread knowledge of the algorithm, due to the confidential nature of the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.62.1">
      encryption keys.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.63.1">
     AWS
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.64.1">
      Key Management Service
     </span>
    </strong>
    <span class="koboSpan" id="kobo.65.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.66.1">
      KMS
     </span>
    </strong>
    <span class="koboSpan" id="kobo.67.1">
     ) is the primary service within the AWS
    </span>
    <a id="_idIndexMarker387">
    </a>
    <span class="koboSpan" id="kobo.68.1">
     cloud that helps us create and manage encryption keys and is the primary focus of this chapter.
    </span>
    <span class="koboSpan" id="kobo.68.2">
     KMS supports both symmetric and asymmetric encryption keys.
    </span>
    <span class="koboSpan" id="kobo.68.3">
     Based
    </span>
    <a id="_idIndexMarker388">
    </a>
    <span class="koboSpan" id="kobo.69.1">
     on ownership, we
    </span>
    <a id="_idIndexMarker389">
    </a>
    <span class="koboSpan" id="kobo.70.1">
     can categorize KMS keys as
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.71.1">
      customer-managed keys
     </span>
    </strong>
    <span class="koboSpan" id="kobo.72.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.73.1">
      AWS-managed keys
     </span>
    </strong>
    <span class="koboSpan" id="kobo.74.1">
     , and
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.75.1">
      AWS-owned keys
     </span>
    </strong>
    <span class="koboSpan" id="kobo.76.1">
     .
    </span>
    <span class="koboSpan" id="kobo.76.2">
     With customer-managed
    </span>
    <a id="_idIndexMarker390">
    </a>
    <span class="koboSpan" id="kobo.77.1">
     keys, we create and manage keys.
    </span>
    <span class="koboSpan" id="kobo.77.2">
     With AWS-managed keys, AWS creates a key in our account for a particular service, such as S3, EBS, and so on, and manages the key for us.
    </span>
    <span class="koboSpan" id="kobo.77.3">
     AWS also has another key type called AWS-owned keys that AWS creates and manages for use cases such as default encryption for services such as S3.
    </span>
    <span class="koboSpan" id="kobo.77.4">
     With both customer-managed and AWS-managed keys, we have visibility into various keys and their usage through CloudTrail logs.
    </span>
    <span class="koboSpan" id="kobo.77.5">
     However, with AWS-owned keys, we do not have
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.78.1">
      any visibility.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.79.1">
     In this chapter, we will learn how to work with AWS
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.80.1">
      CloudHSM
     </span>
    </strong>
    <span class="koboSpan" id="kobo.81.1">
     .
    </span>
    <span class="koboSpan" id="kobo.81.2">
     CloudHSM is another service within AWS that allows us to manage encryption keys but uses dedicated HSMs for enhanced security.
    </span>
    <span class="koboSpan" id="kobo.81.3">
     KMS
    </span>
    <a id="_idIndexMarker391">
    </a>
    <span class="koboSpan" id="kobo.82.1">
     makes use of shared
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.83.1">
      hardware security
     </span>
    </strong>
    <span class="No-Break">
     <strong class="bold">
      <span class="koboSpan" id="kobo.84.1">
       modules
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.85.1">
      (
     </span>
    </span>
    <span class="No-Break">
     <strong class="bold">
      <span class="koboSpan" id="kobo.86.1">
       HSMs
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.87.1">
      ).
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.88.1">
     In this chapter, we will cover the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.89.1">
      following recipes:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.90.1">
      Creating keys
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.91.1">
       in KMS
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.92.1">
      Creating keys with external key
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.93.1">
       material (BYOK)
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.94.1">
      Rotating keys
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.95.1">
       in KMS
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.96.1">
      Granting permissions programmatically
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.97.1">
       with grants
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.98.1">
      Using key policies with
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.99.1">
       conditional keys
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.100.1">
      Sharing customer-managed keys
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.101.1">
       across accounts
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.102.1">
      Creating, initializing, and activating a
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.103.1">
       CloudHSM cluster
      </span>
     </span>
    </li>
   </ul>
   <h1 id="_idParaDest-89">
    <a id="_idTextAnchor090">
    </a>
    <span class="koboSpan" id="kobo.104.1">
     Technical requirements
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.105.1">
     Before diving into the recipes in this chapter, we need to ensure we have the following requirements
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.106.1">
      in place:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.107.1">
      We need an active AWS account to complete the recipes in this chapter.
     </span>
     <span class="koboSpan" id="kobo.107.2">
      We can use an account that is part of AWS Organizations or a standalone account.
     </span>
     <span class="koboSpan" id="kobo.107.3">
      I will be using the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.108.1">
       awsseccb-sandbox-1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.109.1">
      account that we created in the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.110.1">
       Multi-account management with AWS Organizations
      </span>
     </em>
     <span class="koboSpan" id="kobo.111.1">
      recipe in
     </span>
     <a href="B21384_01.xhtml#_idTextAnchor020">
      <span class="No-Break">
       <em class="italic">
        <span class="koboSpan" id="kobo.112.1">
         Chapter 1
        </span>
       </em>
      </span>
     </a>
     <span class="koboSpan" id="kobo.113.1">
      .
     </span>
     <span class="koboSpan" id="kobo.113.2">
      However, I won’t be utilizing any AWS Organizations features, meaning you can follow these steps with a standalone
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.114.1">
       account too.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.115.1">
      For administrative actions, we need a user who has
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.116.1">
       AdministratorAccess
      </span>
     </strong>
     <span class="koboSpan" id="kobo.117.1">
      permission to the AWS account we are working with.
     </span>
     <span class="koboSpan" id="kobo.117.2">
      This can be an
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.118.1">
       IAM Identity Center user
      </span>
     </strong>
     <span class="koboSpan" id="kobo.119.1">
      or an IAM user.
     </span>
     <span class="koboSpan" id="kobo.119.2">
      I will be using the IAM Identity Center user
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.120.1">
       awsseccbadmin1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.121.1">
      we created in the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.122.1">
       User management and SSO with IAM Identity Center
      </span>
     </em>
     <span class="koboSpan" id="kobo.123.1">
      recipe in
     </span>
     <a href="B21384_01.xhtml#_idTextAnchor020">
      <span class="No-Break">
       <em class="italic">
        <span class="koboSpan" id="kobo.124.1">
         Chapter 1
        </span>
       </em>
      </span>
     </a>
     <span class="koboSpan" id="kobo.125.1">
      .
     </span>
     <span class="koboSpan" id="kobo.125.2">
      However, I won’t be utilizing any IAM Identity Center features, meaning you can follow these steps with an IAM user, too, if the user has
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.126.1">
       AdministratorAccess
      </span>
     </strong>
     <span class="koboSpan" id="kobo.127.1">
      permission within the account.
     </span>
     <span class="koboSpan" id="kobo.127.2">
      You can create an IAM user by following the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.128.1">
       Setting up IAM, account aliases, and billing alerts
      </span>
     </em>
     <span class="koboSpan" id="kobo.129.1">
      recipe in
     </span>
     <a href="B21384_01.xhtml#_idTextAnchor020">
      <span class="No-Break">
       <em class="italic">
        <span class="koboSpan" id="kobo.130.1">
         Chapter 1
        </span>
       </em>
      </span>
     </a>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.131.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.132.1">
      Basic knowledge of encryption, including symmetric keys, asymmetric keys, and
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.133.1">
       public key infrastructure
      </span>
     </strong>
     <span class="koboSpan" id="kobo.134.1">
      (
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.135.1">
       PKI
      </span>
     </strong>
     <span class="koboSpan" id="kobo.136.1">
      ) will help you understand the recipes within
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.137.1">
       this chapter.
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.138.1">
     The code files for this book are available at
    </span>
    <a href="https://github.com/PacktPublishing/AWS-Security-Cookbook-Second-Edition">
     <span class="koboSpan" id="kobo.139.1">
      https://github.com/PacktPublishing/AWS-Security-Cookbook-Second-Edition
     </span>
    </a>
    <span class="koboSpan" id="kobo.140.1">
     .
    </span>
    <span class="koboSpan" id="kobo.140.2">
     The code files for this chapter are available
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.141.1">
      at
     </span>
    </span>
    <a href="https://github.com/PacktPublishing/AWS-Security-Cookbook-Second-Edition/tree/main/Chapter03">
     <span class="No-Break">
      <span class="koboSpan" id="kobo.142.1">
       https://github.com/PacktPublishing/AWS-Security-Cookbook-Second-Edition/tree/main/Chapter03
      </span>
     </span>
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.143.1">
      .
     </span>
    </span>
   </p>
   <h1 id="_idParaDest-90">
    <a id="_idTextAnchor091">
    </a>
    <span class="koboSpan" id="kobo.144.1">
     Creating keys in KMS
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.145.1">
     In this recipe, we will create
    </span>
    <a id="_idIndexMarker392">
    </a>
    <span class="koboSpan" id="kobo.146.1">
     a customer-managed KMS key with the key type set to
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.147.1">
      symmetric key
     </span>
    </strong>
    <span class="koboSpan" id="kobo.148.1">
     .
    </span>
    <span class="koboSpan" id="kobo.148.2">
     A symmetric key is the most
    </span>
    <a id="_idIndexMarker393">
    </a>
    <span class="koboSpan" id="kobo.149.1">
     common key that we will create with KMS.
    </span>
    <span class="koboSpan" id="kobo.149.2">
     It is also worth noting that KMS keys, which are the primary resources within
    </span>
    <a id="_idIndexMarker394">
    </a>
    <span class="koboSpan" id="kobo.150.1">
     KMS, were once known as
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.151.1">
      customer master keys
     </span>
    </strong>
    <span class="koboSpan" id="kobo.152.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.153.1">
      CMKs
     </span>
    </strong>
    <span class="koboSpan" id="kobo.154.1">
     ).
    </span>
    <span class="koboSpan" id="kobo.154.2">
     This renaming helps avoid confusion with the term customer-managed keys, which could also be abbreviated
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.155.1">
      as CMKs.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-91">
    <a id="_idTextAnchor092">
    </a>
    <span class="koboSpan" id="kobo.156.1">
     Getting ready
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.157.1">
     We’ll need the following
    </span>
    <a id="_idIndexMarker395">
    </a>
    <span class="koboSpan" id="kobo.158.1">
     to complete
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.159.1">
      this recipe:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.160.1">
      A working AWS account (
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.161.1">
       awsseccb-sandbox-1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.162.1">
      ) and a user (
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.163.1">
       awsseccbadmin1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.164.1">
      ), as described in the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.165.1">
       Technical
      </span>
     </em>
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.166.1">
        requirements
       </span>
      </em>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.167.1">
       section.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.168.1">
      Two users or roles.
     </span>
     <span class="koboSpan" id="kobo.168.2">
      These could be IAM users or roles, including those corresponding to IAM Identity Center users.
     </span>
     <span class="koboSpan" id="kobo.168.3">
      I will be using the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.169.1">
       awsseccb_admin1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.170.1">
      user as the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.171.1">
       key administrator
      </span>
     </strong>
     <span class="koboSpan" id="kobo.172.1">
      .
     </span>
     <span class="koboSpan" id="kobo.172.2">
      Key administrators
     </span>
     <a id="_idIndexMarker396">
     </a>
     <span class="koboSpan" id="kobo.173.1">
      can administer the key through the KMS API.
     </span>
     <span class="koboSpan" id="kobo.173.2">
      I will use another user,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.174.1">
       awsseccb_user1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.175.1">
      , as the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.176.1">
       key user
      </span>
     </strong>
     <span class="koboSpan" id="kobo.177.1">
      .
     </span>
     <span class="koboSpan" id="kobo.177.2">
      Key users can use
     </span>
     <a id="_idIndexMarker397">
     </a>
     <span class="koboSpan" id="kobo.178.1">
      the customer-managed key to encrypt and decrypt data.
     </span>
     <span class="koboSpan" id="kobo.178.2">
      We can even use the same user as both a key administrator and a key user.
     </span>
     <span class="koboSpan" id="kobo.178.3">
      I will also explain how we can use a role corresponding to an IAM Identity Center user as a key administrator or
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.179.1">
       key user.
      </span>
     </span>
    </li>
   </ul>
   <h2 id="_idParaDest-92">
    <a id="_idTextAnchor093">
    </a>
    <span class="koboSpan" id="kobo.180.1">
     How to do it...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.181.1">
     We can create a customer-managed key in KMS from the console
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.182.1">
      as follows:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.183.1">
      Log in to the AWS Management Console and go to
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.184.1">
       Key
      </span>
     </strong>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.185.1">
        Management Service
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.186.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.187.1">
      Click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.188.1">
       Customer-managed keys
      </span>
     </strong>
     <span class="koboSpan" id="kobo.189.1">
      from the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.190.1">
       left sidebar.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.191.1">
      Click
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.192.1">
        Create key
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.193.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.194.1">
      In the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.195.1">
       Configure key
      </span>
     </strong>
     <span class="koboSpan" id="kobo.196.1">
      step, as shown in the following figure, select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.197.1">
       Symmetric
      </span>
     </strong>
     <span class="koboSpan" id="kobo.198.1">
      for
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.199.1">
       Key type
      </span>
     </strong>
     <span class="koboSpan" id="kobo.200.1">
      , and choose
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.201.1">
       Encrypt and decrypt
      </span>
     </strong>
     <span class="koboSpan" id="kobo.202.1">
      for
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.203.1">
        Key usage
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.204.1">
       :
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer076">
     <span class="koboSpan" id="kobo.205.1">
      <img alt="Figure 3.1 – Configuring Key type and Key usage" src="image/B21384_03_1.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.206.1">
     Figure 3.1 – Configuring Key type and Key usage
    </span>
   </p>
   <ol>
    <li value="5">
     <span class="koboSpan" id="kobo.207.1">
      Expand
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.208.1">
       Advanced options
      </span>
     </strong>
     <span class="koboSpan" id="kobo.209.1">
      and verify
     </span>
     <a id="_idIndexMarker398">
     </a>
     <span class="koboSpan" id="kobo.210.1">
      that
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.211.1">
       Key material origin
      </span>
     </strong>
     <span class="koboSpan" id="kobo.212.1">
      is set to
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.213.1">
       KMS - recommended
      </span>
     </strong>
     <span class="koboSpan" id="kobo.214.1">
      and
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.215.1">
       Regionality
      </span>
     </strong>
     <span class="koboSpan" id="kobo.216.1">
      is set to
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.217.1">
       Single-region key
      </span>
     </strong>
     <span class="koboSpan" id="kobo.218.1">
      , as shown in the following figure.
     </span>
     <span class="koboSpan" id="kobo.218.2">
      Then, click
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.219.1">
       Next
      </span>
     </strong>
     <span class="koboSpan" id="kobo.220.1">
      to proceed to the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.221.1">
       Add
      </span>
     </strong>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.222.1">
        labels
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.223.1">
       steps:
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer077">
     <span class="koboSpan" id="kobo.224.1">
      <img alt="Figure 3.2 – Advanced options" src="image/B21384_03_2.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.225.1">
     Figure 3.2 – Advanced options
    </span>
   </p>
   <ol>
    <li value="6">
     <span class="koboSpan" id="kobo.226.1">
      In the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.227.1">
       Add labels
      </span>
     </strong>
     <span class="koboSpan" id="kobo.228.1">
      step, enter
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.229.1">
       seccb-dev-encryption
      </span>
     </strong>
     <span class="koboSpan" id="kobo.230.1">
      for
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.231.1">
       Alias
      </span>
     </strong>
     <span class="koboSpan" id="kobo.232.1">
      and
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.233.1">
       Dev Encryption Key for the Sec CB project
      </span>
     </strong>
     <span class="koboSpan" id="kobo.234.1">
      for
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.235.1">
       Description
      </span>
     </strong>
     <span class="koboSpan" id="kobo.236.1">
      .
     </span>
     <span class="koboSpan" id="kobo.236.2">
      Optionally, add tags
     </span>
     <a id="_idIndexMarker399">
     </a>
     <span class="koboSpan" id="kobo.237.1">
      by clicking on the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.238.1">
       Add tag
      </span>
     </strong>
     <span class="koboSpan" id="kobo.239.1">
      button.
     </span>
     <span class="koboSpan" id="kobo.239.2">
      Click
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.240.1">
       Next
      </span>
     </strong>
     <span class="koboSpan" id="kobo.241.1">
      to proceed to the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.242.1">
       Define key administrative
      </span>
     </strong>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.243.1">
        permissions
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.244.1">
       step.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.245.1">
      In the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.246.1">
       Define key administrative permissions
      </span>
     </strong>
     <span class="koboSpan" id="kobo.247.1">
      step, select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.248.1">
       Key administrators
      </span>
     </strong>
     <span class="koboSpan" id="kobo.249.1">
      , who are the IAM users and roles who can administer this key through the KMS API.
     </span>
     <span class="koboSpan" id="kobo.249.2">
      I have selected
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.250.1">
       awsseccb_admin1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.251.1">
      .
     </span>
     <span class="koboSpan" id="kobo.251.2">
      However, as we can see, if we are using an IAM Identity Center user, we can select a role corresponding to the combination of that IAM
     </span>
     <a id="_idIndexMarker400">
     </a>
     <span class="koboSpan" id="kobo.252.1">
      Identity Center user and a
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.253.1">
        permission set
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.254.1">
       .
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer078">
     <span class="koboSpan" id="kobo.255.1">
      <img alt="Figure 3.3 – Defining key administrative permissions" src="image/B21384_03_3.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.256.1">
     Figure 3.3 – Defining key administrative permissions
    </span>
   </p>
   <ol>
    <li value="8">
     <span class="koboSpan" id="kobo.257.1">
      For
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.258.1">
       Key deletion
      </span>
     </strong>
     <span class="koboSpan" id="kobo.259.1">
      , check
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.260.1">
       Allow key administrators to delete this key
      </span>
     </strong>
     <span class="koboSpan" id="kobo.261.1">
      .
     </span>
     <span class="koboSpan" id="kobo.261.2">
      Click
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.262.1">
       Next
      </span>
     </strong>
     <span class="koboSpan" id="kobo.263.1">
      to proceed
     </span>
     <a id="_idIndexMarker401">
     </a>
     <span class="koboSpan" id="kobo.264.1">
      to the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.265.1">
       Define key usage
      </span>
     </strong>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.266.1">
        permissions
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.267.1">
       step.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.268.1">
      Regarding the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.269.1">
       Define key usage permissions
      </span>
     </strong>
     <span class="koboSpan" id="kobo.270.1">
      step, select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.271.1">
       Key users
      </span>
     </strong>
     <span class="koboSpan" id="kobo.272.1">
      , who are IAM users and roles who can use the customer-managed key to encrypt and decrypt data.
     </span>
     <span class="koboSpan" id="kobo.272.2">
      In the same step, we can optionally add
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.273.1">
       Other AWS accounts
      </span>
     </strong>
     <span class="koboSpan" id="kobo.274.1">
      that can use this key.
     </span>
     <span class="koboSpan" id="kobo.274.2">
      I have selected the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.275.1">
       awsseccb_user1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.276.1">
      user.
     </span>
     <span class="koboSpan" id="kobo.276.2">
      Similar to
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.277.1">
       Step 7
      </span>
     </em>
     <span class="koboSpan" id="kobo.278.1">
      , if we are using an IAM Identity Center user, we can select a role corresponding to the combination of that IAM Identity Center user and a permission set.
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.279.1">
       Click
      </span>
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.280.1">
        Next
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.281.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.282.1">
      Review
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.283.1">
       Key configuration
      </span>
     </strong>
     <span class="koboSpan" id="kobo.284.1">
      ,
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.285.1">
       Alias and description
      </span>
     </strong>
     <span class="koboSpan" id="kobo.286.1">
      ,
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.287.1">
       Tags
      </span>
     </strong>
     <span class="koboSpan" id="kobo.288.1">
      , and
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.289.1">
       Key policy
      </span>
     </strong>
     <span class="koboSpan" id="kobo.290.1">
      in JSON format.
     </span>
     <span class="koboSpan" id="kobo.290.2">
      Click
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.291.1">
       Finish
      </span>
     </strong>
     <span class="koboSpan" id="kobo.292.1">
      to create the key.
     </span>
     <span class="koboSpan" id="kobo.292.2">
      We should see a message stating that the key has been created, as well as details of the key ID, as shown in the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.293.1">
       following figure:
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer079">
     <span class="koboSpan" id="kobo.294.1">
      <img alt="Figure 3.4 – Key creation success message" src="image/B21384_03_4.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.295.1">
     Figure 3.4 – Key creation success message
    </span>
   </p>
   <p class="list-inset">
    <span class="koboSpan" id="kobo.296.1">
     The key policy that’s generated by AWS is kept within the code files for reference
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.297.1">
      as
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.298.1">
       generated-key-policy.json
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.299.1">
      .
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.300.1">
     In this recipe, we created
    </span>
    <a id="_idIndexMarker402">
    </a>
    <span class="koboSpan" id="kobo.301.1">
     a KMS key.
    </span>
    <span class="koboSpan" id="kobo.301.2">
     We will go through some important concepts related to KMS keys in the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.302.1">
      next section.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-93">
    <a id="_idTextAnchor094">
    </a>
    <span class="koboSpan" id="kobo.303.1">
     How it works...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.304.1">
     Creating encryption keys within AWS KMS involves a straightforward process.
    </span>
    <span class="koboSpan" id="kobo.304.2">
     First, we need an active AWS account with an IAM or IAM Identity Center user with administrative privileges to create and manage keys.
    </span>
    <span class="koboSpan" id="kobo.304.3">
     We should have the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.305.1">
      kms:CreateKey
     </span>
    </strong>
    <span class="koboSpan" id="kobo.306.1">
     permission to create new KMS keys.
    </span>
    <span class="koboSpan" id="kobo.306.2">
     To add tags, we need
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.307.1">
      kms:TagResource
     </span>
    </strong>
    <span class="koboSpan" id="kobo.308.1">
     permission.
    </span>
    <span class="koboSpan" id="kobo.308.2">
     We used a user with
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.309.1">
      AdministratorAccess
     </span>
    </strong>
    <span class="koboSpan" id="kobo.310.1">
     for this recipe and hence had both of
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.311.1">
      these permissions.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.312.1">
     While configuring the key, we selected the symmetric KMS key option for general encryption and decryption purposes, as shown in
    </span>
    <span class="No-Break">
     <em class="italic">
      <span class="koboSpan" id="kobo.313.1">
       Figure 3
      </span>
     </em>
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.314.1">
      .1
     </span>
    </em>
    <span class="koboSpan" id="kobo.315.1">
     .
    </span>
    <span class="koboSpan" id="kobo.315.2">
     In the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.316.1">
      Advanced options
     </span>
    </strong>
    <span class="koboSpan" id="kobo.317.1">
     section, we
    </span>
    <a id="_idIndexMarker403">
    </a>
    <span class="koboSpan" id="kobo.318.1">
     selected the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.319.1">
      key material
     </span>
    </strong>
    <span class="koboSpan" id="kobo.320.1">
     origin as KMS, which is the recommended option.
    </span>
    <span class="koboSpan" id="kobo.320.2">
     In the world of cryptography, key material refers to the string of bits that are used in a cryptographic algorithm and is the core element that encrypts and decrypts our data.
    </span>
    <span class="koboSpan" id="kobo.320.3">
     Each AWS KMS key is associated with a key material, as referenced in its metadata.
    </span>
    <span class="koboSpan" id="kobo.320.4">
     By default, AWS is responsible for creating the key material using FIPS-validated hardware security modules, and it never leaves AWS KMS unencrypted.
    </span>
    <span class="koboSpan" id="kobo.320.5">
     The sole exception lies in the public keys of asymmetric key pairs, which can be exported for
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.321.1">
      outside use.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.322.1">
     The key material’s origin is a specific attribute of a KMS key in AWS KMS, which indicates the source from which its key material is derived.
    </span>
    <span class="koboSpan" id="kobo.322.2">
     The key material origin values for a KMS key can be one of the following, as we saw in
    </span>
    <span class="No-Break">
     <em class="italic">
      <span class="koboSpan" id="kobo.323.1">
       Figure 3
      </span>
     </em>
    </span>
    <span class="No-Break">
     <em class="italic">
      <span class="koboSpan" id="kobo.324.1">
       .2
      </span>
     </em>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.325.1">
      :
     </span>
    </span>
   </p>
   <ul>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.326.1">
       KMS - recommended
      </span>
     </strong>
     <span class="koboSpan" id="kobo.327.1">
      is the default and most recommended.
     </span>
     <span class="koboSpan" id="kobo.327.2">
      If we select this option, AWS handles the creation and management of the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.328.1">
       key material.
      </span>
     </span>
    </li>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.329.1">
       External (Import key material)
      </span>
     </strong>
     <span class="koboSpan" id="kobo.330.1">
      is for people who prefer to import their own key material.
     </span>
     <span class="koboSpan" id="kobo.330.2">
      This requires us to manage and secure
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.331.1">
       this material.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.332.1">
      With
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.333.1">
       AWS CloudHSM key store
      </span>
     </strong>
     <span class="koboSpan" id="kobo.334.1">
      , AWS KMS creates the key material in our AWS
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.335.1">
       CloudHSM cluster.
      </span>
     </span>
    </li>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.336.1">
       External key store
      </span>
     </strong>
     <span class="koboSpan" id="kobo.337.1">
      is used when the key material is in an external key manager outside AWS.
     </span>
     <span class="koboSpan" id="kobo.337.2">
      This is specific to KMS keys in an external
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.338.1">
       key store.
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.339.1">
     As we saw in
    </span>
    <span class="No-Break">
     <em class="italic">
      <span class="koboSpan" id="kobo.340.1">
       Figure 3
      </span>
     </em>
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.341.1">
      .3
     </span>
    </em>
    <span class="koboSpan" id="kobo.342.1">
     , we can assign IAM users
    </span>
    <a id="_idIndexMarker404">
    </a>
    <span class="koboSpan" id="kobo.343.1">
     or roles as key administrators.
    </span>
    <span class="koboSpan" id="kobo.343.2">
     Key administrators are the IAM users and roles who can administer this key through the KMS API.
    </span>
    <span class="koboSpan" id="kobo.343.3">
     We also chose the option to allow key administrators to delete the key.
    </span>
    <span class="koboSpan" id="kobo.343.4">
     Similarly, we can assign IAM users or roles as key users.
    </span>
    <span class="koboSpan" id="kobo.343.5">
     Key users are IAM users and roles that can use the customer-managed key to encrypt and
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.344.1">
      decrypt data.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.345.1">
     A KMS key policy is a JSON document that specifies who can access the key and under what conditions.
    </span>
    <span class="koboSpan" id="kobo.345.2">
     Along with the key, AWS will create a default key policy and assign required permissions for the key administrators and key users we select.
    </span>
    <span class="koboSpan" id="kobo.345.3">
     If we explore the generated key policy, we should be able to see the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.346.1">
      kms:Create*
     </span>
    </strong>
    <span class="koboSpan" id="kobo.347.1">
     ,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.348.1">
      kms:Describe*
     </span>
    </strong>
    <span class="koboSpan" id="kobo.349.1">
     ,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.350.1">
      kms:Enable*
     </span>
    </strong>
    <span class="koboSpan" id="kobo.351.1">
     ,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.352.1">
      kms:List*
     </span>
    </strong>
    <span class="koboSpan" id="kobo.353.1">
     ,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.354.1">
      kms:Put*
     </span>
    </strong>
    <span class="koboSpan" id="kobo.355.1">
     ,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.356.1">
      kms:Update*
     </span>
    </strong>
    <span class="koboSpan" id="kobo.357.1">
     ,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.358.1">
      kms:Revoke*
     </span>
    </strong>
    <span class="koboSpan" id="kobo.359.1">
     ,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.360.1">
      kms:Disable*
     </span>
    </strong>
    <span class="koboSpan" id="kobo.361.1">
     ,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.362.1">
      kms:Get*
     </span>
    </strong>
    <span class="koboSpan" id="kobo.363.1">
     ,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.364.1">
      kms:Delete*
     </span>
    </strong>
    <span class="koboSpan" id="kobo.365.1">
     ,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.366.1">
      kms:TagResource
     </span>
    </strong>
    <span class="koboSpan" id="kobo.367.1">
     ,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.368.1">
      kms:UntagResource
     </span>
    </strong>
    <span class="koboSpan" id="kobo.369.1">
     ,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.370.1">
      kms:ScheduleKeyDeletion
     </span>
    </strong>
    <span class="koboSpan" id="kobo.371.1">
     , and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.372.1">
      kms:CancelKeyDeletion
     </span>
    </strong>
    <span class="koboSpan" id="kobo.373.1">
     permissions for key administators.
    </span>
    <span class="koboSpan" id="kobo.373.2">
     For key users, we should see the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.374.1">
      kms:Encrypt
     </span>
    </strong>
    <span class="koboSpan" id="kobo.375.1">
     ,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.376.1">
      kms:Decrypt
     </span>
    </strong>
    <span class="koboSpan" id="kobo.377.1">
     ,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.378.1">
      kms:ReEncrypt*
     </span>
    </strong>
    <span class="koboSpan" id="kobo.379.1">
     ,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.380.1">
      kms:GenerateDataKey*
     </span>
    </strong>
    <span class="koboSpan" id="kobo.381.1">
     , and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.382.1">
      kms:DescribeKey
     </span>
    </strong>
    <span class="koboSpan" id="kobo.383.1">
     permissions.
    </span>
    <span class="koboSpan" id="kobo.383.2">
     These permissions should also give us an idea about the operations we can perform
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.384.1">
      within KMS.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-94">
    <a id="_idTextAnchor095">
    </a>
    <span class="koboSpan" id="kobo.385.1">
     There’s more...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.386.1">
     In this recipe, we created a key using the standard options available within KMS.
    </span>
    <span class="koboSpan" id="kobo.386.2">
     We can configure these options based on our requirements.
    </span>
    <span class="koboSpan" id="kobo.386.3">
     For example, in this recipe, we chose the option to allow key administrators to delete the key.
    </span>
    <span class="koboSpan" id="kobo.386.4">
     Based on our security requirements, we may unselect this option to not allow key administrators to delete
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.387.1">
      the key.
     </span>
    </span>
   </p>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.388.1">
     Tip
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.389.1">
     Play around with all the options available within KMS and get familiar with them.
    </span>
    <span class="koboSpan" id="kobo.389.2">
     This will help you decide on what options to choose when you are faced with a scenario at work, in an exam, or in
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.390.1">
      an interview.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.391.1">
     Let’s quickly go through some important points
    </span>
    <a id="_idIndexMarker405">
    </a>
    <span class="koboSpan" id="kobo.392.1">
     about the AWS
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.393.1">
      KMS service:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.394.1">
      We created a symmetric key in this recipe.
     </span>
     <span class="koboSpan" id="kobo.394.2">
      AWS KMS also has support for asymmetric keys.
     </span>
     <span class="koboSpan" id="kobo.394.3">
      AWS KMS allows you to create and manage asymmetric key pairs for encryption and signing, facilitating scenarios that require PKI, such as encrypting data so that only the private key holder can decrypt it, or signing data for
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.395.1">
       sender verification.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.396.1">
      AWS KMS keys can encrypt data up to 4 KB in size and hence are generally used to encrypt
     </span>
     <a id="_idIndexMarker406">
     </a>
     <span class="koboSpan" id="kobo.397.1">
      other keys, such as
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.398.1">
       data keys
      </span>
     </strong>
     <span class="koboSpan" id="kobo.399.1">
      .
     </span>
     <span class="koboSpan" id="kobo.399.2">
      These data keys are then used to encrypt the actual data.
     </span>
     <span class="koboSpan" id="kobo.399.3">
      These data keys are not created and managed within the AWS
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.400.1">
       KMS service.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.401.1">
      KMS is a region-specific service and, hence, the keys managed by KMS are region-specific.
     </span>
     <span class="koboSpan" id="kobo.401.2">
      Therefore, to use KMS keys, the respective services should also be in the same region.
     </span>
     <span class="koboSpan" id="kobo.401.3">
      For example, to use the key that we created for encrypting S3 data, the S3 bucket needs to be in the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.402.1">
       same region.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.403.1">
      KMS supports a feature called
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.404.1">
       multi-region keys
      </span>
     </strong>
     <span class="koboSpan" id="kobo.405.1">
      , which allows data
     </span>
     <a id="_idIndexMarker407">
     </a>
     <span class="koboSpan" id="kobo.406.1">
      to be decrypted in a region different from the one where it was encrypted.
     </span>
     <span class="koboSpan" id="kobo.406.2">
      It is important to note that these keys are not currently global.
     </span>
     <span class="koboSpan" id="kobo.406.3">
      Instead, there is a primary key that is replicated to replica keys in
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.407.1">
       other regions.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.408.1">
      A user with S3 administrator permissions will not have permission to view a file encrypted using KMS key encryption unless they are a key user for the key being used to encrypt
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.409.1">
       that file.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.410.1">
      Key administrators do not have permission to encrypt or decrypt data using those keys.
     </span>
     <span class="koboSpan" id="kobo.410.2">
      Key administrators, however, can modify the key policy to add themselves as key users.
     </span>
     <span class="koboSpan" id="kobo.410.3">
      This is where the audit and logging services
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.411.1">
       become important.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.412.1">
      AWS KMS integrates with AWS CloudTrail to provide logs of all key usage to help meet compliance and regulatory requirements.
     </span>
     <span class="koboSpan" id="kobo.412.2">
      This integration allows users to track when and who used KMS keys for encryption and decryption, providing an audit trail that can be crucial for forensic analysis and
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.413.1">
       compliance audits.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.414.1">
      We cannot directly delete a key.
     </span>
     <span class="koboSpan" id="kobo.414.2">
      A key administrator can disable and/or schedule a key for deletion.
     </span>
     <span class="koboSpan" id="kobo.414.3">
      At the time of writing, the administrator can specify a waiting period between 7 and 30 days inclusive while scheduling a key deletion.
     </span>
     <span class="koboSpan" id="kobo.414.4">
      With multi-region keys, we need to first delete the replica keys; only then can we delete the primary key.
     </span>
     <span class="koboSpan" id="kobo.414.5">
      Therefore, the minimum number of days to delete a multi-region key is 14 days: 7 days for deleting the replica keys and 7 days for deleting the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.415.1">
       primary key.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.416.1">
      Once a key has been disabled, we cannot decrypt any data that is encrypted with that key until we enable that
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.417.1">
       key again.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.418.1">
      Once a key has been deleted, we cannot decrypt
     </span>
     <a id="_idIndexMarker408">
     </a>
     <span class="koboSpan" id="kobo.419.1">
      any data encrypted with
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.420.1">
       that key.
      </span>
     </span>
    </li>
   </ul>
   <h2 id="_idParaDest-95">
    <a id="_idTextAnchor096">
    </a>
    <span class="koboSpan" id="kobo.421.1">
     See also
    </span>
   </h2>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.422.1">
      A good understanding of encryption can help you better understand the AWS KMS service.
     </span>
     <span class="koboSpan" id="kobo.422.2">
      You can learn
     </span>
     <a id="_idIndexMarker409">
     </a>
     <span class="koboSpan" id="kobo.423.1">
      about encryption
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.424.1">
       here:
      </span>
     </span>
     <a href="https://www.secdops.com/blog/getting-started-with-encryption">
      <span class="No-Break">
       <span class="koboSpan" id="kobo.425.1">
        https://www.secdops.com/blog/getting-started-with-encryption
       </span>
      </span>
     </a>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.426.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.427.1">
      AWS KMS is a service with a lot of features.
     </span>
     <span class="koboSpan" id="kobo.427.2">
      You can start reading more about KMS
     </span>
     <a id="_idIndexMarker410">
     </a>
     <span class="koboSpan" id="kobo.428.1">
      and its features
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.429.1">
       here:
      </span>
     </span>
     <a href="https://www.cloudericks.com/blog/getting-started-with-aws-key-management-service-kms">
      <span class="No-Break">
       <span class="koboSpan" id="kobo.430.1">
        https://www.cloudericks.com/blog/getting-started-with-aws-key-management-service-kms
       </span>
      </span>
     </a>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.431.1">
       .
      </span>
     </span>
    </li>
   </ul>
   <h1 id="_idParaDest-96">
    <a id="_idTextAnchor097">
    </a>
    <span class="koboSpan" id="kobo.432.1">
     Creating keys with external key material (BYOK)
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.433.1">
     When we create keys
    </span>
    <a id="_idIndexMarker411">
    </a>
    <span class="koboSpan" id="kobo.434.1">
     within AWS KMS, AWS creates
    </span>
    <a id="_idIndexMarker412">
    </a>
    <span class="koboSpan" id="kobo.435.1">
     and manages the key material for that key.
    </span>
    <span class="koboSpan" id="kobo.435.2">
     We can also create keys using our own key material that has been created outside of AWS.
    </span>
    <span class="koboSpan" id="kobo.435.3">
     In this recipe, we will learn how to import a key material into AWS KMS.
    </span>
    <span class="koboSpan" id="kobo.435.4">
     Using external
    </span>
    <a id="_idIndexMarker413">
    </a>
    <span class="koboSpan" id="kobo.436.1">
     key material for our keys is called
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.437.1">
      Bring Your Own Key
     </span>
    </strong>
    <span class="koboSpan" id="kobo.438.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.439.1">
      BYOK
     </span>
    </strong>
    <span class="koboSpan" id="kobo.440.1">
     ) and is useful for organizations that have strict compliance or policy requirements that mandate the use of keys they control.
    </span>
    <span class="koboSpan" id="kobo.440.2">
     This key should be a 256-bit symmetric key.
    </span>
    <span class="koboSpan" id="kobo.440.3">
     Asymmetric keys are not supported
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.441.1">
      for BYOK.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-97">
    <a id="_idTextAnchor098">
    </a>
    <span class="koboSpan" id="kobo.442.1">
     Getting ready
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.443.1">
     We’ll need the following to complete
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.444.1">
      this recipe:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.445.1">
      A working AWS account,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.446.1">
       awsseccb-sandbox-1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.447.1">
      , and a user,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.448.1">
       awsseccbadmin1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.449.1">
      , as described in the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.450.1">
       Technical
      </span>
     </em>
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.451.1">
        requirements
       </span>
      </em>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.452.1">
       section.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.453.1">
      The latest OpenSSL setup on our local machine.
     </span>
     <span class="koboSpan" id="kobo.453.2">
      If it’s not already installed, go to the OpenSSL
     </span>
     <a id="_idIndexMarker414">
     </a>
     <span class="koboSpan" id="kobo.454.1">
      website at
     </span>
     <a href="https://www.openssl.org">
      <span class="koboSpan" id="kobo.455.1">
       https://www.openssl.org
      </span>
     </a>
     <span class="koboSpan" id="kobo.456.1">
      , download the latest version of OpenSSL, and set it up locally while following the instructions.
     </span>
     <span class="koboSpan" id="kobo.456.2">
      Run the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.457.1">
       openssl version
      </span>
     </strong>
     <span class="koboSpan" id="kobo.458.1">
      command to make sure OpenSSL is installed with the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.459.1">
       latest version.
      </span>
     </span>
    </li>
   </ul>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.460.1">
     Important note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.461.1">
     If you’re a macOS user, you might encounter an important compatibility issue: macOS defaults to using LibreSSL with the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.462.1">
      openssl
     </span>
    </strong>
    <span class="koboSpan" id="kobo.463.1">
     command, not OpenSSL.
    </span>
    <span class="koboSpan" id="kobo.463.2">
     To ensure you’re using the correct version of OpenSSL, you may need to install it via Homebrew and invoke it directly while specifying the full path or even adjust your system’s
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.464.1">
      PATH
     </span>
    </strong>
    <span class="koboSpan" id="kobo.465.1">
     settings.
    </span>
    <span class="koboSpan" id="kobo.465.2">
     A simple step-by-step guide
    </span>
    <a id="_idIndexMarker415">
    </a>
    <span class="koboSpan" id="kobo.466.1">
     on how to do this is provided in the following blog
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.467.1">
      post:
     </span>
    </span>
    <a href="https://www.secdops.com/blog/using-openssl-alongside-the-default-libressl-on-macos">
     <span class="No-Break">
      <span class="koboSpan" id="kobo.468.1">
       https://www.secdops.com/blog/using-openssl-alongside-the-default-libressl-on-macos
      </span>
     </span>
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.469.1">
      .
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.470.1">
     Assuming we have set up and can run the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.471.1">
      openssl version
     </span>
    </strong>
    <span class="koboSpan" id="kobo.472.1">
     command correctly, let’s proceed to use it to create external
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.473.1">
      key material.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-98">
    <a id="_idTextAnchor099">
    </a>
    <span class="koboSpan" id="kobo.474.1">
     How to do it...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.475.1">
     We will start by creating
    </span>
    <a id="_idIndexMarker416">
    </a>
    <span class="koboSpan" id="kobo.476.1">
     our key from AWS KMS by setting
    </span>
    <a id="_idIndexMarker417">
    </a>
    <span class="koboSpan" id="kobo.477.1">
     the key material origin to
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.478.1">
      External
     </span>
    </strong>
    <span class="koboSpan" id="kobo.479.1">
     .
    </span>
    <span class="koboSpan" id="kobo.479.2">
     Then, we will download the key import wrapper from the AWS KMS service, generate the key on our local machine, and wrap it with the import wrapper.
    </span>
    <span class="koboSpan" id="kobo.479.3">
     Finally, we will upload our wrapped key material with the import wrapper to finish
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.480.1">
      key creation.
     </span>
    </span>
   </p>
   <h3>
    <span class="koboSpan" id="kobo.481.1">
     Creating a key configuration for an external key
    </span>
   </h3>
   <p>
    <span class="koboSpan" id="kobo.482.1">
     We can create a key
    </span>
    <a id="_idIndexMarker418">
    </a>
    <span class="koboSpan" id="kobo.483.1">
     configuration
    </span>
    <a id="_idIndexMarker419">
    </a>
    <span class="koboSpan" id="kobo.484.1">
     for an external key
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.485.1">
      as follows:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.486.1">
      Log in to the AWS Management Console and go to
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.487.1">
       Key
      </span>
     </strong>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.488.1">
        Management Service
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.489.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.490.1">
      Click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.491.1">
       Customer-managed keys
      </span>
     </strong>
     <span class="koboSpan" id="kobo.492.1">
      from the left sidebar and click
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.493.1">
       Create key
      </span>
     </strong>
     <span class="koboSpan" id="kobo.494.1">
      at the top right of
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.495.1">
       the page.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.496.1">
      In the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.497.1">
       Configure key
      </span>
     </strong>
     <span class="koboSpan" id="kobo.498.1">
      step, for
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.499.1">
       Key type
      </span>
     </strong>
     <span class="koboSpan" id="kobo.500.1">
      , select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.501.1">
       Symmetric
      </span>
     </strong>
     <span class="koboSpan" id="kobo.502.1">
      , and for
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.503.1">
       Key usage
      </span>
     </strong>
     <span class="koboSpan" id="kobo.504.1">
      , select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.505.1">
       Encrypt
      </span>
     </strong>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.506.1">
        and decrypt
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.507.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.508.1">
      Expand the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.509.1">
       Advanced options
      </span>
     </strong>
     <span class="koboSpan" id="kobo.510.1">
      menu and select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.511.1">
       External (Import Key material)
      </span>
     </strong>
     <span class="koboSpan" id="kobo.512.1">
      .
     </span>
     <span class="koboSpan" id="kobo.512.2">
      Then, check the checkbox to agree that you understand the security and durability implications while using an external key.
     </span>
     <span class="koboSpan" id="kobo.512.3">
      For
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.513.1">
       Regionality
      </span>
     </strong>
     <span class="koboSpan" id="kobo.514.1">
      , select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.515.1">
       Single-region key
      </span>
     </strong>
     <span class="koboSpan" id="kobo.516.1">
      .
     </span>
     <span class="koboSpan" id="kobo.516.2">
      Click
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.517.1">
       Next
      </span>
     </strong>
     <span class="koboSpan" id="kobo.518.1">
      to proceed to the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.519.1">
       Add
      </span>
     </strong>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.520.1">
        labels
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.521.1">
       step.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.522.1">
      In the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.523.1">
       Add labels
      </span>
     </strong>
     <span class="koboSpan" id="kobo.524.1">
      step, set
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.525.1">
       Alias
      </span>
     </strong>
     <span class="koboSpan" id="kobo.526.1">
      to
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.527.1">
       seccb-dev-external-key
      </span>
     </strong>
     <span class="koboSpan" id="kobo.528.1">
      and
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.529.1">
       Description
      </span>
     </strong>
     <span class="koboSpan" id="kobo.530.1">
      to
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.531.1">
       External Key for the Dev env
      </span>
     </strong>
     <span class="koboSpan" id="kobo.532.1">
      .
     </span>
     <span class="koboSpan" id="kobo.532.2">
      Optionally, add tags by clicking on the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.533.1">
       Add tag
      </span>
     </strong>
     <span class="koboSpan" id="kobo.534.1">
      button.
     </span>
     <span class="koboSpan" id="kobo.534.2">
      Click
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.535.1">
       Next
      </span>
     </strong>
     <span class="koboSpan" id="kobo.536.1">
      to proceed to the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.537.1">
       Define key administrative
      </span>
     </strong>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.538.1">
        permissions
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.539.1">
       step.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.540.1">
      In the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.541.1">
       Define key administrative permissions
      </span>
     </strong>
     <span class="koboSpan" id="kobo.542.1">
      step, select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.543.1">
       Key administrators
      </span>
     </strong>
     <span class="koboSpan" id="kobo.544.1">
      , who are the IAM users and roles who can administer this key through the KMS API.
     </span>
     <span class="koboSpan" id="kobo.544.2">
      I have selected the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.545.1">
       awsseccb_admin1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.546.1">
      user, as shown in
     </span>
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.547.1">
        Figure 3
       </span>
      </em>
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.548.1">
       .3
      </span>
     </em>
     <span class="koboSpan" id="kobo.549.1">
      .
     </span>
     <span class="koboSpan" id="kobo.549.2">
      If you’re using an IAM Identity Center user, you can select a role corresponding to the combination of that IAM Identity Center user and a
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.550.1">
       permission set.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.551.1">
      For
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.552.1">
       Key deletion
      </span>
     </strong>
     <span class="koboSpan" id="kobo.553.1">
      , check
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.554.1">
       Allow key administrators to delete this key
      </span>
     </strong>
     <span class="koboSpan" id="kobo.555.1">
      .
     </span>
     <span class="koboSpan" id="kobo.555.2">
      Click
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.556.1">
       Next
      </span>
     </strong>
     <span class="koboSpan" id="kobo.557.1">
      to proceed to the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.558.1">
       Define key usage
      </span>
     </strong>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.559.1">
        permissions
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.560.1">
       step.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.561.1">
      Regarding the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.562.1">
       Define key usage permissions
      </span>
     </strong>
     <span class="koboSpan" id="kobo.563.1">
      step, select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.564.1">
       Key users
      </span>
     </strong>
     <span class="koboSpan" id="kobo.565.1">
      – that is, IAM users and roles
     </span>
     <a id="_idIndexMarker420">
     </a>
     <span class="koboSpan" id="kobo.566.1">
      who can use the customer-managed
     </span>
     <a id="_idIndexMarker421">
     </a>
     <span class="koboSpan" id="kobo.567.1">
      key to encrypt and decrypt data.
     </span>
     <span class="koboSpan" id="kobo.567.2">
      In the same step, optionally, you can add
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.568.1">
       Other AWS accounts
      </span>
     </strong>
     <span class="koboSpan" id="kobo.569.1">
      that can use this key.
     </span>
     <span class="koboSpan" id="kobo.569.2">
      I have selected the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.570.1">
       awsseccb_user1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.571.1">
      user.
     </span>
     <span class="koboSpan" id="kobo.571.2">
      If you’re using an IAM Identity Center user, you can select a role corresponding to the combination of that IAM Identity Center user and a permission set.
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.572.1">
       Click
      </span>
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.573.1">
        Next
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.574.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.575.1">
      Review
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.576.1">
       Key configuration
      </span>
     </strong>
     <span class="koboSpan" id="kobo.577.1">
      ,
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.578.1">
       Alias and description
      </span>
     </strong>
     <span class="koboSpan" id="kobo.579.1">
      ,
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.580.1">
       Tags
      </span>
     </strong>
     <span class="koboSpan" id="kobo.581.1">
      , and
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.582.1">
       Key policy
      </span>
     </strong>
     <span class="koboSpan" id="kobo.583.1">
      in JSON format.
     </span>
     <span class="koboSpan" id="kobo.583.2">
      Click
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.584.1">
       Finish
      </span>
     </strong>
     <span class="koboSpan" id="kobo.585.1">
      to create the key.
     </span>
     <span class="koboSpan" id="kobo.585.2">
      The key will be created, as shown in
     </span>
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.586.1">
        Figure 3
       </span>
      </em>
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.587.1">
       .4
      </span>
     </em>
     <span class="koboSpan" id="kobo.588.1">
      .
     </span>
     <span class="koboSpan" id="kobo.588.2">
      You should also see the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.589.1">
       Download wrapping public key and import token
      </span>
     </strong>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.590.1">
       step now.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.591.1">
      Regarding the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.592.1">
       Download wrapping public key and import token
      </span>
     </strong>
     <span class="koboSpan" id="kobo.593.1">
      step, under the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.594.1">
       Configuration
      </span>
     </strong>
     <span class="koboSpan" id="kobo.595.1">
      section, for
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.596.1">
       Select wrapping key spec
      </span>
     </strong>
     <span class="koboSpan" id="kobo.597.1">
      , select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.598.1">
       RSA_4096 - recommended
      </span>
     </strong>
     <span class="koboSpan" id="kobo.599.1">
      , and for
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.600.1">
       Select wrapping algorithm
      </span>
     </strong>
     <span class="koboSpan" id="kobo.601.1">
      ,
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.602.1">
       select
      </span>
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.603.1">
        RSAES_OAEP_SHA_256
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.604.1">
       .
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer080">
     <span class="koboSpan" id="kobo.605.1">
      <img alt="Figure 3.5 – Download wrapping public key and import token" src="image/B21384_03_5.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.606.1">
     Figure 3.5 – Download wrapping public key and import token
    </span>
   </p>
   <ol>
    <li value="11">
     <span class="koboSpan" id="kobo.607.1">
      Click
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.608.1">
       Download wrapping public key and import token
      </span>
     </strong>
     <span class="koboSpan" id="kobo.609.1">
      to download the token on your desktop.
     </span>
     <span class="koboSpan" id="kobo.609.2">
      Then, click
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.610.1">
       Next
      </span>
     </strong>
     <span class="koboSpan" id="kobo.611.1">
      to reach the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.612.1">
       Upload your wrapped key material
      </span>
     </strong>
     <span class="koboSpan" id="kobo.613.1">
      page.
     </span>
     <span class="koboSpan" id="kobo.613.2">
      Keep the downloaded import parameters file for the steps we will
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.614.1">
       follow shortly.
      </span>
     </span>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.615.1">
     In this section we created
    </span>
    <a id="_idIndexMarker422">
    </a>
    <span class="koboSpan" id="kobo.616.1">
     a key configuration.
    </span>
    <span class="koboSpan" id="kobo.616.2">
     In the next section, we will generate our key
    </span>
    <a id="_idIndexMarker423">
    </a>
    <span class="koboSpan" id="kobo.617.1">
     material and then return to this screen and click
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.618.1">
      Next
     </span>
    </strong>
    <span class="koboSpan" id="kobo.619.1">
     to go to the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.620.1">
      Upload your wrapped key material
     </span>
    </strong>
    <span class="koboSpan" id="kobo.621.1">
     step.
    </span>
    <span class="koboSpan" id="kobo.621.2">
     If we check the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.622.1">
      Customer managed keys
     </span>
    </strong>
    <span class="koboSpan" id="kobo.623.1">
     page, we should see that
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.624.1">
      Status
     </span>
    </strong>
    <span class="koboSpan" id="kobo.625.1">
     is now set to
    </span>
    <span class="No-Break">
     <strong class="bold">
      <span class="koboSpan" id="kobo.626.1">
       Pending import
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.627.1">
      .
     </span>
    </span>
   </p>
   <h3>
    <span class="koboSpan" id="kobo.628.1">
     Generating key material using OpenSSL
    </span>
   </h3>
   <p>
    <span class="koboSpan" id="kobo.629.1">
     Assuming we have
    </span>
    <a id="_idIndexMarker424">
    </a>
    <span class="koboSpan" id="kobo.630.1">
     set up OpenSSL as mentioned in the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.631.1">
      Getting ready
     </span>
    </em>
    <span class="koboSpan" id="kobo.632.1">
     section, we can follow
    </span>
    <a id="_idIndexMarker425">
    </a>
    <span class="koboSpan" id="kobo.633.1">
     these steps to generate key material and encrypt it using the wrapping key provided by AWS KMS in the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.634.1">
      previous section:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.635.1">
      As we are using a symmetric key, we can use the following command to generate 256 bytes of random data and save it to a file named
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.636.1">
       MyExternalKeyMaterial.bin
      </span>
     </strong>
     <span class="koboSpan" id="kobo.637.1">
      .
     </span>
     <span class="koboSpan" id="kobo.637.2">
      This will serve as our
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.638.1">
       key material:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.639.1">openssl rand -out ExternalKeyMaterialPlaintext.bin 32</span></strong></pre>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.640.1">
       This will generate a file
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.641.1">
        called
       </span>
      </span>
      <span class="No-Break">
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.642.1">
         ExternalKeyMaterialPlaintext.bin
        </span>
       </strong>
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.643.1">
        .
       </span>
      </span>
     </p>
    </li>
    <li>
     <span class="koboSpan" id="kobo.644.1">
      Execute the following command from the same folder while providing the name of our wrapping key for the
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.645.1">
        inkey
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.646.1">
       parameter:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.647.1">openssl pkeyutl -encrypt -in ExternalKeyMaterialPlaintext.bin -out ExternalKeyMaterialEncrypted.bin -inkey WrappingPublicKey.bin -keyform DER -pubin -pkeyopt rsa_padding_mode:oaep -pkeyopt rsa_oaep_md:sha256 -pkeyopt rsa_mgf1_md:sha256</span></strong></pre>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.648.1">
       This will generate a file
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.649.1">
        called
       </span>
      </span>
      <span class="No-Break">
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.650.1">
         ExternalKeyMaterialEncrypted.bin
        </span>
       </strong>
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.651.1">
        .
       </span>
      </span>
     </p>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.652.1">
     With that, we’ve generated the key material.
    </span>
    <span class="koboSpan" id="kobo.652.2">
     In the next section, we will upload this key material
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.653.1">
      to AWS.
     </span>
    </span>
   </p>
   <h3>
    <span class="koboSpan" id="kobo.654.1">
     Continuing with key creation from the Management Console
    </span>
   </h3>
   <p>
    <span class="koboSpan" id="kobo.655.1">
     We can upload our key material
    </span>
    <a id="_idIndexMarker426">
    </a>
    <span class="koboSpan" id="kobo.656.1">
     in the AWS Management Console
    </span>
    <a id="_idIndexMarker427">
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.657.1">
      as follows:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.658.1">
      Go back to the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.659.1">
       Upload your wrapped key material
      </span>
     </strong>
     <span class="koboSpan" id="kobo.660.1">
      step’s page in the console.
     </span>
     <span class="koboSpan" id="kobo.660.2">
      This is where we stopped in the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.661.1">
       Creating a key configuration for an external
      </span>
     </em>
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.662.1">
        key
       </span>
      </em>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.663.1">
       section.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.664.1">
      If we are not on the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.665.1">
       Upload your wrapped key material
      </span>
     </strong>
     <span class="koboSpan" id="kobo.666.1">
      step’s page, we can go to
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.667.1">
       Key Management Service
      </span>
     </strong>
     <span class="koboSpan" id="kobo.668.1">
      via the dashboard, click
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.669.1">
       Customer-managed keys
      </span>
     </strong>
     <span class="koboSpan" id="kobo.670.1">
      from the left sidebar, and then click on the hyperlink under
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.671.1">
       Aliases
      </span>
     </strong>
     <span class="koboSpan" id="kobo.672.1">
      for the key for which we downloaded the wrapping key.
     </span>
     <span class="koboSpan" id="kobo.672.2">
      Go to the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.673.1">
       Key material
      </span>
     </strong>
     <span class="koboSpan" id="kobo.674.1">
      tab and click
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.675.1">
       Import key material
      </span>
     </strong>
     <span class="koboSpan" id="kobo.676.1">
      .
     </span>
     <span class="koboSpan" id="kobo.676.2">
      Then, click
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.677.1">
       Next
      </span>
     </strong>
     <span class="koboSpan" id="kobo.678.1">
      to go to the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.679.1">
       Upload your wrapped key material
      </span>
     </strong>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.680.1">
       step’s page.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.681.1">
      On the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.682.1">
       Upload your wrapped key material
      </span>
     </strong>
     <span class="koboSpan" id="kobo.683.1">
      step’s page, click
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.684.1">
       Choose file
      </span>
     </strong>
     <span class="koboSpan" id="kobo.685.1">
      under
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.686.1">
       Wrapped key material
      </span>
     </strong>
     <span class="koboSpan" id="kobo.687.1">
      and select the
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.688.1">
        ExternalKeyMaterialEncrypted.bin
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.689.1">
       file.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.690.1">
      Click
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.691.1">
       Choose file
      </span>
     </strong>
     <span class="koboSpan" id="kobo.692.1">
      under
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.693.1">
       Import token
      </span>
     </strong>
     <span class="koboSpan" id="kobo.694.1">
      and select the import token we downloaded from KMS in the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.695.1">
       previous section.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.696.1">
      Leave the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.697.1">
       Key material expires - optional
      </span>
     </strong>
     <span class="koboSpan" id="kobo.698.1">
      option unchecked and click
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.699.1">
       Upload key material
      </span>
     </strong>
     <span class="koboSpan" id="kobo.700.1">
      .
     </span>
     <span class="koboSpan" id="kobo.700.2">
      We should see a message that the key has
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.701.1">
       been uploaded.
      </span>
     </span>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.702.1">
       The key is now ready
      </span>
      <a id="_idIndexMarker428">
      </a>
      <span class="koboSpan" id="kobo.703.1">
       for use.
      </span>
      <span class="koboSpan" id="kobo.703.2">
       If we check
      </span>
      <a id="_idIndexMarker429">
      </a>
      <span class="koboSpan" id="kobo.704.1">
       the
      </span>
      <strong class="bold">
       <span class="koboSpan" id="kobo.705.1">
        Customer managed keys
       </span>
      </strong>
      <span class="koboSpan" id="kobo.706.1">
       page, we should see that
      </span>
      <strong class="bold">
       <span class="koboSpan" id="kobo.707.1">
        Status
       </span>
      </strong>
      <span class="koboSpan" id="kobo.708.1">
       has changed from
      </span>
      <strong class="bold">
       <span class="koboSpan" id="kobo.709.1">
        Pending import
       </span>
      </strong>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.710.1">
        to
       </span>
      </span>
      <span class="No-Break">
       <strong class="bold">
        <span class="koboSpan" id="kobo.711.1">
         Enabled
        </span>
       </strong>
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.712.1">
        .
       </span>
      </span>
     </p>
    </li>
   </ol>
   <h2 id="_idParaDest-99">
    <a id="_idTextAnchor100">
    </a>
    <span class="koboSpan" id="kobo.713.1">
     How it works...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.714.1">
     In this recipe, we created
    </span>
    <a id="_idIndexMarker430">
    </a>
    <span class="koboSpan" id="kobo.715.1">
     an AWS KMS key by setting the
    </span>
    <a id="_idIndexMarker431">
    </a>
    <span class="koboSpan" id="kobo.716.1">
     key material origin to
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.717.1">
      External
     </span>
    </strong>
    <span class="koboSpan" id="kobo.718.1">
     .
    </span>
    <span class="koboSpan" id="kobo.718.2">
     After that, we selected one of the allowed encryption schemes for the key wrapper and downloaded the key wrapper.
    </span>
    <span class="koboSpan" id="kobo.718.3">
     This key wrapper is the public key that is used to encrypt and securely upload our key material to the AWS KMS service.
    </span>
    <span class="koboSpan" id="kobo.718.4">
     An import token from the AWS KMS service was also downloaded, along with the key wrapper.
    </span>
    <span class="koboSpan" id="kobo.718.5">
     The import token is used to make sure the key that’s uploaded is the right one for the key that we downloaded for the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.719.1">
      wrapper token.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-100">
    <a id="_idTextAnchor101">
    </a>
    <span class="koboSpan" id="kobo.720.1">
     There’s more...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.721.1">
     In this recipe, we used
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.722.1">
      SHA_256
     </span>
    </strong>
    <span class="koboSpan" id="kobo.723.1">
     to wrap our external
    </span>
    <a id="_idIndexMarker432">
    </a>
    <span class="koboSpan" id="kobo.724.1">
     key material before uploading it.
    </span>
    <span class="koboSpan" id="kobo.724.2">
     We may also use
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.725.1">
      SHA_1
     </span>
    </strong>
    <span class="koboSpan" id="kobo.726.1">
     , but it is less secure.
    </span>
    <span class="koboSpan" id="kobo.726.2">
     If we are using SHA-1, we can generate the encrypted external key material,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.727.1">
      ExternalKeyMaterialEncrypted.bin
     </span>
    </strong>
    <span class="koboSpan" id="kobo.728.1">
     , with the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.729.1">
      following command:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.730.1">
openssl pkeyutl -encrypt –in ExternalKeyMaterialPlaintext.bin -out ExternalKeyMaterialEncrypted.bin -inkey WrappingPublicKey.bin -keyform DER -pubin -pkeyopt rsa_padding_mode:oaep -pkeyopt rsa_oaep_md:sha1</span></pre>
   <p>
    <span class="koboSpan" id="kobo.731.1">
     Let’s quickly go through some more details
    </span>
    <a id="_idIndexMarker433">
    </a>
    <span class="koboSpan" id="kobo.732.1">
     regarding importing keys into
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.733.1">
      AWS KMS:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.734.1">
      When we import our key material, we are responsible for generating the key material with randomness, as per our security requirements.
     </span>
     <span class="koboSpan" id="kobo.734.2">
      We are also responsible for the durability of the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.735.1">
       key material.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.736.1">
      With imported key material, we can set an expiration date for the key material and also manually delete it.
     </span>
     <span class="koboSpan" id="kobo.736.2">
      We can make the key available again in the future by importing the key material into the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.737.1">
       KMS key.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.738.1">
      We cannot delete the key material for a KMS key with AWS key material.
     </span>
     <span class="koboSpan" id="kobo.738.2">
      We can, however, schedule the deletion of that KMS key with 7-30
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.739.1">
       days’ notice.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.740.1">
      Once a KMS key has been deleted, any data that’s been encrypted by it cannot be decrypted.
     </span>
     <span class="koboSpan" id="kobo.740.2">
      This is true for both KMS keys with AWS key material and KMS keys with imported
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.741.1">
       key material.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.742.1">
      A key material imported into a KMS key is permanently associated with that
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.743.1">
       KMS key.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.744.1">
      We can reimport the key material.
     </span>
     <span class="koboSpan" id="kobo.744.2">
      However, we cannot import a different key material again for that
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.745.1">
       KMS key.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.746.1">
      A ciphertext encrypted with a KMS key with an external key material cannot be decrypted by another KMS key, even if we use the same
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.747.1">
       key material.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.748.1">
      A KMS key with an imported key material must be deleted before we can reimport the key material again into another
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.749.1">
       KMS Key.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.750.1">
      We can reimport the key material into an existing KMS key if the key material
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.751.1">
       is deleted.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.752.1">
      In the case of region-wide failures that affect KMS keys, AWS won’t automatically restore any imported
     </span>
     <a id="_idIndexMarker434">
     </a>
     <span class="koboSpan" id="kobo.753.1">
      key material.
     </span>
     <span class="koboSpan" id="kobo.753.2">
      In such scenarios, we need to have a copy of our key material to
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.754.1">
       reimport it.
      </span>
     </span>
    </li>
   </ul>
   <h2 id="_idParaDest-101">
    <a id="_idTextAnchor102">
    </a>
    <span class="koboSpan" id="kobo.755.1">
     See also
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.756.1">
     You can read more about
    </span>
    <a id="_idIndexMarker435">
    </a>
    <span class="koboSpan" id="kobo.757.1">
     external keys and BYOK in the following blog
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.758.1">
      post:
     </span>
    </span>
    <a href="https://www.cloudericks.com/blog/aws-kms-with-external-key-material-the-byok-solution">
     <span class="No-Break">
      <span class="koboSpan" id="kobo.759.1">
       https://www.cloudericks.com/blog/aws-kms-with-external-key-material-the-byok-solution
      </span>
     </span>
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.760.1">
      .
     </span>
    </span>
   </p>
   <h1 id="_idParaDest-102">
    <a id="_idTextAnchor103">
    </a>
    <span class="koboSpan" id="kobo.761.1">
     Rotating keys in KMS
    </span>
   </h1>
   <p>
    <strong class="bold">
     <span class="koboSpan" id="kobo.762.1">
      Key rotation
     </span>
    </strong>
    <span class="koboSpan" id="kobo.763.1">
     refers to the process of changing
    </span>
    <a id="_idIndexMarker436">
    </a>
    <span class="koboSpan" id="kobo.764.1">
     the encryption key that’s used to secure our data.
    </span>
    <span class="koboSpan" id="kobo.764.2">
     This practice is crucial for minimizing risk in case a key is compromised.
    </span>
    <span class="koboSpan" id="kobo.764.3">
     AWS supports automatic and manual key rotation for
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.765.1">
      customer-managed keys.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.766.1">
     Rotating keys regularly is a best practice that needs to be followed while using keys.
    </span>
    <span class="koboSpan" id="kobo.766.2">
     Key rotation may also be a requirement based on regulatory rules or corporate policies.
    </span>
    <span class="koboSpan" id="kobo.766.3">
     These rules and policies may also provide guidelines on the key rotation frequencies.
    </span>
    <span class="koboSpan" id="kobo.766.4">
     We will look at the different cases of key rotation in
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.767.1">
      this recipe.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-103">
    <a id="_idTextAnchor104">
    </a>
    <span class="koboSpan" id="kobo.768.1">
     Getting ready
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.769.1">
     We’ll need the following to complete
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.770.1">
      this recipe:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.771.1">
      A working AWS account,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.772.1">
       awsseccb-sandbox-1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.773.1">
      , and a user,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.774.1">
       awsseccbadmin1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.775.1">
      , as described in the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.776.1">
       Technical
      </span>
     </em>
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.777.1">
        requirements
       </span>
      </em>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.778.1">
       section.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.779.1">
      A customer-managed KMS key with AWS key material.
     </span>
     <span class="koboSpan" id="kobo.779.2">
      I will be using the key with the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.780.1">
       seccb-dev-encryption
      </span>
     </strong>
     <span class="koboSpan" id="kobo.781.1">
      alias that we created in the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.782.1">
       Creating keys in
      </span>
     </em>
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.783.1">
        KMS
       </span>
      </em>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.784.1">
       recipe.
      </span>
     </span>
    </li>
   </ul>
   <h2 id="_idParaDest-104">
    <a id="_idTextAnchor105">
    </a>
    <span class="koboSpan" id="kobo.785.1">
     How to do it...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.786.1">
     We can specify automatic key rotation
    </span>
    <a id="_idIndexMarker437">
    </a>
    <span class="koboSpan" id="kobo.787.1">
     every year (365 days) for customer-managed KMS keys with AWS key material
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.788.1">
      as follows:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.789.1">
      Log in to the AWS Management Console and go to
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.790.1">
       Key
      </span>
     </strong>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.791.1">
        Management Service
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.792.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.793.1">
      Click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.794.1">
       Customer-managed keys
      </span>
     </strong>
     <span class="koboSpan" id="kobo.795.1">
      on the navigation pane to list all the keys we
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.796.1">
       have created.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.797.1">
      Click on the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.798.1">
       Aliases
      </span>
     </strong>
     <span class="koboSpan" id="kobo.799.1">
      or
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.800.1">
       Key ID
      </span>
     </strong>
     <span class="koboSpan" id="kobo.801.1">
      property of our customer-managed key for which we need to do
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.802.1">
       the rotation.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.803.1">
      Go to the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.804.1">
       Key rotation
      </span>
     </strong>
     <span class="koboSpan" id="kobo.805.1">
      tab and
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.806.1">
       click
      </span>
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.807.1">
        Edit
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.808.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.809.1">
      For
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.810.1">
       Key rotation
      </span>
     </strong>
     <span class="koboSpan" id="kobo.811.1">
      , select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.812.1">
       Enable
      </span>
     </strong>
     <span class="koboSpan" id="kobo.813.1">
      and set
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.814.1">
       Rotation period (in days)
      </span>
     </strong>
     <span class="koboSpan" id="kobo.815.1">
      with a value of
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.816.1">
       365
      </span>
     </strong>
     <span class="koboSpan" id="kobo.817.1">
      , as shown in the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.818.1">
       following figure:
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer081">
     <span class="koboSpan" id="kobo.819.1">
      <img alt="Figure 3.6 – Automatic key rotation" src="image/B21384_03_6.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.820.1">
     Figure 3.6 – Automatic key rotation
    </span>
   </p>
   <ol>
    <li value="6">
     <span class="koboSpan" id="kobo.821.1">
      Click
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.822.1">
       Save
      </span>
     </strong>
     <span class="koboSpan" id="kobo.823.1">
      .
     </span>
     <span class="koboSpan" id="kobo.823.2">
      We will get a notification that the operation
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.824.1">
       was successful.
      </span>
     </span>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.825.1">
     With that, we’ve learned how to enable automatic key rotation.
    </span>
    <span class="koboSpan" id="kobo.825.2">
     We will learn more about key rotation in the subsequent sections of
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.826.1">
      this recipe.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-105">
    <a id="_idTextAnchor106">
    </a>
    <span class="koboSpan" id="kobo.827.1">
     How it works...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.828.1">
     AWS-managed keys are automatically
    </span>
    <a id="_idIndexMarker438">
    </a>
    <span class="koboSpan" id="kobo.829.1">
     rotated every year.
    </span>
    <span class="koboSpan" id="kobo.829.2">
     Previously, it was every 3 years.
    </span>
    <span class="koboSpan" id="kobo.829.3">
     For customer-managed keys, AWS supports both automatic and manual key rotation.
    </span>
    <span class="koboSpan" id="kobo.829.4">
     With automatic rotation, only the backing key of a KMS key is rotated.
    </span>
    <span class="koboSpan" id="kobo.829.5">
     This means that the KMS key ID, ARN, region, policies, permissions, and other properties remain the same.
    </span>
    <span class="koboSpan" id="kobo.829.6">
     Therefore, we do not need to change applications or aliases that use this
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.830.1">
      KMS key.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.831.1">
     In this recipe, we selected the option to automatically rotate our KMS key every year.
    </span>
    <span class="koboSpan" id="kobo.831.2">
     AWS will now rotate the key every year but keep a copy of the old backing key to decrypt any data that was encrypted with the old backing key.
    </span>
    <span class="koboSpan" id="kobo.831.3">
     AWS keeps the older backing keys until we
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.832.1">
      delete them.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-106">
    <a id="_idTextAnchor107">
    </a>
    <span class="koboSpan" id="kobo.833.1">
     There’s more...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.834.1">
     Let’s quickly go through some of the important points
    </span>
    <a id="_idIndexMarker439">
    </a>
    <span class="koboSpan" id="kobo.835.1">
     related to AWS KMS
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.836.1">
      key rotation:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.837.1">
      Automatic key rotation every year (365 days) is only supported for KMS keys with AWS
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.838.1">
       key materials.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.839.1">
      We can do a manual key rotation for KMS keys with AWS key material if we want a different duration for the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.840.1">
       key rotation.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.841.1">
      With automatic key rotation, only the KMS key is rotated, not the data keys encrypted
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.842.1">
       with it.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.843.1">
      With automatic key rotation, new encryptions are made using the new backing key.
     </span>
     <span class="koboSpan" id="kobo.843.2">
      However, data encrypted using an older backing key is decrypted using that old key.
     </span>
     <span class="koboSpan" id="kobo.843.3">
      For this purpose, AWS keeps all backing keys available until we delete the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.844.1">
       KMS key.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.845.1">
      With automatic key rotation, even if we disable key rotation, old backing keys will still be available to decrypt data that was encrypted using
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.846.1">
       that key.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.847.1">
      With automatic key rotation, if you disable rotation and re-enable it again, it will continue with the old key rotation schedule if the backing key is less than a year old.
     </span>
     <span class="koboSpan" id="kobo.847.2">
      If the backing key is older than 365 days, it is rotated immediately and then rotated again every
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.848.1">
       365 days.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.849.1">
      With automatic key rotation, key rotation will not happen if a key is pending deletion.
     </span>
     <span class="koboSpan" id="kobo.849.2">
      If deletion is canceled, it will continue with the old key rotation schedule if the backing key is less than a year old.
     </span>
     <span class="koboSpan" id="kobo.849.3">
      If the backing key is older than 365 days, it is rotated immediately and then rotated again every
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.850.1">
       365 days.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.851.1">
      Automatic key rotation is not supported for custom key stores backed by AWS CloudHSM clusters.
     </span>
     <span class="koboSpan" id="kobo.851.2">
      For such KMS keys, the value of the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.852.1">
       Origin
      </span>
     </strong>
     <span class="koboSpan" id="kobo.853.1">
      field is
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.854.1">
       AWS_CloudHSM
      </span>
     </strong>
     <span class="koboSpan" id="kobo.855.1">
      .
     </span>
     <span class="koboSpan" id="kobo.855.2">
      In this case, we need to manually rotate keys and change any encrypted data or aliases to use the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.856.1">
       new key.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.857.1">
      For AWS-managed keys, we cannot change the rotation frequency, which is currently
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.858.1">
       1 year.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.859.1">
      Automatic key rotation can be monitored using the KMS key rotation event
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.860.1">
       in EventBridge.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.861.1">
      We can use the AWS KMS API
     </span>
     <a id="_idIndexMarker440">
     </a>
     <span class="koboSpan" id="kobo.862.1">
      to enable and disable automatic key rotation.
     </span>
     <span class="koboSpan" id="kobo.862.2">
      It is good practice to use aliases to refer to KMS keys when we do manual key rotation.
     </span>
     <span class="koboSpan" id="kobo.862.3">
      We can update the alias so that it points to the new target KMS key instead of the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.863.1">
       old one.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.864.1">
      Even with manual rotation, AWS KMS can identify the right backing key that was used for encryption and use it for decryption, so long as we keep the older KMS
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.865.1">
       keys available.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.866.1">
      We can update aliases using the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.867.1">
       update-alias
      </span>
     </strong>
     <span class="koboSpan" id="kobo.868.1">
      subcommand of the AWS
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.869.1">
       KMS API.
      </span>
     </span>
    </li>
   </ul>
   <h2 id="_idParaDest-107">
    <a id="_idTextAnchor108">
    </a>
    <span class="koboSpan" id="kobo.870.1">
     See also
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.871.1">
     You can read more
    </span>
    <a id="_idIndexMarker441">
    </a>
    <span class="koboSpan" id="kobo.872.1">
     about AWS KMS key rotation, including manual key rotation,
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.873.1">
      at
     </span>
    </span>
    <a href="https://www.cloudericks.com/blog/understanding-aws-kms-key-rotation">
     <span class="No-Break">
      <span class="koboSpan" id="kobo.874.1">
       https://www.cloudericks.com/blog/understanding-aws-kms-key-rotation
      </span>
     </span>
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.875.1">
      .
     </span>
    </span>
   </p>
   <h1 id="_idParaDest-108">
    <a id="_idTextAnchor109">
    </a>
    <span class="koboSpan" id="kobo.876.1">
     Granting permissions programmatically with grants
    </span>
   </h1>
   <p>
    <strong class="bold">
     <span class="koboSpan" id="kobo.877.1">
      KMS grants
     </span>
    </strong>
    <span class="koboSpan" id="kobo.878.1">
     can be used to give temporary
    </span>
    <a id="_idIndexMarker442">
    </a>
    <span class="koboSpan" id="kobo.879.1">
     granular permissions
    </span>
    <a id="_idIndexMarker443">
    </a>
    <span class="koboSpan" id="kobo.880.1">
     to AWS KMS API operations such as encrypting, decrypting, and describing keys, and more.
    </span>
    <span class="koboSpan" id="kobo.880.2">
     We can use grants to provide access to a user in their account or even another account.
    </span>
    <span class="koboSpan" id="kobo.880.3">
     In this recipe, we will grant access to a user so that they can encrypt and decrypt files using
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.881.1">
      AWS KMS.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-109">
    <a id="_idTextAnchor110">
    </a>
    <span class="koboSpan" id="kobo.882.1">
     Getting ready
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.883.1">
     We’ll need the following to complete
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.884.1">
      this recipe:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.885.1">
      A working AWS account with two users: a user with
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.886.1">
       AdministratorAccess
      </span>
     </strong>
     <span class="koboSpan" id="kobo.887.1">
      permission and a user with no permissions.
     </span>
     <span class="koboSpan" id="kobo.887.2">
      The CLI profiles should be configured for these users.
     </span>
     <span class="koboSpan" id="kobo.887.3">
      I will be calling these users and their CLI profiles
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.888.1">
       Adminuserprofile
      </span>
     </strong>
     <span class="koboSpan" id="kobo.889.1">
      and
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.890.1">
       testusernopermission
      </span>
     </strong>
     <span class="koboSpan" id="kobo.891.1">
      , respectively, following the recipes in
     </span>
     <a href="B21384_01.xhtml#_idTextAnchor020">
      <span class="No-Break">
       <em class="italic">
        <span class="koboSpan" id="kobo.892.1">
         Chapter 1
        </span>
       </em>
      </span>
     </a>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.893.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.894.1">
      A KMS key.
     </span>
     <span class="koboSpan" id="kobo.894.2">
      We can create one by following previous recipes in this chapter.
     </span>
     <span class="koboSpan" id="kobo.894.3">
      Alternatively, use the following command to create a KMS key from the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.895.1">
       AWS CLI:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.896.1">aws kms create-key --profile Adminuserprofile</span></strong></pre>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.897.1">
       This will provide an output similar to
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.898.1">
        the following:
       </span>
      </span>
     </p>
    </li>
   </ul>
   <div>
    <div class="IMG---Figure" id="_idContainer082">
     <span class="koboSpan" id="kobo.899.1">
      <img alt="Figure 3.7 – Creating a key using the CLI" src="image/B21384_03_7.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.900.1">
     Figure 3.7 – Creating a key using the CLI
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.901.1">
     Before proceeding, we have
    </span>
    <a id="_idIndexMarker444">
    </a>
    <span class="koboSpan" id="kobo.902.1">
     to check
    </span>
    <a id="_idIndexMarker445">
    </a>
    <span class="koboSpan" id="kobo.903.1">
     whether our test user has any permissions by running the following command.
    </span>
    <span class="koboSpan" id="kobo.903.2">
     Ensure you replace my
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.904.1">
      key-id
     </span>
    </strong>
    <span class="koboSpan" id="kobo.905.1">
     with
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.906.1">
      your
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.907.1">
       key-id
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.908.1">
      :
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.909.1">
aws kms encrypt --plaintext "$(echo -n 'hello heartin' | base64)" --key-id ea7136c3-7d8a-4ed4-89cc-4ca0af7d6958 --profile testusernopermission</span></pre>
   <p>
    <span class="koboSpan" id="kobo.910.1">
     We should get an error message similar to the one shown in the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.911.1">
      following screenshot:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer083">
     <span class="koboSpan" id="kobo.912.1">
      <img alt="Figure 3.8 – Response to the user permission check" src="image/B21384_03_8.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.913.1">
     Figure 3.8 – Response to the user permission check
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.914.1">
     In the preceding command, we can specify the key ID alone (as we did), the complete key ARN, or an alias (if one
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.915.1">
      is available).
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.916.1">
     Next, we will learn how to use grants so that we can give
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.917.1">
      permissions programmatically.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-110">
    <a id="_idTextAnchor111">
    </a>
    <span class="koboSpan" id="kobo.918.1">
     How to do it...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.919.1">
     We can grant encrypt
    </span>
    <a id="_idIndexMarker446">
    </a>
    <span class="koboSpan" id="kobo.920.1">
     permission to
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.921.1">
      testuser
     </span>
    </strong>
    <span class="koboSpan" id="kobo.922.1">
     and then use
    </span>
    <a id="_idIndexMarker447">
    </a>
    <span class="koboSpan" id="kobo.923.1">
     it to encrypt
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.924.1">
      as follows:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.925.1">
      We can get the user’s ARN from the IAM dashboard or prepare one based on the preceding format.
     </span>
     <span class="koboSpan" id="kobo.925.2">
      We can also use the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.926.1">
       aws iam get-user
      </span>
     </strong>
     <span class="koboSpan" id="kobo.927.1">
      command to get the user’s ARN from
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.928.1">
       the console:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.929.1">aws iam get-user --user-name testuser --profile Adminuserprofile</span></strong></pre>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.930.1">
       This command will return a response similar to
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.931.1">
        the following:
       </span>
      </span>
     </p>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer084">
     <span class="koboSpan" id="kobo.932.1">
      <img alt="Figure 3.9 – Response for the get-user command" src="image/B21384_03_9.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.933.1">
     Figure 3.9 – Response for the get-user command
    </span>
   </p>
   <ol>
    <li value="2">
     <span class="koboSpan" id="kobo.934.1">
      Grant
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.935.1">
       Encrypt
      </span>
     </strong>
     <span class="koboSpan" id="kobo.936.1">
      permission to
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.937.1">
       testuser
      </span>
     </strong>
     <span class="koboSpan" id="kobo.938.1">
      using the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.939.1">
       create-grant
      </span>
     </strong>
     <span class="koboSpan" id="kobo.940.1">
      subcommand by providing the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.941.1">
       user’s ARN:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.942.1">aws kms create-grant --key-id ea7136c3-7d8a-4ed4-89cc-4ca0af7d6958 --grantee-principal arn:aws:iam::201882936474:user/testuser --operations "Encrypt" --profile Adminuserprofile</span></strong></pre>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.943.1">
       We should get a response similar to the one shown in the
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.944.1">
        following screenshot:
       </span>
      </span>
     </p>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer085">
     <span class="koboSpan" id="kobo.945.1">
      <img alt="Figure 3.10 – Response for the create-grant subcommand" src="image/B21384_03_10.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.946.1">
     Figure 3.10 – Response for the create-grant subcommand
    </span>
   </p>
   <ol>
    <li value="3">
     <span class="koboSpan" id="kobo.947.1">
      Encrypt data with
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.948.1">
       testuser
      </span>
     </strong>
     <span class="koboSpan" id="kobo.949.1">
      using the
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.950.1">
        encrypt
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.951.1">
       subcommand:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.952.1">aws kms encrypt --plaintext "$(echo -n 'hello heartin' | base64)" --key-id ea7136c3-7d8a-4ed4-89cc-4ca0af7d6958 --profile testusernopermission</span></strong></pre>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.953.1">
       This time, we should
      </span>
      <a id="_idIndexMarker448">
      </a>
      <span class="koboSpan" id="kobo.954.1">
       get a successful
      </span>
      <a id="_idIndexMarker449">
      </a>
      <span class="koboSpan" id="kobo.955.1">
       response,
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.956.1">
        as follows:
       </span>
      </span>
     </p>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer086">
     <span class="koboSpan" id="kobo.957.1">
      <img alt="Figure 3.11 – Response for the encrypt command after getting the permission" src="image/B21384_03_11.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.958.1">
     Figure 3.11 – Response for the encrypt command after getting the permission
    </span>
   </p>
   <ol>
    <li value="4">
     <span class="koboSpan" id="kobo.959.1">
      Verify the grants for the key using the
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.960.1">
        list-grants
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.961.1">
       subcommand:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.962.1">aws kms list-grants --key-id ea7136c3-7d8a-4ed4-89cc-4ca0af7d6958 --profile Adminuserprofile</span></strong></pre>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.963.1">
       This should return a response similar to
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.964.1">
        the following:
       </span>
      </span>
     </p>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer087">
     <span class="koboSpan" id="kobo.965.1">
      <img alt="Figure 3.12 – Response for the list-grant command" src="image/B21384_03_12.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.966.1">
     Figure 3.12 – Response for the list-grant command
    </span>
   </p>
   <ol>
    <li value="5">
     <span class="koboSpan" id="kobo.967.1">
      Revoke the grant with the
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.968.1">
        revoke-grant
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.969.1">
       subcommand:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.970.1">aws kms revoke-grant --key-id ea7136c3-7d8a-4ed4-89cc-4ca0af7d6958 --grant-id e6579fcfec8d84ce9a48398a5e33466de47b75e06f99b4e1edd178914c559bb5 --profile Adminuserprofile</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.971.1">
      We can verify that the grant
     </span>
     <a id="_idIndexMarker450">
     </a>
     <span class="koboSpan" id="kobo.972.1">
      has been revoked
     </span>
     <a id="_idIndexMarker451">
     </a>
     <span class="koboSpan" id="kobo.973.1">
      by trying to encrypt it using
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.974.1">
       testuser
      </span>
     </strong>
     <span class="koboSpan" id="kobo.975.1">
      and by running the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.976.1">
       list-grants
      </span>
     </strong>
     <span class="koboSpan" id="kobo.977.1">
      subcommand.
     </span>
     <span class="koboSpan" id="kobo.977.2">
      Run the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.978.1">
       encrypt
      </span>
     </strong>
     <span class="koboSpan" id="kobo.979.1">
      command, similar to
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.980.1">
       Step 2
      </span>
     </em>
     <span class="koboSpan" id="kobo.981.1">
      of this recipe.
     </span>
     <span class="koboSpan" id="kobo.981.2">
      We should now get an error message similar to
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.982.1">
       the following:
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer088">
     <span class="koboSpan" id="kobo.983.1">
      <img alt="Figure 3.13 – Response for the encrypt command after revoking the permission" src="image/B21384_03_13.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.984.1">
     Figure 3.13 – Response for the encrypt command after revoking the permission
    </span>
   </p>
   <ol>
    <li value="7">
     <span class="koboSpan" id="kobo.985.1">
      Run the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.986.1">
       list-grant
      </span>
     </strong>
     <span class="koboSpan" id="kobo.987.1">
      subcommand, similar to
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.988.1">
       Step 3
      </span>
     </em>
     <span class="koboSpan" id="kobo.989.1">
      of this recipe.
     </span>
     <span class="koboSpan" id="kobo.989.2">
      We should now get a response similar to
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.990.1">
       the following:
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer089">
     <span class="koboSpan" id="kobo.991.1">
      <img alt="Figure 3.14 – Response for the list-grant command after revoking all the grants" src="image/B21384_03_14.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.992.1">
     Figure 3.14 – Response for the list-grant command after revoking all the grants
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.993.1">
     Similarly, we can grant permission for
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.994.1">
      other operations.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-111">
    <a id="_idTextAnchor112">
    </a>
    <span class="koboSpan" id="kobo.995.1">
     How it works...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.996.1">
     In this recipe, we granted
    </span>
    <a id="_idIndexMarker452">
    </a>
    <span class="koboSpan" id="kobo.997.1">
     permission to a user
    </span>
    <a id="_idIndexMarker453">
    </a>
    <span class="koboSpan" id="kobo.998.1">
     using the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.999.1">
      create-grant
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1000.1">
     subcommand of the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1001.1">
      aws kms
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1002.1">
     CLI command.
    </span>
    <span class="koboSpan" id="kobo.1002.2">
     We verified that the user could not perform encryption before granting permission.
    </span>
    <span class="koboSpan" id="kobo.1002.3">
     We verified that the user could perform encryption after
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1003.1">
      granting permission.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1004.1">
     Then, we revoked the grant using the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1005.1">
      revoke-grant
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1006.1">
     subcommand of the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1007.1">
      aws kms
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1008.1">
     CLI command.
    </span>
    <span class="koboSpan" id="kobo.1008.2">
     We also used other subcommands, such as
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1009.1">
      list-grants
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1010.1">
     to list the grants for a particular key ID and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1011.1">
      encrypt
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1012.1">
     to encrypt the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1013.1">
      plain text.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-112">
    <a id="_idTextAnchor113">
    </a>
    <span class="koboSpan" id="kobo.1014.1">
     There’s more...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1015.1">
     In this recipe, we granted permission to only one operation.
    </span>
    <span class="koboSpan" id="kobo.1015.2">
     We can grant permission to multiple operations, as
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1016.1">
      shown here:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.1017.1">
aws kms create-grant --key-id 1ab77c7a-7ca4-4387-a4c5-2fba3cb5c0f5 --grantee-principal arn:aws:iam::135301570106:user/testuser --operations "Encrypt" "Decrypt" --profile Adminuserprofile</span></pre>
   <p>
    <span class="koboSpan" id="kobo.1018.1">
     Let’s quickly go through some important
    </span>
    <a id="_idIndexMarker454">
    </a>
    <span class="koboSpan" id="kobo.1019.1">
     concepts related to granting and
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1020.1">
      revoking
     </span>
    </span>
    <span class="No-Break">
     <a id="_idIndexMarker455">
     </a>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1021.1">
      permissions:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.1022.1">
      The supported grant operations are
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1023.1">
       Encrypt
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1024.1">
      ,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1025.1">
       Decrypt
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1026.1">
      ,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1027.1">
       GenerateDataKey
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1028.1">
      ,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1029.1">
       GenerateDataKeyWithoutPlaintext
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1030.1">
      ,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1031.1">
       ReEncryptFrom
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1032.1">
      ,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1033.1">
       ReEncryptTo
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1034.1">
      ,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1035.1">
       CreateGrant
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1036.1">
      ,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1037.1">
       RetireGrant
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1038.1">
      ,
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1039.1">
       and
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1040.1">
        DescribeKey
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1041.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1042.1">
      We can use the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1043.1">
       encrypt
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1044.1">
      subcommand of the AWS KMS API to convert plain text into ciphertext with the help of
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1045.1">
       a key.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1046.1">
      We can use the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1047.1">
       decrypt
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1048.1">
      subcommand of AWS KMS API to convert ciphertext into plain text with the help of the same key that was used
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1049.1">
       for encryption.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1050.1">
      We can use the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1051.1">
       re-encrypt
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1052.1">
      subcommand of the AWS KMS API to decrypt and re-encrypt data on the server side with a new CMK without exposing the plain text on the client side.
     </span>
     <span class="koboSpan" id="kobo.1052.2">
      This subcommand can also be used to change the encryption context of
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1053.1">
       a ciphertext.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1054.1">
      Encryption context is an optional additional set of key-value pairs that form an additional authentication check.
     </span>
     <span class="koboSpan" id="kobo.1054.2">
      The same encryption context that is used for encryption needs to be used for decryption and re-encryption.
     </span>
     <span class="koboSpan" id="kobo.1054.3">
      Since the encryption context is not a secret, it will appear in plain text within AWS CloudTrail logs, making it useful for monitoring and auditing
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1055.1">
       cryptographic operations.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1056.1">
      Grants are an alternative to
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1057.1">
       key policies.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1058.1">
      Within the same account, we can use the key ID or key ARN with the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1059.1">
       create-grant
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1060.1">
      subcommand.
     </span>
     <span class="koboSpan" id="kobo.1060.2">
      For users in other accounts, the ARN needs to
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1061.1">
       be specified.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1062.1">
      The
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1063.1">
       create-grant
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1064.1">
      subcommand has a constraints parameter that accepts an
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1065.1">
       encryption context.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1066.1">
      When we create grants, the permissions
     </span>
     <a id="_idIndexMarker456">
     </a>
     <span class="koboSpan" id="kobo.1067.1">
      may not be reflected immediately due
     </span>
     <a id="_idIndexMarker457">
     </a>
     <span class="koboSpan" id="kobo.1068.1">
      to the eventual consistency model followed by AWS.
     </span>
     <span class="koboSpan" id="kobo.1068.2">
      By using the grant tokens that are received from the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1069.1">
       create-grant
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1070.1">
      subcommand in further requests, we can avoid any delays due to
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1071.1">
       eventual consistency.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1072.1">
      The
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1073.1">
       list-grants
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1074.1">
      subcommand is used to list all the grants for a key and provides the additional
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1075.1">
       starting-token
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1076.1">
      ,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1077.1">
       page-size
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1078.1">
      , and
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1079.1">
       max-items
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1080.1">
      parameters for paginating
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1081.1">
       the result.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1082.1">
      The AWS CLI pagination parameters,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1083.1">
       starting-token
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1084.1">
      ,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1085.1">
       page-size
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1086.1">
      , and
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1087.1">
       max-items
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1088.1">
      , have the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1089.1">
       following functions:
      </span>
     </span>
     <ul>
      <li>
       <span class="koboSpan" id="kobo.1090.1">
        The
       </span>
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.1091.1">
         max-items
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1092.1">
        parameter states the maximum number of items that need to be returned by
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.1093.1">
         the API.
        </span>
       </span>
      </li>
      <li>
       <span class="koboSpan" id="kobo.1094.1">
        If there are more results from the API calls than specified by
       </span>
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.1095.1">
         max-items
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1096.1">
        , then
       </span>
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.1097.1">
         NextToken
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1098.1">
        is provided in the response, which needs to be passed as
       </span>
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.1099.1">
         starting-token
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1100.1">
        in the
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.1101.1">
         next request.
        </span>
       </span>
      </li>
      <li>
       <span class="koboSpan" id="kobo.1102.1">
        The
       </span>
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.1103.1">
         page-size
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1104.1">
        parameter specifies the maximum number of elements to retrieve in a single API call.
       </span>
       <span class="koboSpan" id="kobo.1104.2">
        For example, if
       </span>
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.1105.1">
         page-size
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1106.1">
        is
       </span>
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.1107.1">
         10
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1108.1">
        and
       </span>
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.1109.1">
         max-items
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1110.1">
        is
       </span>
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.1111.1">
         100
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1112.1">
        , 10 API calls will be made in the background and then 100 items will
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.1113.1">
         be returned.
        </span>
       </span>
      </li>
     </ul>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1114.1">
      The
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1115.1">
       revoke-grant
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1116.1">
      subcommand
     </span>
     <a id="_idIndexMarker458">
     </a>
     <span class="koboSpan" id="kobo.1117.1">
      can be run by the root user of the account
     </span>
     <a id="_idIndexMarker459">
     </a>
     <span class="koboSpan" id="kobo.1118.1">
      that created it,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1119.1">
       RetiringPrincipal
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1120.1">
      of the grant, or
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1121.1">
       GranteePrincipal
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1122.1">
      if they’ve been given the grant for the
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1123.1">
        RetireGrant
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1124.1">
       operation.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1125.1">
      The AWS documentation recommends that, when cleaning up, we retire a grant when we’re done using it using the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1126.1">
       retire-grant
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1127.1">
      subcommand.
     </span>
     <span class="koboSpan" id="kobo.1127.2">
      However, we should revoke a grant using the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1128.1">
       revoke-grant
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1129.1">
      subcommand when we intend to actively deny operations that depend
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1130.1">
       on it.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1131.1">
      The
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1132.1">
       list-retirable-grants
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1133.1">
      subcommand can be used to list all grants with the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1134.1">
       specified
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1135.1">
        RetiringPrincipal
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1136.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1137.1">
      The
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1138.1">
       list-retirable-grants
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1139.1">
      subcommand provides the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1140.1">
       limit
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1141.1">
      and
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1142.1">
       maker
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1143.1">
      parameters to limit the retriable grants that need to be returned.
     </span>
     <span class="koboSpan" id="kobo.1143.2">
      Here,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1144.1">
       limit
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1145.1">
      is the maximum number of items that need to be returned, while
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1146.1">
       marker
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1147.1">
      is the value of
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1148.1">
       NextMarker
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1149.1">
      that is returned with the previous request when more items than what’s specified by the limit parameter need to
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1150.1">
       be returned.
      </span>
     </span>
    </li>
   </ul>
   <h2 id="_idParaDest-113">
    <a id="_idTextAnchor114">
    </a>
    <span class="koboSpan" id="kobo.1151.1">
     See also
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1152.1">
     To understand the basics
    </span>
    <a id="_idIndexMarker460">
    </a>
    <span class="koboSpan" id="kobo.1153.1">
     of grants in AWS KMS, refer to this blog
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1154.1">
      post:
     </span>
    </span>
    <a href="https://www.cloudericks.com/blog/understanding-grants-in-aws-kms">
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1155.1">
       https://www.cloudericks.
      </span>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1156.1">
       com/blog/understanding-grants-in-aws-kms
      </span>
     </span>
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1157.1">
      .
     </span>
    </span>
   </p>
   <h1 id="_idParaDest-114">
    <a id="_idTextAnchor115">
    </a>
    <span class="koboSpan" id="kobo.1158.1">
     Using key policies with conditional keys
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.1159.1">
     In this recipe, we will
    </span>
    <a id="_idIndexMarker461">
    </a>
    <span class="koboSpan" id="kobo.1160.1">
     learn how to use
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1161.1">
      key policies
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1162.1">
     , especially with conditions.
    </span>
    <span class="koboSpan" id="kobo.1162.2">
     Resource-based policies
    </span>
    <a id="_idIndexMarker462">
    </a>
    <span class="koboSpan" id="kobo.1163.1">
     for KMS keys are called key policies.
    </span>
    <span class="koboSpan" id="kobo.1163.2">
     When managing access to KMS resources, we can use key policies alone, or we can use IAM policies and grants along with key policies.
    </span>
    <span class="koboSpan" id="kobo.1163.3">
     Unlike other resource-based policies such as bucket policies, which are not mandatory, key policies are mandatory to manage and use keys.
    </span>
    <span class="koboSpan" id="kobo.1163.4">
     When a key is created, a default key policy is created by AWS, as we saw in the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.1164.1">
      Creating keys in
     </span>
    </em>
    <span class="No-Break">
     <em class="italic">
      <span class="koboSpan" id="kobo.1165.1">
       KMS
      </span>
     </em>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1166.1">
      recipe.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-115">
    <a id="_idTextAnchor116">
    </a>
    <span class="koboSpan" id="kobo.1167.1">
     Getting ready
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1168.1">
     We’ll need the following to complete
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1169.1">
      this recipe:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.1170.1">
      A working AWS account,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1171.1">
       awsseccb-sandbox-1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1172.1">
      , and a user,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1173.1">
       awsseccbadmin1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1174.1">
      , as described in the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.1175.1">
       Technical
      </span>
     </em>
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.1176.1">
        requirements
       </span>
      </em>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1177.1">
       section.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1178.1">
      An S3 bucket created in the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1179.1">
       us-east-1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1180.1">
      region.
     </span>
     <span class="koboSpan" id="kobo.1180.2">
      I will use a bucket
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1181.1">
       called
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1182.1">
        awssecuritykmsbucket
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1183.1">
       .
      </span>
     </span>
    </li>
   </ul>
   <h2 id="_idParaDest-116">
    <a id="_idTextAnchor117">
    </a>
    <span class="koboSpan" id="kobo.1184.1">
     How to do it...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1185.1">
     We can demonstrate the use of key policies with condition keys
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1186.1">
      as follows:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.1187.1">
      Create a key with the default configuration from the console,
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1188.1">
       as follows:
      </span>
     </span>
     <ol>
      <li class="Alphabets">
       <span class="koboSpan" id="kobo.1189.1">
        Go to
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.1190.1">
         Key Management Service (KMS)
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1191.1">
        in the
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.1192.1">
         Management Console.
        </span>
       </span>
      </li>
      <li class="Alphabets">
       <span class="koboSpan" id="kobo.1193.1">
        Select
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.1194.1">
         Customer-managed keys
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1195.1">
        from the left sidebar and click
       </span>
       <span class="No-Break">
        <strong class="bold">
         <span class="koboSpan" id="kobo.1196.1">
          Create key
         </span>
        </strong>
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.1197.1">
         .
        </span>
       </span>
      </li>
      <li class="Alphabets">
       <span class="koboSpan" id="kobo.1198.1">
        In the
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.1199.1">
         Configure key
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1200.1">
        pane, under
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.1201.1">
         Key type
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1202.1">
        , select
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.1203.1">
         Symmetric
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1204.1">
        .
       </span>
       <span class="koboSpan" id="kobo.1204.2">
        Then, under
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.1205.1">
         Key usage
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1206.1">
        , select
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.1207.1">
         Encrypt and decrypt
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1208.1">
        .
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.1209.1">
         Click
        </span>
       </span>
       <span class="No-Break">
        <strong class="bold">
         <span class="koboSpan" id="kobo.1210.1">
          Next
         </span>
        </strong>
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.1211.1">
         .
        </span>
       </span>
      </li>
      <li class="Alphabets">
       <span class="koboSpan" id="kobo.1212.1">
        Provide
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.1213.1">
         Alias
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1214.1">
        and
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.1215.1">
         Description
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1216.1">
        values, leave
       </span>
       <a id="_idIndexMarker463">
       </a>
       <span class="koboSpan" id="kobo.1217.1">
        the other selections
       </span>
       <a id="_idIndexMarker464">
       </a>
       <span class="koboSpan" id="kobo.1218.1">
        as-is, and
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.1219.1">
         click
        </span>
       </span>
       <span class="No-Break">
        <strong class="bold">
         <span class="koboSpan" id="kobo.1220.1">
          Next
         </span>
        </strong>
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.1221.1">
         .
        </span>
       </span>
      </li>
      <li class="Alphabets">
       <span class="koboSpan" id="kobo.1222.1">
        On the next screen, do not add any
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.1223.1">
         Key administrators
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1224.1">
        .
       </span>
       <span class="koboSpan" id="kobo.1224.2">
        Instead, simply
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.1225.1">
         click
        </span>
       </span>
       <span class="No-Break">
        <strong class="bold">
         <span class="koboSpan" id="kobo.1226.1">
          Next
         </span>
        </strong>
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.1227.1">
         .
        </span>
       </span>
      </li>
      <li class="Alphabets">
       <span class="koboSpan" id="kobo.1228.1">
        In the
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.1229.1">
         Define key usage permissions
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1230.1">
        pane, do not add any
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.1231.1">
         Key users
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1232.1">
        either.
       </span>
       <span class="koboSpan" id="kobo.1232.2">
        Simply
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.1233.1">
         click
        </span>
       </span>
       <span class="No-Break">
        <strong class="bold">
         <span class="koboSpan" id="kobo.1234.1">
          Next
         </span>
        </strong>
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.1235.1">
         .
        </span>
       </span>
      </li>
      <li class="Alphabets">
       <span class="koboSpan" id="kobo.1236.1">
        At this point, we should see the policy, as shown in the following figure.
       </span>
       <span class="koboSpan" id="kobo.1236.2">
        Review and
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.1237.1">
         click
        </span>
       </span>
       <span class="No-Break">
        <strong class="bold">
         <span class="koboSpan" id="kobo.1238.1">
          Finish
         </span>
        </strong>
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.1239.1">
         :
        </span>
       </span>
      </li>
     </ol>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer090">
     <span class="koboSpan" id="kobo.1240.1">
      <img alt="Figure 3.15 – The key policy for review" src="image/B21384_03_15.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.1241.1">
     Figure 3.15 – The key policy for review
    </span>
   </p>
   <ol>
    <li value="2">
     <span class="koboSpan" id="kobo.1242.1">
      We can add this KMS key as the encryption key for an S3 bucket in the same region
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1243.1">
       as follows:
      </span>
     </span>
     <ol>
      <li class="Alphabets">
       <span class="koboSpan" id="kobo.1244.1">
        Go to the
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.1245.1">
         Properties
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1246.1">
        tab of our
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.1247.1">
         S3 bucket.
        </span>
       </span>
      </li>
      <li class="Alphabets">
       <span class="koboSpan" id="kobo.1248.1">
        Scroll down to
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.1249.1">
         Default encryption
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1250.1">
        and
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.1251.1">
         click
        </span>
       </span>
       <span class="No-Break">
        <strong class="bold">
         <span class="koboSpan" id="kobo.1252.1">
          Edit
         </span>
        </strong>
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.1253.1">
         .
        </span>
       </span>
      </li>
      <li class="Alphabets">
       <span class="koboSpan" id="kobo.1254.1">
        In the
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.1255.1">
         Default encryption
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1256.1">
        pane, under
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.1257.1">
         Encryption type
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1258.1">
        , select
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.1259.1">
         Server-side encryption with AWS Key Management Service
        </span>
       </strong>
       <span class="No-Break">
        <strong class="bold">
         <span class="koboSpan" id="kobo.1260.1">
          keys (SSE-KMS)
         </span>
        </strong>
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.1261.1">
         .
        </span>
       </span>
      </li>
      <li class="Alphabets">
       <span class="koboSpan" id="kobo.1262.1">
        Under
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.1263.1">
         AWS KMS key
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1264.1">
        , enter the ARN
       </span>
       <a id="_idIndexMarker465">
       </a>
       <span class="koboSpan" id="kobo.1265.1">
        of the key
       </span>
       <a id="_idIndexMarker466">
       </a>
       <span class="koboSpan" id="kobo.1266.1">
        that
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.1267.1">
         we created.
        </span>
       </span>
      </li>
      <li class="Alphabets">
       <span class="koboSpan" id="kobo.1268.1">
        For
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.1269.1">
         Bucket Key
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1270.1">
        ,
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.1271.1">
         select
        </span>
       </span>
       <span class="No-Break">
        <strong class="bold">
         <span class="koboSpan" id="kobo.1272.1">
          Disable
         </span>
        </strong>
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.1273.1">
         .
        </span>
       </span>
      </li>
      <li class="Alphabets">
       <span class="koboSpan" id="kobo.1274.1">
        Click
       </span>
       <span class="No-Break">
        <strong class="bold">
         <span class="koboSpan" id="kobo.1275.1">
          Save changes
         </span>
        </strong>
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.1276.1">
         .
        </span>
       </span>
      </li>
     </ol>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer091">
     <span class="koboSpan" id="kobo.1277.1">
      <img alt="Figure 3.16 – Adding an encryption key for an S3 bucket" src="image/B21384_03_16.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.1278.1">
     Figure 3.16 – Adding an encryption key for an S3 bucket
    </span>
   </p>
   <ol>
    <li value="3">
     <span class="koboSpan" id="kobo.1279.1">
      Upload a file to S3 and verify that encryption and decryption
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1280.1">
       are working:
      </span>
     </span>
     <ol>
      <li class="Alphabets">
       <span class="koboSpan" id="kobo.1281.1">
        Upload a file into the
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.1282.1">
         S3 bucket.
        </span>
       </span>
      </li>
      <li class="Alphabets">
       <span class="koboSpan" id="kobo.1283.1">
        Click on that file
       </span>
       <a id="_idIndexMarker467">
       </a>
       <span class="koboSpan" id="kobo.1284.1">
        and click
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.1285.1">
         Open
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1286.1">
        .
       </span>
       <span class="koboSpan" id="kobo.1286.2">
        We should
       </span>
       <a id="_idIndexMarker468">
       </a>
       <span class="koboSpan" id="kobo.1287.1">
        be able to view the
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.1288.1">
         file’s contents.
        </span>
       </span>
      </li>
     </ol>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer092">
     <span class="koboSpan" id="kobo.1289.1">
      <img alt="Figure 3.17 – Viewing the content of the S3 bucket" src="image/B21384_03_17.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.1290.1">
     Figure 3.17 – Viewing the content of the S3 bucket
    </span>
   </p>
   <ol>
    <li value="4">
     <span class="koboSpan" id="kobo.1291.1">
      Deny key usages from the S3 service by adding a key
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1292.1">
       policy statement:
      </span>
     </span>
     <ol>
      <li class="Alphabets">
       <span class="koboSpan" id="kobo.1293.1">
        Go to
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.1294.1">
         Key Management Service
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1295.1">
        in the
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.1296.1">
         Management Console.
        </span>
       </span>
      </li>
      <li class="Alphabets">
       <span class="koboSpan" id="kobo.1297.1">
        Click
       </span>
       <span class="No-Break">
        <strong class="bold">
         <span class="koboSpan" id="kobo.1298.1">
          Customer-managed keys
         </span>
        </strong>
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.1299.1">
         .
        </span>
       </span>
      </li>
      <li class="Alphabets">
       <span class="koboSpan" id="kobo.1300.1">
        Click on the key we need
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.1301.1">
         to modify.
        </span>
       </span>
      </li>
      <li class="Alphabets">
       <span class="koboSpan" id="kobo.1302.1">
        Click on the
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.1303.1">
         Key
        </span>
       </strong>
       <span class="No-Break">
        <strong class="bold">
         <span class="koboSpan" id="kobo.1304.1">
          policy
         </span>
        </strong>
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.1305.1">
         tab.
        </span>
       </span>
      </li>
      <li class="Alphabets">
       <span class="koboSpan" id="kobo.1306.1">
        Click
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.1307.1">
         Switch to
        </span>
       </strong>
       <span class="No-Break">
        <strong class="bold">
         <span class="koboSpan" id="kobo.1308.1">
          policy view
         </span>
        </strong>
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.1309.1">
         .
        </span>
       </span>
      </li>
      <li class="Alphabets">
       <span class="koboSpan" id="kobo.1310.1">
        Click
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.1311.1">
         Edit
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1312.1">
        , add the following key
       </span>
       <a id="_idIndexMarker469">
       </a>
       <span class="koboSpan" id="kobo.1313.1">
        policy statement with proper
       </span>
       <a id="_idIndexMarker470">
       </a>
       <span class="koboSpan" id="kobo.1314.1">
        commas, and click
       </span>
       <span class="No-Break">
        <strong class="bold">
         <span class="koboSpan" id="kobo.1315.1">
          Save changes
         </span>
        </strong>
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.1316.1">
         .
        </span>
       </span>
      </li>
     </ol>
     <pre class="source-code"><span class="koboSpan" id="kobo.1317.1">
{
    "Effect": "Deny",
    "Principal": {
        "AWS": "arn:aws:iam::135301570106:root"
    },
    "Action": [
        "kms:Encrypt",
        "kms:Decrypt",
"kms:ReEncrypt*",
        "kms:GenerateDataKey*",
        "kms:CreateGrant",
        "kms:ListGrants",
        "kms:DescribeKey"
    ],
    "Resource": "*",
    "Condition": {
        "StringEquals": {
            "kms:ViaService": "s3.us-east-1.amazonaws.com"
        }
    }
}</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1318.1">
      Go back to the same file we opened in
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.1319.1">
       Step 3
      </span>
     </em>
     <span class="koboSpan" id="kobo.1320.1">
      and click
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1321.1">
       Open
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1322.1">
      to open the file.
     </span>
     <span class="koboSpan" id="kobo.1322.2">
      We won’t be able to view the file now and will get the following error.
     </span>
     <span class="koboSpan" id="kobo.1322.3">
      This has happened because
     </span>
     <a id="_idIndexMarker471">
     </a>
     <span class="koboSpan" id="kobo.1323.1">
      S3 doesn’t have permission
     </span>
     <a id="_idIndexMarker472">
     </a>
     <span class="koboSpan" id="kobo.1324.1">
      to use the key to
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1325.1">
       perform decryption:
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer093">
     <span class="koboSpan" id="kobo.1326.1">
      <img alt="Figure 3.18 – Error while trying to view the content of the S3 bucket after encryption" src="image/B21384_03_18.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.1327.1">
     Figure 3.18 – Error while trying to view the content of the S3 bucket after encryption
    </span>
   </p>
   <p class="list-inset">
    <span class="koboSpan" id="kobo.1328.1">
     If we try to run the URL directly on a browser without clicking
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1329.1">
      Open
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1330.1">
     from the S3 console, the file won’t be displayed with or without the key condition policy since we’re using
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1331.1">
      SSE-KMS encryption.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-117">
    <a id="_idTextAnchor118">
    </a>
    <span class="koboSpan" id="kobo.1332.1">
     How it works...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1333.1">
     In this recipe, we created a key with default permissions and tried encrypting and decrypting files in the S3 bucket with that key.
    </span>
    <span class="koboSpan" id="kobo.1333.2">
     We were able to successfully encrypt and decrypt.
    </span>
    <span class="koboSpan" id="kobo.1333.3">
     Then, we added an explicit
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1334.1">
      Deny
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1335.1">
     for the S3 service using the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1336.1">
      kms:ViaService
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1337.1">
     condition key and tried decrypting the same file again.
    </span>
    <span class="koboSpan" id="kobo.1337.2">
     This time, we weren’t able
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1338.1">
      to decrypt.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1339.1">
     As we saw in
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.1340.1">
      Step 1
     </span>
    </em>
    <span class="koboSpan" id="kobo.1341.1">
     of this recipe, the default key policy gives full permission to the owner account’s root user and enables the IAM policies that are required to access the KMS key.
    </span>
    <span class="koboSpan" id="kobo.1341.2">
     It also allows key administrators to administrate the KMS key and key users to use the KMS key.
    </span>
    <span class="koboSpan" id="kobo.1341.3">
     Also, we need to specify the region for the S3 service while using it within the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1342.1">
      ViaService
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1343.1">
     API.
    </span>
    <span class="koboSpan" id="kobo.1343.2">
     I used
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1344.1">
      us-east-1
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1345.1">
     since my bucket is present
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1346.1">
      in
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1347.1">
       us-east-1
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1348.1">
      .
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1349.1">
     In our key policy JSON, we used the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1350.1">
      following elements:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1351.1">
       Effect
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1352.1">
      : Specifies whether to allow or
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1353.1">
       deny permissions.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1354.1">
       Principal
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1355.1">
      : Specifies who gets the permissions.
     </span>
     <span class="koboSpan" id="kobo.1355.2">
      Allowed values include AWS accounts (root), IAM users, IAM roles, and supported
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1356.1">
       AWS services.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1357.1">
       Action
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1358.1">
      : Specifies the operations (for example,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1359.1">
       kms:Encrypt
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1360.1">
      ) to allow
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1361.1">
       or deny.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1362.1">
       Resource
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1363.1">
      : Specifies the resource to apply the policy.
     </span>
     <span class="koboSpan" id="kobo.1363.2">
      We specified
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1364.1">
       *
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1365.1">
      to denote all
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1366.1">
       the resources.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1367.1">
       Condition
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1368.1">
      : Used to specify
     </span>
     <a id="_idIndexMarker473">
     </a>
     <span class="koboSpan" id="kobo.1369.1">
      any condition for the key policy
     </span>
     <a id="_idIndexMarker474">
     </a>
     <span class="koboSpan" id="kobo.1370.1">
      to take effect.
     </span>
     <span class="koboSpan" id="kobo.1370.2">
      This is an
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1371.1">
       optional element.
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.1372.1">
     We can also specify an optional
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1373.1">
      Sid
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1374.1">
     parameter.
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1375.1">
      Sid
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1376.1">
     stands for
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1377.1">
      statement identifier
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1378.1">
     and can contain
    </span>
    <a id="_idIndexMarker475">
    </a>
    <span class="koboSpan" id="kobo.1379.1">
     a string value that describes
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1380.1">
      our policy.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-118">
    <a id="_idTextAnchor119">
    </a>
    <span class="koboSpan" id="kobo.1381.1">
     There’s more...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1382.1">
     Let’s quickly go through some important
    </span>
    <a id="_idIndexMarker476">
    </a>
    <span class="koboSpan" id="kobo.1383.1">
     concepts about using
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1384.1">
      key policies:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.1385.1">
      To manage access to KMS resources, we can use key policies alone, or we can use IAM policies and grants along with
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1386.1">
       key policies.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1387.1">
      To allow access to KMS keys, we always need to use key policies, either alone or along with IAM policies
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1388.1">
       or grants.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1389.1">
      The primary resource within KMS is the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1390.1">
       KMS key.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1391.1">
      A KMS key’s ARN has the following form:
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1392.1">
        arn:aws:kms:&lt;region&gt;:&lt;accountID&gt;:key/&lt;key ID&gt;
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1393.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1394.1">
      Some KMS operations also allow the use of an alias as a resource.
     </span>
     <span class="koboSpan" id="kobo.1394.2">
      An alias ARN has the following form:
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1395.1">
       arn:aws:kms:&lt;region&gt;:&lt;account
      </span>
     </strong>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1396.1">
        ID&gt;:alias/&lt;alias name&gt;
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1397.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1398.1">
      Any user, including the root user, can access the KMS key, but only if the key policy
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1399.1">
       allows it.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1400.1">
      The default key policy when a KMS key is created from the Management Console gives full permission to the owner’s account root user and also enables IAM policies that are required to access the KMS key.
     </span>
     <span class="koboSpan" id="kobo.1400.2">
      It will also allow key administrators to administrate the KMS key and key users to use the KMS key.
     </span>
     <span class="koboSpan" id="kobo.1400.3">
      The default key policy when a KMS key is created programmatically gives full permission to the owner’s account root user.
     </span>
     <span class="koboSpan" id="kobo.1400.4">
      It also enables IAM policies that are required to access the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1401.1">
       KMS key.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1402.1">
      When we add key administrators or key users, they are added to the policy document statement with the required permissions.
     </span>
     <span class="koboSpan" id="kobo.1402.2">
      We saw the complete list of permissions for both key administrators and key users in the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.1403.1">
       Creating keys in
      </span>
     </em>
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.1404.1">
        KMS
       </span>
      </em>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1405.1">
       recipe.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1406.1">
      AWS has added a wildcard to some of the default permissions, such as
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1407.1">
       kms:Create*
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1408.1">
      ,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1409.1">
       kms:Describe*
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1410.1">
      , and others, so that if AWS creates a new action that starts with the same prefix, the administrators or users will get those
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1411.1">
       permissions automatically.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1412.1">
      AWS provides global condition
     </span>
     <a id="_idIndexMarker477">
     </a>
     <span class="koboSpan" id="kobo.1413.1">
      keys, as well as
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1414.1">
       service-specific keys.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1415.1">
      The global condition keys include
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1416.1">
       aws:PrincipalTag
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1417.1">
      ,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1418.1">
       aws:PrincipalType
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1419.1">
      ,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1420.1">
       aws:RequestTag
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1421.1">
      ,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1422.1">
       aws:SourceIp
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1423.1">
      ,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1424.1">
       aws:SourceVpc
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1425.1">
      ,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1426.1">
       aws:SourceVpce
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1427.1">
      ,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1428.1">
       aws:TagKeys
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1429.1">
      ,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1430.1">
       aws:TokenIssueTime
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1431.1">
      ,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1432.1">
       aws:userid
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1433.1">
      ,
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1434.1">
       and
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1435.1">
        aws:username
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1436.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1437.1">
      The AWS KMS condition keys include
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1438.1">
       kms:BypassPolicyLockoutSafetyCheck
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1439.1">
      ,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1440.1">
       kms:CallerAccount
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1441.1">
      ,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1442.1">
       kms:EncryptionContext
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1443.1">
      ,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1444.1">
       kms:EncryptionContextKeys
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1445.1">
      ,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1446.1">
       kms:ExpirationModel
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1447.1">
      ,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1448.1">
       kms:GrantConstraintType
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1449.1">
      ,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1450.1">
       kms:GrantIsForAWSResource
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1451.1">
      ,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1452.1">
       kms:GrantOperations
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1453.1">
      ,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1454.1">
       kms:GranteePrincipal
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1455.1">
      ,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1456.1">
       kms:KeyOrigin
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1457.1">
      ,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1458.1">
       kms:ReEncryptOnSameKey
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1459.1">
      ,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1460.1">
       kms:RetiringPrincipal
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1461.1">
      ,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1462.1">
       kms:ValidTo
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1463.1">
      ,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1464.1">
       kms:ViaService
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1465.1">
      ,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1466.1">
       kms:WrappingAlgorithm
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1467.1">
      ,
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1468.1">
       and
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1469.1">
        kms:WrappingKeySpec
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1470.1">
       .
      </span>
     </span>
    </li>
   </ul>
   <h2 id="_idParaDest-119">
    <a id="_idTextAnchor120">
    </a>
    <span class="koboSpan" id="kobo.1471.1">
     See also
    </span>
   </h2>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.1472.1">
      You can read more
     </span>
     <a id="_idIndexMarker478">
     </a>
     <span class="koboSpan" id="kobo.1473.1">
      about AWS KMS key policies
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1474.1">
       here:
      </span>
     </span>
     <a href="https://www.cloudericks.com/blog/understanding-key-policies-in-aws-kms">
      <span class="No-Break">
       <span class="koboSpan" id="kobo.1475.1">
        https://www.cloudericks.
       </span>
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.1476.1">
        com/blog/understanding-key-policies-in-aws-kms
       </span>
      </span>
     </a>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1477.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1478.1">
      You can read about
     </span>
     <a id="_idIndexMarker479">
     </a>
     <span class="koboSpan" id="kobo.1479.1">
      the differences between key policies and grants
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1480.1">
       here:
      </span>
     </span>
     <a href="https://www.cloudericks.com/blog/understanding-aws-kms-key-policies-vs-grants">
      <span class="No-Break">
       <span class="koboSpan" id="kobo.1481.1">
        https://www.cloudericks.com/blog/understanding-aws-kms-key-policies-vs-grants
       </span>
      </span>
     </a>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1482.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1483.1">
      You can read more about
     </span>
     <a id="_idIndexMarker480">
     </a>
     <span class="koboSpan" id="kobo.1484.1">
      AWS KMS condition keys
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1485.1">
       here:
      </span>
     </span>
     <a href="https://www.cloudericks.com/blog/understanding-aws-kms-condition-keys">
      <span class="No-Break">
       <span class="koboSpan" id="kobo.1486.1">
        https://www.cloudericks.com/blog/understanding-aws-kms-condition-keys
       </span>
      </span>
     </a>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1487.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1488.1">
      You can read more about
     </span>
     <a id="_idIndexMarker481">
     </a>
     <span class="koboSpan" id="kobo.1489.1">
      policies and permissions within AWS
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1490.1">
       here:
      </span>
     </span>
     <a href="https://www.cloudericks.com/blog/demystifying-aws-policies-and-permissions">
      <span class="No-Break">
       <span class="koboSpan" id="kobo.1491.1">
        https://www.cloudericks.com/blog/demystifying-aws-policies-and-permissions
       </span>
      </span>
     </a>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1492.1">
       .
      </span>
     </span>
    </li>
   </ul>
   <h1 id="_idParaDest-120">
    <a id="_idTextAnchor121">
    </a>
    <span class="koboSpan" id="kobo.1493.1">
     Sharing customer-managed keys across accounts
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.1494.1">
     In this recipe, we will learn
    </span>
    <a id="_idIndexMarker482">
    </a>
    <span class="koboSpan" id="kobo.1495.1">
     how to use a KMS key from one account
    </span>
    <a id="_idIndexMarker483">
    </a>
    <span class="koboSpan" id="kobo.1496.1">
     in
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1497.1">
      another account.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-121">
    <a id="_idTextAnchor122">
    </a>
    <span class="koboSpan" id="kobo.1498.1">
     Getting ready
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1499.1">
     We’ll need the following to complete
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1500.1">
      this recipe:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.1501.1">
      Two working AWS accounts.
     </span>
     <span class="koboSpan" id="kobo.1501.2">
      I will be using the accounts we created in
     </span>
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.1502.1">
        Chapter 1
       </span>
      </em>
     </span>
     <span class="koboSpan" id="kobo.1503.1">
      , with the account ID of the first account being
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1504.1">
       135301570106
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1505.1">
      and the account ID of the second account
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1506.1">
       being
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1507.1">
        380701114427
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1508.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1509.1">
      A user from account 2 with
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1510.1">
       AdministratorAccess
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1511.1">
      permission.
     </span>
     <span class="koboSpan" id="kobo.1511.2">
      This could be an IAM user or an IAM Identity Center user.
     </span>
     <span class="koboSpan" id="kobo.1511.3">
      The CLI profile should be configured for this user.
     </span>
     <span class="koboSpan" id="kobo.1511.4">
      I will be calling the CLI
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1512.1">
       profile
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1513.1">
        Adminuserprofile
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1514.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1515.1">
      Another user without administrator permissions in account 2.
     </span>
     <span class="koboSpan" id="kobo.1515.2">
      The CLI profile should be configured for this user.
     </span>
     <span class="koboSpan" id="kobo.1515.3">
      I will be calling this user and its CLI
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1516.1">
       profile
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1517.1">
        Testuserprofile
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1518.1">
       .
      </span>
     </span>
    </li>
   </ul>
   <h2 id="_idParaDest-122">
    <a id="_idTextAnchor123">
    </a>
    <span class="koboSpan" id="kobo.1519.1">
     How to do it...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1520.1">
     First, we will create a new
    </span>
    <a id="_idIndexMarker484">
    </a>
    <span class="koboSpan" id="kobo.1521.1">
     KMS key in the first
    </span>
    <a id="_idIndexMarker485">
    </a>
    <span class="koboSpan" id="kobo.1522.1">
     account.
    </span>
    <span class="koboSpan" id="kobo.1522.2">
     After that, we will provide permission to use it from the second account.
    </span>
    <span class="koboSpan" id="kobo.1522.3">
     Finally, we will test the first account from the second account using that
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1523.1">
      KMS key.
     </span>
    </span>
   </p>
   <h3>
    <span class="koboSpan" id="kobo.1524.1">
     Creating a key and giving permission to the other account
    </span>
   </h3>
   <p>
    <span class="koboSpan" id="kobo.1525.1">
     In this section, we will create
    </span>
    <a id="_idIndexMarker486">
    </a>
    <span class="koboSpan" id="kobo.1526.1">
     a key in account 1 with key usage permission to account 2.
    </span>
    <span class="koboSpan" id="kobo.1526.2">
     Let’s
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1527.1">
      get started:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.1528.1">
      Log in to the AWS Management Console and go to
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1529.1">
       Key
      </span>
     </strong>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1530.1">
        Management Service
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1531.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1532.1">
      Click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1533.1">
       Customer managed keys
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1534.1">
      from the left sidebar and click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1535.1">
       Create key
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1536.1">
      at the top right of
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1537.1">
       the page.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1538.1">
      In the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1539.1">
       Configure key
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1540.1">
      pane, for
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1541.1">
       Key type
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1542.1">
      , select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1543.1">
       Symmetric
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1544.1">
      , and for
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1545.1">
       Key usage
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1546.1">
      , select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1547.1">
       Encrypt and decrypt
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1548.1">
      .
     </span>
     <span class="koboSpan" id="kobo.1548.2">
      Then,
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1549.1">
       click
      </span>
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1550.1">
        Next
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1551.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1552.1">
      In the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1553.1">
       Add labels
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1554.1">
      pane, provide
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1555.1">
       Alias
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1556.1">
      and
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1557.1">
       Description
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1558.1">
      values.
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1559.1">
       Click
      </span>
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1560.1">
        Next
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1561.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1562.1">
      On the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1563.1">
       Define key administrative permissions
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1564.1">
      screen, we can add any
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1565.1">
       Key administrators
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1566.1">
      if we want to and select the checkbox for
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1567.1">
       Allow key administrators to delete this key
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1568.1">
      .
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1569.1">
       Click
      </span>
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1570.1">
        Next
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1571.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1572.1">
      On the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1573.1">
       Define key usage permissions
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1574.1">
      screen, scroll down to the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1575.1">
       Other AWS accounts
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1576.1">
      section and click
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1577.1">
       Add another AWS account
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1578.1">
      , as shown in the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1579.1">
       following figure:
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer094">
     <span class="koboSpan" id="kobo.1580.1">
      <img alt="Figure 3.19 – The Other AWS accounts section" src="image/B21384_03_19.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.1581.1">
     Figure 3.19 – The Other AWS accounts section
    </span>
   </p>
   <ol>
    <li value="7">
     <span class="koboSpan" id="kobo.1582.1">
      Enter the account ID
     </span>
     <a id="_idIndexMarker487">
     </a>
     <span class="koboSpan" id="kobo.1583.1">
      of the second AWS account and
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1584.1">
       click
      </span>
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1585.1">
        Next
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1586.1">
       .
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer095">
     <span class="koboSpan" id="kobo.1587.1">
      <img alt="Figure 3.20 – Adding other AWS accounts" src="image/B21384_03_20.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.1588.1">
     Figure 3.20 – Adding other AWS accounts
    </span>
   </p>
   <ol>
    <li value="8">
     <span class="koboSpan" id="kobo.1589.1">
      On the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1590.1">
       Review
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1591.1">
      screen, review the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1592.1">
       Key policy
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1593.1">
      details and click
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1594.1">
       Finish
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1595.1">
      .
     </span>
     <span class="koboSpan" id="kobo.1595.2">
      The statement that’s been added to the key policy is available within the code files
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1596.1">
       as
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1597.1">
        key-policy-sharing-keys.json
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1598.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1599.1">
      Once we get a success message that the key has been created, click
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1600.1">
       View key
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1601.1">
      to see the details of the key.
     </span>
     <span class="koboSpan" id="kobo.1601.2">
      The ARN for my newly created key is
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1602.1">
       as follows:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1603.1">arn:aws:kms:us-east-1:201882936474:key/24ce962a-ee5e-411e-9cb6-ebbee39e253c</span></strong></pre>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.1604.1">
     In this section, we created
    </span>
    <a id="_idIndexMarker488">
    </a>
    <span class="koboSpan" id="kobo.1605.1">
     a key in account 1 and gave permission to account 2.
    </span>
    <span class="koboSpan" id="kobo.1605.2">
     In the next section, we will use this key in
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1606.1">
      account 2.
     </span>
    </span>
   </p>
   <h3>
    <span class="koboSpan" id="kobo.1607.1">
     Using the key as an administrator user from account 2
    </span>
   </h3>
   <p>
    <span class="koboSpan" id="kobo.1608.1">
     Now, let’s try using the key
    </span>
    <a id="_idIndexMarker489">
    </a>
    <span class="koboSpan" id="kobo.1609.1">
     as a user with administrator permission from
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1610.1">
      account 2.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1611.1">
     Encrypt the data with the profile of an administrator user from account 2 from the CLI using the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1612.1">
      following command:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.1613.1">
aws kms encrypt --plaintext "$(echo -n 'hello heartin' | base64)" --key-id arn:aws:kms:us-east-1:201882936474:key/24ce962a-ee5e-411e-9cb6-ebbee39e253c --profile Adminuserprofile</span></pre>
   <p>
    <span class="koboSpan" id="kobo.1614.1">
     We should see the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1615.1">
      following response:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer096">
     <span class="koboSpan" id="kobo.1616.1">
      <img alt="Figure 3.21 – Response after running the encrypt command for the admin user" src="image/B21384_03_21.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.1617.1">
     Figure 3.21 – Response after running the encrypt command for the admin user
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1618.1">
     In the next section, we will use the key as a non-admin user from
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1619.1">
      account 2.
     </span>
    </span>
   </p>
   <h3>
    <span class="koboSpan" id="kobo.1620.1">
     Using the key as a non-admin user from account 2
    </span>
   </h3>
   <p>
    <span class="koboSpan" id="kobo.1621.1">
     Before proceeding, we can
    </span>
    <a id="_idIndexMarker490">
    </a>
    <span class="koboSpan" id="kobo.1622.1">
     verify that the non-admin user doesn’t have access to encrypt the data in account 1 by running the command shown in
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.1623.1">
      Step 1
     </span>
    </em>
    <span class="koboSpan" id="kobo.1624.1">
     of the previous section while using the non-admin user profile.
    </span>
    <span class="koboSpan" id="kobo.1624.2">
     Now, follow
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1625.1">
      these steps:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.1626.1">
      To use the KMS key as a non-admin user, the root or the admin user of account 2 has to delegate the permission to the non-admin user.
     </span>
     <span class="koboSpan" id="kobo.1626.2">
      To do so, they must follow
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1627.1">
       these steps:
      </span>
     </span>
     <ol>
      <li class="Alphabets">
       <span class="koboSpan" id="kobo.1628.1">
        Go to the
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.1629.1">
         IAM
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1630.1">
        dashboard of
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.1631.1">
         account 2.
        </span>
       </span>
      </li>
      <li class="Alphabets">
       <span class="koboSpan" id="kobo.1632.1">
        Click on
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.1633.1">
         Policies
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1634.1">
        on the
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.1635.1">
         left pane.
        </span>
       </span>
      </li>
      <li class="Alphabets">
       <span class="koboSpan" id="kobo.1636.1">
        Click
       </span>
       <span class="No-Break">
        <strong class="bold">
         <span class="koboSpan" id="kobo.1637.1">
          Create policy
         </span>
        </strong>
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.1638.1">
         .
        </span>
       </span>
      </li>
      <li class="Alphabets">
       <span class="koboSpan" id="kobo.1639.1">
        Go to the
       </span>
       <span class="No-Break">
        <strong class="bold">
         <span class="koboSpan" id="kobo.1640.1">
          JSON
         </span>
        </strong>
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.1641.1">
         tab.
        </span>
       </span>
      </li>
      <li class="Alphabets">
       <span class="koboSpan" id="kobo.1642.1">
        Enter the following policy.
       </span>
       <span class="koboSpan" id="kobo.1642.2">
        Make
       </span>
       <a id="_idIndexMarker491">
       </a>
       <span class="koboSpan" id="kobo.1643.1">
        sure you update the
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.1644.1">
         Sid
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1645.1">
        value and the
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.1646.1">
         Resource
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1647.1">
        parameters to reflect your
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.1648.1">
         resource details:
        </span>
       </span>
      </li>
     </ol>
     <pre class="source-code"><span class="koboSpan" id="kobo.1649.1">
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Sid": "DelegateCMKAccessFrom201882936474",
            "Effect": "Allow",
            "Action": [
                "kms:Encrypt",
                "kms:Decrypt",
                "kms:ReEncrypt*",
                "kms:GenerateDataKey*",
                "kms:DescribeKey"
            ],
            "Resource": "arn:aws:kms:us-east-1:201882936474:key/24ce962aee5e-411e-9cb6-ebbee39e253c"
        }
    ]
}</span></pre>
     <ol>
      <li class="Alphabets" value="6">
       <span class="No-Break">
        <span class="koboSpan" id="kobo.1650.1">
         Click
        </span>
       </span>
       <span class="No-Break">
        <strong class="bold">
         <span class="koboSpan" id="kobo.1651.1">
          Next
         </span>
        </strong>
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.1652.1">
         .
        </span>
       </span>
      </li>
      <li class="Alphabets">
       <span class="koboSpan" id="kobo.1653.1">
        In the
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.1654.1">
         Review and create
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1655.1">
        pane, for
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.1656.1">
         Policy details
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1657.1">
        , provide
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.1658.1">
         Name
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1659.1">
        and
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.1660.1">
         Description
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1661.1">
        detail for
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.1662.1">
         our policy.
        </span>
       </span>
      </li>
      <li class="Alphabets">
       <span class="koboSpan" id="kobo.1663.1">
        Click
       </span>
       <span class="No-Break">
        <strong class="bold">
         <span class="koboSpan" id="kobo.1664.1">
          Create policy
         </span>
        </strong>
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.1665.1">
         .
        </span>
       </span>
      </li>
      <li class="Alphabets">
       <span class="koboSpan" id="kobo.1666.1">
        If you’re using an IAM
       </span>
       <a id="_idIndexMarker492">
       </a>
       <span class="koboSpan" id="kobo.1667.1">
        user, assign this policy directly to that IAM user or a group that the user is part of.
       </span>
       <span class="koboSpan" id="kobo.1667.2">
        If you have an IAM Identity Center user, you can assign this policy using a custom permission set, as we saw in the
       </span>
       <em class="italic">
        <span class="koboSpan" id="kobo.1668.1">
         Creating customer-managed policies in IAM Identity Center
        </span>
       </em>
       <span class="koboSpan" id="kobo.1669.1">
        recipe of
       </span>
       <span class="No-Break">
        <em class="italic">
         <span class="koboSpan" id="kobo.1670.1">
          Chapter 2
         </span>
        </em>
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.1671.1">
         .
        </span>
       </span>
      </li>
     </ol>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1672.1">
      Encrypt the data with the profile of a non-administrator user from account 2 from the CLI using the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1673.1">
       following command:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1674.1">aws kms encrypt --plaintext "$(echo -n 'hello heartin' | base64)" --key-id arn:aws:kms:us-east-1:201882936474:key/24ce962a-ee5e-411e-9cb6-ebbee39e253c --profile testprofilenopermission</span></strong></pre>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.1675.1">
       We should see the
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.1676.1">
        following response:
       </span>
      </span>
     </p>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer097">
     <span class="koboSpan" id="kobo.1677.1">
      <img alt="Figure 3.22 – Response after running the encrypt command for the non-admin user" src="image/B21384_03_22.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.1678.1">
     Figure 3.22 – Response after running the encrypt command for the non-admin user
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1679.1">
     In this recipe, we created a new KMS key.
    </span>
    <span class="koboSpan" id="kobo.1679.2">
     We can also edit an existing KMS key and add another
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1680.1">
      account’s details.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-123">
    <a id="_idTextAnchor124">
    </a>
    <span class="koboSpan" id="kobo.1681.1">
     How it works...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1682.1">
     In this recipe, we created a KMS key in account 1 with permissions for account 2.
    </span>
    <span class="koboSpan" id="kobo.1682.2">
     After that, we successfully encrypted data on the other account with an administrator user’s profile from CLI.
    </span>
    <span class="koboSpan" id="kobo.1682.3">
     To encrypt
    </span>
    <a id="_idIndexMarker493">
    </a>
    <span class="koboSpan" id="kobo.1683.1">
     using a non-administrator
    </span>
    <a id="_idIndexMarker494">
    </a>
    <span class="koboSpan" id="kobo.1684.1">
     user, the administrator user of account 2 needs to delegate permissions to the user or role that needs access.
    </span>
    <span class="koboSpan" id="kobo.1684.2">
     We did this through an
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1685.1">
      IAM policy.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1686.1">
     For more details on the policy document’s structure, refer to the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.1687.1">
      Using key policies with conditional
     </span>
    </em>
    <span class="No-Break">
     <em class="italic">
      <span class="koboSpan" id="kobo.1688.1">
       keys
      </span>
     </em>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1689.1">
      recipe.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-124">
    <a id="_idTextAnchor125">
    </a>
    <span class="koboSpan" id="kobo.1690.1">
     There’s more...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1691.1">
     In this recipe, we tried encrypting data from the AWS CLI.
    </span>
    <span class="koboSpan" id="kobo.1691.2">
     Even though delegating key permissions across accounts is supported for most integrated services, such as S3 and EC2, their support for selecting the key automatically from the console may not be supported.
    </span>
    <span class="koboSpan" id="kobo.1691.3">
     Check out each service’s documentation for more details.
    </span>
    <span class="koboSpan" id="kobo.1691.4">
     If there is a limitation from the Management Console, then we will need to do this through the API by specifying the ARN of
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1692.1">
      the key.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-125">
    <a id="_idTextAnchor126">
    </a>
    <span class="koboSpan" id="kobo.1693.1">
     See also
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1694.1">
     We’ve explored many features of AWS KMS within this chapter.
    </span>
    <span class="koboSpan" id="kobo.1694.2">
     There are many applications and integrations for KMS within the AWS cloud, such as S3 encryption, EBS encryption, and more.
    </span>
    <span class="koboSpan" id="kobo.1694.3">
     Including all of those applications and integrations would require a book dedicated to KMS.
    </span>
    <span class="koboSpan" id="kobo.1694.4">
     You may explore more applications
    </span>
    <a id="_idIndexMarker495">
    </a>
    <span class="koboSpan" id="kobo.1695.1">
     and integrations of KMS within the AWS cloud
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1696.1">
      at
     </span>
    </span>
    <a href="https://www.cloudericks.com/blog/applications-of-aws-kms-within-aws-cloud">
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1697.1">
       https://www.cloudericks.com/blog/applications-of-aws-kms-within-aws-cloud
      </span>
     </span>
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1698.1">
      .
     </span>
    </span>
   </p>
   <h1 id="_idParaDest-126">
    <a id="_idTextAnchor127">
    </a>
    <span class="koboSpan" id="kobo.1699.1">
     Creating, initializing, and activating a CloudHSM cluster
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.1700.1">
     In this recipe, we will create
    </span>
    <a id="_idIndexMarker496">
    </a>
    <span class="koboSpan" id="kobo.1701.1">
     an AWS CloudHSM cluster.
    </span>
    <span class="koboSpan" id="kobo.1701.2">
     CloudHSM is a dedicated
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1702.1">
      hardware security module
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1703.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1704.1">
      HSM
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1705.1">
     ) on the AWS cloud that we can use to generate and use encryption keys.
    </span>
    <span class="koboSpan" id="kobo.1705.2">
     AWS KMS, on the other hand, uses shared HSM.
    </span>
    <span class="koboSpan" id="kobo.1705.3">
     CloudHSM
    </span>
    <a id="_idIndexMarker497">
    </a>
    <span class="koboSpan" id="kobo.1706.1">
     is ideal for scenarios demanding
    </span>
    <a id="_idIndexMarker498">
    </a>
    <span class="koboSpan" id="kobo.1707.1">
     the highest
    </span>
    <a id="_idIndexMarker499">
    </a>
    <span class="koboSpan" id="kobo.1708.1">
     level of isolation
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1709.1">
      and control.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-127">
    <a id="_idTextAnchor128">
    </a>
    <span class="koboSpan" id="kobo.1710.1">
     Getting ready
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1711.1">
     We’ll need the following to complete
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1712.1">
      this recipe:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.1713.1">
      A working AWS account,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1714.1">
       awsseccb-sandbox-1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1715.1">
      , and a user,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1716.1">
       awsseccbadmin1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1717.1">
      , as described in the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.1718.1">
       Technical
      </span>
     </em>
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.1719.1">
        requirements
       </span>
      </em>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1720.1">
       section.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1721.1">
      Knowledge of VPCs and EC2.
     </span>
     <span class="koboSpan" id="kobo.1721.2">
      If you are new to EC2 or want to refresh the concepts, you may first practice the recipes in
     </span>
     <a href="B21384_05.xhtml#_idTextAnchor169">
      <span class="No-Break">
       <em class="italic">
        <span class="koboSpan" id="kobo.1722.1">
         Chapter 5
        </span>
       </em>
      </span>
     </a>
     <span class="koboSpan" id="kobo.1723.1">
      , and then come back to
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1724.1">
       this recipe.
      </span>
     </span>
    </li>
   </ul>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.1725.1">
     Important note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.1726.1">
     AWS CloudHSM typically incurs higher costs compared to AWS KMS, and it does not offer a free tier option.
    </span>
    <span class="koboSpan" id="kobo.1726.2">
     For those utilizing CloudHSM for educational or learning purposes, it is crucial to promptly delete the resources you’ve created once you’ve completed the relevant recipes.
    </span>
    <span class="koboSpan" id="kobo.1726.3">
     This proactive step helps prevent any
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1727.1">
      unexpected charges.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-128">
    <a id="_idTextAnchor129">
    </a>
    <span class="koboSpan" id="kobo.1728.1">
     How to do it...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1729.1">
     First, we need to create a cluster, initialize it, and then activate it from an EC2 instance within the same VPC as
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1730.1">
      the cluster.
     </span>
    </span>
   </p>
   <h3>
    <span class="koboSpan" id="kobo.1731.1">
     Creating a CloudHSM cluster
    </span>
   </h3>
   <p>
    <span class="koboSpan" id="kobo.1732.1">
     In this section, we will
    </span>
    <a id="_idIndexMarker500">
    </a>
    <span class="koboSpan" id="kobo.1733.1">
     create a CloudHSM cluster using the default VPCs,
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1734.1">
      as follows:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.1735.1">
      Go to the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1736.1">
       CloudHSM
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1737.1">
      service in the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1738.1">
       Management Console.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1739.1">
      Click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1740.1">
       Create cluster
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1741.1">
      .
     </span>
     <span class="koboSpan" id="kobo.1741.2">
      If we can’t see the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1742.1">
       Create cluster
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1743.1">
      option, we can click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1744.1">
       Clusters
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1745.1">
      from the left sidebar and then click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1746.1">
       Create cluster
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1747.1">
      in the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1748.1">
       right pane.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1749.1">
      For
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1750.1">
       VPC
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1751.1">
      , select the VPC that we want to use or select the default VPC.
     </span>
     <span class="koboSpan" id="kobo.1751.2">
      This cannot be
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1752.1">
       changed later.
      </span>
     </span>
    </li>
   </ol>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.1753.1">
     Tip
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.1754.1">
     You may also create a custom VPC with private and public subnets and use them instead of the default VPCs that we’re using in this chapter, especially if you’re configuring CloudHSM for production.
    </span>
    <span class="koboSpan" id="kobo.1754.2">
     We will be covering VPCs in depth in
    </span>
    <a href="B21384_05.xhtml#_idTextAnchor169">
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.1755.1">
        Chapter 5
       </span>
      </em>
     </span>
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1756.1">
      .
     </span>
    </span>
   </p>
   <ol>
    <li value="4">
     <span class="koboSpan" id="kobo.1757.1">
      Select subnets in at least two Availability Zones based on AWS’s recommendations.
     </span>
     <span class="koboSpan" id="kobo.1757.2">
      I have chosen three for this recipe in
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1758.1">
       us-east-1a
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1759.1">
      ,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1760.1">
       us-east-1b
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1761.1">
      ,
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1762.1">
       and
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1763.1">
        us-east-1c
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1764.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1765.1">
      Scroll down and, under
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1766.1">
       Cluster source
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1767.1">
      , select the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1768.1">
       Create a new cluster
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1769.1">
      option.
     </span>
     <span class="koboSpan" id="kobo.1769.2">
      Click
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1770.1">
       Next
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1771.1">
      to proceed to the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1772.1">
       Back-up retention
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1773.1">
      step.
     </span>
     <span class="koboSpan" id="kobo.1773.2">
      We also have a
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1774.1">
       Restore cluster from existing
      </span>
     </strong>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1775.1">
        backup
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1776.1">
       option.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1777.1">
      In the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1778.1">
       Back-up retention
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1779.1">
      step, under the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1780.1">
       Backup retention
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1781.1">
      screen, for
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1782.1">
       Backup retention period (in days)
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1783.1">
      , based on your requirements, enter a period between 7 to 379 days.
     </span>
     <span class="koboSpan" id="kobo.1783.2">
      I have entered
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1784.1">
       7
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1785.1">
      .
     </span>
     <span class="koboSpan" id="kobo.1785.2">
      Click
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1786.1">
       Next
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1787.1">
      to proceed to the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1788.1">
       Add
      </span>
     </strong>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1789.1">
        tags
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1790.1">
       step.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1791.1">
      In the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1792.1">
       Add tags
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1793.1">
      step, optionally add tags to categorize our clusters.
     </span>
     <span class="koboSpan" id="kobo.1793.2">
      Then, click
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1794.1">
       Next
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1795.1">
      to proceed to the
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1796.1">
        Review
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1797.1">
       step.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1798.1">
      Review the details on the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1799.1">
       Review
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1800.1">
      screen, including
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1801.1">
       VPC
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1802.1">
      ,
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1803.1">
       Availability Zone(s)
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1804.1">
      ,
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1805.1">
       Days to expire under Back-up retention policy
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1806.1">
      , and
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1807.1">
       Tags
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1808.1">
      .
     </span>
     <span class="koboSpan" id="kobo.1808.2">
      We’ll also see a warning stating that we cannot change VPC or subnets after
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1809.1">
       cluster creation.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1810.1">
      After the review, click
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1811.1">
       Create cluster
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1812.1">
      .
     </span>
     <span class="koboSpan" id="kobo.1812.2">
      We should immediately see a message stating that the cluster is being created and that its state is
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1813.1">
       Creation in progress
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1814.1">
      .
     </span>
     <span class="koboSpan" id="kobo.1814.2">
      It may take a few minutes for cluster creation to complete.
     </span>
     <span class="koboSpan" id="kobo.1814.3">
      If the cluster creation operation is successful, we should see a screen with a success message and the state will
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1815.1">
       be
      </span>
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1816.1">
        Uninitialised
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1817.1">
       .
      </span>
     </span>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.1818.1">
     In this section, we created
    </span>
    <a id="_idIndexMarker501">
    </a>
    <span class="koboSpan" id="kobo.1819.1">
     a CloudHSM cluster.
    </span>
    <span class="koboSpan" id="kobo.1819.2">
     Next, we need to initialize and activate
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1820.1">
      the cluster.
     </span>
    </span>
   </p>
   <h3>
    <span class="koboSpan" id="kobo.1821.1">
     Initializing the cluster and creating our first HSM
    </span>
   </h3>
   <p>
    <span class="koboSpan" id="kobo.1822.1">
     We can initialize our cluster
    </span>
    <a id="_idIndexMarker502">
    </a>
    <span class="koboSpan" id="kobo.1823.1">
     and create our first HSM by following
    </span>
    <a id="_idIndexMarker503">
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1824.1">
      these steps:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.1825.1">
      Select our cluster and click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1826.1">
       Initialize
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1827.1">
      from the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1828.1">
       Actions
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1829.1">
      dropdown.
     </span>
     <span class="koboSpan" id="kobo.1829.2">
      Assuming we haven’t created any HSM yet, this will take us to the creation wizard for our
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1830.1">
       first HSM.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1831.1">
      In the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1832.1">
       Create HSM in the cluster
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1833.1">
      step, select one of the Availability Zones we selected while creating the cluster and
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1834.1">
       click
      </span>
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1835.1">
        Create
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1836.1">
       .
      </span>
     </span>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.1837.1">
       HSM creation can take some time.
      </span>
      <span class="koboSpan" id="kobo.1837.2">
       Once this process is successful, we should be taken to the
      </span>
      <strong class="bold">
       <span class="koboSpan" id="kobo.1838.1">
        Download certificate signing request
       </span>
      </strong>
      <span class="koboSpan" id="kobo.1839.1">
       step and see a success message, similar to the one shown in the
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.1840.1">
        following figure:
       </span>
      </span>
     </p>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer098">
     <span class="koboSpan" id="kobo.1841.1">
      <img alt="Figure 3.23 – Download certificate signing request" src="image/B21384_03_23.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.1842.1">
     Figure 3.23 – Download certificate signing request
    </span>
   </p>
   <ol>
    <li value="3">
     <span class="koboSpan" id="kobo.1843.1">
      Click the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1844.1">
       Cluster CSR
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1845.1">
      button
     </span>
     <a id="_idIndexMarker504">
     </a>
     <span class="koboSpan" id="kobo.1846.1">
      to download the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1847.1">
       certificate signing request
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1848.1">
      (
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1849.1">
       CSR
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1850.1">
      ).
     </span>
     <span class="koboSpan" id="kobo.1850.2">
      Optionally, as shown in
     </span>
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.1851.1">
        Figure 3
       </span>
      </em>
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.1852.1">
       .23
      </span>
     </em>
     <span class="koboSpan" id="kobo.1853.1">
      , we can verify the identity
     </span>
     <a id="_idIndexMarker505">
     </a>
     <span class="koboSpan" id="kobo.1854.1">
      and authenticity
     </span>
     <a id="_idIndexMarker506">
     </a>
     <span class="koboSpan" id="kobo.1855.1">
      of the cluster’s HSM by following the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.1856.1">
       There’s more...
      </span>
     </em>
     <span class="koboSpan" id="kobo.1857.1">
      section and the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.1858.1">
       See also
      </span>
     </em>
     <span class="koboSpan" id="kobo.1859.1">
      section of
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1860.1">
       this recipe.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1861.1">
      Click
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1862.1">
       Next
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1863.1">
      to proceed to the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1864.1">
       Upload
      </span>
     </strong>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1865.1">
        certificates
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1866.1">
       step.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1867.1">
      Generate a private key by running the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1868.1">
       openssl
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1869.1">
      command on your local machine,
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1870.1">
       like so:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1871.1">openssl genrsa -aes256 -out customerCA.key 2048</span></strong></pre>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.1872.1">
       When prompted, enter and re-enter a passphrase in 4 to
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.1873.1">
        1,023 characters.
       </span>
      </span>
     </p>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1874.1">
      As this is for testing and development purposes, we can create a self-signed certificate using our private key by running the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1875.1">
       following command:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1876.1">openssl req -new -x509 -days 3652 -key customerCA.key -out customerCA.crt</span></strong></pre>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.1877.1">
       Answer the prompt questions while providing values similar to the ones shown in the
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.1878.1">
        following screenshot:
       </span>
      </span>
     </p>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer099">
     <span class="koboSpan" id="kobo.1879.1">
      <img alt="Figure 3.24 – Generating a self-signed certificate" src="image/B21384_03_24.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.1880.1">
     Figure 3.24 – Generating a self-signed certificate
    </span>
   </p>
   <ol>
    <li value="7">
     <span class="koboSpan" id="kobo.1881.1">
      Sign the cluster CSR using
     </span>
     <a id="_idIndexMarker507">
     </a>
     <span class="koboSpan" id="kobo.1882.1">
      the OpenSSL command syntax that’s available
     </span>
     <a id="_idIndexMarker508">
     </a>
     <span class="koboSpan" id="kobo.1883.1">
      from the AWS documentation.
     </span>
     <span class="koboSpan" id="kobo.1883.2">
      Remember to mention the exact name of the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1884.1">
       csr
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1885.1">
      file you downloaded from the AWS Management Console and run it from the same folder where it
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1886.1">
       is present:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1887.1">openssl x509 -req -days 3652 -in cluster-2i67czpb6yy_ClusterCsr.csr -CA customerCA.crt -CAkey customerCA.key -CAcreateserial -out cluster-2i67czpb6yy_ClusterCsr.crt</span></strong></pre>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.1888.1">
       This should create a file
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.1889.1">
        named
       </span>
      </span>
      <span class="No-Break">
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.1890.1">
         cluster-2i67czpb6yy_ClusterCsr.crt
        </span>
       </strong>
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.1891.1">
        .
       </span>
      </span>
     </p>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1892.1">
      Go back to the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1893.1">
       Upload certificates
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1894.1">
      screen from
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.1895.1">
       Step 5
      </span>
     </em>
     <span class="koboSpan" id="kobo.1896.1">
      of this section and upload the signed cluster
     </span>
     <a id="_idIndexMarker509">
     </a>
     <span class="koboSpan" id="kobo.1897.1">
      certificate and signing
     </span>
     <a id="_idIndexMarker510">
     </a>
     <span class="koboSpan" id="kobo.1898.1">
      certificate (
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1899.1">
       issuing certificate):
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer100">
     <span class="koboSpan" id="kobo.1900.1">
      <img alt="Figure 3.25 – Upload certificates" src="image/B21384_03_25.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.1901.1">
     Figure 3.25 – Upload certificates
    </span>
   </p>
   <ol>
    <li value="9">
     <span class="koboSpan" id="kobo.1902.1">
      Click
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1903.1">
       Upload and initialise
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1904.1">
      .
     </span>
     <span class="koboSpan" id="kobo.1904.2">
      We should immediately see a message that cluster initialization is now in progress.
     </span>
     <span class="koboSpan" id="kobo.1904.3">
      Once the initialization is done, we should get a message stating that we must set the cluster password before we can use the cluster.
     </span>
     <span class="koboSpan" id="kobo.1904.4">
      We need to do this from an EC2 instance that’s been launched in the same VPC as our
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1905.1">
       CloudHSM cluster.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1906.1">
      Click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1907.1">
       Clusters
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1908.1">
      on the left sidebar and verify that our cluster’s
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1909.1">
       State
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1910.1">
      is set
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1911.1">
       to
      </span>
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1912.1">
        Initialised
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1913.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1914.1">
      We also need to go inside our cluster and copy the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1915.1">
       ENI IP address
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1916.1">
      value of
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1917.1">
       our HSM.
      </span>
     </span>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.1918.1">
     In this section, we initialized
    </span>
    <a id="_idIndexMarker511">
    </a>
    <span class="koboSpan" id="kobo.1919.1">
     the cluster and created our first
    </span>
    <a id="_idIndexMarker512">
    </a>
    <span class="koboSpan" id="kobo.1920.1">
     HSM.
    </span>
    <span class="koboSpan" id="kobo.1920.2">
     In the next section, we will launch an EC2 client instance into the same VPC as our cluster and activate
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1921.1">
      the cluster.
     </span>
    </span>
   </p>
   <h3>
    <span class="koboSpan" id="kobo.1922.1">
     Activating the cluster
    </span>
   </h3>
   <p>
    <span class="koboSpan" id="kobo.1923.1">
     In this section, we will launch
    </span>
    <a id="_idIndexMarker513">
    </a>
    <span class="koboSpan" id="kobo.1924.1">
     an EC2 client instance for our HSM from the AWS Management Console and activate the cluster.
    </span>
    <span class="koboSpan" id="kobo.1924.2">
     Follow
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1925.1">
      these steps:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.1926.1">
      First, we need to launch an EC2 client instance and set up the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1927.1">
       following options:
      </span>
     </span>
     <ol>
      <li class="Alphabets">
       <span class="koboSpan" id="kobo.1928.1">
        Select
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.1929.1">
         Amazon Linux 2023
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1930.1">
        under
       </span>
       <span class="No-Break">
        <strong class="bold">
         <span class="koboSpan" id="kobo.1931.1">
          Operating system
         </span>
        </strong>
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.1932.1">
         .
        </span>
       </span>
      </li>
      <li class="Alphabets">
       <span class="koboSpan" id="kobo.1933.1">
        Select
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.1934.1">
         t2.micro
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1935.1">
        under
       </span>
       <span class="No-Break">
        <strong class="bold">
         <span class="koboSpan" id="kobo.1936.1">
          Instance type
         </span>
        </strong>
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.1937.1">
         .
        </span>
       </span>
      </li>
      <li class="Alphabets">
       <span class="koboSpan" id="kobo.1938.1">
        Use the
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.1939.1">
         Create new key pair
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1940.1">
        link to create a new key pair and save the private key securely.
       </span>
       <span class="koboSpan" id="kobo.1940.2">
        I have named
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.1941.1">
         it
        </span>
       </span>
       <span class="No-Break">
        <strong class="source-inline">
         <span class="koboSpan" id="kobo.1942.1">
          ec2forhsm.pem
         </span>
        </strong>
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.1943.1">
         .
        </span>
       </span>
      </li>
      <li class="Alphabets">
       <span class="koboSpan" id="kobo.1944.1">
        Under
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.1945.1">
         Network settings
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1946.1">
        , select the same VPC as our cluster, which is the default VPC in my case.
       </span>
       <span class="koboSpan" id="kobo.1946.2">
        The
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.1947.1">
         Auto-assign public IP
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1948.1">
        option should be set to
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.1949.1">
         Enable
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1950.1">
        .
       </span>
       <span class="koboSpan" id="kobo.1950.2">
        In the
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.1951.1">
         Firewall (security groups)
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1952.1">
        subsection, select
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.1953.1">
         Select an existing security group
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1954.1">
        , and for
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.1955.1">
         Common security groups
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1956.1">
        , choose the default security group and the security group of
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.1957.1">
         our HSM.
        </span>
       </span>
      </li>
      <li class="Alphabets">
       <span class="koboSpan" id="kobo.1958.1">
        Edit the security group to add an inbound rule for SSH (port range 22) for the IP of the system we are connecting from by selecting the
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.1959.1">
         My
        </span>
       </strong>
       <span class="No-Break">
        <strong class="bold">
         <span class="koboSpan" id="kobo.1960.1">
          IP
         </span>
        </strong>
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.1961.1">
         option.
        </span>
       </span>
      </li>
     </ol>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1962.1">
      Copy the self-signed certificate,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1963.1">
       customerCA.crt
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1964.1">
      , into the EC2 machine.
     </span>
     <span class="koboSpan" id="kobo.1964.2">
      On Mac or Linux, we can use the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1965.1">
       scp
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1966.1">
      command to do this, as follows.
     </span>
     <span class="koboSpan" id="kobo.1966.2">
      Remember to use your EC2
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1967.1">
       Public IPv4 DNS
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1968.1">
      value instead of mine, which
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1969.1">
       is
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1970.1">
        ec2-user@ec2-54-172-128-95.compute-1.amazonaws.com
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1971.1">
       :
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1972.1">scp -i ec2forhsm.pem customerCA.crt ec2-user@ec2-54-172-128-95.compute-1.amazonaws.com:/home/ec2-user</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1973.1">
      SSH into the EC2 instance.
     </span>
     <span class="koboSpan" id="kobo.1973.2">
      The exact command or steps may differ between operating systems.
     </span>
     <span class="koboSpan" id="kobo.1973.3">
      On Mac or Linux, we can use the following command.
     </span>
     <span class="koboSpan" id="kobo.1973.4">
      If you face any issues with the permission key permissions, you can run the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1974.1">
       chmod 400 ec2forhsm.pem
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1975.1">
      command to
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1976.1">
       resolve this:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1977.1">ssh -i "ec2forhsm.pem" ec2-user@ec2-54-172-128-95.compute-1.</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1978.1">amazonaws.com</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1979.1">
      Update the operating system by running the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1980.1">
       sudo yum
      </span>
     </strong>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1981.1">
        update
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1982.1">
       command.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1983.1">
      Run the following command to get the latest CloudHSM
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1984.1">
       client RPM:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1985.1">wget https://s3.amazonaws.com/cloudhsmv2-software/CloudHsmClient/Amzn2023/cloudhsm-cli-latest.amzn2023.x86_64.rpm</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1986.1">
      Run the following command
     </span>
     <a id="_idIndexMarker514">
     </a>
     <span class="koboSpan" id="kobo.1987.1">
      to install the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1988.1">
       CloudHSM client:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1989.1">sudo yum install ./cloudhsm-cli-latest.amzn2023.x86_64.rpm</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1990.1">
      Add the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1991.1">
       ENI IP address
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1992.1">
      value of our HSM to the configuration.
     </span>
     <span class="koboSpan" id="kobo.1992.2">
      We took note of it in
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.1993.1">
       Step 12
      </span>
     </em>
     <span class="koboSpan" id="kobo.1994.1">
      of the previous section,
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.1995.1">
       Initializing the cluster and creating our first HSM
      </span>
     </em>
     <span class="koboSpan" id="kobo.1996.1">
      .
     </span>
     <span class="koboSpan" id="kobo.1996.2">
      Remember to replace my IP with
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1997.1">
       your IP:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1998.1">sudo /opt/cloudhsm/bin/configure -a 172.31.33.71</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1999.1">
      Copy the self-signed certificate,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.2000.1">
       customerCA.crt
      </span>
     </strong>
     <span class="koboSpan" id="kobo.2001.1">
      ,
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.2002.1">
       into
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.2003.1">
        /opt/cloudhsm/etc/
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.2004.1">
       :
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.2005.1">sudo cp /home/ec2-user/customerCA.crt /opt/cloudhsm/etc/</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.2006.1">
      Run the CloudHSM CLI in
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.2007.1">
       interactive mode:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.2008.1">/opt/cloudhsm/bin/cloudhsm-cli interactive</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.2009.1">
      Use the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.2010.1">
       cluster activate
      </span>
     </strong>
     <span class="koboSpan" id="kobo.2011.1">
      command to set the initial
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.2012.1">
       admin password:
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer101">
     <span class="koboSpan" id="kobo.2013.1">
      <img alt="Figure 3.26 – Activate CloudHSM cluster" src="image/B21384_03_26.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.2014.1">
     Figure 3.26 – Activate CloudHSM cluster
    </span>
   </p>
   <ol>
    <li value="11">
     <span class="koboSpan" id="kobo.2015.1">
      Use the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.2016.1">
       user list
      </span>
     </strong>
     <span class="koboSpan" id="kobo.2017.1">
      command to verify that the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.2018.1">
       user list:
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer102">
     <span class="koboSpan" id="kobo.2019.1">
      <img alt="Figure 3.27 – List Users in cluster" src="image/B21384_03_27.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.2020.1">
     Figure 3.27 – List Users in cluster
    </span>
   </p>
   <ol>
    <li value="12">
     <span class="koboSpan" id="kobo.2021.1">
      We can quit the utility using the
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.2022.1">
        quit
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.2023.1">
       command.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.2024.1">
      Go back to our cluster within the console and verify that we can’t see a display message stating that the cluster can’t be used until the password
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.2025.1">
       is updated.
      </span>
     </span>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.2026.1">
     In this section, we activated our HSML
    </span>
    <a id="_idIndexMarker515">
    </a>
    <span class="koboSpan" id="kobo.2027.1">
     cluster.
    </span>
    <span class="koboSpan" id="kobo.2027.2">
     HSM clusters don’t fall under the free tier.
    </span>
    <span class="koboSpan" id="kobo.2027.3">
     Therefore, if you created this cluster for development or testing purposes, remember to delete the HSM and the cluster to avoid incurring
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.2028.1">
      unexpected charges.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-129">
    <a id="_idTextAnchor130">
    </a>
    <span class="koboSpan" id="kobo.2029.1">
     How it works...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.2030.1">
     In this recipe, we created
    </span>
    <a id="_idIndexMarker516">
    </a>
    <span class="koboSpan" id="kobo.2031.1">
     a CloudHSM cluster, initialized it, and then
    </span>
    <a id="_idIndexMarker517">
    </a>
    <span class="koboSpan" id="kobo.2032.1">
     created our first HSM
    </span>
    <a id="_idIndexMarker518">
    </a>
    <span class="koboSpan" id="kobo.2033.1">
     within it.
    </span>
    <span class="koboSpan" id="kobo.2033.2">
     I used the default VPC for convenience.
    </span>
    <span class="koboSpan" id="kobo.2033.3">
     For practical use cases, you should install HSM into a private subnet within a custom VPC.
    </span>
    <span class="koboSpan" id="kobo.2033.4">
     We will look at VPCs in detail in
    </span>
    <a href="B21384_05.xhtml#_idTextAnchor169">
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.2034.1">
        Chapter 5
       </span>
      </em>
     </span>
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.2035.1">
      .
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.2036.1">
     Before initializing the cluster, we need to download a CSR and sign it.
    </span>
    <span class="koboSpan" id="kobo.2036.2">
     We used a self-signed certificate while following
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.2037.1">
      these steps:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.2038.1">
      Create a private key
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.2039.1">
       using OpenSSL.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.2040.1">
      Use the private key to create a self-signed signing certificate (
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.2041.1">
       issuing certificate).
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.2042.1">
      Use the self-signed signing certificate (issuing certificate) to sign the CSR we downloaded from the AWS
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.2043.1">
       Management Console.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.2044.1">
      Finally, upload both our signed CSR certificate and the self-signed issuing certificate
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.2045.1">
       to AWS.
      </span>
     </span>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.2046.1">
     For practical use cases, a certificate authority such as Verisign should sign it to create a signed certificate.
    </span>
    <span class="koboSpan" id="kobo.2046.2">
     For development and testing purposes, we can use a self-signed certificate to sign it using OpenSSL, as we saw in
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.2047.1">
      this recipe.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.2048.1">
     First, we logged in to the system as a user with the PRECO role, which is a temporary user role that exists on the first HSM in our cluster.
    </span>
    <span class="koboSpan" id="kobo.2048.2">
     After we changed the default password for this user, we observed that its type changed from PRECO to CO.
    </span>
    <span class="koboSpan" id="kobo.2048.3">
     A user of the AU type was
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.2049.1">
      also present.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.2050.1">
     With CloudHSM, we
    </span>
    <a id="_idIndexMarker519">
    </a>
    <span class="koboSpan" id="kobo.2051.1">
     have
    </span>
    <a id="_idIndexMarker520">
    </a>
    <span class="koboSpan" id="kobo.2052.1">
     four main
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.2053.1">
      user types:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.2054.1">
       Precrypto
      </span>
     </strong>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.2055.1">
        Officer
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.2056.1">
       (
      </span>
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.2057.1">
        PRECO
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.2058.1">
       )
      </span>
     </span>
    </li>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.2059.1">
       Crypto
      </span>
     </strong>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.2060.1">
        Officer
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.2061.1">
       (
      </span>
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.2062.1">
        CO
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.2063.1">
       )
      </span>
     </span>
    </li>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.2064.1">
       Crypto
      </span>
     </strong>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.2065.1">
        User
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.2066.1">
       (
      </span>
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.2067.1">
        CU
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.2068.1">
       )
      </span>
     </span>
    </li>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.2069.1">
       Appliance
      </span>
     </strong>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.2070.1">
        User
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.2071.1">
       (
      </span>
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.2072.1">
        AU
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.2073.1">
       )
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.2074.1">
     PRECO is a user
    </span>
    <a id="_idIndexMarker521">
    </a>
    <span class="koboSpan" id="kobo.2075.1">
     role that is created
    </span>
    <a id="_idIndexMarker522">
    </a>
    <span class="koboSpan" id="kobo.2076.1">
     by AWS that
    </span>
    <a id="_idIndexMarker523">
    </a>
    <span class="koboSpan" id="kobo.2077.1">
     we can use until we update
    </span>
    <a id="_idIndexMarker524">
    </a>
    <span class="koboSpan" id="kobo.2078.1">
     the password.
    </span>
    <span class="koboSpan" id="kobo.2078.2">
     Once
    </span>
    <a id="_idIndexMarker525">
    </a>
    <span class="koboSpan" id="kobo.2079.1">
     updated, the user’s type is changed
    </span>
    <a id="_idIndexMarker526">
    </a>
    <span class="koboSpan" id="kobo.2080.1">
     to CO.
    </span>
    <span class="koboSpan" id="kobo.2080.2">
     We can create more users with the CO role.
    </span>
    <span class="koboSpan" id="kobo.2080.3">
     The first CO
    </span>
    <a id="_idIndexMarker527">
    </a>
    <span class="koboSpan" id="kobo.2081.1">
     user is referred to as the primary PCO.
    </span>
    <span class="koboSpan" id="kobo.2081.2">
     A CO is responsible for managing users.
    </span>
    <span class="koboSpan" id="kobo.2081.3">
     A CU is responsible for managing keys, including creating, deleting, sharing, importing, and exporting them.
    </span>
    <span class="koboSpan" id="kobo.2081.4">
     A CU is also responsible for cryptographic operations such as encryption, decryption, signing, verifying, and more.
    </span>
    <span class="koboSpan" id="kobo.2081.5">
     Finally, an AU is a limited permission user that is generally used by AWS for cloning and
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.2082.1">
      synchronization activities.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-130">
    <a id="_idTextAnchor131">
    </a>
    <span class="koboSpan" id="kobo.2083.1">
     There’s more...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.2084.1">
     We can verify the HSM’s identity using the certificates that we can download from AWS.
    </span>
    <span class="koboSpan" id="kobo.2084.2">
     At the time of writing, six certificates can be downloaded from CloudHSM and verified: Cluster CSR, HSM certificate, AWS hardware certificate, Manufacturer hardware certificate, AWS root certificate, and Manufacturer
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.2085.1">
      root certificate.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-131">
    <a id="_idTextAnchor132">
    </a>
    <span class="koboSpan" id="kobo.2086.1">
     See also
    </span>
   </h2>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.2087.1">
      You can read more about
     </span>
     <a id="_idIndexMarker528">
     </a>
     <span class="koboSpan" id="kobo.2088.1">
      CloudHSM
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.2089.1">
       here:
      </span>
     </span>
     <a href="https://www.cloudericks.com/blog/getting-started-with-cloud-hsm">
      <span class="No-Break">
       <span class="koboSpan" id="kobo.2090.1">
        https://www.cloudericks.com/blog/getting-started-with-cloud-hsm
       </span>
      </span>
     </a>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.2091.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.2092.1">
      You can learn more about
     </span>
     <a id="_idIndexMarker529">
     </a>
     <span class="koboSpan" id="kobo.2093.1">
      the similarities and differences between CloudHSM and KMS
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.2094.1">
       here:
      </span>
     </span>
     <a href="https://www.cloudericks.com/blog/aws-cloudhsm-vs-aws-kms">
      <span class="No-Break">
       <span class="koboSpan" id="kobo.2095.1">
        https://www.cloudericks.com/blog/aws-cloudhsm-vs-aws-kms
       </span>
      </span>
     </a>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.2096.1">
       .
      </span>
     </span>
    </li>
   </ul>
  </div>
 </body></html>