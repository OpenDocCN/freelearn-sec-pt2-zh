<html><head></head><body>
  <div id="_idContainer164">
   <h1 class="chapter-number" id="_idParaDest-165">
    <a id="_idTextAnchor169">
    </a>
    <span class="koboSpan" id="kobo.1.1">
     5
    </span>
   </h1>
   <h1 id="_idParaDest-166">
    <a id="_idTextAnchor170">
    </a>
    <span class="koboSpan" id="kobo.2.1">
     Network and EC2 Security with VPCs
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.3.1">
     An Amazon
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.4.1">
      Virtual Private Cloud
     </span>
    </strong>
    <span class="koboSpan" id="kobo.5.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.6.1">
      VPC
     </span>
    </strong>
    <span class="koboSpan" id="kobo.7.1">
     ) is a
    </span>
    <a id="_idIndexMarker625">
    </a>
    <span class="koboSpan" id="kobo.8.1">
     foundational component within the AWS cloud that allows the creation of private networks within the AWS cloud, distinct and isolated from the broader AWS public cloud.
    </span>
    <span class="koboSpan" id="kobo.8.2">
     It enables us to launch AWS resources
    </span>
    <a id="_idIndexMarker626">
    </a>
    <span class="koboSpan" id="kobo.9.1">
     into a
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.10.1">
      Virtual Private Network
     </span>
    </strong>
    <span class="koboSpan" id="kobo.11.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.12.1">
      VPN
     </span>
    </strong>
    <span class="koboSpan" id="kobo.13.1">
     ) that we have defined within our AWS account.
    </span>
    <span class="koboSpan" id="kobo.13.2">
     This virtual network is similar to a traditional network we might run in our own data center but comes with the added advantage of AWS’s
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.14.1">
      scalable infrastructure.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.15.1">
     Users have complete control over their virtual network environment.
    </span>
    <span class="koboSpan" id="kobo.15.2">
     This means they can choose their IP address ranges, set up public and private subnets, and customize route tables and network gateways to suit their requirements.
    </span>
    <span class="koboSpan" id="kobo.15.3">
     This flexibility enables the deployment of internet-accessible instances, such as web servers, in public subnets, while positioning internal-use instances, such as database servers, in
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.16.1">
      private subnets.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.17.1">
     Additionally, Amazon VPC enhances security with a robust suite of features such as
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.18.1">
      security groups
     </span>
    </strong>
    <span class="koboSpan" id="kobo.19.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.20.1">
      Network Access Control Lists
     </span>
    </strong>
    <span class="koboSpan" id="kobo.21.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.22.1">
      NACLs
     </span>
    </strong>
    <span class="koboSpan" id="kobo.23.1">
     ),
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.24.1">
      flow logs
     </span>
    </strong>
    <span class="koboSpan" id="kobo.25.1">
     , VPN connections, integration with AWS
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.26.1">
      Identity and Access Management
     </span>
    </strong>
    <span class="koboSpan" id="kobo.27.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.28.1">
      IAM
     </span>
    </strong>
    <span class="koboSpan" id="kobo.29.1">
     ),
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.30.1">
      PrivateLink
     </span>
    </strong>
    <span class="koboSpan" id="kobo.31.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.32.1">
      endpoint services
     </span>
    </strong>
    <span class="koboSpan" id="kobo.33.1">
     , and
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.34.1">
      gateway endpoints
     </span>
    </strong>
    <span class="koboSpan" id="kobo.35.1">
     .
    </span>
    <span class="koboSpan" id="kobo.35.2">
     Together, these security features significantly fortify the security measures within a VPC, creating a secure, robust, and controlled network environment for the deployment and management of
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.36.1">
      AWS resources.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.37.1">
     This chapter includes the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.38.1">
      following recipes:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.39.1">
      Setting up VPC plus VPC resources with
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.40.1">
       minimal effort
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.41.1">
      Creating a bare VPC and setting up public and
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.42.1">
       private subnets
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.43.1">
      Launching an EC2 instance with a web server using
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.44.1">
       user data
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.45.1">
      Creating and configuring
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.46.1">
       security groups
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.47.1">
      Working
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.48.1">
       with NACLs
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.49.1">
      Using a VPC gateway endpoint to connect
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.50.1">
       to S3
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.51.1">
      Configuring and using VPC
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.52.1">
       flow logs
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.53.1">
      Setting up and configuring
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.54.1">
       NAT gateways
      </span>
     </span>
    </li>
   </ul>
   <h1 id="_idParaDest-167">
    <a id="_idTextAnchor171">
    </a>
    <span class="koboSpan" id="kobo.55.1">
     Technical requirements
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.56.1">
     Before diving into the recipes of this chapter, we need to ensure we have the following knowledge and requirements
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.57.1">
      in place:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.58.1">
      We need an active AWS account to complete the recipes within this chapter.
     </span>
     <span class="koboSpan" id="kobo.58.2">
      We can use an account that is part of an AWS Organization or a standalone account.
     </span>
     <span class="koboSpan" id="kobo.58.3">
      I will be using the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.59.1">
       awsseccb-sandbox-1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.60.1">
      account that we created in the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.61.1">
       Multi-account management with AWS Organizations
      </span>
     </em>
     <span class="koboSpan" id="kobo.62.1">
      recipe in
     </span>
     <a href="B21384_01.xhtml#_idTextAnchor020">
      <span class="No-Break">
       <em class="italic">
        <span class="koboSpan" id="kobo.63.1">
         Chapter 1
        </span>
       </em>
      </span>
     </a>
     <span class="koboSpan" id="kobo.64.1">
      .
     </span>
     <span class="koboSpan" id="kobo.64.2">
      However, I won’t be utilizing any AWS Organizations features, meaning you can follow these steps with a standalone
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.65.1">
       account too.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.66.1">
      For administrative actions, we need a user who has
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.67.1">
       AdministratorAccess
      </span>
     </strong>
     <span class="koboSpan" id="kobo.68.1">
      permission to the AWS account we are working with.
     </span>
     <span class="koboSpan" id="kobo.68.2">
      This can be an IAM Identity Center user or an IAM user.
     </span>
     <span class="koboSpan" id="kobo.68.3">
      I will be using the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.69.1">
       awsseccbadmin1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.70.1">
      IAM Identity Center user we created in the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.71.1">
       User management and SSO with IAM Identity Center
      </span>
     </em>
     <span class="koboSpan" id="kobo.72.1">
      recipe in
     </span>
     <a href="B21384_01.xhtml#_idTextAnchor020">
      <span class="No-Break">
       <em class="italic">
        <span class="koboSpan" id="kobo.73.1">
         Chapter 1
        </span>
       </em>
      </span>
     </a>
     <span class="koboSpan" id="kobo.74.1">
      .
     </span>
     <span class="koboSpan" id="kobo.74.2">
      However, I won’t be utilizing any IAM Identity Center features, meaning you can follow these steps with an IAM user, too, if the user has
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.75.1">
       AdministratorAccess
      </span>
     </strong>
     <span class="koboSpan" id="kobo.76.1">
      permission within the account.
     </span>
     <span class="koboSpan" id="kobo.76.2">
      You can create an IAM user by following the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.77.1">
       Setting up IAM, account aliases, and billing alerts
      </span>
     </em>
     <span class="koboSpan" id="kobo.78.1">
      recipe in
     </span>
     <a href="B21384_01.xhtml#_idTextAnchor020">
      <span class="No-Break">
       <em class="italic">
        <span class="koboSpan" id="kobo.79.1">
         Chapter 1
        </span>
       </em>
      </span>
     </a>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.80.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.81.1">
      It is beneficial to have a foundational understanding of essential computer networking concepts.
     </span>
     <span class="koboSpan" id="kobo.81.2">
      You can learn the computer networking concepts needed for this chapter
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.82.1">
       at
      </span>
     </span>
     <a href="https://www.secdops.com/blog/essential-computer-networking-concepts-for-the-cloud">
      <span class="No-Break">
       <span class="koboSpan" id="kobo.83.1">
        https://www.secdops.com/blog/essential-computer-networking-concepts-for-the-cloud
       </span>
      </span>
     </a>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.84.1">
       .
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.85.1">
     The code files for this book are available at
    </span>
    <a href="https://github.com/PacktPublishing/AWS-Security-Cookbook-Second-Edition">
     <span class="koboSpan" id="kobo.86.1">
      https://github.com/PacktPublishing/AWS-Security-Cookbook-Second-Edition
     </span>
    </a>
    <span class="koboSpan" id="kobo.87.1">
     .
    </span>
    <span class="koboSpan" id="kobo.87.2">
     The code files for this chapter are available
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.88.1">
      at
     </span>
    </span>
    <a href="https://github.com/PacktPublishing/AWS-Security-Cookbook-Second-Edition/tree/main/Chapter05">
     <span class="No-Break">
      <span class="koboSpan" id="kobo.89.1">
       https://github.com/PacktPublishing/AWS-Security-Cookbook-Second-Edition/tree/main/Chapter05
      </span>
     </span>
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.90.1">
      .
     </span>
    </span>
   </p>
   <h1 id="_idParaDest-168">
    <a id="_idTextAnchor172">
    </a>
    <span class="koboSpan" id="kobo.91.1">
     Setting up VPC plus VPC resources with minimal effort
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.92.1">
     In this recipe, we will
    </span>
    <a id="_idIndexMarker627">
    </a>
    <span class="koboSpan" id="kobo.93.1">
     create a VPC along with network resources such as
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.94.1">
      public subnets
     </span>
    </strong>
    <span class="koboSpan" id="kobo.95.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.96.1">
      private subnets
     </span>
    </strong>
    <span class="koboSpan" id="kobo.97.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.98.1">
      route tables
     </span>
    </strong>
    <span class="koboSpan" id="kobo.99.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.100.1">
      Internet Gateway
     </span>
    </strong>
    <span class="koboSpan" id="kobo.101.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.102.1">
      IGW
     </span>
    </strong>
    <span class="koboSpan" id="kobo.103.1">
     ),
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.104.1">
      Network Address Translation
     </span>
    </strong>
    <span class="koboSpan" id="kobo.105.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.106.1">
      NAT
     </span>
    </strong>
    <span class="koboSpan" id="kobo.107.1">
     )
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.108.1">
      gateway
     </span>
    </strong>
    <span class="koboSpan" id="kobo.109.1">
     , and
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.110.1">
      VPC Endpoints
     </span>
    </strong>
    <span class="koboSpan" id="kobo.111.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.112.1">
      S3 Gateway
     </span>
    </strong>
    <span class="koboSpan" id="kobo.113.1">
     ).
    </span>
    <span class="koboSpan" id="kobo.113.2">
     We
    </span>
    <a id="_idIndexMarker628">
    </a>
    <span class="koboSpan" id="kobo.114.1">
     can
    </span>
    <a id="_idIndexMarker629">
    </a>
    <span class="koboSpan" id="kobo.115.1">
     also
    </span>
    <a id="_idIndexMarker630">
    </a>
    <span class="koboSpan" id="kobo.116.1">
     create
    </span>
    <a id="_idIndexMarker631">
    </a>
    <span class="koboSpan" id="kobo.117.1">
     these components individually if needed, as we will see in
    </span>
    <a id="_idIndexMarker632">
    </a>
    <span class="koboSpan" id="kobo.118.1">
     subsequent recipes
    </span>
    <a id="_idIndexMarker633">
    </a>
    <span class="koboSpan" id="kobo.119.1">
     within this chapter.
    </span>
    <span class="koboSpan" id="kobo.119.2">
     To explore all possibilities, I will be selecting all network resource components available to select in this recipe.
    </span>
    <span class="koboSpan" id="kobo.119.3">
     Some of these components, such as the NAT gateway, have associated charges.
    </span>
    <span class="koboSpan" id="kobo.119.4">
     Select components and their quantity as per
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.120.1">
      your needs.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-169">
    <a id="_idTextAnchor173">
    </a>
    <span class="koboSpan" id="kobo.121.1">
     Getting ready
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.122.1">
     To follow this recipe, we need a working
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.123.1">
      awsseccb-sandbox-1
     </span>
    </strong>
    <span class="koboSpan" id="kobo.124.1">
     AWS account, and a
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.125.1">
      awsseccbadmin1
     </span>
    </strong>
    <span class="koboSpan" id="kobo.126.1">
     user, as described in the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.127.1">
      Technical
     </span>
    </em>
    <span class="No-Break">
     <em class="italic">
      <span class="koboSpan" id="kobo.128.1">
       requirements
      </span>
     </em>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.129.1">
      section.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-170">
    <a id="_idTextAnchor174">
    </a>
    <span class="koboSpan" id="kobo.130.1">
     How to do it...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.131.1">
     Please also note that the default options shown here may change over time, so check the preview to make sure you are only creating the resources that you need before creating the VPC.
    </span>
    <span class="koboSpan" id="kobo.131.2">
     Let us
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.132.1">
      get started:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.133.1">
      Log into the AWS Management Console and go to the
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.134.1">
        VPC
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.135.1">
       service.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.136.1">
      From the left sidebar, under the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.137.1">
       Virtual private cloud
      </span>
     </strong>
     <span class="koboSpan" id="kobo.138.1">
      heading, click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.139.1">
       Your VPCs
      </span>
     </strong>
     <span class="koboSpan" id="kobo.140.1">
      .
     </span>
     <span class="koboSpan" id="kobo.140.2">
      We will be taken to the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.141.1">
       Your VPCs
      </span>
     </strong>
     <span class="koboSpan" id="kobo.142.1">
      page, where we can see our VPCs.
     </span>
     <span class="koboSpan" id="kobo.142.2">
      If we are using VPCs for the first time, we will only see the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.143.1">
       default VPC.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.144.1">
      On the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.145.1">
       Your VPCs
      </span>
     </strong>
     <span class="koboSpan" id="kobo.146.1">
      page, click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.147.1">
       Create VPC
      </span>
     </strong>
     <span class="koboSpan" id="kobo.148.1">
      .
     </span>
     <span class="koboSpan" id="kobo.148.2">
      Within the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.149.1">
       Create VPC
      </span>
     </strong>
     <span class="koboSpan" id="kobo.150.1">
      screen, select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.151.1">
       VPC and more
      </span>
     </strong>
     <span class="koboSpan" id="kobo.152.1">
      , then select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.153.1">
       Auto-generate
      </span>
     </strong>
     <span class="koboSpan" id="kobo.154.1">
      .
     </span>
     <span class="koboSpan" id="kobo.154.2">
      After that, provide the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.155.1">
       awsseccb
      </span>
     </strong>
     <span class="koboSpan" id="kobo.156.1">
      project prefix, as shown in the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.157.1">
       following figure:
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer132">
     <span class="koboSpan" id="kobo.158.1">
      <img alt="Figure 5.1 – Creating a VPC with network resources" src="image/B21384_05_1.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.159.1">
     Figure 5.1 – Creating a VPC with network resources
    </span>
   </p>
   <ol>
    <li value="4">
     <span class="koboSpan" id="kobo.160.1">
      Provide
     </span>
     <a id="_idIndexMarker634">
     </a>
     <span class="koboSpan" id="kobo.161.1">
      the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.162.1">
       10.0.0.0/16
      </span>
     </strong>
     <span class="koboSpan" id="kobo.163.1">
      value under
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.164.1">
       IPv4
      </span>
     </strong>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.165.1">
        CIDR block
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.166.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.167.1">
      For
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.168.1">
       IPv6 CIDR block
      </span>
     </strong>
     <span class="koboSpan" id="kobo.169.1">
      , we have two options:
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.170.1">
       No IPv6 CIDR block
      </span>
     </strong>
     <span class="koboSpan" id="kobo.171.1">
      and
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.172.1">
       Amazon-provided IPv6 CIDR block
      </span>
     </strong>
     <span class="koboSpan" id="kobo.173.1">
      .
     </span>
     <span class="koboSpan" id="kobo.173.2">
      Select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.174.1">
       No IPv6
      </span>
     </strong>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.175.1">
        CIDR block
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.176.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.177.1">
      For
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.178.1">
       Tenancy
      </span>
     </strong>
     <span class="koboSpan" id="kobo.179.1">
      , there are two options:
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.180.1">
       Default
      </span>
     </strong>
     <span class="koboSpan" id="kobo.181.1">
      and
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.182.1">
       Dedicated
      </span>
     </strong>
     <span class="koboSpan" id="kobo.183.1">
      .
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.184.1">
       Select
      </span>
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.185.1">
        Default
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.186.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.187.1">
      For
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.188.1">
       Number of Availability Zones (AZs)
      </span>
     </strong>
     <span class="koboSpan" id="kobo.189.1">
      , select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.190.1">
       2
      </span>
     </strong>
     <span class="koboSpan" id="kobo.191.1">
      ; for
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.192.1">
       Number of public subnets
      </span>
     </strong>
     <span class="koboSpan" id="kobo.193.1">
      , select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.194.1">
       2
      </span>
     </strong>
     <span class="koboSpan" id="kobo.195.1">
      ; and for
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.196.1">
       Number of private subnets
      </span>
     </strong>
     <span class="koboSpan" id="kobo.197.1">
      , select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.198.1">
       2
      </span>
     </strong>
     <span class="koboSpan" id="kobo.199.1">
      , as shown in the following figure:
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer133">
     <span class="koboSpan" id="kobo.200.1">
      <img alt="Figure 5.2 – Configuring the number of AZs and subnets" src="image/B21384_05_2.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.201.1">
     Figure 5.2 – Configuring the number of AZs and subnets
    </span>
   </p>
   <p class="list-inset">
    <span class="koboSpan" id="kobo.202.1">
     Optionally, we
    </span>
    <a id="_idIndexMarker635">
    </a>
    <span class="koboSpan" id="kobo.203.1">
     can select AZs for our subnets after expanding
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.204.1">
      Customize AZs
     </span>
    </strong>
    <span class="koboSpan" id="kobo.205.1">
     and customize the CIDR blocks using the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.206.1">
      Customize subnets CIDR
     </span>
    </strong>
    <span class="No-Break">
     <strong class="bold">
      <span class="koboSpan" id="kobo.207.1">
       blocks
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.208.1">
      option.
     </span>
    </span>
   </p>
   <ol>
    <li value="8">
     <span class="koboSpan" id="kobo.209.1">
      For
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.210.1">
       NAT gateways ($)
      </span>
     </strong>
     <span class="koboSpan" id="kobo.211.1">
      , select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.212.1">
       1 in 1 AZ
      </span>
     </strong>
     <span class="koboSpan" id="kobo.213.1">
      ; for
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.214.1">
       VPC endpoints
      </span>
     </strong>
     <span class="koboSpan" id="kobo.215.1">
      , select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.216.1">
       S3 Gateway
      </span>
     </strong>
     <span class="koboSpan" id="kobo.217.1">
      ; and for
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.218.1">
       DNS options
      </span>
     </strong>
     <span class="koboSpan" id="kobo.219.1">
      , select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.220.1">
       Enable DNS hostnames
      </span>
     </strong>
     <span class="koboSpan" id="kobo.221.1">
      and
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.222.1">
       Enable
      </span>
     </strong>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.223.1">
        DNS resolution
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.224.1">
       .
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer134">
     <span class="koboSpan" id="kobo.225.1">
      <img alt="Figure 5.3 – Configuring NAT gateways, VPC endpoints and DNS options" src="image/B21384_05_3.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.226.1">
     Figure 5.3 – Configuring NAT gateways, VPC endpoints and DNS options
    </span>
   </p>
   <p class="list-inset">
    <span class="koboSpan" id="kobo.227.1">
     AWS will
    </span>
    <a id="_idIndexMarker636">
    </a>
    <span class="koboSpan" id="kobo.228.1">
     show us a preview of the VPC in the right pane of the page and network resources it will create
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.229.1">
      as follows:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.230.1">
      A VPC with the
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.231.1">
        awsseccb-vpc
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.232.1">
       name
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.233.1">
      Subnets named
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.234.1">
       awsseccb-subnet-public1-us-east-1a
      </span>
     </strong>
     <span class="koboSpan" id="kobo.235.1">
      ,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.236.1">
       awsseccb-subnet-private1-us-east-1a
      </span>
     </strong>
     <span class="koboSpan" id="kobo.237.1">
      ,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.238.1">
       us-east-1b, awsseccb-subnet-public2-us-east-1b
      </span>
     </strong>
     <span class="koboSpan" id="kobo.239.1">
      ,
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.240.1">
       and
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.241.1">
        awsseccb-subnet-private2-us-east-1b
       </span>
      </strong>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.242.1">
      Route tables named
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.243.1">
       awsseccb-rtb-public
      </span>
     </strong>
     <span class="koboSpan" id="kobo.244.1">
      ,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.245.1">
       awsseccb-rtb-private1-us-east-1a
      </span>
     </strong>
     <span class="koboSpan" id="kobo.246.1">
      ,
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.247.1">
       and
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.248.1">
        awsseccb-rtb-private2-us-east-1b
       </span>
      </strong>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.249.1">
      Network connections named
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.250.1">
       awsseccb-igw
      </span>
     </strong>
     <span class="koboSpan" id="kobo.251.1">
      ,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.252.1">
       awsseccb-nat-public1-us-east-1a
      </span>
     </strong>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.253.1">
       and
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.254.1">
        awsseccb-vpce-s3
       </span>
      </strong>
     </span>
    </li>
   </ul>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.255.1">
     Important note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.256.1">
     A single route table is shared among all public subnets while there is a route table per private subnet.
    </span>
    <span class="koboSpan" id="kobo.256.2">
     Even though this is not shown in the preview, a main route table is also created that dictates the default rules for subnets not associated with any route table.
    </span>
    <span class="koboSpan" id="kobo.256.3">
     The selection of public subnets necessitates the creation of an IGW, which is then linked to these public subnets, facilitating internet access.
    </span>
    <span class="koboSpan" id="kobo.256.4">
     Additionally, NAT gateways, which provide internet access to instances in private subnets while preventing direct inbound internet traffic, must be deployed within a public subnet and, thus, also rely on the existence of an IGW for outbound
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.257.1">
      internet traffic.
     </span>
    </span>
   </p>
   <ol>
    <li value="9">
     <span class="koboSpan" id="kobo.258.1">
      Click
     </span>
     <a id="_idIndexMarker637">
     </a>
     <span class="koboSpan" id="kobo.259.1">
      on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.260.1">
       Create VPC
      </span>
     </strong>
     <span class="koboSpan" id="kobo.261.1">
      to create the VPC with the network resources shown in
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.262.1">
       the preview.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.263.1">
      Verify that all the resources that were listed in the preview have
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.264.1">
       been created.
      </span>
     </span>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.265.1">
     In this recipe, we created a VPC along with VPC resources.
    </span>
    <span class="koboSpan" id="kobo.265.2">
     To create only a VPC without additional resources, we can select the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.266.1">
      VPC only
     </span>
    </strong>
    <span class="koboSpan" id="kobo.267.1">
     option instead of
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.268.1">
      VPC and more
     </span>
    </strong>
    <span class="koboSpan" id="kobo.269.1">
     as we saw in
    </span>
    <span class="No-Break">
     <em class="italic">
      <span class="koboSpan" id="kobo.270.1">
       Figure 5
      </span>
     </em>
    </span>
    <span class="No-Break">
     <em class="italic">
      <span class="koboSpan" id="kobo.271.1">
       .1
      </span>
     </em>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.272.1">
      .
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-171">
    <a id="_idTextAnchor175">
    </a>
    <span class="koboSpan" id="kobo.273.1">
     How it works...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.274.1">
     In this recipe, we successfully configured a VPC and its associated network resources.
    </span>
    <span class="koboSpan" id="kobo.274.2">
     Let us learn more about these components.
    </span>
    <span class="koboSpan" id="kobo.274.3">
     A VPC is a virtual network dedicated to our AWS account.
    </span>
    <span class="koboSpan" id="kobo.274.4">
     It is isolated from other virtual networks in the AWS Cloud.
    </span>
    <span class="koboSpan" id="kobo.274.5">
     It allows us to launch AWS resources, such as EC2 instances, into a network that we
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.275.1">
      have defined.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.276.1">
     The
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.277.1">
      IPv4 CIDR block
     </span>
    </strong>
    <span class="koboSpan" id="kobo.278.1">
     defines a range of private IPv4 addresses allocated to our VPC, facilitating internal communication within our VPC while keeping it isolated from external networks.
    </span>
    <span class="koboSpan" id="kobo.278.2">
     In this recipe, we
    </span>
    <a id="_idIndexMarker638">
    </a>
    <span class="koboSpan" id="kobo.279.1">
     chose a
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.280.1">
      10.0.0.0/16
     </span>
    </strong>
    <strong class="bold">
     <span class="koboSpan" id="kobo.281.1">
      Classless Inter-Domain Routing
     </span>
    </strong>
    <span class="koboSpan" id="kobo.282.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.283.1">
      CIDR
     </span>
    </strong>
    <span class="koboSpan" id="kobo.284.1">
     ) block for our VPC, representing the broadest range of addresses AWS permits for a VPC.
    </span>
    <span class="koboSpan" id="kobo.284.2">
     CIDR is a method for allocating IP addresses and routing IP packets.
    </span>
    <span class="koboSpan" id="kobo.284.3">
     It allows multiple IP addresses to be represented as a single expression, significantly simplifying network configuration and management.
    </span>
    <span class="koboSpan" id="kobo.284.4">
     CIDR is a slightly complex topic for beginners.
    </span>
    <span class="koboSpan" id="kobo.284.5">
     You can learn more about CIDR
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.285.1">
      at
     </span>
    </span>
    <a href="https://www.secdops.com/blog/understanding-ip-addresses-and-subnetting">
     <span class="No-Break">
      <span class="koboSpan" id="kobo.286.1">
       https://www.secdops.com/blog/understanding-ip-addresses-and-subnetting
      </span>
     </span>
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.287.1">
      .
     </span>
    </span>
   </p>
   <p>
    <strong class="bold">
     <span class="koboSpan" id="kobo.288.1">
      IPv6 CIDR Block
     </span>
    </strong>
    <span class="koboSpan" id="kobo.289.1">
     is an optional range of IPv6 addresses for our VPC.
    </span>
    <span class="koboSpan" id="kobo.289.2">
     Selecting
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.290.1">
      No IPv6 CIDR block
     </span>
    </strong>
    <span class="koboSpan" id="kobo.291.1">
     means our VPC will only use IPv4 addresses.
    </span>
    <span class="koboSpan" id="kobo.291.2">
     IPv6 addresses provide a much larger address space and are becoming increasingly important for future-proofing and
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.292.1">
      global reach.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.293.1">
     The
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.294.1">
      Tenancy
     </span>
    </strong>
    <span class="koboSpan" id="kobo.295.1">
     option
    </span>
    <a id="_idIndexMarker639">
    </a>
    <span class="koboSpan" id="kobo.296.1">
     lets us choose between a shared or dedicated hardware host for our VPC.
    </span>
    <span class="koboSpan" id="kobo.296.2">
     The
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.297.1">
      Default
     </span>
    </strong>
    <span class="koboSpan" id="kobo.298.1">
     option allows AWS to place our instances on any shared hardware, which is sufficient for most use cases.
    </span>
    <span class="koboSpan" id="kobo.298.2">
     The
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.299.1">
      Dedicated
     </span>
    </strong>
    <span class="koboSpan" id="kobo.300.1">
     option is typically used for compliance or
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.301.1">
      regulatory requirements.
     </span>
    </span>
   </p>
   <p>
    <strong class="bold">
     <span class="koboSpan" id="kobo.302.1">
      Availability Zones
     </span>
    </strong>
    <span class="koboSpan" id="kobo.303.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.304.1">
      AZs
     </span>
    </strong>
    <span class="koboSpan" id="kobo.305.1">
     ) are
    </span>
    <a id="_idIndexMarker640">
    </a>
    <span class="koboSpan" id="kobo.306.1">
     distinct locations within a region engineered to be isolated from failures in other AZs.
    </span>
    <span class="koboSpan" id="kobo.306.2">
     By selecting multiple AZs, we can achieve high availability.
    </span>
    <span class="koboSpan" id="kobo.306.3">
     Each subnet is tied to a specific AZ for fault tolerance and low latency.
    </span>
    <span class="koboSpan" id="kobo.306.4">
     In this recipe, we created
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.307.1">
      two AZs.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.308.1">
     A subnet is a logical subdivision of an IP network.
    </span>
    <span class="koboSpan" id="kobo.308.2">
     Within cloud environments such as AWS, subnets facilitate the organization of a VPC by segmenting the network and directing traffic flow between resources.
    </span>
    <span class="koboSpan" id="kobo.308.3">
     This segmentation allows for the creation of
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.309.1">
      public subnets
     </span>
    </strong>
    <span class="koboSpan" id="kobo.310.1">
     , which
    </span>
    <a id="_idIndexMarker641">
    </a>
    <span class="koboSpan" id="kobo.311.1">
     provide direct internet access for resources such as web servers, and
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.312.1">
      private subnets
     </span>
    </strong>
    <span class="koboSpan" id="kobo.313.1">
     .
    </span>
    <span class="koboSpan" id="kobo.313.2">
     These
    </span>
    <a id="_idIndexMarker642">
    </a>
    <span class="koboSpan" id="kobo.314.1">
     are designed for resources such as database servers that require restricted access, typically only from within the network or a specific subnet, such as a web
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.315.1">
      server subnet.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.316.1">
     With the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.317.1">
      VPC and more
     </span>
    </strong>
    <span class="koboSpan" id="kobo.318.1">
     option when creating a VPC, subnets are allocated equally across AZs.
    </span>
    <span class="koboSpan" id="kobo.318.2">
     Therefore, we can select subnets in multiples of the number of AZs we selected.
    </span>
    <span class="koboSpan" id="kobo.318.3">
     If we select
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.319.1">
      1 AZ
     </span>
    </strong>
    <span class="koboSpan" id="kobo.320.1">
     , we get the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.321.1">
      0
     </span>
    </strong>
    <span class="koboSpan" id="kobo.322.1">
     and
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.323.1">
      1
     </span>
    </strong>
    <span class="koboSpan" id="kobo.324.1">
     options for the public subnet and
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.325.1">
      0
     </span>
    </strong>
    <span class="koboSpan" id="kobo.326.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.327.1">
      1
     </span>
    </strong>
    <span class="koboSpan" id="kobo.328.1">
     , and
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.329.1">
      2
     </span>
    </strong>
    <span class="koboSpan" id="kobo.330.1">
     for the private subnet.
    </span>
    <span class="koboSpan" id="kobo.330.2">
     Similarly, if we select 3 AZs, we get the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.331.1">
      0
     </span>
    </strong>
    <span class="koboSpan" id="kobo.332.1">
     and
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.333.1">
      2
     </span>
    </strong>
    <span class="koboSpan" id="kobo.334.1">
     options for the public subnets and
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.335.1">
      0
     </span>
    </strong>
    <span class="koboSpan" id="kobo.336.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.337.1">
      3
     </span>
    </strong>
    <span class="koboSpan" id="kobo.338.1">
     , and
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.339.1">
      6
     </span>
    </strong>
    <span class="koboSpan" id="kobo.340.1">
     for the private subnets.
    </span>
    <span class="koboSpan" id="kobo.340.2">
     In this recipe, we created four subnets – two public subnets and two
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.341.1">
      private subnets.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.342.1">
     An IGW is a resource that allows communication between instances in our VPC and the internet.
    </span>
    <span class="koboSpan" id="kobo.342.2">
     It is necessary for any subnet that requires direct access to the internet.
    </span>
    <span class="koboSpan" id="kobo.342.3">
     As we opted to create a public subnet within our recipe, AWS created an IGW and associated our public subnets with the IGW.
    </span>
    <span class="koboSpan" id="kobo.342.4">
     For public subnets, we also need to route all internet-bound traffic to the IGW.
    </span>
    <span class="koboSpan" id="kobo.342.5">
     This is done using
    </span>
    <span class="No-Break">
     <strong class="bold">
      <span class="koboSpan" id="kobo.343.1">
       route tables
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.344.1">
      .
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.345.1">
     Route tables
    </span>
    <a id="_idIndexMarker643">
    </a>
    <span class="koboSpan" id="kobo.346.1">
     contain a set of rules, known
    </span>
    <a id="_idIndexMarker644">
    </a>
    <span class="koboSpan" id="kobo.347.1">
     as routes, that determine where network traffic from our subnets or the VPC router is directed.
    </span>
    <span class="koboSpan" id="kobo.347.2">
     The following are the routes created by AWS in the route table associated with our
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.348.1">
      public subnets:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer135">
     <span class="koboSpan" id="kobo.349.1">
      <img alt="Figure 5.4 – A route table with a route for an IGW" src="image/B21384_05_4.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.350.1">
     Figure 5.4 – A route table with a route for an IGW
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.351.1">
     When we select the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.352.1">
      VPC and more
     </span>
    </strong>
    <span class="koboSpan" id="kobo.353.1">
     option, a single route table is shared among all public subnets while each private subnet is associated with a distinct route table.
    </span>
    <span class="koboSpan" id="kobo.353.2">
     Apart from these, there is also
    </span>
    <a id="_idIndexMarker645">
    </a>
    <span class="koboSpan" id="kobo.354.1">
     a
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.355.1">
      main route table
     </span>
    </strong>
    <span class="koboSpan" id="kobo.356.1">
     created per VPC irrespective of whether we use the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.357.1">
      VPC only
     </span>
    </strong>
    <span class="koboSpan" id="kobo.358.1">
     or
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.359.1">
      VPC and more
     </span>
    </strong>
    <span class="koboSpan" id="kobo.360.1">
     options.
    </span>
    <span class="koboSpan" id="kobo.360.2">
     The main route table dictates the default rules for subnets not associated with any route table.
    </span>
    <span class="koboSpan" id="kobo.360.3">
     By default, no subnets are associated explicitly with the main
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.361.1">
      route table.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.362.1">
     All subnets not associated with any route table explicitly within a VPC are associated implicitly with the main route table.
    </span>
    <span class="koboSpan" id="kobo.362.2">
     This means that the main route table’s routing behavior applies to all subnets not associated with any other route tables.
    </span>
    <span class="koboSpan" id="kobo.362.3">
     In this recipe, all subnets are associated with a route table and hence there will not be any association for the main route table.
    </span>
    <span class="koboSpan" id="kobo.362.4">
     We can experiment by removing a subnet’s association with a route table and we can see that it will be implicitly associated with the default route table.
    </span>
    <span class="koboSpan" id="kobo.362.5">
     We can set a different route table as the main route table if we
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.363.1">
      want to.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.364.1">
     Consequently, with a configuration of two public subnets and two private subnets, there will be four route tables: one for the public subnets, one for each private subnets, and one main route table.
    </span>
    <span class="koboSpan" id="kobo.364.2">
     If the configuration includes two public subnets and four private subnets, the total rises to six route tables: one for the public subnets, one for each of the private subnets, and one main
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.365.1">
      route table.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.366.1">
     A NAT gateway
    </span>
    <a id="_idIndexMarker646">
    </a>
    <span class="koboSpan" id="kobo.367.1">
     allows instances in a
    </span>
    <a id="_idIndexMarker647">
    </a>
    <span class="koboSpan" id="kobo.368.1">
     private subnet to initiate outbound internet traffic but prevents unsolicited inbound traffic from the internet.
    </span>
    <span class="koboSpan" id="kobo.368.2">
     This is crucial for updating, patching, or downloading dependencies for instances that do not need to be directly accessible from the outside world.
    </span>
    <span class="koboSpan" id="kobo.368.3">
     NAT is a method that enables private subnet resources to access the internet or other network services without exposing their private IP addresses.
    </span>
    <span class="koboSpan" id="kobo.368.4">
     By translating these private IP addresses to a public one, NAT gateways facilitate secure internet access for services within a private subnet, ensuring that the internal structure of a private network remains shielded from external traffic and threats.
    </span>
    <span class="koboSpan" id="kobo.368.5">
     NAT gateways are deployed on a public subnet and therefore, if we opt not to create any public subnet with the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.369.1">
      VPC and more
     </span>
    </strong>
    <span class="koboSpan" id="kobo.370.1">
     option and try to select the NAT gateway option, then we will get an
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.371.1">
      error message.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.372.1">
     VPC endpoints
    </span>
    <a id="_idIndexMarker648">
    </a>
    <span class="koboSpan" id="kobo.373.1">
     enable private connections between our VPC and AWS services without requiring traffic to traverse the internet.
    </span>
    <span class="koboSpan" id="kobo.373.2">
     Selecting an
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.374.1">
      S3 Gateway
     </span>
    </strong>
    <span class="koboSpan" id="kobo.375.1">
     endpoint allows our instances to securely access S3 buckets without an IGW or NAT gateway, improving security and potentially reducing costs.
    </span>
    <span class="koboSpan" id="kobo.375.2">
     Finally, enabling DNS options such as
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.376.1">
      DNS hostnames
     </span>
    </strong>
    <span class="koboSpan" id="kobo.377.1">
     and
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.378.1">
      DNS resolution
     </span>
    </strong>
    <span class="koboSpan" id="kobo.379.1">
     within our VPC allows our AWS resources to communicate with each other using hostnames instead of IP addresses, simplifying network management
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.380.1">
      and configuration.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.381.1">
     Even though it was not shown in the preview while creating the VPC, a NACL was also created.
    </span>
    <span class="koboSpan" id="kobo.381.2">
     An NACL acts as a firewall for controlling traffic at the subnet level.
    </span>
    <span class="koboSpan" id="kobo.381.3">
     NACLs examine and filter traffic entering and leaving every subnet within our VPC.
    </span>
    <span class="koboSpan" id="kobo.381.4">
     When we create the VPC using the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.382.1">
      VPC and more
     </span>
    </strong>
    <span class="koboSpan" id="kobo.383.1">
     option or the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.384.1">
      VPC only
     </span>
    </strong>
    <span class="koboSpan" id="kobo.385.1">
     option, a default NACL is created that allows all inbound and outbound traffic.
    </span>
    <span class="koboSpan" id="kobo.385.2">
     Subnets created are associated automatically with the default NACL.
    </span>
    <span class="koboSpan" id="kobo.385.3">
     However, we can change the associate to a different NACL.
    </span>
    <span class="koboSpan" id="kobo.385.4">
     The following are the inbound rules for the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.386.1">
      default NACL:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer136">
     <span class="koboSpan" id="kobo.387.1">
      <img alt="Figure 5.5 – Inbound rules for default NACL" src="image/B21384_05_5.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.388.1">
     Figure 5.5 – Inbound rules for default NACL
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.389.1">
     When we
    </span>
    <a id="_idIndexMarker649">
    </a>
    <span class="koboSpan" id="kobo.390.1">
     created the VPC, a security group called
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.391.1">
      default
     </span>
    </strong>
    <span class="koboSpan" id="kobo.392.1">
     was created by AWS within our VPC.
    </span>
    <span class="koboSpan" id="kobo.392.2">
     In AWS, a security group functions as a virtual firewall that governs inbound and outbound traffic for EC2 instances.
    </span>
    <span class="koboSpan" id="kobo.392.3">
     It operates at the instance level, whereas NACLs control traffic at the subnet level.
    </span>
    <span class="koboSpan" id="kobo.392.4">
     Security groups and NACLs complement each other, providing layered security within AWS environments.
    </span>
    <span class="koboSpan" id="kobo.392.5">
     We can use security groups for fine-grained, stateful control over individual instances, while NACLs provide an additional layer of stateless, subnet-level security, allowing or blocking types of traffic before they reach
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.393.1">
      your instances.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-172">
    <a id="_idTextAnchor176">
    </a>
    <span class="koboSpan" id="kobo.394.1">
     There’s more...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.395.1">
     A default VPC is provided in every AWS region by AWS and includes a public subnet in each AZ, an IGW, and a configured DNS resolution.
    </span>
    <span class="koboSpan" id="kobo.395.2">
     The default VPC allows the instant launch of Amazon EC2 instances without creating a VPC.
    </span>
    <span class="koboSpan" id="kobo.395.3">
     The following are some of the important
    </span>
    <a id="_idIndexMarker650">
    </a>
    <span class="koboSpan" id="kobo.396.1">
     settings of the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.397.1">
      default VPC:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.398.1">
      Subnets in the default VPC have an outbound route to the internet through
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.399.1">
       an IGW.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.400.1">
      A subnet is created
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.401.1">
       per AZ.
      </span>
     </span>
    </li>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.402.1">
       DHCP options set
      </span>
     </strong>
     <span class="koboSpan" id="kobo.403.1">
      is updated.
     </span>
     <span class="koboSpan" id="kobo.403.2">
      My default VPC has the following options set:
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.404.1">
       domain-name = ec2.internal
      </span>
     </strong>
     <span class="koboSpan" id="kobo.405.1">
      and
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.406.1">
       domain-name-servers =
      </span>
     </strong>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.407.1">
        AmazonProvidedDNS
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.408.1">
       .
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.409.1">
     Let’s quickly go through some more
    </span>
    <a id="_idIndexMarker651">
    </a>
    <span class="koboSpan" id="kobo.410.1">
     important concepts related to
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.411.1">
      AWS VPCs:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.412.1">
      AWS VPCs consist of subresources such as IGWs, route tables, NACLs, subnets, and
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.413.1">
       security groups.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.414.1">
      AWS creates a default VPC ready for us to use in every region.
     </span>
     <span class="koboSpan" id="kobo.414.2">
      The following are some of its
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.415.1">
       important characteristics:
      </span>
     </span>
     <ul>
      <li>
       <span class="koboSpan" id="kobo.416.1">
        Subnets in the default VPC are routed to
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.417.1">
         the internet.
        </span>
       </span>
      </li>
      <li>
       <span class="koboSpan" id="kobo.418.1">
        A subnet is created
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.419.1">
         per AZ.
        </span>
       </span>
      </li>
      <li>
       <strong class="bold">
        <span class="koboSpan" id="kobo.420.1">
         DHCP Options Set
        </span>
       </strong>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.421.1">
         is updated.
        </span>
       </span>
      </li>
     </ul>
    </li>
    <li>
     <span class="koboSpan" id="kobo.422.1">
      VPC
     </span>
     <a id="_idIndexMarker652">
     </a>
     <span class="koboSpan" id="kobo.423.1">
      peering can be used to connect one VPC to another through a direct route using private IP addresses, making the associated instances behave as though they are on the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.424.1">
       same network.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.425.1">
      VPC peering can be done within the same region, across regions, and even across
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.426.1">
       AWS accounts.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.427.1">
      Transitive peering is currently not supported for AWS VPCs.
     </span>
     <span class="koboSpan" id="kobo.427.2">
      Every VPC must be peered to every other required VPC in a star
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.428.1">
       topology-like structure.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.429.1">
      To avoid the overhead of managing many point-to-point connections with VPC peering, we can make use of the AWS Transit Gateway to connect all the VPCs and even on-premises networks to a
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.430.1">
       single gateway.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.431.1">
      Apart from the standard reserved IP addresses of network address and broadcast address, AWS also reserves three more IP addresses.
     </span>
     <span class="koboSpan" id="kobo.431.2">
      So, a total of five addresses are reserved in
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.432.1">
       a VPC.
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.433.1">
     Let’s quickly go through some important
    </span>
    <a id="_idIndexMarker653">
    </a>
    <span class="koboSpan" id="kobo.434.1">
     concepts related to subnets
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.435.1">
      in AWS:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.436.1">
      The first IP address of a subnet represents the subnet ID, while the last IP address represents the subnet’s directed broadcast address.
     </span>
     <span class="koboSpan" id="kobo.436.2">
      Therefore, we cannot use the first and last IP address of a subnet for hosts.
     </span>
     <span class="koboSpan" id="kobo.436.3">
      AWS reserves additional
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.437.1">
       IP addresses.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.438.1">
      The first IP address of the first subnet of a network represents the subnet ID, as well as the network’s ID.
     </span>
     <span class="koboSpan" id="kobo.438.2">
      Similarly, the last IP address of the last subnet of a network represents the subnet’s and the network’s directed broadcast address.
     </span>
     <span class="koboSpan" id="kobo.438.3">
      When using these IP addresses from outside the network, they will be considered as the networks’ IPs, and when using them within the network, they will be considered as the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.439.1">
       subnets’ IPs.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.440.1">
      A subnet in
     </span>
     <a id="_idIndexMarker654">
     </a>
     <span class="koboSpan" id="kobo.441.1">
      AWS VPC is always associated with one AZ.
     </span>
     <span class="koboSpan" id="kobo.441.2">
      While we cannot have one subnet associated with more than one AZ at a time, we can have multiple subnets associated with a
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.442.1">
       single AZ.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.443.1">
      AWS allows us to choose a subnet without contiguous IP addresses, as shown in the following figure.
     </span>
     <span class="koboSpan" id="kobo.443.2">
      However, it is good practice to use contiguous IP address ranges, just like we did in this recipe with
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.444.1">
       10.0.1.0/24
      </span>
     </strong>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.445.1">
       and
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.446.1">
        10.0.2.0/24
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.447.1">
       .
      </span>
     </span>
    </li>
   </ul>
   <div>
    <div class="IMG---Figure" id="_idContainer137">
     <span class="koboSpan" id="kobo.448.1">
      <img alt="Figure 5.6 – Subnets without continuous IP addresses" src="image/B21384_05_6.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.449.1">
     Figure 5.6 – Subnets without continuous IP addresses
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.450.1">
     We will learn about network ACLs, security groups, and IGW in later recipes within
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.451.1">
      this chapter.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-173">
    <a id="_idTextAnchor177">
    </a>
    <span class="koboSpan" id="kobo.452.1">
     See also
    </span>
   </h2>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.453.1">
      We can read more about default VPC
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.454.1">
       at
      </span>
     </span>
     <a href="https://www.cloudericks.com/blog/understanding-aws-default-vpc">
      <span class="No-Break">
       <span class="koboSpan" id="kobo.455.1">
        https://www.cloudericks.com/blog/understanding-aws-default-vpc
       </span>
      </span>
     </a>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.456.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.457.1">
      Read more about the main route table
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.458.1">
       at
      </span>
     </span>
     <a href="https://www.cloudericks.com/blog/understanding-the-main-route-table-in-aws-vpc">
      <span class="No-Break">
       <span class="koboSpan" id="kobo.459.1">
        https://www.cloudericks.com/blog/understanding-the-main-route-table-in-aws-vpc
       </span>
      </span>
     </a>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.460.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.461.1">
      While we have expanded our understanding of VPCs and their associated network resources, it is important to keep in mind that the primary focus of this book is on security rather than networking.
     </span>
     <span class="koboSpan" id="kobo.461.2">
      A solid grasp of networking principles is undoubtedly crucial for developing effective security measures; however, delving too deeply into the intricacies of networking could shift our attention away from the broad spectrum of security topics we aim to explore.
     </span>
     <span class="koboSpan" id="kobo.461.3">
      Readers keen on deepening their networking knowledge can do so
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.462.1">
       at
      </span>
     </span>
     <a href="https://www.cloudericks.com/blog/beginners-roadmap-to-mastering-aws-networking">
      <span class="No-Break">
       <span class="koboSpan" id="kobo.463.1">
        https://www.cloudericks.com/blog/beginners-roadmap-to-mastering-aws-networking
       </span>
      </span>
     </a>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.464.1">
       .
      </span>
     </span>
    </li>
   </ul>
   <h1 id="_idParaDest-174">
    <a id="_idTextAnchor178">
    </a>
    <span class="koboSpan" id="kobo.465.1">
     Creating a bare VPC and setting up public and private subnets
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.466.1">
     A public subnet is
    </span>
    <a id="_idIndexMarker655">
    </a>
    <span class="koboSpan" id="kobo.467.1">
     specifically designed to enable instances within it to be accessible from the internet.
    </span>
    <span class="koboSpan" id="kobo.467.2">
     This is achieved by routing the internet traffic through an IGW by configuring route tables.
    </span>
    <span class="koboSpan" id="kobo.467.3">
     In the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.468.1">
      Setting up VPC plus VPC resources with minimal effort
     </span>
    </em>
    <span class="koboSpan" id="kobo.469.1">
     recipe from this chapter, we selected the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.470.1">
      VPC and more
     </span>
    </strong>
    <span class="koboSpan" id="kobo.471.1">
     option while creating the VPC as we saw in
    </span>
    <span class="No-Break">
     <em class="italic">
      <span class="koboSpan" id="kobo.472.1">
       Figure 5
      </span>
     </em>
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.473.1">
      .1
     </span>
    </em>
    <span class="koboSpan" id="kobo.474.1">
     , which automatically set up public and private subnets, along with a pre-configured IGW and route tables.
    </span>
    <span class="koboSpan" id="kobo.474.2">
     For this recipe, we will choose the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.475.1">
      VPC only
     </span>
    </strong>
    <span class="koboSpan" id="kobo.476.1">
     option to create a VPC without the additional networking resources and set up an IGW and a route table to enable internet access to the instances in
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.477.1">
      our subnet.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-175">
    <a id="_idTextAnchor179">
    </a>
    <span class="koboSpan" id="kobo.478.1">
     Getting ready
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.479.1">
     To follow this recipe, we need a working
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.480.1">
      awsseccb-sandbox-1
     </span>
    </strong>
    <span class="koboSpan" id="kobo.481.1">
     AWS account, and a
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.482.1">
      awsseccbadmin1
     </span>
    </strong>
    <span class="koboSpan" id="kobo.483.1">
     user, as described in the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.484.1">
      Technical
     </span>
    </em>
    <span class="No-Break">
     <em class="italic">
      <span class="koboSpan" id="kobo.485.1">
       requirements
      </span>
     </em>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.486.1">
      section.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-176">
    <a id="_idTextAnchor180">
    </a>
    <span class="koboSpan" id="kobo.487.1">
     How to do it...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.488.1">
     First, we will create a
    </span>
    <a id="_idIndexMarker656">
    </a>
    <span class="koboSpan" id="kobo.489.1">
     bare VPC and a subnet, and then we will set up IGW and
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.490.1">
      route tables.
     </span>
    </span>
   </p>
   <h3>
    <span class="koboSpan" id="kobo.491.1">
     Creating a bare VPC
    </span>
   </h3>
   <p>
    <span class="koboSpan" id="kobo.492.1">
     We can create a VPC only without additional resources
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.493.1">
      as follows:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.494.1">
      Log in to the AWS Management Console and go to the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.495.1">
       VPC
      </span>
     </strong>
     <span class="koboSpan" id="kobo.496.1">
      service in
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.497.1">
       the console.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.498.1">
      From the left sidebar, under the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.499.1">
       Virtual private cloud
      </span>
     </strong>
     <span class="koboSpan" id="kobo.500.1">
      heading, click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.501.1">
       Your VPCs
      </span>
     </strong>
     <span class="koboSpan" id="kobo.502.1">
      .
     </span>
     <span class="koboSpan" id="kobo.502.2">
      We will be taken to the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.503.1">
       Your VPCs
      </span>
     </strong>
     <span class="koboSpan" id="kobo.504.1">
      page, where we can see our VPCs.
     </span>
     <span class="koboSpan" id="kobo.504.2">
      If we are using VPCs for the first time, we should see the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.505.1">
       default VPC.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.506.1">
      On the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.507.1">
       Your VPCs
      </span>
     </strong>
     <span class="koboSpan" id="kobo.508.1">
      page, click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.509.1">
       Create VPC
      </span>
     </strong>
     <span class="koboSpan" id="kobo.510.1">
      , and on the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.511.1">
       Create VPC
      </span>
     </strong>
     <span class="koboSpan" id="kobo.512.1">
      screen, select
     </span>
     <a id="_idIndexMarker657">
     </a>
     <span class="koboSpan" id="kobo.513.1">
      the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.514.1">
       VPC only
      </span>
     </strong>
     <span class="koboSpan" id="kobo.515.1">
      option.
     </span>
     <span class="koboSpan" id="kobo.515.2">
      Give the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.516.1">
       awsseccb-vpc2
      </span>
     </strong>
     <span class="koboSpan" id="kobo.517.1">
      name.
     </span>
     <span class="koboSpan" id="kobo.517.2">
      For
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.518.1">
       IPv4 CIDR block
      </span>
     </strong>
     <span class="koboSpan" id="kobo.519.1">
      , select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.520.1">
       IPv4 CIDR manual input
      </span>
     </strong>
     <span class="koboSpan" id="kobo.521.1">
      and give the value as
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.522.1">
       10.0.0.0/24
      </span>
     </strong>
     <span class="koboSpan" id="kobo.523.1">
      .
     </span>
     <span class="koboSpan" id="kobo.523.2">
      For
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.524.1">
       IPv6 CIDR block
      </span>
     </strong>
     <span class="koboSpan" id="kobo.525.1">
      , select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.526.1">
       No IPv6
      </span>
     </strong>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.527.1">
        CIDR block
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.528.1">
       .
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer138">
     <span class="koboSpan" id="kobo.529.1">
      <img alt="Figure 5.7 – Only creating a VPC" src="image/B21384_05_7.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.530.1">
     Figure 5.7 – Only creating a VPC
    </span>
   </p>
   <ol>
    <li value="4">
     <span class="koboSpan" id="kobo.531.1">
      Scroll down, leave the automatically generated tag (
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.532.1">
       Key
      </span>
     </strong>
     <span class="koboSpan" id="kobo.533.1">
      is
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.534.1">
       Name
      </span>
     </strong>
     <span class="koboSpan" id="kobo.535.1">
      and
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.536.1">
       Value
      </span>
     </strong>
     <span class="koboSpan" id="kobo.537.1">
      is
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.538.1">
       awsseccb-vpc2
      </span>
     </strong>
     <span class="koboSpan" id="kobo.539.1">
      ) as-is, optionally
     </span>
     <a id="_idIndexMarker658">
     </a>
     <span class="koboSpan" id="kobo.540.1">
      add any new tags, and click
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.541.1">
        Create VPC
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.542.1">
       .
      </span>
     </span>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.543.1">
     Our VPC is created now.
    </span>
    <span class="koboSpan" id="kobo.543.2">
     Next, we will create a subnet within
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.544.1">
      the VPC.
     </span>
    </span>
   </p>
   <h3>
    <span class="koboSpan" id="kobo.545.1">
     Creating a subnet within a VPC
    </span>
   </h3>
   <p>
    <span class="koboSpan" id="kobo.546.1">
     We
    </span>
    <a id="_idIndexMarker659">
    </a>
    <span class="koboSpan" id="kobo.547.1">
     created a VPC with a CIDR block range of
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.548.1">
      10.0.0.0/24
     </span>
    </strong>
    <span class="koboSpan" id="kobo.549.1">
     in the previous section.
    </span>
    <span class="koboSpan" id="kobo.549.2">
     We will add a subnet with a netmask of
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.550.1">
      /25
     </span>
    </strong>
    <span class="koboSpan" id="kobo.551.1">
     .
    </span>
    <span class="koboSpan" id="kobo.551.2">
     We need to create subnets within a VPC’s IP address range without any overlap with other subnets.
    </span>
    <span class="koboSpan" id="kobo.551.3">
     Let us
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.552.1">
      get started.
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.553.1">
      Go to the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.554.1">
       VPC
      </span>
     </strong>
     <span class="koboSpan" id="kobo.555.1">
      service in
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.556.1">
       the console.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.557.1">
      Click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.558.1">
       Subnets
      </span>
     </strong>
     <span class="koboSpan" id="kobo.559.1">
      in the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.560.1">
       left sidebar.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.561.1">
      Click on
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.562.1">
        Create subnet
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.563.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.564.1">
      On the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.565.1">
       Create subnet
      </span>
     </strong>
     <span class="koboSpan" id="kobo.566.1">
      page, under
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.567.1">
       VPC ID
      </span>
     </strong>
     <span class="koboSpan" id="kobo.568.1">
      , select the VPC we created in the previous section using the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.569.1">
       drop-down box.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.570.1">
      Under
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.571.1">
       Subnet settings
      </span>
     </strong>
     <span class="koboSpan" id="kobo.572.1">
      , set the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.573.1">
       Subnet name
      </span>
     </strong>
     <span class="koboSpan" id="kobo.574.1">
      field to
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.575.1">
       awsseccb-vpc2-public-subnet
      </span>
     </strong>
     <span class="koboSpan" id="kobo.576.1">
      .
     </span>
     <span class="koboSpan" id="kobo.576.2">
      If we plan to create a private subnet, give the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.577.1">
       awsseccb-vpc2-private-subnet
      </span>
     </strong>
     <span class="koboSpan" id="kobo.578.1">
      name.
     </span>
     <span class="koboSpan" id="kobo.578.2">
      Complete the remaining steps within the current section, but skip the remaining sections of
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.579.1">
       this chapter.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.580.1">
      Select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.581.1">
       No preference
      </span>
     </strong>
     <span class="koboSpan" id="kobo.582.1">
      under
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.583.1">
        Availability Zone
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.584.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.585.1">
      For the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.586.1">
       IPv4 VPC CIDR block
      </span>
     </strong>
     <span class="koboSpan" id="kobo.587.1">
      , keep the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.588.1">
       default value.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.589.1">
      For
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.590.1">
       IPv4 subnet CIDR block
      </span>
     </strong>
     <span class="koboSpan" id="kobo.591.1">
      , provide an IP address range that is a subset of our VPC’s IP address range.
     </span>
     <span class="koboSpan" id="kobo.591.2">
      I will be
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.592.1">
       using
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.593.1">
        10.0.0.0/25
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.594.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.595.1">
      Scroll down and click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.596.1">
       Create subnet
      </span>
     </strong>
     <span class="koboSpan" id="kobo.597.1">
      to create
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.598.1">
       the subnets.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.599.1">
      Go to the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.600.1">
       Subnets
      </span>
     </strong>
     <span class="koboSpan" id="kobo.601.1">
      page from the sidebar.
     </span>
     <span class="koboSpan" id="kobo.601.2">
      We should be able to see the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.602.1">
       new subnet.
      </span>
     </span>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.603.1">
     We have created a subnet within this recipe without any internet connectivity yet.
    </span>
    <span class="koboSpan" id="kobo.603.2">
     If you are looking to create a private subnet, you have done it.
    </span>
    <span class="koboSpan" id="kobo.603.3">
     To set up the subnet as a public subnet, continue with the rest of the sections of
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.604.1">
      this recipe.
     </span>
    </span>
   </p>
   <h3>
    <span class="koboSpan" id="kobo.605.1">
     Enable auto-assign public IPv4 address
    </span>
   </h3>
   <p>
    <span class="koboSpan" id="kobo.606.1">
     To make
    </span>
    <a id="_idIndexMarker660">
    </a>
    <span class="koboSpan" id="kobo.607.1">
     the subnet a public subnet, it is good to enable the auto-assign public IPv4 address feature
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.608.1">
      as follows:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.609.1">
      Select the subnet we created, click on the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.610.1">
       Actions
      </span>
     </strong>
     <span class="koboSpan" id="kobo.611.1">
      dropdown, and click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.612.1">
       Edit
      </span>
     </strong>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.613.1">
        subnet settings
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.614.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.615.1">
      Select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.616.1">
       Enable auto-assign public IPv4 address
      </span>
     </strong>
     <span class="koboSpan" id="kobo.617.1">
      and
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.618.1">
       click
      </span>
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.619.1">
        Save
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.620.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.621.1">
      Go to the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.622.1">
       Subnets
      </span>
     </strong>
     <span class="koboSpan" id="kobo.623.1">
      page from the sidebar.
     </span>
     <span class="koboSpan" id="kobo.623.2">
      We should be able to see
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.624.1">
       Auto-assign public IPv4 address
      </span>
     </strong>
     <span class="koboSpan" id="kobo.625.1">
      set to
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.626.1">
       Yes
      </span>
     </strong>
     <span class="koboSpan" id="kobo.627.1">
      for our
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.628.1">
       first subnet.
      </span>
     </span>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.629.1">
     Next, we will create
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.630.1">
      an IGW.
     </span>
    </span>
   </p>
   <h3>
    <span class="koboSpan" id="kobo.631.1">
     Creating and configuring an IGW
    </span>
   </h3>
   <p>
    <span class="koboSpan" id="kobo.632.1">
     We can
    </span>
    <a id="_idIndexMarker661">
    </a>
    <span class="koboSpan" id="kobo.633.1">
     create and attach an
    </span>
    <a id="_idIndexMarker662">
    </a>
    <span class="koboSpan" id="kobo.634.1">
     IGW to our VPC for setting up a public subnet
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.635.1">
      as follows:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.636.1">
      Go to the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.637.1">
       VPC
      </span>
     </strong>
     <span class="koboSpan" id="kobo.638.1">
      service in
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.639.1">
       the console.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.640.1">
      Click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.641.1">
       Internet gateways
      </span>
     </strong>
     <span class="koboSpan" id="kobo.642.1">
      from the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.643.1">
       left sidebar.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.644.1">
      Click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.645.1">
       Create
      </span>
     </strong>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.646.1">
        internet gateway
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.647.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.648.1">
      Give a descriptive name for
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.649.1">
       Name tag
      </span>
     </strong>
     <span class="koboSpan" id="kobo.650.1">
      such as
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.651.1">
       awsseccb-vpc2-igw
      </span>
     </strong>
     <span class="koboSpan" id="kobo.652.1">
      .
     </span>
     <span class="koboSpan" id="kobo.652.2">
      Leave the automatically generated tag (
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.653.1">
       Key
      </span>
     </strong>
     <span class="koboSpan" id="kobo.654.1">
      is
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.655.1">
       Name
      </span>
     </strong>
     <span class="koboSpan" id="kobo.656.1">
      and
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.657.1">
       Value
      </span>
     </strong>
     <span class="koboSpan" id="kobo.658.1">
      is
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.659.1">
       awsseccb-vpc2-igw
      </span>
     </strong>
     <span class="koboSpan" id="kobo.660.1">
      ) as-is, optionally add any new tags, and click
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.661.1">
       Create internet gateway
      </span>
     </strong>
     <span class="koboSpan" id="kobo.662.1">
      .
     </span>
     <span class="koboSpan" id="kobo.662.2">
      We should get a success message stating that the IGW has been created.
     </span>
     <span class="koboSpan" id="kobo.662.3">
      If we go to the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.663.1">
       Internet gateways
      </span>
     </strong>
     <span class="koboSpan" id="kobo.664.1">
      screen, we will see that the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.665.1">
       State
      </span>
     </strong>
     <span class="koboSpan" id="kobo.666.1">
      of our IGW is
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.667.1">
       currently
      </span>
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.668.1">
        Detached
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.669.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.670.1">
      Select the IGW we created, click on the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.671.1">
       Actions
      </span>
     </strong>
     <span class="koboSpan" id="kobo.672.1">
      dropdown, and click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.673.1">
       Attach
      </span>
     </strong>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.674.1">
        to VPC
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.675.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.676.1">
      On the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.677.1">
       Attach to VPC
      </span>
     </strong>
     <span class="koboSpan" id="kobo.678.1">
      screen, select the VPC we created in this recipe and click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.679.1">
       Attach internet gateway
      </span>
     </strong>
     <span class="koboSpan" id="kobo.680.1">
      .
     </span>
     <span class="koboSpan" id="kobo.680.2">
      If we go to the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.681.1">
       Internet gateways
      </span>
     </strong>
     <span class="koboSpan" id="kobo.682.1">
      screen, we will see that the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.683.1">
       State
      </span>
     </strong>
     <span class="koboSpan" id="kobo.684.1">
      of our IGW is
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.685.1">
       now
      </span>
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.686.1">
        Attached
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.687.1">
       .
      </span>
     </span>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.688.1">
     Next, we will create and configure a
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.689.1">
      route table.
     </span>
    </span>
   </p>
   <h3>
    <span class="koboSpan" id="kobo.690.1">
     Creating and configuring a route table
    </span>
   </h3>
   <p>
    <span class="koboSpan" id="kobo.691.1">
     We can
    </span>
    <a id="_idIndexMarker663">
    </a>
    <span class="koboSpan" id="kobo.692.1">
     create and
    </span>
    <a id="_idIndexMarker664">
    </a>
    <span class="koboSpan" id="kobo.693.1">
     configure the route table for setting up a public subnet
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.694.1">
      as follows:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.695.1">
      Click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.696.1">
       Route tables
      </span>
     </strong>
     <span class="koboSpan" id="kobo.697.1">
      from the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.698.1">
       left sidebar.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.699.1">
      Click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.700.1">
       Create
      </span>
     </strong>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.701.1">
        route table
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.702.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.703.1">
      Provide the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.704.1">
       awsseccb-vpc2-rtb-public
      </span>
     </strong>
     <span class="koboSpan" id="kobo.705.1">
      name and select the VPC we created in
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.706.1">
       this recipe.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.707.1">
      Leave the automatically generated tag (
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.708.1">
       Key
      </span>
     </strong>
     <span class="koboSpan" id="kobo.709.1">
      is
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.710.1">
       Name
      </span>
     </strong>
     <span class="koboSpan" id="kobo.711.1">
      and
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.712.1">
       Value
      </span>
     </strong>
     <span class="koboSpan" id="kobo.713.1">
      is
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.714.1">
       awsseccb-vpc2-rtb-public
      </span>
     </strong>
     <span class="koboSpan" id="kobo.715.1">
      ) as-is, optionally add any new tags, and click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.716.1">
       Create
      </span>
     </strong>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.717.1">
        route table
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.718.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.719.1">
      Click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.720.1">
       Route tables
      </span>
     </strong>
     <span class="koboSpan" id="kobo.721.1">
      from the left sidebar, select the route table we created, click on the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.722.1">
       Actions
      </span>
     </strong>
     <span class="koboSpan" id="kobo.723.1">
      dropdown or go to the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.724.1">
       Routes
      </span>
     </strong>
     <span class="koboSpan" id="kobo.725.1">
      tab, and click on
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.726.1">
        Edit routes
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.727.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.728.1">
      On the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.729.1">
       Edit routes
      </span>
     </strong>
     <span class="koboSpan" id="kobo.730.1">
      page, click
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.731.1">
        Add route
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.732.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.733.1">
      For
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.734.1">
       Destination
      </span>
     </strong>
     <span class="koboSpan" id="kobo.735.1">
      , select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.736.1">
       0.0.0.0/0
      </span>
     </strong>
     <span class="koboSpan" id="kobo.737.1">
      .
     </span>
     <span class="koboSpan" id="kobo.737.2">
      For
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.738.1">
       Target
      </span>
     </strong>
     <span class="koboSpan" id="kobo.739.1">
      , select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.740.1">
       Internet Gateway
      </span>
     </strong>
     <span class="koboSpan" id="kobo.741.1">
      , then select the IGW we created in this recipe, and click
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.742.1">
       Save changes
      </span>
     </strong>
     <span class="koboSpan" id="kobo.743.1">
      .
     </span>
     <span class="koboSpan" id="kobo.743.2">
      If we want to add a route for the IPv6 address, we can add a similar entry with the destination set
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.744.1">
       to
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.745.1">
        ::/0
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.746.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.747.1">
      Go to our route table and go to the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.748.1">
       Subnet
      </span>
     </strong>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.749.1">
        associations
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.750.1">
       tab.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.751.1">
      Click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.752.1">
       Edit subnet associations
      </span>
     </strong>
     <span class="koboSpan" id="kobo.753.1">
      , select the subnet we created in this recipe, and click on
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.754.1">
        Save associations
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.755.1">
       .
      </span>
     </span>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.756.1">
     We can now launch EC2 instances into our public subnet with the appropriate security group rules and verify
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.757.1">
      the changes.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-177">
    <a id="_idTextAnchor181">
    </a>
    <span class="koboSpan" id="kobo.758.1">
     How it works...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.759.1">
     We first created
    </span>
    <a id="_idIndexMarker665">
    </a>
    <span class="koboSpan" id="kobo.760.1">
     a bare VPC.
    </span>
    <span class="koboSpan" id="kobo.760.2">
     When we create a bare VPC using the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.761.1">
      VPC only
     </span>
    </strong>
    <span class="koboSpan" id="kobo.762.1">
     option, a main route table, a default NACL, and a default security group are also created along with the VPC.
    </span>
    <span class="koboSpan" id="kobo.762.2">
     The main route table dictates the default rules for subnets not associated with any route table.
    </span>
    <span class="koboSpan" id="kobo.762.3">
     In our case, the main route table includes only a local route that enables communication within the VPC.
    </span>
    <span class="koboSpan" id="kobo.762.4">
     This is crucial for allowing instances within the same VPC to communicate with each other without needing to traverse the internet or any other
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.763.1">
      external network.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.764.1">
     A network ACL acts as a firewall for controlling traffic at the subnet level.
    </span>
    <span class="koboSpan" id="kobo.764.2">
     In our case, a default NACL was created that allows all traffic.
    </span>
    <span class="koboSpan" id="kobo.764.3">
     A security group in AWS acts like a virtual firewall for our EC2 instances to control inbound and outbound traffic.
    </span>
    <span class="koboSpan" id="kobo.764.4">
     In our case, a default security group was created that will allow all traffic.
    </span>
    <span class="koboSpan" id="kobo.764.5">
     We will see NACLs and security groups again in later recipes within
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.765.1">
      this chapter.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.766.1">
     We selected the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.767.1">
      Enable auto-assign public IPv4 address
     </span>
    </strong>
    <span class="koboSpan" id="kobo.768.1">
     option, which makes it the default option while creating an EC2 instance within this subnet.
    </span>
    <span class="koboSpan" id="kobo.768.2">
     We can override this if we want during the instance creation.
    </span>
    <span class="koboSpan" id="kobo.768.3">
     We can also create and attach an Elastic IP address later to our
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.769.1">
      EC2 instance.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.770.1">
     We created and attached an IGW.
    </span>
    <span class="koboSpan" id="kobo.770.2">
     We also created and configured a route table for internet access.
    </span>
    <span class="koboSpan" id="kobo.770.3">
     We can make the main route table public if we want to, by editing the routes.
    </span>
    <span class="koboSpan" id="kobo.770.4">
     However, if we make the main route table public, it will implicitly make all the new subnets public until we associate it with a private route table.
    </span>
    <span class="koboSpan" id="kobo.770.5">
     Therefore, it is a good practice to create a separate route table for public access and then attach the subnets that need public access to that VPC.
    </span>
    <span class="koboSpan" id="kobo.770.6">
     We will do
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.771.1">
      this next.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-178">
    <a id="_idTextAnchor182">
    </a>
    <span class="koboSpan" id="kobo.772.1">
     There’s more...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.773.1">
     In the previous recipe from this chapter,
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.774.1">
      Setting up VPC plus VPC resources with minimal effort
     </span>
    </em>
    <span class="koboSpan" id="kobo.775.1">
     , we discussed VPC and VPC resources in detail.
    </span>
    <span class="koboSpan" id="kobo.775.2">
     Therefore, I will not repeat.
    </span>
    <span class="koboSpan" id="kobo.775.3">
     Please refer to the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.776.1">
      How it works
     </span>
    </em>
    <span class="koboSpan" id="kobo.777.1">
     ,
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.778.1">
      There’s more…
     </span>
    </em>
    <span class="koboSpan" id="kobo.779.1">
     , and
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.780.1">
      See also
     </span>
    </em>
    <span class="koboSpan" id="kobo.781.1">
     sections of that recipe even if you do not want to practice the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.782.1">
      How to do
     </span>
    </em>
    <span class="No-Break">
     <em class="italic">
      <span class="koboSpan" id="kobo.783.1">
       it
      </span>
     </em>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.784.1">
      section.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-179">
    <a id="_idTextAnchor183">
    </a>
    <span class="koboSpan" id="kobo.785.1">
     See also
    </span>
   </h2>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.786.1">
      Read more about IGWs
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.787.1">
       at
      </span>
     </span>
     <a href="https://www.cloudericks.com/blog/understanding-internet-gateway-in-aws">
      <span class="No-Break">
       <span class="koboSpan" id="kobo.788.1">
        https://www.cloudericks.com/blog/understanding-internet-gateway-in-aws
       </span>
      </span>
     </a>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.789.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.790.1">
      Read more about AWS VPC route tables
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.791.1">
       at
      </span>
     </span>
     <a href="https://www.cloudericks.com/blog/understanding-aws-vpc-route-tables">
      <span class="No-Break">
       <span class="koboSpan" id="kobo.792.1">
        https://www.cloudericks.com/blog/understanding-aws-vpc-route-tables
       </span>
      </span>
     </a>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.793.1">
       .
      </span>
     </span>
    </li>
   </ul>
   <h1 id="_idParaDest-180">
    <a id="_idTextAnchor184">
    </a>
    <span class="koboSpan" id="kobo.794.1">
     Launching an EC2 instance with a web server using user data
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.795.1">
     In this recipe, we will
    </span>
    <a id="_idIndexMarker666">
    </a>
    <span class="koboSpan" id="kobo.796.1">
     use the EC2 user data feature to set up a simple web server during the launch of an EC2 instance.
    </span>
    <span class="koboSpan" id="kobo.796.2">
     We will use this instance to test the VPC and public subnet we created in the previous recipes.
    </span>
    <span class="koboSpan" id="kobo.796.3">
     We will also use this recipe in future recipes where we need to launch an EC2 instance.
    </span>
    <span class="koboSpan" id="kobo.796.4">
     The EC2 user data feature also significantly enhances security by enabling automated security patching, ensuring instances are updated with the latest protections upon booting and reducing vulnerabilities.
    </span>
    <span class="koboSpan" id="kobo.796.5">
     Moreover, it guarantees consistent security configurations across all instances, fostering a uniform security posture that prevents configuration drifts and strictly adheres to established security standards from
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.797.1">
      the start.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-181">
    <a id="_idTextAnchor185">
    </a>
    <span class="koboSpan" id="kobo.798.1">
     Getting ready
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.799.1">
     We need the following to successfully complete
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.800.1">
      this recipe:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.801.1">
      A working
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.802.1">
       awsseccb-sandbox-1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.803.1">
      AWS account, and a
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.804.1">
       awsseccbadmin1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.805.1">
      user, as described in the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.806.1">
       Technical
      </span>
     </em>
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.807.1">
        requirements
       </span>
      </em>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.808.1">
       section.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.809.1">
      An
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.810.1">
       awsseccb-vpc
      </span>
     </strong>
     <span class="koboSpan" id="kobo.811.1">
      VPC following the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.812.1">
       Setting up VPC plus VPC resources with minimal effort
      </span>
     </em>
     <span class="koboSpan" id="kobo.813.1">
      recipe from
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.814.1">
       this chapter.
      </span>
     </span>
    </li>
   </ul>
   <h2 id="_idParaDest-182">
    <a id="_idTextAnchor186">
    </a>
    <span class="koboSpan" id="kobo.815.1">
     How to do it...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.816.1">
     We will first set up an
    </span>
    <a id="_idIndexMarker667">
    </a>
    <span class="koboSpan" id="kobo.817.1">
     EC2 instance as a web server using EC2 user data and verify it from the browser.
    </span>
    <span class="koboSpan" id="kobo.817.2">
     Then we will see how we can log into the instance
    </span>
    <a id="_idIndexMarker668">
    </a>
    <span class="koboSpan" id="kobo.818.1">
     using
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.819.1">
      Secure
     </span>
    </strong>
    <span class="No-Break">
     <strong class="bold">
      <span class="koboSpan" id="kobo.820.1">
       Shell
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.821.1">
      (
     </span>
    </span>
    <span class="No-Break">
     <strong class="bold">
      <span class="koboSpan" id="kobo.822.1">
       SSH
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.823.1">
      ).
     </span>
    </span>
   </p>
   <h3>
    <span class="koboSpan" id="kobo.824.1">
     Setting up a web server using EC2 user data
    </span>
   </h3>
   <p>
    <span class="koboSpan" id="kobo.825.1">
     We can launch an EC2 instance with a web server using user data
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.826.1">
      as follows:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.827.1">
      Log into the AWS Management Console and go to the
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.828.1">
        EC2
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.829.1">
       dashboard.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.830.1">
      Click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.831.1">
       Instances
      </span>
     </strong>
     <span class="koboSpan" id="kobo.832.1">
      from the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.833.1">
       left sidebar.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.834.1">
      Click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.835.1">
       Launch instances
      </span>
     </strong>
     <span class="koboSpan" id="kobo.836.1">
      at the top right of
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.837.1">
       the page.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.838.1">
      For
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.839.1">
       Name
      </span>
     </strong>
     <span class="koboSpan" id="kobo.840.1">
      , provide the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.841.1">
       Cloudericks Web
      </span>
     </strong>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.842.1">
        Server
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.843.1">
       value.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.844.1">
      In the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.845.1">
       Application and OS Images (Amazon Machine Image)
      </span>
     </strong>
     <span class="koboSpan" id="kobo.846.1">
      section, select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.847.1">
       Amazon Linux
      </span>
     </strong>
     <span class="koboSpan" id="kobo.848.1">
      , and for
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.849.1">
       Amazon Machine Image (AMI)
      </span>
     </strong>
     <span class="koboSpan" id="kobo.850.1">
      , select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.851.1">
       Amazon Linux
      </span>
     </strong>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.852.1">
        2023 AMI
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.853.1">
       .
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer139">
     <span class="koboSpan" id="kobo.854.1">
      <img alt="Figure 5.8 – Selecting Amazon Linux" src="image/B21384_05_8.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.855.1">
     Figure 5.8 – Selecting Amazon Linux
    </span>
   </p>
   <ol>
    <li value="6">
     <span class="koboSpan" id="kobo.856.1">
      For
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.857.1">
       Instance type
      </span>
     </strong>
     <span class="koboSpan" id="kobo.858.1">
      ,
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.859.1">
       select
      </span>
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.860.1">
        t2.micro
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.861.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.862.1">
      For
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.863.1">
       Key pair (login)
      </span>
     </strong>
     <span class="koboSpan" id="kobo.864.1">
      , either
     </span>
     <a id="_idIndexMarker669">
     </a>
     <span class="koboSpan" id="kobo.865.1">
      select the key pair name of a key pair we have already generated and have access to or, if we do not have a key pair, click on the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.866.1">
       Create new key pair
      </span>
     </strong>
     <span class="koboSpan" id="kobo.867.1">
      link and complete the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.868.1">
       following steps:
      </span>
     </span>
     <ol>
      <li class="Alphabets">
       <span class="koboSpan" id="kobo.869.1">
        Enter a key
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.870.1">
         pair name.
        </span>
       </span>
      </li>
      <li class="Alphabets">
       <span class="koboSpan" id="kobo.871.1">
        Set
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.872.1">
         Key pair type
        </span>
       </strong>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.873.1">
         to
        </span>
       </span>
       <span class="No-Break">
        <strong class="bold">
         <span class="koboSpan" id="kobo.874.1">
          RSA
         </span>
        </strong>
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.875.1">
         .
        </span>
       </span>
      </li>
      <li class="Alphabets">
       <span class="koboSpan" id="kobo.876.1">
        Set
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.877.1">
         Private key file format
        </span>
       </strong>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.878.1">
         to
        </span>
       </span>
       <span class="No-Break">
        <strong class="bold">
         <span class="koboSpan" id="kobo.879.1">
          .pem
         </span>
        </strong>
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.880.1">
         .
        </span>
       </span>
      </li>
      <li class="Alphabets">
       <span class="koboSpan" id="kobo.881.1">
        Click on
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.882.1">
         Create
        </span>
       </strong>
       <span class="No-Break">
        <strong class="bold">
         <span class="koboSpan" id="kobo.883.1">
          key pair
         </span>
        </strong>
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.884.1">
         .
        </span>
       </span>
      </li>
     </ol>
    </li>
   </ol>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.885.1">
     Important note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.886.1">
     We should save the key safely.
    </span>
    <span class="koboSpan" id="kobo.886.2">
     If we are using a Unix or Mac system, then we need to change the file permission to read-only access with the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.887.1">
      chmod
     </span>
    </strong>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.888.1">
       400
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.889.1">
      command.
     </span>
    </span>
   </p>
   <ol>
    <li value="8">
     <span class="koboSpan" id="kobo.890.1">
      In
     </span>
     <a id="_idIndexMarker670">
     </a>
     <span class="koboSpan" id="kobo.891.1">
      the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.892.1">
       Network settings
      </span>
     </strong>
     <span class="koboSpan" id="kobo.893.1">
      section, click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.894.1">
       Edit
      </span>
     </strong>
     <span class="koboSpan" id="kobo.895.1">
      and do
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.896.1">
       the following:
      </span>
     </span>
     <ol>
      <li class="Alphabets">
       <span class="koboSpan" id="kobo.897.1">
        For
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.898.1">
         VPC
        </span>
       </strong>
       <span class="koboSpan" id="kobo.899.1">
        , select our VPC, which is
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.900.1">
         named
        </span>
       </span>
       <span class="No-Break">
        <strong class="source-inline">
         <span class="koboSpan" id="kobo.901.1">
          awsseccb-vpc
         </span>
        </strong>
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.902.1">
         .
        </span>
       </span>
      </li>
      <li class="Alphabets">
       <span class="koboSpan" id="kobo.903.1">
        For
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.904.1">
         Subnet
        </span>
       </strong>
       <span class="koboSpan" id="kobo.905.1">
        , select a public subnet in the
       </span>
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.906.1">
         us-east-1a
        </span>
       </strong>
       <span class="koboSpan" id="kobo.907.1">
        AZ.
       </span>
       <span class="koboSpan" id="kobo.907.2">
        If you have created a subnet as mentioned in the
       </span>
       <em class="italic">
        <span class="koboSpan" id="kobo.908.1">
         Getting ready
        </span>
       </em>
       <span class="koboSpan" id="kobo.909.1">
        section, these details are included in the name of
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.910.1">
         the subnet.
        </span>
       </span>
      </li>
      <li class="Alphabets">
       <span class="koboSpan" id="kobo.911.1">
        Set
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.912.1">
         Auto-assign public IP
        </span>
       </strong>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.913.1">
         to
        </span>
       </span>
       <span class="No-Break">
        <strong class="bold">
         <span class="koboSpan" id="kobo.914.1">
          Enable
         </span>
        </strong>
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.915.1">
         .
        </span>
       </span>
      </li>
     </ol>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer140">
     <span class="koboSpan" id="kobo.916.1">
      <img alt="Figure 5.9 – The launch instance network settings" src="image/B21384_05_9.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.917.1">
     Figure 5.9 – The launch instance network settings
    </span>
   </p>
   <ol>
    <li value="9">
     <span class="koboSpan" id="kobo.918.1">
      Under
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.919.1">
       Firewall (security groups)
      </span>
     </strong>
     <span class="koboSpan" id="kobo.920.1">
      in the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.921.1">
       Networks
      </span>
     </strong>
     <span class="koboSpan" id="kobo.922.1">
      settings section, select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.923.1">
       Create security group
      </span>
     </strong>
     <span class="koboSpan" id="kobo.924.1">
      .
     </span>
     <span class="koboSpan" id="kobo.924.2">
      For
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.925.1">
       Security group name
      </span>
     </strong>
     <span class="koboSpan" id="kobo.926.1">
      , enter
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.927.1">
       cloudericks-web-server
      </span>
     </strong>
     <span class="koboSpan" id="kobo.928.1">
      .
     </span>
     <span class="koboSpan" id="kobo.928.2">
      For
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.929.1">
       Description
      </span>
     </strong>
     <span class="koboSpan" id="kobo.930.1">
      , replace the default security group name within the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.931.1">
       Description
      </span>
     </strong>
     <span class="koboSpan" id="kobo.932.1">
      field
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.933.1">
       with
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.934.1">
        cloudericks-web-server
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.935.1">
       .
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer141">
     <span class="koboSpan" id="kobo.936.1">
      <img alt="Figure 5.10 Creating a security group" src="image/B21384_05_10.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.937.1">
     Figure 5.10 Creating a security group
    </span>
   </p>
   <ol>
    <li value="10">
     <span class="koboSpan" id="kobo.938.1">
      Under
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.939.1">
       Inbound Security Group Rules
      </span>
     </strong>
     <span class="koboSpan" id="kobo.940.1">
      within the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.941.1">
       Network settings
      </span>
     </strong>
     <span class="koboSpan" id="kobo.942.1">
      section, add
     </span>
     <a id="_idIndexMarker671">
     </a>
     <span class="koboSpan" id="kobo.943.1">
      rules for
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.944.1">
       HTTP
      </span>
     </strong>
     <span class="koboSpan" id="kobo.945.1">
      and
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.946.1">
       HTTPS
      </span>
     </strong>
     <span class="koboSpan" id="kobo.947.1">
      with
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.948.1">
       Source type
      </span>
     </strong>
     <span class="koboSpan" id="kobo.949.1">
      as
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.950.1">
       Anywhere
      </span>
     </strong>
     <span class="koboSpan" id="kobo.951.1">
      .
     </span>
     <span class="koboSpan" id="kobo.951.2">
      Add the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.952.1">
       SSH
      </span>
     </strong>
     <span class="koboSpan" id="kobo.953.1">
      rule with the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.954.1">
       Source type
      </span>
     </strong>
     <span class="koboSpan" id="kobo.955.1">
      as
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.956.1">
       My IP
      </span>
     </strong>
     <span class="koboSpan" id="kobo.957.1">
      to allow SSH only from
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.958.1">
       our IP.
      </span>
     </span>
    </li>
   </ol>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.959.1">
     Important note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.960.1">
     We allowed SSH traffic from our own IP address.
    </span>
    <span class="koboSpan" id="kobo.960.2">
     In a production environment, SSH access is typically restricted to a bastion host or jump host, which is a dedicated server configured to provide a secure and controlled access point to the internal network from an external source.
    </span>
    <span class="koboSpan" id="kobo.960.3">
     With a bastion host setup, we first log in to the bastion host and, from there, securely log in to our web server.
    </span>
    <span class="koboSpan" id="kobo.960.4">
     We may also use one of the options shown such as EC2 Instance Connect, Session Manager, and EC2 serial console, as shown in
    </span>
    <span class="No-Break">
     <em class="italic">
      <span class="koboSpan" id="kobo.961.1">
       Figure 5
      </span>
     </em>
    </span>
    <span class="No-Break">
     <em class="italic">
      <span class="koboSpan" id="kobo.962.1">
       .13
      </span>
     </em>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.963.1">
      .
     </span>
    </span>
   </p>
   <ol>
    <li value="11">
     <span class="koboSpan" id="kobo.964.1">
      In the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.965.1">
       Advanced details
      </span>
     </strong>
     <span class="koboSpan" id="kobo.966.1">
      section, copy and paste the following script code into the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.967.1">
       User
      </span>
     </strong>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.968.1">
        data
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.969.1">
       field:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.970.1">
#!/bin/bash
sudo su
yum update -y
yum install -y httpd
cd /var/www/html
echo "&lt;html&gt;&lt;h1&gt;Cloudericks Web Server&lt;/h1&gt;&lt;/html&gt;" &gt; index.html
systemctl start httpd.service
systemctl enable httpd.service</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.971.1">
      Leave other
     </span>
     <a id="_idIndexMarker672">
     </a>
     <span class="koboSpan" id="kobo.972.1">
      values and selections as-is and click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.973.1">
       Launch instance
      </span>
     </strong>
     <span class="koboSpan" id="kobo.974.1">
      .
     </span>
     <span class="koboSpan" id="kobo.974.2">
      Once the instance is launched successfully, go to the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.975.1">
       Instances
      </span>
     </strong>
     <span class="koboSpan" id="kobo.976.1">
      page, select our new EC2 instance, and explore
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.977.1">
       its parameters.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.978.1">
      Copy either the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.979.1">
       Public IPv4 DNS
      </span>
     </strong>
     <span class="koboSpan" id="kobo.980.1">
      or the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.981.1">
       Public IPv4
      </span>
     </strong>
     <span class="koboSpan" id="kobo.982.1">
      address, open it from a browser tab, and use
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.983.1">
       http
      </span>
     </strong>
     <span class="koboSpan" id="kobo.984.1">
      instead of
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.985.1">
       https
      </span>
     </strong>
     <span class="koboSpan" id="kobo.986.1">
      .
     </span>
     <span class="koboSpan" id="kobo.986.2">
      We should see our web server’s
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.987.1">
       index.html page.
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer142">
     <span class="koboSpan" id="kobo.988.1">
      <img alt="Figure 5.11 – The web server’s index.html page from a browser" src="image/B21384_05_11.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.989.1">
     Figure 5.11 – The web server’s index.html page from a browser
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.990.1">
     In this section, we created a simple web server and accessed the web page from the internet using HTTP.
    </span>
    <span class="koboSpan" id="kobo.990.2">
     It is listed as
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.991.1">
      Not Secure
     </span>
    </strong>
    <span class="koboSpan" id="kobo.992.1">
     since we are using HTTP and not HTTPS.
    </span>
    <span class="koboSpan" id="kobo.992.2">
     If we try to run the URL with HTTPS, it will give a response similar
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.993.1">
      to this:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer143">
     <span class="koboSpan" id="kobo.994.1">
      <img alt="Figure 5.12 – No HTTPS website" src="image/B21384_05_12.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.995.1">
     Figure 5.12 – No HTTPS website
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.996.1">
     In the next section, we
    </span>
    <a id="_idIndexMarker673">
    </a>
    <span class="koboSpan" id="kobo.997.1">
     will connect to the instance using SSH, and in
    </span>
    <a href="B21384_06.xhtml#_idTextAnchor220">
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.998.1">
        Chapter 6
       </span>
      </em>
     </span>
    </a>
    <span class="koboSpan" id="kobo.999.1">
     , we will enable HTTPS on
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1000.1">
      this machine.
     </span>
    </span>
   </p>
   <h3>
    <span class="koboSpan" id="kobo.1001.1">
     Connecting to EC2 instance using SSH
    </span>
   </h3>
   <p>
    <span class="koboSpan" id="kobo.1002.1">
     We can
    </span>
    <a id="_idIndexMarker674">
    </a>
    <span class="koboSpan" id="kobo.1003.1">
     connect to
    </span>
    <a id="_idIndexMarker675">
    </a>
    <span class="koboSpan" id="kobo.1004.1">
     the EC2 instance over SSH
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1005.1">
      as follows:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.1006.1">
      Go to the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1007.1">
       Instances
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1008.1">
      page in the
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1009.1">
        EC2
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1010.1">
       dashboard.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1011.1">
      Select our instance and, from the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1012.1">
       Actions
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1013.1">
      drop-down menu, click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1014.1">
       Connect
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1015.1">
      .
     </span>
     <span class="koboSpan" id="kobo.1015.2">
      This will give us ways to connect to an EC2 instance such as
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1016.1">
       EC2 Instance Connect
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1017.1">
      ,
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1018.1">
       Session Manager
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1019.1">
      ,
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1020.1">
       SSH client
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1021.1">
      , and
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1022.1">
       EC2
      </span>
     </strong>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1023.1">
        serial console
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1024.1">
       .
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer144">
     <span class="koboSpan" id="kobo.1025.1">
      <img alt="Figure 5.13 – The Connect to instance options" src="image/B21384_05_13.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.1026.1">
     Figure 5.13 – The Connect to instance options
    </span>
   </p>
   <ol>
    <li value="3">
     <span class="koboSpan" id="kobo.1027.1">
      Go to
     </span>
     <a id="_idIndexMarker676">
     </a>
     <span class="koboSpan" id="kobo.1028.1">
      the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1029.1">
       SSH client
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1030.1">
      tab.
     </span>
     <span class="koboSpan" id="kobo.1030.2">
      We should see the steps
     </span>
     <a id="_idIndexMarker677">
     </a>
     <span class="koboSpan" id="kobo.1031.1">
      to connect to our instance using SSH, as shown in the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1032.1">
       following figure:
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer145">
     <span class="koboSpan" id="kobo.1033.1">
      <img alt="Figure 5.14 – Connecting to an instance with the SSH client" src="image/B21384_05_14.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.1034.1">
     Figure 5.14 – Connecting to an instance with the SSH client
    </span>
   </p>
   <ol>
    <li value="4">
     <span class="koboSpan" id="kobo.1035.1">
      We can follow the
     </span>
     <a id="_idIndexMarker678">
     </a>
     <span class="koboSpan" id="kobo.1036.1">
      given steps and connect to
     </span>
     <a id="_idIndexMarker679">
     </a>
     <span class="koboSpan" id="kobo.1037.1">
      our EC2 instance.
     </span>
     <span class="koboSpan" id="kobo.1037.2">
      If we are connecting to the instance for the first time, we will get a confirmation message to trust the site and continue connecting.
     </span>
     <span class="koboSpan" id="kobo.1037.3">
      Enter
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1038.1">
       yes
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1039.1">
      for
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1040.1">
       the same:
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer146">
     <span class="koboSpan" id="kobo.1041.1">
      <img alt="Figure 5.15 – Connecting to the instance with SSH" src="image/B21384_05_15.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.1042.1">
     Figure 5.15 – Connecting to the instance with SSH
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1043.1">
     We connected to our
    </span>
    <a id="_idIndexMarker680">
    </a>
    <span class="koboSpan" id="kobo.1044.1">
     instance using SSH.
    </span>
    <span class="koboSpan" id="kobo.1044.2">
     It is worth noting that
    </span>
    <a id="_idIndexMarker681">
    </a>
    <span class="koboSpan" id="kobo.1045.1">
     there are a few other options available, such as EC2 Instance Connect, Session Manager, and EC2 serial console, as we saw in
    </span>
    <span class="No-Break">
     <em class="italic">
      <span class="koboSpan" id="kobo.1046.1">
       Figure 5
      </span>
     </em>
    </span>
    <span class="No-Break">
     <em class="italic">
      <span class="koboSpan" id="kobo.1047.1">
       .13
      </span>
     </em>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1048.1">
      .
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-183">
    <a id="_idTextAnchor187">
    </a>
    <span class="koboSpan" id="kobo.1049.1">
     How it works...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1050.1">
     First, we set up a web server using EC2 user data.
    </span>
    <span class="koboSpan" id="kobo.1050.2">
     The EC2 user data feature allows us to configure a set of scripts or commands that will be run only once when the instance first starts.
    </span>
    <span class="koboSpan" id="kobo.1050.3">
     This capability is helpful for installing software, updating the system, downloading files, or configuring settings to match specific requirements.
    </span>
    <span class="koboSpan" id="kobo.1050.4">
     The user data script is injected into the instance before it is even booted, making it an efficient method to bootstrap the instance with all the necessary configurations and software.
    </span>
    <span class="koboSpan" id="kobo.1050.5">
     This helps to ensure that the instance is fully prepared for its role, whether it be a web server, database, or any other service, from the moment it becomes operational.
    </span>
    <span class="koboSpan" id="kobo.1050.6">
     This feature significantly streamlines the deployment process, eliminating the need for manual setup and allowing for more agile and scalable cloud
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1051.1">
      architecture designs.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1052.1">
     We also connected to our instance using SSH.
    </span>
    <span class="koboSpan" id="kobo.1052.2">
     SSH is a cryptographic network protocol employed for secure communication between a client and a server over an unsecured network.
    </span>
    <span class="koboSpan" id="kobo.1052.3">
     It’s widely used for a variety of network services, with the most common being remote command-line login and execution.
    </span>
    <span class="koboSpan" id="kobo.1052.4">
     SSH provides a secure channel over an unsecured network, encrypting the data exchanged to prevent unauthorized access, eavesdropping, and hijacking.
    </span>
    <span class="koboSpan" id="kobo.1052.5">
     Aside from its primary function of secure remote administration, SSH also supports tunneling, forwarding
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1053.1">
      Transmission Control Protocol
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1054.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1055.1">
      TCP
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1056.1">
     ) ports, and
    </span>
    <a id="_idIndexMarker682">
    </a>
    <span class="koboSpan" id="kobo.1057.1">
     transferring files using associated protocols such as SFTP or SCP.
    </span>
    <span class="koboSpan" id="kobo.1057.2">
     Its versatility and security features make SSH an essential tool for managing servers, configuring networks, and securely transferring data across
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1058.1">
      the internet.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-184">
    <a id="_idTextAnchor188">
    </a>
    <span class="koboSpan" id="kobo.1059.1">
     There’s more...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1060.1">
     We connected to our instance using SSH.
    </span>
    <span class="koboSpan" id="kobo.1060.2">
     AWS also provides a few alternatives to connect to our instance, as we saw in
    </span>
    <span class="No-Break">
     <em class="italic">
      <span class="koboSpan" id="kobo.1061.1">
       Figure 5
      </span>
     </em>
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.1062.1">
      .14
     </span>
    </em>
    <span class="koboSpan" id="kobo.1063.1">
     .
    </span>
    <span class="koboSpan" id="kobo.1063.2">
     Let us quickly
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1064.1">
      explore them.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1065.1">
     EC2 Instance Connect
    </span>
    <a id="_idIndexMarker683">
    </a>
    <span class="koboSpan" id="kobo.1066.1">
     provides a simple and secure way to connect to your instances using SSH directly from the AWS Management Console.
    </span>
    <span class="koboSpan" id="kobo.1066.2">
     Unlike traditional SSH, which requires you to manage SSH keys, Instance Connect handles key management for you, generating a one-time-use SSH key for each connection session.
    </span>
    <span class="koboSpan" id="kobo.1066.3">
     This method enhances security by avoiding the need to share and manage SSH keys manually and provides an easy way to control access through AWS
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1067.1">
      IAM policies.
     </span>
    </span>
   </p>
   <p>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1068.1">
      AWS Systems Manager Session Manager
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1069.1">
     is a
    </span>
    <a id="_idIndexMarker684">
    </a>
    <span class="koboSpan" id="kobo.1070.1">
     feature of AWS Systems Manager that lets you manage your EC2 instances through an interactive shell or automation scripts without needing to open inbound ports, set up a bastion host, or manage SSH keys.
    </span>
    <span class="koboSpan" id="kobo.1070.2">
     It provides secure, auditable instance management without the complexity of traditional access methods.
    </span>
    <span class="koboSpan" id="kobo.1070.3">
     Session Manager sessions are encrypted and can be logged and audited, making it an ideal choice for enterprises concerned with security and compliance.
    </span>
    <span class="koboSpan" id="kobo.1070.4">
     It also integrates with AWS IAM for
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1071.1">
      access control.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1072.1">
     The EC2 serial console allows you to troubleshoot boot and network connectivity issues by providing secure, serial access to your EC2 instances.
    </span>
    <span class="koboSpan" id="kobo.1072.2">
     This is particularly useful when you cannot connect to your instance using SSH or RDP.
    </span>
    <span class="koboSpan" id="kobo.1072.3">
     Access to the serial console does not require network connectivity, making it an invaluable tool for resolving issues that prevent an instance from starting up correctly.
    </span>
    <span class="koboSpan" id="kobo.1072.4">
     Access to the EC2 serial console is controlled through IAM policies, ensuring that only authorized users can use
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1073.1">
      this feature.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1074.1">
     Each of these connection methods serves different use cases, from simplifying SSH key management with EC2 Instance Connect, offering secure and auditable access with Session Manager, to providing a last-resort troubleshooting tool with the EC2 Serial Console.
    </span>
    <span class="koboSpan" id="kobo.1074.2">
     Depending on our security requirements, operational practices, and troubleshooting needs, we can choose the method that best fits
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1075.1">
      our scenario.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-185">
    <a id="_idTextAnchor189">
    </a>
    <span class="koboSpan" id="kobo.1076.1">
     See also
    </span>
   </h2>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.1077.1">
      Read more about the different ways
     </span>
     <a id="_idIndexMarker685">
     </a>
     <span class="koboSpan" id="kobo.1078.1">
      to connect to an EC2 instance
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1079.1">
       at
      </span>
     </span>
     <a href="https://www.cloudericks.com/blog/different-ways-to-connect-to-ec2-instances-in-aws">
      <span class="No-Break">
       <span class="koboSpan" id="kobo.1080.1">
        https://www.cloudericks.com/blog/different-ways-to-connect-to-ec2-instances-in-aws
       </span>
      </span>
     </a>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1081.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1082.1">
      We can further increase EC2 security by encrypting
     </span>
     <a id="_idIndexMarker686">
     </a>
     <span class="koboSpan" id="kobo.1083.1">
      the EBS instance following the steps available
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1084.1">
       at
      </span>
     </span>
     <a href="https://www.cloudericks.com/blog/steps-to-encrypt-ebs-data-with-aws-kms">
      <span class="No-Break">
       <span class="koboSpan" id="kobo.1085.1">
        https://www.cloudericks.com/blog/steps-to-encrypt-ebs-data-with-aws-kms
       </span>
      </span>
     </a>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1086.1">
       .
      </span>
     </span>
    </li>
   </ul>
   <h1 id="_idParaDest-186">
    <a id="_idTextAnchor190">
    </a>
    <span class="koboSpan" id="kobo.1087.1">
     Creating and configuring security groups
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.1088.1">
     In this recipe, we will learn how to create a security group from the VPC dashboard.
    </span>
    <span class="koboSpan" id="kobo.1088.2">
     Similar steps can be followed to create a security group from the EC2 dashboard.
    </span>
    <span class="koboSpan" id="kobo.1088.3">
     We can also create a
    </span>
    <a id="_idIndexMarker687">
    </a>
    <span class="koboSpan" id="kobo.1089.1">
     security group while launching an
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1090.1">
      EC2 instance.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-187">
    <a id="_idTextAnchor191">
    </a>
    <span class="koboSpan" id="kobo.1091.1">
     Getting ready
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1092.1">
     To complete the steps within this recipe, we need the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1093.1">
      following configurations:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.1094.1">
      A working AWS account is essential.
     </span>
     <span class="koboSpan" id="kobo.1094.2">
      I will be using the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1095.1">
       awsseccb-sandbox-1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1096.1">
      account that we created in
     </span>
     <a href="B21384_01.xhtml#_idTextAnchor020">
      <span class="No-Break">
       <em class="italic">
        <span class="koboSpan" id="kobo.1097.1">
         Chapter 1
        </span>
       </em>
      </span>
     </a>
     <span class="koboSpan" id="kobo.1098.1">
      .
     </span>
     <span class="koboSpan" id="kobo.1098.2">
      However, I will not be using any features of the AWS Organizations or the IAM
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1099.1">
       Identity Center.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1100.1">
      We need to create a VPC and a public subnet under that.
     </span>
     <span class="koboSpan" id="kobo.1100.2">
      We can create a VPC and subnet by following the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.1101.1">
       Creating a bare VPC and setting up public and private subnets
      </span>
     </em>
     <span class="koboSpan" id="kobo.1102.1">
      recipe from
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1103.1">
       this chapter.
      </span>
     </span>
    </li>
   </ul>
   <h2 id="_idParaDest-188">
    <a id="_idTextAnchor192">
    </a>
    <span class="koboSpan" id="kobo.1104.1">
     How to do it...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1105.1">
     We can create a security group from the VPC dashboard
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1106.1">
      as follows:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.1107.1">
      Go to the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1108.1">
       VPC dashboard.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1109.1">
      On the left sidebar under
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1110.1">
       Security
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1111.1">
      , click on
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1112.1">
        Security groups
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1113.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1114.1">
      On the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1115.1">
       Security Groups
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1116.1">
      page, click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1117.1">
       Create
      </span>
     </strong>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1118.1">
        security group
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1119.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1120.1">
      Provide
     </span>
     <a id="_idIndexMarker688">
     </a>
     <span class="koboSpan" id="kobo.1121.1">
      values for
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1122.1">
       Security group name
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1123.1">
      and
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1124.1">
       Description
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1125.1">
      ; select
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1126.1">
       our VPC.
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer147">
     <span class="koboSpan" id="kobo.1127.1">
      <img alt="Figure 5.16 – Creating a security group" src="image/B21384_05_16.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.1128.1">
     Figure 5.16 – Creating a security group
    </span>
   </p>
   <ol>
    <li value="5">
     <span class="koboSpan" id="kobo.1129.1">
      Under
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1130.1">
       Inbound rules
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1131.1">
      on the same page, we need to add the rules
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1132.1">
       that follow:
      </span>
     </span>
     <ol>
      <li class="upper-roman">
       <span class="koboSpan" id="kobo.1133.1">
        Click on
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.1134.1">
         Add rule
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1135.1">
        .
       </span>
       <span class="koboSpan" id="kobo.1135.2">
        Set
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.1136.1">
         Type
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1137.1">
        to
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.1138.1">
         HTTP
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1139.1">
        ,
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.1140.1">
         Source type
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1141.1">
        to
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.1142.1">
         Anywhere-IPv4
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1143.1">
        , and
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.1144.1">
         Source
        </span>
       </strong>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.1145.1">
         to
        </span>
       </span>
       <span class="No-Break">
        <strong class="source-inline">
         <span class="koboSpan" id="kobo.1146.1">
          0.0.0.0/0
         </span>
        </strong>
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.1147.1">
         .
        </span>
       </span>
      </li>
      <li class="upper-roman">
       <span class="koboSpan" id="kobo.1148.1">
        Click
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.1149.1">
         Add rule
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1150.1">
        .
       </span>
       <span class="koboSpan" id="kobo.1150.2">
        Set
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.1151.1">
         Type
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1152.1">
        to
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.1153.1">
         HTTPS
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1154.1">
        ,
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.1155.1">
         Source type
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1156.1">
        to
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.1157.1">
         Anywhere-IPv4
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1158.1">
        , and
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.1159.1">
         Source
        </span>
       </strong>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.1160.1">
         to
        </span>
       </span>
       <span class="No-Break">
        <strong class="source-inline">
         <span class="koboSpan" id="kobo.1161.1">
          0.0.0.0/0
         </span>
        </strong>
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.1162.1">
         .
        </span>
       </span>
      </li>
      <li class="upper-roman">
       <span class="koboSpan" id="kobo.1163.1">
        Click
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.1164.1">
         Add rule
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1165.1">
        .
       </span>
       <span class="koboSpan" id="kobo.1165.2">
        Set
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.1166.1">
         Type
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1167.1">
        to
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.1168.1">
         SSH
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1169.1">
        and
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.1170.1">
         Source type
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1171.1">
        to
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.1172.1">
         My IP
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1173.1">
        .
       </span>
       <span class="koboSpan" id="kobo.1173.2">
        Our IP address should be populated
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.1174.1">
         under
        </span>
       </span>
       <span class="No-Break">
        <strong class="bold">
         <span class="koboSpan" id="kobo.1175.1">
          Source
         </span>
        </strong>
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.1176.1">
         .
        </span>
       </span>
      </li>
     </ol>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer148">
     <span class="koboSpan" id="kobo.1177.1">
      <img alt="Figure 5.17 – Setting the inbound rules for the security group" src="image/B21384_05_17.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.1178.1">
     Figure 5.17 – Setting the inbound rules for the security group
    </span>
   </p>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.1179.1">
     Tip
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.1180.1">
     If IPv6 traffic is required, we can also add a CIDR range of
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1181.1">
      : :/0
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1182.1">
     under
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1183.1">
      Source
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1184.1">
     to
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1185.1">
      the rules.
     </span>
    </span>
   </p>
   <ol>
    <li value="6">
     <span class="koboSpan" id="kobo.1186.1">
      Under
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1187.1">
       Outbound rules
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1188.1">
      , we
     </span>
     <a id="_idIndexMarker689">
     </a>
     <span class="koboSpan" id="kobo.1189.1">
      can see a default rule already created
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1190.1">
       as follows:
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer149">
     <span class="koboSpan" id="kobo.1191.1">
      <img alt="Figure 5.18 – The default outbound rule" src="image/B21384_05_18.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.1192.1">
     Figure 5.18 – The default outbound rule
    </span>
   </p>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.1193.1">
     Important Note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.1194.1">
     Default outbound rules for a security group allow all outbound traffic.
    </span>
    <span class="koboSpan" id="kobo.1194.2">
     For added security, we can provide outbound access to only the required protocols, such as HTTP
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1195.1">
      and HTTPS.
     </span>
    </span>
   </p>
   <p class="list-inset">
    <span class="koboSpan" id="kobo.1196.1">
     If we need
    </span>
    <a id="_idIndexMarker690">
    </a>
    <span class="koboSpan" id="kobo.1197.1">
     to change the outbound rules so that we only allow HTTP and HTTPS traffic, edit the default rule on the same page
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1198.1">
      as follows:
     </span>
    </span>
   </p>
   <ol>
    <li class="upper-roman">
     <span class="koboSpan" id="kobo.1199.1">
      Set
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1200.1">
       Type
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1201.1">
      to
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1202.1">
       HTTP
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1203.1">
      ,
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1204.1">
       Destination type
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1205.1">
      to
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1206.1">
       Anywhere-IPv4
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1207.1">
      , and
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1208.1">
       Destination
      </span>
     </strong>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1209.1">
       to
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1210.1">
        0.0.0.0/0
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1211.1">
       .
      </span>
     </span>
    </li>
    <li class="upper-roman">
     <span class="koboSpan" id="kobo.1212.1">
      Click
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1213.1">
       Add rule
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1214.1">
      .
     </span>
     <span class="koboSpan" id="kobo.1214.2">
      Set
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1215.1">
       Type
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1216.1">
      to
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1217.1">
       HTTPS
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1218.1">
      ,
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1219.1">
       Destination type
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1220.1">
      to
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1221.1">
       Anywhere-IPv4
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1222.1">
      , and
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1223.1">
       Destination
      </span>
     </strong>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1224.1">
       to
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1225.1">
        0.0.0.0/0
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1226.1">
       .
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer150">
     <span class="koboSpan" id="kobo.1227.1">
      <img alt="Figure 5.19 – Outbound rules for the security group" src="image/B21384_05_19.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.1228.1">
     Figure 5.19 – Outbound rules for the security group
    </span>
   </p>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.1229.1">
     Tip
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.1230.1">
     If IPv6 traffic is required, we can also add a CIDR range of
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1231.1">
      : :/0
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1232.1">
     under
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1233.1">
      Destination
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1234.1">
     to
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1235.1">
      the rules.
     </span>
    </span>
   </p>
   <ol>
    <li value="7">
     <span class="koboSpan" id="kobo.1236.1">
      Scroll down and click
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1237.1">
       Create
      </span>
     </strong>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1238.1">
        security group
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1239.1">
       .
      </span>
     </span>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.1240.1">
       We should get a success message stating that the security group
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.1241.1">
        was created.
       </span>
      </span>
     </p>
    </li>
   </ol>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.1242.1">
     Important note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.1243.1">
     The exact rules will be different for each recipe.
    </span>
    <span class="koboSpan" id="kobo.1243.2">
     The preceding rules may be used for instances of a public subnet that hosts a web server.
    </span>
    <span class="koboSpan" id="kobo.1243.3">
     We also provided SSH access to our local IP; however, in most projects, we would give SSH access to a dedicated machine, referred to as a jump host or a
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1244.1">
      bastion host.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-189">
    <a id="_idTextAnchor193">
    </a>
    <span class="koboSpan" id="kobo.1245.1">
     How it works...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1246.1">
     In this recipe, we
    </span>
    <a id="_idIndexMarker691">
    </a>
    <span class="koboSpan" id="kobo.1247.1">
     created and configured a security group with inbound and outbound rules that are applicable to an EC2 instance in a public subnet running a web server.
    </span>
    <span class="koboSpan" id="kobo.1247.2">
     We will use these steps to create security groups in other recipes.
    </span>
    <span class="koboSpan" id="kobo.1247.3">
     The exact rules may differ based on the use case.
    </span>
    <span class="koboSpan" id="kobo.1247.4">
     Instead of providing the CIDR range, we can also specify another security group in a rule to say that only instances with that security group should
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1248.1">
      be allowed.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1249.1">
     In the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.1250.1">
      Working with NACLs
     </span>
    </em>
    <span class="koboSpan" id="kobo.1251.1">
     recipe later in this chapter, we will explicitly allow the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1252.1">
      1024
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1253.1">
     –
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1254.1">
      65535
     </span>
    </strong>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1255.1">
      ephemeral port
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1256.1">
     range
    </span>
    <a id="_idIndexMarker692">
    </a>
    <span class="koboSpan" id="kobo.1257.1">
     for outbound requests.
    </span>
    <span class="koboSpan" id="kobo.1257.2">
     This isn’t needed for security groups since security groups are stateful.
    </span>
    <span class="koboSpan" id="kobo.1257.3">
     If an outbound port is opened, the response for a request going through that port is also allowed, irrespective of the inbound rules.
    </span>
    <span class="koboSpan" id="kobo.1257.4">
     Similarly, if an inbound port is opened, the response for a request coming through that port is also allowed, irrespective of the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1258.1">
      outbound rules.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-190">
    <a id="_idTextAnchor194">
    </a>
    <span class="koboSpan" id="kobo.1259.1">
     There’s more...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1260.1">
     We created security groups from the VPC dashboard.
    </span>
    <span class="koboSpan" id="kobo.1260.2">
     We can also create them from the EC2 dashboard.
    </span>
    <span class="koboSpan" id="kobo.1260.3">
     Refer to the links within the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.1261.1">
      See also
     </span>
    </em>
    <span class="koboSpan" id="kobo.1262.1">
     section of this recipe for
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1263.1">
      more details.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1264.1">
     Let’s quickly go through some important concepts related to
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1265.1">
      security groups:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.1266.1">
      Security groups do not span
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1267.1">
       across VPCs.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1268.1">
      We can create security groups from the EC2 launch wizard, EC2 dashboard, or
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1269.1">
       VPC dashboard.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1270.1">
      Security groups are stateful,
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1271.1">
       unlike NACLs.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1272.1">
      It is good practice to have multiple security groups based on usage.
     </span>
     <span class="koboSpan" id="kobo.1272.2">
      For example, we can create separate security groups: one for SSH and one for application-specific ports.
     </span>
     <span class="koboSpan" id="kobo.1272.3">
      We can configure the rules for a security group to allow instances from another security group instead of providing a CIDR.
     </span>
     <span class="koboSpan" id="kobo.1272.4">
      We can also specify our own security group to allow only instances within the same security group to talk to
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1273.1">
       each other.
      </span>
     </span>
    </li>
   </ul>
   <h2 id="_idParaDest-191">
    <a id="_idTextAnchor195">
    </a>
    <span class="koboSpan" id="kobo.1274.1">
     See also
    </span>
   </h2>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.1275.1">
      Read more about security groups in AWS
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1276.1">
       at
      </span>
     </span>
     <a href="https://www.cloudericks.com/blog/understanding-security-groups-in-aws">
      <span class="No-Break">
       <span class="koboSpan" id="kobo.1277.1">
        https://www.cloudericks.com/blog/understanding-security-groups-in-aws
       </span>
      </span>
     </a>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1278.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1279.1">
      A rules reference for security groups can be found
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1280.1">
       at
      </span>
     </span>
     <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/security-group-rules-reference.html">
      <span class="No-Break">
       <span class="koboSpan" id="kobo.1281.1">
        https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/security-group-rules-reference.html
       </span>
      </span>
     </a>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1282.1">
       .
      </span>
     </span>
    </li>
   </ul>
   <h1 id="_idParaDest-192">
    <a id="_idTextAnchor196">
    </a>
    <span class="koboSpan" id="kobo.1283.1">
     Working with NACLs
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.1284.1">
     In this recipe, we
    </span>
    <a id="_idIndexMarker693">
    </a>
    <span class="koboSpan" id="kobo.1285.1">
     will create a new NACL with no SSH support and associate one of our subnets with that NACL.
    </span>
    <span class="koboSpan" id="kobo.1285.2">
     By doing this, we will see that we cannot do SSH into EC2 instances within that subnet.
    </span>
    <span class="koboSpan" id="kobo.1285.3">
     After, we will add SSH support to the NACL and try to
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1286.1">
      SSH again.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-193">
    <a id="_idTextAnchor197">
    </a>
    <span class="koboSpan" id="kobo.1287.1">
     Getting ready
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1288.1">
     To complete the steps within this recipe, we need
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1289.1">
      the following:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.1290.1">
      We need to create a VPC and a public subnet under that.
     </span>
     <span class="koboSpan" id="kobo.1290.2">
      We can create a VPC and subnet by following the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.1291.1">
       Creating a bare VPC and setting up public and private subnets
      </span>
     </em>
     <span class="koboSpan" id="kobo.1292.1">
      recipe from
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1293.1">
       this chapter.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1294.1">
      We need to create a security group for our instance; this security group should allow inbound traffic for SSH.
     </span>
     <span class="koboSpan" id="kobo.1294.2">
      We can do this by referring to the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.1295.1">
       Creating and configuring security groups
      </span>
     </em>
     <span class="koboSpan" id="kobo.1296.1">
      recipe in
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1297.1">
       this chapter.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1298.1">
      We need an EC2 instance launched into a public subnet; we can do this by referring to the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.1299.1">
       Launching an EC2 instance with a web server using user data
      </span>
     </em>
     <span class="koboSpan" id="kobo.1300.1">
      recipe in
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1301.1">
       this chapter.
      </span>
     </span>
    </li>
   </ul>
   <h2 id="_idParaDest-194">
    <a id="_idTextAnchor198">
    </a>
    <span class="koboSpan" id="kobo.1302.1">
     How to do it...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1303.1">
     We can
    </span>
    <a id="_idIndexMarker694">
    </a>
    <span class="koboSpan" id="kobo.1304.1">
     create an NACL with no SSH permission
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1305.1">
      as follows:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.1306.1">
      Go to the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1307.1">
       VPC
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1308.1">
      service in
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1309.1">
       the console.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1310.1">
      Click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1311.1">
       Network ACLs
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1312.1">
      on the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1313.1">
       left sidebar.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1314.1">
      Click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1315.1">
       Create network ACL
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1316.1">
      at the top of
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1317.1">
       the page.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1318.1">
      In
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1319.1">
       Create network ACL
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1320.1">
      under
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1321.1">
       Network ACL settings
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1322.1">
      , provide a name and select the VPC we created in the previous section from the dropdown for the
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1323.1">
        VPC
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1324.1">
       field.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1325.1">
      Click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1326.1">
       Create network ACL
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1327.1">
      to create the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1328.1">
       network ACL.
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer151">
     <span class="koboSpan" id="kobo.1329.1">
      <img alt="Figure 5.20 – Creating a network ACL" src="image/B21384_05_20.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.1330.1">
     Figure 5.20 – Creating a network ACL
    </span>
   </p>
   <p class="list-inset">
    <span class="koboSpan" id="kobo.1331.1">
     If we go to the NACL list, we will see that our new NACL doesn’t have any subnets associated
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1332.1">
      with it.
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer152">
     <span class="koboSpan" id="kobo.1333.1">
      <img alt="Figure 5.21 – A new NACL is created without any associated subnets" src="image/B21384_05_21.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.1334.1">
     Figure 5.21 – A new NACL is created without any associated subnets
    </span>
   </p>
   <ol>
    <li value="6">
     <span class="koboSpan" id="kobo.1335.1">
      Select our
     </span>
     <a id="_idIndexMarker695">
     </a>
     <span class="koboSpan" id="kobo.1336.1">
      new NACL, scroll down, and verify the inbound and outbound rules of the new NACL from its
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1337.1">
       Inbound Rules
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1338.1">
      and
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1339.1">
       Outbound Rules
      </span>
     </strong>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1340.1">
       tabs, respectively.
      </span>
     </span>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.1341.1">
       The inbound rules should be
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.1342.1">
        as follows:
       </span>
      </span>
     </p>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer153">
     <span class="koboSpan" id="kobo.1343.1">
      <img alt="Figure 5.22 – The inbound rules for the new NACL created" src="image/B21384_05_22.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.1344.1">
     Figure 5.22 – The inbound rules for the new NACL created
    </span>
   </p>
   <p class="list-inset">
    <span class="koboSpan" id="kobo.1345.1">
     The outbound rules should be
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1346.1">
      as follows:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer154">
     <span class="koboSpan" id="kobo.1347.1">
      <img alt="Figure 5.23 – The outbound rules for the new NACL created" src="image/B21384_05_23.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.1348.1">
     Figure 5.23 – The outbound rules for the new NACL created
    </span>
   </p>
   <ol>
    <li value="7">
     <span class="koboSpan" id="kobo.1349.1">
      Click on the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1350.1">
       Subnet
      </span>
     </strong>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1351.1">
        associations
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1352.1">
       tab.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1353.1">
      Click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1354.1">
       Edit
      </span>
     </strong>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1355.1">
        subnet associations
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1356.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1357.1">
      Select the subnet we created (
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1358.1">
       AWSPublicSubnet
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1359.1">
      ) and click
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1360.1">
        Save changes
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1361.1">
       .
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer155">
     <span class="koboSpan" id="kobo.1362.1">
      <img alt="Figure 5.24 – Associating subnets" src="image/B21384_05_24.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.1363.1">
     Figure 5.24 – Associating subnets
    </span>
   </p>
   <p class="list-inset">
    <span class="koboSpan" id="kobo.1364.1">
     Select our new
    </span>
    <a id="_idIndexMarker696">
    </a>
    <span class="koboSpan" id="kobo.1365.1">
     network ACL and check its subnet associations.
    </span>
    <span class="koboSpan" id="kobo.1365.2">
     Our public subnet should now be associated
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1366.1">
      with it.
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer156">
     <span class="koboSpan" id="kobo.1367.1">
      <img alt="Figure 5.25 – The NACL with the associated subnets" src="image/B21384_05_25.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.1368.1">
     Figure 5.25 – The NACL with the associated subnets
    </span>
   </p>
   <ol>
    <li value="10">
     <span class="koboSpan" id="kobo.1369.1">
      Try to SSH into our public EC2 instance.
     </span>
     <span class="koboSpan" id="kobo.1369.2">
      Run the command that follows in
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1370.1">
       the CLI:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1371.1">ssh -i "&lt;key path&gt;" &lt;EC2 user name@the public ip&gt;</span></strong></pre>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.1372.1">
       The
      </span>
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1373.1">
        &lt;key path&gt;
       </span>
      </strong>
      <span class="koboSpan" id="kobo.1374.1">
       path is the path to the key pair that you had downloaded as part of the
      </span>
      <em class="italic">
       <span class="koboSpan" id="kobo.1375.1">
        Launching an EC2 instance with a web server using user data
       </span>
      </em>
      <span class="koboSpan" id="kobo.1376.1">
       recipe mentioned in the
      </span>
      <em class="italic">
       <span class="koboSpan" id="kobo.1377.1">
        Getting ready
       </span>
      </em>
      <span class="koboSpan" id="kobo.1378.1">
       section of this recipe.
      </span>
      <span class="koboSpan" id="kobo.1378.2">
       For
      </span>
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1379.1">
        &lt;EC2 user name@the public ip&gt;
       </span>
      </strong>
      <span class="koboSpan" id="kobo.1380.1">
       , go to
      </span>
      <strong class="bold">
       <span class="koboSpan" id="kobo.1381.1">
        Instances
       </span>
      </strong>
      <span class="koboSpan" id="kobo.1382.1">
       , select the EC2 instance we created, and click on
      </span>
      <strong class="bold">
       <span class="koboSpan" id="kobo.1383.1">
        Connect
       </span>
      </strong>
      <span class="koboSpan" id="kobo.1384.1">
       .
      </span>
      <span class="koboSpan" id="kobo.1384.2">
       Click on the
      </span>
      <strong class="bold">
       <span class="koboSpan" id="kobo.1385.1">
        SSH client
       </span>
      </strong>
      <span class="koboSpan" id="kobo.1386.1">
       tab.
      </span>
      <span class="koboSpan" id="kobo.1386.2">
       Copy the second part of the
      </span>
      <strong class="bold">
       <span class="koboSpan" id="kobo.1387.1">
        Example
       </span>
      </strong>
      <span class="koboSpan" id="kobo.1388.1">
       command like
      </span>
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1389.1">
        ec2-user@54.198.244.252
       </span>
      </strong>
      <span class="koboSpan" id="kobo.1390.1">
       .
      </span>
      <span class="koboSpan" id="kobo.1390.2">
       It will look similar to
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.1391.1">
        the following:
       </span>
      </span>
     </p>
     <pre class="source-code"><strong class="bold"><span class="koboSpan" id="kobo.1392.1">ssh -i "C:\Users\DELL\Downloads\awsdemo.pem" ec2-user@35.174.184.142</span></strong></pre>
    </li>
   </ol>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.1393.1">
     Tip
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.1394.1">
     If we are using AWS CloudShell, we can use the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1395.1">
      Example
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1396.1">
     command from the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1397.1">
      SSH client
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1398.1">
     tab without any modification.
    </span>
    <span class="koboSpan" id="kobo.1398.2">
     It will look similar to
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1399.1">
      ssh -i "awsdemo.pem" ec2-user@35.174.184.142
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1400.1">
     .
    </span>
    <span class="koboSpan" id="kobo.1400.2">
     Make sure to upload the key pair file before running
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1401.1">
      the command.
     </span>
    </span>
   </p>
   <p class="list-inset">
    <span class="koboSpan" id="kobo.1402.1">
     The exact
    </span>
    <a id="_idIndexMarker697">
    </a>
    <span class="koboSpan" id="kobo.1403.1">
     command or steps may differ between operating systems.
    </span>
    <span class="koboSpan" id="kobo.1403.2">
     On Windows, macOS, and most Linux systems, we can use the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1404.1">
      SSH command.
     </span>
    </span>
   </p>
   <p class="list-inset">
    <span class="koboSpan" id="kobo.1405.1">
     The operation should time out, as shown in the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1406.1">
      following screenshot:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer157">
     <span class="koboSpan" id="kobo.1407.1">
      <img alt="Figure 5.26 – A connection time-out response without SSL" src="image/B21384_05_26.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.1408.1">
     Figure 5.26 – A connection time-out response without SSL
    </span>
   </p>
   <ol>
    <li value="11">
     <span class="koboSpan" id="kobo.1409.1">
      Now, we can add SSH support to our NACL
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1410.1">
       as follows:
      </span>
     </span>
     <ol>
      <li class="upper-roman">
       <span class="koboSpan" id="kobo.1411.1">
        Go back to the VPC dashboard, click on
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.1412.1">
         Network ACLs
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1413.1">
        from the left sidebar, and select
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.1414.1">
         our NACL.
        </span>
       </span>
      </li>
      <li class="upper-roman">
       <span class="koboSpan" id="kobo.1415.1">
        Click on
       </span>
       <span class="No-Break">
        <strong class="bold">
         <span class="koboSpan" id="kobo.1416.1">
          Inbound rules
         </span>
        </strong>
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.1417.1">
         .
        </span>
       </span>
      </li>
      <li class="upper-roman">
       <span class="koboSpan" id="kobo.1418.1">
        Click on
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.1419.1">
         Edit
        </span>
       </strong>
       <span class="No-Break">
        <strong class="bold">
         <span class="koboSpan" id="kobo.1420.1">
          inbound rules
         </span>
        </strong>
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.1421.1">
         .
        </span>
       </span>
      </li>
      <li class="upper-roman">
       <span class="koboSpan" id="kobo.1422.1">
        Click on
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.1423.1">
         Add
        </span>
       </strong>
       <span class="No-Break">
        <strong class="bold">
         <span class="koboSpan" id="kobo.1424.1">
          new rule
         </span>
        </strong>
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.1425.1">
         .
        </span>
       </span>
      </li>
      <li class="upper-roman">
       <span class="koboSpan" id="kobo.1426.1">
        Enter
       </span>
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.1427.1">
         100
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1428.1">
        under
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.1429.1">
         Rule number
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1430.1">
        , select
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.1431.1">
         SSH (22)
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1432.1">
        under
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.1433.1">
         Type
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1434.1">
        , leave the source as
       </span>
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.1435.1">
         0.0.0.0/0
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1436.1">
        , set
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.1437.1">
         Allow/Deny
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1438.1">
        to
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.1439.1">
         Allow
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1440.1">
        , and click on
       </span>
       <span class="No-Break">
        <strong class="bold">
         <span class="koboSpan" id="kobo.1441.1">
          Save changes
         </span>
        </strong>
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.1442.1">
         .
        </span>
       </span>
      </li>
     </ol>
    </li>
   </ol>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.1443.1">
     Important note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.1444.1">
     If we try to SSH into the EC2 instance now, the SSH will fail, as we have not enabled the ephemeral ports for
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1445.1">
      outbound traffic.
     </span>
    </span>
   </p>
   <ol>
    <li value="12">
     <span class="koboSpan" id="kobo.1446.1">
      Click on
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1447.1">
        Outbound rules
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1448.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1449.1">
      Click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1450.1">
       Edit
      </span>
     </strong>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1451.1">
        outbound rules
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1452.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1453.1">
      Click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1454.1">
       Add
      </span>
     </strong>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1455.1">
        new rule
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1456.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1457.1">
      Enter
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1458.1">
       100
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1459.1">
      under
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1460.1">
       Rule number
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1461.1">
      , select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1462.1">
       Custom TCP
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1463.1">
      under
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1464.1">
       Type
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1465.1">
      , set
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1466.1">
       Port range
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1467.1">
      to
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1468.1">
       1024 - 65535
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1469.1">
      , set
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1470.1">
       Allow/Deny
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1471.1">
      to
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1472.1">
       Allow
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1473.1">
      , set
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1474.1">
       Destination
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1475.1">
      to
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1476.1">
       0.0.0.0/0
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1477.1">
      , and click on
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1478.1">
        Save changes
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1479.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1480.1">
      Try to SSH into
     </span>
     <a id="_idIndexMarker698">
     </a>
     <span class="koboSpan" id="kobo.1481.1">
      our public EC2 instance.
     </span>
     <span class="koboSpan" id="kobo.1481.2">
      The exact command or steps may differ between operating systems.
     </span>
     <span class="koboSpan" id="kobo.1481.3">
      On Windows, macOS, and most Linux systems, we can use the SSH command
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1482.1">
       that follows:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1483.1">ssh -i "C:\Users\DELL\Downloads\awsdemo.pem" ec2-user@35.174.184.142</span></strong></pre>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.1484.1">
       Now, we should be able to
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.1485.1">
        SSH successfully.
       </span>
      </span>
     </p>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer158">
     <span class="koboSpan" id="kobo.1486.1">
      <img alt="Figure 5.27 – A successful SSH response" src="image/B21384_05_27.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.1487.1">
     Figure 5.27 – A successful SSH response
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1488.1">
     In this recipe, we only added one inbound rule and one outbound rule.
    </span>
    <span class="koboSpan" id="kobo.1488.2">
     We can add more rules
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1489.1">
      as required.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-195">
    <a id="_idTextAnchor199">
    </a>
    <span class="koboSpan" id="kobo.1490.1">
     How it works...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1491.1">
     NACLs allow
    </span>
    <a id="_idIndexMarker699">
    </a>
    <span class="koboSpan" id="kobo.1492.1">
     us to define inbound and outbound rules for the subnets of our VPC.
    </span>
    <span class="koboSpan" id="kobo.1492.2">
     We can explicitly allow or deny traffic through a port, or a range of ports.
    </span>
    <span class="koboSpan" id="kobo.1492.3">
     The default NACL that was created by AWS allows all inbound and outbound traffic.
    </span>
    <span class="koboSpan" id="kobo.1492.4">
     However, by default, a custom NACL denies all inbound and outbound traffic.
    </span>
    <span class="koboSpan" id="kobo.1492.5">
     First, we created a new NACL.
    </span>
    <span class="koboSpan" id="kobo.1492.6">
     Then, we associated our public subnet with that NACL and verified that we could not SSH from our local machine.
    </span>
    <span class="koboSpan" id="kobo.1492.7">
     A new NACL denies inbound and outbound traffic by default.
    </span>
    <span class="koboSpan" id="kobo.1492.8">
     To allow SSH, we added an inbound rule for SSH in our NACL and an outbound rule to allow the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1493.1">
      1024
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1494.1">
     –
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1495.1">
      65535
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1496.1">
     ephemeral
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1497.1">
      port range.
     </span>
    </span>
   </p>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.1498.1">
     Important Note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.1499.1">
     An ephemeral port is a short-lived port for IP communications with transport protocols such as TCP,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1500.1">
      User Datagram Protocol
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1501.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1502.1">
      UDP
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1503.1">
     ),
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1504.1">
      Stream Control Transmission Protocol
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1505.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1506.1">
      SCTP
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1507.1">
     ), and
    </span>
    <a id="_idIndexMarker700">
    </a>
    <span class="koboSpan" id="kobo.1508.1">
     so on.
    </span>
    <span class="koboSpan" id="kobo.1508.2">
     It is usually used for the return traffic from the
    </span>
    <a id="_idIndexMarker701">
    </a>
    <span class="koboSpan" id="kobo.1509.1">
     instance or service we are connecting to.
    </span>
    <span class="koboSpan" id="kobo.1509.2">
     For example, the server accepts SSH traffic on port
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1510.1">
      22
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1511.1">
     and then communicates to the client through one of the ephemeral ports.
    </span>
    <span class="koboSpan" id="kobo.1511.2">
     In this recipe, we added outbound rules that allow the ephemeral port range as suggested by AWS for public-facing instances to cover various
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1512.1">
      client types.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-196">
    <a id="_idTextAnchor200">
    </a>
    <span class="koboSpan" id="kobo.1513.1">
     There’s more...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1514.1">
     Let’s quickly go through some important concepts related to
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1515.1">
      network ACLs:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.1516.1">
      When we create a VPC, a default NACL is created by AWS.
     </span>
     <span class="koboSpan" id="kobo.1516.2">
      The value of the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1517.1">
       Default
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1518.1">
      column will be
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1519.1">
       Yes
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1520.1">
      for the default NACL within the NACL list in
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1521.1">
       our VPC.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1522.1">
      Default NACL allows all inbound and outbound traffic.
     </span>
     <span class="koboSpan" id="kobo.1522.2">
      However, when we create a new custom NACL, all inbound and outbound traffic is denied
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1523.1">
       by default.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1524.1">
      Every subnet needs to be associated with one NACL at a time.
     </span>
     <span class="koboSpan" id="kobo.1524.2">
      By default, a subnet is associated with the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1525.1">
       default NACL.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1526.1">
      One subnet can only be associated with one NACL at a time.
     </span>
     <span class="koboSpan" id="kobo.1526.2">
      When we associate it with a new NACL, the current association will
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1527.1">
       be removed.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1528.1">
      A single NACL
     </span>
     <a id="_idIndexMarker702">
     </a>
     <span class="koboSpan" id="kobo.1529.1">
      can be associated with
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1530.1">
       multiple subnets.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1531.1">
      NACLs contain a numbered set of rules.
     </span>
     <span class="koboSpan" id="kobo.1531.2">
      These rules are evaluated in the order of the rule numbers.
     </span>
     <span class="koboSpan" id="kobo.1531.3">
      If we have an
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1532.1">
       Allow
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1533.1">
      rule before a
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1534.1">
       Deny
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1535.1">
      rule for the same port, access will be allowed for that port.
     </span>
     <span class="koboSpan" id="kobo.1535.2">
      Similarly, if we have a
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1536.1">
       Deny
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1537.1">
      rule before an
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1538.1">
       Allow
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1539.1">
      rule for the same port, access will be denied for that port.
     </span>
     <span class="koboSpan" id="kobo.1539.2">
      AWS recommends using rule numbers in multiples of 100 initially as that will let us add new rules in between
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1540.1">
       if needed.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1541.1">
      We can block specific IP addresses with NACL, but this is not possible with
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1542.1">
       security groups.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1543.1">
      NACLs are evaluated before
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1544.1">
       security groups.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1545.1">
      Security groups are considered stateful, while NACLs are considered stateless.
     </span>
     <span class="koboSpan" id="kobo.1545.2">
      With a security group, if we send a request from the instance, the response is allowed, irrespective of the inbound rules.
     </span>
     <span class="koboSpan" id="kobo.1545.3">
      Similarly, if we allow an inbound request, the corresponding outbound response can go, regardless of the outbound rules.
     </span>
     <span class="koboSpan" id="kobo.1545.4">
      With NACL, we need to allow both inbound and outbound traffic explicitly for
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1546.1">
       any port.
      </span>
     </span>
    </li>
   </ul>
   <h2 id="_idParaDest-197">
    <a id="_idTextAnchor201">
    </a>
    <span class="koboSpan" id="kobo.1547.1">
     See also
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1548.1">
     Read more
    </span>
    <a id="_idIndexMarker703">
    </a>
    <span class="koboSpan" id="kobo.1549.1">
     about NACLs
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1550.1">
      at
     </span>
    </span>
    <a href="https://www.cloudericks.com/blog/understanding-network-acls-in-aws-vpc">
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1551.1">
       https://www.cloudericks.com/blog/understanding-network-acls-in-aws-vpc
      </span>
     </span>
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1552.1">
      .
     </span>
    </span>
   </p>
   <h1 id="_idParaDest-198">
    <a id="_idTextAnchor202">
    </a>
    <span class="koboSpan" id="kobo.1553.1">
     Using a VPC gateway endpoint to connect to S3
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.1554.1">
     In this recipe, we will create a
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1555.1">
      VPC gateway endpoint
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1556.1">
     for S3 and connect to S3 from our private subnet without any
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1557.1">
      internet access.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-199">
    <a id="_idTextAnchor203">
    </a>
    <span class="koboSpan" id="kobo.1558.1">
     Getting ready
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1559.1">
     To complete the
    </span>
    <a id="_idIndexMarker704">
    </a>
    <span class="koboSpan" id="kobo.1560.1">
     steps within this recipe, we need to have the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1561.1">
      following ready:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.1562.1">
      We need a VPC with associated subnets.
     </span>
     <span class="koboSpan" id="kobo.1562.2">
      We can create one by referring to the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.1563.1">
       Creating a bare VPC and setting up public and private subnets
      </span>
     </em>
     <span class="koboSpan" id="kobo.1564.1">
      recipe from
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1565.1">
       this chapter.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1566.1">
      We need to configure a gateway and a route table for internet access.
     </span>
     <span class="koboSpan" id="kobo.1566.2">
      We may refer to the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.1567.1">
       Creating a bare VPC and setting up public and private subnets
      </span>
     </em>
     <span class="koboSpan" id="kobo.1568.1">
      recipe from
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1569.1">
       this chapter.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1570.1">
      Subnets should be associated with the default NACL.
     </span>
     <span class="koboSpan" id="kobo.1570.2">
      Otherwise, we should define proper inbound and outbound rules so that we can log in to the private EC2 instance through the public EC2 instance.
     </span>
     <span class="koboSpan" id="kobo.1570.3">
      We can refer to the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.1571.1">
       Working with NACLs
      </span>
     </em>
     <span class="koboSpan" id="kobo.1572.1">
      recipe from
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1573.1">
       this chapter.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1574.1">
      We need an S3 bucket in any region.
     </span>
     <span class="koboSpan" id="kobo.1574.2">
      I will be
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1575.1">
       using
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1576.1">
        us-east-1
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1577.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1578.1">
      We should have no internet access for the private subnet.
     </span>
     <span class="koboSpan" id="kobo.1578.2">
      Verify this by running
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1579.1">
       aws s3 ls --region us-east-1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1580.1">
      from our private subnet.
     </span>
     <span class="koboSpan" id="kobo.1580.2">
      Our requests should fail with a timeout.
     </span>
     <span class="koboSpan" id="kobo.1580.3">
      If a NAT gateway or a NAT instance has been configured, remove its route from the main
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1581.1">
       route table.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1582.1">
      Associate an IAM role with S3 access to a private
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1583.1">
       EC2 instance.
      </span>
     </span>
    </li>
   </ul>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.1584.1">
     Tip
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.1585.1">
     If you have not configured an IAM role correctly, you might get an error that says
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1586.1">
      Unable to locate credentials
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1587.1">
     .
    </span>
    <span class="koboSpan" id="kobo.1587.2">
     You can configure credentials by running
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1588.1">
      aws configure
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1589.1">
     .
    </span>
    <span class="koboSpan" id="kobo.1589.2">
     Fix the issue and test again
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1590.1">
      before proceeding.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-200">
    <a id="_idTextAnchor204">
    </a>
    <span class="koboSpan" id="kobo.1591.1">
     How to do it...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1592.1">
     We can
    </span>
    <a id="_idIndexMarker705">
    </a>
    <span class="koboSpan" id="kobo.1593.1">
     create a VPC endpoint gateway for S3
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1594.1">
      as follows:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.1595.1">
      Go to the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1596.1">
       VPC
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1597.1">
      service in
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1598.1">
       the console.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1599.1">
      Click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1600.1">
       Endpoints
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1601.1">
      from the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1602.1">
       left sidebar.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1603.1">
      Click on
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1604.1">
        Create endpoint
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1605.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1606.1">
      In the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1607.1">
       Create endpoint
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1608.1">
      pane, under
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1609.1">
       Endpoint settings
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1610.1">
      , enter
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1611.1">
       VPCEndpoint
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1612.1">
      as the value for
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1613.1">
        Name tag
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1614.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1615.1">
      Under
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1616.1">
       Service category
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1617.1">
      , select
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1618.1">
        AWS services
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1619.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1620.1">
      Under
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1621.1">
       Service Name
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1622.1">
      ,
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1623.1">
       select
      </span>
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1624.1">
        com.amazonaws.us-east-1.s3
       </span>
      </strong>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer159">
     <span class="koboSpan" id="kobo.1625.1">
      <img alt="Figure 5.28 – Selecting the service name for endpoint creation" src="image/B21384_05_28.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.1626.1">
     Figure 5.28 – Selecting the service name for endpoint creation
    </span>
   </p>
   <ol>
    <li value="7">
     <span class="koboSpan" id="kobo.1627.1">
      For
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1628.1">
       VPC
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1629.1">
      , select the VPC we created in the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.1630.1">
       Getting
      </span>
     </em>
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.1631.1">
        ready
       </span>
      </em>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1632.1">
       section.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1633.1">
      For
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1634.1">
       Route tables
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1635.1">
      , select the route table we created in the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.1636.1">
       Getting
      </span>
     </em>
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.1637.1">
        ready
       </span>
      </em>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1638.1">
       section.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1639.1">
      Leave the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1640.1">
       Policy
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1641.1">
      field set to
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1642.1">
        Full access
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1643.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1644.1">
      Click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1645.1">
       Create endpoint
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1646.1">
      .
     </span>
     <span class="koboSpan" id="kobo.1646.2">
      We should get a
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1647.1">
       success message.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1648.1">
      Connect to our EC2 instance and try running the following S3 command from the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1649.1">
       private subnet:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1650.1"> aws s3 ls --region us-east-1</span></strong></pre>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer160">
     <span class="koboSpan" id="kobo.1651.1">
      <img alt="Figure 5.29 – A successful response for S3 list operation" src="image/B21384_05_29.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.1652.1">
     Figure 5.29 – A successful response for S3 list operation
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1653.1">
     This should list the S3
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1654.1">
      items successfully.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-201">
    <a id="_idTextAnchor205">
    </a>
    <span class="koboSpan" id="kobo.1655.1">
     How it works...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1656.1">
     VPC endpoints
    </span>
    <a id="_idIndexMarker706">
    </a>
    <span class="koboSpan" id="kobo.1657.1">
     allow us to connect to supported AWS services from our VPC privately.
    </span>
    <span class="koboSpan" id="kobo.1657.2">
     With VPC endpoints, instances in the VPC do not need a public IP address to communicate with supported AWS services.
    </span>
    <span class="koboSpan" id="kobo.1657.3">
     The traffic between our VPC and the supported AWS services does not leave AWS.
    </span>
    <span class="koboSpan" id="kobo.1657.4">
     VPC endpoints can be considered highly available
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1658.1">
      virtual devices.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1659.1">
     In this recipe, we configured a VPC endpoint of the gateway endpoint type to access S3 from our subnet.
    </span>
    <span class="koboSpan" id="kobo.1659.2">
     We removed all public routes from our subnet, and we could still connect to S3.
    </span>
    <span class="koboSpan" id="kobo.1659.3">
     VPC gateway endpoints are also supported
    </span>
    <a id="_idIndexMarker707">
    </a>
    <span class="koboSpan" id="kobo.1660.1">
     by
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1661.1">
      DynamoDB
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1662.1">
     and work similarly to a VPC gateway.
    </span>
    <span class="koboSpan" id="kobo.1662.2">
     For most other services, VPC endpoints are supported through
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1663.1">
      interface endpoints.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-202">
    <a id="_idTextAnchor206">
    </a>
    <span class="koboSpan" id="kobo.1664.1">
     There’s more...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1665.1">
     Let’s quickly go through some important concepts related to VPC endpoints.
    </span>
    <span class="koboSpan" id="kobo.1665.2">
     There are two types of
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1666.1">
      VPC endpoints:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1667.1">
       Interface endpoints
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1668.1">
      : This
     </span>
     <a id="_idIndexMarker708">
     </a>
     <span class="koboSpan" id="kobo.1669.1">
      is an
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1670.1">
       Elastic Network Interface
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1671.1">
      (
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1672.1">
       ENI
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1673.1">
      ) with a private address that allows traffic
     </span>
     <a id="_idIndexMarker709">
     </a>
     <span class="koboSpan" id="kobo.1674.1">
      to a supported service.
     </span>
     <span class="koboSpan" id="kobo.1674.2">
      There are around 20 supported services.
     </span>
     <span class="koboSpan" id="kobo.1674.3">
      Examples of such supported services include Amazon API Gateway, Amazon CloudWatch, AWS Config, AWS KMS, and
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1675.1">
       so on.
      </span>
     </span>
    </li>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1676.1">
       Gateway endpoints
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1677.1">
      : Like
     </span>
     <a id="_idIndexMarker710">
     </a>
     <span class="koboSpan" id="kobo.1678.1">
      NAT gateways, they do not have private IP addresses.
     </span>
     <span class="koboSpan" id="kobo.1678.2">
      This is only supported for limited services such as S3
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1679.1">
       and DynamoDB.
      </span>
     </span>
    </li>
   </ul>
   <h2 id="_idParaDest-203">
    <a id="_idTextAnchor207">
    </a>
    <span class="koboSpan" id="kobo.1680.1">
     See also
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1681.1">
     Read more about the
    </span>
    <a id="_idIndexMarker711">
    </a>
    <span class="koboSpan" id="kobo.1682.1">
     VPC gateway endpoint
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1683.1">
      at
     </span>
    </span>
    <a href="https://www.cloudericks.com/blog/understanding-aws-vpc-gateway-endpoint">
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1684.1">
       https://www.cloudericks.com/blog/understanding-aws-vpc-gateway-endpoint
      </span>
     </span>
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1685.1">
      .
     </span>
    </span>
   </p>
   <h1 id="_idParaDest-204">
    <a id="_idTextAnchor208">
    </a>
    <span class="koboSpan" id="kobo.1686.1">
     Configuring and using VPC flow logs
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.1687.1">
     In this recipe, we
    </span>
    <a id="_idIndexMarker712">
    </a>
    <span class="koboSpan" id="kobo.1688.1">
     will enable flow logs at the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1689.1">
      VPC level.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-205">
    <a id="_idTextAnchor209">
    </a>
    <span class="koboSpan" id="kobo.1690.1">
     Getting ready
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1691.1">
     We need the following resources for completing the steps within
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1692.1">
      this recipe:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.1693.1">
      A
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1694.1">
       CloudWatch log group
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1695.1">
      will be
     </span>
     <a id="_idIndexMarker713">
     </a>
     <span class="koboSpan" id="kobo.1696.1">
      needed.
     </span>
     <span class="koboSpan" id="kobo.1696.2">
      The detailed steps are provided later in
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1697.1">
       this section.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1698.1">
      We need to set up a VPC.
     </span>
     <span class="koboSpan" id="kobo.1698.2">
      If one hasn’t been created previously, please refer to the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.1699.1">
       Creating a bare VPC and setting up public and private
      </span>
     </em>
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.1700.1">
        subnets
       </span>
      </em>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1701.1">
       recipe.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1702.1">
      An IAM role with permissions to publish to the CloudWatch log group with full access will also
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1703.1">
       be needed.
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.1704.1">
     We can perform the following steps
    </span>
    <a id="_idIndexMarker714">
    </a>
    <span class="koboSpan" id="kobo.1705.1">
     to create a CloudWatch
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1706.1">
      log group:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.1707.1">
      Go to the CloudWatch service in the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1708.1">
       AWS console.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1709.1">
      Click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1710.1">
       Logs
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1711.1">
      from the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1712.1">
       left sidebar.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1713.1">
      Click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1714.1">
       Log groups
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1715.1">
      and click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1716.1">
       Create
      </span>
     </strong>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1717.1">
        log group
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1718.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1719.1">
      Give the log group a
     </span>
     <a id="_idIndexMarker715">
     </a>
     <span class="koboSpan" id="kobo.1720.1">
      name that describes its purpose, keep the other values as their defaults, and click
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1721.1">
       on
      </span>
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1722.1">
        Create
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1723.1">
       .
      </span>
     </span>
    </li>
   </ol>
   <h2 id="_idParaDest-206">
    <a id="_idTextAnchor210">
    </a>
    <span class="koboSpan" id="kobo.1724.1">
     How to do it...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1725.1">
     We can
    </span>
    <a id="_idIndexMarker716">
    </a>
    <span class="koboSpan" id="kobo.1726.1">
     configure VPC flow logs from the console
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1727.1">
      as follows:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.1728.1">
      Go to the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1729.1">
       VPC
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1730.1">
      service in
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1731.1">
       the console.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1732.1">
      Click on
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1733.1">
        Your VPCs
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1734.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1735.1">
      Select
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1736.1">
       our VPC.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1737.1">
      Click on the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1738.1">
       Flow
      </span>
     </strong>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1739.1">
        Logs
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1740.1">
       tab.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1741.1">
      Click on the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1742.1">
       Actions
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1743.1">
      dropdown and select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1744.1">
       Create
      </span>
     </strong>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1745.1">
        flow log
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1746.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1747.1">
      Under
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1748.1">
       Flow log settings
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1749.1">
      , provide a name, and for the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1750.1">
       Filter
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1751.1">
      ,
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1752.1">
       select
      </span>
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1753.1">
        All
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1754.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1755.1">
      For
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1756.1">
       Maximum aggregation interval
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1757.1">
      , select the time based on
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1758.1">
       your preferences.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1759.1">
      Set
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1760.1">
       Destination
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1761.1">
      to
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1762.1">
       Send to
      </span>
     </strong>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1763.1">
        CloudWatch Logs
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1764.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1765.1">
      Select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1766.1">
       Destination log group
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1767.1">
      as the log group we created in the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.1768.1">
       Getting ready
      </span>
     </em>
     <span class="koboSpan" id="kobo.1769.1">
      section of
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1770.1">
       this recipe.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1771.1">
      Select the option we created in the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.1772.1">
       Getting ready
      </span>
     </em>
     <span class="koboSpan" id="kobo.1773.1">
      section of this recipe from the drop-down list for the
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1774.1">
        IAM role
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1775.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1776.1">
      For
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1777.1">
       Log record format
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1778.1">
      , select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1779.1">
       AWS
      </span>
     </strong>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1780.1">
        default format
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1781.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1782.1">
      Click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1783.1">
       Create flow log
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1784.1">
      .
     </span>
     <span class="koboSpan" id="kobo.1784.2">
      We should see a success message.
     </span>
     <span class="koboSpan" id="kobo.1784.3">
      We should be able to see all further IP traffic logs within our flow logs.
     </span>
     <span class="koboSpan" id="kobo.1784.4">
      The following is an example of a log record from the log group for
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1785.1">
       VPC logs:
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer161">
     <span class="koboSpan" id="kobo.1786.1">
      <img alt="Figure 5.30 – A sample log record" src="image/B21384_05_30.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.1787.1">
     Figure 5.30 – A sample log record
    </span>
   </p>
   <h2 id="_idParaDest-207">
    <a id="_idTextAnchor211">
    </a>
    <span class="koboSpan" id="kobo.1788.1">
     How it works...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1789.1">
     VPC flow logs help
    </span>
    <a id="_idIndexMarker717">
    </a>
    <span class="koboSpan" id="kobo.1790.1">
     us capture IP traffic to and from our VPCs.
    </span>
    <span class="koboSpan" id="kobo.1790.2">
     Data from VPC flow logs can be published to either CloudWatch logs or to an S3 bucket.
    </span>
    <span class="koboSpan" id="kobo.1790.3">
     We can choose to log only accepted traffic, rejected traffic, or both.
    </span>
    <span class="koboSpan" id="kobo.1790.4">
     VPC flow logs can be created at different levels, such as the VPC level, subnet level, and network
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1791.1">
      interface level.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1792.1">
     In the recipe, within the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1793.1">
      Filter
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1794.1">
     dropdown, we selected
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1795.1">
      All
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1796.1">
     to log all IP traffic to and from our VPCs.
    </span>
    <span class="koboSpan" id="kobo.1796.2">
     We can choose
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1797.1">
      Accept
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1798.1">
     to log only accepted traffic,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1799.1">
      Reject
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1800.1">
     to log only rejected traffic, and
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1801.1">
      All
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1802.1">
     to log both accepted and rejected traffic.
    </span>
    <span class="koboSpan" id="kobo.1802.2">
     We needed a CloudWatch log group and an IAM role with permission to log to that
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1803.1">
      log group.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-208">
    <a id="_idTextAnchor212">
    </a>
    <span class="koboSpan" id="kobo.1804.1">
     There’s more...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1805.1">
     Let’s quickly go through some more
    </span>
    <a id="_idIndexMarker718">
    </a>
    <span class="koboSpan" id="kobo.1806.1">
     important concepts related to
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1807.1">
      flow logs:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.1808.1">
      Currently, we cannot change a flow log configuration, such as changing the associated IAM role, once it’s
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1809.1">
       been created.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1810.1">
      Some of the IP traffic, including the ones listed here, are not monitored by
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1811.1">
       flow logs:
      </span>
     </span>
     <ul>
      <li>
       <span class="koboSpan" id="kobo.1812.1">
        Traffic to the
       </span>
       <a id="_idIndexMarker719">
       </a>
       <span class="koboSpan" id="kobo.1813.1">
        reserved IP addresses of the default
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.1814.1">
         VPC router
        </span>
       </span>
      </li>
      <li>
       <strong class="bold">
        <span class="koboSpan" id="kobo.1815.1">
         Dynamic Host Configuration Protocol
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1816.1">
        (
       </span>
       <span class="No-Break">
        <strong class="bold">
         <span class="koboSpan" id="kobo.1817.1">
          DHCP
         </span>
        </strong>
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.1818.1">
         ) traffic
        </span>
       </span>
      </li>
      <li>
       <span class="koboSpan" id="kobo.1819.1">
        Traffic set to
       </span>
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.1820.1">
         169.254.169.254
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1821.1">
        for querying
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.1822.1">
         instance metadata
        </span>
       </span>
      </li>
      <li>
       <span class="koboSpan" id="kobo.1823.1">
        Traffic while contacting Amazon DNS servers via instances; however, traffic to our own
       </span>
       <a id="_idIndexMarker720">
       </a>
       <span class="koboSpan" id="kobo.1824.1">
        DNS server
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.1825.1">
         is logged
        </span>
       </span>
      </li>
      <li>
       <span class="koboSpan" id="kobo.1826.1">
        Windows license
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.1827.1">
         activation traffic
        </span>
       </span>
      </li>
     </ul>
    </li>
   </ul>
   <h2 id="_idParaDest-209">
    <a id="_idTextAnchor213">
    </a>
    <span class="koboSpan" id="kobo.1828.1">
     See also
    </span>
   </h2>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.1829.1">
      Read more about
     </span>
     <a id="_idIndexMarker721">
     </a>
     <span class="koboSpan" id="kobo.1830.1">
      VPC flow logs
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1831.1">
       at
      </span>
     </span>
     <a href="https://www.cloudericks.com/blog/understanding-aws-vpc-flow-logs">
      <span class="No-Break">
       <span class="koboSpan" id="kobo.1832.1">
        https://www.cloudericks.com/blog/understanding-aws-vpc-flow-logs
       </span>
      </span>
     </a>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1833.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1834.1">
      Find examples of
     </span>
     <a id="_idIndexMarker722">
     </a>
     <span class="koboSpan" id="kobo.1835.1">
      log records
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1836.1">
       at
      </span>
     </span>
     <a href="https://docs.aws.amazon.com/vpc/latest/userguide/flow-logs-records-examples.html">
      <span class="No-Break">
       <span class="koboSpan" id="kobo.1837.1">
        https://docs.aws.amazon.com/vpc/latest/userguide/flow-logs-records-examples.html
       </span>
      </span>
     </a>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1838.1">
       .
      </span>
     </span>
    </li>
   </ul>
   <h1 id="_idParaDest-210">
    <a id="_idTextAnchor214">
    </a>
    <span class="koboSpan" id="kobo.1839.1">
     Setting up and configuring NAT gateways
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.1840.1">
     In this recipe, we
    </span>
    <a id="_idIndexMarker723">
    </a>
    <span class="koboSpan" id="kobo.1841.1">
     will learn how to create and configure NAT gateways, which is the latest and preferred option for NAT
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1842.1">
      in AWS.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-211">
    <a id="_idTextAnchor215">
    </a>
    <span class="koboSpan" id="kobo.1843.1">
     Getting ready
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1844.1">
     To complete the steps within this recipe, we need
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1845.1">
      the following:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.1846.1">
      A working AWS account is essential.
     </span>
     <span class="koboSpan" id="kobo.1846.2">
      I will be using the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1847.1">
       awsseccb-sandbox-1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1848.1">
      account that we created in
     </span>
     <a href="B21384_01.xhtml#_idTextAnchor020">
      <span class="No-Break">
       <em class="italic">
        <span class="koboSpan" id="kobo.1849.1">
         Chapter 1
        </span>
       </em>
      </span>
     </a>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1850.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1851.1">
      Create a VPC, subnets, an IGW, and a route table by following the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.1852.1">
       Creating a bare VPC and setting up public and private subnets
      </span>
     </em>
     <span class="koboSpan" id="kobo.1853.1">
      recipe from
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1854.1">
       this chapter.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1855.1">
      Launch instances in the public and private subnets with the appropriate security group configurations by following the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.1856.1">
       Creating and configuring a security group
      </span>
     </em>
     <span class="koboSpan" id="kobo.1857.1">
      recipe and the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.1858.1">
       Getting ready
      </span>
     </em>
     <span class="koboSpan" id="kobo.1859.1">
      section of the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.1860.1">
       Working with NACLs
      </span>
     </em>
     <span class="koboSpan" id="kobo.1861.1">
      recipe in
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1862.1">
       this chapter.
      </span>
     </span>
    </li>
   </ul>
   <h2 id="_idParaDest-212">
    <a id="_idTextAnchor216">
    </a>
    <span class="koboSpan" id="kobo.1863.1">
     How to do it...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1864.1">
     We can
    </span>
    <a id="_idIndexMarker724">
    </a>
    <span class="koboSpan" id="kobo.1865.1">
     create a NAT gateway
    </span>
    <a id="_idIndexMarker725">
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1866.1">
      as follows:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.1867.1">
      Go to
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1868.1">
        VPC dashboard
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1869.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1870.1">
      Click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1871.1">
       NAT gateways
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1872.1">
      on the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1873.1">
       left pane.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1874.1">
      Click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1875.1">
       Create
      </span>
     </strong>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1876.1">
        NAT gateway
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1877.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1878.1">
      Under the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1879.1">
       NAT gateway settings
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1880.1">
      , type
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1881.1">
       NAT-Gateway
      </span>
     </strong>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1882.1">
       under
      </span>
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1883.1">
        Name
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1884.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1885.1">
      For
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1886.1">
       Subnet
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1887.1">
      , in the drop-down list, select our
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1888.1">
       public subnet.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1889.1">
      For
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1890.1">
       Connectivity type
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1891.1">
      ,
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1892.1">
       select
      </span>
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1893.1">
        Public
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1894.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1895.1">
      Click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1896.1">
       Allocate Elastic IP
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1897.1">
      to populate the allocation ID for an Elastic IP and select it for
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1898.1">
       Elastic IP allocation ID
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1899.1">
      or, if we already have an Elastic IP created, we can select one of them.
     </span>
     <span class="koboSpan" id="kobo.1899.2">
      The filled page should look
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1900.1">
       as follows:
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer162">
     <span class="koboSpan" id="kobo.1901.1">
      <img alt="Figure 5.31 – NAT gateway settings" src="image/B21384_05_31.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.1902.1">
     Figure 5.31 – NAT gateway settings
    </span>
   </p>
   <ol>
    <li value="8">
     <span class="koboSpan" id="kobo.1903.1">
      Click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1904.1">
       Create a NAT gateway
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1905.1">
      .
     </span>
     <span class="koboSpan" id="kobo.1905.2">
      We
     </span>
     <a id="_idIndexMarker726">
     </a>
     <span class="koboSpan" id="kobo.1906.1">
      will get a message saying that the NAT gateway was
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1907.1">
       created successfully.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1908.1">
      Click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1909.1">
       Route tables
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1910.1">
      , select our public route table, and go to the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1911.1">
       Routes
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1912.1">
      tab.
     </span>
     <span class="koboSpan" id="kobo.1912.2">
      Click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1913.1">
       Edit routes
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1914.1">
      and then on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1915.1">
       Add route
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1916.1">
      .
     </span>
     <span class="koboSpan" id="kobo.1916.2">
      Select
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1917.1">
       0.0.0.0/8
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1918.1">
      as the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1919.1">
       Destination
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1920.1">
      .
     </span>
     <span class="koboSpan" id="kobo.1920.2">
      From the dropdown for
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1921.1">
       Target
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1922.1">
      , select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1923.1">
       NAT Gateway
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1924.1">
      and then select the
     </span>
     <a id="_idIndexMarker727">
     </a>
     <span class="koboSpan" id="kobo.1925.1">
      NAT gateway we created in
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.1926.1">
       Step 8
      </span>
     </em>
     <span class="koboSpan" id="kobo.1927.1">
      .
     </span>
     <span class="koboSpan" id="kobo.1927.2">
      Click on
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1928.1">
        Save changes
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1929.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1930.1">
      Go back to EC2 instances, select our instance, click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1931.1">
       Connect
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1932.1">
      , then on the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1933.1">
       Connect to instance
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1934.1">
      page, click on
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1935.1">
        Connect
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1936.1">
       again.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1937.1">
      Try running any command from the terminal that requires internet access,
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1938.1">
       as follows:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1939.1">ping google.com</span></strong></pre>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.1940.1">
       We should get back a successful response if there is a route to the internet; otherwise, it will
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.1941.1">
        time out:
       </span>
      </span>
     </p>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer163">
     <span class="koboSpan" id="kobo.1942.1">
      <img alt="Figure 5.32 – A successful response to the ping command" src="image/B21384_05_32.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.1943.1">
     Figure 5.32 – A successful response to the ping command
    </span>
   </p>
   <p class="list-inset">
    <span class="koboSpan" id="kobo.1944.1">
     We can also run a yum update command
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1945.1">
      as follows:
     </span>
    </span>
   </p>
   <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1946.1">sudo yum update</span></strong></pre>
   <p class="list-inset">
    <span class="koboSpan" id="kobo.1947.1">
     Follow the remaining prompts.
    </span>
    <span class="koboSpan" id="kobo.1947.2">
     The update will happen successfully if there is a route to the internet; otherwise, it will
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1948.1">
      time out.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-213">
    <a id="_idTextAnchor217">
    </a>
    <span class="koboSpan" id="kobo.1949.1">
     How it works...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1950.1">
     Internet access
    </span>
    <a id="_idIndexMarker728">
    </a>
    <span class="koboSpan" id="kobo.1951.1">
     may be required for instances in our private subnets for activities such as patching, downloading software, and so on.
    </span>
    <span class="koboSpan" id="kobo.1951.2">
     NAT allows a private subnet in our VPC to talk to the internet.
    </span>
    <span class="koboSpan" id="kobo.1951.3">
     NAT is a process of remapping the IP address of a packet by modifying its IP header while in transit.
    </span>
    <span class="koboSpan" id="kobo.1951.4">
     AWS provides us with two ways to achieve NAT with VPCs: NAT gateways and NAT instances.
    </span>
    <span class="koboSpan" id="kobo.1951.5">
     We created and configured a NAT gateway in this recipe.
    </span>
    <span class="koboSpan" id="kobo.1951.6">
     Unlike NAT instances, NAT gateways are not associated with any security groups and hence, we did not create or configure any
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1952.1">
      security groups.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1953.1">
     After creating the NAT gateway, we need to add a route for it within the route table that our private subnets are associated with.
    </span>
    <span class="koboSpan" id="kobo.1953.2">
     We added the route to our main route table since our private subnets are associated with the main route table.
    </span>
    <span class="koboSpan" id="kobo.1953.3">
     A subnet that is not associated explicitly with any route table will be implicitly associated with the main route table.
    </span>
    <span class="koboSpan" id="kobo.1953.4">
     If our architecture has a different route table for private subnets, we will need to add the route for the NAT gateway within that
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1954.1">
      route table.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-214">
    <a id="_idTextAnchor218">
    </a>
    <span class="koboSpan" id="kobo.1955.1">
     There’s more...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1956.1">
     Let’s quickly go through some more
    </span>
    <a id="_idIndexMarker729">
    </a>
    <span class="koboSpan" id="kobo.1957.1">
     important concepts related to
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1958.1">
      NAT gateways:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.1959.1">
      NAT gateways are maintained by AWS and AWS takes care of patching, availability,
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1960.1">
       and scaling.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1961.1">
      NAT gateways are not associated with any security groups.
     </span>
     <span class="koboSpan" id="kobo.1961.2">
      NAT gateways are redundant within an AZ, but cannot span an AZ.
     </span>
     <span class="koboSpan" id="kobo.1961.3">
      Therefore, for better availability, we may need to create a NAT gateway
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1962.1">
       per region.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1963.1">
      NAT is currently not supported for IPv6 traffic.
     </span>
     <span class="koboSpan" id="kobo.1963.2">
      We need to use an egress-only IGW instead of NAT for IPv6 traffic.
     </span>
     <span class="koboSpan" id="kobo.1963.3">
      We can create an egress-only IGW from the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1964.1">
       VPC dashboard.
      </span>
     </span>
    </li>
   </ul>
   <h2 id="_idParaDest-215">
    <a id="_idTextAnchor219">
    </a>
    <span class="koboSpan" id="kobo.1965.1">
     See also
    </span>
   </h2>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.1966.1">
      Read more
     </span>
     <a id="_idIndexMarker730">
     </a>
     <span class="koboSpan" id="kobo.1967.1">
      about NAT gateways
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1968.1">
       at
      </span>
     </span>
     <a href="https://www.cloudericks.com/blog/understanding-nat-gateways-in-aws">
      <span class="No-Break">
       <span class="koboSpan" id="kobo.1969.1">
        https://www.cloudericks.com/blog/understanding-nat-gateways-in-aws
       </span>
      </span>
     </a>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1970.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1971.1">
      Read about how we can securely connect our VPC to supported AWS services, other VPCs, and on-premises applications, without exposing our traffic to the public internet using PrivateLink,
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1972.1">
       at
      </span>
     </span>
     <a href="https://www.cloudericks.com/blog/understanding-aws-privatelink">
      <span class="No-Break">
       <span class="koboSpan" id="kobo.1973.1">
        https://www.cloudericks.com/blog/understanding-aws-privatelink
       </span>
      </span>
     </a>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1974.1">
       .
      </span>
     </span>
    </li>
   </ul>
  </div>
 </body></html>