<html><head></head><body>
  <div id="_idContainer204">
   <h1 class="chapter-number" id="_idParaDest-216">
    <a id="_idTextAnchor220">
    </a>
    <span class="koboSpan" id="kobo.1.1">
     6
    </span>
   </h1>
   <h1 id="_idParaDest-217">
    <a id="_idTextAnchor221">
    </a>
    <span class="koboSpan" id="kobo.2.1">
     Web Security Using Certificates, CDNs, and Firewalls
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.3.1">
     In today’s interconnected digital landscape, web security is paramount.
    </span>
    <span class="koboSpan" id="kobo.3.2">
     To maintain the integrity and confidentiality of data, it is crucial to use a combination of tools and technologies.
    </span>
    <span class="koboSpan" id="kobo.3.3">
     This chapter
    </span>
    <a id="_idIndexMarker731">
    </a>
    <span class="koboSpan" id="kobo.4.1">
     focuses
    </span>
    <a id="_idIndexMarker732">
    </a>
    <span class="koboSpan" id="kobo.5.1">
     on
    </span>
    <a id="_idIndexMarker733">
    </a>
    <span class="koboSpan" id="kobo.6.1">
     three key components –
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.7.1">
      certificates
     </span>
    </strong>
    <span class="koboSpan" id="kobo.8.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.9.1">
      Content Delivery Networks
     </span>
    </strong>
    <span class="koboSpan" id="kobo.10.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.11.1">
      CDNs
     </span>
    </strong>
    <span class="koboSpan" id="kobo.12.1">
     ), and
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.13.1">
      firewalls
     </span>
    </strong>
    <span class="koboSpan" id="kobo.14.1">
     .
    </span>
    <span class="koboSpan" id="kobo.14.2">
     We will also see how we can use certificates alongside load balancers.
    </span>
    <span class="koboSpan" id="kobo.14.3">
     Certificates, particularly X.509, play a vital role in securing communications
    </span>
    <a id="_idIndexMarker734">
    </a>
    <span class="koboSpan" id="kobo.15.1">
     between clients and servers by enabling
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.16.1">
      TLS
     </span>
    </strong>
    <span class="koboSpan" id="kobo.17.1">
     (short for
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.18.1">
      Transport Layer Security
     </span>
    </strong>
    <span class="koboSpan" id="kobo.19.1">
     ).
    </span>
    <span class="koboSpan" id="kobo.19.2">
     This encryption helps to safeguard data in transit, making it essential for preventing data breaches and
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.20.1">
      maintaining privacy.
     </span>
    </span>
   </p>
   <p>
    <strong class="bold">
     <span class="koboSpan" id="kobo.21.1">
      Load balancers
     </span>
    </strong>
    <span class="koboSpan" id="kobo.22.1">
     enhance the reliability and performance
    </span>
    <a id="_idIndexMarker735">
    </a>
    <span class="koboSpan" id="kobo.23.1">
     of web services by efficiently distributing incoming network traffic across multiple servers.
    </span>
    <span class="koboSpan" id="kobo.23.2">
     By doing so, they ensure that no single server bears too much load, thus preventing downtime and optimizing resource use.
    </span>
    <span class="koboSpan" id="kobo.23.3">
     Load balancers when used with certificates offer the flexibility of managing security measures such as TLS termination, allowing for centralized handling of certificates, which simplifies security management and
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.24.1">
      boosts performance.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.25.1">
     CDNs improve website load times and reduce bandwidth costs by caching content at multiple geographic locations, closer to users.
    </span>
    <span class="koboSpan" id="kobo.25.2">
     They also add
    </span>
    <a id="_idIndexMarker736">
    </a>
    <span class="koboSpan" id="kobo.26.1">
     a layer of security by protecting against
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.27.1">
      Distributed Denial of Service
     </span>
    </strong>
    <span class="koboSpan" id="kobo.28.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.29.1">
      DDoS
     </span>
    </strong>
    <span class="koboSpan" id="kobo.30.1">
     ) attacks and enhancing the availability and performance of
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.31.1">
      web applications.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.32.1">
     Lastly, firewalls are critical in defining and enforcing the security perimeter of your network.
    </span>
    <span class="koboSpan" id="kobo.32.2">
     They monitor and control the flow of traffic to and from your network.
    </span>
    <span class="koboSpan" id="kobo.32.3">
     When integrated within environments such as AWS, firewalls help create a robust defense against potential threats, contributing significantly to the overall security strategy.
    </span>
    <span class="koboSpan" id="kobo.32.4">
     This chapter will explore practical implementations of these components within AWS, providing you with the knowledge to build a secure, scalable
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.33.1">
      web infrastructure.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.34.1">
     In this chapter, we will cover the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.35.1">
      following recipes:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.36.1">
      Enabling HTTPS for a web server on an
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.37.1">
       EC2 instance
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.38.1">
      Creating an SSL/TLS certificate
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.39.1">
       with ACM
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.40.1">
      Creating ELB
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.41.1">
       target groups
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.42.1">
      Using an application load balancer with TLS termination at
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.43.1">
       the ELB
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.44.1">
      Using a network load balancer with TLS termination
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.45.1">
       at EC2
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.46.1">
      Securing S3 using CloudFront
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.47.1">
       and TLS
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.48.1">
      Using
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.49.1">
       a WAF
      </span>
     </span>
    </li>
   </ul>
   <h1 id="_idParaDest-218">
    <a id="_idTextAnchor222">
    </a>
    <span class="koboSpan" id="kobo.50.1">
     Technical requirements
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.51.1">
     Before diving into the recipes of this chapter, we need to ensure we have the following requirements and knowledge
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.52.1">
      in place:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.53.1">
      We need an active AWS account to complete the recipes within this chapter.
     </span>
     <span class="koboSpan" id="kobo.53.2">
      We can use an account that is part of an AWS organization or a standalone account.
     </span>
     <span class="koboSpan" id="kobo.53.3">
      I will be using the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.54.1">
       awsseccb-sandbox-1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.55.1">
      account that we created in the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.56.1">
       Multi-account management with AWS Organizations
      </span>
     </em>
     <span class="koboSpan" id="kobo.57.1">
      recipe in
     </span>
     <a href="B21384_01.xhtml#_idTextAnchor020">
      <span class="No-Break">
       <em class="italic">
        <span class="koboSpan" id="kobo.58.1">
         Chapter 1
        </span>
       </em>
      </span>
     </a>
     <span class="koboSpan" id="kobo.59.1">
      .
     </span>
     <span class="koboSpan" id="kobo.59.2">
      However, I won’t be utilizing any AWS Organizations features, meaning you can follow these steps with a standalone
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.60.1">
       account too.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.61.1">
      For administrative actions, we need a user who has
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.62.1">
       AdministratorAccess
      </span>
     </strong>
     <span class="koboSpan" id="kobo.63.1">
      permission to the AWS account we will work with.
     </span>
     <span class="koboSpan" id="kobo.63.2">
      This can be an IAM Identity Center user or an IAM user.
     </span>
     <span class="koboSpan" id="kobo.63.3">
      I will be using
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.64.1">
       awsseccbadmin1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.65.1">
      , the IAM Identity Center user we created in the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.66.1">
       User management and SSO with IAM Identity Center
      </span>
     </em>
     <span class="koboSpan" id="kobo.67.1">
      recipe in
     </span>
     <a href="B21384_01.xhtml#_idTextAnchor020">
      <span class="No-Break">
       <em class="italic">
        <span class="koboSpan" id="kobo.68.1">
         Chapter 1
        </span>
       </em>
      </span>
     </a>
     <span class="koboSpan" id="kobo.69.1">
      .
     </span>
     <span class="koboSpan" id="kobo.69.2">
      However, I won’t be utilizing any IAM Identity Center features, meaning you can follow these steps as an IAM user, too, if the user has
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.70.1">
       AdministratorAccess
      </span>
     </strong>
     <span class="koboSpan" id="kobo.71.1">
      permission within the account.
     </span>
     <span class="koboSpan" id="kobo.71.2">
      You can create an IAM user by following the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.72.1">
       Setting up IAM, account aliases, and billing alerts
      </span>
     </em>
     <span class="koboSpan" id="kobo.73.1">
      recipe in
     </span>
     <a href="B21384_01.xhtml#_idTextAnchor020">
      <span class="No-Break">
       <em class="italic">
        <span class="koboSpan" id="kobo.74.1">
         Chapter 1
        </span>
       </em>
      </span>
     </a>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.75.1">
       .
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.76.1">
     The code files for this book are available at
    </span>
    <a href="https://github.com/PacktPublishing/AWS-Security-Cookbook-Second-Edition">
     <span class="koboSpan" id="kobo.77.1">
      https://github.com/PacktPublishing/AWS-Security-Cookbook-Second-Edition
     </span>
    </a>
    <span class="koboSpan" id="kobo.78.1">
     .
    </span>
    <span class="koboSpan" id="kobo.78.2">
     The code files for this chapter are available
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.79.1">
      at
     </span>
    </span>
    <a href="https://github.com/PacktPublishing/AWS-Security-Cookbook-Second-Edition/tree/main/Chapter06">
     <span class="No-Break">
      <span class="koboSpan" id="kobo.80.1">
       https://github.com/PacktPublishing/AWS-Security-Cookbook-Second-Edition/tree/main/Chapter06
      </span>
     </span>
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.81.1">
      .
     </span>
    </span>
   </p>
   <h1 id="_idParaDest-219">
    <a id="_idTextAnchor223">
    </a>
    <span class="koboSpan" id="kobo.82.1">
     Enabling HTTPS for a web server on an EC2 instance
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.83.1">
     In the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.84.1">
      Launching an EC2 instance with a web server using user data
     </span>
    </em>
    <span class="koboSpan" id="kobo.85.1">
     recipe in
    </span>
    <a href="B21384_05.xhtml#_idTextAnchor169">
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.86.1">
        Chapter 5
       </span>
      </em>
     </span>
    </a>
    <span class="koboSpan" id="kobo.87.1">
     , we launched
    </span>
    <a id="_idIndexMarker737">
    </a>
    <span class="koboSpan" id="kobo.88.1">
     an EC2 instance with a web server without
    </span>
    <a id="_idIndexMarker738">
    </a>
    <span class="koboSpan" id="kobo.89.1">
     enabling HTTPS.
    </span>
    <span class="koboSpan" id="kobo.89.2">
     In this recipe, we will demonstrate how to enable HTTPS on that web server using a self-signed certificate.
    </span>
    <span class="koboSpan" id="kobo.89.3">
     This will help us to understand the fundamental concepts of enabling HTTPS on an EC2 instance.
    </span>
    <span class="koboSpan" id="kobo.89.4">
     However, for practical applications, it is advisable to use methods outlined in other recipes
    </span>
    <a id="_idIndexMarker739">
    </a>
    <span class="koboSpan" id="kobo.90.1">
     within this chapter, which involve
    </span>
    <a id="_idIndexMarker740">
    </a>
    <span class="koboSpan" id="kobo.91.1">
     certificates signed by a
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.92.1">
      Certificate Authority
     </span>
    </strong>
    <span class="koboSpan" id="kobo.93.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.94.1">
      CA
     </span>
    </strong>
    <span class="koboSpan" id="kobo.95.1">
     ), such as
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.96.1">
      AWS Certificate
     </span>
    </strong>
    <span class="No-Break">
     <strong class="bold">
      <span class="koboSpan" id="kobo.97.1">
       Manager
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.98.1">
      (
     </span>
    </span>
    <span class="No-Break">
     <strong class="bold">
      <span class="koboSpan" id="kobo.99.1">
       ACM
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.100.1">
      ).
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-220">
    <a id="_idTextAnchor224">
    </a>
    <span class="koboSpan" id="kobo.101.1">
     Getting ready
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.102.1">
     We need the following to successfully complete
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.103.1">
      this recipe:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.104.1">
      A working AWS account,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.105.1">
       awsseccb-sandbox-1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.106.1">
      , and a user,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.107.1">
       awsseccbadmin1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.108.1">
      , as described in the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.109.1">
       Technical
      </span>
     </em>
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.110.1">
        requirements
       </span>
      </em>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.111.1">
       section.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.112.1">
      An EC2 instance called
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.113.1">
       Cloudericks Web Server
      </span>
     </strong>
     <span class="koboSpan" id="kobo.114.1">
      , launched in the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.115.1">
       Launching an EC2 instance with a web server using user data
      </span>
     </em>
     <span class="koboSpan" id="kobo.116.1">
      recipe from
     </span>
     <a href="B21384_05.xhtml#_idTextAnchor169">
      <span class="No-Break">
       <em class="italic">
        <span class="koboSpan" id="kobo.117.1">
         Chapter 5
        </span>
       </em>
      </span>
     </a>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.118.1">
       .
      </span>
     </span>
    </li>
   </ul>
   <h2 id="_idParaDest-221">
    <a id="_idTextAnchor225">
    </a>
    <span class="koboSpan" id="kobo.119.1">
     How to do it...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.120.1">
     We will enable HTTPS using a self-signed certificate,
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.121.1">
      as follows:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.122.1">
      Install the Apache
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.123.1">
        mod_ssl
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.124.1">
       module:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.125.1">sudo yum install -y mod_ssl</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.126.1">
      Generating a private key
     </span>
     <a id="_idIndexMarker741">
     </a>
     <span class="koboSpan" id="kobo.127.1">
      is the first step in setting up HTTPS
     </span>
     <a id="_idIndexMarker742">
     </a>
     <span class="koboSpan" id="kobo.128.1">
      encryption for a web server.
     </span>
     <span class="koboSpan" id="kobo.128.2">
      The private key is a crucial component of the SSL/TLS encryption process.
     </span>
     <span class="koboSpan" id="kobo.128.3">
      Use the following command to generate a
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.129.1">
       private key:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.130.1">sudo openssl genrsa -out /etc/pki/tls/private/localhost.key 2048</span></strong></pre>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.131.1">
       This will return nothing but generate a 2,048-bit RSA private key, saved in
      </span>
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.132.1">
        /
       </span>
      </strong>
      <span class="No-Break">
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.133.1">
         etc/pki/tls/private/localhost.key
        </span>
       </strong>
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.134.1">
        file.
       </span>
      </span>
     </p>
    </li>
    <li>
     <span class="koboSpan" id="kobo.135.1">
      Generate a
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.136.1">
       certificate signing request
      </span>
     </strong>
     <span class="koboSpan" id="kobo.137.1">
      (
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.138.1">
       CSR
      </span>
     </strong>
     <span class="koboSpan" id="kobo.139.1">
      ) with the private key generated in the
     </span>
     <a id="_idIndexMarker743">
     </a>
     <span class="koboSpan" id="kobo.140.1">
      previous step, using the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.141.1">
       following command:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.142.1">sudo openssl req -new -key /etc/pki/tls/private/localhost.key -out /etc/pki/tls/certs/localhost.csr</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.143.1">
      After running the command from the previous step in the command line, when prompted, enter the values as shown in the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.144.1">
       following figure:
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer165">
     <span class="koboSpan" id="kobo.145.1">
      <img alt="Figure 6.1 – The certificate signing request" src="image/B21384_06_1.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.146.1">
     Figure 6.1 – The certificate signing request
    </span>
   </p>
   <ol>
    <li value="5">
     <span class="koboSpan" id="kobo.147.1">
      Use the CSR generated
     </span>
     <a id="_idIndexMarker744">
     </a>
     <span class="koboSpan" id="kobo.148.1">
      in the previous step
     </span>
     <a id="_idIndexMarker745">
     </a>
     <span class="koboSpan" id="kobo.149.1">
      to create a
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.150.1">
       self-signed certificate:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.151.1">sudo openssl x509 -req -days 365 -in /etc/pki/tls/certs/localhost.csr -signkey /etc/pki/tls/private/localhost.key -out /etc/pki/tls/certs/localhost.crt</span></strong></pre>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer166">
     <span class="koboSpan" id="kobo.152.1">
      <img alt="Figure 6.2 – Create a self signed certificate" src="image/B21384_06_2.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.153.1">
     Figure 6.2 – Create a self signed certificate
    </span>
   </p>
   <p class="list-inset">
    <span class="koboSpan" id="kobo.154.1">
     When we run this command, OpenSSL reads the CSR, signs it using the private key, and generates a self-signed certificate (
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.155.1">
      localhost.crt
     </span>
    </strong>
    <span class="koboSpan" id="kobo.156.1">
     ).
    </span>
    <span class="koboSpan" id="kobo.156.2">
     This certificate can then be used by your web server (e.g., Apache) to enable HTTPS encryption and establish secure communication with clients.
    </span>
    <span class="koboSpan" id="kobo.156.3">
     The certificate will be in the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.157.1">
      /
     </span>
    </strong>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.158.1">
       etc/pki/tls/certs/localhost.crt
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.159.1">
      location.
     </span>
    </span>
   </p>
   <ol>
    <li value="6">
     <span class="koboSpan" id="kobo.160.1">
      Restart the Apache server with the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.161.1">
       following command:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.162.1">sudo systemctl restart httpd</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.163.1">
      Access the URL
     </span>
     <a id="_idIndexMarker746">
     </a>
     <span class="koboSpan" id="kobo.164.1">
      of our web server using
     </span>
     <a id="_idIndexMarker747">
     </a>
     <span class="koboSpan" id="kobo.165.1">
      the HTTPS prefix, as demonstrated in the last step of the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.166.1">
       Setting up a web server using EC2 user data
      </span>
     </em>
     <span class="koboSpan" id="kobo.167.1">
      section in the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.168.1">
       Launching an EC2 instance with a web server using user data
      </span>
     </em>
     <span class="koboSpan" id="kobo.169.1">
      recipe in
     </span>
     <a href="B21384_05.xhtml#_idTextAnchor169">
      <span class="No-Break">
       <em class="italic">
        <span class="koboSpan" id="kobo.170.1">
         Chapter 5
        </span>
       </em>
      </span>
     </a>
     <span class="koboSpan" id="kobo.171.1">
      .
     </span>
     <span class="koboSpan" id="kobo.171.2">
      We should now receive a response, but a
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.172.1">
       Not Secure
      </span>
     </strong>
     <span class="koboSpan" id="kobo.173.1">
      warning may also appear, as we used a
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.174.1">
       self-signed certificate.
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer167">
     <span class="koboSpan" id="kobo.175.1">
      <img alt="Figure 6.3 – A HTTPS URL with a self-signed certificate" src="image/B21384_06_3.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.176.1">
     Figure 6.3 – A HTTPS URL with a self-signed certificate
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.177.1">
     In this section, we enabled HTTPS for our web server on our EC2 instance using a self-signed certificate.
    </span>
    <span class="koboSpan" id="kobo.177.2">
     In the next recipe, we will explore how to enhance security by using a certificate signed by
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.178.1">
      a CA.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-222">
    <a id="_idTextAnchor226">
    </a>
    <span class="koboSpan" id="kobo.179.1">
     How it works...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.180.1">
     First, we installed the Apache
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.181.1">
      mod_ssl
     </span>
    </strong>
    <span class="koboSpan" id="kobo.182.1">
     module.
    </span>
    <span class="koboSpan" id="kobo.182.2">
     This module adds TLS support to our Apache server.
    </span>
    <span class="koboSpan" id="kobo.182.3">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.183.1">
      mod_ssl
     </span>
    </strong>
    <span class="koboSpan" id="kobo.184.1">
     module is required to enable SSL/TLS support in Apache, and it needs to be installed and configured before generating the self-signed certificate.
    </span>
    <span class="koboSpan" id="kobo.184.2">
     The current version of the module also supports SSL v3 and all versions of TLS.
    </span>
    <span class="koboSpan" id="kobo.184.3">
     First, generate a private key using OpenSSL.
    </span>
    <span class="koboSpan" id="kobo.184.4">
     Then, create a
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.185.1">
      certificate signing request
     </span>
    </strong>
    <span class="koboSpan" id="kobo.186.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.187.1">
      CSR
     </span>
    </strong>
    <span class="koboSpan" id="kobo.188.1">
     ) and generate a self-signed certificate
    </span>
    <a id="_idIndexMarker748">
    </a>
    <span class="koboSpan" id="kobo.189.1">
     using the key.
    </span>
    <span class="koboSpan" id="kobo.189.2">
     Restart Apache to apply the changes and allow HTTPS traffic through the firewall.
    </span>
    <span class="koboSpan" id="kobo.189.3">
     Test HTTPS access in a
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.190.1">
      web browser.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-223">
    <a id="_idTextAnchor227">
    </a>
    <span class="koboSpan" id="kobo.191.1">
     There’s more...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.192.1">
     In this recipe, we used a self-signed certificate and encountered a
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.193.1">
      Not Secure
     </span>
    </strong>
    <span class="koboSpan" id="kobo.194.1">
     warning, as shown in
    </span>
    <span class="No-Break">
     <em class="italic">
      <span class="koboSpan" id="kobo.195.1">
       Figure 6
      </span>
     </em>
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.196.1">
      .3
     </span>
    </em>
    <span class="koboSpan" id="kobo.197.1">
     .
    </span>
    <span class="koboSpan" id="kobo.197.2">
     To address this, we can generate a certificate through a CA.
    </span>
    <span class="koboSpan" id="kobo.197.3">
     A CA is an entity that issues digital certificates to organizations or individuals after validating them.
    </span>
    <span class="koboSpan" id="kobo.197.4">
     By obtaining a certificate from a CA, we can ensure that the SSL/TLS certificate is trusted by most web browsers and users’ devices, eliminating warnings about insecure connections.
    </span>
    <span class="koboSpan" id="kobo.197.5">
     CAs play a critical role in how the internet operates and how secure, encrypted communications
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.198.1">
      are established.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.199.1">
     There are several types of CAs, ranging from large, widely recognized organizations that issue certificates to the public to smaller, private CAs that might be internal to an organization for its own use.
    </span>
    <span class="koboSpan" id="kobo.199.2">
     Public CAs such as Verisign, Comodo, and DigiCert provide extensive
    </span>
    <a id="_idIndexMarker749">
    </a>
    <span class="koboSpan" id="kobo.200.1">
     validation services, including
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.201.1">
      Extended Validation
     </span>
    </strong>
    <span class="koboSpan" id="kobo.202.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.203.1">
      EV
     </span>
    </strong>
    <span class="koboSpan" id="kobo.204.1">
     ) and
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.205.1">
      Organization Validated
     </span>
    </strong>
    <span class="koboSpan" id="kobo.206.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.207.1">
      OV
     </span>
    </strong>
    <span class="koboSpan" id="kobo.208.1">
     ) certificates that offer
    </span>
    <a id="_idIndexMarker750">
    </a>
    <span class="koboSpan" id="kobo.209.1">
     higher levels of security and trust.
    </span>
    <span class="koboSpan" id="kobo.209.2">
     For websites handling sensitive transactions, these certificates can enhance credibility and
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.210.1">
      user trust.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.211.1">
     Cloud service providers such as AWS, Microsoft Azure, and Google Cloud offer integrated SSL/TLS certificate management solutions that simplify the provisioning, management, and deployment of certificates within their ecosystems.
    </span>
    <span class="koboSpan" id="kobo.211.2">
     ACM is ideal for AWS-native services, automating renewal and management, but it restricts certificate export outside AWS.
    </span>
    <span class="koboSpan" id="kobo.211.3">
     Microsoft Azure’s Key Vault allows for centralized management of certificates, including those from external CAs, and integrates seamlessly with Azure services.
    </span>
    <span class="koboSpan" id="kobo.211.4">
     Google Cloud provides managed SSL certificates specifically for its load balancers, offering automatic renewals
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.212.1">
      and deployment.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.213.1">
     Additionally, for developers and small businesses that need a quick, cost-effective solution, automated CAs such
    </span>
    <a id="_idIndexMarker751">
    </a>
    <span class="koboSpan" id="kobo.214.1">
     as Let’s Encrypt offer
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.215.1">
      Domain Validated
     </span>
    </strong>
    <span class="koboSpan" id="kobo.216.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.217.1">
      DV
     </span>
    </strong>
    <span class="koboSpan" id="kobo.218.1">
     ) certificates at no cost.
    </span>
    <span class="koboSpan" id="kobo.218.2">
     These certificates are issued using automated processes, designed to ensure that the applicant controls the domain listed in the certificate.
    </span>
    <span class="koboSpan" id="kobo.218.3">
     This method is highly efficient and perfect for securing
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.219.1">
      websites rapidly.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.220.1">
     Ultimately, the choice of a certificate authority depends on our specific security needs, the level of trust we require, and our budget.
    </span>
    <span class="koboSpan" id="kobo.220.2">
     Each type of CA offers different features and levels of security, making it crucial to select one that aligns with your objectives for security and
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.221.1">
      customer trust.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-224">
    <a id="_idTextAnchor228">
    </a>
    <span class="koboSpan" id="kobo.222.1">
     See also
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.223.1">
     Read more
    </span>
    <a id="_idIndexMarker752">
    </a>
    <span class="koboSpan" id="kobo.224.1">
     about
    </span>
    <a id="_idIndexMarker753">
    </a>
    <span class="koboSpan" id="kobo.225.1">
     SSL and TLS
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.226.1">
      at
     </span>
    </span>
    <a href="https://www.secdops.com/blog/ssl-tls-and-https-a-beginners-guide-to-web-security">
     <span class="No-Break">
      <span class="koboSpan" id="kobo.227.1">
       https://www.secdops.com/blog/ssl-tls-and-https-a-beginners-guide-to-web-security
      </span>
     </span>
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.228.1">
      .
     </span>
    </span>
   </p>
   <h1 id="_idParaDest-225">
    <a id="_idTextAnchor229">
    </a>
    <span class="koboSpan" id="kobo.229.1">
     Creating an SSL/TLS certificate with ACM
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.230.1">
     In this recipe, we will
    </span>
    <a id="_idIndexMarker754">
    </a>
    <span class="koboSpan" id="kobo.231.1">
     create an
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.232.1">
      X.509 certificate
     </span>
    </strong>
    <span class="koboSpan" id="kobo.233.1">
     for a public domain
    </span>
    <a id="_idIndexMarker755">
    </a>
    <span class="koboSpan" id="kobo.234.1">
     that we own using
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.235.1">
      AWS Certificate Manager
     </span>
    </strong>
    <span class="koboSpan" id="kobo.236.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.237.1">
      ACM
     </span>
    </strong>
    <span class="koboSpan" id="kobo.238.1">
     ).
    </span>
    <span class="koboSpan" id="kobo.238.2">
     ACM public
    </span>
    <a id="_idIndexMarker756">
    </a>
    <span class="koboSpan" id="kobo.239.1">
     certificates
    </span>
    <a id="_idIndexMarker757">
    </a>
    <span class="koboSpan" id="kobo.240.1">
     are
    </span>
    <a id="_idIndexMarker758">
    </a>
    <span class="koboSpan" id="kobo.241.1">
     used
    </span>
    <a id="_idIndexMarker759">
    </a>
    <span class="koboSpan" id="kobo.242.1">
     with
    </span>
    <a id="_idIndexMarker760">
    </a>
    <span class="koboSpan" id="kobo.243.1">
     AWS services such as
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.244.1">
      Elastic Load Balancing
     </span>
    </strong>
    <span class="koboSpan" id="kobo.245.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.246.1">
      ELB
     </span>
    </strong>
    <span class="koboSpan" id="kobo.247.1">
     ),
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.248.1">
      Amazon CloudFront
     </span>
    </strong>
    <span class="koboSpan" id="kobo.249.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.250.1">
      AWS Elastic Beanstalk
     </span>
    </strong>
    <span class="koboSpan" id="kobo.251.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.252.1">
      Amazon API Gateway
     </span>
    </strong>
    <span class="koboSpan" id="kobo.253.1">
     , and
    </span>
    <span class="No-Break">
     <strong class="bold">
      <span class="koboSpan" id="kobo.254.1">
       AWS CloudFormation
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.255.1">
      .
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-226">
    <a id="_idTextAnchor230">
    </a>
    <span class="koboSpan" id="kobo.256.1">
     Getting ready
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.257.1">
     We need the following to successfully complete
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.258.1">
      this recipe:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.259.1">
      A working AWS account,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.260.1">
       awsseccb-sandbox-1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.261.1">
      , and a user,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.262.1">
       awsseccbadmin1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.263.1">
      , as described in the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.264.1">
       Technical
      </span>
     </em>
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.265.1">
        requirements
       </span>
      </em>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.266.1">
       section.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.267.1">
      A domain name with any domain name provider (including AWS), with access to its control panel.
     </span>
     <span class="koboSpan" id="kobo.267.2">
      I will be using a domain with the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.268.1">
       name
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.269.1">
        trainso.io
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.270.1">
       .
      </span>
     </span>
    </li>
   </ul>
   <h2 id="_idParaDest-227">
    <a id="_idTextAnchor231">
    </a>
    <span class="koboSpan" id="kobo.271.1">
     How to do it...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.272.1">
     We can create a TLS certificate in ACM
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.273.1">
      as follows:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.274.1">
      Go to the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.275.1">
       AWS Certificate Manager
      </span>
     </strong>
     <span class="koboSpan" id="kobo.276.1">
      dashboard.
     </span>
     <span class="koboSpan" id="kobo.276.2">
      If you’re using ACM for the first time, you should see the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.277.1">
       Get started
      </span>
     </strong>
     <span class="koboSpan" id="kobo.278.1">
      options.
     </span>
     <span class="koboSpan" id="kobo.278.2">
      Currently, AWS provides options so that we can provision certificates, as well as create a
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.279.1">
       private CA.
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer168">
     <span class="koboSpan" id="kobo.280.1">
      <img alt="Figure 6.4 – The AWS Certificate Manager dashboard" src="image/B21384_06_4.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.281.1">
     Figure 6.4 – The AWS Certificate Manager dashboard
    </span>
   </p>
   <ol>
    <li value="2">
     <span class="koboSpan" id="kobo.282.1">
      In the left
     </span>
     <a id="_idIndexMarker761">
     </a>
     <span class="koboSpan" id="kobo.283.1">
      sidebar, we should
     </span>
     <a id="_idIndexMarker762">
     </a>
     <span class="koboSpan" id="kobo.284.1">
      see the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.285.1">
       Import a certificate
      </span>
     </strong>
     <span class="koboSpan" id="kobo.286.1">
      ,
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.287.1">
       List certificates
      </span>
     </strong>
     <span class="koboSpan" id="kobo.288.1">
      ,
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.289.1">
       Request a certificate
      </span>
     </strong>
     <span class="koboSpan" id="kobo.290.1">
      , and
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.291.1">
       AWS Private CA
      </span>
     </strong>
     <span class="koboSpan" id="kobo.292.1">
      options.
     </span>
     <span class="koboSpan" id="kobo.292.2">
      Click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.293.1">
       Request
      </span>
     </strong>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.294.1">
        a certificate
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.295.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.296.1">
      Select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.297.1">
       Request a public certificate
      </span>
     </strong>
     <span class="koboSpan" id="kobo.298.1">
      and click
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.299.1">
       on
      </span>
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.300.1">
        Next
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.301.1">
       .
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer169">
     <span class="koboSpan" id="kobo.302.1">
      <img alt="Figure 6.5 – Certificate type configuration" src="image/B21384_06_5.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.303.1">
     Figure 6.5 – Certificate type configuration
    </span>
   </p>
   <ol>
    <li value="4">
     <span class="koboSpan" id="kobo.304.1">
      Enter a fully qualified domain
     </span>
     <a id="_idIndexMarker763">
     </a>
     <span class="koboSpan" id="kobo.305.1">
      name in the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.306.1">
       Domain names
      </span>
     </strong>
     <span class="koboSpan" id="kobo.307.1">
      textbox.
     </span>
     <span class="koboSpan" id="kobo.307.2">
      To include
     </span>
     <a id="_idIndexMarker764">
     </a>
     <span class="koboSpan" id="kobo.308.1">
      all sub-domains, I will use a wildcard with the domain
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.309.1">
       name
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.310.1">
        *.trainso.io
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.311.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.312.1">
      For
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.313.1">
       Validation method
      </span>
     </strong>
     <span class="koboSpan" id="kobo.314.1">
      , select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.315.1">
       DNS validation -
      </span>
     </strong>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.316.1">
        recommended
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.317.1">
       .
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer170">
     <span class="koboSpan" id="kobo.318.1">
      <img alt="Figure 6.6 – Selecting a validation method" src="image/B21384_06_6.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.319.1">
     Figure 6.6 – Selecting a validation method
    </span>
   </p>
   <ol>
    <li value="6">
     <span class="koboSpan" id="kobo.320.1">
      For
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.321.1">
       Key algorithm
      </span>
     </strong>
     <span class="koboSpan" id="kobo.322.1">
      , select
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.323.1">
        RSA 2048
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.324.1">
       .
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer171">
     <span class="koboSpan" id="kobo.325.1">
      <img alt="Figure 6.7 – Selecting key algorithm" src="image/B21384_06_7.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.326.1">
     Figure 6.7 – Selecting key algorithm
    </span>
   </p>
   <ol>
    <li value="7">
     <span class="koboSpan" id="kobo.327.1">
      On the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.328.1">
       Add Tags
      </span>
     </strong>
     <span class="koboSpan" id="kobo.329.1">
      screen, add tags
     </span>
     <a id="_idIndexMarker765">
     </a>
     <span class="koboSpan" id="kobo.330.1">
      if required and click
     </span>
     <a id="_idIndexMarker766">
     </a>
     <span class="koboSpan" id="kobo.331.1">
      on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.332.1">
       Request
      </span>
     </strong>
     <span class="koboSpan" id="kobo.333.1">
      .
     </span>
     <span class="koboSpan" id="kobo.333.2">
      We should see the new certificate on the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.334.1">
       Certificates
      </span>
     </strong>
     <span class="koboSpan" id="kobo.335.1">
      page.
     </span>
     <span class="koboSpan" id="kobo.335.2">
      We can also reach the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.336.1">
       Certificates
      </span>
     </strong>
     <span class="koboSpan" id="kobo.337.1">
      page using the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.338.1">
       List certificates
      </span>
     </strong>
     <span class="koboSpan" id="kobo.339.1">
      option from the left sidebar.
     </span>
     <span class="koboSpan" id="kobo.339.2">
      The status of our certificate will be
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.340.1">
        Pending validation
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.341.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.342.1">
      On the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.343.1">
       Certificates
      </span>
     </strong>
     <span class="koboSpan" id="kobo.344.1">
      page, click on the hyperlinked certificate ID to go to the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.345.1">
       certificate’s page.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.346.1">
      Scroll down to the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.347.1">
       Domains
      </span>
     </strong>
     <span class="koboSpan" id="kobo.348.1">
      section, copy the CNAME name and CNAME value, and add them to our domain’s DNS records from the domain provider’s control panel.
     </span>
     <span class="koboSpan" id="kobo.348.2">
      Note that with most domain providers, you will not have to copy and paste the whole CNAME (short for Canonical Name) value but only the part before the first dot (
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.349.1">
       .
      </span>
     </strong>
     <span class="koboSpan" id="kobo.350.1">
      ).
     </span>
     <span class="koboSpan" id="kobo.350.2">
      For example, if our CNAME value is
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.351.1">
       _b262683f801a4eb13d8eb4a36cd8a2ba.trainso.io.
      </span>
     </strong>
     <span class="koboSpan" id="kobo.352.1">
      , we may have to only enter
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.353.1">
       _b262683f801a4eb13d8eb4a36cd8a2ba
      </span>
     </strong>
     <span class="koboSpan" id="kobo.354.1">
      as the CNAME value in our domain provider’s control panel, excluding the trailing
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.355.1">
       .trainso.io.
      </span>
     </strong>
     <span class="koboSpan" id="kobo.356.1">
      .
     </span>
     <span class="koboSpan" id="kobo.356.2">
      The domain provider could be Amazon Route 53 or an external provider, such as Namecheap or GoDaddy.
     </span>
     <span class="koboSpan" id="kobo.356.3">
      Configuring DNS is outside the scope of this book, but I will provide some useful references in the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.357.1">
       See also
      </span>
     </em>
     <span class="koboSpan" id="kobo.358.1">
      section of
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.359.1">
       this recipe.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.360.1">
      Once the CNAME
     </span>
     <a id="_idIndexMarker767">
     </a>
     <span class="koboSpan" id="kobo.361.1">
      record is updated, we can
     </span>
     <a id="_idIndexMarker768">
     </a>
     <span class="koboSpan" id="kobo.362.1">
      go to the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.363.1">
       Certificates
      </span>
     </strong>
     <span class="koboSpan" id="kobo.364.1">
      screen and check the status.
     </span>
     <span class="koboSpan" id="kobo.364.2">
      Once successful, the value of the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.365.1">
       Status
      </span>
     </strong>
     <span class="koboSpan" id="kobo.366.1">
      column of our certificate will change to
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.367.1">
       Issued
      </span>
     </strong>
     <span class="koboSpan" id="kobo.368.1">
      .
     </span>
     <span class="koboSpan" id="kobo.368.2">
      It could take some time for the DNS changes to propagate.
     </span>
     <span class="koboSpan" id="kobo.368.3">
      If the status is
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.369.1">
       Pending validation
      </span>
     </strong>
     <span class="koboSpan" id="kobo.370.1">
      , check again after some time, or refresh the page using the refresh button, until the status has changed
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.371.1">
       to
      </span>
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.372.1">
        Issued
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.373.1">
       .
      </span>
     </span>
    </li>
   </ol>
   <h2 id="_idParaDest-228">
    <a id="_idTextAnchor232">
    </a>
    <span class="koboSpan" id="kobo.374.1">
     How it works...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.375.1">
     In this recipe, we created a certificate using ACM.
    </span>
    <span class="koboSpan" id="kobo.375.2">
     We can request a certificate for one or more domain names.
    </span>
    <span class="koboSpan" id="kobo.375.3">
     We need to specify a fully qualified domain name, such as
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.376.1">
      www.trainso.io
     </span>
    </strong>
    <span class="koboSpan" id="kobo.377.1">
     , or one that uses a wildcard, such as
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.378.1">
      *.trainso.io
     </span>
    </strong>
    <span class="koboSpan" id="kobo.379.1">
     , representing all the subdomains
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.380.1">
      of
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.381.1">
       trainso.io
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.382.1">
      .
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.383.1">
     Before issuing the certificate, we need to validate the ownership of the domain.
    </span>
    <span class="koboSpan" id="kobo.383.2">
     We can do this either through DNS validation or email validation.
    </span>
    <span class="koboSpan" id="kobo.383.3">
     We performed DNS validation in this recipe.
    </span>
    <span class="koboSpan" id="kobo.383.4">
     AWS will provide a CNAME record per domain for DNS validation.
    </span>
    <span class="koboSpan" id="kobo.383.5">
     We need to update this CNAME record
    </span>
    <a id="_idIndexMarker769">
    </a>
    <span class="koboSpan" id="kobo.384.1">
     on our domain’s DNS management service.
    </span>
    <span class="koboSpan" id="kobo.384.2">
     Route 53 is Amazon’s DNS
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.385.1">
      management
     </span>
    </span>
    <span class="No-Break">
     <a id="_idIndexMarker770">
     </a>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.386.1">
      service.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-229">
    <a id="_idTextAnchor233">
    </a>
    <span class="koboSpan" id="kobo.387.1">
     There’s more...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.388.1">
     ACM public certificates are supported for AWS services such as ELB, Amazon CloudFront, AWS Elastic Beanstalk, Amazon API Gateway, and AWS CloudFormation.
    </span>
    <span class="koboSpan" id="kobo.388.2">
     AWS does not allow us to use the ACM public certificates to enable SSL/TLS on our EC2 instances.
    </span>
    <span class="koboSpan" id="kobo.388.3">
     However, ACM private CA-issued certificates can be used with EC2 instances, containers, and even our
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.389.1">
      own servers.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.390.1">
     AWS does not charge us for the public TLS certificates that are provisioned through ACM.
    </span>
    <span class="koboSpan" id="kobo.390.2">
     We only need to pay for the AWS resources we create to run our application.
    </span>
    <span class="koboSpan" id="kobo.390.3">
     However, creating an ACM private CA is not free.
    </span>
    <span class="koboSpan" id="kobo.390.4">
     For a private CA, we are charged a monthly fee, as well as for the private certificates we issue.
    </span>
    <span class="koboSpan" id="kobo.390.5">
     We are not charged once we delete a private CA; however, if we restore a private CA, we will be charged for the time it was in the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.391.1">
      deleted state.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-230">
    <a id="_idTextAnchor234">
    </a>
    <span class="koboSpan" id="kobo.392.1">
     See also
    </span>
   </h2>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.393.1">
      We can learn
     </span>
     <a id="_idIndexMarker771">
     </a>
     <span class="koboSpan" id="kobo.394.1">
      more about DNS
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.395.1">
       here:
      </span>
     </span>
     <a href="https://www.secdops.com/blog/mastering-dns-resources-and-recipes">
      <span class="No-Break">
       <span class="koboSpan" id="kobo.396.1">
        https://www.secdops.com/blog/mastering-dns-resources-and-recipes
       </span>
      </span>
     </a>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.397.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.398.1">
      We can read more about
     </span>
     <a id="_idIndexMarker772">
     </a>
     <span class="koboSpan" id="kobo.399.1">
      ACM service integrations and view the current list of supported services
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.400.1">
       here:
      </span>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.401.1">
       https://docs.aws.amazon.com/acm/latest/userguide/acm-services.html
      </span>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.402.1">
       .
      </span>
     </span>
    </li>
   </ul>
   <h1 id="_idParaDest-231">
    <a id="_idTextAnchor235">
    </a>
    <span class="koboSpan" id="kobo.403.1">
     Creating ELB target groups
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.404.1">
     In this recipe, we will
    </span>
    <a id="_idIndexMarker773">
    </a>
    <span class="koboSpan" id="kobo.405.1">
     learn how to create an
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.406.1">
      Elastic Load Balancer
     </span>
    </strong>
    <span class="koboSpan" id="kobo.407.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.408.1">
      ELB
     </span>
    </strong>
    <span class="koboSpan" id="kobo.409.1">
     )
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.410.1">
      target group
     </span>
    </strong>
    <span class="koboSpan" id="kobo.411.1">
     .
    </span>
    <span class="koboSpan" id="kobo.411.2">
     The application load balancer and network load balancer route traffic to ELB target groups, unlike classic load balancers, which route traffic to individual
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.412.1">
      EC2 instances.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-232">
    <a id="_idTextAnchor236">
    </a>
    <span class="koboSpan" id="kobo.413.1">
     Getting ready
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.414.1">
     To follow this recipe, we need
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.415.1">
      the following:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.416.1">
      A working AWS account,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.417.1">
       awsseccb-sandbox-1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.418.1">
      , and a user
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.419.1">
       awsseccbadmin1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.420.1">
      , as described in the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.421.1">
       Technical
      </span>
     </em>
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.422.1">
        requirements
       </span>
      </em>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.423.1">
       section.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.424.1">
      A VPC,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.425.1">
       awsseccb-vpc
      </span>
     </strong>
     <span class="koboSpan" id="kobo.426.1">
      , following the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.427.1">
       Setting up VPC plus VPC resources with minimal efforts
      </span>
     </em>
     <span class="koboSpan" id="kobo.428.1">
      recipe from
     </span>
     <a href="B21384_05.xhtml#_idTextAnchor169">
      <span class="No-Break">
       <em class="italic">
        <span class="koboSpan" id="kobo.429.1">
         Chapter 5
        </span>
       </em>
      </span>
     </a>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.430.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.431.1">
      Two EC2 instances in the aforementioned
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.432.1">
       awsseccb-vpc
      </span>
     </strong>
     <span class="koboSpan" id="kobo.433.1">
      VPC, following the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.434.1">
       Launching an EC2 instance with a web server using user data
      </span>
     </em>
     <span class="koboSpan" id="kobo.435.1">
      recipe in
     </span>
     <a href="B21384_05.xhtml#_idTextAnchor169">
      <span class="No-Break">
       <em class="italic">
        <span class="koboSpan" id="kobo.436.1">
         Chapter 5
        </span>
       </em>
      </span>
     </a>
     <span class="koboSpan" id="kobo.437.1">
      , with the following exceptions.
     </span>
     <span class="koboSpan" id="kobo.437.2">
      Give names as
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.438.1">
       Cloudericks Web Server
      </span>
     </strong>
     <span class="koboSpan" id="kobo.439.1">
      and
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.440.1">
       Cloudericks Web Server 2
      </span>
     </strong>
     <span class="koboSpan" id="kobo.441.1">
      , respectively,
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.442.1">
       while creation.
      </span>
     </span>
    </li>
   </ul>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.443.1">
     Tip
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.444.1">
     Name is internally represented using a tag with key set
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.445.1">
      to
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.446.1">
       Name
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.447.1">
      .
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.448.1">
      Subnets should be public
     </span>
     <a id="_idIndexMarker774">
     </a>
     <span class="koboSpan" id="kobo.449.1">
      and selected in the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.450.1">
       us-east-1a
      </span>
     </strong>
     <span class="koboSpan" id="kobo.451.1">
      and
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.452.1">
       us-east-1b
      </span>
     </strong>
     <span class="koboSpan" id="kobo.453.1">
      availability zones, respectively.
     </span>
     <span class="koboSpan" id="kobo.453.2">
      For the second instance, replace
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.454.1">
       Cloudericks Web Server
      </span>
     </strong>
     <span class="koboSpan" id="kobo.455.1">
      within the user data with
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.456.1">
       Cloudericks Web Server 2
      </span>
     </strong>
     <span class="koboSpan" id="kobo.457.1">
      to distinguish the two web servers.
     </span>
     <span class="koboSpan" id="kobo.457.2">
      The key pair and security group can be shared between the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.458.1">
       two instances.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.459.1">
      Before proceeding, make sure that our instances are running and accessible directly from a browser.
     </span>
     <span class="koboSpan" id="kobo.459.2">
      For additional security, after the ELB has been configured and tested, we can restrict access to these instances from our ELB’s
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.460.1">
       security group.
      </span>
     </span>
    </li>
   </ul>
   <h2 id="_idParaDest-233">
    <a id="_idTextAnchor237">
    </a>
    <span class="koboSpan" id="kobo.461.1">
     How to do it...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.462.1">
     We can create a target group
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.463.1">
      as follows:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.464.1">
      Log into the AWS Management Console and go to the
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.465.1">
        EC2
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.466.1">
       service.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.467.1">
      In the left sidebar, under
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.468.1">
       Load Balancing
      </span>
     </strong>
     <span class="koboSpan" id="kobo.469.1">
      , click on
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.470.1">
        Target Groups
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.471.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.472.1">
      Click
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.473.1">
       Create
      </span>
     </strong>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.474.1">
        target group
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.475.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.476.1">
      On the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.477.1">
       Specify group details
      </span>
     </strong>
     <span class="koboSpan" id="kobo.478.1">
      page, under the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.479.1">
       Basic configuration
      </span>
     </strong>
     <span class="koboSpan" id="kobo.480.1">
      section, select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.481.1">
       Instances
      </span>
     </strong>
     <span class="koboSpan" id="kobo.482.1">
      for
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.483.1">
       Choose a
      </span>
     </strong>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.484.1">
        target type
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.485.1">
       .
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer172">
     <span class="koboSpan" id="kobo.486.1">
      <img alt="Figure 6.8 – Choosing a target type" src="image/B21384_06_8.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.487.1">
     Figure 6.8 – Choosing a target type
    </span>
   </p>
   <ol>
    <li value="5">
     <span class="koboSpan" id="kobo.488.1">
      For
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.489.1">
       Target group name
      </span>
     </strong>
     <span class="koboSpan" id="kobo.490.1">
      , enter
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.491.1">
       cloudericks-tg
      </span>
     </strong>
     <span class="koboSpan" id="kobo.492.1">
      , or a meaningful name
     </span>
     <a id="_idIndexMarker775">
     </a>
     <span class="koboSpan" id="kobo.493.1">
      specific to your
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.494.1">
       user case.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.495.1">
      For
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.496.1">
       Protocol: Port
      </span>
     </strong>
     <span class="koboSpan" id="kobo.497.1">
      , select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.498.1">
       HTTP
      </span>
     </strong>
     <span class="koboSpan" id="kobo.499.1">
      ; for
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.500.1">
       Port
      </span>
     </strong>
     <span class="koboSpan" id="kobo.501.1">
      , enter
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.502.1">
       80
      </span>
     </strong>
     <span class="koboSpan" id="kobo.503.1">
      ; and for
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.504.1">
       IP address type
      </span>
     </strong>
     <span class="koboSpan" id="kobo.505.1">
      ,
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.506.1">
       select
      </span>
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.507.1">
        IPv4
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.508.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.509.1">
      For
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.510.1">
       VPC
      </span>
     </strong>
     <span class="koboSpan" id="kobo.511.1">
      , select the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.512.1">
       awsseccb-vpc
      </span>
     </strong>
     <span class="koboSpan" id="kobo.513.1">
      VPC, where our EC2 instances
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.514.1">
       are present.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.515.1">
      Under
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.516.1">
       Protocol version
      </span>
     </strong>
     <span class="koboSpan" id="kobo.517.1">
      ,
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.518.1">
       select
      </span>
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.519.1">
        HTTP1
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.520.1">
       .
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer173">
     <span class="koboSpan" id="kobo.521.1">
      <img alt="Figure 6.9 – Selecting the protocol version" src="image/B21384_06_9.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.522.1">
     Figure 6.9 – Selecting the protocol version
    </span>
   </p>
   <ol>
    <li value="9">
     <span class="koboSpan" id="kobo.523.1">
      In the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.524.1">
       Health checks
      </span>
     </strong>
     <span class="koboSpan" id="kobo.525.1">
      section, for
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.526.1">
       Health check protocol
      </span>
     </strong>
     <span class="koboSpan" id="kobo.527.1">
      , select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.528.1">
       HTTP
      </span>
     </strong>
     <span class="koboSpan" id="kobo.529.1">
      , and for
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.530.1">
       Health check path
      </span>
     </strong>
     <span class="koboSpan" id="kobo.531.1">
      , enter
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.532.1">
       /index.html
      </span>
     </strong>
     <span class="koboSpan" id="kobo.533.1">
      .
     </span>
     <span class="koboSpan" id="kobo.533.2">
      Leave other values
     </span>
     <a id="_idIndexMarker776">
     </a>
     <span class="koboSpan" id="kobo.534.1">
      as-is and click
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.535.1">
       on
      </span>
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.536.1">
        Next
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.537.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.538.1">
      In the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.539.1">
       Register targets
      </span>
     </strong>
     <span class="koboSpan" id="kobo.540.1">
      pane, select the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.541.1">
       Cloudericks Web Server
      </span>
     </strong>
     <span class="koboSpan" id="kobo.542.1">
      and
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.543.1">
       Cloudericks Web Server 2
      </span>
     </strong>
     <span class="koboSpan" id="kobo.544.1">
      EC2 instances and click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.545.1">
       Include as pending below
      </span>
     </strong>
     <span class="koboSpan" id="kobo.546.1">
      .
     </span>
     <span class="koboSpan" id="kobo.546.2">
      Instances should now appear under
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.547.1">
        Review targets
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.548.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.549.1">
      Click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.550.1">
       Create target group
      </span>
     </strong>
     <span class="koboSpan" id="kobo.551.1">
      .
     </span>
     <span class="koboSpan" id="kobo.551.2">
      We should see a message that the target group has been
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.552.1">
       created successfully.
      </span>
     </span>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.553.1">
       The health status of the targets will now be
      </span>
      <strong class="bold">
       <span class="koboSpan" id="kobo.554.1">
        Unused
       </span>
      </strong>
      <span class="koboSpan" id="kobo.555.1">
       .
      </span>
      <span class="koboSpan" id="kobo.555.2">
       It will change after they have been attached to
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.556.1">
        an ELB.
       </span>
      </span>
     </p>
    </li>
   </ol>
   <h2 id="_idParaDest-234">
    <a id="_idTextAnchor238">
    </a>
    <span class="koboSpan" id="kobo.557.1">
     How it works...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.558.1">
     In this recipe, we created a target group for EC2 instances with the HTTP protocol.
    </span>
    <span class="koboSpan" id="kobo.558.2">
     We can create an application load balancer with a target group, using the HTTP or HTTPS protocol.
    </span>
    <span class="koboSpan" id="kobo.558.3">
     A network load balancer needs a target group with a TCP or TLS protocol.
    </span>
    <span class="koboSpan" id="kobo.558.4">
     We can also create target groups for IP addresses and AWS Lambda functions.
    </span>
    <span class="koboSpan" id="kobo.558.5">
     By selecting the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.559.1">
      IP addresses
     </span>
    </strong>
    <span class="koboSpan" id="kobo.560.1">
     option, we can select public IP addresses that are outside
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.561.1">
      of AWS.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.562.1">
     For the health check, we set the protocol to HTTP and the path to
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.563.1">
      /index.html
     </span>
    </strong>
    <span class="koboSpan" id="kobo.564.1">
     .
    </span>
    <span class="koboSpan" id="kobo.564.2">
     We can override the port for a health check, if necessary, by selecting the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.565.1">
      Override
     </span>
    </strong>
    <span class="koboSpan" id="kobo.566.1">
     option for the port, under
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.567.1">
      Advanced health check settings
     </span>
    </strong>
    <span class="koboSpan" id="kobo.568.1">
     .
    </span>
    <span class="koboSpan" id="kobo.568.2">
     We can set the time to wait for a response from an instance (timeout), the time between health checks (interval), the number of consecutive failures before declaring an instance unhealthy (unhealthy threshold), the number of consecutive successes before declaring an instance healthy (healthy threshold), and the HTTP response codes to check for success (
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.569.1">
      success codes).
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.570.1">
     The target group instances
    </span>
    <a id="_idIndexMarker777">
    </a>
    <span class="koboSpan" id="kobo.571.1">
     will have an initial state of unused when they are created.
    </span>
    <span class="koboSpan" id="kobo.571.2">
     When the target group is attached to an ELB, the status will change to initial.
    </span>
    <span class="koboSpan" id="kobo.571.3">
     If the health checks pass, then the status changes to
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.572.1">
      Healthy
     </span>
    </strong>
    <span class="koboSpan" id="kobo.573.1">
     .
    </span>
    <span class="koboSpan" id="kobo.573.2">
     Other supported statuses include unhealthy if the health check fails, or draining if the target is being unregistered and connection draining
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.574.1">
      is happening.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-235">
    <a id="_idTextAnchor239">
    </a>
    <span class="koboSpan" id="kobo.575.1">
     There’s more...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.576.1">
     In this recipe, we created a target group with the HTTP protocol.
    </span>
    <span class="koboSpan" id="kobo.576.2">
     Target groups can be created with the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.577.1">
      HTTP
     </span>
    </strong>
    <span class="koboSpan" id="kobo.578.1">
     ,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.579.1">
      HTTPS
     </span>
    </strong>
    <span class="koboSpan" id="kobo.580.1">
     ,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.581.1">
      TCP
     </span>
    </strong>
    <span class="koboSpan" id="kobo.582.1">
     ,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.583.1">
      TLS
     </span>
    </strong>
    <span class="koboSpan" id="kobo.584.1">
     ,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.585.1">
      UDP
     </span>
    </strong>
    <span class="koboSpan" id="kobo.586.1">
     ,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.587.1">
      GENEVE
     </span>
    </strong>
    <span class="koboSpan" id="kobo.588.1">
     , and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.589.1">
      TCP_UDP
     </span>
    </strong>
    <span class="koboSpan" id="kobo.590.1">
     protocols.
    </span>
    <span class="koboSpan" id="kobo.590.2">
     We can follow the steps in this recipe to create target groups with other protocols.
    </span>
    <span class="koboSpan" id="kobo.590.3">
     For example, we can add a target group with the HTTPS protocol and the port set to
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.591.1">
      443
     </span>
    </strong>
    <span class="koboSpan" id="kobo.592.1">
     , and then add EC2 instances with SSL/TLS enabled to the target group.
    </span>
    <span class="koboSpan" id="kobo.592.2">
     For TCP passthrough of an HTTPS request with a network load balancer, which is needed for TLS termination at EC2, we should set the protocol to TCP but with the port set
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.593.1">
      to
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.594.1">
       443
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.595.1">
      .
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-236">
    <a id="_idTextAnchor240">
    </a>
    <span class="koboSpan" id="kobo.596.1">
     See also
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.597.1">
     We can read more about
    </span>
    <a id="_idIndexMarker778">
    </a>
    <span class="koboSpan" id="kobo.598.1">
     load balancing in AWS
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.599.1">
      at
     </span>
    </span>
    <a href="https://www.cloudericks.com/blog/understanding-load-balancing-in-aws">
     <span class="No-Break">
      <span class="koboSpan" id="kobo.600.1">
       https://www.cloudericks.com/blog/understanding-load-balancing-in-aws
      </span>
     </span>
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.601.1">
      .
     </span>
    </span>
   </p>
   <h1 id="_idParaDest-237">
    <a id="_idTextAnchor241">
    </a>
    <span class="koboSpan" id="kobo.602.1">
     Using an application load balancer with TLS termination at the ELB
    </span>
   </h1>
   <p>
    <strong class="bold">
     <span class="koboSpan" id="kobo.603.1">
      Application load balancers
     </span>
    </strong>
    <span class="koboSpan" id="kobo.604.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.605.1">
      ALBs
     </span>
    </strong>
    <span class="koboSpan" id="kobo.606.1">
     ) work at the request layer (application layer of the OSI model) and
    </span>
    <a id="_idIndexMarker779">
    </a>
    <span class="koboSpan" id="kobo.607.1">
     are used for HTTP
    </span>
    <a id="_idIndexMarker780">
    </a>
    <span class="koboSpan" id="kobo.608.1">
     and HTTPS requests.
    </span>
    <span class="koboSpan" id="kobo.608.2">
     ALBs provide advanced routing capabilities at the application layer for requesting and path parameter-based routing.
    </span>
    <span class="koboSpan" id="kobo.608.3">
     Architecture patterns, such as microservices architecture, can use ALBs to route requests to different web servers while making use of
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.609.1">
      request parameters.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-238">
    <a id="_idTextAnchor242">
    </a>
    <span class="koboSpan" id="kobo.610.1">
     Getting ready
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.611.1">
     To follow this
    </span>
    <a id="_idIndexMarker781">
    </a>
    <span class="koboSpan" id="kobo.612.1">
     recipe, we need
    </span>
    <a id="_idIndexMarker782">
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.613.1">
      the following:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.614.1">
      A working AWS account,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.615.1">
       awsseccb-sandbox-1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.616.1">
      , and a user
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.617.1">
       awsseccbadmin1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.618.1">
      , as described in the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.619.1">
       Technical
      </span>
     </em>
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.620.1">
        requirements
       </span>
      </em>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.621.1">
       section.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.622.1">
      Create a target group,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.623.1">
       cloudericks-tg
      </span>
     </strong>
     <span class="koboSpan" id="kobo.624.1">
      , with two EC2 instances, following the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.625.1">
       Creating ELB target groups
      </span>
     </em>
     <span class="koboSpan" id="kobo.626.1">
      recipe of this chapter, and the following resources should have been created as part of the preparation for that recipe – a VPC,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.627.1">
       awsseccb-vpc
      </span>
     </strong>
     <span class="koboSpan" id="kobo.628.1">
      , and a security
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.629.1">
       group,
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.630.1">
        cloudericks-web-server
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.631.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.632.1">
      To select HTTPS (secure HTTP) as the ELB listening protocol, we need an ACM certificate.
     </span>
     <span class="koboSpan" id="kobo.632.2">
      We can create an ACM certificate by following the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.633.1">
       Creating an SSL/TLS certificate with ACM
      </span>
     </em>
     <span class="koboSpan" id="kobo.634.1">
      recipe of
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.635.1">
       this chapter.
      </span>
     </span>
    </li>
   </ul>
   <h2 id="_idParaDest-239">
    <a id="_idTextAnchor243">
    </a>
    <span class="koboSpan" id="kobo.636.1">
     How to do it...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.637.1">
     We can create and test an ALB
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.638.1">
      as follows:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.639.1">
      Go to the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.640.1">
       EC2
      </span>
     </strong>
     <span class="koboSpan" id="kobo.641.1">
      service in
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.642.1">
       the console.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.643.1">
      In the left sidebar, under
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.644.1">
       Load Balancing
      </span>
     </strong>
     <span class="koboSpan" id="kobo.645.1">
      , click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.646.1">
       Load Balancers
      </span>
     </strong>
     <span class="koboSpan" id="kobo.647.1">
      from the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.648.1">
       left sidebar.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.649.1">
      Click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.650.1">
       Create
      </span>
     </strong>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.651.1">
        load balancer
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.652.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.653.1">
      We should see the options
     </span>
     <a id="_idIndexMarker783">
     </a>
     <span class="koboSpan" id="kobo.654.1">
      to create the three primary types
     </span>
     <a id="_idIndexMarker784">
     </a>
     <span class="koboSpan" id="kobo.655.1">
      of load balancers – namely,
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.656.1">
       Application Load Balancer
      </span>
     </strong>
     <span class="koboSpan" id="kobo.657.1">
      ,
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.658.1">
       Network Load Balancer
      </span>
     </strong>
     <span class="koboSpan" id="kobo.659.1">
      , and
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.660.1">
       Gateway Load Balancer
      </span>
     </strong>
     <span class="koboSpan" id="kobo.661.1">
      .
     </span>
     <span class="koboSpan" id="kobo.661.2">
      Click
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.662.1">
       Create
      </span>
     </strong>
     <span class="koboSpan" id="kobo.663.1">
      under
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.664.1">
       Application
      </span>
     </strong>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.665.1">
        Load Balancer
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.666.1">
       .
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer174">
     <span class="koboSpan" id="kobo.667.1">
      <img alt="Figure 6.10 – The load balancer types" src="image/B21384_06_10.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.668.1">
     Figure 6.10 – The load balancer types
    </span>
   </p>
   <ol>
    <li value="5">
     <span class="koboSpan" id="kobo.669.1">
      On the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.670.1">
       Basic configuration
      </span>
     </strong>
     <span class="koboSpan" id="kobo.671.1">
      screen, for
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.672.1">
       Load balancer name
      </span>
     </strong>
     <span class="koboSpan" id="kobo.673.1">
      , enter
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.674.1">
       cloudericks-app-lb
      </span>
     </strong>
     <span class="koboSpan" id="kobo.675.1">
      , or a meaningful name as required.
     </span>
     <span class="koboSpan" id="kobo.675.2">
      For
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.676.1">
       Scheme
      </span>
     </strong>
     <span class="koboSpan" id="kobo.677.1">
      , select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.678.1">
       Internet-facing
      </span>
     </strong>
     <span class="koboSpan" id="kobo.679.1">
      , and for
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.680.1">
       IP address type
      </span>
     </strong>
     <span class="koboSpan" id="kobo.681.1">
      ,
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.682.1">
       select
      </span>
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.683.1">
        IPv4
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.684.1">
       .
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer175">
     <span class="koboSpan" id="kobo.685.1">
      <img alt="Figure 6.11 – Basic configuration" src="image/B21384_06_11.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.686.1">
     Figure 6.11 – Basic configuration
    </span>
   </p>
   <ol>
    <li value="6">
     <span class="koboSpan" id="kobo.687.1">
      In the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.688.1">
       Network mapping
      </span>
     </strong>
     <span class="koboSpan" id="kobo.689.1">
      section, for
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.690.1">
       VPC
      </span>
     </strong>
     <span class="koboSpan" id="kobo.691.1">
      , select our
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.692.1">
       VPC,
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.693.1">
        awsseccb-vpc
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.694.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.695.1">
      In the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.696.1">
       Network mapping
      </span>
     </strong>
     <span class="koboSpan" id="kobo.697.1">
      section, under
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.698.1">
       Mappings
      </span>
     </strong>
     <span class="koboSpan" id="kobo.699.1">
      , select
     </span>
     <a id="_idIndexMarker785">
     </a>
     <span class="koboSpan" id="kobo.700.1">
      the availability
     </span>
     <a id="_idIndexMarker786">
     </a>
     <span class="koboSpan" id="kobo.701.1">
      zones and public subnets where we have
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.702.1">
       our instances.
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer176">
     <span class="koboSpan" id="kobo.703.1">
      <img alt="Figure 6.12 – Selecting the availability zones and subnets" src="image/B21384_06_12.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.704.1">
     Figure 6.12 – Selecting the availability zones and subnets
    </span>
   </p>
   <ol>
    <li value="8">
     <span class="koboSpan" id="kobo.705.1">
      Select the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.706.1">
       cloudericks-web-server
      </span>
     </strong>
     <span class="koboSpan" id="kobo.707.1">
      security
     </span>
     <a id="_idIndexMarker787">
     </a>
     <span class="koboSpan" id="kobo.708.1">
      group, which
     </span>
     <a id="_idIndexMarker788">
     </a>
     <span class="koboSpan" id="kobo.709.1">
      allows
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.710.1">
       HTTP
      </span>
     </strong>
     <span class="koboSpan" id="kobo.711.1">
      and
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.712.1">
       HTTPS
      </span>
     </strong>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.713.1">
       from
      </span>
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.714.1">
        Anywhere
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.715.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.716.1">
      Under
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.717.1">
       Listeners and routing
      </span>
     </strong>
     <span class="koboSpan" id="kobo.718.1">
      , set
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.719.1">
       Protocol
      </span>
     </strong>
     <span class="koboSpan" id="kobo.720.1">
      to
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.721.1">
       HTTPS
      </span>
     </strong>
     <span class="koboSpan" id="kobo.722.1">
      .
     </span>
     <span class="koboSpan" id="kobo.722.2">
      The port will be set automatically to
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.723.1">
       443
      </span>
     </strong>
     <span class="koboSpan" id="kobo.724.1">
      .
     </span>
     <span class="koboSpan" id="kobo.724.2">
      For
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.725.1">
       Default action
      </span>
     </strong>
     <span class="koboSpan" id="kobo.726.1">
      , select our target
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.727.1">
       group,
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.728.1">
        cloudericks-tg
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.729.1">
       .
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer177">
     <span class="koboSpan" id="kobo.730.1">
      <img alt="Figure 6.13 – Adding an HTTPS Listener" src="image/B21384_06_13.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.731.1">
     Figure 6.13 – Adding an HTTPS Listener
    </span>
   </p>
   <ol>
    <li value="10">
     <span class="koboSpan" id="kobo.732.1">
      Under
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.733.1">
       Secure listener settings
      </span>
     </strong>
     <span class="koboSpan" id="kobo.734.1">
      , for
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.735.1">
       Certificate source
      </span>
     </strong>
     <span class="koboSpan" id="kobo.736.1">
      , select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.737.1">
       From ACM
      </span>
     </strong>
     <span class="koboSpan" id="kobo.738.1">
      , and for
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.739.1">
       Certificate name
      </span>
     </strong>
     <span class="koboSpan" id="kobo.740.1">
      , select
     </span>
     <a id="_idIndexMarker789">
     </a>
     <span class="koboSpan" id="kobo.741.1">
      the ACM certificate
     </span>
     <a id="_idIndexMarker790">
     </a>
     <span class="koboSpan" id="kobo.742.1">
      we created for
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.743.1">
       this recipe.
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer178">
     <span class="koboSpan" id="kobo.744.1">
      <img alt="Figure 6.14 – Selecting an SSL/TLS server certificate" src="image/B21384_06_14.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.745.1">
     Figure 6.14 – Selecting an SSL/TLS server certificate
    </span>
   </p>
   <ol>
    <li value="11">
     <span class="koboSpan" id="kobo.746.1">
      Optionally, you can include
     </span>
     <a id="_idIndexMarker791">
     </a>
     <span class="koboSpan" id="kobo.747.1">
      an AWS WAF or create an
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.748.1">
       AWS Global Accelerator
      </span>
     </strong>
     <span class="koboSpan" id="kobo.749.1">
      for this load balancer, as shown in the following screenshot.
     </span>
     <span class="koboSpan" id="kobo.749.2">
      Let’s skip them
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.750.1">
       for now.
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer179">
     <span class="koboSpan" id="kobo.751.1">
      <img alt="Figure 6.15 – Configuring AWS WAF and AWS Global Accelerator" src="image/B21384_06_15.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.752.1">
     Figure 6.15 – Configuring AWS WAF and AWS Global Accelerator
    </span>
   </p>
   <ol>
    <li value="12">
     <span class="koboSpan" id="kobo.753.1">
      Review the details
     </span>
     <a id="_idIndexMarker792">
     </a>
     <span class="koboSpan" id="kobo.754.1">
      and click
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.755.1">
       Create load balancer
      </span>
     </strong>
     <span class="koboSpan" id="kobo.756.1">
      .
     </span>
     <span class="koboSpan" id="kobo.756.2">
      If we go
     </span>
     <a id="_idIndexMarker793">
     </a>
     <span class="koboSpan" id="kobo.757.1">
      to the target group,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.758.1">
       cloudericks-tg
      </span>
     </strong>
     <span class="koboSpan" id="kobo.759.1">
      , the health status of our instances will be first
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.760.1">
       Initial
      </span>
     </strong>
     <span class="koboSpan" id="kobo.761.1">
      , and after some time, the status should change
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.762.1">
       to
      </span>
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.763.1">
        Healthy
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.764.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.765.1">
      Copy the DNS name from the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.766.1">
       Description
      </span>
     </strong>
     <span class="koboSpan" id="kobo.767.1">
      tab of the ELB, add the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.768.1">
       https://
      </span>
     </strong>
     <span class="koboSpan" id="kobo.769.1">
      prefix to it, as shown in the following figure, and enter this URL in a browser.
     </span>
     <span class="koboSpan" id="kobo.769.2">
      Should a security warning appear, select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.770.1">
       Advanced
      </span>
     </strong>
     <span class="koboSpan" id="kobo.771.1">
      , and then click the link to continue.
     </span>
     <span class="koboSpan" id="kobo.771.2">
      This will display one of the web servers.
     </span>
     <span class="koboSpan" id="kobo.771.3">
      By refreshing the page multiple times, you can observe the response from both
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.772.1">
       web servers.
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer180">
     <span class="koboSpan" id="kobo.773.1">
      <img alt="Figure 6.16 – The response from the load balancer, showing our first instance data" src="image/B21384_06_16.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.774.1">
     Figure 6.16 – The response from the load balancer, showing our first instance data
    </span>
   </p>
   <p class="list-inset">
    <span class="koboSpan" id="kobo.775.1">
     We will get a warning, since
    </span>
    <a id="_idIndexMarker794">
    </a>
    <span class="koboSpan" id="kobo.776.1">
     our URL (ELB DNS) does not match
    </span>
    <a id="_idIndexMarker795">
    </a>
    <span class="koboSpan" id="kobo.777.1">
     the certificate’s domain, which is
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.778.1">
      *.trainso.io
     </span>
    </strong>
    <span class="koboSpan" id="kobo.779.1">
     in
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.780.1">
      my case.
     </span>
    </span>
   </p>
   <ol>
    <li value="14">
     <span class="koboSpan" id="kobo.781.1">
      Create a
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.782.1">
       CNAME
      </span>
     </strong>
     <span class="koboSpan" id="kobo.783.1">
      record for the domain, with
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.784.1">
       Name
      </span>
     </strong>
     <span class="koboSpan" id="kobo.785.1">
      (or
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.786.1">
       Host
      </span>
     </strong>
     <span class="koboSpan" id="kobo.787.1">
      ) set to
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.788.1">
       cloudericks.trainso.io
      </span>
     </strong>
     <span class="koboSpan" id="kobo.789.1">
      (this will be only
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.790.1">
       cloudericks
      </span>
     </strong>
     <span class="koboSpan" id="kobo.791.1">
      if the DNS service provider automatically appends the domain name) and
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.792.1">
       Value
      </span>
     </strong>
     <span class="koboSpan" id="kobo.793.1">
      as our DNS name, which in my case is
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.794.1">
       cloudericks-app-lb-901703641.us-east-1.elb.amazonaws.com
      </span>
     </strong>
     <span class="koboSpan" id="kobo.795.1">
      .
     </span>
     <span class="koboSpan" id="kobo.795.2">
      Remember to replace
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.796.1">
       trainso.io
      </span>
     </strong>
     <span class="koboSpan" id="kobo.797.1">
      with the domain for which you created
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.798.1">
       the certificate.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.799.1">
      Once the DNS changes are propagated, which could take some time, we should be able to run our subdomain URL (e.g.,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.800.1">
       cloudericks.trainso.io
      </span>
     </strong>
     <span class="koboSpan" id="kobo.801.1">
      in my case) and we should get a successful response, as seen in the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.802.1">
       following figure:
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer181">
     <span class="koboSpan" id="kobo.803.1">
      <img alt="Figure 6.17 – A successful HTTPS response with an SSL/TLS certificate" src="image/B21384_06_17.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.804.1">
     Figure 6.17 – A successful HTTPS response with an SSL/TLS certificate
    </span>
   </p>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.805.1">
     Important note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.806.1">
     There are multiple ways to point our domain with ELB, including creating a Route 53 account and changing the names of the servers of our domain, or adding a CNAME record for
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.807.1">
      a subdomain.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-240">
    <a id="_idTextAnchor244">
    </a>
    <span class="koboSpan" id="kobo.808.1">
     How it works...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.809.1">
     In this recipe, we created
    </span>
    <a id="_idIndexMarker796">
    </a>
    <span class="koboSpan" id="kobo.810.1">
     an internet-facing load
    </span>
    <a id="_idIndexMarker797">
    </a>
    <span class="koboSpan" id="kobo.811.1">
     balancer.
    </span>
    <span class="koboSpan" id="kobo.811.2">
     We set the listening protocol to HTTPS (secure HTTP), and on the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.812.1">
      Configure Security Settings
     </span>
    </strong>
    <span class="koboSpan" id="kobo.813.1">
     page, we selected an ACM certificate.
    </span>
    <span class="koboSpan" id="kobo.813.2">
     We set the security policy to
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.814.1">
      ELBSecurityPolicy-2016-08
     </span>
    </strong>
    <span class="koboSpan" id="kobo.815.1">
     .
    </span>
    <span class="koboSpan" id="kobo.815.2">
     The security policy is an SSL negotiation configuration that’s used to negotiate SSL connections
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.816.1">
      with clients.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.817.1">
     We terminated TLS at the ELB level.
    </span>
    <span class="koboSpan" id="kobo.817.2">
     Note that the connection to the instance from the ELB is without TLS.
    </span>
    <span class="koboSpan" id="kobo.817.3">
     The ALB only supports TLS/SSL termination at the ELB level.
    </span>
    <span class="koboSpan" id="kobo.817.4">
     The network load balancer and classic load balancer can be used to terminate TLS/SSL at the EC2 instance level, by using the TCP protocol on
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.818.1">
      port
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.819.1">
       443
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.820.1">
      .
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.821.1">
     When we terminate TLS at the ELB for an HTTPS request, the request is decrypted at the ELB and sent unencrypted to the EC2 instances over the private network within our VPC.
    </span>
    <span class="koboSpan" id="kobo.821.2">
     When we terminate an HTTPS request’s TLS at the EC2 instance, the request is not decrypted at the ELB and is only decrypted at the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.822.1">
      EC2 instance.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.823.1">
     Terminating TLS at the ELB level avoids the overhead of TLS termination at EC2 instances and is more efficient.
    </span>
    <span class="koboSpan" id="kobo.823.2">
     However, if there is a compliance requirement for end-to-end encryption, we should terminate at the EC2
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.824.1">
      instance level.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-241">
    <a id="_idTextAnchor245">
    </a>
    <span class="koboSpan" id="kobo.825.1">
     There’s more...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.826.1">
     Let’s quickly go through some more important concepts
    </span>
    <a id="_idIndexMarker798">
    </a>
    <span class="koboSpan" id="kobo.827.1">
     related
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.828.1">
      to ALBs:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.829.1">
      ALBs only support HTTP or HTTPS protocols.
     </span>
     <span class="koboSpan" id="kobo.829.2">
      For other protocols, such as TCP, we need to use a network load balancer or classic
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.830.1">
       load balancer.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.831.1">
      ALBs only support TLS/SSL termination at the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.832.1">
       ELB level.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.833.1">
      We can enable sticky sessions for ALBs at the target group level.
     </span>
     <span class="koboSpan" id="kobo.833.2">
      However, we cannot enable sticky sessions at individual EC2 instances
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.834.1">
       with ALBs.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.835.1">
      We can do path-based routing with ALBs if path patterns
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.836.1">
       are enabled.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.837.1">
      We set the security policy for SSL/TLS negotiation to
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.838.1">
       ELBSecurityPolicy-2016-08
      </span>
     </strong>
     <span class="koboSpan" id="kobo.839.1">
      , which is the default.
     </span>
     <span class="koboSpan" id="kobo.839.2">
      The following
     </span>
     <a id="_idIndexMarker799">
     </a>
     <span class="koboSpan" id="kobo.840.1">
      are the currently available
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.841.1">
       policies:
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.842.1">
        ELBSecurityPolicy-
       </span>
      </strong>
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.843.1">
       2016-08
      </span>
     </strong>
     <span class="koboSpan" id="kobo.844.1">
      ,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.845.1">
       ELBSecurityPolicyTLS-1-2-2017-01
      </span>
     </strong>
     <span class="koboSpan" id="kobo.846.1">
      ,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.847.1">
       ELBSecurityPolicy-TLS-1-1-2017-01
      </span>
     </strong>
     <span class="koboSpan" id="kobo.848.1">
      ,
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.849.1">
        ELBSecurityPolicyTLS-1-2-Ext-2018-06
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.850.1">
       ,
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.851.1">
        ELBSecurity
       </span>
      </strong>
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.852.1">
       Policy-FS-2018-06
      </span>
     </strong>
     <span class="koboSpan" id="kobo.853.1">
      ,
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.854.1">
        ELBSecurityPolicy-2015-05
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.855.1">
       ,
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.856.1">
        ELBSecurityPolicy-TLS
       </span>
      </strong>
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.857.1">
       -1-0-2015-04
      </span>
     </strong>
     <span class="koboSpan" id="kobo.858.1">
      ,
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.859.1">
        ELBSecurityPolicy-FS-1-2-Res-2019-08
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.860.1">
       ,
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.861.1">
        ELBSecurityPolicy
       </span>
      </strong>
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.862.1">
       -FS-1-1-2019-08
      </span>
     </strong>
     <span class="koboSpan" id="kobo.863.1">
      ,
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.864.1">
       and
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.865.1">
        ELBSecurityPolicy-FS-1-2-2019-08
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.866.1">
       .
      </span>
     </span>
    </li>
   </ul>
   <h2 id="_idParaDest-242">
    <a id="_idTextAnchor246">
    </a>
    <span class="koboSpan" id="kobo.867.1">
     See also
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.868.1">
     We can read more
    </span>
    <a id="_idIndexMarker800">
    </a>
    <span class="koboSpan" id="kobo.869.1">
     about creating a listener for our ALB
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.870.1">
      at
     </span>
    </span>
    <a href="https://docs.aws.amazon.com/elasticloadbalancing/latest/application/create-https-listener.html">
     <span class="No-Break">
      <span class="koboSpan" id="kobo.871.1">
       https://docs.aws.amazon.com/elasticloadbalancing/latest/application/create-https-listener.html
      </span>
     </span>
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.872.1">
      .
     </span>
    </span>
   </p>
   <h1 id="_idParaDest-243">
    <a id="_idTextAnchor247">
    </a>
    <span class="koboSpan" id="kobo.873.1">
     Using a network load balancer with TLS termination at EC2
    </span>
   </h1>
   <p>
    <strong class="bold">
     <span class="koboSpan" id="kobo.874.1">
      Network load balancers
     </span>
    </strong>
    <span class="koboSpan" id="kobo.875.1">
     are used to load-balance
    </span>
    <a id="_idIndexMarker801">
    </a>
    <span class="koboSpan" id="kobo.876.1">
     TCP traffic and work
    </span>
    <a id="_idIndexMarker802">
    </a>
    <span class="koboSpan" id="kobo.877.1">
     at layer 4 of the OSI model.
    </span>
    <span class="koboSpan" id="kobo.877.2">
     They provide very high performance compared to other load balancer types and can support millions of requests per second, with very
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.878.1">
      low latencies.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-244">
    <a id="_idTextAnchor248">
    </a>
    <span class="koboSpan" id="kobo.879.1">
     Getting ready
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.880.1">
     To follow this recipe, we need
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.881.1">
      the following:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.882.1">
      A working AWS account,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.883.1">
       awsseccb-sandbox-1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.884.1">
      , and a user
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.885.1">
       awsseccbadmin1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.886.1">
      , as described in the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.887.1">
       Technical
      </span>
     </em>
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.888.1">
        requirements
       </span>
      </em>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.889.1">
       section.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.890.1">
      Create a target group,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.891.1">
       cloudericks-tg-tcp
      </span>
     </strong>
     <span class="koboSpan" id="kobo.892.1">
      , following the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.893.1">
       Creating ELB target groups
      </span>
     </em>
     <span class="koboSpan" id="kobo.894.1">
      recipe of this chapter, but selecting TCP instead of HTTP as the protocol and the port as
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.895.1">
       443
      </span>
     </strong>
     <span class="koboSpan" id="kobo.896.1">
      .
     </span>
     <span class="koboSpan" id="kobo.896.2">
      The following resources should have been created as part of the preparation for that recipe – a VPC,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.897.1">
       awsseccb-vpc
      </span>
     </strong>
     <span class="koboSpan" id="kobo.898.1">
      , and a security group,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.899.1">
       cloudericks-web-server
      </span>
     </strong>
     <span class="koboSpan" id="kobo.900.1">
      .
     </span>
     <span class="koboSpan" id="kobo.900.2">
      For this recipe, we need an EC2 instance, following the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.901.1">
       Launching an EC2 Instance with a web server using user data
      </span>
     </em>
     <span class="koboSpan" id="kobo.902.1">
      recipe from
     </span>
     <a href="B21384_05.xhtml#_idTextAnchor169">
      <span class="No-Break">
       <em class="italic">
        <span class="koboSpan" id="kobo.903.1">
         Chapter 5
        </span>
       </em>
      </span>
     </a>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.904.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.905.1">
      Enable HTTPS for our web server, following the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.906.1">
       Enabling HTTPS for a web server on an EC2 instance
      </span>
     </em>
     <span class="koboSpan" id="kobo.907.1">
      recipe, as we want HTTPS on an EC2 instance for this recipe.
     </span>
     <span class="koboSpan" id="kobo.907.2">
      Make sure that our instances can be reached using the
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.908.1">
        https://
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.909.1">
       prefix.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.910.1">
      To select HTTPS (secure HTTP) as the ELB listening protocol, we need an ACM certificate.
     </span>
     <span class="koboSpan" id="kobo.910.2">
      We can create an ACM certificate by following the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.911.1">
       Creating an SSL/TLS certificate with ACM
      </span>
     </em>
     <span class="koboSpan" id="kobo.912.1">
      recipe of
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.913.1">
       this chapter.
      </span>
     </span>
    </li>
   </ul>
   <h2 id="_idParaDest-245">
    <a id="_idTextAnchor249">
    </a>
    <span class="koboSpan" id="kobo.914.1">
     How to do it...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.915.1">
     We can create and test
    </span>
    <a id="_idIndexMarker803">
    </a>
    <span class="koboSpan" id="kobo.916.1">
     a network load balancer
    </span>
    <a id="_idIndexMarker804">
    </a>
    <span class="koboSpan" id="kobo.917.1">
     with TLS termination at an EC2 instance,
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.918.1">
      as follows:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.919.1">
      Log into the AWS Management Console and go to the
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.920.1">
        EC2
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.921.1">
       service.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.922.1">
      Click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.923.1">
       Load Balancers
      </span>
     </strong>
     <span class="koboSpan" id="kobo.924.1">
      from the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.925.1">
       left sidebar.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.926.1">
      Click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.927.1">
       Create load balancer
      </span>
     </strong>
     <span class="koboSpan" id="kobo.928.1">
      .
     </span>
     <span class="koboSpan" id="kobo.928.2">
      We should see the options to create three types of load balancers,
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.929.1">
       Application Load Balancer
      </span>
     </strong>
     <span class="koboSpan" id="kobo.930.1">
      ,
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.931.1">
       Network Load Balancer
      </span>
     </strong>
     <span class="koboSpan" id="kobo.932.1">
      , and
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.933.1">
       Classic Load Balancer
      </span>
     </strong>
     <span class="koboSpan" id="kobo.934.1">
      , as shown in
     </span>
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.935.1">
        Figure 6
       </span>
      </em>
     </span>
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.936.1">
        .10
       </span>
      </em>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.937.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.938.1">
      Under
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.939.1">
       Network Load Balancer
      </span>
     </strong>
     <span class="koboSpan" id="kobo.940.1">
      , click
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.941.1">
       on
      </span>
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.942.1">
        Create
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.943.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.944.1">
      On the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.945.1">
       Create Network Load Balancer
      </span>
     </strong>
     <span class="koboSpan" id="kobo.946.1">
      screen, under the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.947.1">
       Basic configuration
      </span>
     </strong>
     <span class="koboSpan" id="kobo.948.1">
      section, enter
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.949.1">
       cloudericks-nw-lb
      </span>
     </strong>
     <span class="koboSpan" id="kobo.950.1">
      for
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.951.1">
       Load balancer name
      </span>
     </strong>
     <span class="koboSpan" id="kobo.952.1">
      ; for
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.953.1">
       Scheme
      </span>
     </strong>
     <span class="koboSpan" id="kobo.954.1">
      , select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.955.1">
       internet-facing
      </span>
     </strong>
     <span class="koboSpan" id="kobo.956.1">
      ; and for
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.957.1">
       IP address type
      </span>
     </strong>
     <span class="koboSpan" id="kobo.958.1">
      ,
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.959.1">
       select
      </span>
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.960.1">
        IPv4
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.961.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.962.1">
      In the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.963.1">
       Network mapping
      </span>
     </strong>
     <span class="koboSpan" id="kobo.964.1">
      section, for
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.965.1">
       VPC
      </span>
     </strong>
     <span class="koboSpan" id="kobo.966.1">
      , select our
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.967.1">
       VPC,
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.968.1">
        awsseccb-vpc
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.969.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.970.1">
      In the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.971.1">
       Network mapping
      </span>
     </strong>
     <span class="koboSpan" id="kobo.972.1">
      section, under
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.973.1">
       Mappings
      </span>
     </strong>
     <span class="koboSpan" id="kobo.974.1">
      , select the availability zones and public subnets where we have our instances, as shown in
     </span>
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.975.1">
        Figure 6
       </span>
      </em>
     </span>
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.976.1">
        .12
       </span>
      </em>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.977.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.978.1">
      Under
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.979.1">
       Security groups
      </span>
     </strong>
     <span class="koboSpan" id="kobo.980.1">
      , select the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.981.1">
       cloudericks-web-server
      </span>
     </strong>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.982.1">
       security group.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.983.1">
      For
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.984.1">
       Protocol
      </span>
     </strong>
     <span class="koboSpan" id="kobo.985.1">
      , select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.986.1">
       TCP
      </span>
     </strong>
     <span class="koboSpan" id="kobo.987.1">
      , and set the value for
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.988.1">
       Port
      </span>
     </strong>
     <span class="koboSpan" id="kobo.989.1">
      to
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.990.1">
       443
      </span>
     </strong>
     <span class="koboSpan" id="kobo.991.1">
      .
     </span>
     <span class="koboSpan" id="kobo.991.2">
      For
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.992.1">
       Target group
      </span>
     </strong>
     <span class="koboSpan" id="kobo.993.1">
      ,
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.994.1">
       select
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.995.1">
        cloudericks-tg-tcp
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.996.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.997.1">
      Optionally, you can create an AWS Global Accelerator for this load balancer.
     </span>
     <span class="koboSpan" id="kobo.997.2">
      Let’s skip it for now.
     </span>
     <span class="koboSpan" id="kobo.997.3">
      With the ALB, we also had the option to include an AWS WAF, as we saw in
     </span>
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.998.1">
        Figure 6
       </span>
      </em>
     </span>
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.999.1">
        .15
       </span>
      </em>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1000.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1001.1">
      Leave other details as-is and click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1002.1">
       Create
      </span>
     </strong>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1003.1">
        load balancer
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1004.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1005.1">
      Copy the DNS name
     </span>
     <a id="_idIndexMarker805">
     </a>
     <span class="koboSpan" id="kobo.1006.1">
      from the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1007.1">
       Description
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1008.1">
      tab
     </span>
     <a id="_idIndexMarker806">
     </a>
     <span class="koboSpan" id="kobo.1009.1">
      of the ELB, add the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1010.1">
       https://
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1011.1">
      prefix to it, as shown in the following figure, and enter this URL in a browser.
     </span>
     <span class="koboSpan" id="kobo.1011.2">
      Should a security warning appear, select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1012.1">
       Advanced
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1013.1">
      , and then click the link to continue.
     </span>
     <span class="koboSpan" id="kobo.1013.2">
      This will display one of the web servers.
     </span>
     <span class="koboSpan" id="kobo.1013.3">
      By refreshing the page multiple times, you can observe the response from both
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1014.1">
       web servers.
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer182">
     <span class="koboSpan" id="kobo.1015.1">
      <img alt="Figure 6.18 – The network load balancer response" src="image/B21384_06_18.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.1016.1">
     Figure 6.18 – The network load balancer response
    </span>
   </p>
   <p class="list-inset">
    <span class="koboSpan" id="kobo.1017.1">
     Here, we are performing a TLS termination in the EC2 instance; hence, we do not have to configure a certificate for the load balancer.
    </span>
    <span class="koboSpan" id="kobo.1017.2">
     We get a warning in the browser because we are using a self-signed certificate.
    </span>
    <span class="koboSpan" id="kobo.1017.3">
     If we use a certificate signed by a CA, we will not receive
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1018.1">
      a warning.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-246">
    <a id="_idTextAnchor250">
    </a>
    <span class="koboSpan" id="kobo.1019.1">
     How it works...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1020.1">
     In this recipe, we created a
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1021.1">
      network load balancer
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1022.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1023.1">
      NLB
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1024.1">
     ) with TLS termination at EC2.
    </span>
    <span class="koboSpan" id="kobo.1024.2">
     Most of the options were the same as what we saw in the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.1025.1">
      Using an application load balancer with TLS termination at the ELB
     </span>
    </em>
    <span class="koboSpan" id="kobo.1026.1">
     recipe of this chapter.
    </span>
    <span class="koboSpan" id="kobo.1026.2">
     In this recipe, we used the TCP protocol and port
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1027.1">
      443
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1028.1">
     .
    </span>
    <span class="koboSpan" id="kobo.1028.2">
     This was done to allow the NLB to simply pass the HTTPS request to the EC2 instance without decrypting it at the ELB level.
    </span>
    <span class="koboSpan" id="kobo.1028.3">
     The target group should also be configured
    </span>
    <a id="_idIndexMarker807">
    </a>
    <span class="koboSpan" id="kobo.1029.1">
     with the TCP protocol
    </span>
    <a id="_idIndexMarker808">
    </a>
    <span class="koboSpan" id="kobo.1030.1">
     and with port
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1031.1">
      443
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1032.1">
     , allowing TCP passthrough.
    </span>
    <span class="koboSpan" id="kobo.1032.2">
     If we select TLS (secure TCP) instead of TCP, NLB will decrypt the request at
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1033.1">
      ELB itself.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-247">
    <a id="_idTextAnchor251">
    </a>
    <span class="koboSpan" id="kobo.1034.1">
     There’s more...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1035.1">
     In this recipe, we did TCP passthrough for an HTTPS request and performed TLS termination at the EC2 instance.
    </span>
    <span class="koboSpan" id="kobo.1035.2">
     TLS termination at the EC2 instance will consume more EC2 resources and provide an extra load for the EC2 instance.
    </span>
    <span class="koboSpan" id="kobo.1035.3">
     We will also need to manage the certificate across all the EC2 instances.
    </span>
    <span class="koboSpan" id="kobo.1035.4">
     However, if we require end-to-end encryption due to compliance or government policies, this is the preferred way.
    </span>
    <span class="koboSpan" id="kobo.1035.5">
     Otherwise, the preferred approach is to perform SSL/TLS termination at the ELB level, as we saw in the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.1036.1">
      Using an application load balancer with TLS termination at the ELB
     </span>
    </em>
    <span class="koboSpan" id="kobo.1037.1">
     recipe of this chapter.
    </span>
    <span class="koboSpan" id="kobo.1037.2">
     To terminate SSL/TLS at the NLB, we need to set the protocol to TLS (secure TCP) and select an
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1038.1">
      ACM certificate.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-248">
    <a id="_idTextAnchor252">
    </a>
    <span class="koboSpan" id="kobo.1039.1">
     See also
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1040.1">
     We can read more about
    </span>
    <a id="_idIndexMarker809">
    </a>
    <span class="koboSpan" id="kobo.1041.1">
     TLS termination for load balancers in AWS
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1042.1">
      here:
     </span>
    </span>
    <a href="https://www.cloudericks.com/blog/understanding-tls-termination-with-load-balancers-in-aws">
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1043.1">
       https://www.cloudericks.com/blog/understanding-tls-termination-with-load-balancers-in-aws
      </span>
     </span>
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1044.1">
      .
     </span>
    </span>
   </p>
   <h1 id="_idParaDest-249">
    <a id="_idTextAnchor253">
    </a>
    <span class="koboSpan" id="kobo.1045.1">
     Securing S3 using CloudFront and TLS
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.1046.1">
     In this recipe, we will learn
    </span>
    <a id="_idIndexMarker810">
    </a>
    <span class="koboSpan" id="kobo.1047.1">
     how to secure
    </span>
    <a id="_idIndexMarker811">
    </a>
    <span class="koboSpan" id="kobo.1048.1">
     an S3 bucket by adding a CloudFront distribution layer.
    </span>
    <span class="koboSpan" id="kobo.1048.2">
     We will enable SSL/TLS on the CloudFront distribution to allow HTTPS traffic.
    </span>
    <span class="koboSpan" id="kobo.1048.3">
     Initially, we will utilize the default CloudFront certificate (
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1049.1">
      *.cloudfront.net
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1050.1">
     ), and then proceed to configure the CloudFront distribution with a custom domain, using an
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1051.1">
      ACM certificate.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-250">
    <a id="_idTextAnchor254">
    </a>
    <span class="koboSpan" id="kobo.1052.1">
     Getting ready
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1053.1">
     We need the
    </span>
    <a id="_idIndexMarker812">
    </a>
    <span class="koboSpan" id="kobo.1054.1">
     following to successfully
    </span>
    <a id="_idIndexMarker813">
    </a>
    <span class="koboSpan" id="kobo.1055.1">
     complete
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1056.1">
      this recipe.
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.1057.1">
      A working AWS account,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1058.1">
       awsseccb-sandbox-1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1059.1">
      , and a user
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1060.1">
       awsseccbadmin1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1061.1">
      , as described in the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.1062.1">
       Technical
      </span>
     </em>
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.1063.1">
        requirements
       </span>
      </em>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1064.1">
       section.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1065.1">
      We need an S3 bucket with a file called
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1066.1">
       index.html
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1067.1">
      .
     </span>
     <span class="koboSpan" id="kobo.1067.2">
      The content of the file should be
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1068.1">
       &lt;h1&gt; Cloudericks Web Server &lt;/h1&gt;
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1069.1">
      .
     </span>
     <span class="koboSpan" id="kobo.1069.2">
      We can create an S3 bucket by referring to
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.1070.1">
       Technical requirements
      </span>
     </em>
     <span class="koboSpan" id="kobo.1071.1">
      section of
     </span>
     <a href="B21384_02.xhtml#_idTextAnchor043">
      <span class="No-Break">
       <em class="italic">
        <span class="koboSpan" id="kobo.1072.1">
         Chapter 2
        </span>
       </em>
      </span>
     </a>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1073.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1074.1">
      For the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.1075.1">
       CloudFront distribution with a custom domain and ACM certificate
      </span>
     </em>
     <span class="koboSpan" id="kobo.1076.1">
      section of this recipe, we need to create an ACM certificate, following the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.1077.1">
       Creating an SSL/TLS certificate with an ACM
      </span>
     </em>
     <span class="koboSpan" id="kobo.1078.1">
      recipe of
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1079.1">
       this chapter.
      </span>
     </span>
    </li>
   </ul>
   <h2 id="_idParaDest-251">
    <a id="_idTextAnchor255">
    </a>
    <span class="koboSpan" id="kobo.1080.1">
     How to do it...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1081.1">
     We can add a CloudFront distribution to an S3 bucket with or without a custom domain.
    </span>
    <span class="koboSpan" id="kobo.1081.2">
     We will see both approaches in
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1082.1">
      this recipe.
     </span>
    </span>
   </p>
   <h3>
    <span class="koboSpan" id="kobo.1083.1">
     CloudFront distribution with a default CloudFront domain
    </span>
   </h3>
   <p>
    <span class="koboSpan" id="kobo.1084.1">
     We can add a CloudFront distribution
    </span>
    <a id="_idIndexMarker814">
    </a>
    <span class="koboSpan" id="kobo.1085.1">
     to an S3 bucket with a default CloudFront domain and certificate
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1086.1">
      as follows:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.1087.1">
      Log into the AWS Management Console and go to the
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1088.1">
        CloudFront
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1089.1">
       service.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1090.1">
      If you are new to CloudFront, you should see a screen with a
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1091.1">
       Create a CloudFront distribution
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1092.1">
      button.
     </span>
     <span class="koboSpan" id="kobo.1092.2">
      Click on it.
     </span>
     <span class="koboSpan" id="kobo.1092.3">
      Otherwise, you can first click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1093.1">
       Distributions
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1094.1">
      from the left sidebar and then
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1095.1">
        CloudFront distribution
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1096.1">
       .
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer183">
     <span class="koboSpan" id="kobo.1097.1">
      <img alt="Figure 6.19 – Creating a CloudFront distribution" src="image/B21384_06_19.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.1098.1">
     Figure 6.19 – Creating a CloudFront distribution
    </span>
   </p>
   <ol>
    <li value="3">
     <span class="koboSpan" id="kobo.1099.1">
      In the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1100.1">
       Origin
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1101.1">
      pane, For
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1102.1">
       Origin domain
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1103.1">
      , select the S3 bucket
     </span>
     <a id="_idIndexMarker815">
     </a>
     <span class="koboSpan" id="kobo.1104.1">
      we created for this recipe.
     </span>
     <span class="koboSpan" id="kobo.1104.2">
      Leave
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1105.1">
       Origin Path
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1106.1">
      empty.
     </span>
     <span class="koboSpan" id="kobo.1106.2">
      For
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1107.1">
       Name
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1108.1">
      , use the auto-generated value.
     </span>
     <span class="koboSpan" id="kobo.1108.2">
      For
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1109.1">
       Origin access
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1110.1">
      , select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1111.1">
       Origin access
      </span>
     </strong>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1112.1">
        control settings
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1113.1">
       .
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer184">
     <span class="koboSpan" id="kobo.1114.1">
      <img alt="Figure 6.20 – Setting the origin details" src="image/B21384_06_20.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.1115.1">
     Figure 6.20 – Setting the origin details
    </span>
   </p>
   <ol>
    <li value="4">
     <span class="koboSpan" id="kobo.1116.1">
      Click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1117.1">
       Create new OAC
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1118.1">
      .
     </span>
     <span class="koboSpan" id="kobo.1118.2">
      For the name, we
     </span>
     <a id="_idIndexMarker816">
     </a>
     <span class="koboSpan" id="kobo.1119.1">
      can use the auto-populated name.
     </span>
     <span class="koboSpan" id="kobo.1119.2">
      For the signing behavior, select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1120.1">
       Sign requests (recommended)
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1121.1">
      .
     </span>
     <span class="koboSpan" id="kobo.1121.2">
      Leave everything as default, as shown in the following figure, and click
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1122.1">
       on
      </span>
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1123.1">
        Create
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1124.1">
       .
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer185">
     <span class="koboSpan" id="kobo.1125.1">
      <img alt="Figure 6.21 – Creating a new OAC" src="image/B21384_06_21.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.1126.1">
     Figure 6.21 – Creating a new OAC
    </span>
   </p>
   <ol>
    <li value="5">
     <span class="koboSpan" id="kobo.1127.1">
      Select the new OAC
     </span>
     <a id="_idIndexMarker817">
     </a>
     <span class="koboSpan" id="kobo.1128.1">
      on our
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1129.1">
       Create distribution
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1130.1">
      page.
     </span>
     <span class="koboSpan" id="kobo.1130.2">
      Leave the value selection for
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1131.1">
       Enable Origin Shield
      </span>
     </strong>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1132.1">
       as
      </span>
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1133.1">
        No
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1134.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1135.1">
      Under
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1136.1">
       Default cache behavior
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1137.1">
      , for
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1138.1">
       Path pattern
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1139.1">
      , use the default value; for
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1140.1">
       Compress objects automatically
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1141.1">
      , select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1142.1">
       Yes
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1143.1">
      ; for
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1144.1">
       Viewer protocol policy
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1145.1">
      , select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1146.1">
       Redirect HTTP to HTTPS
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1147.1">
      ; for
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1148.1">
       Allowed HTTP methods
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1149.1">
      , select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1150.1">
       GET, HEAD
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1151.1">
      ; and for
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1152.1">
       Restrict viewer access
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1153.1">
      ,
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1154.1">
       select
      </span>
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1155.1">
        No
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1156.1">
       .
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer186">
     <span class="koboSpan" id="kobo.1157.1">
      <img alt="Figure 6.22 – Configuring the default cache behavior" src="image/B21384_06_22.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.1158.1">
     Figure 6.22 – Configuring the default cache behavior
    </span>
   </p>
   <ol>
    <li value="7">
     <span class="koboSpan" id="kobo.1159.1">
      Leave the default settings
     </span>
     <a id="_idIndexMarker818">
     </a>
     <span class="koboSpan" id="kobo.1160.1">
      for
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1161.1">
       Cache key and origin requests
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1162.1">
      and
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1163.1">
        Function associations
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1164.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1165.1">
      Scroll down
     </span>
     <a id="_idIndexMarker819">
     </a>
     <span class="koboSpan" id="kobo.1166.1">
      to
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1167.1">
       Web Application Firewall (WAF)
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1168.1">
      and select the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1169.1">
       Do not enable security
      </span>
     </strong>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1170.1">
        protections
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1171.1">
       option.
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer187">
     <span class="koboSpan" id="kobo.1172.1">
      <img alt="Figure 6.23 – The WAF selection options" src="image/B21384_06_23.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.1173.1">
     Figure 6.23 – The WAF selection options
    </span>
   </p>
   <ol>
    <li value="9">
     <span class="koboSpan" id="kobo.1174.1">
      For
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1175.1">
       Price class
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1176.1">
      , select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1177.1">
       Use all edge locations (
      </span>
     </strong>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1178.1">
        best performance)
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1179.1">
       .
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer188">
     <span class="koboSpan" id="kobo.1180.1">
      <img alt="Figure 6.24 – Selecting the price class" src="image/B21384_06_24.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.1181.1">
     Figure 6.24 – Selecting the price class
    </span>
   </p>
   <ol>
    <li value="10">
     <span class="koboSpan" id="kobo.1182.1">
      For
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1183.1">
       Custom SSL certificate - optional
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1184.1">
      , do not make
     </span>
     <a id="_idIndexMarker820">
     </a>
     <span class="koboSpan" id="kobo.1185.1">
      any selections; for
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1186.1">
       Supported HTTP versions
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1187.1">
      , select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1188.1">
       HTTP/2
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1189.1">
      ; and for
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1190.1">
       Default root object - optional
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1191.1">
      ,
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1192.1">
       enter
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1193.1">
        index.html
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1194.1">
       .
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer189">
     <span class="koboSpan" id="kobo.1195.1">
      <img alt="Figure 6.25 – Selecting the SSL certificate and default root object" src="image/B21384_06_25.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.1196.1">
     Figure 6.25 – Selecting the SSL certificate and default root object
    </span>
   </p>
   <ol>
    <li value="11">
     <span class="koboSpan" id="kobo.1197.1">
      For
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1198.1">
       Standard logging
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1199.1">
      , select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1200.1">
       Off
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1201.1">
      , and for
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1202.1">
       IPv6
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1203.1">
      , select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1204.1">
       On
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1205.1">
      .
     </span>
     <span class="koboSpan" id="kobo.1205.2">
      Standard logging, when enabled, retrieves logs of viewer requests, and delivers them to an Amazon S3 bucket.
     </span>
     <span class="koboSpan" id="kobo.1205.3">
      Consequently, enabling this feature requires specifying the target bucket and determining whether cookie logging is needed.
     </span>
     <span class="koboSpan" id="kobo.1205.4">
      With cookie logging enabled, CloudFront includes cookies in the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1206.1">
       standard logs.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1207.1">
      Click
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1208.1">
       Create distribution
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1209.1">
      .
     </span>
     <span class="koboSpan" id="kobo.1209.2">
      We will get a prompt with the option to copy the S3 bucket policy that needs to be updated in our
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1210.1">
       S3 bucket.
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer190">
     <span class="koboSpan" id="kobo.1211.1">
      <img alt="Figure 6.26 – The copy S3 policy notification" src="image/B21384_06_26.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.1212.1">
     Figure 6.26 – The copy S3 policy notification
    </span>
   </p>
   <ol>
    <li value="13">
     <span class="koboSpan" id="kobo.1213.1">
      Click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1214.1">
       Copy policy
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1215.1">
      and paste
     </span>
     <a id="_idIndexMarker821">
     </a>
     <span class="koboSpan" id="kobo.1216.1">
      this policy into the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1217.1">
       Bucket policy
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1218.1">
      section of our S3 bucket.
     </span>
     <span class="koboSpan" id="kobo.1218.2">
      If you are not sure how to do this, you can do it by referring to the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.1219.1">
       Creating an S3 bucket policy
      </span>
     </em>
     <span class="koboSpan" id="kobo.1220.1">
      recipe in
     </span>
     <a href="B21384_04.xhtml#_idTextAnchor133">
      <span class="No-Break">
       <em class="italic">
        <span class="koboSpan" id="kobo.1221.1">
         Chapter 4
        </span>
       </em>
      </span>
     </a>
     <span class="koboSpan" id="kobo.1222.1">
      .
     </span>
     <span class="koboSpan" id="kobo.1222.2">
      If you miss this step, you will need to set it up independently
     </span>
     <a id="_idIndexMarker822">
     </a>
     <span class="koboSpan" id="kobo.1223.1">
      by consulting the Amazon documentation
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1224.1">
       at
      </span>
     </span>
     <a href="https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/private-content-restricting-access-to-s3.html">
      <span class="No-Break">
       <span class="koboSpan" id="kobo.1225.1">
        https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/private-content-restricting-access-to-s3.html
       </span>
      </span>
     </a>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1226.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1227.1">
      Copy the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1228.1">
       Distribution domain name
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1229.1">
      from our CloudFront distribution and run it from a browser.
     </span>
     <span class="koboSpan" id="kobo.1229.2">
      We should get an output like the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1230.1">
       following screenshot:
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer191">
     <span class="koboSpan" id="kobo.1231.1">
      <img alt="Figure 6.27 – A response through the CloudFront Distribution" src="image/B21384_06_27.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.1232.1">
     Figure 6.27 – A response through the CloudFront Distribution
    </span>
   </p>
   <p class="list-inset">
    <span class="koboSpan" id="kobo.1233.1">
     Here, we did not have to specify a filename, as we had specified a
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1234.1">
      default object.
     </span>
    </span>
   </p>
   <ol>
    <li value="15">
     <span class="koboSpan" id="kobo.1235.1">
      Optionally, we can also specify a filename within our S3 bucket directly, as shown in the following screenshot.
     </span>
     <span class="koboSpan" id="kobo.1235.2">
      This file was not created in the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.1236.1">
       Getting ready
      </span>
     </em>
     <span class="koboSpan" id="kobo.1237.1">
      section, so you will need to create it if you want to run a
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1238.1">
       similar URL.
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer192">
     <span class="koboSpan" id="kobo.1239.1">
      <img alt="Figure 6.28 – Directly accessing a file in S3" src="image/B21384_06_28.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.1240.1">
     Figure 6.28 – Directly accessing a file in S3
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1241.1">
     Next, we will learn how to use a custom domain with our own
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1242.1">
      ACM certificate.
     </span>
    </span>
   </p>
   <h3>
    <span class="koboSpan" id="kobo.1243.1">
     CloudFront distribution with a custom domain and ACM certificate
    </span>
   </h3>
   <p>
    <span class="koboSpan" id="kobo.1244.1">
     We can add a CloudFront distribution
    </span>
    <a id="_idIndexMarker823">
    </a>
    <span class="koboSpan" id="kobo.1245.1">
     to an S3 bucket with a custom domain and ACM certificate,
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1246.1">
      as follows:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.1247.1">
      Follow
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.1248.1">
       Steps 1
      </span>
     </em>
     <em class="italic">
      <span class="koboSpan" id="kobo.1249.1">
       to
      </span>
     </em>
     <em class="italic">
      <span class="koboSpan" id="kobo.1250.1">
       9
      </span>
     </em>
     <span class="koboSpan" id="kobo.1251.1">
      in the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.1252.1">
       CloudFront distribution with a default CloudFront
      </span>
     </em>
     <em class="italic">
      <span class="koboSpan" id="kobo.1253.1">
       domain
      </span>
     </em>
     <span class="koboSpan" id="kobo.1254.1">
      section of this recipe, up to setting the price class.
     </span>
     <span class="koboSpan" id="kobo.1254.2">
      However, there is one exception – if an
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1255.1">
       Origin Access Control
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1256.1">
      (
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1257.1">
       OAC
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1258.1">
      ) was created in that section, there
     </span>
     <a id="_idIndexMarker824">
     </a>
     <span class="koboSpan" id="kobo.1259.1">
      is no need to create a new one; we can reuse the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1260.1">
       existing OAC.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1261.1">
      For
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1262.1">
       Alternate domain name (CNAME) - optional
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1263.1">
      , enter a subdomain name for the domain for which we have the certificate, as shown in the following screenshot.
     </span>
     <span class="koboSpan" id="kobo.1263.2">
      Remember to replace
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1264.1">
       trainso.io
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1265.1">
      with your
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1266.1">
       domain name.
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer193">
     <span class="koboSpan" id="kobo.1267.1">
      <img alt="Figure 6.29 – Setting the alternate domain name (CNAME)" src="image/B21384_06_29.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.1268.1">
     Figure 6.29 – Setting the alternate domain name (CNAME)
    </span>
   </p>
   <ol>
    <li value="3">
     <span class="koboSpan" id="kobo.1269.1">
      For
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1270.1">
       Custom SSL certificate
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1271.1">
      , as shown in
     </span>
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.1272.1">
        Figure 6
       </span>
      </em>
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.1273.1">
       .30
      </span>
     </em>
     <span class="koboSpan" id="kobo.1274.1">
      , select the ACM certificate we created for this recipe, uncheck
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1275.1">
       Legacy clients support
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1276.1">
      , and for
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1277.1">
       Security policy
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1278.1">
      , select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1279.1">
       TLSv1.2_2021
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1280.1">
      , which is the current recommended version.
     </span>
     <span class="koboSpan" id="kobo.1280.2">
      For
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1281.1">
       Supported HTTP versions
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1282.1">
      , select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1283.1">
       HTTP/2
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1284.1">
      , and for
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1285.1">
       Default root object - optional
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1286.1">
      ,
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1287.1">
       enter
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1288.1">
        index.html
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1289.1">
       .
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer194">
     <span class="koboSpan" id="kobo.1290.1">
      <img alt="Figure 6.30 – ACM certificate configuration" src="image/B21384_06_30.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.1291.1">
     Figure 6.30 – ACM certificate configuration
    </span>
   </p>
   <ol>
    <li value="4">
     <span class="koboSpan" id="kobo.1292.1">
      For
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1293.1">
       Standard logging
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1294.1">
      , select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1295.1">
       Off
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1296.1">
      , and for
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1297.1">
       IPv6
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1298.1">
      ,
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1299.1">
       select
      </span>
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1300.1">
        On
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1301.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1302.1">
      Click
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1303.1">
       Create distribution
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1304.1">
      .
     </span>
     <span class="koboSpan" id="kobo.1304.2">
      The copy
     </span>
     <a id="_idIndexMarker825">
     </a>
     <span class="koboSpan" id="kobo.1305.1">
      policy message will be shown with a bucket policy.
     </span>
     <span class="koboSpan" id="kobo.1305.2">
      Ensure to update the bucket policy of our S3 bucket with this policy, as we did in the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1306.1">
       previous section.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1307.1">
      Create a
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1308.1">
       CNAME
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1309.1">
      record for the domain, with the name (or host) set to the subdomain we entered in
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.1310.1">
       Step 2
      </span>
     </em>
     <span class="koboSpan" id="kobo.1311.1">
      , which was
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1312.1">
       cloudericksws.trainso.io
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1313.1">
      in my case (this is only
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1314.1">
       cloudericksws
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1315.1">
      if the DNS service provider automatically appends the domain name) and the value set as our CloudFront domain name, which in my case
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1316.1">
       is
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1317.1">
        d31z3ldyzun0k3.cloudfront.net
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1318.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1319.1">
      After some time, considering the DNS propagation delay, run the subdomain from a browser, and we should get a
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1320.1">
       successful response.
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer195">
     <span class="koboSpan" id="kobo.1321.1">
      <img alt="Figure 6.31 – A response using the custom domain" src="image/B21384_06_31.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.1322.1">
     Figure 6.31 – A response using the custom domain
    </span>
   </p>
   <p class="list-inset">
    <span class="koboSpan" id="kobo.1323.1">
     Instead of the custom
    </span>
    <a id="_idIndexMarker826">
    </a>
    <span class="koboSpan" id="kobo.1324.1">
     subdomain, we can also reach the web page using the CloudFront domain name, as we saw in the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1325.1">
      previous section.
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer196">
     <span class="koboSpan" id="kobo.1326.1">
      <img alt="Figure 6.32 – A response using the CloudFront domain name" src="image/B21384_06_32.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.1327.1">
     Figure 6.32 – A response using the CloudFront domain name
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1328.1">
     In this section, we accessed the content of our private S3 bucket through CloudFront, using a custom domain and an
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1329.1">
      ACM certificate.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-252">
    <a id="_idTextAnchor256">
    </a>
    <span class="koboSpan" id="kobo.1330.1">
     How it works...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1331.1">
     In this recipe, we created a CloudFront distribution layer over a private S3 bucket to access the S3 bucket securely using HTTPS.
    </span>
    <span class="koboSpan" id="kobo.1331.2">
     We configured this to redirect all HTTP requests to HTTPS requests.
    </span>
    <span class="koboSpan" id="kobo.1331.3">
     If we choose HTTP and HTTPS, both HTTP and HTTPS requests are allowed.
    </span>
    <span class="koboSpan" id="kobo.1331.4">
     If we choose only HTTPS, all HTTP requests will
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1332.1">
      be discarded.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1333.1">
     In the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.1334.1">
      CloudFront distribution with a default CloudFront domain
     </span>
    </em>
    <span class="koboSpan" id="kobo.1335.1">
     section of this recipe, we used the default certificate provided by CloudFront (
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1336.1">
      *.cloudfront.com
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1337.1">
     ) for SSL.
    </span>
    <span class="koboSpan" id="kobo.1337.2">
     This certificate allows us to use HTTPS without the need to create a certificate.
    </span>
    <span class="koboSpan" id="kobo.1337.3">
     In the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.1338.1">
      CloudFront distribution with a custom domain and ACM certificate
     </span>
    </em>
    <span class="koboSpan" id="kobo.1339.1">
     section of this recipe, we specified a wildcard domain name (
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1340.1">
      *.trainso.io
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1341.1">
     ) for alternate domain names (CNAMEs).
    </span>
    <span class="koboSpan" id="kobo.1341.2">
     This will allow any subdomain to be entered as a CNAME record on the DNS service provider side and forwarded to our
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1342.1">
      web page.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1343.1">
     We selected an ACM certificate that was created for a custom domain.
    </span>
    <span class="koboSpan" id="kobo.1343.2">
     We entered a CNAME record on our DNS service provider that points to our CloudFront domain name.
    </span>
    <span class="koboSpan" id="kobo.1343.3">
     The exact steps to add the CNAME record at the DNS service provider server may be specific to a DNS service provider.
    </span>
    <span class="koboSpan" id="kobo.1343.4">
     You can look
    </span>
    <a id="_idIndexMarker827">
    </a>
    <span class="koboSpan" id="kobo.1344.1">
     at the DNS service provider documentation (
    </span>
    <a href="https://aws.amazon.com/route53/what-is-dns/">
     <span class="koboSpan" id="kobo.1345.1">
      https://aws.amazon.com/route53/what-is-dns/
     </span>
    </a>
    <span class="koboSpan" id="kobo.1346.1">
     ) for
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1347.1">
      more details.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-253">
    <a id="_idTextAnchor257">
    </a>
    <span class="koboSpan" id="kobo.1348.1">
     There’s more...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1349.1">
     In this recipe, we used our own ACM certificate as a CNAME, which was configured at an outside DNS provider so that it could use a subdomain to access our web page in the S3 bucket.
    </span>
    <span class="koboSpan" id="kobo.1349.2">
     Alternatively, we can use Route 53 to manage the DNS for our domain and point a top-level domain to our
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1350.1">
      CloudFront distribution.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-254">
    <a id="_idTextAnchor258">
    </a>
    <span class="koboSpan" id="kobo.1351.1">
     See also
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1352.1">
     We can read more about
    </span>
    <a id="_idIndexMarker828">
    </a>
    <span class="koboSpan" id="kobo.1353.1">
     routing traffic to a CloudFront distribution using Route 53
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1354.1">
      here:
     </span>
    </span>
    <a href="https://docs.aws.amazon.com/Route53/latest/DeveloperGuide/routing-to-cloudfront-distribution.html">
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1355.1">
       https://docs.aws.amazon.com/Route53/latest/DeveloperGuide/routing-to-cloudfront-distribution.html
      </span>
     </span>
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1356.1">
      .
     </span>
    </span>
   </p>
   <h1 id="_idParaDest-255">
    <a id="_idTextAnchor259">
    </a>
    <span class="koboSpan" id="kobo.1357.1">
     Using a WAF
    </span>
   </h1>
   <p>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1358.1">
      AWS WAF
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1359.1">
     (short for
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1360.1">
      Web Application Firewall
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1361.1">
     ) is a firewall service
    </span>
    <a id="_idIndexMarker829">
    </a>
    <span class="koboSpan" id="kobo.1362.1">
     for monitoring our web traffic.
    </span>
    <span class="koboSpan" id="kobo.1362.2">
     Unlike security groups and
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1363.1">
      network ACLs
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1364.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1365.1">
      NACLs)
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1366.1">
     , which only check for ports
    </span>
    <a id="_idIndexMarker830">
    </a>
    <span class="koboSpan" id="kobo.1367.1">
     and IP addresses, AWS WAF can find content matched against predefined signatures that can help detect common attacks, such as SQL injection and cross-site scripting.
    </span>
    <span class="koboSpan" id="kobo.1367.2">
     Currently, we can only use WAF with API Gateway, CloudFront, and ALBs.
    </span>
    <span class="koboSpan" id="kobo.1367.3">
     It cannot be used directly with services such as EC2 or
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1368.1">
      Route 53.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1369.1">
     AWS WAF can be used with CloudFront distributions, ALBs, and API Gateway, each having unique characteristics affecting WAF usage.
    </span>
    <span class="koboSpan" id="kobo.1369.2">
     CloudFront is global, meaning WAF rules apply uniformly across all Regions, providing consistent protection for global applications.
    </span>
    <span class="koboSpan" id="kobo.1369.3">
     In contrast, ALBs and API Gateway are regional, so WAF rules must be configured for each region separately, allowing for tailored security policies but increasing management overhead.
    </span>
    <span class="koboSpan" id="kobo.1369.4">
     Using CloudFront with WAF is simpler and can reduce latency due to edge locations, while ALBs and API Gateway offer more granular control but may have regional performance variations and potentially higher costs, due to the need for multiple configurations.
    </span>
    <span class="koboSpan" id="kobo.1369.5">
     Understanding these differences helps optimize security and performance based
    </span>
    <a id="_idIndexMarker831">
    </a>
    <span class="koboSpan" id="kobo.1370.1">
     on your application’s architecture and
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1371.1">
      geographic distribution.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-256">
    <a id="_idTextAnchor260">
    </a>
    <span class="koboSpan" id="kobo.1372.1">
     Getting ready
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1373.1">
     We need the following to successfully complete
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1374.1">
      this recipe:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.1375.1">
      A working AWS account,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1376.1">
       awsseccb-sandbox-1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1377.1">
      , and a user,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1378.1">
       awsseccbadmin1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1379.1">
      , as described in the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.1380.1">
       Technical
      </span>
     </em>
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.1381.1">
        requirements
       </span>
      </em>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1382.1">
       section.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1383.1">
      To create a WAF with a CloudFront distribution, we need to create a CloudFront distribution over an S3 bucket by following the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.1384.1">
       Securing S3 using CloudFront and TLS
      </span>
     </em>
     <span class="koboSpan" id="kobo.1385.1">
      recipe of
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1386.1">
       this chapter.
      </span>
     </span>
    </li>
   </ul>
   <h2 id="_idParaDest-257">
    <a id="_idTextAnchor261">
    </a>
    <span class="koboSpan" id="kobo.1387.1">
     How to do it...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1388.1">
     We can create and configure an AWS WAF for a CloudFront distribution
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1389.1">
      as follows:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.1390.1">
      Log into the AWS Management Console and go to the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1391.1">
       WAF &amp;
      </span>
     </strong>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1392.1">
        Shield
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1393.1">
       dashboard.
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer197">
     <span class="koboSpan" id="kobo.1394.1">
      <img alt="Figure 6.33 – The WAF &amp; Shield dashboard" src="image/B21384_06_33.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.1395.1">
     Figure 6.33 – The WAF &amp; Shield dashboard
    </span>
   </p>
   <p class="list-inset">
    <span class="koboSpan" id="kobo.1396.1">
     We should see menu items
    </span>
    <a id="_idIndexMarker832">
    </a>
    <span class="koboSpan" id="kobo.1397.1">
     in the sidebar for
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1398.1">
      AWS WAF
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1399.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1400.1">
      AWS Shield
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1401.1">
     , and
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1402.1">
      AWS Firewall Manager
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1403.1">
     .
    </span>
    <span class="koboSpan" id="kobo.1403.2">
     If AWS decides to separate them, go to the dashboard for AWS WAF and continue with
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1404.1">
      this recipe.
     </span>
    </span>
   </p>
   <ol>
    <li value="2">
     <span class="koboSpan" id="kobo.1405.1">
      Click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1406.1">
       Create
      </span>
     </strong>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1407.1">
        web ACL
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1408.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1409.1">
      In the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1410.1">
       Web ACL details
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1411.1">
      section, for
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1412.1">
       Resource type
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1413.1">
      , select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1414.1">
       Amazon CloudFront distributions
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1415.1">
      ; for
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1416.1">
       Name
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1417.1">
      , enter
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1418.1">
       cloudericks-webacl
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1419.1">
      ; and optionally, provide a description in the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1420.1">
       Description
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1421.1">
      field.
     </span>
     <span class="koboSpan" id="kobo.1421.2">
      We will use the auto-populated value for the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1422.1">
       CloudWatch metric
      </span>
     </strong>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1423.1">
        name
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1424.1">
       field.
      </span>
     </span>
    </li>
   </ol>
   <p class="IMG---Figure">
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer198">
     <span class="koboSpan" id="kobo.1425.1">
      <img alt="Figure 6.34 – Configuring the web ACL" src="image/B21384_06_34.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.1426.1">
     Figure 6.34 – Configuring the web ACL
    </span>
   </p>
   <ol>
    <li value="4">
     <span class="koboSpan" id="kobo.1427.1">
      Under the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1428.1">
       Associated AWS resources
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1429.1">
      section, click
     </span>
     <a id="_idIndexMarker833">
     </a>
     <span class="koboSpan" id="kobo.1430.1">
      on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1431.1">
       Add
      </span>
     </strong>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1432.1">
        AWS resources
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1433.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1434.1">
      On the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1435.1">
       Add AWS resources
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1436.1">
      screen, select the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1437.1">
       CloudFront distributions
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1438.1">
      that we created for this recipe, and
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1439.1">
       click
      </span>
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1440.1">
        Add
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1441.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1442.1">
      Once we are back in the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1443.1">
       Associated AWS resources
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1444.1">
      section, select our
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1445.1">
       CloudFront distribution.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1446.1">
      For
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1447.1">
       Web request body inspection
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1448.1">
      , select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1449.1">
       Default
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1450.1">
      , and then
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1451.1">
       click
      </span>
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1452.1">
        Next
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1453.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1454.1">
      On the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1455.1">
       Add rules and rule groups
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1456.1">
      page, expand the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1457.1">
       Add rules
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1458.1">
      dropdown and select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1459.1">
       Add my own rules and
      </span>
     </strong>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1460.1">
        rule groups
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1461.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1462.1">
      On the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1463.1">
       Add my own rules and rule groups
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1464.1">
      page, select
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1465.1">
        Rule builder
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1466.1">
       .
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer199">
     <span class="koboSpan" id="kobo.1467.1">
      <img alt="Figure 6.35 – Selecting a rule type" src="image/B21384_06_35.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.1468.1">
     Figure 6.35 – Selecting a rule type
    </span>
   </p>
   <ol>
    <li value="10">
     <span class="koboSpan" id="kobo.1469.1">
      Under
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1470.1">
       Rule builder
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1471.1">
      , in the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1472.1">
       Rule
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1473.1">
      section, enter
     </span>
     <a id="_idIndexMarker834">
     </a>
     <span class="koboSpan" id="kobo.1474.1">
      the name
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1475.1">
       badstring-rule
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1476.1">
      and set
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1477.1">
       Type
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1478.1">
      to
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1479.1">
        Regular rule
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1480.1">
       .
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer200">
     <span class="koboSpan" id="kobo.1481.1">
      <img alt="Figure 6.36 – Configuring Rule builder" src="image/B21384_06_36.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.1482.1">
     Figure 6.36 – Configuring Rule builder
    </span>
   </p>
   <ol>
    <li value="11">
     <span class="koboSpan" id="kobo.1483.1">
      Under the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1484.1">
       Statement
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1485.1">
      section, for
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1486.1">
       Inspect
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1487.1">
      , select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1488.1">
       Query string
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1489.1">
      ; for
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1490.1">
       Match type
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1491.1">
      , select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1492.1">
       Contain word
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1493.1">
      ; and
     </span>
     <a id="_idIndexMarker835">
     </a>
     <span class="koboSpan" id="kobo.1494.1">
      for
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1495.1">
       String to match
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1496.1">
      enter
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1497.1">
       badstring
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1498.1">
      .
     </span>
     <span class="koboSpan" id="kobo.1498.2">
      For
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1499.1">
       Text transformation
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1500.1">
      ,
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1501.1">
       select
      </span>
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1502.1">
        None
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1503.1">
       .
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer201">
     <span class="koboSpan" id="kobo.1504.1">
      <img alt="Figure 6.37 – Setting the string statement" src="image/B21384_06_37.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.1505.1">
     Figure 6.37 – Setting the string statement
    </span>
   </p>
   <ol>
    <li value="12">
     <span class="koboSpan" id="kobo.1506.1">
      Under the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1507.1">
       Then
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1508.1">
      section, select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1509.1">
       Block
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1510.1">
      as an action and click
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1511.1">
        Add rule
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1512.1">
       .
      </span>
     </span>
    </li>
   </ol>
   <p class="IMG---Figure">
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer202">
     <span class="koboSpan" id="kobo.1513.1">
      <img alt="Figure 6.38 – Adding a rule" src="image/B21384_06_38.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.1514.1">
     Figure 6.38 – Adding a rule
    </span>
   </p>
   <ol>
    <li value="13">
     <span class="koboSpan" id="kobo.1515.1">
      On the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1516.1">
       Add rules and rule groups
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1517.1">
      page, for
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1518.1">
       Default web ACL action for requests that don’t match any rules
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1519.1">
      , select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1520.1">
       Allow
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1521.1">
      and
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1522.1">
       click
      </span>
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1523.1">
        Next.
       </span>
      </strong>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1524.1">
      On the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1525.1">
       Set rule priority
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1526.1">
      page, select
     </span>
     <a id="_idIndexMarker836">
     </a>
     <span class="koboSpan" id="kobo.1527.1">
      our rule and
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1528.1">
       click
      </span>
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1529.1">
        Next
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1530.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1531.1">
      On the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1532.1">
       Configure metrics
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1533.1">
      page, select our rule, leave the auto-generated name for the metric, select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1534.1">
       Enable sampled requests
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1535.1">
      for
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1536.1">
       Request sampling options
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1537.1">
      , and
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1538.1">
       click
      </span>
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1539.1">
        Next
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1540.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1541.1">
      On the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1542.1">
       Review and create web ACL
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1543.1">
      page, review the changes, and click
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1544.1">
       Create web ACL
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1545.1">
      .
     </span>
     <span class="koboSpan" id="kobo.1545.2">
      If we go to the CloudFront distribution, it will be deploying.
     </span>
     <span class="koboSpan" id="kobo.1545.3">
      Wait until it
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1546.1">
       is deployed.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1547.1">
      Run the URL from the browser
     </span>
     <a id="_idIndexMarker837">
     </a>
     <span class="koboSpan" id="kobo.1548.1">
      with a query string that contains
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1549.1">
       badstring
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1550.1">
      – for example,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1551.1">
       https://d1w6mgtt0jnmgz.cloudfront.net/?name=badstring
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1552.1">
      .
     </span>
     <span class="koboSpan" id="kobo.1552.2">
      We should get a
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1553.1">
       403
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1554.1">
      error,
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1555.1">
       as follows:
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer203">
     <span class="koboSpan" id="kobo.1556.1">
      <img alt="Figure 6.39 – A 403 error" src="image/B21384_06_39.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.1557.1">
     Figure 6.39 – A 403 error
    </span>
   </p>
   <p class="list-inset">
    <span class="koboSpan" id="kobo.1558.1">
     There will be no error if we do not use the word
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1559.1">
      badstring
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1560.1">
     anywhere within
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1561.1">
      our URL.
     </span>
    </span>
   </p>
   <ol>
    <li value="18">
     <span class="koboSpan" id="kobo.1562.1">
      Disassociate the web ACL from our CloudFront distribution,
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1563.1">
       as follows:
      </span>
     </span>
     <ol>
      <li class="upper-roman">
       <span class="koboSpan" id="kobo.1564.1">
        Click on our
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.1565.1">
         web ACL.
        </span>
       </span>
      </li>
      <li class="upper-roman">
       <span class="koboSpan" id="kobo.1566.1">
        Go to the
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.1567.1">
         Associated AWS
        </span>
       </strong>
       <span class="No-Break">
        <strong class="bold">
         <span class="koboSpan" id="kobo.1568.1">
          resources
         </span>
        </strong>
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.1569.1">
         tab.
        </span>
       </span>
      </li>
      <li class="upper-roman">
       <span class="koboSpan" id="kobo.1570.1">
        Select our
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.1571.1">
         CloudFront distribution.
        </span>
       </span>
      </li>
      <li class="upper-roman">
       <span class="koboSpan" id="kobo.1572.1">
        Click
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.1573.1">
         on
        </span>
       </span>
       <span class="No-Break">
        <strong class="bold">
         <span class="koboSpan" id="kobo.1574.1">
          Remove
         </span>
        </strong>
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.1575.1">
         .
        </span>
       </span>
      </li>
     </ol>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1576.1">
      Wait until the status changes to
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1577.1">
       Deployed
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1578.1">
      , and run the URL again from a browser with a query string that contains
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1579.1">
       badstring
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1580.1">
      .
     </span>
     <span class="koboSpan" id="kobo.1580.2">
      The page should load successfully this time, without
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1581.1">
       any errors.
      </span>
     </span>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.1582.1">
       We can also enable WAF while creating a CloudFront distribution, and we can also disable the protection from the
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.1583.1">
        CloudFront distribution.
       </span>
      </span>
     </p>
    </li>
   </ol>
   <h2 id="_idParaDest-258">
    <a id="_idTextAnchor262">
    </a>
    <span class="koboSpan" id="kobo.1584.1">
     How it works...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1585.1">
     A web ACL is the primary component
    </span>
    <a id="_idIndexMarker838">
    </a>
    <span class="koboSpan" id="kobo.1586.1">
     within AWS WAF.
    </span>
    <span class="koboSpan" id="kobo.1586.2">
     A web ACL contains one or more rules.
    </span>
    <span class="koboSpan" id="kobo.1586.3">
     Rules contain conditional statements (for example, block access from a range of IP addresses).
    </span>
    <span class="koboSpan" id="kobo.1586.4">
     We added our own rule using the rule builder.
    </span>
    <span class="koboSpan" id="kobo.1586.5">
     The rule builder has an
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1587.1">
      IF
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1588.1">
     part and a
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1589.1">
      THEN
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1590.1">
     part.
    </span>
    <span class="koboSpan" id="kobo.1590.2">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1591.1">
      IF
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1592.1">
     part contains the condition, while the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1593.1">
      THEN
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1594.1">
     part contains the action that needs to be taken when the condition in the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1595.1">
      IF
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1596.1">
     part is satisfied.
    </span>
    <span class="koboSpan" id="kobo.1596.2">
     In this recipe, we added a simple rule that checks whether the query string contains a string,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1597.1">
      badstring
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1598.1">
     , and blocks
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1599.1">
      such requests.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1600.1">
     In the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1601.1">
      IF
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1602.1">
     part, we can currently inspect the following request components – a header, a single query parameter, all query parameters, the URI path, a query string, a body, and an HTTP method.
    </span>
    <span class="koboSpan" id="kobo.1602.2">
     We can also check whether an IP address is part of an IP set or whether a request originated from a particular country.
    </span>
    <span class="koboSpan" id="kobo.1602.3">
     We created a regular rule in this recipe.
    </span>
    <span class="koboSpan" id="kobo.1602.4">
     We can also create a rate-based rule to set a rate limit for requests from a single user.
    </span>
    <span class="koboSpan" id="kobo.1602.5">
     For example, WAF can block users based on the number of bad requests (
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1603.1">
      4xx errors
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1604.1">
     )
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1605.1">
      they make.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1606.1">
     We can create supporting resources such as IP sets, Regex pattern sets, and rule groups, which are used by some of the conditions, from the left sidebar of the WAF dashboard.
    </span>
    <span class="koboSpan" id="kobo.1606.2">
     We can find the AWS Marketplace rule groups using the AWS Marketplace link, which can be found in the left sidebar of the WAF dashboard.
    </span>
    <span class="koboSpan" id="kobo.1606.3">
     Instead of creating our own rules, we can also add an AWS-managed rule group.
    </span>
    <span class="koboSpan" id="kobo.1606.4">
     Currently, there are three categories of managed rule groups in the console – AWS-managed rule groups, Cyber Security Cloud Inc.-managed security groups, and Fortinet-managed
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1607.1">
      rule groups.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-259">
    <a id="_idTextAnchor263">
    </a>
    <span class="koboSpan" id="kobo.1608.1">
     There’s more...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1609.1">
     At the time of writing, the AWS WAF and AWS Shield services have the same service home page, as we saw in the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.1610.1">
      How to do it...
     </span>
    </em>
    <span class="koboSpan" id="kobo.1611.1">
     section.
    </span>
    <span class="koboSpan" id="kobo.1611.2">
     We saw AWS WAF in detail in this recipe.
    </span>
    <span class="koboSpan" id="kobo.1611.3">
     We will briefly go through some important concepts related to AWS Shield in
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1612.1">
      this section.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1613.1">
     AWS Shield is a managed
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1614.1">
      Distributed Denial of Service
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1615.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1616.1">
      DDoS
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1617.1">
     ) protection service that provides always-on detection
    </span>
    <a id="_idIndexMarker839">
    </a>
    <span class="koboSpan" id="kobo.1618.1">
     and automatic inline mitigations to minimize application downtime and latency, without engaging AWS Support to benefit from
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1619.1">
      DDoS protection.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1620.1">
     There are two tiers of AWS Shield – Standard and Advanced.
    </span>
    <span class="koboSpan" id="kobo.1620.2">
     Shield Standard
    </span>
    <a id="_idIndexMarker840">
    </a>
    <span class="koboSpan" id="kobo.1621.1">
     defends against known infrastructure attacks in a network (layer 3) and transport layer (layer 4) that target our website or applications, and it is most effective when used with Amazon CloudFront and Amazon Route 53.
    </span>
    <span class="koboSpan" id="kobo.1621.2">
     AWS Shield Advanced
    </span>
    <a id="_idIndexMarker841">
    </a>
    <span class="koboSpan" id="kobo.1622.1">
     provides higher levels of protection against attacks targeting our applications running on EC2, ELB, CloudFront, AWS Global Accelerator, and Route
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1623.1">
      53 resources.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-260">
    <a id="_idTextAnchor264">
    </a>
    <span class="koboSpan" id="kobo.1624.1">
     See also
    </span>
   </h2>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.1625.1">
      You can read more
     </span>
     <a id="_idIndexMarker842">
     </a>
     <span class="koboSpan" id="kobo.1626.1">
      about
     </span>
     <a id="_idIndexMarker843">
     </a>
     <span class="koboSpan" id="kobo.1627.1">
      AWS WAF, AWS Shield, and
     </span>
     <a id="_idIndexMarker844">
     </a>
     <span class="koboSpan" id="kobo.1628.1">
      AWS Firewall Manager
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1629.1">
       here:
      </span>
     </span>
     <a href="https://docs.aws.amazon.com/waf/latest/developerguide/what-is-aws-waf.html">
      <span class="No-Break">
       <span class="koboSpan" id="kobo.1630.1">
        https://docs.aws.amazon.com/waf/latest/developerguide/what-is-aws-waf.html
       </span>
      </span>
     </a>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1631.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1632.1">
      You can read more about
     </span>
     <a id="_idIndexMarker845">
     </a>
     <span class="koboSpan" id="kobo.1633.1">
      AWS Shield
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1634.1">
       here:
      </span>
     </span>
     <a href="https://aws.amazon.com/shield/">
      <span class="No-Break">
       <span class="koboSpan" id="kobo.1635.1">
        https://aws.amazon.com/shield/
       </span>
      </span>
     </a>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1636.1">
       .
      </span>
     </span>
    </li>
   </ul>
  </div>
 </body></html>