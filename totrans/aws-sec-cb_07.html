<html><head></head><body>
  <div id="_idContainer230">
   <h1 class="chapter-number" id="_idParaDest-261">
    <a id="_idTextAnchor265">
    </a>
    <span class="koboSpan" id="kobo.1.1">
     7
    </span>
   </h1>
   <h1 id="_idParaDest-262">
    <a id="_idTextAnchor266">
    </a>
    <span class="koboSpan" id="kobo.2.1">
     Monitoring with CloudWatch, CloudTrail, and Config
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.3.1">
     We’ve already looked at many
    </span>
    <a id="_idIndexMarker846">
    </a>
    <span class="koboSpan" id="kobo.4.1">
     aspects of security, such as
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.5.1">
      Confidentiality
     </span>
    </strong>
    <span class="koboSpan" id="kobo.6.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.7.1">
      Integrity
     </span>
    </strong>
    <span class="koboSpan" id="kobo.8.1">
     , and
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.9.1">
      Availability
     </span>
    </strong>
    <span class="koboSpan" id="kobo.10.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.11.1">
      CIA
     </span>
    </strong>
    <span class="koboSpan" id="kobo.12.1">
     ) and
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.13.1">
      Authentication
     </span>
    </strong>
    <span class="koboSpan" id="kobo.14.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.15.1">
      Authorization
     </span>
    </strong>
    <span class="koboSpan" id="kobo.16.1">
     , and
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.17.1">
      Accounting
     </span>
    </strong>
    <span class="koboSpan" id="kobo.18.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.19.1">
      AAA
     </span>
    </strong>
    <span class="koboSpan" id="kobo.20.1">
     ).
    </span>
    <span class="koboSpan" id="kobo.20.2">
     Accounting can be achieved through
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.21.1">
      continuous monitoring
     </span>
    </strong>
    <span class="koboSpan" id="kobo.22.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.23.1">
      alerting
     </span>
    </strong>
    <span class="koboSpan" id="kobo.24.1">
     , and regular
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.25.1">
      auditing
     </span>
    </strong>
    <span class="koboSpan" id="kobo.26.1">
     .
    </span>
    <span class="koboSpan" id="kobo.26.2">
     Proper
    </span>
    <a id="_idIndexMarker847">
    </a>
    <span class="koboSpan" id="kobo.27.1">
     monitoring and
    </span>
    <a id="_idIndexMarker848">
    </a>
    <span class="koboSpan" id="kobo.28.1">
     alerting
    </span>
    <a id="_idIndexMarker849">
    </a>
    <span class="koboSpan" id="kobo.29.1">
     can
    </span>
    <a id="_idIndexMarker850">
    </a>
    <span class="koboSpan" id="kobo.30.1">
     also
    </span>
    <a id="_idIndexMarker851">
    </a>
    <span class="koboSpan" id="kobo.31.1">
     help
    </span>
    <a id="_idIndexMarker852">
    </a>
    <span class="koboSpan" id="kobo.32.1">
     in better
    </span>
    <a id="_idIndexMarker853">
    </a>
    <span class="koboSpan" id="kobo.33.1">
     availability
    </span>
    <a id="_idIndexMarker854">
    </a>
    <span class="koboSpan" id="kobo.34.1">
     through
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.35.1">
      auto-remediation
     </span>
    </strong>
    <span class="koboSpan" id="kobo.36.1">
     .
    </span>
    <span class="koboSpan" id="kobo.36.2">
     In this chapter, we will look into
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.37.1">
      Amazon CloudWatch
     </span>
    </strong>
    <span class="koboSpan" id="kobo.38.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.39.1">
      AWS CloudTrail
     </span>
    </strong>
    <span class="koboSpan" id="kobo.40.1">
     , and
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.41.1">
      AWS Config
     </span>
    </strong>
    <span class="koboSpan" id="kobo.42.1">
     .
    </span>
    <span class="koboSpan" id="kobo.42.2">
     CloudWatch is the primary service within AWS for
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.43.1">
      logging
     </span>
    </strong>
    <span class="koboSpan" id="kobo.44.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.45.1">
      monitoring
     </span>
    </strong>
    <span class="koboSpan" id="kobo.46.1">
     , and alerting.
    </span>
    <span class="koboSpan" id="kobo.46.2">
     CloudTrail can log AWS API calls.
    </span>
    <span class="koboSpan" id="kobo.46.3">
     AWS Config can record and evaluate configurations against predefined config rules.
    </span>
    <span class="koboSpan" id="kobo.46.4">
     We will also learn about
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.47.1">
      Simple Notification Service
     </span>
    </strong>
    <span class="koboSpan" id="kobo.48.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.49.1">
      SNS
     </span>
    </strong>
    <span class="koboSpan" id="kobo.50.1">
     ), which
    </span>
    <a id="_idIndexMarker855">
    </a>
    <span class="koboSpan" id="kobo.51.1">
     will allow us to
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.52.1">
      send notifications.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.53.1">
     In this chapter, we will cover the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.54.1">
      following recipes:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.55.1">
      Creating an SNS topic to
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.56.1">
       send emails
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.57.1">
      Working with CloudWatch alarms
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.58.1">
       and metrics
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.59.1">
      Creating a CloudWatch
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.60.1">
       log group
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.61.1">
      Working with EventBridge (previously
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.62.1">
       CloudWatch Events)
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.63.1">
      Reading and filtering logs
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.64.1">
       in CloudTrail
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.65.1">
      Creating a trail
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.66.1">
       in CloudTrail
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.67.1">
      Using Athena to query CloudTrail logs
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.68.1">
       in S3
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.69.1">
      Integrating CloudWatch with CloudTrail making use of a
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.70.1">
       CloudFormation template
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.71.1">
      Setting up and using
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.72.1">
       AWS Config
      </span>
     </span>
    </li>
   </ul>
   <h1 id="_idParaDest-263">
    <a id="_idTextAnchor267">
    </a>
    <span class="koboSpan" id="kobo.73.1">
     Technical requirements
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.74.1">
     Before diving into the recipes of this chapter, we need to ensure we have the following requirements and knowledge
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.75.1">
      in place:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.76.1">
      We need an active AWS account to complete the recipes within this chapter.
     </span>
     <span class="koboSpan" id="kobo.76.2">
      We can use an account that is part of an AWS Organization or a standalone account.
     </span>
     <span class="koboSpan" id="kobo.76.3">
      I will be using the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.77.1">
       awsseccb-sandbox-1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.78.1">
      account that we created in the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.79.1">
       Multi-account management with AWS Organizations
      </span>
     </em>
     <span class="koboSpan" id="kobo.80.1">
      recipe in
     </span>
     <a href="B21384_01.xhtml#_idTextAnchor020">
      <span class="No-Break">
       <em class="italic">
        <span class="koboSpan" id="kobo.81.1">
         Chapter 1
        </span>
       </em>
      </span>
     </a>
     <span class="koboSpan" id="kobo.82.1">
      .
     </span>
     <span class="koboSpan" id="kobo.82.2">
      However, I won’t be utilizing any AWS Organizations features, meaning you can follow these steps with a standalone
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.83.1">
       account too.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.84.1">
      For administrative actions, we need a user who has
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.85.1">
       AdministratorAccess
      </span>
     </strong>
     <span class="koboSpan" id="kobo.86.1">
      permission to the AWS account we are working with.
     </span>
     <span class="koboSpan" id="kobo.86.2">
      This can be an
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.87.1">
       Identity and Access Management
      </span>
     </strong>
     <span class="koboSpan" id="kobo.88.1">
      (
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.89.1">
       IAM
      </span>
     </strong>
     <span class="koboSpan" id="kobo.90.1">
      ) Identity Center user or an IAM user.
     </span>
     <span class="koboSpan" id="kobo.90.2">
      I will be using the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.91.1">
       awsseccbadmin1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.92.1">
      IAM Identity Center user we created in the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.93.1">
       User management and SSO with IAM Identity Center
      </span>
     </em>
     <span class="koboSpan" id="kobo.94.1">
      recipe in
     </span>
     <a href="B21384_01.xhtml#_idTextAnchor020">
      <span class="No-Break">
       <em class="italic">
        <span class="koboSpan" id="kobo.95.1">
         Chapter 1
        </span>
       </em>
      </span>
     </a>
     <span class="koboSpan" id="kobo.96.1">
      .
     </span>
     <span class="koboSpan" id="kobo.96.2">
      However, I won’t be utilizing any IAM Identity Center features, meaning you can follow these steps with an IAM user, too, if the user has
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.97.1">
       AdministratorAccess
      </span>
     </strong>
     <span class="koboSpan" id="kobo.98.1">
      permission within the account.
     </span>
     <span class="koboSpan" id="kobo.98.2">
      You can create an IAM user following the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.99.1">
       Setting up IAM, an account aliases, and billing alerts
      </span>
     </em>
     <span class="koboSpan" id="kobo.100.1">
      recipe in
     </span>
     <a href="B21384_01.xhtml#_idTextAnchor020">
      <span class="No-Break">
       <em class="italic">
        <span class="koboSpan" id="kobo.101.1">
         Chapter 1
        </span>
       </em>
      </span>
     </a>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.102.1">
       .
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.103.1">
     The code files for this chapter are available
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.104.1">
      at
     </span>
    </span>
    <a href="https://github.com/PacktPublishing/AWS-Security-Cookbook-Second-Edition/tree/main/Chapter07">
     <span class="No-Break">
      <span class="koboSpan" id="kobo.105.1">
       https://github.com/PacktPublishing/AWS-Security-Cookbook-Second-Edition/tree/main/Chapter07
      </span>
     </span>
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.106.1">
      .
     </span>
    </span>
   </p>
   <h1 id="_idParaDest-264">
    <a id="_idTextAnchor268">
    </a>
    <span class="koboSpan" id="kobo.107.1">
     Creating an SNS topic to send emails
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.108.1">
     In this recipe, we
    </span>
    <a id="_idIndexMarker856">
    </a>
    <span class="koboSpan" id="kobo.109.1">
     will learn how to create an SNS topic for sending emails.
    </span>
    <span class="koboSpan" id="kobo.109.2">
     SNS is
    </span>
    <a id="_idIndexMarker857">
    </a>
    <span class="koboSpan" id="kobo.110.1">
     a managed
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.111.1">
      publish/subscribe messaging service
     </span>
    </strong>
    <span class="koboSpan" id="kobo.112.1">
     and can be used with many endpoints, such
    </span>
    <a id="_idIndexMarker858">
    </a>
    <span class="koboSpan" id="kobo.113.1">
     as
    </span>
    <a id="_idIndexMarker859">
    </a>
    <span class="koboSpan" id="kobo.114.1">
     email,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.115.1">
      SMS
     </span>
    </strong>
    <span class="koboSpan" id="kobo.116.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.117.1">
      Lambda
     </span>
    </strong>
    <span class="koboSpan" id="kobo.118.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.119.1">
      Simple Queue Service
     </span>
    </strong>
    <span class="koboSpan" id="kobo.120.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.121.1">
      SQS
     </span>
    </strong>
    <span class="koboSpan" id="kobo.122.1">
     ),
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.123.1">
      and
     </span>
    </span>
    <span class="No-Break">
     <a id="_idIndexMarker860">
     </a>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.124.1">
      more.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-265">
    <a id="_idTextAnchor269">
    </a>
    <span class="koboSpan" id="kobo.125.1">
     Getting ready
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.126.1">
     To successfully complete this recipe, we need a working AWS account, and a user as described in the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.127.1">
      Technical requirements
     </span>
    </em>
    <span class="koboSpan" id="kobo.128.1">
     section, and a working
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.129.1">
      email address.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-266">
    <a id="_idTextAnchor270">
    </a>
    <span class="koboSpan" id="kobo.130.1">
     How to do it...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.131.1">
     We can configure an SNS topic to send emails
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.132.1">
      as follows:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.133.1">
      Go to the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.134.1">
       Simple Notification Service
      </span>
     </strong>
     <span class="koboSpan" id="kobo.135.1">
      service in
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.136.1">
       the console.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.137.1">
      From the left sidebar, click
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.138.1">
       on
      </span>
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.139.1">
        Topics
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.140.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.141.1">
      Click on
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.142.1">
        Create topic
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.143.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.144.1">
      For
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.145.1">
       Type
      </span>
     </strong>
     <span class="koboSpan" id="kobo.146.1">
      ,
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.147.1">
       select
      </span>
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.148.1">
        Standard
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.149.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.150.1">
      For the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.151.1">
       Name
      </span>
     </strong>
     <span class="koboSpan" id="kobo.152.1">
      and
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.153.1">
       Display name - optional
      </span>
     </strong>
     <span class="koboSpan" id="kobo.154.1">
      fields, give meaningful values.
     </span>
     <span class="koboSpan" id="kobo.154.2">
      I have given the name
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.155.1">
       MyEmailTopic
      </span>
     </strong>
     <span class="koboSpan" id="kobo.156.1">
      and the display name
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.157.1">
       My
      </span>
     </strong>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.158.1">
        Email Topic
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.159.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.160.1">
      Leave the other
     </span>
     <a id="_idIndexMarker861">
     </a>
     <span class="koboSpan" id="kobo.161.1">
      options as-is and scroll down to the bottom of the page.
     </span>
     <span class="koboSpan" id="kobo.161.2">
      Click on
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.162.1">
        Create topic
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.163.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.164.1">
      Go to the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.165.1">
       Subscriptions
      </span>
     </strong>
     <span class="koboSpan" id="kobo.166.1">
      tab of
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.167.1">
       our topic.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.168.1">
      Click on
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.169.1">
        Create subscription
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.170.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.171.1">
      On the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.172.1">
       Create subscription
      </span>
     </strong>
     <span class="koboSpan" id="kobo.173.1">
      page, set the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.174.1">
       Protocol
      </span>
     </strong>
     <span class="koboSpan" id="kobo.175.1">
      field to
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.176.1">
       Email
      </span>
     </strong>
     <span class="koboSpan" id="kobo.177.1">
      , and provide an email address that we have access to as the value for the
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.178.1">
        Endpoint
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.179.1">
       field.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.180.1">
      Scroll down and click
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.181.1">
       Create subscription
      </span>
     </strong>
     <span class="koboSpan" id="kobo.182.1">
      .
     </span>
     <span class="koboSpan" id="kobo.182.2">
      The status of our subscription will be
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.183.1">
       Pending
      </span>
     </strong>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.184.1">
        confirmation
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.185.1">
       initially.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.186.1">
      Log in to your email and click on the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.187.1">
       Confirm subscription
      </span>
     </strong>
     <span class="koboSpan" id="kobo.188.1">
      hyperlink.
     </span>
     <span class="koboSpan" id="kobo.188.2">
      We should get a
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.189.1">
       Subscription confirmed
      </span>
     </strong>
     <span class="koboSpan" id="kobo.190.1">
      message.
     </span>
     <span class="koboSpan" id="kobo.190.2">
      If we go back to our subscription in the AWS console and refresh the page, our status should
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.191.1">
       be
      </span>
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.192.1">
        Confirmed
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.193.1">
       .
      </span>
     </span>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.194.1">
     We have created an SNS topic in this recipe.
    </span>
    <span class="koboSpan" id="kobo.194.2">
     We will be using this topic in future recipes within
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.195.1">
      this chapter.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-267">
    <a id="_idTextAnchor271">
    </a>
    <span class="koboSpan" id="kobo.196.1">
     How it works...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.197.1">
     In this recipe, we created an SNS topic with an email subscription.
    </span>
    <span class="koboSpan" id="kobo.197.2">
     To avoid spam, AWS requires us to manually confirm the ownership of the email address by clicking on the confirmation link that was sent to the specified
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.198.1">
      email address.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-268">
    <a id="_idTextAnchor272">
    </a>
    <span class="koboSpan" id="kobo.199.1">
     There’s more...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.200.1">
     In this recipe, we selected the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.201.1">
      Email
     </span>
    </strong>
    <span class="koboSpan" id="kobo.202.1">
     protocol.
    </span>
    <span class="koboSpan" id="kobo.202.2">
     The following protocols are currently supported:
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.203.1">
      Email
     </span>
    </strong>
    <span class="koboSpan" id="kobo.204.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.205.1">
      Amazon Kinesis Data Firehose
     </span>
    </strong>
    <span class="koboSpan" id="kobo.206.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.207.1">
      Amazon SQS
     </span>
    </strong>
    <span class="koboSpan" id="kobo.208.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.209.1">
      Amazon Lambda
     </span>
    </strong>
    <span class="koboSpan" id="kobo.210.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.211.1">
      Email-JSON
     </span>
    </strong>
    <span class="koboSpan" id="kobo.212.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.213.1">
      HTTP
     </span>
    </strong>
    <span class="koboSpan" id="kobo.214.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.215.1">
      HTTPS
     </span>
    </strong>
    <span class="koboSpan" id="kobo.216.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.217.1">
      Platform application endpoint
     </span>
    </strong>
    <span class="koboSpan" id="kobo.218.1">
     , and
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.219.1">
      SMS
     </span>
    </strong>
    <span class="koboSpan" id="kobo.220.1">
     .
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.221.1">
      Email-JSON
     </span>
    </strong>
    <span class="koboSpan" id="kobo.222.1">
     is different from the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.223.1">
      Email
     </span>
    </strong>
    <span class="koboSpan" id="kobo.224.1">
     protocol.
    </span>
    <span class="koboSpan" id="kobo.224.2">
     The
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.225.1">
      Email-JSON
     </span>
    </strong>
    <span class="koboSpan" id="kobo.226.1">
     protocol structures the
    </span>
    <a id="_idIndexMarker862">
    </a>
    <span class="koboSpan" id="kobo.227.1">
     output as JSON and is useful for services that read emails and process
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.228.1">
      them automatically.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-269">
    <a id="_idTextAnchor273">
    </a>
    <span class="koboSpan" id="kobo.229.1">
     See also
    </span>
   </h2>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.230.1">
      You can read more about SNS
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.231.1">
       at
      </span>
     </span>
     <a href="https://www.cloudericks.com/blog/getting-started-with-amazon-sns-service">
      <span class="No-Break">
       <span class="koboSpan" id="kobo.232.1">
        https://www.cloudericks.com/blog/getting-started-with-amazon-sns-service
       </span>
      </span>
     </a>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.233.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.234.1">
      We can also
     </span>
     <a id="_idIndexMarker863">
     </a>
     <span class="koboSpan" id="kobo.235.1">
      use
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.236.1">
       Simple Email Service
      </span>
     </strong>
     <span class="koboSpan" id="kobo.237.1">
      (
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.238.1">
       SES
      </span>
     </strong>
     <span class="koboSpan" id="kobo.239.1">
      ) to send email notifications instead of using SNS.
     </span>
     <span class="koboSpan" id="kobo.239.2">
      SES is a cloud-based email service for sending and
     </span>
     <a id="_idIndexMarker864">
     </a>
     <span class="koboSpan" id="kobo.240.1">
      receiving emails.
     </span>
     <span class="koboSpan" id="kobo.240.2">
      It uses the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.241.1">
       Simple Mail Transfer Protocol
      </span>
     </strong>
     <span class="koboSpan" id="kobo.242.1">
      (
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.243.1">
       SMTP
      </span>
     </strong>
     <span class="koboSpan" id="kobo.244.1">
      ) interface, and all connections to the SMTP endpoint should be encrypted using
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.245.1">
       Transport Layer Security
      </span>
     </strong>
     <span class="koboSpan" id="kobo.246.1">
      (
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.247.1">
       TLS
      </span>
     </strong>
     <span class="koboSpan" id="kobo.248.1">
      ).
     </span>
     <span class="koboSpan" id="kobo.248.2">
      The
     </span>
     <a id="_idIndexMarker865">
     </a>
     <span class="koboSpan" id="kobo.249.1">
      default port for
     </span>
     <a id="_idIndexMarker866">
     </a>
     <span class="koboSpan" id="kobo.250.1">
      SES is
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.251.1">
       25
      </span>
     </strong>
     <span class="koboSpan" id="kobo.252.1">
      , but to avoid
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.253.1">
       Elastic Compute Cloud
      </span>
     </strong>
     <span class="koboSpan" id="kobo.254.1">
      (
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.255.1">
       EC2
      </span>
     </strong>
     <span class="koboSpan" id="kobo.256.1">
      ) throttling email traffic, we can also use port
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.257.1">
       587
      </span>
     </strong>
     <span class="koboSpan" id="kobo.258.1">
      or
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.259.1">
       2587
      </span>
     </strong>
     <span class="koboSpan" id="kobo.260.1">
      .
     </span>
     <span class="koboSpan" id="kobo.260.2">
      Read more about SES
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.261.1">
       at
      </span>
     </span>
     <a href="https://www.cloudericks.com/blog/getting-started-with-amazon-ses">
      <span class="No-Break">
       <span class="koboSpan" id="kobo.262.1">
        https://www.cloudericks.com/blog/getting-started-with-amazon-ses
       </span>
      </span>
     </a>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.263.1">
       .
      </span>
     </span>
    </li>
   </ul>
   <h1 id="_idParaDest-270">
    <a id="_idTextAnchor274">
    </a>
    <span class="koboSpan" id="kobo.264.1">
     Working with CloudWatch alarms and metrics
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.265.1">
     In this recipe, we
    </span>
    <a id="_idIndexMarker867">
    </a>
    <span class="koboSpan" id="kobo.266.1">
     will
    </span>
    <a id="_idIndexMarker868">
    </a>
    <span class="koboSpan" id="kobo.267.1">
     create a
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.268.1">
      CloudWatch alarm
     </span>
    </strong>
    <span class="koboSpan" id="kobo.269.1">
     using one of the metrics already available.
    </span>
    <span class="koboSpan" id="kobo.269.2">
     Being the first recipe about CloudWatch, we will also learn about some of the important features
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.270.1">
      of CloudWatch.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-271">
    <a id="_idTextAnchor275">
    </a>
    <span class="koboSpan" id="kobo.271.1">
     Getting ready
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.272.1">
     We need the following to successfully complete
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.273.1">
      this recipe:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.274.1">
      A working AWS account and a user as described in the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.275.1">
       Technical
      </span>
     </em>
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.276.1">
        requirements
       </span>
      </em>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.277.1">
       section.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.278.1">
      An SNS topic with an email subscription following the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.279.1">
       Creating an SNS topic to send emails
      </span>
     </em>
     <span class="koboSpan" id="kobo.280.1">
      recipe from
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.281.1">
       this chapter.
      </span>
     </span>
    </li>
   </ul>
   <h2 id="_idParaDest-272">
    <a id="_idTextAnchor276">
    </a>
    <span class="koboSpan" id="kobo.282.1">
     How to do it...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.283.1">
     We can create a CloudWatch alarm using existing metrics
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.284.1">
      as follows:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.285.1">
      Go to the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.286.1">
       CloudWatch
      </span>
     </strong>
     <span class="koboSpan" id="kobo.287.1">
      service in
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.288.1">
       the console.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.289.1">
      Expand
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.290.1">
       Alarms
      </span>
     </strong>
     <span class="koboSpan" id="kobo.291.1">
      from the left sidebar then click on
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.292.1">
        In alarm
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.293.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.294.1">
      Click on
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.295.1">
        Create alarm
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.296.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.297.1">
      Click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.298.1">
       Select metric
      </span>
     </strong>
     <span class="koboSpan" id="kobo.299.1">
      .
     </span>
     <span class="koboSpan" id="kobo.299.2">
      This should show us all the metrics that are available to us based on the services
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.300.1">
       we use.
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer205">
     <span class="koboSpan" id="kobo.301.1">
      <img alt="Figure 7.1 – Selecting a metric" src="image/B21384_07_1.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.302.1">
     Figure 7.1 – Selecting a metric
    </span>
   </p>
   <ol>
    <li value="5">
     <span class="koboSpan" id="kobo.303.1">
      Click
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.304.1">
       on
      </span>
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.305.1">
        Billing
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.306.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.307.1">
      Click on
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.308.1">
        By Service
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.309.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.310.1">
      Select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.311.1">
       Amazon EC2
      </span>
     </strong>
     <span class="koboSpan" id="kobo.312.1">
      and
     </span>
     <a id="_idIndexMarker869">
     </a>
     <span class="koboSpan" id="kobo.313.1">
      click
     </span>
     <a id="_idIndexMarker870">
     </a>
     <span class="koboSpan" id="kobo.314.1">
      on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.315.1">
       Select metric
      </span>
     </strong>
     <span class="koboSpan" id="kobo.316.1">
      .
     </span>
     <span class="koboSpan" id="kobo.316.2">
      This will take us to the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.317.1">
       Specify metric and
      </span>
     </strong>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.318.1">
        conditions
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.319.1">
       screen.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.320.1">
      In the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.321.1">
       Metric
      </span>
     </strong>
     <span class="koboSpan" id="kobo.322.1">
      section of the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.323.1">
       Specify metric and conditions
      </span>
     </strong>
     <span class="koboSpan" id="kobo.324.1">
      screen, use the defaults shown in the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.325.1">
       following screenshot:
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer206">
     <span class="koboSpan" id="kobo.326.1">
      <img alt="Figure 7.2 – EstimatedCharges metric configuration" src="image/B21384_07_2.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.327.1">
     Figure 7.2 – EstimatedCharges metric configuration
    </span>
   </p>
   <ol>
    <li value="9">
     <span class="koboSpan" id="kobo.328.1">
      In
     </span>
     <a id="_idIndexMarker871">
     </a>
     <span class="koboSpan" id="kobo.329.1">
      the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.330.1">
       Conditions
      </span>
     </strong>
     <span class="koboSpan" id="kobo.331.1">
      section, define
     </span>
     <a id="_idIndexMarker872">
     </a>
     <span class="koboSpan" id="kobo.332.1">
      the threshold value as
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.333.1">
       1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.334.1">
      and use the defaults for the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.335.1">
       other fields.
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer207">
     <span class="koboSpan" id="kobo.336.1">
      <img alt="Figure 7.3 – Conditions for the metric" src="image/B21384_07_3.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.337.1">
     Figure 7.3 – Conditions for the metric
    </span>
   </p>
   <ol>
    <li value="10">
     <span class="No-Break">
      <span class="koboSpan" id="kobo.338.1">
       Click
      </span>
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.339.1">
        Next
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.340.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.341.1">
      On
     </span>
     <a id="_idIndexMarker873">
     </a>
     <span class="koboSpan" id="kobo.342.1">
      the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.343.1">
       Configure actions
      </span>
     </strong>
     <span class="koboSpan" id="kobo.344.1">
      page, select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.345.1">
       In alarm
      </span>
     </strong>
     <span class="koboSpan" id="kobo.346.1">
      for
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.347.1">
       Alarm state trigger
      </span>
     </strong>
     <span class="koboSpan" id="kobo.348.1">
      .
     </span>
     <span class="koboSpan" id="kobo.348.2">
      Under
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.349.1">
       Send a notification to the following SNS topic
      </span>
     </strong>
     <span class="koboSpan" id="kobo.350.1">
      , select
     </span>
     <a id="_idIndexMarker874">
     </a>
     <span class="koboSpan" id="kobo.351.1">
      the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.352.1">
       Select an existing SNS topic
      </span>
     </strong>
     <span class="koboSpan" id="kobo.353.1">
      option and select the SNS topic we created for this recipe as mentioned in the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.354.1">
       Getting ready
      </span>
     </em>
     <span class="koboSpan" id="kobo.355.1">
      section.
     </span>
     <span class="koboSpan" id="kobo.355.2">
      Leave the other options as-is, as shown in the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.356.1">
       following screenshot:
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer208">
     <span class="koboSpan" id="kobo.357.1">
      <img alt="Figure 7.4 – Notification configuration for metric" src="image/B21384_07_4.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.358.1">
     Figure 7.4 – Notification configuration for metric
    </span>
   </p>
   <ol>
    <li value="12">
     <span class="koboSpan" id="kobo.359.1">
      Scroll down
     </span>
     <a id="_idIndexMarker875">
     </a>
     <span class="koboSpan" id="kobo.360.1">
      and
     </span>
     <a id="_idIndexMarker876">
     </a>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.361.1">
       click
      </span>
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.362.1">
        Next
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.363.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.364.1">
      Provide
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.365.1">
       Name
      </span>
     </strong>
     <span class="koboSpan" id="kobo.366.1">
      and
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.367.1">
       Alarm description - optional
      </span>
     </strong>
     <span class="koboSpan" id="kobo.368.1">
      values for our alarm.
     </span>
     <span class="koboSpan" id="kobo.368.2">
      I have set the name to
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.369.1">
       MyEC2BillingAlarm
      </span>
     </strong>
     <span class="koboSpan" id="kobo.370.1">
      and the alarm description to
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.371.1">
       My EC2 Billing Alarm
      </span>
     </strong>
     <span class="koboSpan" id="kobo.372.1">
      .
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.373.1">
       Click
      </span>
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.374.1">
        Next
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.375.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.376.1">
      Review the details, scroll down, and click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.377.1">
       Create alarm
      </span>
     </strong>
     <span class="koboSpan" id="kobo.378.1">
      .
     </span>
     <span class="koboSpan" id="kobo.378.2">
      The alarm will appear now on the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.379.1">
       Alarms
      </span>
     </strong>
     <span class="koboSpan" id="kobo.380.1">
      page.
     </span>
     <span class="koboSpan" id="kobo.380.2">
      Initially, the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.381.1">
       State
      </span>
     </strong>
     <span class="koboSpan" id="kobo.382.1">
      field of the alarm will have a value of
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.383.1">
       Insufficient data
      </span>
     </strong>
     <span class="koboSpan" id="kobo.384.1">
      .
     </span>
     <span class="koboSpan" id="kobo.384.2">
      The state should change to
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.385.1">
       OK
      </span>
     </strong>
     <span class="koboSpan" id="kobo.386.1">
      in some time.
     </span>
     <span class="koboSpan" id="kobo.386.2">
      Make sure we have a running EC2 instance.
     </span>
     <span class="koboSpan" id="kobo.386.3">
      When the alarm state changes to the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.387.1">
       In Alarm
      </span>
     </strong>
     <span class="koboSpan" id="kobo.388.1">
      state, we should get a notification in the email configured
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.389.1">
       with SNS.
      </span>
     </span>
    </li>
   </ol>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.390.1">
     Important note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.391.1">
     I have used a considerably lower value for the threshold and used the EC2 service enough to trigger an alarm.
    </span>
    <span class="koboSpan" id="kobo.391.2">
     You may use a threshold value as per
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.392.1">
      your requirements.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-273">
    <a id="_idTextAnchor277">
    </a>
    <span class="koboSpan" id="kobo.393.1">
     How it works...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.394.1">
     We specify the metric while creating a CloudWatch alarm.
    </span>
    <span class="koboSpan" id="kobo.394.2">
     We can also specify the time period to evaluate
    </span>
    <a id="_idIndexMarker877">
    </a>
    <span class="koboSpan" id="kobo.395.1">
     the
    </span>
    <a id="_idIndexMarker878">
    </a>
    <span class="koboSpan" id="kobo.396.1">
     metric, the number of such periods to evaluate before raising an alarm, and the number of data points within the evaluation period, during which the threshold should be crossed, for an alarm to trigger.
    </span>
    <span class="koboSpan" id="kobo.396.2">
     An alarm’s trigger can further trigger additional actions, such as sending a notification through an email, configuring Auto Scaling actions, as well as EC2 actions such as rebooting a
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.397.1">
      failed instance.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.398.1">
     A CloudWatch alarm has three states, namely
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.399.1">
      INSUFFICIENT DATA
     </span>
    </strong>
    <span class="koboSpan" id="kobo.400.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.401.1">
      OK
     </span>
    </strong>
    <span class="koboSpan" id="kobo.402.1">
     , and
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.403.1">
      ALARM
     </span>
    </strong>
    <span class="koboSpan" id="kobo.404.1">
     .
    </span>
    <span class="koboSpan" id="kobo.404.2">
     Until it gets enough data to do the analysis, the state will be
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.405.1">
      INSUFFICIENT DATA
     </span>
    </strong>
    <span class="koboSpan" id="kobo.406.1">
     .
    </span>
    <span class="koboSpan" id="kobo.406.2">
     After it has enough data points to evaluate and if the result does not cross the threshold over the specified time periods, the state will be
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.407.1">
      OK
     </span>
    </strong>
    <span class="koboSpan" id="kobo.408.1">
     .
    </span>
    <span class="koboSpan" id="kobo.408.2">
     If the result crosses the threshold in the specified time periods, the alarm is triggered and the CloudWatch alarm goes to the
    </span>
    <span class="No-Break">
     <strong class="bold">
      <span class="koboSpan" id="kobo.409.1">
       ALARM
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.410.1">
      state.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-274">
    <a id="_idTextAnchor278">
    </a>
    <span class="koboSpan" id="kobo.411.1">
     There’s more...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.412.1">
     Let’s go through some important concepts related
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.413.1">
      to CloudWatch:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.414.1">
      CloudWatch metrics support alarms, metrics,
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.415.1">
       and dashboards.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.416.1">
      CloudWatch Logs provides log streams and log groups so that we can log data from
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.417.1">
       our applications.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.418.1">
      CloudWatch events support notifications and auto-remediation using
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.419.1">
       AWS Lambda.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.420.1">
      AWS gives us some metrics out of the box and allows us to create custom metrics for
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.421.1">
       our applications.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.422.1">
      Amazon CloudWatch can integrate with AWS X-Ray to provide traces and metrics related to your
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.423.1">
       application’s performance.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.424.1">
      CloudWatch integrates with services such as SNS, SQS, AWS Lambda, AWS Auto Scaling, and more for notifications
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.425.1">
       and auto-remediation.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.426.1">
      Under
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.427.1">
       Alarms
      </span>
     </strong>
     <span class="koboSpan" id="kobo.428.1">
      in the left sidebar, we have a dedicated
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.429.1">
        Billing
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.430.1">
       option.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.431.1">
      The default EC2 metrics support important operations, including CPU utilization, disk read and
     </span>
     <a id="_idIndexMarker879">
     </a>
     <span class="koboSpan" id="kobo.432.1">
      write
     </span>
     <a id="_idIndexMarker880">
     </a>
     <span class="koboSpan" id="kobo.433.1">
      operations, network input and output operations, and status
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.434.1">
       check failures.
      </span>
     </span>
    </li>
   </ul>
   <h2 id="_idParaDest-275">
    <a id="_idTextAnchor279">
    </a>
    <span class="koboSpan" id="kobo.435.1">
     See also
    </span>
   </h2>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.436.1">
      Read about CloudWatch
     </span>
     <a id="_idIndexMarker881">
     </a>
     <span class="koboSpan" id="kobo.437.1">
      custom metrics
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.438.1">
       here:
      </span>
     </span>
     <a href="https://www.cloudericks.com/blog/getting-started-with-amazon-cloudwatch-custom-metrics">
      <span class="No-Break">
       <span class="koboSpan" id="kobo.439.1">
        https://www.cloudericks.com/blog/getting-started-with-amazon-cloudwatch-custom-metrics
       </span>
      </span>
     </a>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.440.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.441.1">
      CloudWatch dashboards provide us with a single place to look into related metrics.
     </span>
     <span class="koboSpan" id="kobo.441.2">
      Read about creating a dashboard in CloudWatch
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.442.1">
       at
      </span>
     </span>
     <a href="https://www.cloudericks.com/blog/creating-an-amazon-cloudwatch-dashboard">
      <span class="No-Break">
       <span class="koboSpan" id="kobo.443.1">
        https://www.cloudericks.com/blog/creating-an-amazon-cloudwatch-dashboard
       </span>
      </span>
     </a>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.444.1">
       .
      </span>
     </span>
    </li>
   </ul>
   <h1 id="_idParaDest-276">
    <a id="_idTextAnchor280">
    </a>
    <span class="koboSpan" id="kobo.445.1">
     Creating a CloudWatch log group
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.446.1">
     In this recipe, we
    </span>
    <a id="_idIndexMarker882">
    </a>
    <span class="koboSpan" id="kobo.447.1">
     will create a
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.448.1">
      CloudWatch log group
     </span>
    </strong>
    <span class="koboSpan" id="kobo.449.1">
     that will be used in other recipes in
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.450.1">
      this book.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-277">
    <a id="_idTextAnchor281">
    </a>
    <span class="koboSpan" id="kobo.451.1">
     Getting ready
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.452.1">
     To successfully complete this recipe, we need a working AWS account, and a user as described in the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.453.1">
      Technical
     </span>
    </em>
    <span class="No-Break">
     <em class="italic">
      <span class="koboSpan" id="kobo.454.1">
       requirements
      </span>
     </em>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.455.1">
      section.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-278">
    <a id="_idTextAnchor282">
    </a>
    <span class="koboSpan" id="kobo.456.1">
     How to do it...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.457.1">
     We can create a CloudWatch log group
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.458.1">
      as follows:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.459.1">
      Go to the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.460.1">
       CloudWatch
      </span>
     </strong>
     <span class="koboSpan" id="kobo.461.1">
      service in
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.462.1">
       the console.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.463.1">
      Expand
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.464.1">
       Logs
      </span>
     </strong>
     <span class="koboSpan" id="kobo.465.1">
      from the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.466.1">
       left sidebar.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.467.1">
      Click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.468.1">
       Log groups
      </span>
     </strong>
     <span class="koboSpan" id="kobo.469.1">
      and click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.470.1">
       Create
      </span>
     </strong>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.471.1">
        log group
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.472.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.473.1">
      Give the log group a name that describes its purpose and leave other settings as default, then click
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.474.1">
       on
      </span>
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.475.1">
        Create
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.476.1">
       .
      </span>
     </span>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.477.1">
     This will create a new log group
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.478.1">
      for us.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-279">
    <a id="_idTextAnchor283">
    </a>
    <span class="koboSpan" id="kobo.479.1">
     How it works...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.480.1">
     There are not many settings that need to be provided while creating a log group.
    </span>
    <span class="koboSpan" id="kobo.480.2">
     We can use this log group within other recipes where we log in to CloudWatch.
    </span>
    <span class="koboSpan" id="kobo.480.3">
     A log group is a group of log streams.
    </span>
    <span class="koboSpan" id="kobo.480.4">
     A log stream is a sequence of log events from the same source.
    </span>
    <span class="koboSpan" id="kobo.480.5">
     Log streams within a log group share the same retention, monitoring, and access control settings.
    </span>
    <span class="koboSpan" id="kobo.480.6">
     We can specify which streams to put into each log group.
    </span>
    <span class="koboSpan" id="kobo.480.7">
     There is no limit on the number of log streams in a
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.481.1">
      log group.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-280">
    <a id="_idTextAnchor284">
    </a>
    <span class="koboSpan" id="kobo.482.1">
     There’s more...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.483.1">
     Log groups may be
    </span>
    <a id="_idIndexMarker883">
    </a>
    <span class="koboSpan" id="kobo.484.1">
     used from other services and features, such as VPC Flow Logs, as we’ve seen in the book.
    </span>
    <span class="koboSpan" id="kobo.484.2">
     Log groups can also be used for our custom-built applications
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.485.1">
      and microservices.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-281">
    <a id="_idTextAnchor285">
    </a>
    <span class="koboSpan" id="kobo.486.1">
     See also
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.487.1">
     Read more about
    </span>
    <a id="_idIndexMarker884">
    </a>
    <span class="koboSpan" id="kobo.488.1">
     CloudWatch logs
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.489.1">
      at
     </span>
    </span>
    <a href="https://www.cloudericks.com/blog/getting-started-with-amazon-cloudwatch-logs">
     <span class="No-Break">
      <span class="koboSpan" id="kobo.490.1">
       https://www.cloudericks.com/blog/getting-started-with-amazon-cloudwatch-logs
      </span>
     </span>
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.491.1">
      .
     </span>
    </span>
   </p>
   <h1 id="_idParaDest-282">
    <a id="_idTextAnchor286">
    </a>
    <span class="koboSpan" id="kobo.492.1">
     Working with EventBridge (previously CloudWatch Events)
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.493.1">
     In this recipe, we will
    </span>
    <a id="_idIndexMarker885">
    </a>
    <span class="koboSpan" id="kobo.494.1">
     learn how to create and use the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.495.1">
      EventBridge
     </span>
    </strong>
    <span class="koboSpan" id="kobo.496.1">
     service (previously
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.497.1">
      CloudWatch Events
     </span>
    </strong>
    <span class="koboSpan" id="kobo.498.1">
     ).
    </span>
    <span class="koboSpan" id="kobo.498.2">
     CloudWatch events provide us with a near-real-time
    </span>
    <a id="_idIndexMarker886">
    </a>
    <span class="koboSpan" id="kobo.499.1">
     stream of system events from various AWS resources, and we can create rules to take actions based on the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.500.1">
      event data.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-283">
    <a id="_idTextAnchor287">
    </a>
    <span class="koboSpan" id="kobo.501.1">
     Getting ready
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.502.1">
     We need the following to successfully complete
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.503.1">
      this recipe:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.504.1">
      A working AWS account and a user as described in the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.505.1">
       Technical
      </span>
     </em>
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.506.1">
        requirements
       </span>
      </em>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.507.1">
       section.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.508.1">
      An SNS topic with an email subscription following the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.509.1">
       Creating an SNS topic to send emails
      </span>
     </em>
     <span class="koboSpan" id="kobo.510.1">
      recipe from
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.511.1">
       this chapter.
      </span>
     </span>
    </li>
   </ul>
   <h2 id="_idParaDest-284">
    <a id="_idTextAnchor288">
    </a>
    <span class="koboSpan" id="kobo.512.1">
     How to do it...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.513.1">
     We can work with EventBridge (or CloudWatch events)
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.514.1">
      as follows:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.515.1">
      Go to the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.516.1">
       Amazon EventBridge
      </span>
     </strong>
     <span class="koboSpan" id="kobo.517.1">
      service in
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.518.1">
       the console.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.519.1">
      On the left sidebar, expand
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.520.1">
       Buses
      </span>
     </strong>
     <span class="koboSpan" id="kobo.521.1">
      and click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.522.1">
       Rules
      </span>
     </strong>
     <span class="koboSpan" id="kobo.523.1">
      .
     </span>
     <span class="koboSpan" id="kobo.523.2">
      Click on
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.524.1">
        Create rule
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.525.1">
       .
      </span>
     </span>
    </li>
   </ol>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.526.1">
     Tip
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.527.1">
     If you are creating events using the CloudWatch service, you have to go to the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.528.1">
      Amazon CloudWatch
     </span>
    </strong>
    <span class="koboSpan" id="kobo.529.1">
     service from the console.
    </span>
    <span class="koboSpan" id="kobo.529.2">
     On the left sidebar, select
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.530.1">
      Rules
     </span>
    </strong>
    <span class="koboSpan" id="kobo.531.1">
     under
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.532.1">
      Events
     </span>
    </strong>
    <span class="koboSpan" id="kobo.533.1">
     , and you will be redirected to the EventBridge console to create a rule with a
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.534.1">
      CloudWatch Events console is now deprecated
     </span>
    </strong>
    <span class="koboSpan" id="kobo.535.1">
     message and use the EventBridge console to create and manage event buses and rules.
    </span>
    <span class="koboSpan" id="kobo.535.2">
     Click on
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.536.1">
      Create rule
     </span>
    </strong>
    <span class="koboSpan" id="kobo.537.1">
     .
    </span>
    <span class="koboSpan" id="kobo.537.2">
     The remaining steps are the same for
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.538.1">
      creating events.
     </span>
    </span>
   </p>
   <ol>
    <li value="3">
     <span class="koboSpan" id="kobo.539.1">
      Enter
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.540.1">
       my-sec-cb-rule-1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.541.1">
      as the name and an optional description of
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.542.1">
       My Sec CB Rule 1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.543.1">
      .
     </span>
     <span class="koboSpan" id="kobo.543.2">
      Leave the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.544.1">
       Event bus
      </span>
     </strong>
     <span class="koboSpan" id="kobo.545.1">
      selection as
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.546.1">
       default
      </span>
     </strong>
     <span class="koboSpan" id="kobo.547.1">
      .
     </span>
     <span class="koboSpan" id="kobo.547.2">
      Lastly, choose
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.548.1">
       Rule with an event pattern
      </span>
     </strong>
     <span class="koboSpan" id="kobo.549.1">
      as the rule type.
     </span>
     <span class="koboSpan" id="kobo.549.2">
      Click
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.550.1">
       on
      </span>
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.551.1">
        Next
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.552.1">
       .
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer209">
     <span class="koboSpan" id="kobo.553.1">
      <img alt="Figure 7.5 – Rule detail" src="image/B21384_07_5.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.554.1">
     Figure 7.5 – Rule detail
    </span>
   </p>
   <ol>
    <li value="4">
     <span class="koboSpan" id="kobo.555.1">
      Under
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.556.1">
       Event source
      </span>
     </strong>
     <span class="koboSpan" id="kobo.557.1">
      , select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.558.1">
       AWS events or EventBridge
      </span>
     </strong>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.559.1">
        partner events
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.560.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.561.1">
      Under
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.562.1">
       Sample event - optional
      </span>
     </strong>
     <span class="koboSpan" id="kobo.563.1">
      , leave
     </span>
     <a id="_idIndexMarker887">
     </a>
     <span class="koboSpan" id="kobo.564.1">
      the default selection for
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.565.1">
       Sample event type
      </span>
     </strong>
     <span class="koboSpan" id="kobo.566.1">
      of
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.567.1">
       AWS events
      </span>
     </strong>
     <span class="koboSpan" id="kobo.568.1">
      as-is, and do not select any
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.569.1">
       sample events.
      </span>
     </span>
    </li>
   </ol>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.570.1">
     Important note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.571.1">
     Including sample events is optional but recommended, as they can assist us in writing and testing event patterns or filtering criteria.
    </span>
    <span class="koboSpan" id="kobo.571.2">
     We can reference a sample event when creating an event pattern or use it to test if the event
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.572.1">
      pattern matches.
     </span>
    </span>
   </p>
   <ol>
    <li value="6">
     <span class="koboSpan" id="kobo.573.1">
      Under
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.574.1">
       Creation method
      </span>
     </strong>
     <span class="koboSpan" id="kobo.575.1">
      , select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.576.1">
       Use
      </span>
     </strong>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.577.1">
        pattern form
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.578.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.579.1">
      Under
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.580.1">
       Event pattern
      </span>
     </strong>
     <span class="koboSpan" id="kobo.581.1">
      , do
     </span>
     <a id="_idIndexMarker888">
     </a>
     <span class="koboSpan" id="kobo.582.1">
      the following, as shown in
     </span>
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.583.1">
        Figure 7
       </span>
      </em>
     </span>
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.584.1">
        .6
       </span>
      </em>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.585.1">
       :
      </span>
     </span>
     <ol>
      <li class="upper-roman">
       <span class="koboSpan" id="kobo.586.1">
        Set
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.587.1">
         Event source
        </span>
       </strong>
       <span class="koboSpan" id="kobo.588.1">
        to
       </span>
       <span class="No-Break">
        <strong class="bold">
         <span class="koboSpan" id="kobo.589.1">
          AWS services
         </span>
        </strong>
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.590.1">
         .
        </span>
       </span>
      </li>
      <li class="upper-roman">
       <span class="koboSpan" id="kobo.591.1">
        Set
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.592.1">
         AWS service
        </span>
       </strong>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.593.1">
         to
        </span>
       </span>
       <span class="No-Break">
        <strong class="bold">
         <span class="koboSpan" id="kobo.594.1">
          EC2
         </span>
        </strong>
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.595.1">
         .
        </span>
       </span>
      </li>
      <li class="upper-roman">
       <span class="koboSpan" id="kobo.596.1">
        Set
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.597.1">
         Event type
        </span>
       </strong>
       <span class="koboSpan" id="kobo.598.1">
        to
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.599.1">
         EC2 Instance
        </span>
       </strong>
       <span class="No-Break">
        <strong class="bold">
         <span class="koboSpan" id="kobo.600.1">
          State-change Notification
         </span>
        </strong>
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.601.1">
         .
        </span>
       </span>
      </li>
      <li class="upper-roman">
       <span class="koboSpan" id="kobo.602.1">
        Set
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.603.1">
         Event Type Specification 1
        </span>
       </strong>
       <span class="koboSpan" id="kobo.604.1">
        to
       </span>
       <span class="No-Break">
        <strong class="bold">
         <span class="koboSpan" id="kobo.605.1">
          Any state
         </span>
        </strong>
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.606.1">
         .
        </span>
       </span>
      </li>
      <li class="upper-roman">
       <span class="koboSpan" id="kobo.607.1">
        Set
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.608.1">
         Event Type Specification 2
        </span>
       </strong>
       <span class="koboSpan" id="kobo.609.1">
        to
       </span>
       <span class="No-Break">
        <strong class="bold">
         <span class="koboSpan" id="kobo.610.1">
          Any instance
         </span>
        </strong>
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.611.1">
         .
        </span>
       </span>
      </li>
     </ol>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer210">
     <span class="koboSpan" id="kobo.612.1">
      <img alt="Figure 7.6 – Event pattern section" src="image/B21384_07_6.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.613.1">
     Figure 7.6 – Event pattern section
    </span>
   </p>
   <ol>
    <li value="8">
     <span class="koboSpan" id="kobo.614.1">
      Click
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.615.1">
       on
      </span>
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.616.1">
        Next
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.617.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.618.1">
      Under
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.619.1">
       Target 1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.620.1">
      , do as
     </span>
     <a id="_idIndexMarker889">
     </a>
     <span class="koboSpan" id="kobo.621.1">
      shown in
     </span>
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.622.1">
        Figure 7
       </span>
      </em>
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.623.1">
       .7
      </span>
     </em>
     <span class="koboSpan" id="kobo.624.1">
      .
     </span>
     <span class="koboSpan" id="kobo.624.2">
      For
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.625.1">
       Target types
      </span>
     </strong>
     <span class="koboSpan" id="kobo.626.1">
      , select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.627.1">
       AWS service
      </span>
     </strong>
     <span class="koboSpan" id="kobo.628.1">
      .
     </span>
     <span class="koboSpan" id="kobo.628.2">
      Under
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.629.1">
       Select a target
      </span>
     </strong>
     <span class="koboSpan" id="kobo.630.1">
      , select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.631.1">
       SNS topic
      </span>
     </strong>
     <span class="koboSpan" id="kobo.632.1">
      .
     </span>
     <span class="koboSpan" id="kobo.632.2">
      For
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.633.1">
       Topic
      </span>
     </strong>
     <span class="koboSpan" id="kobo.634.1">
      , select the topic we created for this recipe, as mentioned in the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.635.1">
       Getting
      </span>
     </em>
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.636.1">
        ready
       </span>
      </em>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.637.1">
       section.
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer211">
     <span class="koboSpan" id="kobo.638.1">
      <img alt="Figure 7.7 – Target 1 section" src="image/B21384_07_7.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.639.1">
     Figure 7.7 – Target 1 section
    </span>
   </p>
   <ol>
    <li value="10">
     <span class="koboSpan" id="kobo.640.1">
      Click
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.641.1">
       on
      </span>
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.642.1">
        Next
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.643.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.644.1">
      On the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.645.1">
       Tags
      </span>
     </strong>
     <span class="koboSpan" id="kobo.646.1">
      page, optionally add tags and click
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.647.1">
       Next
      </span>
     </strong>
     <span class="koboSpan" id="kobo.648.1">
      .
     </span>
     <span class="koboSpan" id="kobo.648.2">
      A tag is a label assigned to an AWS resource, consisting of a key and an optional value.
     </span>
     <span class="koboSpan" id="kobo.648.3">
      Tags can be used to search and filter
     </span>
     <a id="_idIndexMarker890">
     </a>
     <span class="koboSpan" id="kobo.649.1">
      resources or track
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.650.1">
       AWS costs.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.651.1">
      On the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.652.1">
       Review and create
      </span>
     </strong>
     <span class="koboSpan" id="kobo.653.1">
      page, review all details, and click
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.654.1">
       Create rule
      </span>
     </strong>
     <span class="koboSpan" id="kobo.655.1">
      at the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.656.1">
       bottom-right corner.
      </span>
     </span>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.657.1">
       We should now receive a notification email with state change details whenever an EC2 instance changes state.
      </span>
      <span class="koboSpan" id="kobo.657.2">
       To test this, go to the EC2 dashboard and either create a new instance or change the state of an
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.658.1">
        existing instance.
       </span>
      </span>
     </p>
    </li>
   </ol>
   <h2 id="_idParaDest-285">
    <a id="_idTextAnchor289">
    </a>
    <span class="koboSpan" id="kobo.659.1">
     How it works...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.660.1">
     In this recipe, we selected an event pattern and set the service name to
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.661.1">
      EC2
     </span>
    </strong>
    <span class="koboSpan" id="kobo.662.1">
     and event type to
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.663.1">
      EC2 Instance State-change Notification
     </span>
    </strong>
    <span class="koboSpan" id="kobo.664.1">
     to match EC2 events whose state gets changed.
    </span>
    <span class="koboSpan" id="kobo.664.2">
     Instead of an event pattern, we can select
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.665.1">
      Schedule
     </span>
    </strong>
    <span class="koboSpan" id="kobo.666.1">
     to invoke our targets on a schedule, just as we can with
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.667.1">
      cron jobs.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.668.1">
     We configured to notify any state change.
    </span>
    <span class="koboSpan" id="kobo.668.2">
     We can also select a specific state, such as
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.669.1">
      pending
     </span>
    </strong>
    <span class="koboSpan" id="kobo.670.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.671.1">
      running
     </span>
    </strong>
    <span class="koboSpan" id="kobo.672.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.673.1">
      shutting down
     </span>
    </strong>
    <span class="koboSpan" id="kobo.674.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.675.1">
      stopped
     </span>
    </strong>
    <span class="koboSpan" id="kobo.676.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.677.1">
      stopping
     </span>
    </strong>
    <span class="koboSpan" id="kobo.678.1">
     , or
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.679.1">
      terminated
     </span>
    </strong>
    <span class="koboSpan" id="kobo.680.1">
     .
    </span>
    <span class="koboSpan" id="kobo.680.2">
     We also configured to apply this rule to all instances within our account.
    </span>
    <span class="koboSpan" id="kobo.680.3">
     Instead of doing this, we can select a specific EC2 instance.
    </span>
    <span class="koboSpan" id="kobo.680.4">
     We selected our SNS topic as the target.
    </span>
    <span class="koboSpan" id="kobo.680.5">
     When we configure a target, CloudWatch events will provide necessary permissions for targets so that they can be invoked when rules
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.681.1">
      are triggered.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-286">
    <a id="_idTextAnchor290">
    </a>
    <span class="koboSpan" id="kobo.682.1">
     There’s more...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.683.1">
     While configuring
    </span>
    <a id="_idIndexMarker891">
    </a>
    <span class="koboSpan" id="kobo.684.1">
     the event, we selected
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.685.1">
      SNS topic
     </span>
    </strong>
    <span class="koboSpan" id="kobo.686.1">
     as our target.
    </span>
    <span class="koboSpan" id="kobo.686.2">
     The following is a current list of target types available for us to select:
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.687.1">
      Amazon Redshift
     </span>
    </strong>
    <span class="koboSpan" id="kobo.688.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.689.1">
      API Gateway
     </span>
    </strong>
    <span class="koboSpan" id="kobo.690.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.691.1">
      AppSync
     </span>
    </strong>
    <span class="koboSpan" id="kobo.692.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.693.1">
      Batch job queue
     </span>
    </strong>
    <span class="koboSpan" id="kobo.694.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.695.1">
      CloudWatch log group
     </span>
    </strong>
    <span class="koboSpan" id="kobo.696.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.697.1">
      CodeBuild project
     </span>
    </strong>
    <span class="koboSpan" id="kobo.698.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.699.1">
      CodePipeline
     </span>
    </strong>
    <span class="koboSpan" id="kobo.700.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.701.1">
      EBS Create Snapshot
     </span>
    </strong>
    <span class="koboSpan" id="kobo.702.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.703.1">
      EC2 ImageBuilder
     </span>
    </strong>
    <span class="koboSpan" id="kobo.704.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.705.1">
      EC2 RebootInstances API call
     </span>
    </strong>
    <span class="koboSpan" id="kobo.706.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.707.1">
      ECS task
     </span>
    </strong>
    <span class="koboSpan" id="kobo.708.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.709.1">
      Firehose stream
     </span>
    </strong>
    <span class="koboSpan" id="kobo.710.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.711.1">
      Glue workflow
     </span>
    </strong>
    <span class="koboSpan" id="kobo.712.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.713.1">
      Incident Manager response plan
     </span>
    </strong>
    <span class="koboSpan" id="kobo.714.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.715.1">
      Inspector assessment template
     </span>
    </strong>
    <span class="koboSpan" id="kobo.716.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.717.1">
      Kinesis stream
     </span>
    </strong>
    <span class="koboSpan" id="kobo.718.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.719.1">
      Lambda function
     </span>
    </strong>
    <span class="koboSpan" id="kobo.720.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.721.1">
      SageMaker pipeline
     </span>
    </strong>
    <span class="koboSpan" id="kobo.722.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.723.1">
      SNS topic
     </span>
    </strong>
    <span class="koboSpan" id="kobo.724.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.725.1">
      SQS queue
     </span>
    </strong>
    <span class="koboSpan" id="kobo.726.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.727.1">
      Step Functions state machine
     </span>
    </strong>
    <span class="koboSpan" id="kobo.728.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.729.1">
      System Manager Automation
     </span>
    </strong>
    <span class="koboSpan" id="kobo.730.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.731.1">
      System Manager OpsItem
     </span>
    </strong>
    <span class="koboSpan" id="kobo.732.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.733.1">
      System Manager
     </span>
    </strong>
    <span class="No-Break">
     <strong class="bold">
      <span class="koboSpan" id="kobo.734.1">
       Run Command
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.735.1">
      .
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-287">
    <a id="_idTextAnchor291">
    </a>
    <span class="koboSpan" id="kobo.736.1">
     See also
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.737.1">
     You can read more
    </span>
    <a id="_idIndexMarker892">
    </a>
    <span class="koboSpan" id="kobo.738.1">
     about CloudWatch events
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.739.1">
      at
     </span>
    </span>
    <a href="https://www.cloudericks.com/blog/getting-started-with-amazon-cloudwatch-events">
     <span class="No-Break">
      <span class="koboSpan" id="kobo.740.1">
       https://www.cloudericks.com/blog/getting-started-with-amazon-cloudwatch-events
      </span>
     </span>
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.741.1">
      .
     </span>
    </span>
   </p>
   <h1 id="_idParaDest-288">
    <a id="_idTextAnchor292">
    </a>
    <span class="koboSpan" id="kobo.742.1">
     Reading and filtering logs in CloudTrail
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.743.1">
     In this recipe, we will learn how
    </span>
    <a id="_idIndexMarker893">
    </a>
    <span class="koboSpan" id="kobo.744.1">
     to read and filter
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.745.1">
      CloudTrail log events
     </span>
    </strong>
    <span class="koboSpan" id="kobo.746.1">
     that are automatically generated and made available through the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.747.1">
      CloudTrail dashboard.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-289">
    <a id="_idTextAnchor293">
    </a>
    <span class="koboSpan" id="kobo.748.1">
     Getting ready
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.749.1">
     We need a working AWS account.
    </span>
    <span class="koboSpan" id="kobo.749.2">
     I will be using the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.750.1">
      awsseccb-sandbox-1
     </span>
    </strong>
    <span class="koboSpan" id="kobo.751.1">
     account that we created in
    </span>
    <a href="B21384_01.xhtml#_idTextAnchor020">
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.752.1">
        Chapter 1
       </span>
      </em>
     </span>
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.753.1">
      .
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-290">
    <a id="_idTextAnchor294">
    </a>
    <span class="koboSpan" id="kobo.754.1">
     How to do it...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.755.1">
     We can check automatically populated event logs in CloudTrail
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.756.1">
      as follows:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.757.1">
      Log in to the management console and go to the
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.758.1">
        CloudTrail
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.759.1">
       service.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.760.1">
      Click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.761.1">
       Event history
      </span>
     </strong>
     <span class="koboSpan" id="kobo.762.1">
      from
     </span>
     <a id="_idIndexMarker894">
     </a>
     <span class="koboSpan" id="kobo.763.1">
      the left sidebar.
     </span>
     <span class="koboSpan" id="kobo.763.2">
      This will take us to the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.764.1">
       Event
      </span>
     </strong>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.765.1">
        history
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.766.1">
       page.
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer212">
     <span class="koboSpan" id="kobo.767.1">
      <img alt="Figure 7.8 – Event history" src="image/B21384_07_8.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.768.1">
     Figure 7.8 – Event history
    </span>
   </p>
   <ol>
    <li value="3">
     <span class="koboSpan" id="kobo.769.1">
      Under
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.770.1">
       Lookup attributes
      </span>
     </strong>
     <span class="koboSpan" id="kobo.771.1">
      , select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.772.1">
       User name
      </span>
     </strong>
     <span class="koboSpan" id="kobo.773.1">
      from the dropdown.
     </span>
     <span class="koboSpan" id="kobo.773.2">
      Type our user’s name on the next field (or any name from the list, as seen in
     </span>
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.774.1">
        Figure 7
       </span>
      </em>
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.775.1">
       .8
      </span>
     </em>
     <span class="koboSpan" id="kobo.776.1">
      ) and search for all activity from that user for 10 days using the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.777.1">
       Filter by date and time
      </span>
     </strong>
     <span class="koboSpan" id="kobo.778.1">
      field.
     </span>
     <span class="koboSpan" id="kobo.778.2">
      We should now see the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.779.1">
       filtered list.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.780.1">
      Click on the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.781.1">
       Download events
      </span>
     </strong>
     <span class="koboSpan" id="kobo.782.1">
      icon at the top-right corner and then click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.783.1">
       Download as CSV
      </span>
     </strong>
     <span class="koboSpan" id="kobo.784.1">
      to download the result as a
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.785.1">
       CSV file.
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer213">
     <span class="koboSpan" id="kobo.786.1">
      <img alt="Figure 7.9 – Download events" src="image/B21384_07_9.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.787.1">
     Figure 7.9 – Download events
    </span>
   </p>
   <p class="list-inset">
    <span class="koboSpan" id="kobo.788.1">
     We can also download the result as a
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.789.1">
      JSON file.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-291">
    <a id="_idTextAnchor295">
    </a>
    <span class="koboSpan" id="kobo.790.1">
     How it works...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.791.1">
     AWS CloudTrail is a service from Amazon that can continuously monitor and log API activities within an AWS account.
    </span>
    <span class="koboSpan" id="kobo.791.2">
     Without any additional configuration, CloudTrail will log API activity events into our account and event logs are made available for 90 days through the CloudTrail console.
    </span>
    <span class="koboSpan" id="kobo.791.3">
     After going to the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.792.1">
      Events history
     </span>
    </strong>
    <span class="koboSpan" id="kobo.793.1">
     page, we can filter based on various criteria and time ranges.
    </span>
    <span class="koboSpan" id="kobo.793.2">
     We filtered based on the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.794.1">
      User name
     </span>
    </strong>
    <span class="koboSpan" id="kobo.795.1">
     parameter in this recipe.
    </span>
    <span class="koboSpan" id="kobo.795.2">
     Apart from
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.796.1">
      User name
     </span>
    </strong>
    <span class="koboSpan" id="kobo.797.1">
     , we can also filter based on the following
    </span>
    <a id="_idIndexMarker895">
    </a>
    <span class="koboSpan" id="kobo.798.1">
     parameters:
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.799.1">
      Event name
     </span>
    </strong>
    <span class="koboSpan" id="kobo.800.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.801.1">
      Resource type
     </span>
    </strong>
    <span class="koboSpan" id="kobo.802.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.803.1">
      Resource name
     </span>
    </strong>
    <span class="koboSpan" id="kobo.804.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.805.1">
      Event source
     </span>
    </strong>
    <span class="koboSpan" id="kobo.806.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.807.1">
      Event ID
     </span>
    </strong>
    <span class="koboSpan" id="kobo.808.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.809.1">
      AWS access key
     </span>
    </strong>
    <span class="koboSpan" id="kobo.810.1">
     , and
    </span>
    <span class="No-Break">
     <strong class="bold">
      <span class="koboSpan" id="kobo.811.1">
       Read only
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.812.1">
      .
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-292">
    <a id="_idTextAnchor296">
    </a>
    <span class="koboSpan" id="kobo.813.1">
     There’s more...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.814.1">
     In this recipe, we queried our logs from the console.
    </span>
    <span class="koboSpan" id="kobo.814.2">
     We can also query logs from the CLI.
    </span>
    <span class="koboSpan" id="kobo.814.3">
     The following are some important CLI commands for querying
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.815.1">
      CloudTrail logs:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.816.1">
      The
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.817.1">
       aws cloudtrail lookup-events
      </span>
     </strong>
     <span class="koboSpan" id="kobo.818.1">
      command can be used to query the last 90 days of automatically generated event logs.
     </span>
     <span class="koboSpan" id="kobo.818.2">
      A pagination token is returned if there are
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.819.1">
       more results.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.820.1">
      We can limit the number of items that are returned by the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.821.1">
       aws cloudtrail lookup-events
      </span>
     </strong>
     <span class="koboSpan" id="kobo.822.1">
      command by specifying the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.823.1">
       max-items
      </span>
     </strong>
     <span class="koboSpan" id="kobo.824.1">
      option; for example,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.825.1">
       aws cloudtrail lookup-events --
      </span>
     </strong>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.826.1">
        max-items 10
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.827.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.828.1">
      We can specify a date range using the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.829.1">
       start-time
      </span>
     </strong>
     <span class="koboSpan" id="kobo.830.1">
      and
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.831.1">
       end-time
      </span>
     </strong>
     <span class="koboSpan" id="kobo.832.1">
      parameters; for example,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.833.1">
       aws cloudtrail lookup-events --start-time 2019-01-12 --end-time 2019-10-12
      </span>
     </strong>
     <span class="koboSpan" id="kobo.834.1">
      .
     </span>
     <span class="koboSpan" id="kobo.834.2">
      We can also specify hours, minutes, and seconds with one of these parameters; for example,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.835.1">
       --
      </span>
     </strong>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.836.1">
        start-time 2019-01-12T00:30:45
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.837.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.838.1">
      We can use the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.839.1">
       lookup-attributes
      </span>
     </strong>
     <span class="koboSpan" id="kobo.840.1">
      parameter to specify the values of any parameter; for example,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.841.1">
       aws cloudtrail lookup-events --
      </span>
     </strong>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.842.1">
        lookupattributes "AttributeKey=Username,AttributeValue=i-07d6614e1dec5e537"
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.843.1">
       .
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.844.1">
     Let’s go through
    </span>
    <a id="_idIndexMarker896">
    </a>
    <span class="koboSpan" id="kobo.845.1">
     some more important concepts related to
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.846.1">
      CloudTrail logs:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.847.1">
      The CloudTrail service helps us achieve event-driven security by analyzing events and responding
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.848.1">
       to them.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.849.1">
      CloudTrail only records events that involve AWS API calls.
     </span>
     <span class="koboSpan" id="kobo.849.2">
      Therefore, if an application running on an EC2 instance throws an error, it won’t be captured.
     </span>
     <span class="koboSpan" id="kobo.849.3">
      CloudWatch can be used for logging from applications on EC2 or from
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.850.1">
       Lambda functions.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.851.1">
      By default, a trail will record events in one region.
     </span>
     <span class="koboSpan" id="kobo.851.2">
      However, we can configure a trail as a multi-region trail.
     </span>
     <span class="koboSpan" id="kobo.851.3">
      CloudTrail can integrate with other AWS services to provide additional security and compliance.
     </span>
     <span class="koboSpan" id="kobo.851.4">
      These integrations include CloudWatch for raising alarms, GuardDuty for analyzing patterns, Macie to discover, classify, and protect sensitive data, and
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.852.1">
       so on.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.853.1">
      The current CloudTrail pricing model is as follows: the first tier in each region is free (except
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.854.1">
       Simple Storage Service
      </span>
     </strong>
     <span class="koboSpan" id="kobo.855.1">
      (
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.856.1">
       S3
      </span>
     </strong>
     <span class="koboSpan" id="kobo.857.1">
      ) and
     </span>
     <a id="_idIndexMarker897">
     </a>
     <span class="koboSpan" id="kobo.858.1">
      Lambda data events).
     </span>
     <span class="koboSpan" id="kobo.858.2">
      After the free tier, CloudTrail
     </span>
     <a id="_idIndexMarker898">
     </a>
     <span class="koboSpan" id="kobo.859.1">
      charges us for management events and
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.860.1">
       data events.
      </span>
     </span>
    </li>
   </ul>
   <h2 id="_idParaDest-293">
    <a id="_idTextAnchor297">
    </a>
    <span class="koboSpan" id="kobo.861.1">
     See also
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.862.1">
     You can read more about
    </span>
    <a id="_idIndexMarker899">
    </a>
    <span class="koboSpan" id="kobo.863.1">
     CloudTrail
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.864.1">
      at
     </span>
    </span>
    <a href="https://www.cloudericks.com/blog/getting-started-with-aws-cloudtrail">
     <span class="No-Break">
      <span class="koboSpan" id="kobo.865.1">
       https://www.cloudericks.com/blog/getting-started-with-aws-cloudtrail
      </span>
     </span>
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.866.1">
      .
     </span>
    </span>
   </p>
   <h1 id="_idParaDest-294">
    <a id="_idTextAnchor298">
    </a>
    <span class="koboSpan" id="kobo.867.1">
     Creating a trail in CloudTrail
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.868.1">
     In this recipe, we
    </span>
    <a id="_idIndexMarker900">
    </a>
    <span class="koboSpan" id="kobo.869.1">
     will learn how to create a trail in
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.870.1">
      CloudTrail
     </span>
    </strong>
    <span class="koboSpan" id="kobo.871.1">
     and how to read logs from the associated
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.872.1">
      S3 bucket
     </span>
    </strong>
    <span class="koboSpan" id="kobo.873.1">
     .
    </span>
    <span class="koboSpan" id="kobo.873.2">
     By
    </span>
    <a id="_idIndexMarker901">
    </a>
    <span class="koboSpan" id="kobo.874.1">
     default,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.875.1">
      CloudTrail API event logs
     </span>
    </strong>
    <span class="koboSpan" id="kobo.876.1">
     are made
    </span>
    <a id="_idIndexMarker902">
    </a>
    <span class="koboSpan" id="kobo.877.1">
     available for 90 days.
    </span>
    <span class="koboSpan" id="kobo.877.2">
     Data events, such as S3 bucket operations and Lambda invocations, are also not logged by default.
    </span>
    <span class="koboSpan" id="kobo.877.3">
     To store our logs for more than 90 days, to enable logging data events from S3 or Lambda, and for additional flexibility in searching logs, we can create a trail to log data in an
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.878.1">
      S3 bucket.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-295">
    <a id="_idTextAnchor299">
    </a>
    <span class="koboSpan" id="kobo.879.1">
     Getting ready
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.880.1">
     To successfully complete this recipe, we need a working AWS account, and a user as described in the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.881.1">
      Technical
     </span>
    </em>
    <span class="No-Break">
     <em class="italic">
      <span class="koboSpan" id="kobo.882.1">
       requirements
      </span>
     </em>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.883.1">
      section.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-296">
    <a id="_idTextAnchor300">
    </a>
    <span class="koboSpan" id="kobo.884.1">
     How to do it...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.885.1">
     We can create a trail in CloudTrail
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.886.1">
      as follows:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.887.1">
      Log in to the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.888.1">
       CloudTrail
      </span>
     </strong>
     <span class="koboSpan" id="kobo.889.1">
      service in
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.890.1">
       the console.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.891.1">
      Click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.892.1">
       Trails
      </span>
     </strong>
     <span class="koboSpan" id="kobo.893.1">
      from the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.894.1">
       left sidebar.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.895.1">
      Click on
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.896.1">
        Create trail
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.897.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.898.1">
      Provide a
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.899.1">
       Trail name
      </span>
     </strong>
     <span class="koboSpan" id="kobo.900.1">
      value
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.901.1">
       of
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.902.1">
        aws-sec-cb-events
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.903.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.904.1">
      Leave
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.905.1">
       Enable for all accounts in my organization
      </span>
     </strong>
     <span class="koboSpan" id="kobo.906.1">
      unchecked.
     </span>
     <span class="koboSpan" id="kobo.906.2">
      To enable this, we need to log in to the management account of
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.907.1">
       our organization.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.908.1">
      Under
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.909.1">
       Storage location
      </span>
     </strong>
     <span class="koboSpan" id="kobo.910.1">
      , select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.911.1">
       Create a new
      </span>
     </strong>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.912.1">
        S3 bucket
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.913.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.914.1">
      For
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.915.1">
       Trail log bucket and folder
      </span>
     </strong>
     <span class="koboSpan" id="kobo.916.1">
      , enter a unique name for a new S3 bucket and specify a folder (prefix) to store your logs.
     </span>
     <span class="koboSpan" id="kobo.916.2">
      We may also use the auto-populated value.
     </span>
     <span class="koboSpan" id="kobo.916.3">
      Remember – bucket names must be
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.917.1">
       globally unique.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.918.1">
      For
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.919.1">
       Log file SSE-KMS encryption
      </span>
     </strong>
     <span class="koboSpan" id="kobo.920.1">
      , unselect the
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.921.1">
        Enabled
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.922.1">
       checkbox.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.923.1">
      For
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.924.1">
       Log file Validation
      </span>
     </strong>
     <span class="koboSpan" id="kobo.925.1">
      ,
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.926.1">
       select
      </span>
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.927.1">
        Enabled
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.928.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.929.1">
      Do not select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.930.1">
       Enabled
      </span>
     </strong>
     <span class="koboSpan" id="kobo.931.1">
      for
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.932.1">
       SNS
      </span>
     </strong>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.933.1">
        notification delivery
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.934.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.935.1">
      Do not select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.936.1">
       Enabled
      </span>
     </strong>
     <span class="koboSpan" id="kobo.937.1">
      for
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.938.1">
        CloudWatch Logs
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.939.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.940.1">
      Optionally, add
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.941.1">
       Tags
      </span>
     </strong>
     <span class="koboSpan" id="kobo.942.1">
      and
     </span>
     <a id="_idIndexMarker903">
     </a>
     <span class="koboSpan" id="kobo.943.1">
      click
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.944.1">
       on
      </span>
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.945.1">
        Next
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.946.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.947.1">
      For
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.948.1">
       Event type
      </span>
     </strong>
     <span class="koboSpan" id="kobo.949.1">
      , select
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.950.1">
        Management events
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.951.1">
       .
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer214">
     <span class="koboSpan" id="kobo.952.1">
      <img alt="Figure 7.10 – Choosing event type" src="image/B21384_07_10.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.953.1">
     Figure 7.10 – Choosing event type
    </span>
   </p>
   <ol>
    <li value="14">
     <span class="koboSpan" id="kobo.954.1">
      Under
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.955.1">
       Management events
      </span>
     </strong>
     <span class="koboSpan" id="kobo.956.1">
      , select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.957.1">
       Read
      </span>
     </strong>
     <span class="koboSpan" id="kobo.958.1">
      and
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.959.1">
       Write
      </span>
     </strong>
     <span class="koboSpan" id="kobo.960.1">
      for
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.961.1">
       API activity
      </span>
     </strong>
     <span class="koboSpan" id="kobo.962.1">
      and click
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.963.1">
       on
      </span>
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.964.1">
        Next
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.965.1">
       .
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer215">
     <span class="koboSpan" id="kobo.966.1">
      <img alt="Figure 7.11 – Configuring management events" src="image/B21384_07_11.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.967.1">
     Figure 7.11 – Configuring management events
    </span>
   </p>
   <ol>
    <li value="15">
     <span class="koboSpan" id="kobo.968.1">
      Click
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.969.1">
       Next
      </span>
     </strong>
     <span class="koboSpan" id="kobo.970.1">
      at the
     </span>
     <a id="_idIndexMarker904">
     </a>
     <span class="koboSpan" id="kobo.971.1">
      bottom right of
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.972.1">
       the screen.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.973.1">
      On the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.974.1">
       Review and create
      </span>
     </strong>
     <span class="koboSpan" id="kobo.975.1">
      page, review all details, and click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.976.1">
       Create trail
      </span>
     </strong>
     <span class="koboSpan" id="kobo.977.1">
      .
     </span>
     <span class="koboSpan" id="kobo.977.2">
      We should see a
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.978.1">
       Trail successfully
      </span>
     </strong>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.979.1">
        created
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.980.1">
       message.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.981.1">
      Go to the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.982.1">
       Trails
      </span>
     </strong>
     <span class="koboSpan" id="kobo.983.1">
      page and click on our trail’s S3 bucket name to go to our trail’s S3 bucket.
     </span>
     <span class="koboSpan" id="kobo.983.2">
      We can also manually go to the S3 dashboard and access this bucket.
     </span>
     <span class="koboSpan" id="kobo.983.3">
      We should see
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.984.1">
       CloudTrail
      </span>
     </strong>
     <span class="koboSpan" id="kobo.985.1">
      and
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.986.1">
       CloudTrail-Digest
      </span>
     </strong>
     <span class="koboSpan" id="kobo.987.1">
      folders.
     </span>
     <span class="koboSpan" id="kobo.987.2">
      Within the folders, we should see sub-folders
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.988.1">
       per region.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.989.1">
      Go inside the folders until we see the actual
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.990.1">
       log files.
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer216">
     <span class="koboSpan" id="kobo.991.1">
      <img alt="Figure 7.12 – CloudTrail log files" src="image/B21384_07_12.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.992.1">
     Figure 7.12 – CloudTrail log files
    </span>
   </p>
   <ol>
    <li value="19">
     <span class="koboSpan" id="kobo.993.1">
      Select a file in S3, and
     </span>
     <a id="_idIndexMarker905">
     </a>
     <span class="koboSpan" id="kobo.994.1">
      from the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.995.1">
       Actions
      </span>
     </strong>
     <span class="koboSpan" id="kobo.996.1">
      dropdown, click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.997.1">
       Query with
      </span>
     </strong>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.998.1">
        S3 Select
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.999.1">
       .
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer217">
     <span class="koboSpan" id="kobo.1000.1">
      <img alt="Figure 7.13 – Query with S3 Select" src="image/B21384_07_13.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.1001.1">
     Figure 7.13 – Query with S3 Select
    </span>
   </p>
   <ol>
    <li value="20">
     <span class="koboSpan" id="kobo.1002.1">
      Select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1003.1">
       JSON
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1004.1">
      as the
     </span>
     <a id="_idIndexMarker906">
     </a>
     <span class="koboSpan" id="kobo.1005.1">
      format,
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1006.1">
       Lines
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1007.1">
      as the JSON content type, and
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1008.1">
       GZIP
      </span>
     </strong>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1009.1">
       for compression.
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer218">
     <span class="koboSpan" id="kobo.1010.1">
      <img alt="Figure 7.14 – Input settings" src="image/B21384_07_14.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.1011.1">
     Figure 7.14 – Input settings
    </span>
   </p>
   <ol>
    <li value="21">
     <span class="koboSpan" id="kobo.1012.1">
      For
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1013.1">
       Output settings
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1014.1">
      ,
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1015.1">
       select
      </span>
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1016.1">
        JSON
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1017.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1018.1">
      Scroll down, and we
     </span>
     <a id="_idIndexMarker907">
     </a>
     <span class="koboSpan" id="kobo.1019.1">
      should now see the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1020.1">
       Structured Query Language
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1021.1">
      (
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1022.1">
       SQL
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1023.1">
      ) query
     </span>
     <a id="_idIndexMarker908">
     </a>
     <span class="koboSpan" id="kobo.1024.1">
      to run.
     </span>
     <span class="koboSpan" id="kobo.1024.2">
      Modify the SQL as required and click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1025.1">
       Run
      </span>
     </strong>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1026.1">
        SQL query
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1027.1">
       .
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer219">
     <span class="koboSpan" id="kobo.1028.1">
      <img alt="Figure 7.15 – Run SQL query" src="image/B21384_07_15.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.1029.1">
     Figure 7.15 – Run SQL query
    </span>
   </p>
   <p class="list-inset">
    <span class="koboSpan" id="kobo.1030.1">
     We should see
    </span>
    <a id="_idIndexMarker909">
    </a>
    <span class="koboSpan" id="kobo.1031.1">
     the actual result in another textbox, as shown in the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1032.1">
      following screenshot:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer220">
     <span class="koboSpan" id="kobo.1033.1">
      <img alt="Figure 7.16 – Query result response partial" src="image/B21384_07_16.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.1034.1">
     Figure 7.16 – Query result response partial
    </span>
   </p>
   <ol>
    <li value="23">
     <span class="koboSpan" id="kobo.1035.1">
      Click
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1036.1">
       Download results
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1037.1">
      to download the result.
     </span>
     <span class="koboSpan" id="kobo.1037.2">
      We can open the downloaded file using any compatible application, such as
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1038.1">
       Microsoft Word.
      </span>
     </span>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.1039.1">
     We created a trail and used it in this recipe.
    </span>
    <span class="koboSpan" id="kobo.1039.2">
     From the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1040.1">
      Trails
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1041.1">
     page, we can go to the configuration page for our trail, and then we can select
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1042.1">
      Delete
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1043.1">
     or
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1044.1">
      Stop logging
     </span>
    </strong>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1045.1">
      if needed.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-297">
    <a id="_idTextAnchor301">
    </a>
    <span class="koboSpan" id="kobo.1046.1">
     How it works...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1047.1">
     For storing logs for more than 90 days, we need to create a trail, and trails will send logs into an S3 bucket.
    </span>
    <span class="koboSpan" id="kobo.1047.2">
     In this recipe, we created a multi-region trail.
    </span>
    <span class="koboSpan" id="kobo.1047.3">
     We configured options to log all events.
    </span>
    <span class="koboSpan" id="kobo.1047.4">
     We can also select activities to log.
    </span>
    <span class="koboSpan" id="kobo.1047.5">
     We also saw the option to stop logging for a trail on the trail’s configuration page.
    </span>
    <span class="koboSpan" id="kobo.1047.6">
     Stopping logging will stop any new events from being sent to the log, but existing logs will still
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1048.1">
      be available.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1049.1">
     We configured management events in AWS CloudTrail to monitor AWS service API activities and track read and write operations, as well as changes to resources and configurations across our AWS account.
    </span>
    <span class="koboSpan" id="kobo.1049.2">
     This setup captures actions such as creating, deleting, modifying, and
    </span>
    <a id="_idIndexMarker910">
    </a>
    <span class="koboSpan" id="kobo.1050.1">
     describing AWS resources, ensuring comprehensive oversight for auditing
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1051.1">
      and compliance.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-298">
    <a id="_idTextAnchor302">
    </a>
    <span class="koboSpan" id="kobo.1052.1">
     There’s more...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1053.1">
     We did not enable data events and Insights events in this recipe.
    </span>
    <span class="koboSpan" id="kobo.1053.2">
     Data events log operations such as S3 object changes and Lambda function calls, offering detailed resource monitoring, but enabling them increases logging costs.
    </span>
    <span class="koboSpan" id="kobo.1053.3">
     CloudTrail allows logging of data events options, such as
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1054.1">
      S3
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1055.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1056.1">
      DynamoDB
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1057.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1058.1">
      Lambda
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1059.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1060.1">
      Amazon Q apps
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1061.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1062.1">
      Amazon Q Business application
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1063.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1064.1">
      Amazon Q Business data source
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1065.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1066.1">
      Amazon Q Business index
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1067.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1068.1">
      Amazon Verified Permissions
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1069.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1070.1">
      AWS AppConfig
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1071.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1072.1">
      AWS Cloud Map namespace
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1073.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1074.1">
      AWS Cloud Map service
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1075.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1076.1">
      B2B Data Interchange
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1077.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1078.1">
      Bedrock agent alias
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1079.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1080.1">
      Bedrock knowledge base
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1081.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1082.1">
      Cassandra table
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1083.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1084.1">
      CloudFront KeyValueStore
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1085.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1086.1">
      CloudTrail channel
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1087.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1088.1">
      CloudWatch metric
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1089.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1090.1">
      CodeWhisperer
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1091.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1092.1">
      CodeWhisperer customization
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1093.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1094.1">
      Cognito Identity Pools
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1095.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1096.1">
      DynamoDB Streams
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1097.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1098.1">
      EBS direct APIs
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1099.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1100.1">
      EMR write-ahead log workspace
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1101.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1102.1">
      FinSpace
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1103.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1104.1">
      Guard Duty detector
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1105.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1106.1">
      IoT certificate
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1107.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1108.1">
      IoT Greengrass component version
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1109.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1110.1">
      IoT Greengrass deployment
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1111.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1112.1">
      IoT SiteWise asset
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1113.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1114.1">
      IoT SiteWise time series
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1115.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1116.1">
      IoT thing
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1117.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1118.1">
      IoT TwinMaker entity
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1119.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1120.1">
      IoT TwinMaker workspace
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1121.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1122.1">
      Kendra Ranking
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1123.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1124.1">
      Kinesis stream
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1125.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1126.1">
      Kinesis stream consumer
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1127.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1128.1">
      Kinesis video stream
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1129.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1130.1">
      Lake Formation
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1131.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1132.1">
      Machine Learning MIModel
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1133.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1134.1">
      Managed Blockchain
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1135.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1136.1">
      Managed Blockchain network
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1137.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1138.1">
      Managed Blockchain Query
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1139.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1140.1">
      MedicalImaging data store
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1141.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1142.1">
      Neptune Graph
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1143.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1144.1">
      Private CA Connector for Active Directory
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1145.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1146.1">
      Private CA Connector for SCEP
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1147.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1148.1">
      RDS Data API - DB Cluster
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1149.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1150.1">
      S3 Access Point
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1151.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1152.1">
      S3 Object Lambda
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1153.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1154.1">
      S3 Outposts
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1155.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1156.1">
      SageMaker endpoint
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1157.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1158.1">
      SageMaker Feature Store
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1159.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1160.1">
      SageMaker metrics experiment trial component
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1161.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1162.1">
      SNS platform endpoint
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1163.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1164.1">
      SNS topic
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1165.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1166.1">
      SQS
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1167.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1168.1">
      Step Functions state machine
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1169.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1170.1">
      Supply Chain
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1171.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1172.1">
      SWF domain
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1173.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1174.1">
      Systems Manager
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1175.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1176.1">
      Systems Manager managed node
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1177.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1178.1">
      Thin Client Device
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1179.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1180.1">
      Thin Client Environment
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1181.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1182.1">
      Timestream database
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1183.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1184.1">
      Timestream table
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1185.1">
     , and
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1186.1">
      X-Ray trace
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1187.1">
     .
    </span>
    <span class="koboSpan" id="kobo.1187.2">
     These options provide additional insight into activities within our
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1188.1">
      AWS resources.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1189.1">
     Insight events logging focuses on detecting abnormal usage patterns or potential security threats related to API calls that modify or manage AWS resources.
    </span>
    <span class="koboSpan" id="kobo.1189.2">
     Insight events cannot be selected alone but should be paired with management events to ensure comprehensive logging coverage and contextual analysis of AWS API activity for security, compliance, and
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1190.1">
      operational purposes.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1191.1">
     In this recipe, we queried logs in S3 directly from the S3 console.
    </span>
    <span class="koboSpan" id="kobo.1191.2">
     For more flexibility when querying CloudTrail logs in S3, we can use Amazon Athena.
    </span>
    <span class="koboSpan" id="kobo.1191.3">
     We will learn how to use Amazon Athena
    </span>
    <a id="_idIndexMarker911">
    </a>
    <span class="koboSpan" id="kobo.1192.1">
     to query CloudTrail logs in the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.1193.1">
      Using Athena to query CloudTrail logs in S3
     </span>
    </em>
    <span class="koboSpan" id="kobo.1194.1">
     recipe of
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1195.1">
      this chapter.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-299">
    <a id="_idTextAnchor303">
    </a>
    <span class="koboSpan" id="kobo.1196.1">
     See also
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1197.1">
     Explore more about
    </span>
    <a id="_idIndexMarker912">
    </a>
    <span class="koboSpan" id="kobo.1198.1">
     CloudTrail
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1199.1">
      at
     </span>
    </span>
    <a href="https://www.cloudericks.com/blog/deep-dive-into-aws-cloudtrail">
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1200.1">
       https://www.cloudericks.com/blog/deep-dive-into-aws-cloudtrail
      </span>
     </span>
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1201.1">
      .
     </span>
    </span>
   </p>
   <h1 id="_idParaDest-300">
    <a id="_idTextAnchor304">
    </a>
    <span class="koboSpan" id="kobo.1202.1">
     Using Athena to query CloudTrail logs in S3
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.1203.1">
     In this recipe, we
    </span>
    <a id="_idIndexMarker913">
    </a>
    <span class="koboSpan" id="kobo.1204.1">
     will learn how to use
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1205.1">
      Amazon Athena
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1206.1">
     to query CloudTrail
    </span>
    <a id="_idIndexMarker914">
    </a>
    <span class="koboSpan" id="kobo.1207.1">
     logs.
    </span>
    <span class="koboSpan" id="kobo.1207.2">
     Using Athena to query CloudTrail logs provides us with greater flexibility.
    </span>
    <span class="koboSpan" id="kobo.1207.3">
     For example, we cannot filter based on an account ID from the CloudTrail console when multiple accounts are sending logs to CloudTrail’s S3 bucket.
    </span>
    <span class="koboSpan" id="kobo.1207.4">
     However, we can use Athena to query for logs from CloudTrail’s S3 bucket based on the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1208.1">
      account ID.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-301">
    <a id="_idTextAnchor305">
    </a>
    <span class="koboSpan" id="kobo.1209.1">
     Getting ready
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1210.1">
     We need the following to successfully complete
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1211.1">
      this recipe:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.1212.1">
      A working AWS account and a user as described in the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.1213.1">
       Technical
      </span>
     </em>
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.1214.1">
        requirements
       </span>
      </em>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1215.1">
       section.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1216.1">
      A trail in CloudTrail following the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.1217.1">
       Creating a trail in CloudTrail
      </span>
     </em>
     <span class="koboSpan" id="kobo.1218.1">
      recipe from
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1219.1">
       this chapter.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1220.1">
      If we are new to Athena, before we can run our queries, we should set up a query result location in Amazon S3,
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1221.1">
       as follows:
      </span>
     </span>
     <ol>
      <li class="upper-roman">
       <span class="koboSpan" id="kobo.1222.1">
        Create a bucket for
       </span>
       <a id="_idIndexMarker915">
       </a>
       <span class="koboSpan" id="kobo.1223.1">
        query
       </span>
       <a id="_idIndexMarker916">
       </a>
       <span class="koboSpan" id="kobo.1224.1">
        results.
       </span>
       <span class="koboSpan" id="kobo.1224.2">
        I’ve named my bucket
       </span>
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.1225.1">
         aws-sec-cb2-query-results
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1226.1">
        .
       </span>
       <span class="koboSpan" id="kobo.1226.2">
        Choose a unique name for
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.1227.1">
         your bucket.
        </span>
       </span>
      </li>
      <li class="upper-roman">
       <span class="koboSpan" id="kobo.1228.1">
        Go to the
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.1229.1">
         Athena
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1230.1">
        service in the
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.1231.1">
         management console.
        </span>
       </span>
      </li>
      <li class="upper-roman">
       <span class="koboSpan" id="kobo.1232.1">
        Go to
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.1233.1">
         Query editor tabs
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1234.1">
        .
       </span>
       <span class="koboSpan" id="kobo.1234.2">
        If we are new to Athena, we should see a warning stating
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.1235.1">
         Before you run your first query, you need to set up a query result location in Amazon S3
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1236.1">
        .
       </span>
       <span class="koboSpan" id="kobo.1236.2">
        Click on
       </span>
       <span class="No-Break">
        <strong class="bold">
         <span class="koboSpan" id="kobo.1237.1">
          Edit settings
         </span>
        </strong>
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.1238.1">
         .
        </span>
       </span>
      </li>
      <li class="upper-roman">
       <span class="koboSpan" id="kobo.1239.1">
        Browse S3 and choose the bucket we created for
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.1240.1">
         query results.
        </span>
       </span>
      </li>
      <li class="upper-roman">
       <span class="koboSpan" id="kobo.1241.1">
        Leave other options as-is and click
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.1242.1">
         on
        </span>
       </span>
       <span class="No-Break">
        <strong class="bold">
         <span class="koboSpan" id="kobo.1243.1">
          Save
         </span>
        </strong>
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.1244.1">
         .
        </span>
       </span>
      </li>
     </ol>
    </li>
   </ul>
   <div>
    <div class="IMG---Figure" id="_idContainer221">
     <span class="koboSpan" id="kobo.1245.1">
      <img alt="Figure 7.17 – Setting query results location" src="image/B21384_07_17.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.1246.1">
     Figure 7.17 – Setting query results location
    </span>
   </p>
   <h2 id="_idParaDest-302">
    <a id="_idTextAnchor306">
    </a>
    <span class="koboSpan" id="kobo.1247.1">
     How to do it...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1248.1">
     We can set up Athena
    </span>
    <a id="_idIndexMarker917">
    </a>
    <span class="koboSpan" id="kobo.1249.1">
     and
    </span>
    <a id="_idIndexMarker918">
    </a>
    <span class="koboSpan" id="kobo.1250.1">
     query CloudTrail logs
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1251.1">
      as follows:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.1252.1">
      Log in to the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1253.1">
       CloudTrail
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1254.1">
      service in the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1255.1">
       management console.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1256.1">
      Click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1257.1">
       Event history
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1258.1">
      from the left sidebar.
     </span>
     <span class="koboSpan" id="kobo.1258.2">
      This will take us to the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1259.1">
       Event
      </span>
     </strong>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1260.1">
        history
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1261.1">
       page.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1262.1">
      Click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1263.1">
       Create Athena table
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1264.1">
      , as we saw in
     </span>
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.1265.1">
        Figure 7
       </span>
      </em>
     </span>
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.1266.1">
        .9
       </span>
      </em>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1267.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1268.1">
      For
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1269.1">
       Storage location
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1270.1">
      , select the S3 bucket of
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1271.1">
       our trail.
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer222">
     <span class="koboSpan" id="kobo.1272.1">
      <img alt="Figure 7.18 – Creating Athena table" src="image/B21384_07_18.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.1273.1">
     Figure 7.18 – Creating Athena table
    </span>
   </p>
   <ol>
    <li value="5">
     <span class="koboSpan" id="kobo.1274.1">
      Scroll down
     </span>
     <a id="_idIndexMarker919">
     </a>
     <span class="koboSpan" id="kobo.1275.1">
      and
     </span>
     <a id="_idIndexMarker920">
     </a>
     <span class="koboSpan" id="kobo.1276.1">
      click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1277.1">
       Create table
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1278.1">
      .
     </span>
     <span class="koboSpan" id="kobo.1278.2">
      We should see a success message that the table has
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1279.1">
       been created.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1280.1">
      Now, go to
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1281.1">
       Athena
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1282.1">
      service in the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1283.1">
       management console.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1284.1">
      Go to the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1285.1">
       Query editor
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1286.1">
      tab.
     </span>
     <span class="koboSpan" id="kobo.1286.2">
      We should see our table under
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1287.1">
       Tables
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1288.1">
      , on the left, and a query editor window on the right.
     </span>
     <span class="koboSpan" id="kobo.1288.2">
      It might take some time for the table to be created and appear on the Athena dashboard after we’ve initiated its creation from the CloudTrail dashboard.
     </span>
     <span class="koboSpan" id="kobo.1288.3">
      We can manually refresh the table list using the refresh icon in the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1289.1">
       left sidebar.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1290.1">
      Click on the button with three dots next to our table and click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1291.1">
       Preview Table
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1292.1">
      .
     </span>
     <span class="koboSpan" id="kobo.1292.2">
      A sample query will be created that we can modify so that it meets
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1293.1">
       our needs.
      </span>
     </span>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.1294.1">
       I have set the limit to
      </span>
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1295.1">
        2
       </span>
      </strong>
      <span class="koboSpan" id="kobo.1296.1">
       in the query as follows:
      </span>
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1297.1">
        SELECT * FROM "default"."cloudtrail_logs_aws_cloudtrail_logs_370598287390_66c52071"
       </span>
      </strong>
      <span class="No-Break">
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.1298.1">
         limit 2;
        </span>
       </strong>
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.1299.1">
        .
       </span>
      </span>
     </p>
    </li>
    <li>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1300.1">
       Click
      </span>
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1301.1">
        Run
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1302.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1303.1">
      Click on the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1304.1">
       Download results
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1305.1">
      icon on the top right of the page to download the results in
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1306.1">
       CSV format.
      </span>
     </span>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.1307.1">
       If we go to the S3 bucket that we created for storing results, which is
      </span>
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1308.1">
        aws-sec-cb2-query-results
       </span>
      </strong>
      <span class="koboSpan" id="kobo.1309.1">
       in my case, we should see the query results saved
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.1310.1">
        there too.
       </span>
      </span>
     </p>
    </li>
   </ol>
   <h2 id="_idParaDest-303">
    <a id="_idTextAnchor307">
    </a>
    <span class="koboSpan" id="kobo.1311.1">
     How it works...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1312.1">
     In this recipe, we used Amazon Athena to query CloudTrail logs in S3.
    </span>
    <span class="koboSpan" id="kobo.1312.2">
     Athena uses queries based on SQL
    </span>
    <a id="_idIndexMarker921">
    </a>
    <span class="koboSpan" id="kobo.1313.1">
     and
    </span>
    <a id="_idIndexMarker922">
    </a>
    <span class="koboSpan" id="kobo.1314.1">
     creates virtual tables.
    </span>
    <span class="koboSpan" id="kobo.1314.2">
     If we are new to Athena, before we can run our queries, we should set up a query result location in Amazon S3.
    </span>
    <span class="koboSpan" id="kobo.1314.3">
     We created an Athena table from the CloudTrail dashboard.
    </span>
    <span class="koboSpan" id="kobo.1314.4">
     Then, we went to Athena and ran a preview query.
    </span>
    <span class="koboSpan" id="kobo.1314.5">
     We modified the query and executed it.
    </span>
    <span class="koboSpan" id="kobo.1314.6">
     Finally, we exported the results into a CSV file from the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1315.1">
      results screen.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-304">
    <a id="_idTextAnchor308">
    </a>
    <span class="koboSpan" id="kobo.1316.1">
     There’s more...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1317.1">
     Let’s quickly go through some important concepts related to
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1318.1">
      Amazon Athena:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.1319.1">
      Athena is a query service provided by AWS to analyze data in Amazon S3
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1320.1">
       using SQL.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1321.1">
      Athena can only query S3 data and not
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1322.1">
       CloudTrail directly.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1323.1">
      Amazon Athena now supports federated queries.
     </span>
     <span class="koboSpan" id="kobo.1323.2">
      We can run SQL queries across data stored in relational, non-relational, object, and custom data sources and then store the result in Amazon S3.
     </span>
     <span class="koboSpan" id="kobo.1323.3">
      At the time of writing, this feature is in preview.
     </span>
     <span class="koboSpan" id="kobo.1323.4">
      Athena is serverless.
     </span>
     <span class="koboSpan" id="kobo.1323.5">
      We do not have to set up any infrastructure and we only pay for the queries
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1324.1">
       we run.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1325.1">
      Athena, integrated with AWS Glue, allows us to crawl data sources, populate table and
     </span>
     <a id="_idIndexMarker923">
     </a>
     <span class="koboSpan" id="kobo.1326.1">
      partition
     </span>
     <a id="_idIndexMarker924">
     </a>
     <span class="koboSpan" id="kobo.1327.1">
      definitions, and even maintain
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1328.1">
       schema versioning.
      </span>
     </span>
    </li>
   </ul>
   <h3>
    <span class="koboSpan" id="kobo.1329.1">
     Cross-account CloudTrail logging
    </span>
   </h3>
   <p>
    <span class="koboSpan" id="kobo.1330.1">
     With cross-account CloudTrail logging, we can store logs in a separate account from the account in which logs are
    </span>
    <a id="_idIndexMarker925">
    </a>
    <span class="koboSpan" id="kobo.1331.1">
     generated.
    </span>
    <span class="koboSpan" id="kobo.1331.2">
     By storing logs in a separate account, we isolate the logs from the source account, which will prevent anyone with access to the source account from tampering with the logs.
    </span>
    <span class="koboSpan" id="kobo.1331.3">
     We can provide account-level access to the log account to a limited set of people.
    </span>
    <span class="koboSpan" id="kobo.1331.4">
     Sending logs from multiple accounts to a single account also provides a central place for us to
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1332.1">
      query logs.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1333.1">
     To set up cross-account CloudTrail logging, we need two AWS accounts: a log account (where logs are stored) and a logger account (which sends the logs).
    </span>
    <span class="koboSpan" id="kobo.1333.2">
     If we are using AWS Organizations, we can enable CloudTrail across accounts from the management account by selecting
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1334.1">
      Enable for all accounts in my organization
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1335.1">
     while creating a trail.
    </span>
    <span class="koboSpan" id="kobo.1335.2">
     An organization’s trail is then created in all member accounts, which means we don’t have to modify the bucket policy.
    </span>
    <span class="koboSpan" id="kobo.1335.3">
     However, enabling this option may lead to additional charges if the member accounts already have trails since only the first trail within a region
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1336.1">
      is free.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1337.1">
     In this recipe, we did not select the option to enable CloudTrail across accounts using AWS Organizations.
    </span>
    <span class="koboSpan" id="kobo.1337.2">
     To set up cross-account CloudTrail logging without using AWS Organizations, first configure a CloudTrail trail in the log account and set up an S3 bucket to store the logs.
    </span>
    <span class="koboSpan" id="kobo.1337.3">
     Modify the bucket policy to allow the CloudTrail service and specific IAM roles from both accounts to write logs to the bucket.
    </span>
    <span class="koboSpan" id="kobo.1337.4">
     Then, create a trail in the logger account, specifying the log account’s S3 bucket as the storage location.
    </span>
    <span class="koboSpan" id="kobo.1337.5">
     Verify that logs from the logger account are being correctly stored in the specified S3 bucket within the log account.
    </span>
    <span class="koboSpan" id="kobo.1337.6">
     This setup isolates the logs from the source account and centralizes log storage, enhancing security
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1338.1">
      and manageability.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-305">
    <a id="_idTextAnchor309">
    </a>
    <span class="koboSpan" id="kobo.1339.1">
     See also
    </span>
   </h2>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.1340.1">
      Read more
     </span>
     <a id="_idIndexMarker926">
     </a>
     <span class="koboSpan" id="kobo.1341.1">
      about Amazon Athena
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1342.1">
       at
      </span>
     </span>
     <a href="https://www.cloudericks.com/blog/getting-started-with-amazon-athena">
      <span class="No-Break">
       <span class="koboSpan" id="kobo.1343.1">
        https://www.cloudericks.com/blog/getting-started-with-amazon-athena
       </span>
      </span>
     </a>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1344.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1345.1">
      Read more about
     </span>
     <a id="_idIndexMarker927">
     </a>
     <span class="koboSpan" id="kobo.1346.1">
      cross-account CloudTrail logging
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1347.1">
       at
      </span>
     </span>
     <a href="https://www.cloudericks.com/blog/getting-started-with-cross-account-cloudtrail-logging">
      <span class="No-Break">
       <span class="koboSpan" id="kobo.1348.1">
        https://www.cloudericks.com/blog/getting-started-with-cross-account-cloudtrail-logging
       </span>
      </span>
     </a>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1349.1">
       .
      </span>
     </span>
    </li>
   </ul>
   <h1 id="_idParaDest-306">
    <a id="_idTextAnchor310">
    </a>
    <span class="koboSpan" id="kobo.1350.1">
     Integrating CloudWatch with CloudTrail making use of a CloudFormation template
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.1351.1">
     In this recipe, we
    </span>
    <a id="_idIndexMarker928">
    </a>
    <span class="koboSpan" id="kobo.1352.1">
     will
    </span>
    <a id="_idIndexMarker929">
    </a>
    <span class="koboSpan" id="kobo.1353.1">
     learn how to integrate CloudWatch with CloudTrail.
    </span>
    <span class="koboSpan" id="kobo.1353.2">
     Once integrated, we can
    </span>
    <a id="_idIndexMarker930">
    </a>
    <span class="koboSpan" id="kobo.1354.1">
     create
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1355.1">
      metric filters
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1356.1">
     and alarms within
    </span>
    <a id="_idIndexMarker931">
    </a>
    <span class="koboSpan" id="kobo.1357.1">
     CloudWatch based on CloudTrail logs.
    </span>
    <span class="koboSpan" id="kobo.1357.2">
     We will also learn how to use the CloudFormation template provided by AWS to create a set of alarms within CloudWatch that uses
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1358.1">
      CloudTrail logs.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-307">
    <a id="_idTextAnchor311">
    </a>
    <span class="koboSpan" id="kobo.1359.1">
     Getting ready
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1360.1">
     We need the following to successfully complete
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1361.1">
      this recipe:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.1362.1">
      A working AWS account and a user as described in the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.1363.1">
       Technical
      </span>
     </em>
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.1364.1">
        requirements
       </span>
      </em>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1365.1">
       section.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1366.1">
      A trail, by following the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.1367.1">
       Creating a trail in CloudTrail
      </span>
     </em>
     <span class="koboSpan" id="kobo.1368.1">
      recipe of
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1369.1">
       this chapter.
      </span>
     </span>
    </li>
   </ul>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.1370.1">
     Important note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.1371.1">
     You can also perform the steps in this recipe while creating a trail by making minor modifications
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1372.1">
      to them.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-308">
    <a id="_idTextAnchor312">
    </a>
    <span class="koboSpan" id="kobo.1373.1">
     How to do it...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1374.1">
     We can integrate CloudWatch with an existing trail
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1375.1">
      as follows:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.1376.1">
      Go to the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1377.1">
       CloudTrail
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1378.1">
      service in the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1379.1">
       management console.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1380.1">
      Click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1381.1">
       Trails
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1382.1">
      from the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1383.1">
       left sidebar.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1384.1">
      Click on the name of our trail to go to the trail’s
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1385.1">
       configuration page.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1386.1">
      Scroll down to the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1387.1">
       CloudWatch Logs
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1388.1">
      section and click
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1389.1">
       on
      </span>
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1390.1">
        Edit
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1391.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1392.1">
      For
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1393.1">
       CloudWatch Logs
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1394.1">
      , select the
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1395.1">
        Enabled
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1396.1">
       checkbox.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1397.1">
      For
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1398.1">
       Log group
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1399.1">
      , select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1400.1">
       New
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1401.1">
      and leave the log group name as-is, which is
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1402.1">
       aws-cloudtrail-logs-370598287390-b9277b0a
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1403.1">
      in my case.
     </span>
     <span class="koboSpan" id="kobo.1403.2">
      We can also use an existing log group using the
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1404.1">
        Existing
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1405.1">
       option.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1406.1">
      For
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1407.1">
       IAM Role
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1408.1">
      , select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1409.1">
       New
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1410.1">
      , provide a role name, and click on
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1411.1">
        Save changes
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1412.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1413.1">
      Download
     </span>
     <a id="_idIndexMarker932">
     </a>
     <span class="koboSpan" id="kobo.1414.1">
      the
     </span>
     <a id="_idIndexMarker933">
     </a>
     <span class="koboSpan" id="kobo.1415.1">
      CloudFormation
     </span>
     <a id="_idIndexMarker934">
     </a>
     <span class="koboSpan" id="kobo.1416.1">
      template from
     </span>
     <a href="https://www.cloudericks.com/blog/getting-started-with-amazon-sns-service">
      <span class="koboSpan" id="kobo.1417.1">
       https://s3-us-west-2.amazonaws.com/awscloudtrail/cloudwatch-alarms-for-cloudtrail-api-activity/CloudWatch_Alarms_for_CloudTrail_API_Activity.json
      </span>
     </a>
     <span class="koboSpan" id="kobo.1418.1">
      and save
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1419.1">
       it locally.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1420.1">
      Go to the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1421.1">
       CloudFormation
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1422.1">
      service in the management console and click on
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1423.1">
        Create stack
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1424.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1425.1">
      For
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1426.1">
       Prepare template
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1427.1">
      , select the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1428.1">
       Choose an existing
      </span>
     </strong>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1429.1">
        template
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1430.1">
       option.
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer223">
     <span class="koboSpan" id="kobo.1431.1">
      <img alt="Figure 7.19 – Prepare template" src="image/B21384_07_19.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.1432.1">
     Figure 7.19 – Prepare template
    </span>
   </p>
   <ol>
    <li value="11">
     <span class="koboSpan" id="kobo.1433.1">
      Under
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1434.1">
       Specify template
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1435.1">
      , choose the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1436.1">
       Upload a template file
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1437.1">
      option, and using the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1438.1">
       Choose file
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1439.1">
      option, upload the template we downloaded in
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.1440.1">
       Step 8
      </span>
     </em>
     <span class="koboSpan" id="kobo.1441.1">
      of
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1442.1">
       this section.
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer224">
     <span class="koboSpan" id="kobo.1443.1">
      <img alt="Figure 7.20 – Specify template" src="image/B21384_07_20.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.1444.1">
     Figure 7.20 – Specify template
    </span>
   </p>
   <ol>
    <li value="12">
     <span class="koboSpan" id="kobo.1445.1">
      Scroll
     </span>
     <a id="_idIndexMarker935">
     </a>
     <span class="koboSpan" id="kobo.1446.1">
      down
     </span>
     <a id="_idIndexMarker936">
     </a>
     <span class="koboSpan" id="kobo.1447.1">
      and
     </span>
     <a id="_idIndexMarker937">
     </a>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1448.1">
       click
      </span>
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1449.1">
        Next
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1450.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1451.1">
      On the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1452.1">
       Specify stack details
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1453.1">
      page, provide a stack name and email address so that we’ll be notified when an API activity has triggered
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1454.1">
       an alarm.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1455.1">
      Leave the cloud trail log group name as-is and click
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1456.1">
       on
      </span>
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1457.1">
        Next
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1458.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1459.1">
      On the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1460.1">
       Configure stack options
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1461.1">
      page, leave the defaults as-is and click
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1462.1">
       on
      </span>
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1463.1">
        Next
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1464.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1465.1">
      On the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1466.1">
       Review and create
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1467.1">
      page, review everything and click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1468.1">
       Submit
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1469.1">
      .
     </span>
     <span class="koboSpan" id="kobo.1469.2">
      Wait for our CloudFormation stack to
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1470.1">
       be created.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1471.1">
      After the CloudFormation stack has been successfully created, we will receive an email asking us to verify our email address.
     </span>
     <span class="koboSpan" id="kobo.1471.2">
      To start receiving email notifications when alarms are activated, click on the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1472.1">
       Confirm subscription
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1473.1">
      link provided in
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1474.1">
       the email.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1475.1">
      If we go to the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1476.1">
       Alarms
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1477.1">
      page in
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1478.1">
       CloudWatch
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1479.1">
      , we will be able to view the new alarms that were created.
     </span>
     <span class="koboSpan" id="kobo.1479.2">
      We can wait until the alarm state changes to
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1480.1">
       OK
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1481.1">
      or
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1482.1">
       ALARM
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1483.1">
      and play around with these alarms to learn more
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1484.1">
       about them.
      </span>
     </span>
    </li>
   </ol>
   <h2 id="_idParaDest-309">
    <a id="_idTextAnchor313">
    </a>
    <span class="koboSpan" id="kobo.1485.1">
     How it works...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1486.1">
     In this recipe, we integrated CloudWatch with CloudTrail through our trail’s settings.
    </span>
    <span class="koboSpan" id="kobo.1486.2">
     CloudTrail asked us for permission to deliver CloudTrail events associated with API activity in our account to our log group.
    </span>
    <span class="koboSpan" id="kobo.1486.3">
     We allowed this from the console.
    </span>
    <span class="koboSpan" id="kobo.1486.4">
     The following permissions
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1487.1">
      were granted:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1488.1">
       CreateLogStream
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1489.1">
      , to create a log stream in the log group
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1490.1">
       we specified
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1491.1">
       PutLogEvents
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1492.1">
      , to deliver CloudTrail events to the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1493.1">
       log stream
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.1494.1">
     We used the CloudFormation template provided by AWS to set up some CloudWatch alarms for security and network-related API activity.
    </span>
    <span class="koboSpan" id="kobo.1494.2">
     If we delete the CloudFormation stack, all the alarms will also
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1495.1">
      be deleted.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1496.1">
     AWS uses SNS to
    </span>
    <a id="_idIndexMarker938">
    </a>
    <span class="koboSpan" id="kobo.1497.1">
     send
    </span>
    <a id="_idIndexMarker939">
    </a>
    <span class="koboSpan" id="kobo.1498.1">
     notifications
    </span>
    <a id="_idIndexMarker940">
    </a>
    <span class="koboSpan" id="kobo.1499.1">
     and created an SNS topic subscription for us.
    </span>
    <span class="koboSpan" id="kobo.1499.2">
     We had to confirm the email subscription by verifying our email address since SNS will not send notifications until we manually confirm
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1500.1">
      the subscription.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-310">
    <a id="_idTextAnchor314">
    </a>
    <span class="koboSpan" id="kobo.1501.1">
     There’s more...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1502.1">
     In this recipe, we integrated CloudWatch with CloudTrail and used the CloudFormation template provided by Amazon to create some alarms that are related to security and network-related API activity.
    </span>
    <span class="koboSpan" id="kobo.1502.2">
     You can add these alarms to a dashboard following the reference in the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.1503.1">
      See also
     </span>
    </em>
    <span class="koboSpan" id="kobo.1504.1">
     section of the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.1505.1">
      Working with CloudWatch alarms and metrics
     </span>
    </em>
    <span class="koboSpan" id="kobo.1506.1">
     recipe from
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1507.1">
      this chapter.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-311">
    <a id="_idTextAnchor315">
    </a>
    <span class="koboSpan" id="kobo.1508.1">
     See also
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1509.1">
     Read more about CloudFormation
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1510.1">
      at
     </span>
    </span>
    <a href="https://www.cloudericks.com/blog/aws-cloudformation-for-absolute-beginners">
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1511.1">
       https://www.cloudericks.com/blog/aws-cloudformation-for-absolute-beginners
      </span>
     </span>
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1512.1">
      .
     </span>
    </span>
   </p>
   <h1 id="_idParaDest-312">
    <a id="_idTextAnchor316">
    </a>
    <span class="koboSpan" id="kobo.1513.1">
     Setting up and using AWS Config
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.1514.1">
     In this recipe, we
    </span>
    <a id="_idIndexMarker941">
    </a>
    <span class="koboSpan" id="kobo.1515.1">
     will learn
    </span>
    <a id="_idIndexMarker942">
    </a>
    <span class="koboSpan" id="kobo.1516.1">
     how to set up and use AWS Config.
    </span>
    <span class="koboSpan" id="kobo.1516.2">
     We can use Config to record and evaluate configurations of our AWS resources.
    </span>
    <span class="koboSpan" id="kobo.1516.3">
     We can create rules that define security standards and find out about resources that do not comply with security standards.
    </span>
    <span class="koboSpan" id="kobo.1516.4">
     Config also supports the auto-remediation of problems whenever they
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1517.1">
      are detected.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-313">
    <a id="_idTextAnchor317">
    </a>
    <span class="koboSpan" id="kobo.1518.1">
     Getting ready
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1519.1">
     We need the following to successfully complete
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1520.1">
      this recipe:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.1521.1">
      A working AWS account and a user as described in the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.1522.1">
       Technical
      </span>
     </em>
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.1523.1">
        requirements
       </span>
      </em>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1524.1">
       section.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1525.1">
      If you want to add an SNS topic for notifications, you can create an SNS topic with an email subscription by following the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.1526.1">
       Creating an SNS topic to send emails
      </span>
     </em>
     <span class="koboSpan" id="kobo.1527.1">
      recipe of
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1528.1">
       this chapter.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1529.1">
      For testing, we need at least
     </span>
     <a id="_idIndexMarker943">
     </a>
     <span class="koboSpan" id="kobo.1530.1">
      one IAM user without
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1531.1">
       multi-factor authentication
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1532.1">
      (
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1533.1">
        MFA
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1534.1">
       ) enabled.
      </span>
     </span>
    </li>
   </ul>
   <h2 id="_idParaDest-314">
    <a id="_idTextAnchor318">
    </a>
    <span class="koboSpan" id="kobo.1535.1">
     How to do it...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1536.1">
     First, we will set up AWS Config for the first time, and then we will see how to use AWS Config.
    </span>
    <span class="koboSpan" id="kobo.1536.2">
     Let us
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1537.1">
      get started:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.1538.1">
      When we log in to the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1539.1">
       AWS Config
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1540.1">
      service in the management console for the first time, we will see a
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1541.1">
       Getting started
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1542.1">
      page.
     </span>
     <span class="koboSpan" id="kobo.1542.2">
      Click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1543.1">
       Get started
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1544.1">
      , and we will be taken to the
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1545.1">
        Settings
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1546.1">
       page.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1547.1">
      In the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1548.1">
       Recording method
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1549.1">
      section, for
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1550.1">
       Recording strategy
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1551.1">
      , select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1552.1">
       All resource types with
      </span>
     </strong>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1553.1">
        customizable overrides
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1554.1">
       .
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer225">
     <span class="koboSpan" id="kobo.1555.1">
      <img alt="Figure 7.21 – AWS Config recording method" src="image/B21384_07_21.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.1556.1">
     Figure 7.21 – AWS Config recording method
    </span>
   </p>
   <ol>
    <li value="3">
     <span class="koboSpan" id="kobo.1557.1">
      For
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1558.1">
       Recording frequency
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1559.1">
      , select
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1560.1">
        Continuous recording
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1561.1">
       .
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer226">
     <span class="koboSpan" id="kobo.1562.1">
      <img alt="Figure 7.22 – Recording frequency" src="image/B21384_07_22.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.1563.1">
     Figure 7.22 – Recording frequency
    </span>
   </p>
   <ol>
    <li value="4">
     <span class="koboSpan" id="kobo.1564.1">
      Under the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1565.1">
       Override settings
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1566.1">
      section, click
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1567.1">
       on
      </span>
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1568.1">
        Remove
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1569.1">
       .
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer227">
     <span class="koboSpan" id="kobo.1570.1">
      <img alt="Figure 7.23 – Override settings" src="image/B21384_07_23.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.1571.1">
     Figure 7.23 – Override settings
    </span>
   </p>
   <ol>
    <li value="5">
     <span class="koboSpan" id="kobo.1572.1">
      In the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1573.1">
       Data governance
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1574.1">
      section, select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1575.1">
       Create AWS Config service-linked role
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1576.1">
      .
     </span>
     <span class="koboSpan" id="kobo.1576.2">
      Alternatively, we
     </span>
     <a id="_idIndexMarker944">
     </a>
     <span class="koboSpan" id="kobo.1577.1">
      may
     </span>
     <a id="_idIndexMarker945">
     </a>
     <span class="koboSpan" id="kobo.1578.1">
      choose a role from
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1579.1">
       our account.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1580.1">
      In the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1581.1">
       Delivery method
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1582.1">
      section, select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1583.1">
       Create a bucket
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1584.1">
      and give an S3
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1585.1">
       bucket name.
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer228">
     <span class="koboSpan" id="kobo.1586.1">
      <img alt="Figure 7.24 – Delivery method section" src="image/B21384_07_24.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.1587.1">
     Figure 7.24 – Delivery method section
    </span>
   </p>
   <ol>
    <li value="7">
     <span class="koboSpan" id="kobo.1588.1">
      In the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1589.1">
       Amazon SNS topic
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1590.1">
      section, select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1591.1">
       Stream configuration changes and notifications to an Amazon SNS topic
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1592.1">
      , then select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1593.1">
       Choose a topic from your account
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1594.1">
      , and
     </span>
     <a id="_idIndexMarker946">
     </a>
     <span class="koboSpan" id="kobo.1595.1">
      finally
     </span>
     <a id="_idIndexMarker947">
     </a>
     <span class="koboSpan" id="kobo.1596.1">
      select the topic we created as mentioned in the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.1597.1">
       Getting ready
      </span>
     </em>
     <span class="koboSpan" id="kobo.1598.1">
      section.
     </span>
     <span class="koboSpan" id="kobo.1598.2">
      Alternatively, we may create a topic or choose a topic from
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1599.1">
       another account.
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer229">
     <span class="koboSpan" id="kobo.1600.1">
      <img alt="Figure 7.25 – Choosing an Amazon SNS topic" src="image/B21384_07_25.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.1601.1">
     Figure 7.25 – Choosing an Amazon SNS topic
    </span>
   </p>
   <ol>
    <li value="8">
     <span class="koboSpan" id="kobo.1602.1">
      At the bottom of
     </span>
     <a id="_idIndexMarker948">
     </a>
     <span class="koboSpan" id="kobo.1603.1">
      the
     </span>
     <a id="_idIndexMarker949">
     </a>
     <span class="koboSpan" id="kobo.1604.1">
      page,
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1605.1">
       click
      </span>
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1606.1">
        Next
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1607.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1608.1">
      On the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1609.1">
       AWS Managed Rules
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1610.1">
      page, search for and select the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1611.1">
       iam-user-mfa-enabled
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1612.1">
      rule.
     </span>
     <span class="koboSpan" id="kobo.1612.2">
      Click
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1613.1">
       Next
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1614.1">
      .
     </span>
     <span class="koboSpan" id="kobo.1614.2">
      We can add more rules if we want.
     </span>
     <span class="koboSpan" id="kobo.1614.3">
      We can also add rules after completing the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1615.1">
       setup process.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1616.1">
      On the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1617.1">
       Review
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1618.1">
      page, review the changes and click
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1619.1">
       Confirm
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1620.1">
      at the bottom-right corner.
     </span>
     <span class="koboSpan" id="kobo.1620.2">
      We will be redirected to the AWS Config dashboard.
     </span>
     <span class="koboSpan" id="kobo.1620.3">
      In the dashboard, we can see
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1621.1">
       Conformance Packs by Compliance Score
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1622.1">
      ,
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1623.1">
       Compliance status
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1624.1">
      ,
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1625.1">
       Noncompliant rules by noncompliant resource count
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1626.1">
      ,
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1627.1">
       Resource inventory
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1628.1">
      ,
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1629.1">
       AWS Config usage metrics
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1630.1">
      , and
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1631.1">
       AWS Config
      </span>
     </strong>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1632.1">
        success metrics
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1633.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1634.1">
      If we have an IAM user without MFA enabled, as discussed in the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.1635.1">
       Getting ready
      </span>
     </em>
     <span class="koboSpan" id="kobo.1636.1">
      section, we should see that user as not compliant with our
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1637.1">
        iam-user-mfa-enabled
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1638.1">
       rule.
      </span>
     </span>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.1639.1">
       Please note that it will take some time for the non-compliant resources to be shown in the dashboard.
      </span>
      <span class="koboSpan" id="kobo.1639.2">
       We can also do the following actions for the rule:
      </span>
      <strong class="bold">
       <span class="koboSpan" id="kobo.1640.1">
        Manage remediation
       </span>
      </strong>
      <span class="koboSpan" id="kobo.1641.1">
       ,
      </span>
      <strong class="bold">
       <span class="koboSpan" id="kobo.1642.1">
        Re-evaluate
       </span>
      </strong>
      <span class="koboSpan" id="kobo.1643.1">
       ,
      </span>
      <strong class="bold">
       <span class="koboSpan" id="kobo.1644.1">
        Delete results
       </span>
      </strong>
      <span class="koboSpan" id="kobo.1645.1">
       , and
      </span>
      <span class="No-Break">
       <strong class="bold">
        <span class="koboSpan" id="kobo.1646.1">
         Delete rule
        </span>
       </strong>
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.1647.1">
        .
       </span>
      </span>
     </p>
    </li>
   </ol>
   <h2 id="_idParaDest-315">
    <a id="_idTextAnchor319">
    </a>
    <span class="koboSpan" id="kobo.1648.1">
     How it works...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1649.1">
     In this recipe, we set up AWS Config on our account.
    </span>
    <span class="koboSpan" id="kobo.1649.2">
     We selected
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1650.1">
      Record all resources supported in this region
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1651.1">
     and
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1652.1">
      Include global resources
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1653.1">
     (for example, AWS IAM resources) against
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1654.1">
      All resources
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1655.1">
     in order to record all resources across all regions.
    </span>
    <span class="koboSpan" id="kobo.1655.2">
     We can also configure recording for specific resources by unchecking
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1656.1">
      Record all resources supported in this region
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1657.1">
     and selecting the resources we want in the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1658.1">
      Specific
     </span>
    </strong>
    <span class="No-Break">
     <strong class="bold">
      <span class="koboSpan" id="kobo.1659.1">
       types
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1660.1">
      field.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1661.1">
     We enabled SNS notifications to receive email notifications by selecting an SNS topic with an email subscription from our account.
    </span>
    <span class="koboSpan" id="kobo.1661.2">
     We can also choose an SNS topic from another account by selecting the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1662.1">
      Choose a topic from another account
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1663.1">
     option.
    </span>
    <span class="koboSpan" id="kobo.1663.2">
     In the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1664.1">
      AWS Config role
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1665.1">
     section, we selected the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1666.1">
      Create AWS Config service-linked
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1667.1">
     role.
    </span>
    <span class="koboSpan" id="kobo.1667.2">
     This role grants read-only access for Config to our AWS resources so that we can record configuration information.
    </span>
    <span class="koboSpan" id="kobo.1667.3">
     The role also grants permission to send information to S3
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1668.1">
      and SNS.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1669.1">
     Here, we selected the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1670.1">
      iam-user-mfa-enabled
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1671.1">
     rule, which is a periodic rule.
    </span>
    <span class="koboSpan" id="kobo.1671.2">
     Periodic rules are run periodically, whereas non-periodic rules (configuration changes-based rules) are run
    </span>
    <a id="_idIndexMarker950">
    </a>
    <span class="koboSpan" id="kobo.1672.1">
     immediately
    </span>
    <a id="_idIndexMarker951">
    </a>
    <span class="koboSpan" id="kobo.1673.1">
     when a change is made to an
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1674.1">
      associated configuration.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-316">
    <a id="_idTextAnchor320">
    </a>
    <span class="koboSpan" id="kobo.1675.1">
     There’s more...
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1676.1">
     Let’s go through some important concepts related to
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1677.1">
      AWS Config:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.1678.1">
      Some of the checks that we can do with AWS Config include the following: check if MFA is enabled, check if S3 buckets are not public, databases are encrypted, VPC flow logs are enabled, and
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1679.1">
       so on.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1680.1">
      We can write our own custom rules using
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1681.1">
       AWS Lambda.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1682.1">
      AWS Config can perform auto-remediation actions for a rule.
     </span>
     <span class="koboSpan" id="kobo.1682.2">
      For example, we can change the configuration of an EC2 instance based on a rule.
     </span>
     <span class="koboSpan" id="kobo.1682.3">
      However, AWS may stop and restart the EC2 instance, so we need to consider
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1683.1">
       possible downtime.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1684.1">
      To configure auto-remediation from the new console, we can go to our rule, click on the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1685.1">
       Actions
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1686.1">
      dropdown, and select
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1687.1">
        Manage remediation
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1688.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1689.1">
      We can use the same set of Config rules across multiple accounts to ensure they all follow a common set
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1690.1">
       of rules.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1691.1">
      We can create an aggregator in AWS Config to view the AWS resource inventory or Config rule compliance status for multiple accounts across all regions.
     </span>
     <span class="koboSpan" id="kobo.1691.2">
      In the current console, we can create an aggregator by going to the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1692.1">
       Aggregate
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1693.1">
      view from the left sidebar and then clicking on
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1694.1">
        Add aggregator
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1695.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1696.1">
      AWS Config is charged based on the number of rules evaluations that
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1697.1">
       are recorded.
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.1698.1">
     The steps for creating a
    </span>
    <a id="_idIndexMarker952">
    </a>
    <span class="koboSpan" id="kobo.1699.1">
     custom
    </span>
    <a id="_idIndexMarker953">
    </a>
    <span class="koboSpan" id="kobo.1700.1">
     rule can be summarized
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1701.1">
      as follows:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.1702.1">
      Create an IAM role that can be used by a Lambda with the required permissions.
     </span>
     <span class="koboSpan" id="kobo.1702.2">
      To report back to AWS Config, we need to provide
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1703.1">
       AWSConfigRulesExecutionRole
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1704.1">
      .
     </span>
     <span class="koboSpan" id="kobo.1704.2">
      To send logs to CloudWatch, we will need to add
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1705.1">
       AWSLambdaBasicExecutionRole
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1706.1">
      .
     </span>
     <span class="koboSpan" id="kobo.1706.2">
      Finally, we need to give access to the service it will monitor (for example,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1707.1">
       AmazonS3ReadOnlyAccess
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1708.1">
      for
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1709.1">
       accessing S3).
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1710.1">
      Create a Lambda by selecting the IAM role we created in the previous step using any of the supported
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1711.1">
       programming languages.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1712.1">
      Write some code within Lambda in order to evaluate the service parameters that we are monitoring (for example, S3 bucket properties), update a
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1713.1">
       ResultToken
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1714.1">
      object per evaluation, and return a list of
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1715.1">
       ResultToken
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1716.1">
      objects back to Config.
     </span>
     <span class="koboSpan" id="kobo.1716.2">
      The
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1717.1">
       ResultToken
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1718.1">
      objects should consist of the following information:
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1719.1">
       ComplianceResourceType
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1720.1">
      (for example,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1721.1">
       AWS::S3::Bucket
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1722.1">
      ),
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1723.1">
       ComplianceResourceId
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1724.1">
      (for example, bucket name),
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1725.1">
       ComplianceType
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1726.1">
      (
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1727.1">
       COMPLIANT
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1728.1">
      or
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1729.1">
       NON_COMPLIANT
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1730.1">
      ),
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1731.1">
       and
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1732.1">
        OrderingTimestamp
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1733.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1734.1">
      Within the Config dashboard, we can go to
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1735.1">
       Rules
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1736.1">
      , then to
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1737.1">
       Add rule
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1738.1">
      , and select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1739.1">
       Add Custom rule
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1740.1">
      .
     </span>
     <span class="koboSpan" id="kobo.1740.2">
      The exact screen names of these options may be different when you
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1741.1">
       do this.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1742.1">
      Set the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1743.1">
       Trigger type
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1744.1">
      field to
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1745.1">
       Configuration changes
      </span>
     </strong>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1746.1">
       or
      </span>
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1747.1">
        Periodic
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1748.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1749.1">
      Next, we can choose a remediation action or notification for
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1750.1">
       our rule.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1751.1">
      Click
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1752.1">
       Save
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1753.1">
      .
     </span>
     <span class="koboSpan" id="kobo.1753.2">
      Our rule should
     </span>
     <a id="_idIndexMarker954">
     </a>
     <span class="koboSpan" id="kobo.1754.1">
      be
     </span>
     <a id="_idIndexMarker955">
     </a>
     <span class="koboSpan" id="kobo.1755.1">
      listed along with the other rules on the
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1756.1">
        Rules
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1757.1">
       page.
      </span>
     </span>
    </li>
   </ol>
   <h2 id="_idParaDest-317">
    <a id="_idTextAnchor321">
    </a>
    <span class="koboSpan" id="kobo.1758.1">
     See also
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1759.1">
     Read more about
    </span>
    <a id="_idIndexMarker956">
    </a>
    <span class="koboSpan" id="kobo.1760.1">
     AWS Config
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1761.1">
      at
     </span>
    </span>
    <a href="https://www.cloudericks.com/blog/getting-started-with-aws-config.vp">
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1762.1">
       https://www.cloudericks.com/blog/getting-started-with-aws-config.vp
      </span>
     </span>
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1763.1">
      .
     </span>
    </span>
   </p>
  </div>
 </body></html>