<html><head></head><body>
<div id="_idContainer048">
<h1 class="chapter-number" id="_idParaDest-23"><a id="_idTextAnchor022"/><span class="koboSpan" id="kobo.1.1">2</span></h1>
<h1 id="_idParaDest-24"><a id="_idTextAnchor023"/><span class="koboSpan" id="kobo.2.1">Preparing Our First Vulnerable Cloud Lab Environment</span></h1>
<p><span class="koboSpan" id="kobo.3.1">In </span><span class="No-Break"><em class="italic"><a href="B19755_01.xhtml"><span class="koboSpan" id="kobo.4.1">Chapter 1</span></a></em></span><span class="koboSpan" id="kobo.5.1">, </span><em class="italic"><span class="koboSpan" id="kobo.6.1">Getting Started with Penetration Testing Labs in the Cloud</span></em><span class="koboSpan" id="kobo.7.1">, we discussed several key topics that are essential to building intentionally vulnerable lab environments in the cloud. </span><span class="koboSpan" id="kobo.7.2">At this point, you are probably eager to get your feet wet and very excited to start working on some hands-on exercises. </span><span class="koboSpan" id="kobo.7.3">The good news is that we won’t have to wait much longer since we will be working on our first penetration testing cloud lab environment in </span><span class="No-Break"><span class="koboSpan" id="kobo.8.1">this chapter.</span></span></p>
<p><span class="koboSpan" id="kobo.9.1">We will start the hands-on section of this chapter by creating an empty Amazon </span><strong class="bold"><span class="koboSpan" id="kobo.10.1">Simple Storage Service</span></strong><span class="koboSpan" id="kobo.11.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.12.1">S3</span></strong><span class="koboSpan" id="kobo.13.1">) bucket and configuring it for static website hosting. </span><span class="koboSpan" id="kobo.13.2">We will then make the bucket misconfigured by modifying its access control settings accordingly. </span><span class="koboSpan" id="kobo.13.3">We will complete the setup by uploading a few sample files into our S3 bucket and make the setup a bit more realistic. </span><span class="koboSpan" id="kobo.13.4">Of course, setting up the vulnerable cloud lab environment is just the first part! </span><span class="koboSpan" id="kobo.13.5">The second part involves testing the security configuration of our lab environment by simulating the attack process from an attacker’s point of view. </span><span class="koboSpan" id="kobo.13.6">Once we are done with the tests, we will proceed with the cleanup step by deleting the bucket, along with the files stored </span><span class="No-Break"><span class="koboSpan" id="kobo.14.1">inside it.</span></span></p>
<p><span class="koboSpan" id="kobo.15.1">That said, we will cover the </span><span class="No-Break"><span class="koboSpan" id="kobo.16.1">following topics:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.17.1">Designing our first cloud penetration testing </span><span class="No-Break"><span class="koboSpan" id="kobo.18.1">lab environment</span></span></li>
<li><span class="koboSpan" id="kobo.19.1">Preparing our first </span><span class="No-Break"><span class="koboSpan" id="kobo.20.1">vulnerable environment</span></span></li>
<li><span class="koboSpan" id="kobo.21.1">Testing and hacking our first </span><span class="No-Break"><span class="koboSpan" id="kobo.22.1">vulnerable environment</span></span></li>
<li><span class="No-Break"><span class="koboSpan" id="kobo.23.1">Cleaning up</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.24.1">While working on the hands-on solutions of this chapter, we will cover relevant security concepts and mechanisms that can be used to manage access control in S3 buckets. </span><span class="koboSpan" id="kobo.24.2">Having a good understanding of how these security mechanisms work will help you prepare different variations of misconfigured S3 buckets that can be part of more complex penetration testing </span><span class="No-Break"><span class="koboSpan" id="kobo.25.1">lab environments.</span></span></p>
<p><span class="koboSpan" id="kobo.26.1">With this in mind, let’s </span><span class="No-Break"><span class="koboSpan" id="kobo.27.1">get started!</span></span></p>
<h1 id="_idParaDest-25"><a id="_idTextAnchor024"/><span class="koboSpan" id="kobo.28.1">Technical requirements</span></h1>
<p><span class="koboSpan" id="kobo.29.1">Before we start, we must have the </span><span class="No-Break"><span class="koboSpan" id="kobo.30.1">following ready:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.31.1">An AWS account, which will serve as the </span><em class="italic"><span class="koboSpan" id="kobo.32.1">target account</span></em><span class="koboSpan" id="kobo.33.1"> that contains the vulnerable environment </span><span class="No-Break"><span class="koboSpan" id="kobo.34.1">and resources</span></span></li>
<li><span class="koboSpan" id="kobo.35.1">A second AWS account, which will serve as the </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.36.1">attacker’s account</span></em></span></li>
</ul>
<p><span class="koboSpan" id="kobo.37.1">Feel free to create these AWS accounts by going to </span><a href="https://aws.amazon.com/free/"><span class="koboSpan" id="kobo.38.1">https://aws.amazon.com/free/</span></a><span class="koboSpan" id="kobo.39.1">. </span><span class="koboSpan" id="kobo.39.2">You may proceed with the next steps once these accounts </span><span class="No-Break"><span class="koboSpan" id="kobo.40.1">are ready.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.41.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.42.1">This chapter primarily focuses on building a sample vulnerable lab environment on AWS. </span><span class="koboSpan" id="kobo.42.2">Of course, we need to have our </span><strong class="bold"><span class="koboSpan" id="kobo.43.1">Microsoft Azure</span></strong><span class="koboSpan" id="kobo.44.1"> and </span><strong class="bold"><span class="koboSpan" id="kobo.45.1">Google Cloud Platform</span></strong><span class="koboSpan" id="kobo.46.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.47.1">GCP</span></strong><span class="koboSpan" id="kobo.48.1">) accounts ready once we reach the hands-on portion of the succeeding chapters of this book. </span><span class="koboSpan" id="kobo.48.2">In the meantime, setting up two AWS accounts should do the trick </span><span class="No-Break"><span class="koboSpan" id="kobo.49.1">for now.</span></span></p>
<h1 id="_idParaDest-26"><a id="_idTextAnchor025"/><span class="koboSpan" id="kobo.50.1">Designing our first cloud penetration testing lab environment</span></h1>
<p><span class="koboSpan" id="kobo.51.1">In </span><span class="No-Break"><em class="italic"><a href="B19755_01.xhtml"><span class="koboSpan" id="kobo.52.1">Chapter 1</span></a></em></span><span class="koboSpan" id="kobo.53.1">, </span><em class="italic"><span class="koboSpan" id="kobo.54.1">Getting Started with Penetration Testing Labs in the Cloud</span></em><span class="koboSpan" id="kobo.55.1">, we discussed how modern</span><a id="_idIndexMarker078"/><span class="koboSpan" id="kobo.56.1"> cloud applications are designed, developed, and deployed. </span><span class="koboSpan" id="kobo.56.2">We took a closer look at how distributed multi-tier architectures and horizontal scaling strategies make it possible to independently scale specific tiers to handle increased </span><span class="No-Break"><span class="koboSpan" id="kobo.57.1">user traffic:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer014">
<span class="koboSpan" id="kobo.58.1"><img alt="" src="image/B19755_02_01.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.59.1">Figure 2.1 – Generic multi-tiered architecture diagram from Chapter 1</span></p>
<p><span class="koboSpan" id="kobo.60.1">Here, we have designed</span><a id="_idIndexMarker079"/><span class="koboSpan" id="kobo.61.1"> the system to have separate tiers for the web servers, application servers, and databases. </span><span class="koboSpan" id="kobo.61.2">Given that this is one of the common cloud architecture implementations, you might be wondering, </span><em class="italic"><span class="koboSpan" id="kobo.62.1">how</span></em><em class="italic"><span class="koboSpan" id="kobo.63.1"> would this look like when implemented on a cloud platform such as AWS?</span></em><span class="koboSpan" id="kobo.64.1"> The answer to this question is simple! </span><span class="koboSpan" id="kobo.64.2">It would look more or less the same when implemented on AWS! </span><span class="koboSpan" id="kobo.64.3">For one thing, the resources in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.65.1">Figure 2</span></em></span><em class="italic"><span class="koboSpan" id="kobo.66.1">.1</span></em><span class="koboSpan" id="kobo.67.1"> would simply have their own corresponding set of resources and services on AWS (similar to what is shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.68.1">Figure 2</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.69.1">.2</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.70.1">):</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer015">
<span class="koboSpan" id="kobo.71.1"><img alt="" src="image/B19755_02_02.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.72.1">Figure 2.2 – How a distributed multi-tiered architecture can be implemented on AWS</span></p>
<p><span class="koboSpan" id="kobo.73.1">In </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.74.1">Figure 2</span></em></span><em class="italic"><span class="koboSpan" id="kobo.75.1">.2</span></em><span class="koboSpan" id="kobo.76.1">, we can see</span><a id="_idIndexMarker080"/><span class="koboSpan" id="kobo.77.1"> that the generic load balancer</span><a id="_idIndexMarker081"/><span class="koboSpan" id="kobo.78.1"> resource from </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.79.1">Figure 2</span></em></span><em class="italic"><span class="koboSpan" id="kobo.80.1">.1</span></em><span class="koboSpan" id="kobo.81.1"> would be replaced with an </span><strong class="bold"><span class="koboSpan" id="kobo.82.1">Amazon Elastic Load Balancing</span></strong><span class="koboSpan" id="kobo.83.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.84.1">ELB</span></strong><span class="koboSpan" id="kobo.85.1">) cloud resource. </span><span class="koboSpan" id="kobo.85.2">Similarly, the web</span><a id="_idIndexMarker082"/><span class="koboSpan" id="kobo.86.1"> servers would be replaced with several </span><strong class="bold"><span class="koboSpan" id="kobo.87.1">Amazon Elastic Compute Cloud</span></strong><span class="koboSpan" id="kobo.88.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.89.1">EC2</span></strong><span class="koboSpan" id="kobo.90.1">) instances. </span><span class="koboSpan" id="kobo.90.2">The generic database server</span><a id="_idIndexMarker083"/><span class="koboSpan" id="kobo.91.1"> resource would then be replaced with a managed </span><strong class="bold"><span class="koboSpan" id="kobo.92.1">Amazon Relational Database Service</span></strong><span class="koboSpan" id="kobo.93.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.94.1">RDS</span></strong><span class="koboSpan" id="kobo.95.1">) </span><span class="No-Break"><span class="koboSpan" id="kobo.96.1">database resource.</span></span></p>
<p><span class="koboSpan" id="kobo.97.1">At this point, you might be wondering why we have an extra resource box (that is, a box that represents an Amazon S3 bucket) in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.98.1">Figure 2</span></em></span><em class="italic"><span class="koboSpan" id="kobo.99.1">.2</span></em><span class="koboSpan" id="kobo.100.1">! </span><span class="koboSpan" id="kobo.100.2">Well, even if Amazon EC2 instances have storage volumes attached to them, cloud engineers generally decouple the application</span><a id="_idIndexMarker084"/><span class="koboSpan" id="kobo.101.1"> architecture further by storing files and objects inside </span><strong class="bold"><span class="koboSpan" id="kobo.102.1">Amazon S3</span></strong><span class="koboSpan" id="kobo.103.1"> buckets and database records inside </span><strong class="bold"><span class="koboSpan" id="kobo.104.1">Amazon RDS</span></strong><span class="koboSpan" id="kobo.105.1"> database instances. </span><span class="koboSpan" id="kobo.105.2">This allows the application implementation</span><a id="_idIndexMarker085"/><span class="koboSpan" id="kobo.106.1"> deployed inside the fleet of EC2 instances (virtual machines) to be stateless (making auto-scaling easier to implement) since the </span><em class="italic"><span class="koboSpan" id="kobo.107.1">state</span></em><span class="koboSpan" id="kobo.108.1"> is stored inside the S3 buckets and the RDS </span><span class="No-Break"><span class="koboSpan" id="kobo.109.1">database instances.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.110.1">What’s Amazon S3?</span></p>
<p class="callout"><strong class="bold"><span class="koboSpan" id="kobo.111.1">Amazon S3</span></strong><span class="koboSpan" id="kobo.112.1"> is an object storage service</span><a id="_idIndexMarker086"/><span class="koboSpan" id="kobo.113.1"> built to store and retrieve a variety of files. </span><span class="koboSpan" id="kobo.113.2">We can think of Amazon S3 as an online service where we can create </span><em class="italic"><span class="koboSpan" id="kobo.114.1">file storage containers</span></em><span class="koboSpan" id="kobo.115.1"> (also known as S3 buckets) that can store any number</span><a id="_idIndexMarker087"/><span class="koboSpan" id="kobo.116.1"> of files uploaded through the web interface, a CLI utility, an SDK, or the API. </span><span class="koboSpan" id="kobo.116.2">Of course, we can also download files from these buckets using a similar set </span><span class="No-Break"><span class="koboSpan" id="kobo.117.1">of options.</span></span></p>
<p><span class="koboSpan" id="kobo.118.1">Amazon S3 plays an important</span><a id="_idIndexMarker088"/><span class="koboSpan" id="kobo.119.1"> role in modern applications deployed on AWS. </span><span class="koboSpan" id="kobo.119.2">Many cloud applications and systems running on AWS make use of S3 buckets to store files of various file types and formats. </span><span class="koboSpan" id="kobo.119.3">This includes data engineering and machine learning systems, similar to what we have in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.120.1">Figure 2</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.121.1">.3</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.122.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer016">
<span class="koboSpan" id="kobo.123.1"><img alt="" src="image/B19755_02_03.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.124.1">Figure 2.3 – Where machine learning and data engineering systems store data</span></p>
<p><span class="koboSpan" id="kobo.125.1">Here, we have a machine learning engineering system</span><a id="_idIndexMarker089"/><span class="koboSpan" id="kobo.126.1"> that utilizes managed machine learning and data engineering services such as </span><strong class="bold"><span class="koboSpan" id="kobo.127.1">Amazon SageMaker</span></strong><span class="koboSpan" id="kobo.128.1"> (a managed machine learning service) and </span><strong class="bold"><span class="koboSpan" id="kobo.129.1">Amazon Athena</span></strong><span class="koboSpan" id="kobo.130.1"> (a serverless, interactive analytics service) to process</span><a id="_idIndexMarker090"/><span class="koboSpan" id="kobo.131.1"> data stored inside Amazon S3 buckets. </span><em class="italic"><span class="koboSpan" id="kobo.132.1">Where does the cloud data reside before and after the data processing operations?</span></em><span class="koboSpan" id="kobo.133.1"> In most cases, the data would be stored inside Amazon S3 buckets, especially when dealing with data engineering and machine learning engineering workloads. </span><span class="koboSpan" id="kobo.133.2">As we can see, Amazon S3 is one of the most used services on AWS. </span><span class="koboSpan" id="kobo.133.3">An application deployed on AWS would most likely store files inside an S3 bucket (or in multiple S3 buckets). </span><span class="koboSpan" id="kobo.133.4">Its versatility and scalability make it a go-to choice for storing various types of files and data in the cloud. </span><span class="koboSpan" id="kobo.133.5">When deploying an application on AWS, it is a common practice to leverage S3 buckets for efficient and secure file storage, whether it involves hosting static website assets, storing user-uploaded content, or even serving as a data lake for </span><span class="No-Break"><span class="koboSpan" id="kobo.134.1">large-scale analytics.</span></span></p>
<p><span class="koboSpan" id="kobo.135.1">In some cases, files stored in Amazon S3 may contain </span><strong class="bold"><span class="koboSpan" id="kobo.136.1">personally identifiable information</span></strong><span class="koboSpan" id="kobo.137.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.138.1">PII</span></strong><span class="koboSpan" id="kobo.139.1">), along with other sensitive information</span><a id="_idIndexMarker091"/><span class="koboSpan" id="kobo.140.1"> that must be protected at all costs. </span><span class="koboSpan" id="kobo.140.2">This could involve details such as names, addresses, social security numbers, or financial information, which can pose a significant risk if accessed by unauthorized individuals. </span><span class="koboSpan" id="kobo.140.3">Safeguarding</span><a id="_idIndexMarker092"/><span class="koboSpan" id="kobo.141.1"> this information is essential to maintain privacy and comply with data protection regulations. </span><span class="koboSpan" id="kobo.141.2">It is important to note that S3 buckets can be attacked by malicious actors directly without them having to go through the load balancer and web application tiers in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.142.1">Figure 2</span></em></span><em class="italic"><span class="koboSpan" id="kobo.143.1">.2</span></em><span class="koboSpan" id="kobo.144.1">. </span><span class="koboSpan" id="kobo.144.2">This means that if the S3 bucket is misconfigured (for example, the sensitive files stored in the bucket are publicly accessible), the S3 files and data can be stolen by attackers no matter how secure the load balancer and web application </span><span class="No-Break"><span class="koboSpan" id="kobo.145.1">tiers are.</span></span></p>
<p><span class="koboSpan" id="kobo.146.1">In the past couple of years, misconfigured S3 buckets have led to a significant number of data breaches that leaked millions of records containing PII, sensitive corporate information, and even credentials. </span><span class="koboSpan" id="kobo.146.2">Here are some of the highlights from the </span><span class="No-Break"><span class="koboSpan" id="kobo.147.1">previous years:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.148.1">In 2017, a significant number of S3 buckets were found to be misconfigured, resulting in the exposure of sensitive information, including PII, credit reports, and even government and </span><span class="No-Break"><span class="koboSpan" id="kobo.149.1">military data.</span></span></li>
<li><span class="koboSpan" id="kobo.150.1">In 2018, an IT firm exposed data from several Fortune 100 companies, leading to the exposure of various types of sensitive information and </span><span class="No-Break"><span class="koboSpan" id="kobo.151.1">proprietary data.</span></span></li>
<li><span class="koboSpan" id="kobo.152.1">In 2019, a vendor for half the Fortune 100 companies inadvertently exposed a terabyte of backups, while a healthcare provider’s misconfigured S3 bucket exposed medical records and </span><span class="No-Break"><span class="koboSpan" id="kobo.153.1">patient-doctor records.</span></span></li>
<li><span class="koboSpan" id="kobo.154.1">In 2020, a consumer ratings and reviews website had a misconfigured S3 bucket that exposed senior citizens’ data, and a global technology company experienced an incident where unauthorized individuals broke into its unsecured AWS </span><span class="No-Break"><span class="koboSpan" id="kobo.155.1">S3 silo.</span></span></li>
<li><span class="koboSpan" id="kobo.156.1">In 2022, a misconfigured S3 bucket leaked around 3 TB (terabytes!) of sensitive airport data, which exposed the PII of the </span><span class="No-Break"><span class="koboSpan" id="kobo.157.1">airline employees.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.158.1">These incidents, along with other reported</span><a id="_idIndexMarker093"/><span class="koboSpan" id="kobo.159.1"> leaks during the past few years, highlighted the widespread nature of S3 bucket misconfigurations and the potential risks associated </span><span class="No-Break"><span class="koboSpan" id="kobo.160.1">with them.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.161.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.162.1">For more information about this topic, feel free to check out the following </span><span class="No-Break"><span class="koboSpan" id="kobo.163.1">link: </span></span><a href="https://github.com/nagwww/s3-leaks"><span class="No-Break"><span class="koboSpan" id="kobo.164.1">https://github.com/nagwww/s3-leaks</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.165.1">.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.166.1">Why are attacks on S3 buckets so prevalent?</span></p>
<p class="callout"><span class="koboSpan" id="kobo.167.1">Cloud engineers and developers</span><a id="_idIndexMarker094"/><span class="koboSpan" id="kobo.168.1"> generally have a poor understanding of how the different access control mechanisms work together when securing S3 buckets. </span><span class="koboSpan" id="kobo.168.2">In addition to this, the complexity of managing access control policies and permissions within S3 buckets adds another layer of challenge. </span><span class="koboSpan" id="kobo.168.3">The multitude of options and settings available can overwhelm inexperienced users, increasing the likelihood of misconfigurations and accidental exposure of sensitive information. </span><span class="koboSpan" id="kobo.168.4">This can lead to misconfigured S3 buckets leaking and exposing private and sensitive information to </span><span class="No-Break"><span class="koboSpan" id="kobo.169.1">unauthorized users.</span></span></p>
<p><span class="koboSpan" id="kobo.170.1">That said, having a solid</span><a id="_idIndexMarker095"/><span class="koboSpan" id="kobo.171.1"> understanding of what security measures are available would help us secure files inside S3 buckets better. </span><span class="koboSpan" id="kobo.171.2">At the same time, this would allow us to design and build realistic penetration testing labs involving S3. </span><span class="koboSpan" id="kobo.171.3">If you are wondering what security mechanisms are available to secure the files stored inside these S3 buckets, here’s a </span><span class="No-Break"><span class="koboSpan" id="kobo.172.1">quick list:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.173.1">Identity and Access Management (IAM) policies</span></strong><span class="koboSpan" id="kobo.174.1">: By configuring IAM policies, organizations </span><a id="_idIndexMarker096"/><span class="koboSpan" id="kobo.175.1">can define granular permissions and access controls for users, groups, and roles within their AWS accounts. </span><span class="koboSpan" id="kobo.175.2">This allows for fine-grained control over who can perform actions on S3 buckets, such as read, write, or </span><span class="No-Break"><span class="koboSpan" id="kobo.176.1">delete operations.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.177.1">Bucket policies</span></strong><span class="koboSpan" id="kobo.178.1">: Bucket policies provide an additional layer</span><a id="_idIndexMarker097"/><span class="koboSpan" id="kobo.179.1"> of access control at the bucket level. </span><span class="koboSpan" id="kobo.179.2">With bucket policies, organizations can define rules and conditions that govern access to specific S3 buckets. </span><span class="koboSpan" id="kobo.179.3">This includes allowing or denying access based on various factors such as IP addresses, user agents, or specific </span><span class="No-Break"><span class="koboSpan" id="kobo.180.1">AWS accounts.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.181.1">Access Control Lists (ACLs)</span></strong><span class="koboSpan" id="kobo.182.1">: ACLs offer another mechanism for managing</span><a id="_idIndexMarker098"/><span class="koboSpan" id="kobo.183.1"> access to S3 buckets and objects. </span><span class="koboSpan" id="kobo.183.2">ACLs allow organizations to specify permissions for individual objects within a bucket, providing more fine-grained control over file-level access. </span><span class="koboSpan" id="kobo.183.3">By setting appropriate ACLs, organizations can grant read or write access</span><a id="_idIndexMarker099"/><span class="koboSpan" id="kobo.184.1"> to specific users or groups while restricting access </span><span class="No-Break"><span class="koboSpan" id="kobo.185.1">to others.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.186.1">Virtual Private Cloud (VPC) endpoint policies</span></strong><span class="koboSpan" id="kobo.187.1">: VPC endpoint policies allow organizations</span><a id="_idIndexMarker100"/><span class="koboSpan" id="kobo.188.1"> to control access to S3 buckets from within their VPC environments. </span><span class="koboSpan" id="kobo.188.2">By defining endpoint policies, organizations can specify which VPCs or subnets can access specific S3 buckets. </span><span class="koboSpan" id="kobo.188.3">This helps prevent unauthorized access from outside the VPC and enhances the security of files stored in S3 buckets by limiting access to trusted </span><span class="No-Break"><span class="koboSpan" id="kobo.189.1">network environments.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.190.1">AWS Organizations Service Control Policies (SCPs)</span></strong><span class="koboSpan" id="kobo.191.1">: SCPs are part of AWS Organizations</span><a id="_idIndexMarker101"/><span class="koboSpan" id="kobo.192.1"> and enable organizations to set fine-grained permissions across multiple AWS accounts. </span><span class="koboSpan" id="kobo.192.2">By defining SCPs, organizations can enforce centralized security policies that apply to all member accounts. </span><span class="koboSpan" id="kobo.192.3">This includes controlling access to S3 buckets and ensuring that consistent security measures are applied across the organization. </span><span class="koboSpan" id="kobo.192.4">By leveraging SCPs, organizations can strengthen the overall security posture of their S3 buckets, ensuring</span><a id="_idIndexMarker102"/><span class="koboSpan" id="kobo.193.1"> that files are protected uniformly across </span><span class="No-Break"><span class="koboSpan" id="kobo.194.1">an enterprise.</span></span></li>
</ul>
<p class="callout-heading"><span class="koboSpan" id="kobo.195.1">Important note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.196.1">While new S3 buckets created after April 2023 have ACLs disabled by default during the bucket creation process, it is still possible to enable them through a configuration change while the S3 bucket is being configured and created. </span><span class="koboSpan" id="kobo.196.2">At the same time, S3 buckets with ACLs disabled can be modified and have ACLs enabled and restored after bucket creation. </span><span class="koboSpan" id="kobo.196.3">Despite this enforcement of secure defaults, a significant number of S3 buckets created before April 2023 continue to rely on ACLs, along with the other discussed S3 security mechanisms. </span><span class="koboSpan" id="kobo.196.4">Therefore, having a thorough comprehension of these security mechanisms is crucial for both setting up cloud-based penetration testing lab environments and ensuring the correct configuration of S3 </span><span class="No-Break"><span class="koboSpan" id="kobo.197.1">security settings.</span></span></p>
<p><span class="koboSpan" id="kobo.198.1">Even with the security mechanisms and guardrails available alongside the security upgrades released by the cloud platform, misconfigurations are still present in a significant number of existing S3 buckets. </span><span class="koboSpan" id="kobo.198.2">In addition to this, no matter how secure the other components of the cloud architecture are, a misconfigured S3 bucket would still result in a data leak since the files stored in the S3 buckets can be accessed directly in a significant number </span><span class="No-Break"><span class="koboSpan" id="kobo.199.1">of cases.</span></span></p>
<p><span class="koboSpan" id="kobo.200.1">In this chapter, we will focus on preparing</span><a id="_idIndexMarker103"/><span class="koboSpan" id="kobo.201.1"> a misconfigured S3 bucket in our AWS account. </span><span class="koboSpan" id="kobo.201.2">Before building our first cloud penetration testing lab environment (that is, a single misconfigured S3 bucket), we must have a good idea of what the most common S3 bucket </span><span class="No-Break"><span class="koboSpan" id="kobo.202.1">misconfigurations are:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.203.1">Guest/anonymous users can perform operations on the objects stored in the bucket</span></strong><span class="koboSpan" id="kobo.204.1">: This misconfiguration</span><a id="_idIndexMarker104"/><span class="koboSpan" id="kobo.205.1"> enables attackers or unauthorized individuals to access and manipulate the files and folders stored in the bucket. </span><span class="koboSpan" id="kobo.205.2">Unauthorized users can list the contents of the bucket, retrieve objects from it, and even upload their own files, potentially leading to unauthorized data exposure, modification, </span><span class="No-Break"><span class="koboSpan" id="kobo.206.1">or deletion.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.207.1">“Authenticated users” (anyone with an AWS account) can list files and read and write objects to the S3 bucket</span></strong><span class="koboSpan" id="kobo.208.1">: This misconfiguration allows </span><em class="italic"><span class="koboSpan" id="kobo.209.1">any user with an AWS account</span></em><span class="koboSpan" id="kobo.210.1"> to have the ability to list, read, and write objects stored in the bucket. </span><span class="koboSpan" id="kobo.210.2">This means that any individual or user with AWS credentials can access and modify the </span><span class="No-Break"><span class="koboSpan" id="kobo.211.1">bucket’s contents.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.212.1">The ACL configuration of the S3 bucket can be read by an external user</span></strong><span class="koboSpan" id="kobo.213.1">: This misconfiguration helps attackers gain additional information about the security configuration of </span><span class="No-Break"><span class="koboSpan" id="kobo.214.1">the bucket.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.215.1">The S3 bucket access logging setup is disabled in CloudTrail</span></strong><span class="koboSpan" id="kobo.216.1">: This misconfiguration prevents</span><a id="_idIndexMarker105"/><span class="koboSpan" id="kobo.217.1"> AWS users from auditing the event history for the S3 bucket(s) (including the actions performed by an entity or resource on our </span><span class="No-Break"><span class="koboSpan" id="kobo.218.1">S3 buckets).</span></span></li>
</ul>
<p class="callout-heading"><span class="koboSpan" id="kobo.219.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.220.1">If this is your first time encountering </span><strong class="bold"><span class="koboSpan" id="kobo.221.1">CloudTrail</span></strong><span class="koboSpan" id="kobo.222.1">, it is simply an AWS service that helps monitor</span><a id="_idIndexMarker106"/><span class="koboSpan" id="kobo.223.1"> and record AWS account activity. </span><span class="koboSpan" id="kobo.223.2">This service plays an important role in helping enable governance, compliance, operational auditing, and risk auditing in AWS accounts. </span><span class="koboSpan" id="kobo.223.3">Disabling access logging for an S3 bucket in CloudTrail means that no logs will be generated to track and record the bucket’s access activity. </span><span class="koboSpan" id="kobo.223.4">This can limit the ability to detect unauthorized access attempts, troubleshoot problems, and maintain a complete record of bucket activity for compliance and </span><span class="No-Break"><span class="koboSpan" id="kobo.224.1">security purposes.</span></span></p>
<p><span class="koboSpan" id="kobo.225.1">With a clearer understanding</span><a id="_idIndexMarker107"/><span class="koboSpan" id="kobo.226.1"> of the typical misconfigurations that can occur in S3 buckets, we can now move forward and design and build our first cloud penetration testing lab environment. </span><span class="koboSpan" id="kobo.226.2">Specifically, our focus will be on designing a lab environment that involves a single S3 bucket that’s been intentionally misconfigured to simulate real-world vulnerabilities. </span><span class="koboSpan" id="kobo.226.3">Our misconfigured S3 bucket will store a few sample files, similar to what is shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.227.1">Figure 2</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.228.1">.4</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.229.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer017">
<span class="koboSpan" id="kobo.230.1"><img alt="" src="image/B19755_02_04.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.231.1">Figure 2.4 – How our S3 bucket will be configured</span></p>
<p><span class="koboSpan" id="kobo.232.1">As shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.233.1">Figure 2</span></em></span><em class="italic"><span class="koboSpan" id="kobo.234.1">.4</span></em><span class="koboSpan" id="kobo.235.1">, we will configure</span><a id="_idIndexMarker108"/><span class="koboSpan" id="kobo.236.1"> the S3 bucket to have the following properties and </span><span class="No-Break"><span class="koboSpan" id="kobo.237.1">configuration settings:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.238.1">Static website hosting</span></strong><span class="koboSpan" id="kobo.239.1"> – </span><strong class="bold"><span class="koboSpan" id="kobo.240.1">ENABLED</span></strong><span class="koboSpan" id="kobo.241.1">: This configuration enables static website hosting</span><a id="_idIndexMarker109"/><span class="koboSpan" id="kobo.242.1"> for the specified S3 bucket, allowing it to serve static web pages and assets directly from </span><span class="No-Break"><span class="koboSpan" id="kobo.243.1">the bucket.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.244.1">Block public access</span></strong><span class="koboSpan" id="kobo.245.1"> – </span><strong class="bold"><span class="koboSpan" id="kobo.246.1">DISABLED</span></strong><span class="koboSpan" id="kobo.247.1">: This configuration (when enabled) helps prevent</span><a id="_idIndexMarker110"/><span class="koboSpan" id="kobo.248.1"> accidental exposure of sensitive data by enforcing restrictions on public access. </span><span class="koboSpan" id="kobo.248.2">However, when this configuration setting is disabled, anonymous users and unauthorized entities may be able to access the bucket and the objects stored inside it (especially with a misconfigured </span><span class="No-Break"><span class="koboSpan" id="kobo.249.1">S3 bucket).</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.250.1">Bucket policy</span></strong><span class="koboSpan" id="kobo.251.1"> – </span><strong class="bold"><span class="koboSpan" id="kobo.252.1">AUTHENTICATED USERS CAN RETRIEVE OBJECTS</span></strong><span class="koboSpan" id="kobo.253.1">: This configuration</span><a id="_idIndexMarker111"/><span class="koboSpan" id="kobo.254.1"> allows authenticated users (that is, </span><em class="italic"><span class="koboSpan" id="kobo.255.1">anyone</span></em><span class="koboSpan" id="kobo.256.1"> with an AWS account) to retrieve objects from the S3 bucket, granting them access to the </span><span class="No-Break"><span class="koboSpan" id="kobo.257.1">stored data.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.258.1">Access control list (ACL)</span></strong><span class="koboSpan" id="kobo.259.1"> – </span><strong class="bold"><span class="koboSpan" id="kobo.260.1">AUTHENTICATED USERS CAN LIST OBJECTS</span></strong><span class="koboSpan" id="kobo.261.1">: This allows authenticated</span><a id="_idIndexMarker112"/><span class="koboSpan" id="kobo.262.1"> users to list the objects within the </span><span class="No-Break"><span class="koboSpan" id="kobo.263.1">S3 bucket.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.264.1">In addition to these, we will be uploading</span><a id="_idIndexMarker113"/><span class="koboSpan" id="kobo.265.1"> a few sample files we might see in a typical S3 bucket. </span><span class="koboSpan" id="kobo.265.2">Now that we’ve discussed how our vulnerable lab environment will be (mis)configured, we can proceed with the hands-on portion of </span><span class="No-Break"><span class="koboSpan" id="kobo.266.1">this chapter!</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.267.1">Important note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.268.1">It is important to note that while we’re focusing on Amazon S3 in this chapter, similar issues and incidents have affected companies using Azure Blob Storage and Google Cloud Storage. </span><span class="koboSpan" id="kobo.268.2">These services, similar to Amazon S3, have encountered comparable security challenges </span><span class="No-Break"><span class="koboSpan" id="kobo.269.1">and vulnerabilities.</span></span></p>
<h1 id="_idParaDest-27"><a id="_idTextAnchor026"/><span class="koboSpan" id="kobo.270.1">Preparing our first vulnerable environment</span></h1>
<p><span class="koboSpan" id="kobo.271.1">As discussed in the previous section, our first</span><a id="_idIndexMarker114"/><span class="koboSpan" id="kobo.272.1"> vulnerable environment will be composed of a single misconfigured Amazon S3 bucket containing a few sample files. </span><span class="koboSpan" id="kobo.272.2">There are a variety of ways to create an empty S3 bucket. </span><span class="koboSpan" id="kobo.272.3">In this chapter, we’ll use the AWS Management Console to create </span><span class="No-Break"><span class="koboSpan" id="kobo.273.1">our bucket.</span></span></p>
<p><span class="koboSpan" id="kobo.274.1">This section is composed of </span><span class="No-Break"><span class="koboSpan" id="kobo.275.1">four subparts:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.276.1">Creating an empty </span><span class="No-Break"><span class="koboSpan" id="kobo.277.1">S3 bucket</span></span></li>
<li><span class="koboSpan" id="kobo.278.1">Configuring the S3 bucket to host a </span><span class="No-Break"><span class="koboSpan" id="kobo.279.1">static website</span></span></li>
<li><span class="koboSpan" id="kobo.280.1">Updating the S3 bucket </span><span class="No-Break"><span class="koboSpan" id="kobo.281.1">configuration settings</span></span></li>
<li><span class="koboSpan" id="kobo.282.1">Uploading files to the </span><span class="No-Break"><span class="koboSpan" id="kobo.283.1">S3 bucket</span></span></li>
</ul>
<p class="callout-heading"><span class="koboSpan" id="kobo.284.1">Important note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.285.1">Since we’ll be preparing an intentionally vulnerable S3 bucket, make sure you </span><em class="italic"><span class="koboSpan" id="kobo.286.1">don’t</span></em><span class="koboSpan" id="kobo.287.1"> use this S3 bucket to store production data (or files that contain </span><span class="No-Break"><span class="koboSpan" id="kobo.288.1">sensitive information).</span></span></p>
<h2 id="_idParaDest-28"><a id="_idTextAnchor027"/><span class="koboSpan" id="kobo.289.1">Creating an empty S3 bucket</span></h2>
<p><span class="koboSpan" id="kobo.290.1">We will start by creating an empty S3 bucket. </span><span class="koboSpan" id="kobo.290.2">Make sure</span><a id="_idIndexMarker115"/><span class="koboSpan" id="kobo.291.1"> that you are logged in using the “target account” (the first </span><span class="No-Break"><span class="koboSpan" id="kobo.292.1">AWS account).</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.293.1">Important note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.294.1">You may also opt to choose </span><strong class="bold"><span class="koboSpan" id="kobo.295.1">N. </span><span class="koboSpan" id="kobo.295.2">Virginia</span></strong><span class="koboSpan" id="kobo.296.1"> as the region where the S3 bucket will be created. </span><span class="koboSpan" id="kobo.296.2">Feel free to update the current region using the dropdown located in the top-left corner of the page </span><span class="No-Break"><span class="koboSpan" id="kobo.297.1">before proceeding.</span></span></p>
<p><span class="koboSpan" id="kobo.298.1">With this in mind, let’s proceed with creating the empty S3 bucket from the AWS </span><span class="No-Break"><span class="koboSpan" id="kobo.299.1">Management Console:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.300.1">Type </span><strong class="source-inline"><span class="koboSpan" id="kobo.301.1">s3</span></strong><span class="koboSpan" id="kobo.302.1"> in the </span><span class="No-Break"><span class="koboSpan" id="kobo.303.1">search bar:</span></span>
<div>
<div class="IMG---Figure" id="_idContainer018">
<span class="koboSpan" id="kobo.304.1"><img alt="" src="image/B19755_02_05.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.305.1">Figure 2.5 – Navigating to the S3 console</span></p><span class="koboSpan" id="kobo.306.1">
				Select </span><strong class="bold"><span class="koboSpan" id="kobo.307.1">S3</span></strong><span class="koboSpan" id="kobo.308.1"> from the list of results (as highlighted in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.309.1">Figure 2</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.310.1">.5</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.311.1">).</span></span></li>
</ol>
<ol>
<li value="2"><span class="koboSpan" id="kobo.312.1">Next, click the </span><strong class="bold"><span class="koboSpan" id="kobo.313.1">Create bucket</span></strong><span class="koboSpan" id="kobo.314.1"> button, as highlighted in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.315.1">Figure 2</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.316.1">.6</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.317.1">:</span></span>
<div>
<div class="IMG---Figure" id="_idContainer019">
<span class="koboSpan" id="kobo.318.1"><img alt="" src="image/B19755_02_06.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.319.1">Figure 2.6 – Locating the Create bucket button</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.320.1">You should see the </span><strong class="bold"><span class="koboSpan" id="kobo.321.1">Create bucket</span></strong><span class="koboSpan" id="kobo.322.1"> button near the top right-hand corner of </span><span class="No-Break"><span class="koboSpan" id="kobo.323.1">the page.</span></span></p></li>
</ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.324.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.325.1">It is important to note that the user interface may change once every few years. </span><span class="koboSpan" id="kobo.325.2">However, this shouldn’t prevent us from proceeding with creating the required resources as the attributes and properties to be configured pretty much stay the same (except for a few new properties </span><span class="No-Break"><span class="koboSpan" id="kobo.326.1">and options).</span></span></p>
<ol>
<li value="3"><span class="koboSpan" id="kobo.327.1">Under </span><strong class="bold"><span class="koboSpan" id="kobo.328.1">Bucket name</span></strong><span class="koboSpan" id="kobo.329.1">, specify a bucket name that is globally</span><a id="_idIndexMarker116"/><span class="koboSpan" id="kobo.330.1"> unique across all </span><span class="No-Break"><span class="koboSpan" id="kobo.331.1">AWS users:</span></span>
<div>
<div class="IMG---Figure" id="_idContainer020">
<span class="koboSpan" id="kobo.332.1"><img alt="" src="image/B19755_02_07.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.333.1">Figure 2.7 – Creating an S3 bucket</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.334.1">If you are having a hard time naming your S3 bucket, you may name your S3 bucket </span><strong class="source-inline"><span class="koboSpan" id="kobo.335.1">sample-web-bucket-&lt;6-8 random alphanumeric characters&gt;</span></strong><span class="koboSpan" id="kobo.336.1">. </span><span class="koboSpan" id="kobo.336.2">It may take you a few tries</span><a id="_idIndexMarker117"/><span class="koboSpan" id="kobo.337.1"> to come up with a valid and globally unique S3 </span><span class="No-Break"><span class="koboSpan" id="kobo.338.1">bucket name.</span></span></p></li>
</ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.339.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.340.1">For guidelines</span><a id="_idIndexMarker118"/><span class="koboSpan" id="kobo.341.1"> on how to name S3 buckets, feel free to check the following </span><span class="No-Break"><span class="koboSpan" id="kobo.342.1">link: </span></span><a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/bucketnamingrules.html"><span class="No-Break"><span class="koboSpan" id="kobo.343.1">https://docs.aws.amazon.com/AmazonS3/latest/userguide/bucketnamingrules.html</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.344.1">.</span></span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.345.1">In addition to this, choose </span><strong class="bold"><span class="koboSpan" id="kobo.346.1">US East (N. </span><span class="koboSpan" id="kobo.346.2">Virginia) us-east-1</span></strong><span class="koboSpan" id="kobo.347.1"> from the list of options in the </span><strong class="bold"><span class="koboSpan" id="kobo.348.1">AWS Region</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.349.1">select box.</span></span></p>
<ol>
<li value="4"><span class="koboSpan" id="kobo.350.1">Select the </span><strong class="bold"><span class="koboSpan" id="kobo.351.1">ACLs enabled</span></strong><span class="koboSpan" id="kobo.352.1"> option, similar to what is shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.353.1">Figure 2</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.354.1">.8</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.355.1">:</span></span>
<div>
<div class="IMG---Figure" id="_idContainer021">
<span class="koboSpan" id="kobo.356.1"><img alt="" src="image/B19755_02_08.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.357.1">Figure 2.8 – Configuring the Object Ownership settings</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.358.1">Setting the </span><strong class="bold"><span class="koboSpan" id="kobo.359.1">Object Ownership</span></strong><span class="koboSpan" id="kobo.360.1"> configuration value to </span><strong class="bold"><span class="koboSpan" id="kobo.361.1">Object writer</span></strong><span class="koboSpan" id="kobo.362.1"> will make the objects owned by the AWS account that uploads them. </span><span class="koboSpan" id="kobo.362.2">This means that the AWS account that owns the object can use ACLs</span><a id="_idIndexMarker119"/><span class="koboSpan" id="kobo.363.1"> to grant access to other users (even if that AWS account that uploaded the objects is not the owner of </span><span class="No-Break"><span class="koboSpan" id="kobo.364.1">the bucket).</span></span></p></li>
</ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.365.1">Important note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.366.1">Note that AWS regularly updates and improves the user experience when using the AWS Management Console. </span><span class="koboSpan" id="kobo.366.2">In some cases, the default configuration settings are changed when creating resources after a certain date. </span><span class="koboSpan" id="kobo.366.3">For example, AWS has a new set of default settings for S3 Block Public Access and S3 Object Ownership when creating new S3 buckets after April 2023. </span><span class="koboSpan" id="kobo.366.4">That said, you might have to click a few additional buttons and see a few differences when using the AWS Management Console by the time you read this book. </span><span class="koboSpan" id="kobo.366.5">Feel free to check</span><a id="_idIndexMarker120"/><span class="koboSpan" id="kobo.367.1"> the following link for more information about this </span><span class="No-Break"><span class="koboSpan" id="kobo.368.1">topic: </span></span><a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/create-bucket-faq.html"><span class="No-Break"><span class="koboSpan" id="kobo.369.1">https://docs.aws.amazon.com/AmazonS3/latest/userguide/create-bucket-faq.html</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.370.1">.</span></span></p>
<ol>
<li value="5"><span class="koboSpan" id="kobo.371.1">Uncheck the </span><strong class="bold"><span class="koboSpan" id="kobo.372.1">Block all public access</span></strong><span class="koboSpan" id="kobo.373.1"> checkbox, similar to what is shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.374.1">Figure 2</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.375.1">.9</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.376.1">:</span></span>
<div>
<div class="IMG---Figure" id="_idContainer022">
<span class="koboSpan" id="kobo.377.1"><img alt="" src="image/B19755_02_09.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.378.1">Figure 2.9 – Turning off Block all public access</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.379.1">In addition to this, make sure</span><a id="_idIndexMarker121"/><span class="koboSpan" id="kobo.380.1"> you toggle the </span><strong class="bold"><span class="koboSpan" id="kobo.381.1">I acknowledge that the current settings might result in this bucket and the objects within becoming public</span></strong><span class="koboSpan" id="kobo.382.1">. </span><span class="koboSpan" id="kobo.382.2">checkbox </span><em class="italic"><span class="koboSpan" id="kobo.383.1">ON</span></em><span class="koboSpan" id="kobo.384.1">. </span><span class="koboSpan" id="kobo.384.2">This will allow you to specify a bucket or access point policy that grants </span><span class="No-Break"><span class="koboSpan" id="kobo.385.1">public access.</span></span></p></li>
</ol>
<ol>
<li value="6"><span class="koboSpan" id="kobo.386.1">You should see a success notification, similar to what is shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.387.1">Figure 2</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.388.1">.10</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.389.1">:</span></span>
<div>
<div class="IMG---Figure" id="_idContainer023">
<span class="koboSpan" id="kobo.390.1"><img alt="" src="image/B19755_02_10.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.391.1">Figure 2.10 – Locating the View details button</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.392.1">Click the </span><strong class="bold"><span class="koboSpan" id="kobo.393.1">View details</span></strong><span class="koboSpan" id="kobo.394.1"> button to navigate</span><a id="_idIndexMarker122"/><span class="koboSpan" id="kobo.395.1"> to the specific S3 bucket page of the bucket we </span><span class="No-Break"><span class="koboSpan" id="kobo.396.1">just created.</span></span></p>
<p><span class="koboSpan" id="kobo.397.1">Wasn’t that easy? </span><span class="koboSpan" id="kobo.397.2">Of course, we’re just getting started – we’ll have to configure this S3 bucket in the next few sections of </span><span class="No-Break"><span class="koboSpan" id="kobo.398.1">this chapter!</span></span></p></li>
</ol>
<h2 id="_idParaDest-29"><a id="_idTextAnchor028"/><span class="koboSpan" id="kobo.399.1">Configuring the S3 bucket to host a static website</span></h2>
<p><span class="koboSpan" id="kobo.400.1">Continuing where we left off in the previous</span><a id="_idIndexMarker123"/><span class="koboSpan" id="kobo.401.1"> section, let’s proceed</span><a id="_idIndexMarker124"/><span class="koboSpan" id="kobo.402.1"> by configuring our S3 bucket for static website hosting. </span><span class="koboSpan" id="kobo.402.2">You would be surprised how easy it is to set this up! </span><span class="koboSpan" id="kobo.402.3">That said, </span><span class="No-Break"><span class="koboSpan" id="kobo.403.1">let’s proceed:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.404.1">Click </span><strong class="bold"><span class="koboSpan" id="kobo.405.1">Properties</span></strong><span class="koboSpan" id="kobo.406.1"> to navigate to the </span><strong class="bold"><span class="koboSpan" id="kobo.407.1">Properties</span></strong><span class="koboSpan" id="kobo.408.1"> tab, as highlighted in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.409.1">Figure 2</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.410.1">.11</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.411.1">:</span></span>
<div>
<div class="IMG---Figure" id="_idContainer024">
<span class="koboSpan" id="kobo.412.1"><img alt="" src="image/B19755_02_11.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.413.1">Figure 2.11 – Navigating to the Properties tab</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.414.1">We should see the following under the </span><strong class="bold"><span class="koboSpan" id="kobo.415.1">Properties</span></strong><span class="koboSpan" id="kobo.416.1"> tab: (1) </span><strong class="bold"><span class="koboSpan" id="kobo.417.1">Bucket overview</span></strong><span class="koboSpan" id="kobo.418.1">, (2) </span><strong class="bold"><span class="koboSpan" id="kobo.419.1">Bucket versioning</span></strong><span class="koboSpan" id="kobo.420.1">, (3) </span><strong class="bold"><span class="koboSpan" id="kobo.421.1">Tags</span></strong><span class="koboSpan" id="kobo.422.1">, (4) </span><strong class="bold"><span class="koboSpan" id="kobo.423.1">Default encryption</span></strong><span class="koboSpan" id="kobo.424.1">, (5) </span><strong class="bold"><span class="koboSpan" id="kobo.425.1">Intelligent-Tiering Archive configurations</span></strong><span class="koboSpan" id="kobo.426.1">, (6) </span><strong class="bold"><span class="koboSpan" id="kobo.427.1">Server access logging</span></strong><span class="koboSpan" id="kobo.428.1">, (7) </span><strong class="bold"><span class="koboSpan" id="kobo.429.1">AWS CloudTrail data events</span></strong><span class="koboSpan" id="kobo.430.1">, (8) </span><strong class="bold"><span class="koboSpan" id="kobo.431.1">Event notifications</span></strong><span class="koboSpan" id="kobo.432.1">, (9) </span><strong class="bold"><span class="koboSpan" id="kobo.433.1">Amazon EventBridge</span></strong><span class="koboSpan" id="kobo.434.1">, (10) </span><strong class="bold"><span class="koboSpan" id="kobo.435.1">Transfer acceleration</span></strong><span class="koboSpan" id="kobo.436.1">, (11) </span><strong class="bold"><span class="koboSpan" id="kobo.437.1">Object Lock</span></strong><span class="koboSpan" id="kobo.438.1">, (12) </span><strong class="bold"><span class="koboSpan" id="kobo.439.1">Requester pays</span></strong><span class="koboSpan" id="kobo.440.1">, and (13) </span><strong class="bold"><span class="koboSpan" id="kobo.441.1">Static </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.442.1">website hosting</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.443.1">.</span></span></p></li>
</ol>
<ol>
<li value="2"><span class="koboSpan" id="kobo.444.1">Scroll down to the bottom of the page until you reach the </span><strong class="bold"><span class="koboSpan" id="kobo.445.1">Static website </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.446.1">hosting</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.447.1"> pane:</span></span>
<div>
<div class="IMG---Figure" id="_idContainer025">
<span class="koboSpan" id="kobo.448.1"><img alt="" src="image/B19755_02_12.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.449.1">Figure 2.12 – Editing the Static website hosting settings</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.450.1">Click the </span><strong class="bold"><span class="koboSpan" id="kobo.451.1">Edit</span></strong><span class="koboSpan" id="kobo.452.1"> button, as highlighted in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.453.1">Figure 2</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.454.1">.12</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.455.1">.</span></span></p></li>
</ol>
<ol>
<li value="3"><span class="koboSpan" id="kobo.456.1">Enable static website</span><a id="_idIndexMarker125"/><span class="koboSpan" id="kobo.457.1"> hosting by</span><a id="_idIndexMarker126"/><span class="koboSpan" id="kobo.458.1"> selecting the </span><strong class="bold"><span class="koboSpan" id="kobo.459.1">Enable</span></strong><span class="koboSpan" id="kobo.460.1"> option (refer to </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.461.1">Figure 2</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.462.1">.13</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.463.1">):</span></span>
<div>
<div class="IMG---Figure" id="_idContainer026">
<span class="koboSpan" id="kobo.464.1"><img alt="" src="image/B19755_02_13.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.465.1">Figure 2.13 – Enabling static website hosting for the S3 bucket</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.466.1">After that, make sure you specify </span><strong class="source-inline"><span class="koboSpan" id="kobo.467.1">index.html</span></strong><span class="koboSpan" id="kobo.468.1"> in the </span><strong class="bold"><span class="koboSpan" id="kobo.469.1">Index </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.470.1">document</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.471.1"> field.</span></span></p></li>
</ol>
<ol>
<li value="4"><span class="koboSpan" id="kobo.472.1">Scroll down to the bottom of the page and click the </span><strong class="bold"><span class="koboSpan" id="kobo.473.1">Save </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.474.1">changes</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.475.1"> button.</span></span></li>
</ol>
<p><span class="koboSpan" id="kobo.476.1">At this point, the bucket is still empty, so clicking the </span><strong class="bold"><span class="koboSpan" id="kobo.477.1">Bucket website endpoint</span></strong><span class="koboSpan" id="kobo.478.1"> link provided (after clicking the </span><strong class="bold"><span class="koboSpan" id="kobo.479.1">Save changes</span></strong><span class="koboSpan" id="kobo.480.1"> button) would give us a </span><strong class="bold"><span class="koboSpan" id="kobo.481.1">404 Not Found</span></strong><span class="koboSpan" id="kobo.482.1"> error response. </span><span class="koboSpan" id="kobo.482.2">Do not worry – we will upload</span><a id="_idIndexMarker127"/><span class="koboSpan" id="kobo.483.1"> a custom </span><strong class="source-inline"><span class="koboSpan" id="kobo.484.1">index.html</span></strong><span class="koboSpan" id="kobo.485.1"> file later after we have updated</span><a id="_idIndexMarker128"/><span class="koboSpan" id="kobo.486.1"> the access control settings of the bucket in the </span><span class="No-Break"><span class="koboSpan" id="kobo.487.1">next section.</span></span></p>
<h2 id="_idParaDest-30"><a id="_idTextAnchor029"/><span class="koboSpan" id="kobo.488.1">Updating the S3 bucket configuration settings</span></h2>
<p><span class="koboSpan" id="kobo.489.1">Now that we’ve configured</span><a id="_idIndexMarker129"/><span class="koboSpan" id="kobo.490.1"> our S3 bucket for static website hosting, the next part involves configuring the bucket to allow anyone with an AWS account to list and access objects stored inside the bucket. </span><span class="koboSpan" id="kobo.490.2">That said, we will update the bucket policy and the ACL configuration settings in the next set </span><span class="No-Break"><span class="koboSpan" id="kobo.491.1">of steps:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.492.1">Click the </span><strong class="bold"><span class="koboSpan" id="kobo.493.1">Permissions</span></strong><span class="koboSpan" id="kobo.494.1"> tab (next to the </span><strong class="bold"><span class="koboSpan" id="kobo.495.1">Properties</span></strong><span class="koboSpan" id="kobo.496.1"> tab). </span><span class="koboSpan" id="kobo.496.2">We should see the following under the </span><strong class="bold"><span class="koboSpan" id="kobo.497.1">Permissions</span></strong><span class="koboSpan" id="kobo.498.1"> tab: (1) </span><strong class="bold"><span class="koboSpan" id="kobo.499.1">Permissions overview</span></strong><span class="koboSpan" id="kobo.500.1">, (2) </span><strong class="bold"><span class="koboSpan" id="kobo.501.1">Block public access (bucket settings)</span></strong><span class="koboSpan" id="kobo.502.1">, (3) </span><strong class="bold"><span class="koboSpan" id="kobo.503.1">Bucket policy</span></strong><span class="koboSpan" id="kobo.504.1">, (4) </span><strong class="bold"><span class="koboSpan" id="kobo.505.1">Object Ownership</span></strong><span class="koboSpan" id="kobo.506.1">, (5) </span><strong class="bold"><span class="koboSpan" id="kobo.507.1">Access control list (ACL)</span></strong><span class="koboSpan" id="kobo.508.1">, and (6) </span><strong class="bold"><span class="koboSpan" id="kobo.509.1">Cross-origin resource </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.510.1">sharing (CORS)</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.511.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.512.1">Next, click the </span><strong class="bold"><span class="koboSpan" id="kobo.513.1">Edit</span></strong><span class="koboSpan" id="kobo.514.1"> button (as highlighted in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.515.1">Figure 2</span></em></span><em class="italic"><span class="koboSpan" id="kobo.516.1">.14</span></em><span class="koboSpan" id="kobo.517.1">) to specify a new </span><span class="No-Break"><span class="koboSpan" id="kobo.518.1">bucket policy:</span></span>
<div>
<div class="IMG---Figure" id="_idContainer027">
<span class="koboSpan" id="kobo.519.1"><img alt="" src="image/B19755_02_14.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.520.1">Figure 2.14 – Editing Bucket policy</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.521.1">In </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.522.1">Figure 2</span></em></span><em class="italic"><span class="koboSpan" id="kobo.523.1">.14</span></em><span class="koboSpan" id="kobo.524.1">, we can see that no bucket policy is specified at </span><span class="No-Break"><span class="koboSpan" id="kobo.525.1">the moment.</span></span></p></li>
</ol>
<ol>
<li value="3"><span class="koboSpan" id="kobo.526.1">After clicking the </span><strong class="bold"><span class="koboSpan" id="kobo.527.1">Edit</span></strong><span class="koboSpan" id="kobo.528.1"> button, specify </span><a id="_idIndexMarker130"/><span class="koboSpan" id="kobo.529.1">the following bucket policy in the </span><span class="No-Break"><span class="koboSpan" id="kobo.530.1">text area:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.531.1">
{
    "Version": "2012-10-17",
    "Id": "n",
    "Statement": [
        {
            "Sid": "SampleStatement",
            "Effect": "Allow",
            "Principal": {
                "AWS": "*"
            },
            "Action": "s3:GetObject",
            "Resource": "arn:aws:s3:::</span><strong class="bold"><span class="koboSpan" id="kobo.532.1">&lt;BUCKET NAME&gt;</span></strong><span class="koboSpan" id="kobo.533.1">/*"
        }
    ]
}</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.534.1">Make sure you replace </span><strong class="source-inline"><span class="koboSpan" id="kobo.535.1">&lt;BUCKET NAME&gt;</span></strong><span class="koboSpan" id="kobo.536.1"> with the bucket name of the S3 bucket you created. </span><span class="koboSpan" id="kobo.536.2">This should give you a bucket policy similar to what we have in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.537.1">Figure 2</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.538.1">.15</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.539.1">:</span></span></p> <div>
<div class="IMG---Figure" id="_idContainer028">
<span class="koboSpan" id="kobo.540.1"><img alt="" src="image/B19755_02_15.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.541.1">Figure 2.15 – Specifying a bucket policy</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.542.1">This S3 bucket policy enables </span><em class="italic"><span class="koboSpan" id="kobo.543.1">any</span></em><span class="koboSpan" id="kobo.544.1"> AWS account</span><a id="_idIndexMarker131"/><span class="koboSpan" id="kobo.545.1"> to retrieve objects from the </span><strong class="source-inline"><span class="koboSpan" id="kobo.546.1">sample-web-bucket-abc123</span></strong><span class="koboSpan" id="kobo.547.1"> S3 bucket. </span><span class="koboSpan" id="kobo.547.2">You might be surprised that what we have in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.548.1">Figure 2</span></em></span><em class="italic"><span class="koboSpan" id="kobo.549.1">.15</span></em><span class="koboSpan" id="kobo.550.1"> is a relatively common misconfiguration found across S3 buckets around </span><span class="No-Break"><span class="koboSpan" id="kobo.551.1">the world!</span></span></p></li>
</ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.552.1">Important note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.553.1">It is important to note that changing the </span><strong class="source-inline"><span class="koboSpan" id="kobo.554.1">"Action"</span></strong><span class="koboSpan" id="kobo.555.1"> parameter value from </span><strong class="source-inline"><span class="koboSpan" id="kobo.556.1">"s3:GetObject"</span></strong><span class="koboSpan" id="kobo.557.1"> to </span><strong class="source-inline"><span class="koboSpan" id="kobo.558.1">"*"</span></strong><span class="koboSpan" id="kobo.559.1"> would allow </span><em class="italic"><span class="koboSpan" id="kobo.560.1">any</span></em><span class="koboSpan" id="kobo.561.1"> AWS account to perform unwanted actions (for example, uploading files) to our S3 bucket. </span><span class="koboSpan" id="kobo.561.2">We don’t want other users having write access to our bucket! </span><span class="koboSpan" id="kobo.561.3">Why? </span><span class="koboSpan" id="kobo.561.4">For one thing, malicious authenticated users would be able to upload multiple large files into our S3 bucket (which would impact our AWS bill). </span><span class="koboSpan" id="kobo.561.5">That said, the use of a wildcard or asterisk (</span><strong class="source-inline"><span class="koboSpan" id="kobo.562.1">"*"</span></strong><span class="koboSpan" id="kobo.563.1">) should be avoided when working with policies whenever possible, even if we’re designing an intentionally vulnerable </span><span class="No-Break"><span class="koboSpan" id="kobo.564.1">S3 bucket.</span></span></p>
<ol>
<li value="4"><span class="koboSpan" id="kobo.565.1">Scroll down to the bottom of the page and click the </span><strong class="bold"><span class="koboSpan" id="kobo.566.1">Save </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.567.1">changes</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.568.1"> button.</span></span></li>
<li><span class="koboSpan" id="kobo.569.1">Now, let’s modify the </span><strong class="bold"><span class="koboSpan" id="kobo.570.1">Access control list (ACL)</span></strong><span class="koboSpan" id="kobo.571.1"> configuration settings. </span><span class="koboSpan" id="kobo.571.2">Click the </span><strong class="bold"><span class="koboSpan" id="kobo.572.1">Edit</span></strong><span class="koboSpan" id="kobo.573.1"> button, as highlighted in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.574.1">Figure 2</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.575.1">.16</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.576.1">:</span></span>
<div>
<div class="IMG---Figure" id="_idContainer029">
<span class="koboSpan" id="kobo.577.1"><img alt="" src="image/B19755_02_16.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.578.1">Figure 2.16 – Editing the ACL configuration</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.579.1">Here, we can see the current ACL</span><a id="_idIndexMarker132"/><span class="koboSpan" id="kobo.580.1"> configuration of our S3 bucket. </span><span class="koboSpan" id="kobo.580.2">By default, only the bucket owner (you) can perform operations on </span><span class="No-Break"><span class="koboSpan" id="kobo.581.1">the bucket.</span></span></p></li>
</ol>
<ol>
<li value="6"><span class="koboSpan" id="kobo.582.1">Under </span><strong class="bold"><span class="koboSpan" id="kobo.583.1">Edit access control list (ACL)</span></strong><span class="koboSpan" id="kobo.584.1"> | </span><strong class="bold"><span class="koboSpan" id="kobo.585.1">Access control list (ACL)</span></strong><span class="koboSpan" id="kobo.586.1">, toggle the </span><strong class="bold"><span class="koboSpan" id="kobo.587.1">List</span></strong><span class="koboSpan" id="kobo.588.1"> checkbox </span><em class="italic"><span class="koboSpan" id="kobo.589.1">ON</span></em><span class="koboSpan" id="kobo.590.1"> under the </span><strong class="bold"><span class="koboSpan" id="kobo.591.1">Objects</span></strong><span class="koboSpan" id="kobo.592.1"> column for the </span><strong class="bold"><span class="koboSpan" id="kobo.593.1">Authenticated users group</span></strong><span class="koboSpan" id="kobo.594.1"> grantee, similar to what we have in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.595.1">Figure 2</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.596.1">.17</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.597.1">:</span></span>
<div>
<div class="IMG---Figure" id="_idContainer030">
<span class="koboSpan" id="kobo.598.1"><img alt="" src="image/B19755_02_17.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.599.1">Figure 2.17 – Allowing Authenticated users group to list objects inside the bucket</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.600.1">This should allow</span><a id="_idIndexMarker133"/><span class="koboSpan" id="kobo.601.1"> anyone with an AWS account to list the objects in our </span><span class="No-Break"><span class="koboSpan" id="kobo.602.1">S3 bucket.</span></span></p></li>
</ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.603.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.604.1">Feel free to check out </span><a href="https://aws.amazon.com/blogs/security/iam-policies-and-bucket-policies-and-acls-oh-my-controlling-access-to-s3-resources/"><span class="koboSpan" id="kobo.605.1">https://aws.amazon.com/blogs/security/iam-policies-and-bucket-policies-and-acls-oh-my-controlling-access-to-s3-resources/</span></a><span class="koboSpan" id="kobo.606.1"> for more information on how permission control works when multiple access control mechanisms are </span><span class="No-Break"><span class="koboSpan" id="kobo.607.1">in place.</span></span></p>
<ol>
<li value="7"><span class="koboSpan" id="kobo.608.1">Make sure to toggle the </span><strong class="bold"><span class="koboSpan" id="kobo.609.1">I understand the effects of these changes on my objects and buckets</span></strong><span class="koboSpan" id="kobo.610.1">. </span><span class="No-Break"><span class="koboSpan" id="kobo.611.1">checkbox </span></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.612.1">ON</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.613.1">:</span></span>
<div>
<div class="IMG---Figure" id="_idContainer031">
<span class="koboSpan" id="kobo.614.1"><img alt="" src="image/B19755_02_18.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.615.1">Figure 2.18 – Confirming the ACL modifications to be applied</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.616.1">Given that this configuration change may have unintended consequences (from a security standpoint), AWS requires</span><a id="_idIndexMarker134"/><span class="koboSpan" id="kobo.617.1"> us to review and confirm the changes </span><span class="No-Break"><span class="koboSpan" id="kobo.618.1">being applied.</span></span></p></li>
</ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.619.1">Important note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.620.1">AWS recommends that ACLs are disabled since we can rely on S3 bucket policies, IAM policies, VPC endpoint policies, and AWS Organizations SCPs when managing access control in S3 in most scenarios and use cases. </span><span class="koboSpan" id="kobo.620.2">However, despite the warnings and guardrails available, a lot of existing S3 buckets are still misconfigured and vulnerable since only new S3 buckets are protected by the latest set of guardrails enforced </span><span class="No-Break"><span class="koboSpan" id="kobo.621.1">by AWS.</span></span></p>
<p><span class="koboSpan" id="kobo.622.1">Now that we’ve modified the bucket policy along with the ACL configuration settings, we’ll proceed with uploading files to our S3 bucket in the </span><span class="No-Break"><span class="koboSpan" id="kobo.623.1">next section.</span></span></p>
<h2 id="_idParaDest-31"><a id="_idTextAnchor030"/><span class="koboSpan" id="kobo.624.1">Uploading files to the S3 bucket</span></h2>
<p><span class="koboSpan" id="kobo.625.1">Our setup would not be complete without files inside</span><a id="_idIndexMarker135"/><span class="koboSpan" id="kobo.626.1"> our vulnerable S3 bucket. </span><span class="koboSpan" id="kobo.626.2">That said, we will upload</span><a id="_idIndexMarker136"/><span class="koboSpan" id="kobo.627.1"> a few sample files we might see in a typical S3 bucket. </span><span class="koboSpan" id="kobo.627.2">There are a variety of ways to upload files to an S3 bucket. </span><span class="koboSpan" id="kobo.627.3">One option would be to upload files using the AWS Management</span><a id="_idIndexMarker137"/><span class="koboSpan" id="kobo.628.1"> Console. </span><span class="koboSpan" id="kobo.628.2">Another option would be to use the </span><strong class="bold"><span class="koboSpan" id="kobo.629.1">AWS CLI</span></strong><span class="koboSpan" id="kobo.630.1"> to upload files via the </span><span class="No-Break"><span class="koboSpan" id="kobo.631.1">command line.</span></span></p>
<p><span class="koboSpan" id="kobo.632.1">In the next set of steps, we’ll use the AWS CLI to upload files to our </span><span class="No-Break"><span class="koboSpan" id="kobo.633.1">S3 bucket:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.634.1">Open a new browser tab and navigate to the AWS console. </span><span class="koboSpan" id="kobo.634.2">Type </span><strong class="source-inline"><span class="koboSpan" id="kobo.635.1">shell</span></strong><span class="koboSpan" id="kobo.636.1"> in the search bar and select </span><strong class="bold"><span class="koboSpan" id="kobo.637.1">CloudShell</span></strong><span class="koboSpan" id="kobo.638.1"> from the list of results, similar to what we have in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.639.1">Figure 2</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.640.1">.19</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.641.1">:</span></span>
<div>
<div class="IMG---Figure" id="_idContainer032">
<span class="koboSpan" id="kobo.642.1"><img alt="" src="image/B19755_02_19.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.643.1">Figure 2.19 – Navigating to the CloudShell console</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.644.1">If you have not used </span><strong class="bold"><span class="koboSpan" id="kobo.645.1">AWS CloudShell</span></strong><span class="koboSpan" id="kobo.646.1"> before, it is simply a browser-based</span><a id="_idIndexMarker138"/><span class="koboSpan" id="kobo.647.1"> command-line terminal</span><a id="_idIndexMarker139"/><span class="koboSpan" id="kobo.648.1"> where we can run different commands to manage</span><a id="_idIndexMarker140"/><span class="koboSpan" id="kobo.649.1"> our resources. </span><span class="koboSpan" id="kobo.649.2">You’ll be surprised how convenient it is to use CloudShell in the succeeding set </span><span class="No-Break"><span class="koboSpan" id="kobo.650.1">of steps!</span></span></p></li>
</ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.651.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.652.1">It is important to note that AWS CloudShell may not be supported in other AWS regions. </span><span class="koboSpan" id="kobo.652.2">For more information, feel free</span><a id="_idIndexMarker141"/><span class="koboSpan" id="kobo.653.1"> to check the following </span><span class="No-Break"><span class="koboSpan" id="kobo.654.1">link: </span></span><a href="https://docs.aws.amazon.com/cloudshell/latest/userguide/supported-aws-regions.html"><span class="No-Break"><span class="koboSpan" id="kobo.655.1">https://docs.aws.amazon.com/cloudshell/latest/userguide/supported-aws-regions.html</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.656.1">.</span></span></p>
<ol>
<li value="2"><span class="koboSpan" id="kobo.657.1">Click the </span><strong class="bold"><span class="koboSpan" id="kobo.658.1">Close</span></strong><span class="koboSpan" id="kobo.659.1"> button when you see the </span><strong class="bold"><span class="koboSpan" id="kobo.660.1">Welcome to AWS CloudShell</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.661.1">pop-up window:</span></span>
<div>
<div class="IMG---Figure" id="_idContainer033">
<span class="koboSpan" id="kobo.662.1"><img alt="" src="image/B19755_02_20.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.663.1">Figure 2.20 – Closing the welcome popup</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.664.1">In </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.665.1">Figure 2</span></em></span><em class="italic"><span class="koboSpan" id="kobo.666.1">.20</span></em><span class="koboSpan" id="kobo.667.1">, we can see that </span><strong class="bold"><span class="koboSpan" id="kobo.668.1">AWS CloudShell</span></strong><span class="koboSpan" id="kobo.669.1"> comes pre-installed with</span><a id="_idIndexMarker142"/><span class="koboSpan" id="kobo.670.1"> the AWS CLI, Python, and Node.js, along with other tools. </span><span class="koboSpan" id="kobo.670.2">In addition to this, we have 1 GB of free storage available (per AWS region) where we can manage, upload, and download the files that will be used</span><a id="_idIndexMarker143"/><span class="koboSpan" id="kobo.671.1"> for resource management</span><a id="_idIndexMarker144"/> <span class="No-Break"><span class="koboSpan" id="kobo.672.1">and creation.</span></span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.673.1">Once you close the pop-up window, you should see a terminal where you can type and run </span><span class="No-Break"><span class="koboSpan" id="kobo.674.1">bash commands.</span></span></p></li>
</ol>
<ol>
<li value="3"><span class="koboSpan" id="kobo.675.1">In the terminal of our CloudShell environment (right after the </span><strong class="bold"><span class="koboSpan" id="kobo.676.1">$</span></strong><span class="koboSpan" id="kobo.677.1"> sign), run the following </span><span class="No-Break"><span class="koboSpan" id="kobo.678.1">bash commands:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.679.1">mkdir files</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.680.1">cd files</span></strong></pre><p class="list-inset"><span class="koboSpan" id="kobo.681.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.682.1">mkdir</span></strong><span class="koboSpan" id="kobo.683.1"> command is used to create a new directory named </span><strong class="source-inline"><span class="koboSpan" id="kobo.684.1">files</span></strong><span class="koboSpan" id="kobo.685.1">. </span><span class="koboSpan" id="kobo.685.2">After that, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.686.1">cd</span></strong><span class="koboSpan" id="kobo.687.1"> command is used to navigate to the newly </span><span class="No-Break"><span class="koboSpan" id="kobo.688.1">created directory.</span></span></p></li> <li><span class="koboSpan" id="kobo.689.1">Next, let’s run the following commands to download the </span><strong class="source-inline"><span class="koboSpan" id="kobo.690.1">sample_website.zip</span></strong><span class="koboSpan" id="kobo.691.1"> file into the </span><strong class="source-inline"><span class="koboSpan" id="kobo.692.1">files</span></strong><span class="koboSpan" id="kobo.693.1"> directory we </span><span class="No-Break"><span class="koboSpan" id="kobo.694.1">just created:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.695.1">SOURCE=</span></strong><a href="https://github.com/PacktPublishing/Building-and-Automating-Penetration-Testing-Labs-in-the-Cloud/raw/main/ch02/sample_website.zip"><strong class="bold"><span class="koboSpan" id="kobo.696.1">https://github.com/PacktPublishing/Building-and-Automating-Penetration-Testing-Labs-in-the-Cloud/raw/main/ch02/sample_website.zip</span></strong></a>
<strong class="bold"><span class="koboSpan" id="kobo.697.1">wget $SOURCE -O sample_website.zip</span></strong></pre><p class="list-inset"><span class="koboSpan" id="kobo.698.1">This will generate a set of logs, similar to what we have in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.699.1">Figure 2</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.700.1">.21</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.701.1">:</span></span></p> <div>
<div class="IMG---Figure" id="_idContainer034">
<span class="koboSpan" id="kobo.702.1"><img alt="" src="image/B19755_02_21.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.703.1">Figure 2.21 – Running commands on AWS CloudShell</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.704.1">What’s inside the </span><strong class="source-inline"><span class="koboSpan" id="kobo.705.1">sample_website.zip</span></strong><span class="koboSpan" id="kobo.706.1"> file we just downloaded? </span><span class="koboSpan" id="kobo.706.2">As we’ll see in the next set of steps, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.707.1">sample_website.zip</span></strong><span class="koboSpan" id="kobo.708.1"> file contains an </span><strong class="source-inline"><span class="koboSpan" id="kobo.709.1">index.html</span></strong><span class="koboSpan" id="kobo.710.1"> file, along with a directory</span><a id="_idIndexMarker145"/><span class="koboSpan" id="kobo.711.1"> containing a backup copy of the backend</span><a id="_idIndexMarker146"/><span class="koboSpan" id="kobo.712.1"> code of </span><span class="No-Break"><span class="koboSpan" id="kobo.713.1">the application.</span></span></p></li>
</ol>
<ol>
<li value="5"><span class="koboSpan" id="kobo.714.1">List all the files in the current directory using the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.715.1">ls</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.716.1"> command:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.717.1">ls</span></strong></pre><p class="list-inset"><span class="koboSpan" id="kobo.718.1">At this point, we should only have the </span><strong class="source-inline"><span class="koboSpan" id="kobo.719.1">sample_website.zip</span></strong><span class="koboSpan" id="kobo.720.1"> file in our </span><span class="No-Break"><span class="koboSpan" id="kobo.721.1">current directory.</span></span></p></li> <li><span class="koboSpan" id="kobo.722.1">Let’s extract the contents of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.723.1">sample_website.zip</span></strong><span class="koboSpan" id="kobo.724.1"> file using the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.725.1">unzip</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.726.1"> command:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.727.1">unzip sample_website.zip</span></strong></pre><p class="list-inset"><span class="koboSpan" id="kobo.728.1">This should give us a set of logs, similar to what we have in the </span><span class="No-Break"><span class="koboSpan" id="kobo.729.1">following block:</span></span></p><pre class="source-code"><span class="koboSpan" id="kobo.730.1">Archive:  sample_website.zip
   creating: backup/
   creating: backup/backend/
   creating: backup/backend/node_modules/
   creating: backup/backend/node_modules/dotenv/
...
</span><span class="koboSpan" id="kobo.730.2">(and so on)</span></pre></li> <li><span class="koboSpan" id="kobo.731.1">Before performing the upload command, let’s delete the </span><strong class="source-inline"><span class="koboSpan" id="kobo.732.1">sample_website.zip</span></strong><span class="koboSpan" id="kobo.733.1"> file from the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.734.1">files</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.735.1"> directory:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.736.1">rm sample_website.zip</span></strong></pre></li> <li><span class="koboSpan" id="kobo.737.1">Now, let’s upload the files</span><a id="_idIndexMarker147"/><span class="koboSpan" id="kobo.738.1"> to the S3 bucket</span><a id="_idIndexMarker148"/><span class="koboSpan" id="kobo.739.1"> using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.740.1">aws s3 cp</span></strong><span class="koboSpan" id="kobo.741.1"> command (this should take around 10 to 15 seconds </span><span class="No-Break"><span class="koboSpan" id="kobo.742.1">to complete):</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.743.1">aws s3 cp --recursive . </span><span class="koboSpan" id="kobo.743.2">s3://&lt;INSERT S3 BUCKET NAME&gt;</span></strong></pre><p class="list-inset"><span class="koboSpan" id="kobo.744.1">Make sure you replace </span><strong class="source-inline"><span class="koboSpan" id="kobo.745.1">&lt;INSERT S3 BUCKET NAME&gt;</span></strong><span class="koboSpan" id="kobo.746.1"> with the name of your </span><span class="No-Break"><span class="koboSpan" id="kobo.747.1">S3 bucket.</span></span></p></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.748.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.749.1">In this step, we used the </span><strong class="bold"><span class="koboSpan" id="kobo.750.1">AWS CLI</span></strong><span class="koboSpan" id="kobo.751.1"> to upload files from a directory inside</span><a id="_idIndexMarker149"/><span class="koboSpan" id="kobo.752.1"> our AWS CloudShell environment to our S3 bucket. </span><span class="koboSpan" id="kobo.752.2">If this is your first time using the AWS CLI, it is simply a command-line tool for managing AWS resources, which includes creating and configuring resources, deploying applications, and managing security settings. </span><span class="koboSpan" id="kobo.752.3">For more information about the AWS CLI, feel free to check out the following </span><span class="No-Break"><span class="koboSpan" id="kobo.753.1">video: </span></span><a href="https://www.youtube.com/watch?v=EAFRKMe6j08"><span class="No-Break"><span class="koboSpan" id="kobo.754.1">https://www.youtube.com/watch?v=EAFRKMe6j08</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.755.1">.</span></span></p>
<ol>
<li value="9"><span class="koboSpan" id="kobo.756.1">Navigate back to the S3 console and locate the </span><strong class="bold"><span class="koboSpan" id="kobo.757.1">Static website hosting</span></strong><span class="koboSpan" id="kobo.758.1"> configuration settings under the </span><strong class="bold"><span class="koboSpan" id="kobo.759.1">Properties</span></strong><span class="koboSpan" id="kobo.760.1"> tab. </span><span class="koboSpan" id="kobo.760.2">Click the </span><strong class="bold"><span class="koboSpan" id="kobo.761.1">Bucket website endpoint</span></strong><span class="koboSpan" id="kobo.762.1"> link (as highlighted in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.763.1">Figure 2</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.764.1">.22</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.765.1">):</span></span>
<div>
<div class="IMG---Figure" id="_idContainer035">
<span class="koboSpan" id="kobo.766.1"><img alt="" src="image/B19755_02_22.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.767.1">Figure 2.22 – Locating the Bucket website endpoint link</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.768.1">We should see a maintenance page, similar to what is shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.769.1">Figure 2</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.770.1">.23</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.771.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer036">
<span class="koboSpan" id="kobo.772.1"><img alt="" src="image/B19755_02_23.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.773.1">Figure 2.23 – Verifying that the files have been uploaded to S3</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.774.1">Note that the </span><strong class="source-inline"><span class="koboSpan" id="kobo.775.1">index.html</span></strong><span class="koboSpan" id="kobo.776.1"> page we uploaded to the S3 bucket is returned and rendered when the request is made since it is the configured</span><a id="_idIndexMarker150"/><span class="koboSpan" id="kobo.777.1"> index document</span><a id="_idIndexMarker151"/><span class="koboSpan" id="kobo.778.1"> of the </span><span class="No-Break"><span class="koboSpan" id="kobo.779.1">static website.</span></span></p></li>
</ol>
<p><span class="koboSpan" id="kobo.780.1">With that, our setup is complete! </span><span class="koboSpan" id="kobo.780.2">In the next section, we’ll test our vulnerable environment and check if our current setup works and is configured </span><span class="No-Break"><span class="koboSpan" id="kobo.781.1">as expected.</span></span></p>
<h1 id="_idParaDest-32"><a id="_idTextAnchor031"/><span class="koboSpan" id="kobo.782.1">Testing and hacking our first vulnerable environment</span></h1>
<p><span class="koboSpan" id="kobo.783.1">In this section, we’ll try to emulate how an attacker might behave when trying to hack our vulnerable S3 bucket. </span><span class="koboSpan" id="kobo.783.2">Attackers might use a specialized set of automated tools, but we should do just fine without those tools in </span><span class="No-Break"><span class="koboSpan" id="kobo.784.1">this chapter.</span></span></p>
<h2 id="_idParaDest-33"><a id="_idTextAnchor032"/><span class="koboSpan" id="kobo.785.1">Inspecting and verifying the S3 bucket’s security</span></h2>
<p><span class="koboSpan" id="kobo.786.1">We will start by verifying the security</span><a id="_idIndexMarker152"/><span class="koboSpan" id="kobo.787.1"> configuration</span><a id="_idIndexMarker153"/><span class="koboSpan" id="kobo.788.1"> of the S3 bucket we created using a series of </span><span class="No-Break"><span class="koboSpan" id="kobo.789.1">manual checks.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.790.1">Important note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.791.1">It is unethical and illegal to attack cloud resources owned by another user or company. </span><span class="koboSpan" id="kobo.791.2">Before we start, make sure you read the </span><em class="italic"><span class="koboSpan" id="kobo.792.1">Examining the considerations when building penetration testing lab environments in the cloud</span></em><span class="koboSpan" id="kobo.793.1"> section of </span><span class="No-Break"><em class="italic"><a href="B19755_01.xhtml"><span class="koboSpan" id="kobo.794.1">Chapter 1</span></a></em></span><span class="koboSpan" id="kobo.795.1">, </span><em class="italic"><span class="koboSpan" id="kobo.796.1">Getting Started with Penetration Testing Labs in the Cloud</span></em><span class="koboSpan" id="kobo.797.1">, since we will be simulating the attack process to validate whether the misconfigurations and vulnerabilities and present </span><span class="No-Break"><span class="koboSpan" id="kobo.798.1">are exploitable.</span></span></p>
<p><span class="koboSpan" id="kobo.799.1">With that out of the way, we can proceed with testing and hacking our vulnerable cloud </span><span class="No-Break"><span class="koboSpan" id="kobo.800.1">lab setup:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.801.1">Continuing where we left off in the previous section, right-click on the center of the maintenance page and select </span><strong class="bold"><span class="koboSpan" id="kobo.802.1">View Page Source</span></strong><span class="koboSpan" id="kobo.803.1"> from the list of options available. </span><span class="koboSpan" id="kobo.803.2">This should let us see the frontend HTML code of the maintenance page, similar to what we have in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.804.1">Figure 2</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.805.1">.24</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.806.1">:</span></span>
<div>
<div class="IMG---Figure" id="_idContainer037">
<span class="koboSpan" id="kobo.807.1"><img alt="" src="image/B19755_02_24.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.808.1">Figure 2.24 – View Page Source</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.809.1">Since this is a static page, we</span><a id="_idIndexMarker154"/><span class="koboSpan" id="kobo.810.1"> shouldn’t be able to find other links or references to resources</span><a id="_idIndexMarker155"/><span class="koboSpan" id="kobo.811.1"> we can </span><span class="No-Break"><span class="koboSpan" id="kobo.812.1">inspect further.</span></span></p></li>
</ol>
<ol>
<li value="2"><span class="koboSpan" id="kobo.813.1">Next, navigate to </span><strong class="source-inline"><span class="koboSpan" id="kobo.814.1">http://&lt;S3 BUCKET URL&gt;.s3-website-us-east-1.amazonaws.com/.git</span></strong><span class="koboSpan" id="kobo.815.1"> to check whether (1) a </span><strong class="source-inline"><span class="koboSpan" id="kobo.816.1">.git</span></strong><span class="koboSpan" id="kobo.817.1"> directory exists and (2) the </span><strong class="source-inline"><span class="koboSpan" id="kobo.818.1">.git</span></strong><span class="koboSpan" id="kobo.819.1"> directory is public. </span><span class="koboSpan" id="kobo.819.2">Make sure you replace </span><strong class="source-inline"><span class="koboSpan" id="kobo.820.1">&lt;S3 BUCKET URL&gt;</span></strong><span class="koboSpan" id="kobo.821.1"> with the name of the bucket you created. </span><span class="koboSpan" id="kobo.821.2">You should see an error message similar to what is shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.822.1">Figure 2</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.823.1">.25</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.824.1">:</span></span>
<div>
<div class="IMG---Figure" id="_idContainer038">
<span class="koboSpan" id="kobo.825.1"><img alt="" src="image/B19755_02_25.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.826.1">Figure 2.25 – 404 Not Found</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.827.1">As shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.828.1">Figure 2</span></em></span><em class="italic"><span class="koboSpan" id="kobo.829.1">.25</span></em><span class="koboSpan" id="kobo.830.1">, no such file or directory exists inside the bucket. </span><span class="koboSpan" id="kobo.830.2">You may check for other files such as </span><strong class="source-inline"><span class="koboSpan" id="kobo.831.1">README.md</span></strong><span class="koboSpan" id="kobo.832.1"> but since we have a good idea of what is inside the bucket, we can skip these additional steps </span><span class="No-Break"><span class="koboSpan" id="kobo.833.1">for now.</span></span></p></li>
</ol>
<ol>
<li value="3"><span class="koboSpan" id="kobo.834.1">Let’s also check whether the files and directories inside the S3 bucket will be listed by navigating to </span><strong class="source-inline"><span class="koboSpan" id="kobo.835.1">https://&lt;S3 BUCKET URL&gt;.s3.amazonaws.com/</span></strong><span class="koboSpan" id="kobo.836.1">. </span><span class="koboSpan" id="kobo.836.2">Make sure you replace </span><strong class="source-inline"><span class="koboSpan" id="kobo.837.1">&lt;S3 BUCKET URL&gt;</span></strong><span class="koboSpan" id="kobo.838.1"> with the name of your </span><span class="No-Break"><span class="koboSpan" id="kobo.839.1">S3 bucket:</span></span>
<div>
<div class="IMG---Figure" id="_idContainer039">
<span class="koboSpan" id="kobo.840.1"><img alt="" src="image/B19755_02_26.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.841.1">Figure 2.26 – Checking whether we can list the contents of the bucket</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.842.1">This should give us an </span><strong class="bold"><span class="koboSpan" id="kobo.843.1">Access Denied</span></strong><span class="koboSpan" id="kobo.844.1"> error message, similar to what is shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.845.1">Figure 2</span></em></span><em class="italic"><span class="koboSpan" id="kobo.846.1">.26</span></em><span class="koboSpan" id="kobo.847.1">. </span><span class="koboSpan" id="kobo.847.2">Would this mean that we won’t be able to access the files as a guest user (public access) inside</span><a id="_idIndexMarker156"/><span class="koboSpan" id="kobo.848.1"> the bucket? </span><span class="koboSpan" id="kobo.848.2">Not necessarily! </span><span class="koboSpan" id="kobo.848.3">We’ll see that this is the case in the very</span><a id="_idIndexMarker157"/> <span class="No-Break"><span class="koboSpan" id="kobo.849.1">next step.</span></span></p></li>
</ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.850.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.851.1">Make sure you’re familiar with the different URLs that are available when working with S3 buckets. </span><span class="koboSpan" id="kobo.851.2">In addition to the URLs we checked in the previous step, you may also want to check </span><strong class="source-inline"><span class="koboSpan" id="kobo.852.1">https://s3.amazonaws.com/&lt;S3 BUCKET URL&gt;/</span></strong><span class="koboSpan" id="kobo.853.1"> (after replacing </span><strong class="source-inline"><span class="koboSpan" id="kobo.854.1">&lt;S3 BUCKET URL&gt;</span></strong><span class="koboSpan" id="kobo.855.1"> with the name of the </span><span class="No-Break"><span class="koboSpan" id="kobo.856.1">S3 bucket).</span></span></p>
<ol>
<li value="4"><span class="koboSpan" id="kobo.857.1">Next, let’s check whether we can access some of the known files inside the bucket. </span><span class="koboSpan" id="kobo.857.2">Since the S3 bucket is configured to host a static website, it will probably have an </span><strong class="source-inline"><span class="koboSpan" id="kobo.858.1">index.html</span></strong><span class="koboSpan" id="kobo.859.1"> file (unless the bucket is configured to have a different index document). </span><span class="koboSpan" id="kobo.859.2">That said, let’s navigate to </span><strong class="source-inline"><span class="koboSpan" id="kobo.860.1">https://&lt;S3 BUCKET URL&gt;.s3.amazonaws.com/index.html</span></strong><span class="koboSpan" id="kobo.861.1">. </span><span class="koboSpan" id="kobo.861.2">Similar to the previous step, make sure you replace </span><strong class="source-inline"><span class="koboSpan" id="kobo.862.1">&lt;S3 BUCKET URL&gt;</span></strong><span class="koboSpan" id="kobo.863.1"> with the name of your </span><span class="No-Break"><span class="koboSpan" id="kobo.864.1">S3 bucket:</span></span>
<div>
<div class="IMG---Figure" id="_idContainer040">
<span class="koboSpan" id="kobo.865.1"><img alt="" src="image/B19755_02_27.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.866.1">Figure 2.27 – Checking whether we can access the index.html file</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.867.1">This should render the maintenance page, similar to what we have in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.868.1">Figure 2</span></em></span><em class="italic"><span class="koboSpan" id="kobo.869.1">.27</span></em><span class="koboSpan" id="kobo.870.1">. </span><span class="koboSpan" id="kobo.870.2">Note that we should</span><a id="_idIndexMarker158"/><span class="koboSpan" id="kobo.871.1"> be able to access the other files stored in this bucket</span><a id="_idIndexMarker159"/><span class="koboSpan" id="kobo.872.1"> since the S3 bucket is most likely configured to allow reads from unauthenticated users. </span><span class="koboSpan" id="kobo.872.2">However, since we do not know about the existence of certain files from the point of view of a guest user, we’ll skip any similar or related steps for now. </span><span class="koboSpan" id="kobo.872.3">Of course, checking all possible keys through brute-force methods inside the S3 bucket using an automated script is an option (but </span><span class="No-Break"><span class="koboSpan" id="kobo.873.1">not recommended).</span></span></p></li>
</ol>
<ol>
<li value="5"><span class="koboSpan" id="kobo.874.1">Open a private browsing window. </span><span class="koboSpan" id="kobo.874.2">Navigate to </span><a href="https://aws.amazon.com/console/"><span class="koboSpan" id="kobo.875.1">https://aws.amazon.com/console/</span></a><span class="koboSpan" id="kobo.876.1"> and sign in to your second </span><span class="No-Break"><span class="koboSpan" id="kobo.877.1">AWS account:</span></span>
<div>
<div class="IMG---Figure" id="_idContainer041">
<span class="koboSpan" id="kobo.878.1"><img alt="" src="image/B19755_02_28.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.879.1">Figure 2.28 – Opening a private browsing window</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.880.1">You may decide to use a different </span><a id="_idIndexMarker160"/><span class="koboSpan" id="kobo.881.1">browser altogether when signing in to your second AWS account. </span><span class="koboSpan" id="kobo.881.2">Note</span><a id="_idIndexMarker161"/><span class="koboSpan" id="kobo.882.1"> that we are simulating the experience from an attacker’s point </span><span class="No-Break"><span class="koboSpan" id="kobo.883.1">of view.</span></span></p></li>
</ol>
<ol>
<li value="6"><span class="koboSpan" id="kobo.884.1">Type </span><strong class="source-inline"><span class="koboSpan" id="kobo.885.1">shell</span></strong><span class="koboSpan" id="kobo.886.1"> in the search bar. </span><span class="koboSpan" id="kobo.886.2">Select </span><strong class="bold"><span class="koboSpan" id="kobo.887.1">CloudShell</span></strong><span class="koboSpan" id="kobo.888.1"> from the list of results, as highlighted in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.889.1">Figure 2</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.890.1">.29</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.891.1">:</span></span>
<div>
<div class="IMG---Figure" id="_idContainer042">
<span class="koboSpan" id="kobo.892.1"><img alt="" src="image/B19755_02_29.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.893.1">Figure 2.29 – Navigating to the CloudShell console</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.894.1">Click the </span><strong class="bold"><span class="koboSpan" id="kobo.895.1">Close</span></strong><span class="koboSpan" id="kobo.896.1"> button if you see the </span><strong class="bold"><span class="koboSpan" id="kobo.897.1">Welcome to AWS CloudShell</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.898.1">pop-up window.</span></span></p></li>
</ol>
<ol>
<li value="7"><span class="koboSpan" id="kobo.899.1">Set the </span><strong class="source-inline"><span class="koboSpan" id="kobo.900.1">S3_BUCKET</span></strong><span class="koboSpan" id="kobo.901.1"> variable value to the name of the S3 bucket we </span><span class="No-Break"><span class="koboSpan" id="kobo.902.1">created earlier:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.903.1">S3_BUCKET=&lt;INSERT S3 BUCKET NAME&gt;</span></strong></pre><p class="list-inset"><span class="koboSpan" id="kobo.904.1">Make sure you replace</span><a id="_idIndexMarker162"/><span class="koboSpan" id="kobo.905.1"> the value of </span><strong class="source-inline"><span class="koboSpan" id="kobo.906.1">&lt;INSERT S3 BUCKET NAME&gt;</span></strong><span class="koboSpan" id="kobo.907.1"> with the name of the S3 bucket</span><a id="_idIndexMarker163"/><span class="koboSpan" id="kobo.908.1"> we </span><span class="No-Break"><span class="koboSpan" id="kobo.909.1">created earlier.</span></span></p></li> <li><span class="koboSpan" id="kobo.910.1">List the contents of the S3 bucket using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.911.1">aws s3 ls</span></strong><span class="koboSpan" id="kobo.912.1"> command with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.913.1">--no-sign-request</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.914.1">flag enabled:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.915.1">aws s3 ls s3://$S3_BUCKET --no-sign-request</span></strong></pre><p class="list-inset"><span class="koboSpan" id="kobo.916.1">This should yield an error message stating </span><strong class="source-inline"><span class="koboSpan" id="kobo.917.1">An error occurred (AccessDenied) when calling the ListObjectsV2 operation: </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.918.1">Access Denied</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.919.1">.</span></span></p></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.920.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.921.1">Using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.922.1">--no-sign-request</span></strong><span class="koboSpan" id="kobo.923.1"> flag with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.924.1">aws s3 ls</span></strong><span class="koboSpan" id="kobo.925.1"> command disables the requirement for AWS request signing. </span><span class="koboSpan" id="kobo.925.2">By default, AWS CLI requests are signed with AWS credentials to ensure authentication and authorization. </span><span class="koboSpan" id="kobo.925.3">However, when </span><strong class="source-inline"><span class="koboSpan" id="kobo.926.1">--no-sign-request</span></strong><span class="koboSpan" id="kobo.927.1"> is used, the command skips the signing process and allows unauthenticated and unsigned requests to be made to list the objects or files in the specified </span><span class="No-Break"><span class="koboSpan" id="kobo.928.1">S3 bucket.</span></span></p>
<ol>
<li value="9"><span class="koboSpan" id="kobo.929.1">List the contents of the S3 bucket using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.930.1">aws s3 ls</span></strong><span class="koboSpan" id="kobo.931.1"> command, this time without the </span><strong class="source-inline"><span class="koboSpan" id="kobo.932.1">--</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.933.1">no-sign-request</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.934.1"> flag:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.935.1">aws s3 ls s3://$S3_BUCKET</span></strong></pre><p class="list-inset"><span class="koboSpan" id="kobo.936.1">This should successfully return the contents of the bucket (that is, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.937.1">index.html</span></strong><span class="koboSpan" id="kobo.938.1"> file, along with the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.939.1">backup</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.940.1"> folder).</span></span></p></li> <li><span class="koboSpan" id="kobo.941.1">Let’s check whether we can download the </span><strong class="source-inline"><span class="koboSpan" id="kobo.942.1">index.html</span></strong><span class="koboSpan" id="kobo.943.1"> file from the S3 bucket to the </span><span class="No-Break"><span class="koboSpan" id="kobo.944.1">CloudShell environment:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.945.1">aws s3 cp s3://$S3_BUCKET/index.html .</span></strong></pre><p class="list-inset"><span class="koboSpan" id="kobo.946.1">This should log a message similar to </span><span class="No-Break"><span class="koboSpan" id="kobo.947.1">the following:</span></span></p><pre class="source-code"><span class="koboSpan" id="kobo.948.1">download: s3://&lt;S3 BUCKET&gt;/index.html to ./index.html</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.949.1">This means that we</span><a id="_idIndexMarker164"/><span class="koboSpan" id="kobo.950.1"> can list and download files as an </span><span class="No-Break"><span class="koboSpan" id="kobo.951.1">authenticated</span></span><span class="No-Break"><a id="_idIndexMarker165"/></span><span class="No-Break"><span class="koboSpan" id="kobo.952.1"> user!</span></span></p></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.953.1">Important note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.954.1">Take note that this is </span><em class="italic"><span class="koboSpan" id="kobo.955.1">not</span></em><span class="koboSpan" id="kobo.956.1"> the same account we used to create the bucket. </span><span class="koboSpan" id="kobo.956.2">Of course, since we intentionally configured the S3 bucket to have this behavior, this should not be </span><span class="No-Break"><span class="koboSpan" id="kobo.957.1">a surprise.</span></span></p>
<ol>
<li value="11"><span class="koboSpan" id="kobo.958.1">Next, let’s check whether we can upload a sample file from the CloudShell environment to the </span><span class="No-Break"><span class="koboSpan" id="kobo.959.1">S3 bucket:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.960.1">
touch </span><strong class="bold"><span class="koboSpan" id="kobo.961.1">test.txt</span></strong><span class="koboSpan" id="kobo.962.1">
aws s3 cp </span><strong class="bold"><span class="koboSpan" id="kobo.963.1">test.txt</span></strong><span class="koboSpan" id="kobo.964.1"> s3://$S3_BUCKET/test.txt</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.965.1">This should return a message similar to </span><span class="No-Break"><span class="koboSpan" id="kobo.966.1">the following:</span></span></p><pre class="source-code"><strong class="bold"><span class="koboSpan" id="kobo.967.1">upload failed</span></strong><span class="koboSpan" id="kobo.968.1">: ./test.txt to s3://&lt;S3 BUCKET&gt;/test.txt An error occurred (AccessDenied) when calling the PutObject operation: Access Denied</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.969.1">This means that we cannot</span><a id="_idIndexMarker166"/><span class="koboSpan" id="kobo.970.1"> upload files to the S3 bucket as an </span><span class="No-Break"><span class="koboSpan" id="kobo.971.1">authenticated</span></span><span class="No-Break"><a id="_idIndexMarker167"/></span><span class="No-Break"><span class="koboSpan" id="kobo.972.1"> user.</span></span></p></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.973.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.974.1">Note that attackers may also check whether they can retrieve and set the ACL of the bucket by using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.975.1">aws s3api get-bucket-acl</span></strong><span class="koboSpan" id="kobo.976.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.977.1">aws s3api put-bucket-acl</span></strong><span class="koboSpan" id="kobo.978.1"> commands. </span><span class="koboSpan" id="kobo.978.2">For more</span><a id="_idIndexMarker168"/><span class="koboSpan" id="kobo.979.1"> information about</span><a id="_idIndexMarker169"/><span class="koboSpan" id="kobo.980.1"> this topic, feel free to check out </span><a href="https://bit.ly/3mbwlb5"><span class="koboSpan" id="kobo.981.1">https://bit.ly/3mbwlb5</span></a> <span class="No-Break"><span class="koboSpan" id="kobo.982.1">and </span></span><a href="https://bit.ly/3SAPq2o"><span class="No-Break"><span class="koboSpan" id="kobo.983.1">https://bit.ly/3SAPq2o</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.984.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.985.1">It is important to note that we intentionally configured the S3 bucket to allow read-only access to authenticated users since we do not want other authenticated users to upload files to our </span><span class="No-Break"><span class="koboSpan" id="kobo.986.1">S3 bucket.</span></span></p>
<h2 id="_idParaDest-34"><a id="_idTextAnchor033"/><span class="koboSpan" id="kobo.987.1">Downloading and inspecting the files stored in the S3 bucket</span></h2>
<p><span class="koboSpan" id="kobo.988.1">In the previous section, we confirmed</span><a id="_idIndexMarker170"/><span class="koboSpan" id="kobo.989.1"> that we can download</span><a id="_idIndexMarker171"/><span class="koboSpan" id="kobo.990.1"> files from the S3 bucket as an authenticated user using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.991.1">aws s3 cp</span></strong><span class="koboSpan" id="kobo.992.1"> command. </span><span class="koboSpan" id="kobo.992.2">In this section, we’ll proceed with downloading and inspecting all the files stored in the vulnerable </span><span class="No-Break"><span class="koboSpan" id="kobo.993.1">S3 bucket:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.994.1">Let’s start by using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.995.1">mkdir</span></strong><span class="koboSpan" id="kobo.996.1"> command to create the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.997.1">downloaded</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.998.1"> directory:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.999.1">mkdir downloaded</span></strong></pre></li> <li><span class="koboSpan" id="kobo.1000.1">Next, navigate to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1001.1">downloaded</span></strong><span class="koboSpan" id="kobo.1002.1"> directory using the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1003.1">cd</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1004.1"> command:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1005.1">cd downloaded</span></strong></pre></li> <li><span class="koboSpan" id="kobo.1006.1">Use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1007.1">aws s3 cp</span></strong><span class="koboSpan" id="kobo.1008.1"> command to download all the files stored in the target S3 bucket to the CloudShell </span><span class="No-Break"><span class="koboSpan" id="kobo.1009.1">local directory:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1010.1">aws s3 cp --recursive s3://$S3_BUCKET .</span></strong></pre><p class="list-inset"><span class="koboSpan" id="kobo.1011.1">Here, we used the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1012.1">--recursive</span></strong><span class="koboSpan" id="kobo.1013.1"> flag to recursively download all the files stored in the </span><span class="No-Break"><span class="koboSpan" id="kobo.1014.1">S3 bucket:</span></span></p> <div>
<div class="IMG---Figure" id="_idContainer043">
<span class="koboSpan" id="kobo.1015.1"><img alt="" src="image/B19755_02_30.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1016.1">Figure 2.30 – Logs generated after executing the aws s3 cp command</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.1017.1">Here, we’re using a different AWS account </span><a id="_idIndexMarker172"/><span class="koboSpan" id="kobo.1018.1">to download the files stored</span><a id="_idIndexMarker173"/><span class="koboSpan" id="kobo.1019.1"> inside the S3 bucket. </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.1020.1">Scary, right?</span></em></span></p></li>
</ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.1021.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.1022.1">What this means is that </span><em class="italic"><span class="koboSpan" id="kobo.1023.1">any</span></em><span class="koboSpan" id="kobo.1024.1"> user with an AWS account, hypothetically including unauthorized users, could potentially access and download the files stored in the S3 bucket. </span><span class="koboSpan" id="kobo.1024.2">Here, we demonstrated that we can download the contents of the misconfigured bucket with just a few commands using a different and completely unrelated </span><span class="No-Break"><span class="koboSpan" id="kobo.1025.1">AWS account.</span></span></p>
<ol>
<li value="4"><span class="koboSpan" id="kobo.1026.1">Now, let’s use the following command to install the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1027.1">tree</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1028.1"> command:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1029.1">sudo yum install tree -y</span></strong></pre></li> <li><span class="koboSpan" id="kobo.1030.1">With the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1031.1">tree</span></strong><span class="koboSpan" id="kobo.1032.1"> command installed, let’s use it to generate a file tree of the </span><span class="No-Break"><span class="koboSpan" id="kobo.1033.1">current directory:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1034.1">tree</span></strong></pre><p class="list-inset"><span class="koboSpan" id="kobo.1035.1">This should generate and print a file tree similar to what we have in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.1036.1">Figure 2</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.1037.1">.31</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.1038.1">:</span></span></p> <div>
<div class="IMG---Figure" id="_idContainer044">
<span class="koboSpan" id="kobo.1039.1"><img alt="" src="image/B19755_02_31.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1040.1">Figure 2.31 – File tree generated using the tree command</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.1041.1">Using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1042.1">tree</span></strong><span class="koboSpan" id="kobo.1043.1"> command without </span><strong class="source-inline"><span class="koboSpan" id="kobo.1044.1">arguments/flags</span></strong><span class="koboSpan" id="kobo.1045.1"> would recursively list all files and give</span><a id="_idIndexMarker174"/><span class="koboSpan" id="kobo.1046.1"> us a very long list of files</span><a id="_idIndexMarker175"/> <span class="No-Break"><span class="koboSpan" id="kobo.1047.1">and directories.</span></span></p></li>
</ol>
<ol>
<li value="6"><span class="koboSpan" id="kobo.1048.1">Now, let’s run the following command to limit the results (the tree depth) and display the hidden files </span><span class="No-Break"><span class="koboSpan" id="kobo.1049.1">as well:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1050.1">tree -aL 4</span></strong></pre><p class="list-inset"><span class="koboSpan" id="kobo.1051.1">This should return a file tree similar to what we have in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.1052.1">Figure 2</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.1053.1">.32</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.1054.1">:</span></span></p> <div>
<div class="IMG---Figure" id="_idContainer045">
<span class="koboSpan" id="kobo.1055.1"><img alt="" src="image/B19755_02_32.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1056.1">Figure 2.32 – Results after running the tree command</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.1057.1">From the tree results shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.1058.1">Figure 2</span></em></span><em class="italic"><span class="koboSpan" id="kobo.1059.1">.32</span></em><span class="koboSpan" id="kobo.1060.1">, we can infer that the backend web framework</span><a id="_idIndexMarker176"/><span class="koboSpan" id="kobo.1061.1"> that’s being used is </span><strong class="bold"><span class="koboSpan" id="kobo.1062.1">Hapi.js</span></strong><span class="koboSpan" id="kobo.1063.1"> (</span><a href="https://hapi.dev/"><span class="koboSpan" id="kobo.1064.1">https://hapi.dev/</span></a><span class="koboSpan" id="kobo.1065.1">). </span><span class="koboSpan" id="kobo.1065.2">In addition to this, the </span><strong class="bold"><span class="koboSpan" id="kobo.1066.1">dotenv</span></strong> <strong class="source-inline"><span class="koboSpan" id="kobo.1067.1">npm</span></strong><span class="koboSpan" id="kobo.1068.1"> package is used to manage</span><a id="_idIndexMarker177"/><span class="koboSpan" id="kobo.1069.1"> and load environment variables. </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.1070.1">Figure 2</span></em></span><em class="italic"><span class="koboSpan" id="kobo.1071.1">.23</span></em><span class="koboSpan" id="kobo.1072.1"> also shows</span><a id="_idIndexMarker178"/><span class="koboSpan" id="kobo.1073.1"> that there’s a </span><strong class="source-inline"><span class="koboSpan" id="kobo.1074.1">.env</span></strong><span class="koboSpan" id="kobo.1075.1"> file stored</span><a id="_idIndexMarker179"/><span class="koboSpan" id="kobo.1076.1"> inside the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1077.1">/</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1078.1">backup/backend</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1079.1"> directory.</span></span></p></li>
</ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.1080.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.1081.1">To avoid hardcoding secrets, variables, and configuration settings inside the application code, development teams may utilize packages such as </span><strong class="source-inline"><span class="koboSpan" id="kobo.1082.1">dotenv</span></strong><span class="koboSpan" id="kobo.1083.1"> to load credentials and environment variables from </span><strong class="source-inline"><span class="koboSpan" id="kobo.1084.1">.env</span></strong><span class="koboSpan" id="kobo.1085.1"> files. </span><span class="koboSpan" id="kobo.1085.2">Alternatively, development and engineering teams may utilize YAML or JSON files as well. </span><span class="koboSpan" id="kobo.1085.3">One of the common mistakes developers make involves forgetting to exclude these in the code repository. </span><span class="koboSpan" id="kobo.1085.4">This means that anyone with access to the repository (or the backup of a repository) would be able to get a copy of the file containing the credentials and variables used in the application </span><span class="No-Break"><span class="koboSpan" id="kobo.1086.1">as well.</span></span></p>
<ol>
<li value="7"><span class="koboSpan" id="kobo.1087.1">Let’s run the following command to see what’s inside the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1088.1">.</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1089.1">env</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1090.1"> file:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1091.1">cat backup/backend/.env</span></strong></pre><p class="list-inset"><span class="koboSpan" id="kobo.1092.1">This should give us placeholder values for </span><strong class="source-inline"><span class="koboSpan" id="kobo.1093.1">AWS_ACCESS_KEY_ID</span></strong><span class="koboSpan" id="kobo.1094.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1095.1">AWS_SECRET_ACCESS_KEY</span></strong><span class="koboSpan" id="kobo.1096.1">, similar to what we have in the following </span><span class="No-Break"><span class="koboSpan" id="kobo.1097.1">configuration block:</span></span></p><pre class="source-code"><strong class="bold"><span class="koboSpan" id="kobo.1098.1">AWS_ACCESS_KEY_ID</span></strong><span class="koboSpan" id="kobo.1099.1">=XXXXXXXXXX
</span><strong class="bold"><span class="koboSpan" id="kobo.1100.1">AWS_SECRET_ACCESS_KEY</span></strong><span class="koboSpan" id="kobo.1101.1">=YYYYYYYYYY</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.1102.1">Note that in a more realistic</span><a id="_idIndexMarker180"/><span class="koboSpan" id="kobo.1103.1"> scenario, we might find other credentials and keys here as well. </span><span class="koboSpan" id="kobo.1103.2">It is also worth</span><a id="_idIndexMarker181"/><span class="koboSpan" id="kobo.1104.1"> noting that credentials may be found hardcoded inside the repository’s </span><span class="No-Break"><span class="koboSpan" id="kobo.1105.1">code base.</span></span></p></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.1106.1">Note</span></p>
<p class="callout"><em class="italic"><span class="koboSpan" id="kobo.1107.1">What will an attacker do once these credentials have been obtained?</span></em><span class="koboSpan" id="kobo.1108.1"> The attacker can now perform malicious actions using the accounts associated with these credentials. </span><span class="koboSpan" id="kobo.1108.2">For example, attackers</span><a id="_idIndexMarker182"/><span class="koboSpan" id="kobo.1109.1"> may use the credentials of an email service (for example, </span><strong class="bold"><span class="koboSpan" id="kobo.1110.1">SendGrid</span></strong><span class="koboSpan" id="kobo.1111.1">) to send phishing emails to attack other individuals or organizations. </span><span class="koboSpan" id="kobo.1111.2">Attackers may also be able to access databases after getting access to the </span><em class="italic"><span class="koboSpan" id="kobo.1112.1">.env</span></em><span class="koboSpan" id="kobo.1113.1">, </span><em class="italic"><span class="koboSpan" id="kobo.1114.1">YAML</span></em><span class="koboSpan" id="kobo.1115.1">, or </span><em class="italic"><span class="koboSpan" id="kobo.1116.1">JSON</span></em><span class="koboSpan" id="kobo.1117.1"> files since these files will most likely contain database credentials </span><span class="No-Break"><span class="koboSpan" id="kobo.1118.1">as well.</span></span></p>
<p><span class="koboSpan" id="kobo.1119.1">At this point, we should have a good idea </span><a id="_idIndexMarker183"/><span class="koboSpan" id="kobo.1120.1">of how to prepare and test</span><a id="_idIndexMarker184"/><span class="koboSpan" id="kobo.1121.1"> a relatively simple vulnerable cloud resource. </span><span class="koboSpan" id="kobo.1121.2">Of course, production environments would most likely have other resources deployed in the same account. </span><span class="koboSpan" id="kobo.1121.3">Do not worry – we’ll see the complexity of our vulnerable cloud environments grow as we work on the hands-on examples of the </span><span class="No-Break"><span class="koboSpan" id="kobo.1122.1">succeeding chapters.</span></span></p>
<h1 id="_idParaDest-35"><a id="_idTextAnchor034"/><span class="koboSpan" id="kobo.1123.1">Cleaning up</span></h1>
<p><span class="koboSpan" id="kobo.1124.1">Cleaning up the cloud resources</span><a id="_idIndexMarker185"/><span class="koboSpan" id="kobo.1125.1"> we created or deployed is a crucial step when working with vulnerable cloud applications and environments. </span><span class="koboSpan" id="kobo.1125.2">If we don’t clean up the resources we created right away, we might end up having our resources attacked by malicious users. </span><span class="koboSpan" id="kobo.1125.3">That said, let’s proceed with deleting the resources we created in </span><span class="No-Break"><span class="koboSpan" id="kobo.1126.1">this chapter:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.1127.1">Let’s start by logging in to the AWS Management Console using the account we used to create the S3 bucket. </span><span class="koboSpan" id="kobo.1127.2">Remember that we have two accounts – the “target” AWS account and the “attacker” AWS account. </span><span class="koboSpan" id="kobo.1127.3">We’ll proceed with signing in to the “target” AWS account as we used that account to create the </span><span class="No-Break"><span class="koboSpan" id="kobo.1128.1">S3 bucket.</span></span></li>
<li><span class="koboSpan" id="kobo.1129.1">Type </span><strong class="source-inline"><span class="koboSpan" id="kobo.1130.1">shell</span></strong><span class="koboSpan" id="kobo.1131.1"> in the search bar and select </span><strong class="bold"><span class="koboSpan" id="kobo.1132.1">CloudShell</span></strong><span class="koboSpan" id="kobo.1133.1"> from the list of results, as shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.1134.1">Figure 2</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.1135.1">.33</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.1136.1">:</span></span>
<div>
<div class="IMG---Figure" id="_idContainer046">
<span class="koboSpan" id="kobo.1137.1"><img alt="" src="image/B19755_02_33.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1138.1">Figure 2.33 – Navigating to the CloudShell console</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.1139.1">Click the </span><strong class="bold"><span class="koboSpan" id="kobo.1140.1">Close</span></strong><span class="koboSpan" id="kobo.1141.1"> button when you see the </span><strong class="bold"><span class="koboSpan" id="kobo.1142.1">Welcome to AWS CloudShell</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.1143.1">pop-up window.</span></span></p></li>
</ol>
<ol>
<li value="3"><span class="koboSpan" id="kobo.1144.1">In the terminal of our CloudShell </span><a id="_idIndexMarker186"/><span class="koboSpan" id="kobo.1145.1">environment (right after the </span><strong class="bold"><span class="koboSpan" id="kobo.1146.1">$</span></strong><span class="koboSpan" id="kobo.1147.1"> sign), run the following </span><span class="No-Break"><span class="koboSpan" id="kobo.1148.1">bash command:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1149.1">S3_BUCKET=&lt;INSERT S3 BUCKET NAME&gt;</span></strong></pre><p class="list-inset"><span class="koboSpan" id="kobo.1150.1">Here, we are setting the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1151.1">S3_BUCKET</span></strong><span class="koboSpan" id="kobo.1152.1"> variable’s value with the name of the S3 bucket we created earlier. </span><span class="koboSpan" id="kobo.1152.2">Make sure you replace the value of </span><strong class="source-inline"><span class="koboSpan" id="kobo.1153.1">&lt;INSERT S3 BUCKET NAME&gt;</span></strong><span class="koboSpan" id="kobo.1154.1"> with the name of your </span><span class="No-Break"><span class="koboSpan" id="kobo.1155.1">S3 bucket.</span></span></p></li> <li><span class="koboSpan" id="kobo.1156.1">Now, let’s use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1157.1">aws s3 rb</span></strong><span class="koboSpan" id="kobo.1158.1"> (remove bucket) command to delete the bucket, along with all the objects </span><span class="No-Break"><span class="koboSpan" id="kobo.1159.1">inside it:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1160.1">aws s3 rb s3://$S3_BUCKET --force</span></strong></pre><p class="list-inset"><span class="koboSpan" id="kobo.1161.1">This should yield a set of logs, similar to what we have in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.1162.1">Figure 2</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.1163.1">.34</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.1164.1">:</span></span></p> <div>
<div class="IMG---Figure" id="_idContainer047">
<span class="koboSpan" id="kobo.1165.1"><img alt="" src="image/B19755_02_34.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1166.1">Figure 2.34 – Logs generated after running the aws s3 rb command</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.1167.1">The command we executed will delete all the objects inside the bucket and then delete the S3 bucket once </span><span class="No-Break"><span class="koboSpan" id="kobo.1168.1">it’s empty.</span></span></p></li>
</ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.1169.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.1170.1">Note that we should be careful when using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1171.1">aws s3 rb</span></strong><span class="koboSpan" id="kobo.1172.1"> command in production since we will lose all files inside the bucket when object versioning is disabled. </span><span class="koboSpan" id="kobo.1172.2">We must have a backup of the files stored inside the bucket before running this command. </span><span class="koboSpan" id="kobo.1172.3">Feel free to check out</span><a id="_idIndexMarker187"/><span class="koboSpan" id="kobo.1173.1"> the following link for more </span><span class="No-Break"><span class="koboSpan" id="kobo.1174.1">details: </span></span><a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/delete-bucket.html"><span class="No-Break"><span class="koboSpan" id="kobo.1175.1">https://docs.aws.amazon.com/AmazonS3/latest/userguide/delete-bucket.html</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.1176.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.1177.1">That’s pretty much it! </span><span class="koboSpan" id="kobo.1177.2">Since</span><a id="_idIndexMarker188"/><span class="koboSpan" id="kobo.1178.1"> we’re only dealing with a relatively simple setup, the cleanup process is expected to </span><span class="No-Break"><span class="koboSpan" id="kobo.1179.1">be straightforward.</span></span></p>
<h1 id="_idParaDest-36"><a id="_idTextAnchor035"/><span class="koboSpan" id="kobo.1180.1">Summary</span></h1>
<p><span class="koboSpan" id="kobo.1181.1">In this chapter, we designed and prepared our first intentionally vulnerable lab environment in the cloud. </span><span class="koboSpan" id="kobo.1181.2">We started by creating an empty S3 bucket using the AWS Management Console. </span><span class="koboSpan" id="kobo.1181.3">After that, we configured the bucket for static website hosting. </span><span class="koboSpan" id="kobo.1181.4">We also modified the access control settings of the S3 bucket and allowed other authenticated AWS users to list and retrieve objects from our bucket. </span><span class="koboSpan" id="kobo.1181.5">To complete the setup, we uploaded sample files to our </span><span class="No-Break"><span class="koboSpan" id="kobo.1182.1">S3 bucket.</span></span></p>
<p><span class="koboSpan" id="kobo.1183.1">We proceeded by testing our setup by inspecting and verifying the S3 bucket’s security configuration using a series of steps, which included several terminal commands. </span><span class="koboSpan" id="kobo.1183.2">After confirming that we could download files from the S3 bucket using a second AWS account (not used to create the bucket), we proceeded with downloading and inspecting all the files stored in the bucket. </span><span class="koboSpan" id="kobo.1183.3">Finally, we wrapped things up by cleaning up and deleting the resources we created in </span><span class="No-Break"><span class="koboSpan" id="kobo.1184.1">this chapter.</span></span></p>
<p><span class="koboSpan" id="kobo.1185.1">In the next chapter, we will focus on how to use </span><strong class="bold"><span class="koboSpan" id="kobo.1186.1">Infrastructure as Code</span></strong><span class="koboSpan" id="kobo.1187.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.1188.1">IaC</span></strong><span class="koboSpan" id="kobo.1189.1">) tools and strategies to help us build and manage complex vulnerable lab environments in the cloud. </span><span class="koboSpan" id="kobo.1189.2">If you’re wondering whether or not we can automate the steps we have performed in this chapter, then the next chapter is </span><span class="No-Break"><span class="koboSpan" id="kobo.1190.1">for you!</span></span></p>
<h1 id="_idParaDest-37"><a id="_idTextAnchor036"/><span class="koboSpan" id="kobo.1191.1">Further reading</span></h1>
<p><span class="koboSpan" id="kobo.1192.1">For more information on the topics covered in this chapter, feel free to check out the </span><span class="No-Break"><span class="koboSpan" id="kobo.1193.1">following resources:</span></span></p>
<ul>
<li><em class="italic"><span class="koboSpan" id="kobo.1194.1">IAM Policies and Bucket Policies and </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.1195.1">ACLs</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.1196.1"> (</span></span><a href="https://aws.amazon.com/blogs/security/iam-policies-and-bucket-policies-and-acls-oh-my-controlling-access-to-s3-resources/"><span class="No-Break"><span class="koboSpan" id="kobo.1197.1">https://aws.amazon.com/blogs/security/iam-policies-and-bucket-policies-and-acls-oh-my-controlling-access-to-s3-resources/</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.1198.1">)</span></span></li>
<li><em class="italic"><span class="koboSpan" id="kobo.1199.1">S3 – Managing access with </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.1200.1">ACLs</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.1201.1"> (</span></span><a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/acls.html"><span class="No-Break"><span class="koboSpan" id="kobo.1202.1">https://docs.aws.amazon.com/AmazonS3/latest/userguide/acls.html</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.1203.1">)</span></span></li>
<li><em class="italic"><span class="koboSpan" id="kobo.1204.1">Heads-Up: Amazon S3 Security Changes Are Coming in April of </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.1205.1">2023</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.1206.1"> (</span></span><a href="https://aws.amazon.com/blogs/aws/heads-up-amazon-s3-security-changes-are-coming-in-april-of-2023/"><span class="No-Break"><span class="koboSpan" id="kobo.1207.1">https://aws.amazon.com/blogs/aws/heads-up-amazon-s3-security-changes-are-coming-in-april-of-2023/</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.1208.1">)</span></span></li>
<li><em class="italic"><span class="koboSpan" id="kobo.1209.1">Controlling ownership of objects and disabling ACLs for your </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.1210.1">bucket</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.1211.1"> (</span></span><a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/about-object-ownership.html"><span class="No-Break"><span class="koboSpan" id="kobo.1212.1">https://docs.aws.amazon.com/AmazonS3/latest/userguide/about-object-ownership.html</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.1213.1">)</span></span></li>
<li><em class="italic"><span class="koboSpan" id="kobo.1214.1">Default settings for new S3 buckets </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.1215.1">FAQ</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.1216.1"> (</span></span><a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/create-bucket-faq.html"><span class="No-Break"><span class="koboSpan" id="kobo.1217.1">https://docs.aws.amazon.com/AmazonS3/latest/userguide/create-bucket-faq.html</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.1218.1">)</span></span></li>
</ul>
</div>
</body></html>