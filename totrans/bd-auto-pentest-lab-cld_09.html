<html><head></head><body>
<div id="_idContainer374">
<h1 class="chapter-number" id="_idParaDest-192"><a id="_idTextAnchor192"/><span class="koboSpan" id="kobo.1.1">9</span></h1>
<h1 id="_idParaDest-193"><a id="_idTextAnchor193"/><span class="koboSpan" id="kobo.2.1">Recommended Strategies and Best Practices</span></h1>
<p><span class="koboSpan" id="kobo.3.1">Great job reaching the last chapter of this book! </span><span class="koboSpan" id="kobo.3.2">The last few chapters have been focused primarily on giving you the hands-on experience needed to help you build more complex penetration testing labs in the cloud. </span><span class="koboSpan" id="kobo.3.3">If you took the time to understand what’s happening in the hands-on examples and solutions in this book, then you should be a bit more confident about what you can accomplish with your current knowledge and skills. </span><span class="koboSpan" id="kobo.3.4">In this chapter, we will build on top of what you learned in the previous chapters, and we will explore how we can take things to the </span><span class="No-Break"><span class="koboSpan" id="kobo.4.1">next level!</span></span></p>
<p><span class="koboSpan" id="kobo.5.1">We will cover the following in </span><span class="No-Break"><span class="koboSpan" id="kobo.6.1">this chapter:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.7.1">Increasing the complexity of penetration testing </span><span class="No-Break"><span class="koboSpan" id="kobo.8.1">lab environments</span></span></li>
<li><span class="koboSpan" id="kobo.9.1">Leveraging Generative AI for estimating penetration testing </span><span class="No-Break"><span class="koboSpan" id="kobo.10.1">lab costs</span></span></li>
<li><span class="koboSpan" id="kobo.11.1">Unleashing the power of AI-powered tools to accelerate automation </span><span class="No-Break"><span class="koboSpan" id="kobo.12.1">script development</span></span></li>
<li><span class="koboSpan" id="kobo.13.1">Using AI-powered solutions to generate and explain IaC </span><span class="No-Break"><span class="koboSpan" id="kobo.14.1">template code</span></span></li>
<li><span class="koboSpan" id="kobo.15.1">Recognizing relevant considerations and practical strategies when building and automating </span><span class="No-Break"><span class="koboSpan" id="kobo.16.1">lab environments</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.17.1">With these in mind, </span><span class="No-Break"><span class="koboSpan" id="kobo.18.1">let’s begin!</span></span></p>
<h1 id="_idParaDest-194"><a id="_idTextAnchor194"/><span class="koboSpan" id="kobo.19.1">Technical requirements</span></h1>
<p><span class="koboSpan" id="kobo.20.1">Before we start, you must have the </span><span class="No-Break"><span class="koboSpan" id="kobo.21.1">following ready:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.22.1">Visual Studio Code</span></strong><span class="koboSpan" id="kobo.23.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.24.1">VS Code</span></strong><span class="koboSpan" id="kobo.25.1">) installed</span><a id="_idIndexMarker1282"/><span class="koboSpan" id="kobo.26.1"> and set up on your </span><span class="No-Break"><span class="koboSpan" id="kobo.27.1">local machine</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.28.1">GitHub Copilot</span></strong><span class="koboSpan" id="kobo.29.1"> set </span><a id="_idIndexMarker1283"/><span class="koboSpan" id="kobo.30.1">up and configured with VS Code – sign up for a free trial </span><a id="_idIndexMarker1284"/><span class="koboSpan" id="kobo.31.1">subscription (</span><strong class="bold"><span class="koboSpan" id="kobo.32.1">Copilot for Individuals</span></strong><span class="koboSpan" id="kobo.33.1">) using the following link: </span><a href="https://github.com/features/copilot"><span class="koboSpan" id="kobo.34.1">https://github.com/features/copilot</span></a><span class="koboSpan" id="kobo.35.1">. </span><span class="koboSpan" id="kobo.35.2">Make sure that the </span><strong class="bold"><span class="koboSpan" id="kobo.36.1">GitHub Copilot extension</span></strong><span class="koboSpan" id="kobo.37.1"> is installed and set up completely. </span><span class="koboSpan" id="kobo.37.2">You may check the</span><a id="_idIndexMarker1285"/><span class="koboSpan" id="kobo.38.1"> following link for more </span><span class="No-Break"><span class="koboSpan" id="kobo.39.1">information: </span></span><a href="https://docs.github.com/en/copilot/getting-started-with-github-copilot?tool=vscode"><span class="No-Break"><span class="koboSpan" id="kobo.40.1">https://docs.github.com/en/copilot/getting-started-with-github-copilot?tool=vscode</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.41.1">.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.42.1">GitHub Copilot Labs</span></strong><span class="koboSpan" id="kobo.43.1"> set </span><a id="_idIndexMarker1286"/><span class="koboSpan" id="kobo.44.1">up and configured with VS Code – sign up using the following link: </span><a href="https://githubnext.com/projects/copilot-labs/"><span class="koboSpan" id="kobo.45.1">https://githubnext.com/projects/copilot-labs/</span></a><span class="koboSpan" id="kobo.46.1">. </span><span class="koboSpan" id="kobo.46.2">Make sure that the </span><strong class="bold"><span class="koboSpan" id="kobo.47.1">GitHub Copilot Labs extension</span></strong><span class="koboSpan" id="kobo.48.1"> is installed and set up completely. </span><span class="koboSpan" id="kobo.48.2">You may check the following link for more </span><span class="No-Break"><span class="koboSpan" id="kobo.49.1">information: </span></span><a href="https://marketplace.visualstudio.com/items?itemName=GitHub.copilot-labs"><span class="No-Break"><span class="koboSpan" id="kobo.50.1">https://marketplace.visualstudio.com/items?itemName=GitHub.copilot-labs</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.51.1">.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.52.1">Amazon CodeWhisperer</span></strong><span class="koboSpan" id="kobo.53.1"> set </span><a id="_idIndexMarker1287"/><span class="koboSpan" id="kobo.54.1">up and configured with VS Code – we will be</span><a id="_idIndexMarker1288"/><span class="koboSpan" id="kobo.55.1"> utilizing </span><strong class="bold"><span class="koboSpan" id="kobo.56.1">CodeWhisperer Professional</span></strong><span class="koboSpan" id="kobo.57.1"> for a single user (</span><a href="https://aws.amazon.com/codewhisperer/pricing/"><span class="koboSpan" id="kobo.58.1">https://aws.amazon.com/codewhisperer/pricing/</span></a><span class="koboSpan" id="kobo.59.1">). </span><span class="koboSpan" id="kobo.59.2">Before we install and set up the CodeWhisperer</span><a id="_idIndexMarker1289"/><span class="koboSpan" id="kobo.60.1"> extension in VS Code, we need to (1) enable </span><strong class="bold"><span class="koboSpan" id="kobo.61.1">IAM Identity Center</span></strong><span class="koboSpan" id="kobo.62.1"> and</span><a id="_idIndexMarker1290"/><span class="koboSpan" id="kobo.63.1"> create an </span><strong class="bold"><span class="koboSpan" id="kobo.64.1">AWS organization</span></strong><span class="koboSpan" id="kobo.65.1">, (2) create </span><a id="_idIndexMarker1291"/><span class="koboSpan" id="kobo.66.1">an </span><strong class="bold"><span class="koboSpan" id="kobo.67.1">IAM organization user</span></strong><span class="koboSpan" id="kobo.68.1">, (3) set up CodeWhisperer for a single user, and (4) set up the </span><strong class="bold"><span class="koboSpan" id="kobo.69.1">AWS Toolkit</span></strong><span class="koboSpan" id="kobo.70.1"> for</span><a id="_idIndexMarker1292"/><span class="koboSpan" id="kobo.71.1"> VS Code (</span><a href="https://aws.amazon.com/visualstudiocode/"><span class="koboSpan" id="kobo.72.1">https://aws.amazon.com/visualstudiocode/</span></a><span class="koboSpan" id="kobo.73.1">). </span><span class="koboSpan" id="kobo.73.2">Make sure that the </span><strong class="bold"><span class="koboSpan" id="kobo.74.1">CodeWhisperer extension</span></strong><span class="koboSpan" id="kobo.75.1"> is installed and set up completely. </span><span class="koboSpan" id="kobo.75.2">You may check the following link for more </span><span class="No-Break"><span class="koboSpan" id="kobo.76.1">information: </span></span><a href="https://docs.aws.amazon.com/codewhisperer/latest/userguide/whisper-setup-prof-devs.html"><span class="No-Break"><span class="koboSpan" id="kobo.77.1">https://docs.aws.amazon.com/codewhisperer/latest/userguide/whisper-setup-prof-devs.html</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.78.1">.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.79.1">Tabnine Pro</span></strong><span class="koboSpan" id="kobo.80.1"> set up </span><a id="_idIndexMarker1293"/><span class="koboSpan" id="kobo.81.1">and configured with VS Code – sign up for a free trial subscription (</span><strong class="bold"><span class="koboSpan" id="kobo.82.1">Pro</span></strong><span class="koboSpan" id="kobo.83.1">) using the following link: </span><a href="https://www.tabnine.com/pricing"><span class="koboSpan" id="kobo.84.1">https://www.tabnine.com/pricing</span></a><span class="koboSpan" id="kobo.85.1">. </span><span class="koboSpan" id="kobo.85.2">Make sure that </span><a id="_idIndexMarker1294"/><span class="koboSpan" id="kobo.86.1">the </span><strong class="bold"><span class="koboSpan" id="kobo.87.1">Tabnine extension</span></strong><span class="koboSpan" id="kobo.88.1"> is installed and set up completely. </span><span class="koboSpan" id="kobo.88.2">You may check the following link for more </span><span class="No-Break"><span class="koboSpan" id="kobo.89.1">information: </span></span><a href="https://www.tabnine.com/install/vscode"><span class="No-Break"><span class="koboSpan" id="kobo.90.1">https://www.tabnine.com/install/vscode</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.91.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.92.1">A </span><strong class="bold"><span class="koboSpan" id="kobo.93.1">ChatGPT Plus</span></strong><span class="koboSpan" id="kobo.94.1"> account – sign up for </span><a id="_idIndexMarker1295"/><span class="koboSpan" id="kobo.95.1">an account using the following link: </span><a href="https://chat.openai.com/auth/login"><span class="koboSpan" id="kobo.96.1">https://chat.openai.com/auth/login</span></a><span class="koboSpan" id="kobo.97.1">. </span><span class="koboSpan" id="kobo.97.2">Since we will be using the </span><strong class="bold"><span class="koboSpan" id="kobo.98.1">Advanced Data Analysis</span></strong><span class="koboSpan" id="kobo.99.1"> feature</span><a id="_idIndexMarker1296"/><span class="koboSpan" id="kobo.100.1"> in this chapter, we would need to upgrade our plan to </span><strong class="bold"><span class="koboSpan" id="kobo.101.1">ChatGPT Plus</span></strong><span class="koboSpan" id="kobo.102.1"> so that we can access GPT-4 along with other beta features exclusively available to ChatGPT </span><span class="No-Break"><span class="koboSpan" id="kobo.103.1">Plus users.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.104.1">You may proceed with the next steps once these are ready. </span><span class="koboSpan" id="kobo.104.2">If you don’t intend to commit to these subscriptions long term, feel free to unsubscribe or downgrade your current plan for each of these subscriptions after completing the hands-on examples in </span><span class="No-Break"><span class="koboSpan" id="kobo.105.1">this chapter.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.106.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.107.1">To avoid any conflict that may arise with the newly added extensions, you can temporarily disable all currently installed extensions in VS Code. </span><em class="italic"><span class="koboSpan" id="kobo.108.1">How?</span></em><span class="koboSpan" id="kobo.109.1"> Click on the </span><strong class="bold"><span class="koboSpan" id="kobo.110.1">Extensions</span></strong><span class="koboSpan" id="kobo.111.1"> icon in the sidebar on the left side of the VS Code window. </span><span class="koboSpan" id="kobo.111.2">In the </span><strong class="bold"><span class="koboSpan" id="kobo.112.1">Extensions</span></strong><span class="koboSpan" id="kobo.113.1"> view, click the three dots (</span><strong class="bold"><span class="koboSpan" id="kobo.114.1">···</span></strong><span class="koboSpan" id="kobo.115.1">) button and select </span><strong class="bold"><span class="koboSpan" id="kobo.116.1">Disable All Installed Extensions</span></strong><span class="koboSpan" id="kobo.117.1"> from the list of options available in the context menu. </span><span class="koboSpan" id="kobo.117.2">Do not worry as we can easily enable these extensions later on. </span><span class="koboSpan" id="kobo.117.3">For more information, feel free to check the following </span><span class="No-Break"><span class="koboSpan" id="kobo.118.1">link: </span></span><a href="https://code.visualstudio.com/docs/editor/extension-marketplace"><span class="No-Break"><span class="koboSpan" id="kobo.119.1">https://code.visualstudio.com/docs/editor/extension-marketplace</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.120.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.121.1">The source code and other files used for each chapter are available in this book’s GitHub </span><span class="No-Break"><span class="koboSpan" id="kobo.122.1">repository: </span></span><a href="https://github.com/PacktPublishing/Building-and-Automating-Penetration-Testing-Labs-in-the-Cloud"><span class="No-Break"><span class="koboSpan" id="kobo.123.1">https://github.com/PacktPublishing/Building-and-Automating-Penetration-Testing-Labs-in-the-Cloud</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.124.1">.</span></span></p>
<h1 id="_idParaDest-195"><a id="_idTextAnchor195"/><span class="koboSpan" id="kobo.125.1">Increasing the complexity of penetration testing lab environments</span></h1>
<p><span class="koboSpan" id="kobo.126.1">If you have been to a</span><a id="_idIndexMarker1297"/><span class="koboSpan" id="kobo.127.1"> bouldering (rock-climbing) gym before, you would realize how similar a penetration testing lab environment is to an indoor facility filled with climbing walls of varying difficulty. </span><span class="koboSpan" id="kobo.127.2">Just like how indoor rock-climbing gyms provide climbers with a controlled environment to exercise and practice their climbing skills, penetration testing labs provide cybersecurity professionals with an isolated environment to practice and perfect their hacking techniques. </span><span class="koboSpan" id="kobo.127.3">Both environments challenge users with various types of scenarios with increasing complexity and difficulty to push their limits. </span><span class="koboSpan" id="kobo.127.4">Given that these environments have been built to mimic real-world challenges and obstacles, we should expect these environments to evolve and grow in complexity so that users are presented with new challenges </span><span class="No-Break"><span class="koboSpan" id="kobo.128.1">to solve.</span></span></p>
<p><span class="koboSpan" id="kobo.129.1">In this section, we </span><a id="_idIndexMarker1298"/><span class="koboSpan" id="kobo.130.1">will discuss how we can further evolve and increase the complexity of the penetration testing lab environments we have built in the previous chapters of this book. </span><span class="koboSpan" id="kobo.130.2">Let’s start with the lab environment we have prepared in </span><span class="No-Break"><em class="italic"><a href="B19755_04.xhtml"><span class="koboSpan" id="kobo.131.1">Chapter 4</span></a></em></span><span class="koboSpan" id="kobo.132.1">, </span><em class="italic"><span class="koboSpan" id="kobo.133.1">Setting Up Isolated Penetration Testing Lab Environments </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.134.1">on GCP</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.135.1">.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer340">
<span class="koboSpan" id="kobo.136.1"><img alt="" src="image/B19755_09_01.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.137.1">Figure 9.1 – High-level diagram of our penetration testing lab environment in GCP</span></p>
<p><span class="koboSpan" id="kobo.138.1">In this lab setup, we have an isolated network for securing the lab environment resources from external attacks. </span><span class="koboSpan" id="kobo.138.2">This isolated network environment consists of two VPCs along with a VPC peering connection bridging these VPC networks. </span><span class="koboSpan" id="kobo.138.3">We have a single target VM instance deployed inside the first VPC while we have the attacker VM instance in the other VPC. </span><span class="koboSpan" id="kobo.138.4">Inside the target VM instance, we have a container running an intentionally vulnerable </span><a id="_idIndexMarker1299"/><span class="koboSpan" id="kobo.139.1">application called the </span><strong class="bold"><span class="koboSpan" id="kobo.140.1">OWASP Juice Shop</span></strong><span class="koboSpan" id="kobo.141.1">. </span><span class="koboSpan" id="kobo.141.2">While we had the opportunity to add more vulnerable services, applications, and containers inside the VM instance, we decided to keep things simple by having only a single running container to reduce the setup work required. </span><span class="koboSpan" id="kobo.141.3">In addition to this, we could have launched more VM instances inside the VPC as well. </span><em class="italic"><span class="koboSpan" id="kobo.142.1">What if we had more time (and more pages to spare) to set up a more complex </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.143.1">lab environment?</span></em></span></p>
<p><span class="koboSpan" id="kobo.144.1">Let’s imagine a</span><a id="_idIndexMarker1300"/><span class="koboSpan" id="kobo.145.1"> hypothetical lab environment (similar to what is shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.146.1">Figure 9</span></em></span><em class="italic"><span class="koboSpan" id="kobo.147.1">.2</span></em><span class="koboSpan" id="kobo.148.1">) consisting of various cloud resources running inside </span><a id="_idIndexMarker1301"/><span class="koboSpan" id="kobo.149.1">a </span><strong class="bold"><span class="koboSpan" id="kobo.150.1">Google Cloud Platform</span></strong><span class="koboSpan" id="kobo.151.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.152.1">GCP</span></strong><span class="koboSpan" id="kobo.153.1">) account. </span><span class="koboSpan" id="kobo.153.2">In this new lab environment, we have three VM instances running vulnerable services, applications, and containers inside them: (1) </span><strong class="source-inline"><span class="koboSpan" id="kobo.154.1">vm-target</span></strong><span class="koboSpan" id="kobo.155.1">, (2) </span><strong class="source-inline"><span class="koboSpan" id="kobo.156.1">vm-target-02</span></strong><span class="koboSpan" id="kobo.157.1">, and (</span><span class="No-Break"><span class="koboSpan" id="kobo.158.1">3) </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.159.1">vm-target-03</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.160.1">.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer341">
<span class="koboSpan" id="kobo.161.1"><img alt="" src="image/B19755_09_02.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.162.1">Figure 9.2 – A more complex version of the penetration testing lab environment</span></p>
<p><span class="koboSpan" id="kobo.163.1">The first target VM instance (</span><strong class="source-inline"><span class="koboSpan" id="kobo.164.1">vm-target</span></strong><span class="koboSpan" id="kobo.165.1">) is similar to the target VM instance we prepared in </span><span class="No-Break"><em class="italic"><a href="B19755_04.xhtml"><span class="koboSpan" id="kobo.166.1">Chapter 4</span></a></em></span><span class="koboSpan" id="kobo.167.1">, </span><em class="italic"><span class="koboSpan" id="kobo.168.1">Setting Up Isolated Penetration Testing Lab Environments on GCP</span></em><span class="koboSpan" id="kobo.169.1">. </span><span class="koboSpan" id="kobo.169.2">To make things a bit more exciting, we will also run a few more containers running vulnerable applications and services inside this instance (</span><strong class="source-inline"><span class="koboSpan" id="kobo.170.1">vm-target</span></strong><span class="koboSpan" id="kobo.171.1">). </span><span class="koboSpan" id="kobo.171.2">In addition to this, similar to what we set up in </span><span class="No-Break"><em class="italic"><a href="B19755_05.xhtml"><span class="koboSpan" id="kobo.172.1">Chapter 5</span></a></em></span><span class="koboSpan" id="kobo.173.1">, </span><em class="italic"><span class="koboSpan" id="kobo.174.1">Setting Up Isolated Penetration Testing Lab Environments on Azure</span></em><span class="koboSpan" id="kobo.175.1">, we can configure some of these containers to run with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.176.1">--privileged</span></strong><span class="koboSpan" id="kobo.177.1"> flag. </span><span class="koboSpan" id="kobo.177.2">This will allow lab users to practice container breakout techniques as well. </span><span class="koboSpan" id="kobo.177.3">The second target VM instance (</span><strong class="source-inline"><span class="koboSpan" id="kobo.178.1">vm-target-02</span></strong><span class="koboSpan" id="kobo.179.1">) is a new VM instance running a different operating system. </span><span class="koboSpan" id="kobo.179.2">This instance would be running various vulnerable services without any containers involved. </span><span class="koboSpan" id="kobo.179.3">We also have a third target VM instance (</span><strong class="source-inline"><span class="koboSpan" id="kobo.180.1">vm-target-03</span></strong><span class="koboSpan" id="kobo.181.1">) running a different set of vulnerable applications and services. </span><span class="koboSpan" id="kobo.181.2">The network configuration is configured to not allow direct access from the attacker VM instance to the third target VM instance (</span><strong class="source-inline"><span class="koboSpan" id="kobo.182.1">vm-target-03</span></strong><span class="koboSpan" id="kobo.183.1">). </span><span class="koboSpan" id="kobo.183.2">This will force lab users to compromise the second target VM instance (</span><strong class="source-inline"><span class="koboSpan" id="kobo.184.1">vm-target-02</span></strong><span class="koboSpan" id="kobo.185.1">) first and use that to access the third target VM instance (</span><strong class="source-inline"><span class="koboSpan" id="kobo.186.1">vm-target-03</span></strong><span class="koboSpan" id="kobo.187.1">) similar to the pivoting lab we set up in </span><span class="No-Break"><em class="italic"><a href="B19755_06.xhtml"><span class="koboSpan" id="kobo.188.1">Chapter 6</span></a></em></span><span class="koboSpan" id="kobo.189.1">, </span><em class="italic"><span class="koboSpan" id="kobo.190.1">Setting Up Isolated Penetration Testing Lab Environments on AWS</span></em><span class="koboSpan" id="kobo.191.1">. </span><span class="koboSpan" id="kobo.191.2">Finally, from the third target VM instance (</span><strong class="source-inline"><span class="koboSpan" id="kobo.192.1">vm-target-03</span></strong><span class="koboSpan" id="kobo.193.1">), a Cloud Storage bucket (with a flag) can be accessed through a </span><span class="No-Break"><span class="koboSpan" id="kobo.194.1">service account.</span></span></p>
<p><span class="koboSpan" id="kobo.195.1">To further</span><a id="_idIndexMarker1302"/><span class="koboSpan" id="kobo.196.1"> increase the complexity of the lab environment, we can replace the third target VM instance (</span><strong class="source-inline"><span class="koboSpan" id="kobo.197.1">vm-target-03</span></strong><span class="koboSpan" id="kobo.198.1">) with a vulnerable-by-design </span><strong class="bold"><span class="koboSpan" id="kobo.199.1">Kubernetes</span></strong><span class="koboSpan" id="kobo.200.1"> cluster environment similar to what we have in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.201.1">Figure 9</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.202.1">.3</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.203.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer342">
<span class="koboSpan" id="kobo.204.1"><img alt="" src="image/B19755_09_03.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.205.1">Figure 9.3 – Including a vulnerable-by-design cluster environment</span></p>
<p><span class="koboSpan" id="kobo.206.1">If this is</span><a id="_idIndexMarker1303"/><span class="koboSpan" id="kobo.207.1"> your first time learning about Kubernetes, it is a popular open source container orchestration system that provides a framework for running resilient distributed systems. </span><span class="koboSpan" id="kobo.207.2">By setting up this vulnerable-by-design Kubernetes cluster, users can gain hands-on experience with various attack scenarios inside an isolated environment. </span><span class="koboSpan" id="kobo.207.3">Inside this cluster, we would have multiple scenarios</span><a id="_idIndexMarker1304"/><span class="koboSpan" id="kobo.208.1"> involving misconfigurations, risks, and vulnerabilities discussed in the </span><strong class="bold"><span class="koboSpan" id="kobo.209.1">OWASP Kubernetes Top 10</span></strong><span class="koboSpan" id="kobo.210.1">. </span><span class="koboSpan" id="kobo.210.2">These scenarios may include overly permissive </span><strong class="bold"><span class="koboSpan" id="kobo.211.1">Role-Based Access Control</span></strong><span class="koboSpan" id="kobo.212.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.213.1">RBAC</span></strong><span class="koboSpan" id="kobo.214.1">) configurations, broken</span><a id="_idIndexMarker1305"/><span class="koboSpan" id="kobo.215.1"> authentication mechanisms, container breakouts due to insecure workload configurations, </span><span class="No-Break"><span class="koboSpan" id="kobo.216.1">and more.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.217.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.218.1">For more information about this topic, feel free to check the following </span><span class="No-Break"><span class="koboSpan" id="kobo.219.1">link: </span></span><a href="https://owasp.org/www-project-kubernetes-top-ten/"><span class="No-Break"><span class="koboSpan" id="kobo.220.1">https://owasp.org/www-project-kubernetes-top-ten/</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.221.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.222.1">Instead of a </span><a id="_idIndexMarker1306"/><span class="koboSpan" id="kobo.223.1">Kubernetes cluster, we could also introduce a </span><strong class="bold"><span class="koboSpan" id="kobo.224.1">Windows Active Directory</span></strong><span class="koboSpan" id="kobo.225.1"> setup similar to what is shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.226.1">Figure 9</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.227.1">.4</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.228.1">.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer343">
<span class="koboSpan" id="kobo.229.1"><img alt="" src="image/B19755_09_04.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.230.1">Figure 9.4 – Including a Windows Active Directory lab</span></p>
<p><span class="koboSpan" id="kobo.231.1">Here, we have two Windows VM instances similar to what we prepared in </span><span class="No-Break"><em class="italic"><a href="B19755_08.xhtml"><span class="koboSpan" id="kobo.232.1">Chapter 8</span></a></em></span><span class="koboSpan" id="kobo.233.1">, </span><em class="italic"><span class="koboSpan" id="kobo.234.1">Designing and Building a Vulnerable Active Directory Lab</span></em><span class="koboSpan" id="kobo.235.1">. </span><span class="koboSpan" id="kobo.235.2">One of the VM instances will be the </span><a id="_idIndexMarker1307"/><span class="koboSpan" id="kobo.236.1">domain controller (</span><strong class="source-inline"><span class="koboSpan" id="kobo.237.1">vm-target-03</span></strong><span class="koboSpan" id="kobo.238.1">) and the other one will be a workstation machine (</span><strong class="source-inline"><span class="koboSpan" id="kobo.239.1">vm-target-04</span></strong><span class="koboSpan" id="kobo.240.1">) that will be joined to the domain. </span><span class="koboSpan" id="kobo.240.2">Of course, we can add more machines to this setup and make the lab environment a bit more realistic. </span><span class="koboSpan" id="kobo.240.3">To increase the difficulty a bit, we can make the Windows VM instances not accessible directly from the attacker machine and require the second target VM instance (</span><strong class="source-inline"><span class="koboSpan" id="kobo.241.1">vm-target-02</span></strong><span class="koboSpan" id="kobo.242.1">) to be compromised first, and use that to access and attack the domain controller instance (</span><strong class="source-inline"><span class="koboSpan" id="kobo.243.1">vm-target-03</span></strong><span class="koboSpan" id="kobo.244.1">) and the workstation machine </span><span class="No-Break"><span class="koboSpan" id="kobo.245.1">instance (</span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.246.1">vm-target-04</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.247.1">).</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.248.1">Important note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.249.1">When designing lab environments, it is essential that we take into account the penetration testing skills (or techniques) being focused on as certain lab components are required depending on the techniques and actions we want the lab user to perform inside the lab environment. </span><span class="koboSpan" id="kobo.249.2">In addition to this, it is important that we have a good idea of who will use the lab to help us identify the experience level of the lab users. </span><span class="koboSpan" id="kobo.249.3">This will help us manage the varying levels of difficulty across the various sections of the lab environment. </span><span class="koboSpan" id="kobo.249.4">That said, we can increase the complexity and difficulty of certain parts of the lab by adding web application firewalls to allow lab users to practice more advanced web penetration testing techniques. </span><span class="koboSpan" id="kobo.249.5">We can also increase the difficulty even further by adding specific resources such as </span><a id="_idIndexMarker1308"/><span class="koboSpan" id="kobo.250.1">an </span><strong class="bold"><span class="koboSpan" id="kobo.251.1">intrusion prevention system</span></strong><span class="koboSpan" id="kobo.252.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.253.1">IPS</span></strong><span class="koboSpan" id="kobo.254.1">) for practicing </span><span class="No-Break"><span class="koboSpan" id="kobo.255.1">evasion techniques.</span></span></p>
<p><span class="koboSpan" id="kobo.256.1">Another</span><a id="_idIndexMarker1309"/><span class="koboSpan" id="kobo.257.1"> possibility is to have a more complex lab setup with all of these included! </span><span class="koboSpan" id="kobo.257.2">Of course, this would entail a significantly higher cost of running the cloud resources within the lab environment. </span><span class="koboSpan" id="kobo.257.3">In addition to this, we would need to invest a bit more time in automating the setup of the various components deployed in our penetration testing lab setup. </span><span class="koboSpan" id="kobo.257.4">At this point, you might be wondering how we could significantly accelerate the preparation of complex lab environments! </span><span class="koboSpan" id="kobo.257.5">The good news is that we now have AI-powered solutions that could help us in various types of tasks, such as estimating penetration testing lab costs, generating automation </span><a id="_idIndexMarker1310"/><span class="koboSpan" id="kobo.258.1">scripts and </span><strong class="bold"><span class="koboSpan" id="kobo.259.1">Infrastructure-as-Code</span></strong><span class="koboSpan" id="kobo.260.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.261.1">IaC</span></strong><span class="koboSpan" id="kobo.262.1">) templates, along with explaining existing code written by other engineers and professionals. </span><span class="koboSpan" id="kobo.262.2">We’ll see this in action in the next sections of </span><span class="No-Break"><span class="koboSpan" id="kobo.263.1">this chapter!</span></span></p>
<h1 id="_idParaDest-196"><a id="_idTextAnchor196"/><span class="koboSpan" id="kobo.264.1">Leveraging Generative AI for estimating penetration testing lab costs</span></h1>
<p><span class="koboSpan" id="kobo.265.1">The</span><a id="_idIndexMarker1311"/><span class="koboSpan" id="kobo.266.1"> way we design </span><a id="_idIndexMarker1312"/><span class="koboSpan" id="kobo.267.1">our penetration testing lab environments can have a significant impact on the overall cost of running these labs in the cloud. </span><span class="koboSpan" id="kobo.267.2">Certain implementations and variations may require more resources than others, which would lead to increased costs. </span><span class="koboSpan" id="kobo.267.3">By carefully considering the architecture of our lab setup, we can identify opportunities to reduce costs without compromising the quality, performance, and stability of our penetration testing lab environment. </span><span class="koboSpan" id="kobo.267.4">Estimating the associated costs when running these environments is another crucial aspect as this allows security professionals (and teams) to plan their budget and maintain a sustainable lab setup in the </span><span class="No-Break"><span class="koboSpan" id="kobo.268.1">long run.</span></span></p>
<p><span class="koboSpan" id="kobo.269.1">In </span><span class="No-Break"><em class="italic"><a href="B19755_06.xhtml"><span class="koboSpan" id="kobo.270.1">Chapter 6</span></a></em></span><span class="koboSpan" id="kobo.271.1">, </span><em class="italic"><span class="koboSpan" id="kobo.272.1">Setting Up Isolated Penetration Testing Lab Environments on AWS</span></em><span class="koboSpan" id="kobo.273.1">, we prepared a lab setup where we can practice network pivoting techniques. </span><span class="koboSpan" id="kobo.273.2">In case you’ve forgotten already, here’s a simplified diagram showing what our lab environment </span><span class="No-Break"><span class="koboSpan" id="kobo.274.1">looks like:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer344">
<span class="koboSpan" id="kobo.275.1"><img alt="" src="image/B19755_09_05.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.276.1">Figure 9.5 – Our lab environment setup in Chapter 6</span></p>
<p><span class="koboSpan" id="kobo.277.1">Here, we </span><a id="_idIndexMarker1313"/><span class="koboSpan" id="kobo.278.1">have an attacker VM</span><a id="_idIndexMarker1314"/><span class="koboSpan" id="kobo.279.1"> instance running inside one VPC network and two target VM instances running inside another VPC network. </span><em class="italic"><span class="koboSpan" id="kobo.280.1">Have you ever wondered how much it would cost to run this lab environment?</span></em><span class="koboSpan" id="kobo.281.1"> While it is possible to compute the costs manually, we can use Generative AI tools, capabilities, and plugins to help us estimate and compute the </span><span class="No-Break"><span class="koboSpan" id="kobo.282.1">costs automatically!</span></span></p>
<p><span class="koboSpan" id="kobo.283.1">In </span><span class="No-Break"><em class="italic"><a href="B19755_07.xhtml"><span class="koboSpan" id="kobo.284.1">Chapter 7</span></a></em></span><span class="koboSpan" id="kobo.285.1">, </span><em class="italic"><span class="koboSpan" id="kobo.286.1">Setting Up an IAM Privilege Escalation Lab</span></em><span class="koboSpan" id="kobo.287.1">, we had our first look into how we can use Generative AI solutions to automatically generate code for penetration testing simulations and activities. </span><span class="koboSpan" id="kobo.287.2">There’s more to where that came from! </span><span class="koboSpan" id="kobo.287.3">In this section, we will use </span><strong class="bold"><span class="koboSpan" id="kobo.288.1">ChatGPT Advanced Data Analysis</span></strong><span class="koboSpan" id="kobo.289.1"> to help us estimate the cost using the Terraform configuration </span><a id="_idIndexMarker1315"/><span class="koboSpan" id="kobo.290.1">files we used to generate a lab environment. </span><span class="koboSpan" id="kobo.290.2">All we need to do is input the right set of prompts and let the AI model generate the cost calculations and insights for us. </span><span class="No-Break"><span class="koboSpan" id="kobo.291.1">Amazing, right?</span></span></p>
<p><span class="koboSpan" id="kobo.292.1">With this in mind, let’s proceed with the estimation of the associated costs for running our </span><span class="No-Break"><span class="koboSpan" id="kobo.293.1">lab environment:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.294.1">Navigate to this book’s GitHub repository and locate the ZIP file we used to prepare the lab environment for </span><span class="No-Break"><em class="italic"><a href="B19755_06.xhtml"><span class="koboSpan" id="kobo.295.1">Chapter 6</span></a></em></span><span class="koboSpan" id="kobo.296.1">, </span><em class="italic"><span class="koboSpan" id="kobo.297.1">Setting Up Isolated Penetration Testing Lab Environments on AWS</span></em><span class="koboSpan" id="kobo.298.1">. </span><span class="koboSpan" id="kobo.298.2">Feel free to use the following link to help you locate the </span><span class="No-Break"><span class="koboSpan" id="kobo.299.1">ZIP file:</span></span><pre class="source-code">
<a href="https://github.com/PacktPublishing/Building-and-Automating-Penetration-Testing-Labs-in-the-Cloud/blob/main/ch06/pentest_lab.zip"><span class="koboSpan" id="kobo.300.1">https://github.com/PacktPublishing/Building-and-Automating-Penetration-Testing-Labs-in-the-Cloud/blob/main/ch06/pentest_lab.zip</span></a></pre><p class="list-inset"><span class="koboSpan" id="kobo.301.1">Locate and click the </span><strong class="bold"><span class="koboSpan" id="kobo.302.1">Download raw file</span></strong><span class="koboSpan" id="kobo.303.1"> button (located near the </span><strong class="bold"><span class="koboSpan" id="kobo.304.1">Raw</span></strong><span class="koboSpan" id="kobo.305.1"> button in the right-hand corner of the page). </span><span class="koboSpan" id="kobo.305.2">This will download the </span><strong class="source-inline"><span class="koboSpan" id="kobo.306.1">pentest_lab.zip</span></strong><span class="koboSpan" id="kobo.307.1"> ZIP file from the GitHub repository to your </span><span class="No-Break"><span class="koboSpan" id="kobo.308.1">local machine.</span></span></p></li> <li><span class="koboSpan" id="kobo.309.1">In a new</span><a id="_idIndexMarker1316"/><span class="koboSpan" id="kobo.310.1"> browser tab, access </span><a id="_idIndexMarker1317"/><span class="koboSpan" id="kobo.311.1">your </span><strong class="bold"><span class="koboSpan" id="kobo.312.1">ChatGPT Plus</span></strong><span class="koboSpan" id="kobo.313.1"> account using the following URL: </span><a href="https://chat.openai.com/"><span class="koboSpan" id="kobo.314.1">https://chat.openai.com/</span></a><span class="koboSpan" id="kobo.315.1">. </span><span class="koboSpan" id="kobo.315.2">Ensure that you configure your account to have </span><strong class="bold"><span class="koboSpan" id="kobo.316.1">Advanced data analysis</span></strong><span class="koboSpan" id="kobo.317.1"> enabled </span><span class="No-Break"><span class="koboSpan" id="kobo.318.1">before proceeding.</span></span>
<div>
<div class="IMG---Figure" id="_idContainer345">
<span class="koboSpan" id="kobo.319.1"><img alt="" src="image/B19755_09_06.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.320.1">Figure 9.6 – Enabling Advanced data analysis</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.321.1">Enabling </span><strong class="bold"><span class="koboSpan" id="kobo.322.1">Advanced data analysis</span></strong><span class="koboSpan" id="kobo.323.1"> will allow us to automate complex data computations and analyze valuable information from uploaded files. </span><span class="koboSpan" id="kobo.323.2">Yes, you heard that right! </span><span class="koboSpan" id="kobo.323.3">We can upload files and leverage the AI model’s capabilities to generate detailed analyses, visualize trends, and extract meaningful patterns directly from the </span><span class="No-Break"><span class="koboSpan" id="kobo.324.1">uploaded data.</span></span></p></li>
</ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.325.1">Important note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.326.1">As of writing, </span><strong class="bold"><span class="koboSpan" id="kobo.327.1">Advanced Data Analysis</span></strong><span class="koboSpan" id="kobo.328.1"> is in Beta. </span><span class="koboSpan" id="kobo.328.2">By the time you read this book, it may have transitioned out of the</span><a id="_idIndexMarker1318"/><span class="koboSpan" id="kobo.329.1"> Beta </span><span class="No-Break"><span class="koboSpan" id="kobo.330.1">phase already!</span></span></p>
<ol>
<li value="3"><span class="koboSpan" id="kobo.331.1">Create </span><a id="_idIndexMarker1319"/><span class="koboSpan" id="kobo.332.1">a new </span><a id="_idIndexMarker1320"/><span class="koboSpan" id="kobo.333.1">chat session and select </span><strong class="bold"><span class="koboSpan" id="kobo.334.1">GPT-4</span></strong><span class="koboSpan" id="kobo.335.1"> (or the latest model available exclusively to ChatGPT </span><span class="No-Break"><span class="koboSpan" id="kobo.336.1">Plus users):</span></span>
<div>
<div class="IMG---Figure" id="_idContainer346">
<span class="koboSpan" id="kobo.337.1"><img alt="" src="image/B19755_09_07.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.338.1">Figure 9.7 – Selecting GPT-4 and Advanced Data Analysis for our chat session</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.339.1">Make sure that </span><strong class="bold"><span class="koboSpan" id="kobo.340.1">Advanced Data Analysis</span></strong><span class="koboSpan" id="kobo.341.1"> is selected (instead of </span><strong class="bold"><span class="koboSpan" id="kobo.342.1">Default</span></strong><span class="koboSpan" id="kobo.343.1">) similar to what we have in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.344.1">Figure 9</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.345.1">.7</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.346.1">.</span></span></p></li>
</ol>
<ol>
<li value="4"><span class="koboSpan" id="kobo.347.1">Click the </span><strong class="bold"><span class="koboSpan" id="kobo.348.1">+</span></strong><span class="koboSpan" id="kobo.349.1"> button (highlighted in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.350.1">Figure 9</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.351.1">.8</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.352.1">):</span></span>
<div>
<div class="IMG---Figure" id="_idContainer347">
<span class="koboSpan" id="kobo.353.1"><img alt="" src="image/B19755_09_08.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.354.1">Figure 9.8 – Uploading the pentest_lab.zip file</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.355.1">Upload</span><a id="_idIndexMarker1321"/><span class="koboSpan" id="kobo.356.1"> the </span><strong class="source-inline"><span class="koboSpan" id="kobo.357.1">pentest_lab.zip</span></strong><span class="koboSpan" id="kobo.358.1"> file we</span><a id="_idIndexMarker1322"/><span class="koboSpan" id="kobo.359.1"> downloaded to our local machine in a </span><span class="No-Break"><span class="koboSpan" id="kobo.360.1">previous step.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.361.1">Important note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.362.1">Do not press </span><em class="italic"><span class="koboSpan" id="kobo.363.1">Enter</span></em><span class="koboSpan" id="kobo.364.1"> or click the </span><strong class="bold"><span class="koboSpan" id="kobo.365.1">Send a message</span></strong><span class="koboSpan" id="kobo.366.1"> button yet as we will be specifying a prompt (in the </span><span class="No-Break"><span class="koboSpan" id="kobo.367.1">next step).</span></span></p></li>
</ol>
<ol>
<li value="5"><span class="koboSpan" id="kobo.368.1">Type the following prompt inside the </span><span class="No-Break"><span class="koboSpan" id="kobo.369.1">text bar:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.370.1">
Analyze what this zip file contains</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.371.1">Press the </span><em class="italic"><span class="koboSpan" id="kobo.372.1">Enter</span></em><span class="koboSpan" id="kobo.373.1"> key afterward to submit the uploaded file along with the prompt. </span><span class="koboSpan" id="kobo.373.2">This should yield a response similar to what is shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.374.1">Figure 9</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.375.1">.9</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.376.1">:</span></span></p> <div>
<div class="IMG---Figure" id="_idContainer348">
<span class="koboSpan" id="kobo.377.1"><img alt="" src="image/B19755_09_09.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.378.1">Figure 9.9 – Analyzing what the ZIP file contains</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.379.1">Simply</span><a id="_idIndexMarker1323"/><span class="koboSpan" id="kobo.380.1"> enter </span><strong class="source-inline"><span class="koboSpan" id="kobo.381.1">No need</span></strong><span class="koboSpan" id="kobo.382.1"> when</span><a id="_idIndexMarker1324"/><span class="koboSpan" id="kobo.383.1"> asked a question similar to </span><strong class="bold"><span class="koboSpan" id="kobo.384.1">Would you like a brief overview of each </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.385.1">file’s contents?</span></strong></span></p></li>
</ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.386.1">Important note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.387.1">Note that even with the same prompt, you may get a different set of responses from ChatGPT. </span><span class="koboSpan" id="kobo.387.2">That said, feel free to modify and adjust your </span><span class="No-Break"><span class="koboSpan" id="kobo.388.1">prompts accordingly.</span></span></p>
<ol>
<li value="6"><span class="koboSpan" id="kobo.389.1">Open a new browser tab and navigate to </span><a href="https://instances.vantage.sh/"><span class="koboSpan" id="kobo.390.1">https://instances.vantage.sh/</span></a><span class="koboSpan" id="kobo.391.1">. </span><span class="koboSpan" id="kobo.391.2">This should open a website built to help compare various EC2 </span><span class="No-Break"><span class="koboSpan" id="kobo.392.1">instance types.</span></span>
<div>
<div class="IMG---Figure" id="_idContainer349">
<span class="koboSpan" id="kobo.393.1"><img alt="" src="image/B19755_09_10.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.394.1">Figure 9.10 – Website built for comparing various EC2 instance types</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.395.1">Click the </span><strong class="bold"><span class="koboSpan" id="kobo.396.1">Export</span></strong><span class="koboSpan" id="kobo.397.1"> button highlighted in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.398.1">Figure 9</span></em></span><em class="italic"><span class="koboSpan" id="kobo.399.1">.10</span></em><span class="koboSpan" id="kobo.400.1">. </span><span class="koboSpan" id="kobo.400.2">This will download an </span><strong class="source-inline"><span class="koboSpan" id="kobo.401.1">Amazon EC2 Instance Comparison.csv</span></strong><span class="koboSpan" id="kobo.402.1"> file to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.403.1">Downloads</span></strong><span class="koboSpan" id="kobo.404.1"> folder (or alternative) of your </span><span class="No-Break"><span class="koboSpan" id="kobo.405.1">local machine.</span></span></p></li>
</ol>
<ol>
<li value="7"><span class="koboSpan" id="kobo.406.1">Navigate back to the browser tab where we have our ChatGPT </span><span class="No-Break"><span class="koboSpan" id="kobo.407.1">session open.</span></span></li>
<li><span class="koboSpan" id="kobo.408.1">Now, let’s</span><a id="_idIndexMarker1325"/><span class="koboSpan" id="kobo.409.1"> compute the </span><a id="_idIndexMarker1326"/><span class="koboSpan" id="kobo.410.1">monthly cost of running each EC2 instance specified in the Terraform configuration files. </span><span class="koboSpan" id="kobo.410.2">Let’s do this by uploading the </span><strong class="source-inline"><span class="koboSpan" id="kobo.411.1">Amazon EC2 Instance Comparison.csv</span></strong><span class="koboSpan" id="kobo.412.1"> file and entering the </span><span class="No-Break"><span class="koboSpan" id="kobo.413.1">following prompt:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.414.1">
How many EC2 instances will be created overall (based from all files extracted from the pentest_lab.zip file)? </span><span class="koboSpan" id="kobo.414.2">Provide as much details as possible including cost per month. </span><span class="koboSpan" id="kobo.414.3">Use the uploaded Amazon EC2 Instance Comparison.csv as a reference when computing the overall cost.</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.415.1">This will yield the following (</span><span class="No-Break"><span class="koboSpan" id="kobo.416.1">final) output:</span></span></p> <p class="IMG---Caption" lang="en-US" xml:lang="en-US"> </p>
<div>
<div class="IMG---Figure" id="_idContainer350">
<span class="koboSpan" id="kobo.417.1"><img alt="" src="image/B19755_09_11.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.418.1">Figure 9.11 – Breakdown of the monthly costs for the EC2 instances defined</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.419.1">Here, we can</span><a id="_idIndexMarker1327"/><span class="koboSpan" id="kobo.420.1"> see that </span><a id="_idIndexMarker1328"/><span class="koboSpan" id="kobo.421.1">ChatGPT successfully returned a breakdown of the monthly costs for the identified EC2 instances from the Terraform configuration files inside the ZIP file we uploaded earlier. </span><span class="koboSpan" id="kobo.421.2">To simplify things a bit, we have only considered the cost of running the EC2 instances in this example. </span><span class="koboSpan" id="kobo.421.3">Note that there are other costs we must take into account as well to get a more accurate monthly cost estimate. </span><span class="koboSpan" id="kobo.421.4">These include the data transfer fees, the storage costs associated with the EBS volumes attached to the EC2 instances, as well as the potential charges for using other services in </span><span class="No-Break"><span class="koboSpan" id="kobo.422.1">the account.</span></span></p></li>
</ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.423.1">Important note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.424.1">By identifying which components and resources of the lab setup contribute the most to the overall cost, we can focus our optimization efforts on these areas to achieve maximum </span><span class="No-Break"><span class="koboSpan" id="kobo.425.1">cost savings.</span></span></p>
<ol>
<li value="9"><span class="koboSpan" id="kobo.426.1">Since we are not planning to have the resources running for an entire month, let’s enter the following prompt and specify that we will only have the resources running for </span><span class="No-Break"><span class="koboSpan" id="kobo.427.1">6 hours:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.428.1">
Instead of a month, I'll be running the resources for 6 hours and then I'll destroy the resources. </span><span class="koboSpan" id="kobo.428.2">How much would it cost to run the resources?</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.429.1">This should yield </span><a id="_idIndexMarker1329"/><span class="koboSpan" id="kobo.430.1">a response</span><a id="_idIndexMarker1330"/><span class="koboSpan" id="kobo.431.1"> similar to what is shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.432.1">Figure 9</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.433.1">.12</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.434.1">:</span></span></p> <div>
<div class="IMG---Figure" id="_idContainer351">
<span class="koboSpan" id="kobo.435.1"><img alt="" src="image/B19755_09_12.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.436.1">Figure 9.12 – Estimated cost of running the resources for 6 hours instead of 1 month</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.437.1">This time, we have the estimated cost of running the EC2 instances for 6 hours (instead of a month). </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.438.1">Cool, right?</span></em></span></p></li>
</ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.439.1">Important note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.440.1">One of the simplest yet most effective ways to manage costs is to ensure that resources are turned off or deleted when they are not actively being used. </span><span class="koboSpan" id="kobo.440.2">It is common for lab environments to consist of multiple VMs, databases, and other resources that contribute the most to the overall cost. </span><span class="koboSpan" id="kobo.440.3">By setting up automated scripts (that create and delete resources), we can ensure that these resources are running only when they </span><span class="No-Break"><span class="koboSpan" id="kobo.441.1">are needed.</span></span></p>
<ol>
<li value="10"><span class="koboSpan" id="kobo.442.1">Let’s take </span><a id="_idIndexMarker1331"/><span class="koboSpan" id="kobo.443.1">things one </span><a id="_idIndexMarker1332"/><span class="koboSpan" id="kobo.444.1">step further by generating a bar chart using the </span><span class="No-Break"><span class="koboSpan" id="kobo.445.1">following prompt:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.446.1">
Generate a bar chart comparing the costs per Terraform file</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.447.1">This should give us the </span><span class="No-Break"><span class="koboSpan" id="kobo.448.1">following output:</span></span></p> <div>
<div class="IMG---Figure" id="_idContainer352">
<span class="koboSpan" id="kobo.449.1"><img alt="" src="image/B19755_09_13.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.450.1">Figure 9.13 – Bar chart comparing the cost associated per Terraform file</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.451.1">Here, we can see that a significant portion of the cost comes from the resources defined in </span><strong class="source-inline"><span class="koboSpan" id="kobo.452.1">network_02.tf</span></strong><span class="koboSpan" id="kobo.453.1">. </span><span class="koboSpan" id="kobo.453.2">Again, note that we have only considered the cost of running the EC2 instances when generating the </span><span class="No-Break"><span class="koboSpan" id="kobo.454.1">bar chart.</span></span></p></li>
</ol>
<ol>
<li value="11"><span class="koboSpan" id="kobo.455.1">To help us identify which blocks of code in our Terraform files have a contribution to the overall cost, enter the </span><span class="No-Break"><span class="koboSpan" id="kobo.456.1">following prompt:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.457.1">
Identify which Terraform blocks of code have a contribution to the overall cost</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.458.1">This </span><a id="_idIndexMarker1333"/><span class="koboSpan" id="kobo.459.1">should give us the</span><a id="_idIndexMarker1334"/> <span class="No-Break"><span class="koboSpan" id="kobo.460.1">following output:</span></span></p> <div>
<div class="IMG---Figure" id="_idContainer353">
<span class="koboSpan" id="kobo.461.1"><img alt="" src="image/B19755_09_14.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.462.1">Figure 9.14 – Identifying which blocks of code have a contribution to the overall cost</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.463.1">Looks like ChatGPT was able to successfully identify and provide the (simplified) resource blocks that have associated EC2 </span><span class="No-Break"><span class="koboSpan" id="kobo.464.1">instance costs!</span></span></p></li>
</ol>
<ol>
<li value="12"><span class="koboSpan" id="kobo.465.1">Finally, let’s enter the </span><span class="No-Break"><span class="koboSpan" id="kobo.466.1">following prompt:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.467.1">
Update the previous answer by changing the instance type of the vm_kali EC2 instance from t3.medium to m5.large</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.468.1">This should return the </span><span class="No-Break"><span class="koboSpan" id="kobo.469.1">following response:</span></span></p> <div>
<div class="IMG---Figure" id="_idContainer354">
<span class="koboSpan" id="kobo.470.1"><img alt="" src="image/B19755_09_15.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.471.1">Figure 9.15 – Checking how updating the instance type affects the estimated cost</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.472.1">In </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.473.1">Figure 9</span></em></span><em class="italic"><span class="koboSpan" id="kobo.474.1">.15</span></em><span class="koboSpan" id="kobo.475.1">, we </span><a id="_idIndexMarker1335"/><span class="koboSpan" id="kobo.476.1">can see that</span><a id="_idIndexMarker1336"/><span class="koboSpan" id="kobo.477.1"> the cost associated with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.478.1">vm_kali</span></strong><span class="koboSpan" id="kobo.479.1"> resource has been updated automatically </span><span class="No-Break"><span class="koboSpan" id="kobo.480.1">as well.</span></span></p>
<p><span class="koboSpan" id="kobo.481.1">To accommodate various workloads, cloud providers offer instance types with varying performance levels and costs. </span><span class="koboSpan" id="kobo.481.2">By properly assessing the performance requirements of the applications, services, and tools that would run inside the cloud resources, we would be able to choose the right instance type. </span><span class="koboSpan" id="kobo.481.3">With this, we can make informed decisions to help us manage and reduce </span><span class="No-Break"><span class="koboSpan" id="kobo.482.1">costs significantly.</span></span></p></li>
</ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.483.1">Important note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.484.1">In addition to the initial set of resources created using the Terraform configuration files, we must take into account any additional resources that might be created by the lab environment users (while they are using the lab). </span><span class="koboSpan" id="kobo.484.2">What if lab environment users could create cloud resources that could potentially be expensive? </span><span class="koboSpan" id="kobo.484.3">What if extensive network traffic is generated by the user? </span><span class="koboSpan" id="kobo.484.4">In a lab environment where users have the capability to create cloud resources, it’s crucial to implement safeguards to prevent accidental or </span><span class="No-Break"><span class="koboSpan" id="kobo.485.1">intentional overspending.</span></span></p>
<p><span class="koboSpan" id="kobo.486.1">At this point, we should have a good idea of how to use Generative AI solutions to estimate the cost of running our penetration testing lab environment in the cloud. </span><span class="koboSpan" id="kobo.486.2">The example scenario we just discussed is just one of the many practical applications of Generative AI. </span><span class="koboSpan" id="kobo.486.3">It is important to note that the capabilities of AI-powered solutions extend </span><em class="italic"><span class="koboSpan" id="kobo.487.1">far beyond</span></em><span class="koboSpan" id="kobo.488.1"> this example scenario! </span><span class="koboSpan" id="kobo.488.2">We’ll see more of this in the next sections of </span><span class="No-Break"><span class="koboSpan" id="kobo.489.1">this chapter.</span></span></p>
<h1 id="_idParaDest-197"><a id="_idTextAnchor197"/><span class="koboSpan" id="kobo.490.1">Unleashing the power of AI-powered tools to accelerate automation script development</span></h1>
<p><span class="koboSpan" id="kobo.491.1">Being able to</span><a id="_idIndexMarker1337"/><span class="koboSpan" id="kobo.492.1"> fully automate the creation and deletion of our penetration testing lab environment would help us significantly reduce the cost of running these lab environments in the cloud. </span><span class="koboSpan" id="kobo.492.2">While the potential benefits are undeniable, in reality, </span><em class="italic"><span class="koboSpan" id="kobo.493.1">fully</span></em> <em class="italic"><span class="koboSpan" id="kobo.494.1">automating</span></em><span class="koboSpan" id="kobo.495.1"> the preparation of lab environments is not as easy as it sounds. </span><span class="koboSpan" id="kobo.495.2">Coding automation scripts takes time, skill, and effort, and it may sometimes involve an entire team of experienced (and expensive) engineers to get the job </span><span class="No-Break"><span class="koboSpan" id="kobo.496.1">done properly.</span></span></p>
<p><span class="koboSpan" id="kobo.497.1">Maybe AI-powered tools can help! </span><span class="koboSpan" id="kobo.497.2">In addition to ChatGPT, there are many other AI-powered solutions available to help us significantly speed up the preparation of the automation scripts for building our penetration testing lab environments. </span><span class="koboSpan" id="kobo.497.3">In this section, we will take a closer look at how </span><a id="_idIndexMarker1338"/><span class="koboSpan" id="kobo.498.1">AI-powered tools such </span><a id="_idIndexMarker1339"/><span class="koboSpan" id="kobo.499.1">as </span><strong class="bold"><span class="koboSpan" id="kobo.500.1">GitHub Copilot</span></strong><span class="koboSpan" id="kobo.501.1">, </span><strong class="bold"><span class="koboSpan" id="kobo.502.1">Amazon CodeWhisperer</span></strong><span class="koboSpan" id="kobo.503.1">, and </span><strong class="bold"><span class="koboSpan" id="kobo.504.1">Tabnine</span></strong><span class="koboSpan" id="kobo.505.1"> can help us accelerate </span><a id="_idIndexMarker1340"/><span class="koboSpan" id="kobo.506.1">automation script development. </span><span class="koboSpan" id="kobo.506.2">These cutting-edge tools leverage machine learning and natural language processing to accelerate the coding and scripting process. </span><span class="koboSpan" id="kobo.506.3">These tools help developers by suggesting code snippets, autocompleting lines of</span><a id="_idIndexMarker1341"/><span class="koboSpan" id="kobo.507.1"> code, and even generating blocks of code through comments. </span><span class="No-Break"><span class="koboSpan" id="kobo.508.1">Amazing, right?</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.509.1">Important note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.510.1">Make sure</span><a id="_idIndexMarker1342"/><span class="koboSpan" id="kobo.511.1"> that you </span><a id="_idIndexMarker1343"/><span class="koboSpan" id="kobo.512.1">have the </span><strong class="bold"><span class="koboSpan" id="kobo.513.1">GitHub Copilot</span></strong><span class="koboSpan" id="kobo.514.1">, </span><strong class="bold"><span class="koboSpan" id="kobo.515.1">Amazon CodeWhisperer</span></strong><span class="koboSpan" id="kobo.516.1">, and </span><strong class="bold"><span class="koboSpan" id="kobo.517.1">Tabnine</span></strong><span class="koboSpan" id="kobo.518.1"> extensions set up (completely) as specified in</span><a id="_idIndexMarker1344"/><span class="koboSpan" id="kobo.519.1"> the </span><em class="italic"><span class="koboSpan" id="kobo.520.1">Technical requirements</span></em><span class="koboSpan" id="kobo.521.1"> section at the start of this chapter. </span><span class="koboSpan" id="kobo.521.2">It may take around 15 minutes to set up and complete all the prerequisites and dependencies for these to work in </span><span class="No-Break"><span class="koboSpan" id="kobo.522.1">VS Code.</span></span></p>
<p><span class="koboSpan" id="kobo.523.1">Let’s see these AI-powered tools in action in the next set </span><span class="No-Break"><span class="koboSpan" id="kobo.524.1">of steps.</span></span></p>
<h2 id="_idParaDest-198"><a id="_idTextAnchor198"/><span class="koboSpan" id="kobo.525.1">Part 1 of 3 – Leveraging GitHub Copilot to speed up shell scripting</span></h2>
<p><span class="koboSpan" id="kobo.526.1">Now, let’s try </span><a id="_idIndexMarker1345"/><span class="koboSpan" id="kobo.527.1">using GitHub Copilot to help speed up the</span><a id="_idIndexMarker1346"/><span class="koboSpan" id="kobo.528.1"> preparation of a sample script that can create specific lab environment resources in our </span><span class="No-Break"><span class="koboSpan" id="kobo.529.1">GCP account:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.530.1">Let’s start by making sure that all VS Code extensions are disabled. </span><span class="koboSpan" id="kobo.530.2">This will help prevent any conflict that may arise with the newly added </span><span class="No-Break"><span class="koboSpan" id="kobo.531.1">AI-powered extensions.</span></span>
<div>
<div class="IMG---Figure" id="_idContainer355">
<span class="koboSpan" id="kobo.532.1"><img alt="" src="image/B19755_09_16.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.533.1">Figure 9.16 – Disabling all installed extensions in VS Code</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.534.1">Click on the </span><strong class="bold"><span class="koboSpan" id="kobo.535.1">Extensions</span></strong><span class="koboSpan" id="kobo.536.1"> icon in the sidebar on the left side of the VS Code window. </span><span class="koboSpan" id="kobo.536.2">In the </span><strong class="bold"><span class="koboSpan" id="kobo.537.1">Extensions</span></strong><span class="koboSpan" id="kobo.538.1"> view, click the three dots (</span><strong class="bold"><span class="koboSpan" id="kobo.539.1">···</span></strong><span class="koboSpan" id="kobo.540.1">) button and select </span><strong class="bold"><span class="koboSpan" id="kobo.541.1">Disable All Installed Extensions</span></strong><span class="koboSpan" id="kobo.542.1"> from the list of options available in the </span><span class="No-Break"><span class="koboSpan" id="kobo.543.1">context menu.</span></span></p></li>
</ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.544.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.545.1">Feel free to check </span><a href="https://code.visualstudio.com/docs/editor/extension-marketplace"><span class="koboSpan" id="kobo.546.1">https://code.visualstudio.com/docs/editor/extension-marketplace</span></a><span class="koboSpan" id="kobo.547.1"> for more information about </span><span class="No-Break"><span class="koboSpan" id="kobo.548.1">this topic.</span></span></p>
<ol>
<li value="2"><span class="koboSpan" id="kobo.549.1">Now, let’s </span><a id="_idIndexMarker1347"/><span class="koboSpan" id="kobo.550.1">enable the GitHub Copilot </span><a id="_idIndexMarker1348"/><span class="koboSpan" id="kobo.551.1">extension. </span><span class="koboSpan" id="kobo.551.2">In the </span><strong class="bold"><span class="koboSpan" id="kobo.552.1">EXTENSIONS: MARKETPLACE</span></strong><span class="koboSpan" id="kobo.553.1"> view, we should see a search bar at the top. </span><span class="koboSpan" id="kobo.553.2">Type </span><strong class="source-inline"><span class="koboSpan" id="kobo.554.1">GitHub Copilot</span></strong><span class="koboSpan" id="kobo.555.1"> in this search bar to locate the extension we need </span><span class="No-Break"><span class="koboSpan" id="kobo.556.1">to enable.</span></span>
<div>
<div class="IMG---Figure" id="_idContainer356">
<span class="koboSpan" id="kobo.557.1"><img alt="" src="image/B19755_09_17.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.558.1">Figure 9.17 – Enabling the GitHub Copilot extension</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.559.1">Scroll through the list of extensions to find the </span><strong class="bold"><span class="koboSpan" id="kobo.560.1">GitHub Copilot</span></strong><span class="koboSpan" id="kobo.561.1"> extension. </span><span class="koboSpan" id="kobo.561.2">Right-click on the extension and then select </span><strong class="bold"><span class="koboSpan" id="kobo.562.1">Enable</span></strong><span class="koboSpan" id="kobo.563.1"> from the list of options available in the </span><span class="No-Break"><span class="koboSpan" id="kobo.564.1">context menu.</span></span></p></li>
</ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.565.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.566.1">Make sure that the setup is complete before proceeding. </span><span class="koboSpan" id="kobo.566.2">In some cases, VS Code may prompt you to restart the application. </span><span class="koboSpan" id="kobo.566.3">If prompted, go ahead and restart </span><span class="No-Break"><span class="koboSpan" id="kobo.567.1">VS Code.</span></span></p>
<ol>
<li value="3"><span class="koboSpan" id="kobo.568.1">With our AI-powered extension enabled already, let’s proceed by creating a new file </span><span class="No-Break"><span class="koboSpan" id="kobo.569.1">named </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.570.1">copilot.sh</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.571.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.572.1">Type the following in the first line of our </span><span class="No-Break"><span class="koboSpan" id="kobo.573.1">script file:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.574.1">
#!/bin/bash</span></pre></li> <li><span class="koboSpan" id="kobo.575.1">Next, add the following line of code (in the second or </span><span class="No-Break"><span class="koboSpan" id="kobo.576.1">third line):</span></span><pre class="source-code"><span class="koboSpan" id="kobo.577.1">
BUCKET_NAME=</span><strong class="bold"><span class="koboSpan" id="kobo.578.1">&lt;BUCKET NAME&gt;</span></strong></pre><p class="list-inset"><span class="koboSpan" id="kobo.579.1">Make sure to replace </span><strong class="source-inline"><span class="koboSpan" id="kobo.580.1">&lt;BUCKET NAME&gt;</span></strong><span class="koboSpan" id="kobo.581.1"> with a globally unique bucket name (for a bucket that is yet to </span><span class="No-Break"><span class="koboSpan" id="kobo.582.1">be created).</span></span></p></li> <li><span class="koboSpan" id="kobo.583.1">In the fourth or</span><a id="_idIndexMarker1349"/><span class="koboSpan" id="kobo.584.1"> fifth line, type the</span><a id="_idIndexMarker1350"/><span class="koboSpan" id="kobo.585.1"> following </span><span class="No-Break"><span class="koboSpan" id="kobo.586.1">single-line comment:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.587.1">
# Create a new Google Cloud Storage bucket using the gsutil command</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.588.1">At this point, our </span><strong class="source-inline"><span class="koboSpan" id="kobo.589.1">copilot.sh</span></strong><span class="koboSpan" id="kobo.590.1"> script file should look similar to what we have in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.591.1">Figure 9</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.592.1">.18</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.593.1">:</span></span></p> <div>
<div class="IMG---Figure" id="_idContainer357">
<span class="koboSpan" id="kobo.594.1"><img alt="" src="image/B19755_09_18.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.595.1">Figure 9.18 – Typing a single-line comment</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.596.1">Here, you can see that we’ve specified </span><strong class="source-inline"><span class="koboSpan" id="kobo.597.1">my-sample-bucket-abc123</span></strong><span class="koboSpan" id="kobo.598.1"> for the </span><strong class="source-inline"><span class="koboSpan" id="kobo.599.1">&lt;BUCKET NAME&gt;</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.600.1">placeholder value.</span></span></p></li>
</ol>
<ol>
<li value="7"><span class="koboSpan" id="kobo.601.1">Press </span><em class="italic"><span class="koboSpan" id="kobo.602.1">Enter</span></em><span class="koboSpan" id="kobo.603.1">. </span><span class="koboSpan" id="kobo.603.2">You should</span><a id="_idIndexMarker1351"/><span class="koboSpan" id="kobo.604.1"> see the following </span><a id="_idIndexMarker1352"/><span class="koboSpan" id="kobo.605.1">suggested code </span><span class="No-Break"><span class="koboSpan" id="kobo.606.1">generated automatically:</span></span>
<div>
<div class="IMG---Figure" id="_idContainer358">
<span class="koboSpan" id="kobo.607.1"><img alt="" src="image/B19755_09_19.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.608.1">Figure 9.19 – Copilot suggesting a line of code</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.609.1">Here, we</span><a id="_idIndexMarker1353"/><span class="koboSpan" id="kobo.610.1"> can see that GitHub Copilot </span><a id="_idIndexMarker1354"/><span class="koboSpan" id="kobo.611.1">suggested </span><strong class="source-inline"><span class="koboSpan" id="kobo.612.1">gsutil mb gs://$BUCKET_NAME</span></strong><span class="koboSpan" id="kobo.613.1"> for the next line in our </span><span class="No-Break"><span class="koboSpan" id="kobo.614.1">script file!</span></span></p></li>
</ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.615.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.616.1">Note that you might get a different suggestion while working on </span><span class="No-Break"><span class="koboSpan" id="kobo.617.1">this example.</span></span></p>
<ol>
<li value="8"><span class="koboSpan" id="kobo.618.1">Press </span><em class="italic"><span class="koboSpan" id="kobo.619.1">Tab</span></em><span class="koboSpan" id="kobo.620.1"> to accept the suggestion and complete </span><span class="No-Break"><span class="koboSpan" id="kobo.621.1">the code.</span></span></li>
<li><span class="koboSpan" id="kobo.622.1">Now, add the following line of code (after the existing lines of code in </span><span class="No-Break"><span class="koboSpan" id="kobo.623.1">our file):</span></span><pre class="source-code"><span class="koboSpan" id="kobo.624.1">
echo "FLAG!" </span><span class="koboSpan" id="kobo.624.2">&gt; flag.txt</span></pre></li> <li><span class="koboSpan" id="kobo.625.1">Next, type the following single-line comment (in a </span><span class="No-Break"><span class="koboSpan" id="kobo.626.1">new line):</span></span><pre class="source-code"><span class="koboSpan" id="kobo.627.1">
# Upload the flag.txt file to the Cloud Storage bucket</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.628.1">Press </span><em class="italic"><span class="koboSpan" id="kobo.629.1">Enter</span></em><span class="koboSpan" id="kobo.630.1">. </span><span class="koboSpan" id="kobo.630.2">You should see the following suggested code </span><span class="No-Break"><span class="koboSpan" id="kobo.631.1">generated automatically:</span></span></p> <div>
<div class="IMG---Figure" id="_idContainer359">
<span class="koboSpan" id="kobo.632.1"><img alt="" src="image/B19755_09_20.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.633.1">Figure 9.20 – Copilot suggesting a line of code</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.634.1">Here, we</span><a id="_idIndexMarker1355"/><span class="koboSpan" id="kobo.635.1"> can see that GitHub Copilot</span><a id="_idIndexMarker1356"/><span class="koboSpan" id="kobo.636.1"> suggested </span><strong class="source-inline"><span class="koboSpan" id="kobo.637.1">gsutil cp flag.txt gs://$BUCKET_NAME</span></strong><span class="koboSpan" id="kobo.638.1"> for the next line in our </span><span class="No-Break"><span class="koboSpan" id="kobo.639.1">script file!</span></span></p></li>
</ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.640.1">Important note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.641.1">Do not press </span><em class="italic"><span class="koboSpan" id="kobo.642.1">Tab</span></em><span class="koboSpan" id="kobo.643.1"> yet as we will be checking the other </span><span class="No-Break"><span class="koboSpan" id="kobo.644.1">suggestions first!</span></span></p>
<ol>
<li value="11"><span class="koboSpan" id="kobo.645.1">Press the right arrow key (</span><em class="italic"><span class="koboSpan" id="kobo.646.1">→</span></em><span class="koboSpan" id="kobo.647.1">) a few times to see the other suggestions, similar to what we have in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.648.1">Figure 9</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.649.1">.21</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.650.1">:</span></span>
<div>
<div class="IMG---Figure" id="_idContainer360">
<span class="koboSpan" id="kobo.651.1"><img alt="" src="image/B19755_09_21.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.652.1">Figure 9.21 – Checking the other suggestions using the arrow key</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.653.1">Press </span><em class="italic"><span class="koboSpan" id="kobo.654.1">Tab</span></em><span class="koboSpan" id="kobo.655.1"> to </span><a id="_idIndexMarker1357"/><span class="koboSpan" id="kobo.656.1">accept the suggestion and</span><a id="_idIndexMarker1358"/><span class="koboSpan" id="kobo.657.1"> complete the code. </span><span class="koboSpan" id="kobo.657.2">At this point, we have a small script ready for use! </span><span class="koboSpan" id="kobo.657.3">It is important to note that the code generated by the AI tool/extension may not always work. </span><span class="koboSpan" id="kobo.657.4">Make sure to review, run, and test the code generated thoroughly before using it in a </span><span class="No-Break"><span class="koboSpan" id="kobo.658.1">real project.</span></span></p></li>
</ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.659.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.660.1">We won’t discuss all the features of GitHub Copilot in this book. </span><span class="koboSpan" id="kobo.660.2">Feel free to check the following video (</span><em class="italic"><span class="koboSpan" id="kobo.661.1">Get Started with the Future of Coding: GitHub Copilot</span></em><span class="koboSpan" id="kobo.662.1">) for more information about this </span><span class="No-Break"><span class="koboSpan" id="kobo.663.1">topic: </span></span><a href="https://www.youtube.com/watch?v=Fi3AJZZregI"><span class="No-Break"><span class="koboSpan" id="kobo.664.1">https://www.youtube.com/watch?v=Fi3AJZZregI</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.665.1">.</span></span></p>
<h2 id="_idParaDest-199"><a id="_idTextAnchor199"/><span class="koboSpan" id="kobo.666.1">Part 2 of 3 – Accelerating Python coding with Amazon CodeWhisperer</span></h2>
<p><span class="koboSpan" id="kobo.667.1">Now, let’s try using </span><a id="_idIndexMarker1359"/><span class="koboSpan" id="kobo.668.1">Amazon CodeWhisperer</span><a id="_idIndexMarker1360"/><span class="koboSpan" id="kobo.669.1"> to assist us while we code a portion of the script we prepared in </span><span class="No-Break"><em class="italic"><a href="B19755_07.xhtml"><span class="koboSpan" id="kobo.670.1">Chapter 7</span></a></em></span><span class="koboSpan" id="kobo.671.1">, </span><em class="italic"><span class="koboSpan" id="kobo.672.1">Setting Up an IAM Privilege </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.673.1">Escalation Lab</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.674.1">:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.675.1">Let’s start by making sure that all VS Code extensions are disabled to avoid any conflict that may arise with the newly added AI-powered extensions. </span><span class="koboSpan" id="kobo.675.2">Click on the </span><strong class="bold"><span class="koboSpan" id="kobo.676.1">Extensions</span></strong><span class="koboSpan" id="kobo.677.1"> icon in the sidebar on the left side of the VS Code window. </span><span class="koboSpan" id="kobo.677.2">In the </span><strong class="bold"><span class="koboSpan" id="kobo.678.1">Extensions</span></strong><span class="koboSpan" id="kobo.679.1"> view, click the three dots (</span><strong class="bold"><span class="koboSpan" id="kobo.680.1">···</span></strong><span class="koboSpan" id="kobo.681.1">) button and select </span><strong class="bold"><span class="koboSpan" id="kobo.682.1">Disable All Installed Extensions</span></strong><span class="koboSpan" id="kobo.683.1"> from the list of options available in the </span><span class="No-Break"><span class="koboSpan" id="kobo.684.1">context menu.</span></span></li>
<li><span class="koboSpan" id="kobo.685.1">Now, let’s</span><a id="_idIndexMarker1361"/><span class="koboSpan" id="kobo.686.1"> enable </span><a id="_idIndexMarker1362"/><span class="koboSpan" id="kobo.687.1">the </span><strong class="bold"><span class="koboSpan" id="kobo.688.1">AWS Toolkit</span></strong><span class="koboSpan" id="kobo.689.1"> extension. </span><span class="koboSpan" id="kobo.689.2">In the </span><strong class="bold"><span class="koboSpan" id="kobo.690.1">EXTENSIONS: MARKETPLACE </span></strong><span class="koboSpan" id="kobo.691.1">view, we should see a search </span><a id="_idIndexMarker1363"/><span class="koboSpan" id="kobo.692.1">bar at the top. </span><span class="koboSpan" id="kobo.692.2">Type </span><strong class="source-inline"><span class="koboSpan" id="kobo.693.1">CodeWhisperer</span></strong><span class="koboSpan" id="kobo.694.1"> in this search bar to locate the extension we need </span><span class="No-Break"><span class="koboSpan" id="kobo.695.1">to enable.</span></span>
<div>
<div class="IMG---Figure" id="_idContainer361">
<span class="koboSpan" id="kobo.696.1"><img alt="" src="image/B19755_09_22.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.697.1">Figure 9.22 – Enabling the AWS Toolkit extension</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.698.1">Scroll through the list of extensions to find the </span><strong class="bold"><span class="koboSpan" id="kobo.699.1">AWS Toolkit</span></strong><span class="koboSpan" id="kobo.700.1"> extension. </span><span class="koboSpan" id="kobo.700.2">Right-click on the extension and then select </span><strong class="bold"><span class="koboSpan" id="kobo.701.1">Enable</span></strong><span class="koboSpan" id="kobo.702.1"> from the list of options available in the </span><span class="No-Break"><span class="koboSpan" id="kobo.703.1">context menu.</span></span></p></li>
</ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.704.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.705.1">When prompted with the message </span><strong class="bold"><span class="koboSpan" id="kobo.706.1">Connection expired. </span><span class="koboSpan" id="kobo.706.2">To continue using CodeWhisperer, connect with AWS Builder ID or AWS IAM Identity center.</span></strong><span class="koboSpan" id="kobo.707.1">, click the </span><strong class="bold"><span class="koboSpan" id="kobo.708.1">Connect with AWS</span></strong><span class="koboSpan" id="kobo.709.1"> button and ensure that the setup is complete </span><span class="No-Break"><span class="koboSpan" id="kobo.710.1">before proceeding.</span></span></p>
<ol>
<li value="3"><span class="koboSpan" id="kobo.711.1">With our AI-powered extension enabled already, let’s proceed by creating a new file </span><span class="No-Break"><span class="koboSpan" id="kobo.712.1">named </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.713.1">whisperer.py</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.714.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.715.1">Let’s start </span><a id="_idIndexMarker1364"/><span class="koboSpan" id="kobo.716.1">by typing the </span><a id="_idIndexMarker1365"/><span class="koboSpan" id="kobo.717.1">following single-line comment (in the </span><span class="No-Break"><span class="koboSpan" id="kobo.718.1">first line):</span></span><pre class="source-code"><span class="koboSpan" id="kobo.719.1">
# Function that uses boto3 to return the STS caller identity</span></pre></li> <li><span class="koboSpan" id="kobo.720.1">Press </span><em class="italic"><span class="koboSpan" id="kobo.721.1">Enter</span></em><span class="koboSpan" id="kobo.722.1">. </span><span class="koboSpan" id="kobo.722.2">You should see the following suggested code (or similar) </span><span class="No-Break"><span class="koboSpan" id="kobo.723.1">generated automatically:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.724.1">
get_caller_identity():</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.725.1">Note that you might get a different suggestion while working on </span><span class="No-Break"><span class="koboSpan" id="kobo.726.1">this example.</span></span></p></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.727.1">Important note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.728.1">Do not press </span><em class="italic"><span class="koboSpan" id="kobo.729.1">Tab</span></em><span class="koboSpan" id="kobo.730.1"> yet as we will be checking the other </span><span class="No-Break"><span class="koboSpan" id="kobo.731.1">suggestions first!</span></span></p>
<ol>
<li value="6"><span class="koboSpan" id="kobo.732.1">Press the right arrow key (</span><em class="italic"><span class="koboSpan" id="kobo.733.1">→</span></em><span class="koboSpan" id="kobo.734.1">) a few times to see the other suggestions, similar to what we have in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.735.1">Figure 9</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.736.1">.23</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.737.1">:</span></span>
<div>
<div class="IMG---Figure" id="_idContainer362">
<span class="koboSpan" id="kobo.738.1"><img alt="" src="image/B19755_09_23.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.739.1">Figure 9.23 – Checking the other suggestions using the arrow key</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.740.1">Here, we can see that accepting the current suggested block of code would automatically add </span><strong class="source-inline"><span class="koboSpan" id="kobo.741.1">import boto3</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.742.1">as well.</span></span></p></li>
</ol>
<ol>
<li value="7"><span class="koboSpan" id="kobo.743.1">Press </span><em class="italic"><span class="koboSpan" id="kobo.744.1">Tab</span></em><span class="koboSpan" id="kobo.745.1"> to accept the suggestion and complete </span><span class="No-Break"><span class="koboSpan" id="kobo.746.1">the code.</span></span></li>
<li><span class="koboSpan" id="kobo.747.1">In a new line, type </span><strong class="source-inline"><span class="koboSpan" id="kobo.748.1">if</span></strong><span class="koboSpan" id="kobo.749.1"> with a space after it (similar to what is shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.750.1">Figure 9</span></em></span><em class="italic"><span class="koboSpan" id="kobo.751.1">.24</span></em><span class="koboSpan" id="kobo.752.1">). </span><span class="koboSpan" id="kobo.752.2">You should see Amazon Whisperer suggesting lines of code that would call the function we </span><span class="No-Break"><span class="koboSpan" id="kobo.753.1">just defined:</span></span>
<div>
<div class="IMG---Figure" id="_idContainer363">
<span class="koboSpan" id="kobo.754.1"><img alt="" src="image/B19755_09_24.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.755.1">Figure 9.24 – More code suggestions from Amazon CodeWhisperer</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.756.1">Press </span><em class="italic"><span class="koboSpan" id="kobo.757.1">Tab</span></em><span class="koboSpan" id="kobo.758.1"> to accept the suggestion and complete the code. </span><span class="koboSpan" id="kobo.758.2">At this point, we have a small </span><a id="_idIndexMarker1366"/><span class="koboSpan" id="kobo.759.1">Python script</span><a id="_idIndexMarker1367"/><span class="koboSpan" id="kobo.760.1"> ready for use! </span><span class="koboSpan" id="kobo.760.2">It is important to note that the code generated by the AI tools and extensions</span><a id="_idIndexMarker1368"/><span class="koboSpan" id="kobo.761.1"> may not always work. </span><span class="koboSpan" id="kobo.761.2">Make sure to review, run, and test the code generated thoroughly</span><a id="_idIndexMarker1369"/><span class="koboSpan" id="kobo.762.1"> before using it in a </span><span class="No-Break"><span class="koboSpan" id="kobo.763.1">real project.</span></span></p></li>
</ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.764.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.765.1">We won’t dive deep into the features of Amazon CodeWhisperer in this book. </span><span class="koboSpan" id="kobo.765.2">Feel free to check the following video (</span><em class="italic"><span class="koboSpan" id="kobo.766.1">Amazon CodeWhisperer Overview</span></em><span class="koboSpan" id="kobo.767.1">) for more information about this </span><span class="No-Break"><span class="koboSpan" id="kobo.768.1">topic: </span></span><a href="https://www.youtube.com/watch?v=j8BoVmHKFlI"><span class="No-Break"><span class="koboSpan" id="kobo.769.1">https://www.youtube.com/watch?v=j8BoVmHKFlI</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.770.1">.</span></span></p>
<h2 id="_idParaDest-200"><a id="_idTextAnchor200"/><span class="koboSpan" id="kobo.771.1">Part 3 of 3 – Coding PowerShell scripts faster with Tabnine Pro</span></h2>
<p><span class="koboSpan" id="kobo.772.1">Now, let’s try using</span><a id="_idIndexMarker1370"/><span class="koboSpan" id="kobo.773.1"> Tabnine Pro to accelerate the preparation</span><a id="_idIndexMarker1371"/><span class="koboSpan" id="kobo.774.1"> of a sample PowerShell script that can help us review and manage the resources running in our Microsoft </span><span class="No-Break"><span class="koboSpan" id="kobo.775.1">Azure account:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.776.1">Let’s </span><a id="_idIndexMarker1372"/><span class="koboSpan" id="kobo.777.1">start by making sure that all </span><a id="_idIndexMarker1373"/><span class="koboSpan" id="kobo.778.1">VS Code extensions are disabled to avoid any conflict that may arise with the newly added AI-powered extensions. </span><span class="koboSpan" id="kobo.778.2">Click on the </span><strong class="bold"><span class="koboSpan" id="kobo.779.1">Extensions</span></strong><span class="koboSpan" id="kobo.780.1"> icon in the sidebar on the left side of the VS Code window. </span><span class="koboSpan" id="kobo.780.2">In the </span><strong class="bold"><span class="koboSpan" id="kobo.781.1">Extensions</span></strong><span class="koboSpan" id="kobo.782.1"> view, click the three dots (</span><strong class="bold"><span class="koboSpan" id="kobo.783.1">···</span></strong><span class="koboSpan" id="kobo.784.1">) button and select </span><strong class="bold"><span class="koboSpan" id="kobo.785.1">Disable All Installed Extensions</span></strong><span class="koboSpan" id="kobo.786.1"> from the list of options available in the </span><span class="No-Break"><span class="koboSpan" id="kobo.787.1">context menu.</span></span></li>
<li><span class="koboSpan" id="kobo.788.1">Now, let’s enable the </span><strong class="bold"><span class="koboSpan" id="kobo.789.1">Tabnine</span></strong><span class="koboSpan" id="kobo.790.1"> extension. </span><span class="koboSpan" id="kobo.790.2">In the </span><strong class="bold"><span class="koboSpan" id="kobo.791.1">EXTENSIONS: MARKETPLACE</span></strong><span class="koboSpan" id="kobo.792.1"> view, we should see a search bar at the top. </span><span class="koboSpan" id="kobo.792.2">Type </span><strong class="source-inline"><span class="koboSpan" id="kobo.793.1">Tabnine</span></strong><span class="koboSpan" id="kobo.794.1"> in this search bar to locate the extension we need </span><span class="No-Break"><span class="koboSpan" id="kobo.795.1">to enable.</span></span>
<div>
<div class="IMG---Figure" id="_idContainer364">
<span class="koboSpan" id="kobo.796.1"><img alt="" src="image/B19755_09_25.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.797.1">Figure 9.25 – Enabling the Tabnine extension</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.798.1">Scroll through the list of extensions to find the </span><strong class="bold"><span class="koboSpan" id="kobo.799.1">Tabnine: AI Autocomplete &amp; Chat for Javascript, Python, Typescript, PHP, Go, Java &amp; more</span></strong><span class="koboSpan" id="kobo.800.1"> extension. </span><span class="koboSpan" id="kobo.800.2">Right-click on the extension and then select </span><strong class="bold"><span class="koboSpan" id="kobo.801.1">Enable</span></strong><span class="koboSpan" id="kobo.802.1"> from the list of options available in the </span><span class="No-Break"><span class="koboSpan" id="kobo.803.1">context menu.</span></span></p></li>
</ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.804.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.805.1">Make sure that the setup is complete before proceeding. </span><span class="koboSpan" id="kobo.805.2">In some cases, VS Code may prompt you to restart the application. </span><span class="koboSpan" id="kobo.805.3">If prompted, go ahead and restart </span><span class="No-Break"><span class="koboSpan" id="kobo.806.1">VS Code.</span></span></p>
<ol>
<li value="3"><span class="koboSpan" id="kobo.807.1">With</span><a id="_idIndexMarker1374"/><span class="koboSpan" id="kobo.808.1"> our AI-powered extension</span><a id="_idIndexMarker1375"/><span class="koboSpan" id="kobo.809.1"> enabled already, let’s proceed by creating a new file </span><span class="No-Break"><span class="koboSpan" id="kobo.810.1">named </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.811.1">tabnine.ps1</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.812.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.813.1">Type the following single-line comment in the first line of </span><span class="No-Break"><span class="koboSpan" id="kobo.814.1">our script:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.815.1">
# List all resource groups in the Azure account using the Azure CLI</span></pre></li> <li><span class="koboSpan" id="kobo.816.1">Press </span><em class="italic"><span class="koboSpan" id="kobo.817.1">Enter</span></em><span class="koboSpan" id="kobo.818.1">. </span><span class="koboSpan" id="kobo.818.2">You should see the following suggested code (or similar) </span><span class="No-Break"><span class="koboSpan" id="kobo.819.1">generated automatically:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.820.1">
az group list --output table</span></pre><p class="list-inset"><span class="No-Break"><span class="koboSpan" id="kobo.821.1">Amazing, right?</span></span></p></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.822.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.823.1">Note that you might get a different suggestion while working on </span><span class="No-Break"><span class="koboSpan" id="kobo.824.1">this example.</span></span></p>
<ol>
<li value="6"><span class="koboSpan" id="kobo.825.1">Press </span><em class="italic"><span class="koboSpan" id="kobo.826.1">Tab</span></em><span class="koboSpan" id="kobo.827.1"> to accept the suggestion and complete </span><span class="No-Break"><span class="koboSpan" id="kobo.828.1">the code.</span></span></li>
<li><span class="koboSpan" id="kobo.829.1">Now, type the following comment in a </span><span class="No-Break"><span class="koboSpan" id="kobo.830.1">new line:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.831.1">
# For each resource group, list down all resources inside</span></pre></li> <li><span class="koboSpan" id="kobo.832.1">Press </span><em class="italic"><span class="koboSpan" id="kobo.833.1">Enter</span></em><span class="koboSpan" id="kobo.834.1">. </span><span class="koboSpan" id="kobo.834.2">You should see the following suggested code </span><span class="No-Break"><span class="koboSpan" id="kobo.835.1">generated automatically:</span></span>
<div>
<div class="IMG---Figure" id="_idContainer365">
<span class="koboSpan" id="kobo.836.1"><img alt="" src="image/B19755_09_26.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.837.1">Figure 9.26 – Tabnine suggesting a line of code</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.838.1">Here, we can see one of the suggestions generated by Tabnine. </span><span class="koboSpan" id="kobo.838.2">Note that you might get a different suggestion while working on </span><span class="No-Break"><span class="koboSpan" id="kobo.839.1">this example.</span></span></p></li>
</ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.840.1">Important note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.841.1">Do not press </span><em class="italic"><span class="koboSpan" id="kobo.842.1">Tab</span></em><span class="koboSpan" id="kobo.843.1"> yet as we will be checking the other </span><span class="No-Break"><span class="koboSpan" id="kobo.844.1">suggestions first!</span></span></p>
<ol>
<li value="9"><span class="koboSpan" id="kobo.845.1">Press the </span><a id="_idIndexMarker1376"/><span class="koboSpan" id="kobo.846.1">right arrow key (</span><em class="italic"><span class="koboSpan" id="kobo.847.1">→</span></em><span class="koboSpan" id="kobo.848.1">) a few </span><a id="_idIndexMarker1377"/><span class="koboSpan" id="kobo.849.1">times to see other suggestions, similar to what we have in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.850.1">Figure 9</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.851.1">.27</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.852.1">:</span></span>
<div>
<div class="IMG---Figure" id="_idContainer366">
<span class="koboSpan" id="kobo.853.1"><img alt="" src="image/B19755_09_27.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.854.1">Figure 9.27 – Checking the other suggestions using the arrow key</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.855.1">Press </span><em class="italic"><span class="koboSpan" id="kobo.856.1">Tab</span></em><span class="koboSpan" id="kobo.857.1"> to accept a suggestion similar to what we have in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.858.1">Figure 9</span></em></span><em class="italic"><span class="koboSpan" id="kobo.859.1">.27</span></em><span class="koboSpan" id="kobo.860.1">. </span><span class="koboSpan" id="kobo.860.2">If there’s an extra line (at the end) with triple backticks (</span><strong class="source-inline"><span class="koboSpan" id="kobo.861.1">```</span></strong><span class="koboSpan" id="kobo.862.1">), feel free to delete the extra line manually. </span><span class="koboSpan" id="kobo.862.2">At this point, we have a small PowerShell script ready for use! </span><span class="koboSpan" id="kobo.862.3">It is important to note that the code generated by the AI tool/extension may not always work. </span><span class="koboSpan" id="kobo.862.4">Make sure to review, run, and test the code generated thoroughly before using it in a </span><span class="No-Break"><span class="koboSpan" id="kobo.863.1">real project.</span></span></p></li>
</ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.864.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.865.1">We won’t dive deep into the features of Tabnine in this book. </span><span class="koboSpan" id="kobo.865.2">Feel free to check the following video (</span><em class="italic"><span class="koboSpan" id="kobo.866.1">Become a Tabnine expert in 40 minutes!</span></em><span class="koboSpan" id="kobo.867.1">) for more information about this </span><span class="No-Break"><span class="koboSpan" id="kobo.868.1">topic: </span></span><a href="https://www.youtube.com/watch?v=XXERCwezdsQ"><span class="No-Break"><span class="koboSpan" id="kobo.869.1">https://www.youtube.com/watch?v=XXERCwezdsQ</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.870.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.871.1">At this point, we </span><a id="_idIndexMarker1378"/><span class="koboSpan" id="kobo.872.1">should have a good idea of how to use </span><a id="_idIndexMarker1379"/><span class="koboSpan" id="kobo.873.1">AI-powered tools to accelerate the preparation of automation scripts for building our penetration testing lab environments. </span><span class="koboSpan" id="kobo.873.2">Given the time-consuming nature of manually coding automation scripts, these tools will allow us to build complex lab environments faster. </span><span class="koboSpan" id="kobo.873.3">In addition to using AI-powered tools that suggest blocks of code automatically for us, we can also utilize various tools that automatically format our code to help us manage and maintain code quality. </span><span class="koboSpan" id="kobo.873.4">By using these tools, we can reduce potential errors and enhance the overall readability of our code </span><span class="No-Break"><span class="koboSpan" id="kobo.874.1">as well.</span></span></p>
<p><span class="koboSpan" id="kobo.875.1">In the next section, we will take a closer look at how AI-powered solutions can automatically generate IaC templates for us. </span><span class="koboSpan" id="kobo.875.2">In addition to this, we’ll see how these solutions can also be used to explain existing code prepared by other engineers </span><span class="No-Break"><span class="koboSpan" id="kobo.876.1">or developers.</span></span></p>
<h1 id="_idParaDest-201"><a id="_idTextAnchor201"/><span class="koboSpan" id="kobo.877.1">Using AI-powered solutions to generate and explain IaC template code</span></h1>
<p><span class="koboSpan" id="kobo.878.1">In the</span><a id="_idIndexMarker1380"/><span class="koboSpan" id="kobo.879.1"> previous chapters</span><a id="_idIndexMarker1381"/><span class="koboSpan" id="kobo.880.1"> of this book, we manually prepared the Terraform template code for setting up various penetration testing lab environments on AWS, Azure, and GCP. </span><span class="koboSpan" id="kobo.880.2">If you’ve actually worked on the hands-on examples and solutions in the previous chapters, you are probably aware that it takes a significant amount of time to code and prepare these IaC templates from scratch! </span><span class="koboSpan" id="kobo.880.3">To accelerate the preparation of IaC template code, we can use AI-powered solutions to generate code automatically using the right set of prompts. </span><span class="koboSpan" id="kobo.880.4">In addition to this, we can use these tools to explain existing code </span><span class="No-Break"><span class="koboSpan" id="kobo.881.1">as well.</span></span></p>
<p><span class="koboSpan" id="kobo.882.1">In this section, we will take a closer look at how AI-powered solutions such as ChatGPT and GitHub Copilot Labs can be used to generate and explain IaC template code. </span><span class="koboSpan" id="kobo.882.2">You’ll see how we can use these tools to significantly speed up the process of reading and </span><span class="No-Break"><span class="koboSpan" id="kobo.883.1">writing code.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.884.1">Important note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.885.1">Make sure that you have a </span><strong class="bold"><span class="koboSpan" id="kobo.886.1">ChatGPT Plus</span></strong><span class="koboSpan" id="kobo.887.1"> account</span><a id="_idIndexMarker1382"/><span class="koboSpan" id="kobo.888.1"> ready before proceeding. </span><span class="koboSpan" id="kobo.888.2">In addition to this, make sure that the </span><strong class="bold"><span class="koboSpan" id="kobo.889.1">GitHub Copilot Labs</span></strong><span class="koboSpan" id="kobo.890.1"> extension</span><a id="_idIndexMarker1383"/><span class="koboSpan" id="kobo.891.1"> is set up (completely), as specified in the </span><em class="italic"><span class="koboSpan" id="kobo.892.1">Technical requirements</span></em><span class="koboSpan" id="kobo.893.1"> section at the start of </span><span class="No-Break"><span class="koboSpan" id="kobo.894.1">this chapter.</span></span></p>
<p><span class="koboSpan" id="kobo.895.1">Let’s proceed with using these AI-powered tools in the next set </span><span class="No-Break"><span class="koboSpan" id="kobo.896.1">of steps.</span></span></p>
<h2 id="_idParaDest-202"><a id="_idTextAnchor202"/><span class="koboSpan" id="kobo.897.1">Part 1 of 2 – Using ChatGPT to generate Terraform templates</span></h2>
<ol>
<li><span class="koboSpan" id="kobo.898.1">In a new </span><a id="_idIndexMarker1384"/><span class="koboSpan" id="kobo.899.1">browser tab, access your </span><strong class="bold"><span class="koboSpan" id="kobo.900.1">ChatGPT Plus</span></strong><span class="koboSpan" id="kobo.901.1"> account </span><a id="_idIndexMarker1385"/><span class="koboSpan" id="kobo.902.1">using the following URL: </span><a href="https://chat.openai.com/"><span class="koboSpan" id="kobo.903.1">https://chat.openai.com/</span></a><span class="koboSpan" id="kobo.904.1">. </span><span class="koboSpan" id="kobo.904.2">Ensure that you configure your account to have </span><strong class="bold"><span class="koboSpan" id="kobo.905.1">Advanced Data Analysis</span></strong><span class="koboSpan" id="kobo.906.1"> enabled </span><span class="No-Break"><span class="koboSpan" id="kobo.907.1">before proceeding.</span></span></li>
<li><span class="koboSpan" id="kobo.908.1">Create </span><a id="_idIndexMarker1386"/><span class="koboSpan" id="kobo.909.1">a new chat session</span><a id="_idIndexMarker1387"/><span class="koboSpan" id="kobo.910.1"> and select </span><strong class="bold"><span class="koboSpan" id="kobo.911.1">GPT-4</span></strong><span class="koboSpan" id="kobo.912.1"> (or the latest model available exclusively to ChatGPT </span><span class="No-Break"><span class="koboSpan" id="kobo.913.1">Plus users):</span></span>
<div>
<div class="IMG---Figure" id="_idContainer367">
<span class="koboSpan" id="kobo.914.1"><img alt="" src="image/B19755_09_28.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.915.1">Figure 9.28 – Selecting GPT-4 and Advanced Data Analysis for our chat session</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.916.1">Make sure that </span><strong class="bold"><span class="koboSpan" id="kobo.917.1">Advanced Data Analysis</span></strong><span class="koboSpan" id="kobo.918.1"> is selected (instead of </span><strong class="bold"><span class="koboSpan" id="kobo.919.1">Default</span></strong><span class="koboSpan" id="kobo.920.1">), similar to what we have in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.921.1">Figure 9</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.922.1">.28</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.923.1">.</span></span></p></li>
</ol>
<ol>
<li value="3"><span class="koboSpan" id="kobo.924.1">Now, type the following prompt inside the </span><span class="No-Break"><span class="koboSpan" id="kobo.925.1">text bar:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.926.1">
Generate Terraform code to create the following resources in GCP:
- a VPC named vpc-01 with a single subnet subnet-01
- the VPC vpc-01 should have the auto create subnetworks configuration set to false
- the subnet subnet-01 should have the following IP CIDR range: 10.1.0.0/20
Make sure that the generated Terraform code is valid</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.927.1">Press the </span><em class="italic"><span class="koboSpan" id="kobo.928.1">Enter</span></em><span class="koboSpan" id="kobo.929.1"> key afterward to submit the prompt. </span><span class="koboSpan" id="kobo.929.2">This should yield a response</span><a id="_idIndexMarker1388"/><span class="koboSpan" id="kobo.930.1"> similar to what is </span><a id="_idIndexMarker1389"/><span class="koboSpan" id="kobo.931.1">shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.932.1">Figure 9</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.933.1">.29</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.934.1">:</span></span></p> <div>
<div class="IMG---Figure" id="_idContainer368">
<span class="koboSpan" id="kobo.935.1"><img alt="" src="image/B19755_09_29.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.936.1">Figure 9.29 – Generating Terraform template code using ChatGPT</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.937.1">Here, we can see that ChatGPT was able to generate the Terraform template code using the prompt we just submitted. </span><span class="No-Break"><span class="koboSpan" id="kobo.938.1">Amazing, right?</span></span></p></li>
</ol>
<ol>
<li value="4"><span class="koboSpan" id="kobo.939.1">Let’s build </span><a id="_idIndexMarker1390"/><span class="koboSpan" id="kobo.940.1">on top of the previous </span><a id="_idIndexMarker1391"/><span class="koboSpan" id="kobo.941.1">answer and enter the </span><span class="No-Break"><span class="koboSpan" id="kobo.942.1">following prompt:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.943.1">
Update the previous answer by using "us-central1" for the region</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.944.1">This will yield the</span><a id="_idIndexMarker1392"/><span class="koboSpan" id="kobo.945.1"> following response </span><a id="_idIndexMarker1393"/><span class="No-Break"><span class="koboSpan" id="kobo.946.1">from ChatGPT:</span></span></p> <div>
<div class="IMG---Figure" id="_idContainer369">
<span class="koboSpan" id="kobo.947.1"><img alt="" src="image/B19755_09_30.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.948.1">Figure 9.30 – Building on top of the previous answer</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.949.1">We can see in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.950.1">Figure 9</span></em></span><em class="italic"><span class="koboSpan" id="kobo.951.1">.30</span></em><span class="koboSpan" id="kobo.952.1"> that we were able to successfully modify the code from the previous answer using the prompt we </span><span class="No-Break"><span class="koboSpan" id="kobo.953.1">just entered.</span></span></p></li>
</ol>
<ol>
<li value="5"><span class="koboSpan" id="kobo.954.1">Finally, let’s have ChatGPT draw a diagram for us using the </span><span class="No-Break"><span class="koboSpan" id="kobo.955.1">following prompt:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.956.1">
Draw a diagram to help visualize how this network environment looks like</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.957.1">This </span><a id="_idIndexMarker1394"/><span class="koboSpan" id="kobo.958.1">should give us the </span><span class="No-Break"><span class="koboSpan" id="kobo.959.1">following </span></span><span class="No-Break"><a id="_idIndexMarker1395"/></span><span class="No-Break"><span class="koboSpan" id="kobo.960.1">output:</span></span></p> <div>
<div class="IMG---Figure" id="_idContainer370">
<span class="koboSpan" id="kobo.961.1"><img alt="" src="image/B19755_09_31.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.962.1">Figure 9.31 – Network environment diagram</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.963.1">Here, we </span><a id="_idIndexMarker1396"/><span class="koboSpan" id="kobo.964.1">can see that ChatGPT is </span><a id="_idIndexMarker1397"/><span class="koboSpan" id="kobo.965.1">able to draw a simple diagram to help us visualize what our network environment looks like. </span><span class="koboSpan" id="kobo.965.2">You may click the </span><strong class="bold"><span class="koboSpan" id="kobo.966.1">Show work</span></strong><span class="koboSpan" id="kobo.967.1"> button to view the code used to construct </span><span class="No-Break"><span class="koboSpan" id="kobo.968.1">the diagram.</span></span></p></li>
</ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.969.1">Important note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.970.1">Feel free to use Terraform to convert the generated template code into actual resources in your GCP account. </span><span class="koboSpan" id="kobo.970.2">Note that the </span><strong class="bold"><span class="koboSpan" id="kobo.971.1">Compute Engine API</span></strong><span class="koboSpan" id="kobo.972.1"> must </span><a id="_idIndexMarker1398"/><span class="koboSpan" id="kobo.973.1">first be enabled before using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.974.1">terraform apply</span></strong><span class="koboSpan" id="kobo.975.1"> command to create </span><span class="No-Break"><span class="koboSpan" id="kobo.976.1">the resources.</span></span></p>
<h2 id="_idParaDest-203"><a id="_idTextAnchor203"/><span class="koboSpan" id="kobo.977.1">Part 2 of 2 – Using GitHub Copilot Labs to explain existing Terraform templates</span></h2>
<p><span class="koboSpan" id="kobo.978.1">Now, let’s use </span><a id="_idIndexMarker1399"/><span class="koboSpan" id="kobo.979.1">GitHub </span><a id="_idIndexMarker1400"/><span class="koboSpan" id="kobo.980.1">Copilot Labs to explain the existing Terraform template code. </span><span class="koboSpan" id="kobo.980.2">Let’s start by making sure that all VS Code extensions are disabled to avoid any conflict that may arise with the newly added </span><span class="No-Break"><span class="koboSpan" id="kobo.981.1">AI-powered extensions</span></span><span class="No-Break"><span class="koboSpan" id="kobo.982.1">:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.983.1">Click on the </span><strong class="bold"><span class="koboSpan" id="kobo.984.1">Extensions</span></strong><span class="koboSpan" id="kobo.985.1"> icon in the sidebar on the left side of the VS Code window. </span><span class="koboSpan" id="kobo.985.2">In the </span><strong class="bold"><span class="koboSpan" id="kobo.986.1">Extensions</span></strong><span class="koboSpan" id="kobo.987.1"> view, click the three dots (</span><strong class="bold"><span class="koboSpan" id="kobo.988.1">···</span></strong><span class="koboSpan" id="kobo.989.1">) button and select </span><strong class="bold"><span class="koboSpan" id="kobo.990.1">Disable All Installed Extensions</span></strong><span class="koboSpan" id="kobo.991.1"> from the list of options available in the </span><span class="No-Break"><span class="koboSpan" id="kobo.992.1">context menu.</span></span></li>
<li><span class="koboSpan" id="kobo.993.1">Now, let’s enable the GitHub Copilot Labs extension. </span><span class="koboSpan" id="kobo.993.2">In the </span><strong class="bold"><span class="koboSpan" id="kobo.994.1">EXTENSIONS: MARKETPLACE</span></strong><span class="koboSpan" id="kobo.995.1"> view, we should see a search bar at the top. </span><span class="koboSpan" id="kobo.995.2">Type </span><strong class="source-inline"><span class="koboSpan" id="kobo.996.1">GitHub Copilot Labs</span></strong><span class="koboSpan" id="kobo.997.1"> in this search bar to locate the extension we need </span><span class="No-Break"><span class="koboSpan" id="kobo.998.1">to enable.</span></span>
<div>
<div class="IMG---Figure" id="_idContainer371">
<span class="koboSpan" id="kobo.999.1"><img alt="" src="image/B19755_09_32.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1000.1">Figure 9.32 – Enabling the GitHub Copilot Labs extension</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.1001.1">Scroll through the list of extensions to find the </span><strong class="bold"><span class="koboSpan" id="kobo.1002.1">GitHub Copilot Labs</span></strong><span class="koboSpan" id="kobo.1003.1"> extension. </span><span class="koboSpan" id="kobo.1003.2">Right-click on the extension and then select </span><strong class="bold"><span class="koboSpan" id="kobo.1004.1">Enable</span></strong><span class="koboSpan" id="kobo.1005.1"> from the list of options available in the </span><span class="No-Break"><span class="koboSpan" id="kobo.1006.1">context menu.</span></span></p></li>
</ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.1007.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.1008.1">Make sure that the setup is complete before proceeding. </span><span class="koboSpan" id="kobo.1008.2">In some cases, VS Code may prompt you to restart the application. </span><span class="koboSpan" id="kobo.1008.3">If prompted, go ahead and restart </span><span class="No-Break"><span class="koboSpan" id="kobo.1009.1">VS Code.</span></span></p>
<ol>
<li value="3"><span class="koboSpan" id="kobo.1010.1">With the </span><a id="_idIndexMarker1401"/><span class="koboSpan" id="kobo.1011.1">extension</span><a id="_idIndexMarker1402"/><span class="koboSpan" id="kobo.1012.1"> enabled, let’s proceed by creating a new file in VS Code </span><span class="No-Break"><span class="koboSpan" id="kobo.1013.1">named </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1014.1">copilot_labs.tf</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1015.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.1016.1">Navigate to this book’s GitHub repository and locate the resource block for defining the attacker VM instance in </span><span class="No-Break"><em class="italic"><a href="B19755_04.xhtml"><span class="koboSpan" id="kobo.1017.1">Chapter 4</span></a></em></span><span class="koboSpan" id="kobo.1018.1">, </span><em class="italic"><span class="koboSpan" id="kobo.1019.1">Setting Up Isolated Penetration Testing Lab Environments on GCP</span></em><span class="koboSpan" id="kobo.1020.1">. </span><span class="koboSpan" id="kobo.1020.2">Feel free to use the following link to help you locate the </span><span class="No-Break"><span class="koboSpan" id="kobo.1021.1">ZIP file:</span></span><pre class="source-code">
<a href="https://github.com/PacktPublishing/Building-and-Automating-Penetration-Testing-Labs-in-the-Cloud/blob/main/ch04/pentest_lab/attacker_vm/main.tf"><span class="koboSpan" id="kobo.1022.1">https://github.com/PacktPublishing/Building-and-Automating-Penetration-Testing-Labs-in-the-Cloud/blob/main/ch04/pentest_lab/attacker_vm/main.tf</span></a></pre></li> <li><span class="koboSpan" id="kobo.1023.1">Copy the code (from the browser) and paste the Terraform template code to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1024.1">copilot_labs.tf</span></strong><span class="koboSpan" id="kobo.1025.1"> file (in VS Code) we created in an </span><span class="No-Break"><span class="koboSpan" id="kobo.1026.1">earlier step.</span></span></li>
<li><span class="koboSpan" id="kobo.1027.1">Click the </span><strong class="bold"><span class="koboSpan" id="kobo.1028.1">GitHub Copilot Labs</span></strong><span class="koboSpan" id="kobo.1029.1"> icon in the sidebar on the left side of the VS </span><span class="No-Break"><span class="koboSpan" id="kobo.1030.1">Code window.</span></span></li>
<li><span class="koboSpan" id="kobo.1031.1">Highlight the code corresponding to the resource block for creating the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1032.1">vm-kali</span></strong><span class="koboSpan" id="kobo.1033.1"> attacker </span><span class="No-Break"><span class="koboSpan" id="kobo.1034.1">VM instance:</span></span>
<div>
<div class="IMG---Figure" id="_idContainer372">
<span class="koboSpan" id="kobo.1035.1"><img alt="" src="image/B19755_09_33.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1036.1">Figure 9.33 – Explaining the highlighted code with GitHub Copilot Labs</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.1037.1">Make sure </span><a id="_idIndexMarker1403"/><span class="koboSpan" id="kobo.1038.1">that </span><strong class="bold"><span class="koboSpan" id="kobo.1039.1">Explain code</span></strong><span class="koboSpan" id="kobo.1040.1"> is selected before clicking the </span><strong class="bold"><span class="koboSpan" id="kobo.1041.1">Ask Copilot</span></strong><span class="koboSpan" id="kobo.1042.1"> button. </span><span class="koboSpan" id="kobo.1042.2">Clicking</span><a id="_idIndexMarker1404"/><span class="koboSpan" id="kobo.1043.1"> the </span><strong class="bold"><span class="koboSpan" id="kobo.1044.1">Ask Copilot</span></strong><span class="koboSpan" id="kobo.1045.1"> button will produce the </span><span class="No-Break"><span class="koboSpan" id="kobo.1046.1">following result:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer373">
<span class="koboSpan" id="kobo.1047.1"><img alt="" src="image/B19755_09_34.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1048.1">Figure 9.34 – Result after clicking the Ask Copilot button</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.1049.1">Here, we can see that we are able to use GitHub Copilot to help us interpret and explain an existing block of code. </span><span class="koboSpan" id="kobo.1049.2">Imagine using this on longer and more complex code bases! </span><span class="koboSpan" id="kobo.1049.3">Amazing, right? </span><span class="koboSpan" id="kobo.1049.4">Reading code is equally as important as writing code. </span><span class="koboSpan" id="kobo.1049.5">As you get to work with a larger team while building complex penetration testing lab environments, you’ll realize that you’ll be spending more time reading</span><a id="_idIndexMarker1405"/><span class="koboSpan" id="kobo.1050.1"> code (written by other members) than writing </span><a id="_idIndexMarker1406"/><span class="No-Break"><span class="koboSpan" id="kobo.1051.1">new code.</span></span></p></li>
</ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.1052.1">Important note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.1053.1">We won’t dive deep into the features of the GitHub Copilot Labs extension in this book. </span><span class="koboSpan" id="kobo.1053.2">Feel free to check the following link for more information on this </span><span class="No-Break"><span class="koboSpan" id="kobo.1054.1">topic: </span></span><a href="https://githubnext.com/projects/copilot-labs/"><span class="No-Break"><span class="koboSpan" id="kobo.1055.1">https://githubnext.com/projects/copilot-labs/</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.1056.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.1057.1">At this point, we should have a good idea of how AI-powered tools can help us read and write IaC template code faster. </span><span class="koboSpan" id="kobo.1057.2">Before we end this section, it is important to note that while these tools can certainly speed up the generation and interpretation of code, their output may sometimes contain inaccuracies, suboptimal configurations, or even security vulnerabilities. </span><span class="koboSpan" id="kobo.1057.3">That said, it is essential that we exercise caution when using </span><span class="No-Break"><span class="koboSpan" id="kobo.1058.1">these tools.</span></span></p>
<h1 id="_idParaDest-204"><a id="_idTextAnchor204"/><span class="koboSpan" id="kobo.1059.1">Recognizing relevant considerations and practical strategies when building and automating lab environments</span></h1>
<p><span class="koboSpan" id="kobo.1060.1">We are down</span><a id="_idIndexMarker1407"/><span class="koboSpan" id="kobo.1061.1"> to the last major section of this book! </span><span class="koboSpan" id="kobo.1061.2">In the previous few sections of this chapter, we learned how to use various AI-powered solutions and tools to accelerate and automate relevant tasks when building lab environments. </span><span class="koboSpan" id="kobo.1061.3">In addition to the strategies and solutions we have discussed already, we have a few more considerations and recommended practices we must take into account when building penetration testing lab environments in </span><span class="No-Break"><span class="koboSpan" id="kobo.1062.1">the cloud.</span></span></p>
<p><span class="koboSpan" id="kobo.1063.1">Here is a quick list of the things we should consider and plan for when designing </span><span class="No-Break"><span class="koboSpan" id="kobo.1064.1">lab environments:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.1065.1">Identifying the purpose of the lab</span></strong><span class="koboSpan" id="kobo.1066.1">: Before designing and building a lab environment, it is important that we identify why we are building the lab in the first place. </span><span class="koboSpan" id="kobo.1066.2">We need to know how the lab will be used as this will dictate the necessary resources and configurations required for the lab environment. </span><span class="koboSpan" id="kobo.1066.3">For one thing, it’s possible that we could be building a lab environment specifically for </span><a id="_idIndexMarker1408"/><span class="koboSpan" id="kobo.1067.1">practicing </span><strong class="bold"><span class="koboSpan" id="kobo.1068.1">exploit development</span></strong><span class="koboSpan" id="kobo.1069.1">. </span><span class="koboSpan" id="kobo.1069.2">Maybe we are building a lab environment </span><a id="_idIndexMarker1409"/><span class="koboSpan" id="kobo.1070.1">for </span><strong class="bold"><span class="koboSpan" id="kobo.1071.1">red teams</span></strong><span class="koboSpan" id="kobo.1072.1"> and </span><strong class="bold"><span class="koboSpan" id="kobo.1073.1">blue teams</span></strong><span class="koboSpan" id="kobo.1074.1"> to </span><a id="_idIndexMarker1410"/><span class="koboSpan" id="kobo.1075.1">simulate real-world attack and defense scenarios. </span><span class="koboSpan" id="kobo.1075.2">It is also possible that we are building a lab environment to test AI-powered penetration testing tools such as </span><strong class="bold"><span class="koboSpan" id="kobo.1076.1">PentestGPT</span></strong><span class="koboSpan" id="kobo.1077.1">. </span><span class="koboSpan" id="kobo.1077.2">Given that there are various reasons for building a lab, it is </span><a id="_idIndexMarker1411"/><span class="koboSpan" id="kobo.1078.1">essential that we identify and understand the purpose of what we’ll be setting up so that we can design the best environment for </span><span class="No-Break"><span class="koboSpan" id="kobo.1079.1">our needs.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.1080.1">Identifying the number of users of the lab environment</span></strong><span class="koboSpan" id="kobo.1081.1">: Lab resources may be shared (or not shared) by multiple lab users playing the role of the attacker. </span><span class="koboSpan" id="kobo.1081.2">If the penetration testing lab environment is shared, the overall cost of running the lab environment may be lower. </span><span class="koboSpan" id="kobo.1081.3">However, this may affect the experience of the lab users trying to attack and compromise the same set </span><span class="No-Break"><span class="koboSpan" id="kobo.1082.1">of resources.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.1083.1">Identifying the lab environment size</span></strong><span class="koboSpan" id="kobo.1084.1">: Penetration testing lab environments don’t need to have the same size network environment as an enterprise company. </span><span class="koboSpan" id="kobo.1084.2">That’s because having more resources would entail a higher cost associated with running the lab environment in </span><span class="No-Break"><span class="koboSpan" id="kobo.1085.1">the cloud.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.1086.1">Identifying which attacks or techniques are not allowed in cloud environments</span></strong><span class="koboSpan" id="kobo.1087.1">: Understanding </span><a id="_idIndexMarker1412"/><span class="koboSpan" id="kobo.1088.1">which attacks and techniques are harmful to the lab environment and prohibited by the cloud provider is critical. </span><span class="koboSpan" id="kobo.1088.2">As discussed in the </span><em class="italic"><span class="koboSpan" id="kobo.1089.1">Examining the considerations when building penetration testing lab environments in the cloud</span></em><span class="koboSpan" id="kobo.1090.1"> section of </span><span class="No-Break"><em class="italic"><a href="B19755_01.xhtml"><span class="koboSpan" id="kobo.1091.1">Chapter 1</span></a></em></span><span class="koboSpan" id="kobo.1092.1">, </span><em class="italic"><span class="koboSpan" id="kobo.1093.1">Getting Started with Penetration Testing Labs in the Cloud</span></em><span class="koboSpan" id="kobo.1094.1">, cloud providers have policies and guidelines that we need to review before doing penetration tests on applications running in the cloud. </span><span class="koboSpan" id="kobo.1094.2">If you don’t follow these guidelines, your cloud account might get suspended or </span><span class="No-Break"><span class="koboSpan" id="kobo.1095.1">even terminated!</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.1096.1">Surprised to see just four considerations? </span><span class="koboSpan" id="kobo.1096.2">Of course, there’s more where they came from! </span><span class="koboSpan" id="kobo.1096.3">In addition to what was just discussed, we need to be mindful of the following implementation considerations and recommended practices </span><span class="No-Break"><span class="koboSpan" id="kobo.1097.1">as well:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.1098.1">Creating custom vulnerable applications versus using existing vulnerable applications</span></strong><span class="koboSpan" id="kobo.1099.1">: By designing our own vulnerable-by-design applications, we have full control over the complexity along with the types of security weaknesses, vulnerabilities, and misconfigurations present in the application. </span><span class="koboSpan" id="kobo.1099.2">However, one of the major downsides of creating custom applications is that this requires additional time and effort, especially if we need to prepare these from scratch. </span><span class="koboSpan" id="kobo.1099.3">On the other hand, using existing vulnerable containers or applications (such </span><a id="_idIndexMarker1413"/><span class="koboSpan" id="kobo.1100.1">as </span><strong class="bold"><span class="koboSpan" id="kobo.1101.1">Metasploitable</span></strong><span class="koboSpan" id="kobo.1102.1"> and </span><strong class="bold"><span class="koboSpan" id="kobo.1103.1">OWASP WebGoat</span></strong><span class="koboSpan" id="kobo.1104.1">) can</span><a id="_idIndexMarker1414"/><span class="koboSpan" id="kobo.1105.1"> speed things </span><a id="_idIndexMarker1415"/><span class="koboSpan" id="kobo.1106.1">up a bit during the preparation of </span><span class="No-Break"><span class="koboSpan" id="kobo.1107.1">lab environments.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.1108.1">Identifying the best way to automate certain components of the lab environment</span></strong><span class="koboSpan" id="kobo.1109.1">: There are various ways and tools to automate the setup and configuration of lab resources and components. </span><span class="koboSpan" id="kobo.1109.2">Instead of just using Terraform to set up cloud resources, it might make sense to use tools </span><a id="_idIndexMarker1416"/><span class="koboSpan" id="kobo.1110.1">such as </span><strong class="bold"><span class="koboSpan" id="kobo.1111.1">Ansible</span></strong><span class="koboSpan" id="kobo.1112.1"> (or other alternatives) for configuration management as well. </span><span class="koboSpan" id="kobo.1112.2">Here, we can utilize more than one tool. </span><span class="koboSpan" id="kobo.1112.3">Some tools can focus on infrastructure provisioning while other tools take care of configuration management. </span><span class="koboSpan" id="kobo.1112.4">By strategically selecting and combining tools, we can leverage their unique strengths when building various components of our penetration testing </span><span class="No-Break"><span class="koboSpan" id="kobo.1113.1">lab environment.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.1114.1">Providing the lab users the ability to reset specific components in the lab setup</span></strong><span class="koboSpan" id="kobo.1115.1">: While using the penetration testing lab environments, lab users playing the role of the attacker may encounter scenarios where they would need to restore a specific component or resource to its initial state. </span><span class="koboSpan" id="kobo.1115.2">That said, a “reset” button (or an alternative solution) for restoring specific VM instances and other cloud resources to their initial state would be useful. </span><span class="koboSpan" id="kobo.1115.3">In case you are wondering what they would do next... </span><span class="koboSpan" id="kobo.1115.4">of course, they would try attacking and compromising these </span><span class="No-Break"><span class="koboSpan" id="kobo.1116.1">resources again!</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.1117.1">Understanding cloud platform differences</span></strong><span class="koboSpan" id="kobo.1118.1">: Understanding the major and minor differences between various cloud platforms is critical as this will affect how we design and implement our penetration testing lab environments. </span><span class="koboSpan" id="kobo.1118.2">In addition to this, we need to stay up to date with the announcements from these cloud providers as they constantly update their services, features, pricing models, and even the security defaults of the </span><span class="No-Break"><span class="koboSpan" id="kobo.1119.1">cloud resources.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.1120.1">Enforcing a Code of Conduct</span></strong><span class="koboSpan" id="kobo.1121.1">: Maintaining</span><a id="_idIndexMarker1417"/><span class="koboSpan" id="kobo.1122.1"> a </span><strong class="bold"><span class="koboSpan" id="kobo.1123.1">Code of Conduct</span></strong><span class="koboSpan" id="kobo.1124.1"> for lab users helps set clear expectations and guidelines to govern their behavior while performing penetration testing activities and simulations inside the environment. </span><span class="koboSpan" id="kobo.1124.2">This document should outline what’s allowed and what’s not allowed inside the lab set up in the cloud account. </span><span class="koboSpan" id="kobo.1124.3">You could also set up and install various monitoring tools to quickly identify any potential violations and ensure the compliance of the </span><span class="No-Break"><span class="koboSpan" id="kobo.1125.1">lab users.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.1126.1">Documenting the setup</span></strong><span class="koboSpan" id="kobo.1127.1">: Proper documentation can help onboard new members who will also be maintaining the same lab environment and help troubleshoot</span><a id="_idIndexMarker1418"/><span class="koboSpan" id="kobo.1128.1"> issues faster. </span><span class="koboSpan" id="kobo.1128.2">In addition to these, a well-documented setup promotes consistency across multiple deployments or iterations of the lab. </span><span class="koboSpan" id="kobo.1128.3">This will help ensure that the lab is (mis)configured the way it should be. </span><span class="koboSpan" id="kobo.1128.4">Note that this is not just about preparing detailed documentation with diagrams and step-by-step instructions on how each component of the lab environment is configured. </span><span class="koboSpan" id="kobo.1128.5">This also includes writing self-documenting code, preparing automated tests as needed, and following the best practices when using version control systems (such</span><a id="_idIndexMarker1419"/><span class="koboSpan" id="kobo.1129.1"> as </span><strong class="bold"><span class="koboSpan" id="kobo.1130.1">Git</span></strong><span class="koboSpan" id="kobo.1131.1">) to manage the automation scripts and </span><span class="No-Break"><span class="koboSpan" id="kobo.1132.1">IaC templates.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.1133.1">There’s definitely more we can add here, but these should do the trick for now. </span><span class="koboSpan" id="kobo.1133.2">Feel free to read this section twice (or as many times as needed!) as these considerations and practical strategies will help you manage the risks and challenges involved when running penetration testing labs in </span><span class="No-Break"><span class="koboSpan" id="kobo.1134.1">the cloud.</span></span></p>
<h1 id="_idParaDest-205"><a id="_idTextAnchor205"/><span class="koboSpan" id="kobo.1135.1">Summary</span></h1>
<p><span class="koboSpan" id="kobo.1136.1">In this chapter, we took a closer look at how we can increase the complexity and difficulty of the penetration testing lab environments we set up in the previous chapters of this book. </span><span class="koboSpan" id="kobo.1136.2">In addition to this, we learned how to utilize various AI-powered solutions such as ChatGPT, GitHub Copilot, Amazon CodeWhisperer, and Tabnine to significantly speed up relevant tasks when building these vulnerable-by-design labs. </span><span class="koboSpan" id="kobo.1136.3">These include estimating the cost of running these labs in the cloud, generating automation scripts and IaC templates, and explaining existing code written by other professionals. </span><span class="koboSpan" id="kobo.1136.4">We ended the chapter by tackling relevant recommendations, considerations, and strategies when building penetration testing lab environments in </span><span class="No-Break"><span class="koboSpan" id="kobo.1137.1">the cloud.</span></span></p>
<p><span class="koboSpan" id="kobo.1138.1">You’ve finally reached the end of this book! </span><span class="koboSpan" id="kobo.1138.2">Congratulations on completing all the chapters along with the hands-on examples and solutions. </span><span class="koboSpan" id="kobo.1138.3">Close your eyes and take a moment to reflect on everything you have learned. </span><span class="koboSpan" id="kobo.1138.4">I hope this book inspires you to embark on many more adventures to explore this fascinating world </span><span class="No-Break"><span class="koboSpan" id="kobo.1139.1">of cybersecurity.</span></span></p>
</div>
</body></html>