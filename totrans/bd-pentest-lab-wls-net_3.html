<html><head></head><body>
<div id="page" style="height:0pt"/><div class="book" title="Chapter&#xA0;3.&#xA0;Configuring Networking Lab Components" id="MSDG1-3ecab517ca6e4afbb3c20ab15f7b4d82"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch03" class="calibre1"/>Chapter 3. Configuring Networking Lab Components</h1></div></div></div><p class="calibre9">We have already spent enough time on the preparations for building a lab and now it is finally time to actually start building it.</p><p class="calibre9">In this chapter, we will show you the configuration of hardware and virtual network devices for both the options of building a lab, so you can easily choose the one that fits your needs best.</p><p class="calibre9">The chapter consists of the following topics:</p><div class="book"><ul class="itemizedlist"><li class="listitem">General lab network communication rules</li><li class="listitem">Configuring hardware wired devices</li><li class="listitem">Configuring virtual wired network devices</li><li class="listitem">Configuring WLANs</li></ul></div></div>

<div class="book" title="Chapter&#xA0;3.&#xA0;Configuring Networking Lab Components" id="MSDG1-3ecab517ca6e4afbb3c20ab15f7b4d82">
<div class="book" title="General lab network communication rules"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_1"><a id="ch03lvl1sec17" class="calibre1"/>General lab network communication rules</h1></div></div></div><p class="calibre9">Network <a id="id118" class="calibre1"/>diagrams are a very convenient way to represent a network topology and its architecture. They are widely used by nearly all <a id="id119" class="calibre1"/><span class="strong"><strong class="calibre2">small or home office</strong></span> (<span class="strong"><strong class="calibre2">SOHO</strong></span>) and enterprise networks. But this representation often lacks a logical layer for providing a better understanding of how network components interact and in which directions network traffic flows. It is not an easy task to show it in a diagram, so network engineers use a bunch of documentation for that purpose, mostly combining tables, flowcharts, and diagrams.</p><p class="calibre9">But as we have a very simple network diagram and a pretty straightforward understanding of how network traffic should flow, we can try to depict it as an additional layer on our network diagram, as shown in the following diagram:</p><div class="mediaobject"><img src="../images/00011.jpeg" alt="General lab network communication rules" class="calibre11"/><div class="caption"><p class="calibre15">The network diagram including a logical layer</p></div></div><p class="calibre12"> </p><p class="calibre9">To extend the <a id="id120" class="calibre1"/>diagram and better explain the target access rules, let's take a look at the additional information on the permitted access in the following table:</p><div class="informalexample"><table border="1" class="calibre16"><colgroup class="calibre17"><col class="calibre18"/><col class="calibre18"/><col class="calibre18"/></colgroup><thead class="calibre19"><tr class="calibre20"><th valign="bottom" class="calibre21">
<p class="calibre22">Source</p>
</th><th valign="bottom" class="calibre21">
<p class="calibre22">Allowed destination</p>
</th><th valign="bottom" class="calibre21">
<p class="calibre22">Purpose</p>
</th></tr></thead><tbody class="calibre23"><tr class="calibre20"><td valign="top" class="calibre24">
<p class="calibre22">Admin workstation</p>
</td><td valign="top" class="calibre24">
<div class="itemizedlist2"><ul class="itemizedlist3"><li class="listitem1">All network devices</li><li class="listitem1">All servers</li><li class="listitem1">All user workstations</li><li class="listitem1">Internet (external network)</li></ul></div>
</td><td valign="top" class="calibre24">
<p class="calibre22">Network and system administration</p>
</td></tr><tr class="calibre20"><td valign="top" class="calibre24">
<p class="calibre22">Servers</p>
</td><td valign="top" class="calibre24">
<div class="itemizedlist2"><ul class="itemizedlist3"><li class="listitem1">Internet (external network)</li></ul></div>
</td><td valign="top" class="calibre24">
<p class="calibre22">Software installation and updates</p>
</td></tr><tr class="calibre20"><td valign="top" class="calibre24">
<p class="calibre22">User workstations</p>
</td><td valign="top" class="calibre24">
<div class="itemizedlist2"><ul class="itemizedlist3"><li class="listitem1">Internet (external network)</li><li class="listitem1">Servers</li></ul></div>
</td><td valign="top" class="calibre24">
<p class="calibre22">Internet access, access to the internal network services</p>
</td></tr><tr class="calibre20"><td valign="top" class="calibre24">
<p class="calibre22">Trusted WLAN</p>
</td><td valign="top" class="calibre24">
<div class="itemizedlist2"><ul class="itemizedlist3"><li class="listitem1">Internet (external network)</li><li class="listitem1">Servers</li></ul></div>
</td><td valign="top" class="calibre24">
<p class="calibre22">Internet access, access to the internal network services</p>
</td></tr><tr class="calibre20"><td valign="top" class="calibre24">
<p class="calibre22">Guest WLAN</p>
</td><td valign="top" class="calibre24">
<div class="itemizedlist2"><ul class="itemizedlist3"><li class="listitem1">Internet (external network)</li></ul></div>
</td><td valign="top" class="calibre24">
<p class="calibre22">Internet access</p>
</td></tr></tbody></table></div><p class="calibre9">We don't <a id="id121" class="calibre1"/>want any access to our lab network from an external network or guest WLAN, thus we should not permit it. Also, there is no need to access the user subnet from the trusted WLAN and server subnet, so we do not allow it. The last rule is that only an administrator should be able to access any services on network devices; therefore, we do not allow it to any other lab component.</p></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Configuring hardware wired devices"><div class="book" id="NQU22-3ecab517ca6e4afbb3c20ab15f7b4d82"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch03lvl1sec18" class="calibre1"/>Configuring hardware wired devices</h1></div></div></div><p class="calibre9">So, that<a id="id122" class="calibre1"/> is enough theory. Now let's proceed with some practice and finally configure the network devices.</p><p class="calibre9">We will configure our routers and switches via console ports using a special console cable, which in our case has a RJ-45 connector at one end and a DB-9 connector at the other end. You are unlikely to find DB-9 ports on contemporary computers, thus we need to have a DB-9-USB adapter cable to be able to connect it to a USB port. You can see an example of such a cable and an adapter in the following images from the Cisco website:</p><div class="mediaobject"><img src="../images/00012.jpeg" alt="Configuring hardware wired devices" class="calibre11"/><div class="caption"><p class="calibre15">The Cisco console cable</p></div></div><p class="calibre12"> </p><div class="mediaobject"><img src="../images/00013.jpeg" alt="Configuring hardware wired devices" class="calibre11"/><div class="caption"><p class="calibre15">The DB-9 to USB adapter</p></div></div><p class="calibre12"> </p><div class="informalexample" title="Note"><h3 class="title2"><a id="tip07" class="calibre1"/>Tip</h3><p class="calibre9">You might need to install special drivers for using an adapter, so please check your adapter's user manual.</p></div><p class="calibre9">Alternatively, you<a id="id123" class="calibre1"/> can get a console cable with both RJ-45 and USB connectors, for example, on eBay (<a class="calibre1" href="http://www.ebay.com/">http://www.ebay.com/</a>):</p><div class="mediaobject"><img src="../images/00014.jpeg" alt="Configuring hardware wired devices" class="calibre11"/><div class="caption"><p class="calibre15">The RJ-45 to USB console cable</p></div></div><p class="calibre12"> </p><p class="calibre9">We will <a id="id124" class="calibre1"/>also need a terminal software to be able to communicate with devices via console ports. On Linux or MAC OS X, you can communicate with a Cisco device via its console port using, for example, a software "screen." You just need to find the interface name using the <code class="literal">dmesg</code> command after connecting a cable and use it as a parameter for screen utility:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">dmesg |grep tty</strong></span>
</pre></div><p class="calibre9">In our case, we can see the following message that contains the interface name:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">[31043.758232] usb 1-2: pl2303 converter now attached to ttyUSB0</strong></span>
</pre></div><p class="calibre9">Now, we use this name with <code class="literal">screen</code>:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">screen /dev/ttyUSB0</strong></span>
</pre></div><p class="calibre9">We are able to communicate with a device's console port.</p><p class="calibre9">In Windows, you can use the free PuTTY software. We will show you this variant of connection, but all further device configuration steps are the same regardless of the OS you are using to communicate with the devices.</p><div class="informalexample" title="Note"><h3 class="title2"><a id="note07" class="calibre1"/>Note</h3><p class="calibre9">We will not provide an extended explanation for every configuration step because our goal is not to teach you network device administration, but to get a working instance to perform our lab tasks. You can get information about any Cisco command using the <code class="literal">?</code> sign with a command name in the terminal, for example, <code class="literal">show ?</code>.</p></div></div>

<div class="book" title="Configuring hardware wired devices">
<div class="book" title="Preparing the console connection on Windows"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch03lvl2sec22" class="calibre1"/>Preparing the console connection on Windows</h2></div></div></div><p class="calibre9">The first<a id="id125" class="calibre1"/> step for preparing the<a id="id126" class="calibre1"/> console connection on Windows is to determine a serial port number to use with the PuTTY software. To do that, you need to turn a device on and connect its console port to one of the USB ports on your computer. A console port is marked or signed accordingly. Do not get confused and connect your console cable to other RJ-45 ports on the router—it will not work as we need it to.</p><p class="calibre9">If you have newer device models, they probably have USB console ports that you can connect to any of your computer's USB ports with a USB cable (Type A to Type mini B). In order to be able to communicate via this cable, you need to install a Cisco USB console driver that you can find at the official Cisco website.</p><p class="calibre9">After connecting a console cable and turning the device on, open <span class="strong"><strong class="calibre2">Device Manager</strong></span> in Windows and find the COM and LPT ports in the device tree. Under this branch, you can find a USB-to-serial-port device and get a COM port number from it:</p><div class="mediaobject"><img src="../images/00015.jpeg" alt="Preparing the console connection on Windows" class="calibre11"/><div class="caption"><p class="calibre15">Getting COM-port number</p></div></div><p class="calibre12"> </p><p class="calibre9">Now that we know the COM port number, we can open PuTTY and set the <span class="strong"><strong class="calibre2">Connection type</strong></span> to <span class="strong"><strong class="calibre2">Serial</strong></span> and the <span class="strong"><strong class="calibre2">Serial line</strong></span> to the right COM port, which is <span class="strong"><strong class="calibre2">COM3</strong></span> in our case:</p><div class="mediaobject"><img src="../images/00016.jpeg" alt="Preparing the console connection on Windows" class="calibre11"/><div class="caption"><p class="calibre15">Getting the COM port number</p></div></div><p class="calibre12"> </p><p class="calibre9">Now, we <a id="id127" class="calibre1"/>are ready to <a id="id128" class="calibre1"/>connect and communicate with your devices.</p><div class="informalexample" title="Note"><h3 class="title2"><a id="tip08" class="calibre1"/>Tip</h3><p class="calibre9">You can also save this connection so you do not need to configure it every time you want to work with device consoles.</p></div><div class="informalexample" title="Note"><h3 class="title2"><a id="note08" class="calibre1"/>Note</h3><p class="calibre9">During the work on your lab network, you will probably meet some configuration challenges. Yes, we provide a pretty detailed manual in this book, but as it usually happens in the heterogeneous IT world, one just not simply configure something serious using a step-by-step manual. There are always some things that do not work or work not in the way you desire. There could be various reasons for that, such as different software versions or different hardware, so you should have no fear of checking Google for a solution on the Internet. We would say, you should appreciate such an opportunity to learn and understand your environment.</p><p class="calibre9">For solving any challenges during your lab installation and maintenance, you will need to use two important IOS commands: <code class="literal">logging buffered</code> and <code class="literal">debug</code>.</p><p class="calibre9">You can also download and read the official <span class="strong"><em class="calibre10">Cisco IOS Configuration Fundamentals Command Reference</em></span> from the Cisco website and use it as reference material.</p></div></div></div>

<div class="book" title="Configuring hardware wired devices">
<div class="book" title="Core switch"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch03lvl2sec23" class="calibre1"/>Core switch</h2></div></div></div><p class="calibre9">Let's start <a id="id129" class="calibre1"/>by installing and configuring our switch, which <a id="id130" class="calibre1"/>will serve as our network's core and provide basic connectivity between the lab components.</p><p class="calibre9">Our switch has 12 ports and we should determine a port layout first. We need one physical interface for connecting an external untrusted network, one physical interface for a router connection, one physical interface for an admin workstation, three interfaces for users, four interfaces for servers, and one interface for an access point to establish a trusted WLAN. Let's summarize it in the following table:</p><div class="informalexample"><table border="1" class="calibre16"><colgroup class="calibre17"><col class="calibre18"/><col class="calibre18"/></colgroup><thead class="calibre19"><tr class="calibre20"><th valign="bottom" class="calibre21">
<p class="calibre22">Interface</p>
</th><th valign="bottom" class="calibre21">
<p class="calibre22">Connection</p>
</th></tr></thead><tbody class="calibre23"><tr class="calibre20"><td valign="top" class="calibre24">
<p class="calibre22">
<code class="literal1">fa0/1</code>
</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">Router</p>
</td></tr><tr class="calibre20"><td valign="top" class="calibre24">
<p class="calibre22">
<code class="literal1">fa0/2</code>
</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">External router (network)</p>
</td></tr><tr class="calibre20"><td valign="top" class="calibre24">
<p class="calibre22">
<code class="literal1">fa0/3</code>
</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">Admin workstation</p>
</td></tr><tr class="calibre20"><td valign="top" class="calibre24">
<p class="calibre22">
<code class="literal1">fa0/4-fa0/6</code>
</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">User subnet</p>
</td></tr><tr class="calibre20"><td valign="top" class="calibre24">
<p class="calibre22">
<code class="literal1">fa0/7-fa0/10</code>
</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">Server subnet</p>
</td></tr><tr class="calibre20"><td valign="top" class="calibre24">
<p class="calibre22">
<code class="literal1">fa0/11</code>
</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">Trusted WLAN</p>
</td></tr></tbody></table></div><p class="calibre9">Now when you know where to connect what, you can start connecting a router to our switch and performing the initial switch configuration.</p><div class="book" title="Initial configuration"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch03lvl3sec12" class="calibre1"/>Initial configuration</h3></div></div></div><p class="calibre9">In case <a id="id131" class="calibre1"/>you are using virtual or new network devices, initial configuration can be limited to just setting a hostname with the command <code class="literal">hostname</code>. But if you got used devices (this is very likely if you use it for a lab), there could be old configurations saved that you obviously do not need. So that we do not unintentionally allow anything unsecure to be enabled or disabled, as the first initial configuration step, we are going to erase the current config and revert the OS to factory settings.</p><div class="informalexample" title="Note"><h3 class="title2"><a id="note09" class="calibre1"/>Note</h3><p class="calibre9">Device configurations could be password-protected by their previous owners and you probably do not know those passwords. In that case, you can use a hardware switch to factory reset a device. Such a switch often looks like a button with a sign "mode." You need to push and hold it for a while to have an effect. Refer to the Cisco website for certain device configuration manuals.</p></div><p class="calibre9">To do this, connect<a id="id132" class="calibre1"/> to the device console and first of all get into privileged command mode by entering the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">enable</strong></span>
</pre></div><p class="calibre9">You will see that your command invitation ends with a <code class="literal">#</code> sign which means you are in the privileged mode now. Now, we need to start the configuration terminal mode with the command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">config t</strong></span>
</pre></div><p class="calibre9">Now, erase an old config and revert to a blank one with the following commands:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">erase startup-config</strong></span>
<span class="strong"><strong class="calibre2">reload</strong></span>
</pre></div><p class="calibre9">Reloading an OS will take some time. If you have a cable connected to the device's Ethernet port, the switch will try to load a configuration image from a TFTP Server attempting to discover it via multicast messages sent to 255.255.255.255. Most likely, you do not have a TFTP Server reachable and you will see error messages in the console similar to the following:</p><p class="calibre9">
<code class="literal">%Error opening tftp://255.255.255.255/network-confg (Timed out)</code>
</p><p class="calibre9">After reloading the device, an invitation to start an initial configuration dialog should appear. We do not recommend using it if you are not sure what you are doing, to avoid any differences in our configuration and yours. But if you want to use it, just answer yes or run the command <code class="literal">setup</code> from the privileged mode if the dialog has not appeared. This dialog will guide you through the initial configuration with simple questions. Here's a statement from the official Cisco documentation:</p><div class="blockquote"><blockquote class="blockquote1"><p class="calibre25">If you make a mistake while using the setup command facility, you can exit and run the setup command facility again. Press Ctrl-C, and enter the setup command at the privileged EXEC mode prompt.</p></blockquote></div><p class="calibre9">To finish our initial configuration, set a hostname for the core switch with the following commands:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">enable</strong></span>
<span class="strong"><strong class="calibre2">config t</strong></span>
<span class="strong"><strong class="calibre2">hostname sw</strong></span>
</pre></div><p class="calibre9">Here, <code class="literal">sw</code> is your chosen name for the device. Of course, you can choose whichever name you like, but we<a id="id133" class="calibre1"/> recommend using the same names that we provide in this book to avoid possible confusion later.</p></div><div class="book" title="Configuring interfaces and VLANs"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch03lvl3sec13" class="calibre1"/>Configuring interfaces and VLANs</h3></div></div></div><p class="calibre9">As the next <a id="id134" class="calibre1"/>step, let's configure the switch's interfaces and virtual local area networks to logically separate our lab subnets from each other.</p><p class="calibre9">First, we need <a id="id135" class="calibre1"/>to determine a VLAN to interface with the layout and assign VLAN numbers and names, as shown in the following table:</p><div class="informalexample"><table border="1" class="calibre16"><colgroup class="calibre17"><col class="calibre18"/><col class="calibre18"/><col class="calibre18"/><col class="calibre18"/></colgroup><thead class="calibre19"><tr class="calibre20"><th valign="bottom" class="calibre21">
<p class="calibre22">Interface</p>
</th><th valign="bottom" class="calibre21">
<p class="calibre22">Mode</p>
</th><th valign="bottom" class="calibre21">
<p class="calibre22">VLAN number</p>
</th><th valign="bottom" class="calibre21">
<p class="calibre22">VLAN name</p>
</th></tr></thead><tbody class="calibre23"><tr class="calibre20"><td valign="top" class="calibre24">
<p class="calibre22">
<code class="literal1">fa0/1</code>
</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">trunk</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">-</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">-</p>
</td></tr><tr class="calibre20"><td valign="top" class="calibre24">
<p class="calibre22">
<code class="literal1">fa0/2</code>
</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">access</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">5</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">external</p>
</td></tr><tr class="calibre20"><td valign="top" class="calibre24">
<p class="calibre22">
<code class="literal1">fa0/3</code>
</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">access</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">1</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">default</p>
</td></tr><tr class="calibre20"><td valign="top" class="calibre24">
<p class="calibre22">
<code class="literal1">fa0/4-fa0/6</code>
</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">access</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">3</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">users</p>
</td></tr><tr class="calibre20"><td valign="top" class="calibre24">
<p class="calibre22">
<code class="literal1">fa0/7-fa0/11</code>
</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">access</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">2</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">servers</p>
</td></tr><tr class="calibre20"><td valign="top" class="calibre24">
<p class="calibre22">
<code class="literal1">fa0/12</code>
</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">access</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">4</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">trusted_wlan</p>
</td></tr></tbody></table></div><div class="informalexample" title="Note"><h3 class="title2"><a id="note10" class="calibre1"/>Note</h3><p class="calibre9">In Cisco networks, the trunk mode allows a port to transfer traffic of any VLAN accessible on a device opposite to an access mode which transfers traffic only for one VLAN assigned to it.</p></div><p class="calibre9">Now, let's implement it as a switch configuration.</p><p class="calibre9">Start with sequentially entering the privileged and config modes if you are not in yet, and then define your VLAN numbers and names with the following console commands:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">vlan 2</strong></span>
<span class="strong"><strong class="calibre2"> name servers</strong></span>
<span class="strong"><strong class="calibre2">!</strong></span>
<span class="strong"><strong class="calibre2">vlan 3</strong></span>
<span class="strong"><strong class="calibre2"> name users</strong></span>
<span class="strong"><strong class="calibre2">!</strong></span>
<span class="strong"><strong class="calibre2">vlan 4 </strong></span>
<span class="strong"><strong class="calibre2"> name trusted_wlan</strong></span>
<span class="strong"><strong class="calibre2">!</strong></span>
<span class="strong"><strong class="calibre2">vlan 5</strong></span>
<span class="strong"><strong class="calibre2"> name external_network</strong></span>
</pre></div><p class="calibre9">After <a id="id136" class="calibre1"/>defining VLANs, we need to set interfaces to the right modes, give them descriptions, assign <a id="id137" class="calibre1"/>VLAN numbers, and turn them on. We do so using the following commands:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">interface fa0/1</strong></span>
<span class="strong"><strong class="calibre2"> switchport mode trunk</strong></span>
<span class="strong"><strong class="calibre2"> description router trunk</strong></span>
<span class="strong"><strong class="calibre2"> no shutdown</strong></span>
<span class="strong"><strong class="calibre2">!</strong></span>
<span class="strong"><strong class="calibre2">interface fa0/2</strong></span>
<span class="strong"><strong class="calibre2"> switchport mode access</strong></span>
<span class="strong"><strong class="calibre2"> switchport access vlan 5</strong></span>
<span class="strong"><strong class="calibre2"> description external network</strong></span>
<span class="strong"><strong class="calibre2"> no shutdown</strong></span>
<span class="strong"><strong class="calibre2">!</strong></span>
<span class="strong"><strong class="calibre2">interface fa0/3</strong></span>
<span class="strong"><strong class="calibre2"> switchport mode access</strong></span>
<span class="strong"><strong class="calibre2"> switchport access vlan 1</strong></span>
<span class="strong"><strong class="calibre2"> no shutdown</strong></span>
<span class="strong"><strong class="calibre2">!</strong></span>
<span class="strong"><strong class="calibre2">interface fa0/4</strong></span>
<span class="strong"><strong class="calibre2"> switchport mode access</strong></span>
<span class="strong"><strong class="calibre2"> switchport access vlan 3</strong></span>
<span class="strong"><strong class="calibre2"> no shutdown</strong></span>
<span class="strong"><strong class="calibre2">!</strong></span>
<span class="strong"><strong class="calibre2">interface fa0/5</strong></span>
<span class="strong"><strong class="calibre2"> switchport mode access</strong></span>
<span class="strong"><strong class="calibre2"> switchport access vlan 3</strong></span>
<span class="strong"><strong class="calibre2"> no shutdown</strong></span>
<span class="strong"><strong class="calibre2">!</strong></span>
<span class="strong"><strong class="calibre2">interface fa0/6</strong></span>
<span class="strong"><strong class="calibre2"> switchport mode access</strong></span>
<span class="strong"><strong class="calibre2"> switchport access vlan 3</strong></span>
<span class="strong"><strong class="calibre2"> no shutdown</strong></span>
<span class="strong"><strong class="calibre2">!</strong></span>
<span class="strong"><strong class="calibre2">interface fa0/7</strong></span>
<span class="strong"><strong class="calibre2"> switchport mode access</strong></span>
<span class="strong"><strong class="calibre2"> switchport access vlan 2</strong></span>
<span class="strong"><strong class="calibre2"> no shutdown</strong></span>
<span class="strong"><strong class="calibre2">!</strong></span>
<span class="strong"><strong class="calibre2">interface fa0/8</strong></span>
<span class="strong"><strong class="calibre2"> switchport mode access</strong></span>
<span class="strong"><strong class="calibre2"> switchport access vlan 2</strong></span>
<span class="strong"><strong class="calibre2"> no shutdown</strong></span>
<span class="strong"><strong class="calibre2">!</strong></span>
<span class="strong"><strong class="calibre2">interface fa0/9</strong></span>
<span class="strong"><strong class="calibre2"> switchport mode access</strong></span>
<span class="strong"><strong class="calibre2"> switchport access vlan 2</strong></span>
<span class="strong"><strong class="calibre2"> no shutdown</strong></span>
<span class="strong"><strong class="calibre2">!</strong></span>
<span class="strong"><strong class="calibre2">interface fa0/10</strong></span>
<span class="strong"><strong class="calibre2"> switchport mode access</strong></span>
<span class="strong"><strong class="calibre2"> switchport access vlan 2</strong></span>
<span class="strong"><strong class="calibre2"> no shutdown</strong></span>
<span class="strong"><strong class="calibre2">!</strong></span>
<span class="strong"><strong class="calibre2">interface fa0/11</strong></span>
<span class="strong"><strong class="calibre2"> switchport mode access</strong></span>
<span class="strong"><strong class="calibre2"> switchport access vlan 2</strong></span>
<span class="strong"><strong class="calibre2"> description IDS</strong></span>
<span class="strong"><strong class="calibre2"> no shutdown</strong></span>
<span class="strong"><strong class="calibre2">!</strong></span>
<span class="strong"><strong class="calibre2">interface fa0/12</strong></span>
<span class="strong"><strong class="calibre2"> switchport mode access</strong></span>
<span class="strong"><strong class="calibre2"> switchport access vlan 4</strong></span>
<span class="strong"><strong class="calibre2"> description Trusted WLAN</strong></span>
<span class="strong"><strong class="calibre2"> no shutdown</strong></span>
<span class="strong"><strong class="calibre2">exit</strong></span>
</pre></div><div class="informalexample" title="Note"><h3 class="title2"><a id="tip09" class="calibre1"/>Tip</h3><p class="calibre9">If you have accidentally set wrong interface configs, you can easily remove them by executing the same command with a preceding <code class="literal">no</code> statement, for example, consider the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">switchport mode access</strong></span>
</pre></div><p class="calibre9">It can be cancelled with the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">no switchport mode access</strong></span>
</pre></div></div><p class="calibre9">Once you <a id="id138" class="calibre1"/>have <a id="id139" class="calibre1"/>configured VLANs, you can use the commands <code class="literal">show vlan</code> and <code class="literal">show interfaces</code> to review your configuration. To see the whole configuration, use the command <code class="literal">show running-config</code>.</p><div class="informalexample" title="Note"><h3 class="title2"><a id="tip11" class="calibre1"/>Tip</h3><p class="calibre9">Play with the show command: enter <code class="literal">show ?</code> and try various commands from the displayed list to see various configuration parameters.</p></div><p class="calibre9">At the moment, we have a basic working config and we can connect other lab components to the core switch, but it is wise to do some basic hardening before as we are building a secure lab.</p><p class="calibre9">There are two main purposes of hardening the core switch: protecting our lab from external malicious activity and preparing the switch for practicing advanced attack techniques. We will show you some basic hardening steps, but we recommend you to go further and use the official Cisco IOS device hardening guide available at their website:</p><p class="calibre9">
<a class="calibre1" href="http://www.cisco.com/c/en/us/support/docs/ip/access-lists/13608-21.html">http://www.cisco.com/c/en/us/support/docs/ip/access-lists/13608-21.html</a>
</p><p class="calibre9">Let's start<a id="id140" class="calibre1"/> hardening by setting a password for the privileged mode with the following command in the configuration mode (<code class="literal">config t</code>):</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">enable secret 0 secret_password</strong></span>
</pre></div><p class="calibre9">You can change <code class="literal">secret_password</code> to your desired password.</p><p class="calibre9">Next, we <a id="id141" class="calibre1"/>need to disable <a id="id142" class="calibre1"/><span class="strong"><strong class="calibre2">Cisco Discovery Protocol</strong></span> (<span class="strong"><strong class="calibre2">CDP</strong></span>) on the interface connected to an external network (<code class="literal">fa0/2</code>):</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">interface fa0/2</strong></span>
<span class="strong"><strong class="calibre2"> no cdp enable</strong></span>
</pre></div><p class="calibre9">This will limit the information broadcast about our network devices to an external untrusted network.</p><p class="calibre9">To save a new configuration and prevent it from being deleted after rebooting the device, we need to copy the running configuration to the startup configuration:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">copy running-config startup-config</strong></span>
</pre></div><p class="calibre9">Now, we have a functioning lab network core and we can proceed to configuring our router.</p></div></div></div>

<div class="book" title="Configuring hardware wired devices">
<div class="book" title="Hardening the core switch"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch03lvl2sec24" class="calibre1"/>Hardening the core switch</h2></div></div></div><p class="calibre9">Our <a id="id143" class="calibre1"/>gateway (that is our core router at the same time) should <a id="id144" class="calibre1"/>perform routing between subnets, allowing the lab components to communicate with each other. It also should provide a DHCP service for the user subnet and the trusted WLAN and perform network address translation many-to-one for Internet (external network) access.</p><p class="calibre9">As with every network device, we are going to start with the initial configuration. This is similar to the one we <a id="id145" class="calibre1"/>have done for the core switch. In this case, we just need to connect the router's port <code class="literal">fa0/0</code> with the switch's port <code class="literal">fa0/1</code> using an Ethernet cable, revert router configs to blank, and set a hostname <code class="literal">gw</code>:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">enable</strong></span>
<span class="strong"><strong class="calibre2">config t</strong></span>
<span class="strong"><strong class="calibre2">erase startup-config</strong></span>
<span class="strong"><strong class="calibre2">reload</strong></span>
<span class="strong"><strong class="calibre2">enable</strong></span>
<span class="strong"><strong class="calibre2">config t</strong></span>
<span class="strong"><strong class="calibre2">hostname gw</strong></span>
</pre></div><div class="informalexample" title="Note"><h3 class="title2"><a id="tip12" class="calibre1"/>Tip</h3><p class="calibre9">You can always save a configuration using the same command as for the core switch: <code class="literal">copy running-config startup-config</code>.</p></div><p class="calibre9">At this <a id="id146" class="calibre1"/>point, we are ready to configure the prerequisites for the router's main functionality: subinterfaces and subnets.</p><div class="book" title="Configuring subinterfaces and subnets"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch03lvl3sec14" class="calibre1"/>Configuring subinterfaces and subnets</h3></div></div></div><p class="calibre9">In our lab, we <a id="id147" class="calibre1"/>are implementing the router-on-a-stick scheme to allow all internal subnets to be served by only one FastEthernet <a id="id148" class="calibre1"/>router interface. To do this, we need to create subinterfaces of the interface <code class="literal">fa0/0</code> for each VLAN in our network and assign IP addresses to them. The gateway will have the IP address with the last octet equal to 1 in every subnet:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">interface fa0/0.1</strong></span>
<span class="strong"><strong class="calibre2"> encapsulation dot1Q 1</strong></span>
<span class="strong"><strong class="calibre2"> ip address 10.1.0.1 255.255.255.0</strong></span>
<span class="strong"><strong class="calibre2">!</strong></span>
<span class="strong"><strong class="calibre2">interface fa0/0.2</strong></span>
<span class="strong"><strong class="calibre2"> encapsulation dot1Q 2</strong></span>
<span class="strong"><strong class="calibre2"> ip address 10.0.0.1 255.255.255.0</strong></span>
<span class="strong"><strong class="calibre2">!</strong></span>
<span class="strong"><strong class="calibre2">interface fa0/0.3</strong></span>
<span class="strong"><strong class="calibre2"> encapsulation dot1Q 3</strong></span>
<span class="strong"><strong class="calibre2"> ip address 172.16.0.1 255.255.255.0</strong></span>
<span class="strong"><strong class="calibre2">!</strong></span>
<span class="strong"><strong class="calibre2">interface fa0/0.4</strong></span>
<span class="strong"><strong class="calibre2"> encapsulation dot1Q 4</strong></span>
<span class="strong"><strong class="calibre2"> ip address 172.16.1.1 255.255.255.0</strong></span>
</pre></div><div class="informalexample" title="Note"><h3 class="title2"><a id="note11" class="calibre1"/>Note</h3><p class="calibre9">When we are in the interface configuration mode after entering the command <code class="literal">interface f...</code>, we need to first set an encapsulation mode and only after that set an IP address and a network mask, otherwise we get an error.</p></div><p class="calibre9">After finishing <a id="id149" class="calibre1"/>the configuration of subinterfaces, let's activate the parent interface to activate all subinterfaces:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">interface fa0/0</strong></span>
<span class="strong"><strong class="calibre2"> no shutdown</strong></span>
</pre></div><p class="calibre9">Now, we can type <a id="id150" class="calibre1"/>the command <code class="literal">end</code> to exit the configuration mode and then check our resulting interface configs by entering the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">show ip interface brief</strong></span>
</pre></div><p class="calibre9">We should see a list like this:</p><div class="mediaobject"><img src="../images/00017.jpeg" alt="Configuring subinterfaces and subnets" class="calibre11"/><div class="caption"><p class="calibre15">The interface status in a terminal window</p></div></div><p class="calibre12"> </p><p class="calibre9">We can see all our subinterfaces along with their new IP addresses and states from the preceding listing.</p></div><div class="book" title="Configuring auxiliary services"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch03lvl3sec15" class="calibre1"/>Configuring auxiliary services</h3></div></div></div><p class="calibre9">After <a id="id151" class="calibre1"/>configuring router's subinterfaces, it is time to set up a DHCP server on our router for the user subnet and trusted WLANs:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">ip dhcp pool users</strong></span>
<span class="strong"><strong class="calibre2"> network 172.16.0.0 255.255.255.0</strong></span>
<span class="strong"><strong class="calibre2"> dns-server 172.16.0.1 8.8.8.8</strong></span>
<span class="strong"><strong class="calibre2"> default-router 172.16.0.1</strong></span>
<span class="strong"><strong class="calibre2">!</strong></span>
<span class="strong"><strong class="calibre2">ip dhcp pool trusted</strong></span>
<span class="strong"><strong class="calibre2"> network 172.16.1.0 255.255.255.0</strong></span>
<span class="strong"><strong class="calibre2"> dns-server 172.16.1.1 8.8.8.8</strong></span>
<span class="strong"><strong class="calibre2"> default-router 172.16.1.1</strong></span>
</pre></div><p class="calibre9">Next, let's<a id="id152" class="calibre1"/> configure NAT on the gateway so the lab network components can access external networks for downloading software updates, DNS resolution, e-mail exchange, and so on.</p><p class="calibre9">First, we need to identify the inside and outside NAT interfaces. We want to provide Internet access only to our users, admin, and servers, that is, VLANs 1 to 4 and the router subinterfaces <code class="literal">fa0/0.1</code>, <code class="literal">fa0/0.2</code>, <code class="literal">fa0/0.3</code>, and <code class="literal">fa0/0.4</code>, respectively. These are our inside interfaces:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">interface fa0/0.1</strong></span>
<span class="strong"><strong class="calibre2"> ip nat inside</strong></span>
<span class="strong"><strong class="calibre2">!</strong></span>
<span class="strong"><strong class="calibre2">interface fa0/0.2</strong></span>
<span class="strong"><strong class="calibre2"> ip nat inside</strong></span>
<span class="strong"><strong class="calibre2">!</strong></span>
<span class="strong"><strong class="calibre2">interface fa0/0.3</strong></span>
<span class="strong"><strong class="calibre2"> ip nat inside</strong></span>
<span class="strong"><strong class="calibre2">!</strong></span>
<span class="strong"><strong class="calibre2">interface fa0/0.4</strong></span>
<span class="strong"><strong class="calibre2"> ip nat inside</strong></span>
</pre></div><p class="calibre9">An outside interface is one which is connected to an external network and this is <code class="literal">fa0/0.5</code> in our case. This interface obtains its IP address from an external authority via DHCP:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">interface fa0/0.5</strong></span>
<span class="strong"><strong class="calibre2"> ip address dhcp</strong></span>
<span class="strong"><strong class="calibre2"> ip nat outside</strong></span>
<span class="strong"><strong class="calibre2"> ip nat inside source list 102 interface Ethernet1 overload </strong></span>

<span class="strong"><strong class="calibre2"> ip classless</strong></span>
<span class="strong"><strong class="calibre2"> ip route 0.0.0.0 0.0.0.0 192.168.0.1</strong></span>
</pre></div><div class="informalexample" title="Note"><h3 class="title2"><a id="tip13" class="calibre1"/>Tip</h3><p class="calibre9">If you have trouble with the NAT configuration, you can activate the debugging mode for NAT with the command <code class="literal">debug ip nat</code> to be able to track the source of your problem and fix it.</p><p class="calibre9">Additionally, the command <code class="literal">show ip nat translations</code> can also be helpful.</p></div><p class="calibre9">Next, let's configure a DNS service on the gateway. We will enable the DNS role and set Google's DNS server with the IP address 8.8.8.8 as our external name server. If you build a lab in a corporate network, you can use the IP address of your corporate DNS servers.</p><p class="calibre9">DNS role <a id="id153" class="calibre1"/>configuration can be performed in two steps:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Enable the role on the router and allow domain lookup with the following commands in the configuration mode:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">gw(config)# ip dns server</strong></span>
<span class="strong"><strong class="calibre2">gw(config)# ip domain-lookup</strong></span>
</pre></div></li><li class="listitem" value="2">Assign upstream name servers from which our router will get DNS information for requests to the Internet (insert the IP address of your preferred named server or add another with the same command):<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">gw(config)# ip name-server 8.8.8.8</strong></span>
</pre></div></li></ol><div class="calibre14"/></div><div class="informalexample" title="Note"><h3 class="title2"><a id="tip14" class="calibre1"/>Tip</h3><p class="calibre9">If you want to assign domain names to your servers or any other hosts in the lab network to be able to address them by name instead of IP address, you can do so with the following additional command for every host (change the name and IP according to your need): <code class="literal">gw(config)# ip host admin 10.1.0.30</code>.</p></div></div><div class="book" title="Basic gateway hardening"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch03lvl3sec16" class="calibre1"/>Basic gateway hardening</h3></div></div></div><p class="calibre9">The <a id="id154" class="calibre1"/>router is responsible for the communication control between our lab and the external untrusted network, which is assigned to VLAN 5 on the subinterface <code class="literal">fa0/0.5</code>. Thus we have to apply some hardening to the router and this interface. As a router-level security feature, we will utilize <a id="id155" class="calibre1"/><span class="strong"><strong class="calibre2">access control lists</strong></span> (<span class="strong"><strong class="calibre2">ACLs</strong></span>) (we will talk about this later in <a class="calibre1" title="Chapter 5. Implementing Security" href="part0038_split_000.html#147LC2-3ecab517ca6e4afbb3c20ab15f7b4d82">Chapter 5</a>, <span class="strong"><em class="calibre10">Implementing Security</em></span>) and password protection for a privileged mode:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">enable secret 0 secret_password</strong></span>
</pre></div><p class="calibre9">Next, let's harden the security of the external facing subinterface <code class="literal">fa0/0.5</code> by disabling unnecessary and potentially dangerous services. Get into the configuration mode of the interface:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">config tinterface fa0/0.5</strong></span>
</pre></div><p class="calibre9">Let's disable CDP and HSRP to reduce the attack surface and information disclosure about our devices to the untrusted subnet and enter the following commands:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">no cdp enable</strong></span>
<span class="strong"><strong class="calibre2">no standby</strong></span>
<span class="strong"><strong class="calibre2">no vrrp</strong></span>
</pre></div><p class="calibre9">The first command explicitly disables CDP which can broadcast valuable information about our device to the untrusted network.</p><p class="calibre9">The second and third commands explicitly disable <a id="id156" class="calibre1"/><span class="strong"><strong class="calibre2">Hot Standby Routing Protocol</strong></span> (<span class="strong"><strong class="calibre2">HSRP</strong></span>) and <a id="id157" class="calibre1"/><span class="strong"><strong class="calibre2">Virtual Router Redundancy Protocol</strong></span> (<span class="strong"><strong class="calibre2">VRRP</strong></span>), which could be used to carry out attacks from on untrusted network.</p><p class="calibre9">As the last step <a id="id158" class="calibre1"/>in router configuration, save the changes so that you do not lose them:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">copy running-config startup-config</strong></span>
</pre></div></div></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Configuring virtual wired network devices"><div class="book" id="OPEK2-3ecab517ca6e4afbb3c20ab15f7b4d82"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch03lvl1sec19" class="calibre1"/>Configuring virtual wired network devices</h1></div></div></div><p class="calibre9">Now, let's <a id="id159" class="calibre1"/>consider how we can implement our lab network using virtual devices. The logical topology will be exactly the same as the network topology described earlier (implemented on hardware devices) and have the same addressing. The main resources will be deployed in virtual machines on a single-host high-performance computer. For virtualization resources, we will use the free multiplatform software GNS3 and VirtualBox.</p><p class="calibre9">To start off, we need a high-performance computer with the correct operating system. In our case, it will be a laptop with an i7 x64 processor, 8 GB RAM, and running operating system Windows 8.1.</p></div>

<div class="book" title="Configuring virtual wired network devices">
<div class="book" title="Network virtualization platform"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch03lvl2sec25" class="calibre1"/>Network virtualization platform</h2></div></div></div><p class="calibre9">
<span class="strong"><strong class="calibre2">Graphical Network Simulator</strong></span> (<span class="strong"><strong class="calibre2">GNS3</strong></span>) <a id="id160" class="calibre1"/>is a <a id="id161" class="calibre1"/>platform for experiments, tests, demonstrations, and learning network technologies. GNS3 is a cross-platform tool and <a id="id162" class="calibre1"/>works on Windows, Linux, and Mac OS X. It has a convenient graphic interface and essentially is a GUI for Dynamips. Dynamips is a software emulator for Cisco routers, which allows us to emulate the hardware of router, loading, and interacting with real images of Cisco IOS. Dynamips supports the following platforms:</p><div class="book"><ul class="itemizedlist"><li class="listitem">1700 (1710-1760)</li><li class="listitem">2600 (2610-2650 XM)</li><li class="listitem">2691</li><li class="listitem">3600 (3620, 3640, 3660)</li><li class="listitem">3725</li><li class="listitem">3745</li><li class="listitem">7200 (from NPE-100 to NPE-G1)</li></ul></div><p class="calibre9">As a virtualization platform, GNS <a id="id163" class="calibre1"/>has some disadvantages. The most critical limitations are as follows:</p><div class="book"><ul class="itemizedlist"><li class="listitem"><span class="strong"><strong class="calibre2">Highly demanding for CPU and memory</strong></span>: 10 routers will seriously load the PC. The CPU usage can be reduced through the "idle PC" mechanism, which will be described later in the <span class="strong"><em class="calibre10">Network topology implementation</em></span> section.</li><li class="listitem"><span class="strong"><strong class="calibre2">Weak L2 support</strong></span>: There is no full emulation of network switches, only routers. But it is possible to set access/trunk ports and set switch modules with limited L2 functionality routers.</li></ul></div><p class="calibre9">But despite these limitations, a test lab can be built on the GNS engine.</p><p class="calibre9">Since GNS<a id="id164" class="calibre1"/> is a virtual router, it needs an image of Cisco IOS (or other) router operating system to function. You can obtain Cisco IOS images from the Cisco website, if you have an account with the necessary rights, or you can download them from the Internet. Another option is to download images from respective hardware equipment, if you have access to them.</p><div class="book" title="Software installation"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch03lvl3sec17" class="calibre1"/>Software installation</h3></div></div></div><p class="calibre9">First of all, we need to <a id="id165" class="calibre1"/>download the current version of GNS3 <a id="id166" class="calibre1"/>from the official website <a class="calibre1" href="https://www.gns3.com/">https://www.gns3.com/</a> after a simple registration procedure. After downloading the installation file (it should be named like <code class="literal">GNS3-1.4.4-all-in-one.exe</code>), just run it. The installation process is straightforward. This is a common process with the welcome screen, the license agreement window, and finally the checklist of components that will be installed. The GNS3 installation package comes with a set of necessary third-party software and if you are installing it from scratch, then leave it all. If some of them are already installed, you can uncheck those components:</p><div class="mediaobject"><img src="../images/00018.jpeg" alt="Software installation" class="calibre11"/><div class="caption"><p class="calibre15">GNS3 components</p></div></div><p class="calibre12"> </p><p class="calibre9">After several clicks on the <span class="strong"><strong class="calibre2">Next</strong></span> button, we will have a working network virtualization platform.</p><p class="calibre9">In our case, we <a id="id167" class="calibre1"/>are using Microsoft Windows 8.1 as a host operating system, so the installation process flows as described. But GNS3 is a multiplatform software, so you can also use it on Linux systems where the installation process is different but simple too. For example, GNS3 is available in repositories of Ubuntu or Debian and to install it you should just execute the command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">sudo apt-get install gns3</strong></span>
</pre></div><div class="informalexample" title="Note"><h3 class="title2"><a id="note12" class="calibre1"/>Note</h3><p class="calibre9">If you want to install GNS3 on Mac OS X, you can find a detailed installation guide at the official website: <a class="calibre1" href="https://gns3.com/support/docs/quick-start-guide-for-mac-users">https://gns3.com/support/docs/quick-start-guide-for-mac-users</a>.</p></div></div><div class="book" title="Initial configuration"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch03lvl3sec18" class="calibre1"/>Initial configuration</h3></div></div></div><p class="calibre9">So, it is <a id="id168" class="calibre1"/>time for starting and configuring our virtualization platform. For that purpose, let's find the shortcut for GNS3 on the desktop and execute it. When the application starts, you'll be prompted to save a new project.</p><p class="calibre9">After entering<a id="id169" class="calibre1"/> the name of the project, the application will open a working user interface of our virtual environment:</p><div class="mediaobject"><img src="../images/00019.jpeg" alt="Initial configuration" class="calibre11"/><div class="caption"><p class="calibre15">The GNS3 user interface</p></div></div><p class="calibre12"> </p><p class="calibre9">To set up the program, let's go to <span class="strong"><strong class="calibre2">Edit</strong></span> | <span class="strong"><strong class="calibre2">Preferences</strong></span>. Now, we can configure the working environment for own convenience. In the <span class="strong"><strong class="calibre2">General</strong></span> tab, we can choose the paths for saving working files, the styles and display settings of the interface, and the most important thing at this tab is the console emulation software and its settings. But since we are using Microsoft Windows as the host OS, we leave the defaults (PuTTY). In the <span class="strong"><strong class="calibre2">Server</strong></span> tab, we can change the server component parameters of GNS3, for example, the connection parameters of a remote server. But at this step, we leave defaults. In the <span class="strong"><strong class="calibre2">Packet capture</strong></span> tab, we can configure our connection to the network traffic analyzer. In the <span class="strong"><strong class="calibre2">VPCS</strong></span> tab, we can choose how to use host stubs. Host stubs can be used to validate network schema (for example, <code class="literal">ping</code>, <code class="literal">tracert</code>, and so on). The default application is installed with GNS3. Here, we can leave the default settings. In the <span class="strong"><strong class="calibre2">VirtualBox</strong></span> tab, we should set paths to the VirtualBox management application (<code class="literal">VBoxManage.exe</code>). We won't use the tabs <span class="strong"><strong class="calibre2">IOS on Unix</strong></span> and <span class="strong"><strong class="calibre2">QEMU</strong></span> in our lab, so we will leave these tabs without changes too.</p><p class="calibre9">What we need <a id="id170" class="calibre1"/>to do now is to add the Cisco IOS images in the list of used devices (if we have already obtained IOS images). This can be done in the <span class="strong"><strong class="calibre2">Dynamips</strong></span> tab. At this step, we need to create two virtual devices: switch and gateway. After clicking on the <span class="strong"><strong class="calibre2">New</strong></span> button, it will start the wizard for creating a virtual device. In the beginning, we are invited to enter the path to the IOS image file. After that, the image file will be decompressed and will be followed by a series of questions about the device. The specification of the platform should be recognized automatically. RAM should be left at the default value. On the <span class="strong"><strong class="calibre2">Network adapters</strong></span> page, you should select the adapters that will be used and their slots.</p><p class="calibre9">For the virtual switch device, we should select the switched network adapter. In GNS3, it is NM-16ESW. In our case, we use slot 0. You can choose another, but we recommend you to use the same one to match with the <span class="strong"><em class="calibre10">hardware configuration</em></span> case described earlier. For the virtual gateway device, we should select the interface with 1 port, for example, NM-1FE-TX, and put it in slot 0.</p><p class="calibre9">The last thing to address is the <span class="strong"><strong class="calibre2">Idle PC</strong></span> value; at this step, leave this field blank:</p><div class="mediaobject"><img src="../images/00020.jpeg" alt="Initial configuration" class="calibre11"/><div class="caption"><p class="calibre15">Virtual IOS devices</p></div></div><p class="calibre12"> </p><p class="calibre9">So, after these <a id="id171" class="calibre1"/>manipulations, we will have two virtual Cisco IOS instances in the list of available devices.</p></div><div class="book" title="Network topology implementation"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch03lvl3sec19" class="calibre1"/>Network topology implementation</h3></div></div></div><p class="calibre9">Next, let's <a id="id172" class="calibre1"/>implement our network topology in the GNS3 workspace. The process of designing a network diagram is similar to any other designing system: select device icons and drag them to the workspace. After that, connect network interfaces of the devices with each other using the <span class="strong"><strong class="calibre2">Add a link</strong></span> tool.</p><p class="calibre9">In our case, the result is similar to the following screenshot:</p><div class="mediaobject"><img src="../images/00021.jpeg" alt="Network topology implementation" class="calibre11"/><div class="caption"><p class="calibre15">The network diagram</p></div></div><p class="calibre12"> </p><p class="calibre9">Now, we <a id="id173" class="calibre1"/>use stubs <span class="strong"><strong class="calibre2">VPCS</strong></span> as hosts. The switch and the router are our Cisco IOS devices created earlier based on IOS images for Dynamips. For connections with a SOHO router and a hardware AP, we use the tool called <span class="strong"><strong class="calibre2">Cloud</strong></span>.</p><p class="calibre9">To match with the <span class="strong"><em class="calibre10">hardware configuration</em></span> case described earlier, connections between interfaces should be as follows:</p><div class="informalexample"><table border="1" class="calibre16"><colgroup class="calibre17"><col class="calibre18"/><col class="calibre18"/><col class="calibre18"/><col class="calibre18"/></colgroup><thead class="calibre19"><tr class="calibre20"><th valign="bottom" class="calibre21">
<p class="calibre22">Functional group</p>
</th><th valign="bottom" class="calibre21">
<p class="calibre22">Connection type</p>
</th><th valign="bottom" class="calibre21">
<p class="calibre22">Device</p>
</th><th valign="bottom" class="calibre21">
<p class="calibre22">Interface</p>
</th></tr></thead><tbody class="calibre23"><tr class="calibre20"><td valign="top" class="calibre24">
<p class="calibre22">Servers</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">
<code class="literal1">Ethernet0</code>
</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">SW</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">
<code class="literal1">F0/7</code> to <code class="literal1">F0/10</code>
</p>
</td></tr><tr class="calibre20"><td valign="top" class="calibre24">
<p class="calibre22">User hosts</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">
<code class="literal1">Ethernet0</code>
</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">SW</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">
<code class="literal1">F0/4</code> to <code class="literal1">F0/6</code>
</p>
</td></tr><tr class="calibre20"><td valign="top" class="calibre24">
<p class="calibre22">Management</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">
<code class="literal1">Ethernet0</code>
</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">SW</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">
<code class="literal1">F0/3</code>
</p>
</td></tr><tr class="calibre20"><td valign="top" class="calibre24">
<p class="calibre22">Cloud</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">
<code class="literal1">nio_gen_eth:Ethernet</code>
</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">SW</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">
<code class="literal1">F0/2</code>
</p>
</td></tr><tr class="calibre20"><td valign="top" class="calibre24">
<p class="calibre22">GW</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">
<code class="literal1">FastEthernet0/0</code>
</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">SW</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">
<code class="literal1">F0/1</code>
</p>
</td></tr></tbody></table></div><p class="calibre9">After all the components are placed in the project workspace, we need to fill in the field <span class="strong"><strong class="calibre2">Idle PC</strong></span> of our IOS devices. The parameter <span class="strong"><strong class="calibre2">Idle PC</strong></span> allows us to significantly reduce the CPU usage, but it <a id="id174" class="calibre1"/>can be changed only if the device is running. Thus we need to start these network devices by clicking on the button <span class="strong"><strong class="calibre2">Start devices</strong></span> placed on the toolbar of the main window, or by clicking on the item <span class="strong"><strong class="calibre2">Start</strong></span> in the context menu of the device. For each IOS device, we need to select the item <span class="strong"><strong class="calibre2">Idle PC</strong></span> in the context menu and in appeared dialog we should select the value marked by an asterisk.</p></div></div></div>

<div class="book" title="Configuring virtual wired network devices">
<div class="book" title="Switch"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch03lvl2sec26" class="calibre1"/>Switch</h2></div></div></div><p class="calibre9">Interaction <a id="id175" class="calibre1"/>with the device is performed via the console. For this, we just need to right-click on the device icon in the project workspace and select <span class="strong"><strong class="calibre2">Console</strong></span> from the context menu. After that, the terminal emulator will be launched with the established connection.</p><p class="calibre9">So, let's create the config for our core switch. First of all, we set the hostname:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">config t</strong></span>
<span class="strong"><strong class="calibre2"> hostname sw</strong></span>
<span class="strong"><strong class="calibre2"> exit</strong></span>
</pre></div><p class="calibre9">Then we create the VLANs:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">vlan database</strong></span>
<span class="strong"><strong class="calibre2"> vlan 2 name servers</strong></span>
<span class="strong"><strong class="calibre2"> vlan 3 name users</strong></span>
<span class="strong"><strong class="calibre2"> vlan 4 name trusted_wlan</strong></span>
<span class="strong"><strong class="calibre2"> vlan 5 name external_network</strong></span>
<span class="strong"><strong class="calibre2"> exit</strong></span>
</pre></div><p class="calibre9">In the next step, we set up the interfaces, set one trunk port to the router, and set the access ports for network hosts:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">config t</strong></span>
<span class="strong"><strong class="calibre2">!</strong></span>
<span class="strong"><strong class="calibre2">interface fa0/1</strong></span>
<span class="strong"><strong class="calibre2"> switchport mode trunk</strong></span>
<span class="strong"><strong class="calibre2"> description router trunk</strong></span>
<span class="strong"><strong class="calibre2"> no shutdown</strong></span>
<span class="strong"><strong class="calibre2">!</strong></span>
<span class="strong"><strong class="calibre2">interface fa0/2</strong></span>
<span class="strong"><strong class="calibre2"> switchport mode access</strong></span>
<span class="strong"><strong class="calibre2"> switchport access vlan 5</strong></span>
<span class="strong"><strong class="calibre2"> description external network</strong></span>
<span class="strong"><strong class="calibre2"> no shutdown</strong></span>
<span class="strong"><strong class="calibre2">!</strong></span>
<span class="strong"><strong class="calibre2">interface fa0/3</strong></span>
<span class="strong"><strong class="calibre2"> switchport mode access</strong></span>
<span class="strong"><strong class="calibre2"> switchport access vlan 1</strong></span>
<span class="strong"><strong class="calibre2"> no shutdown</strong></span>
<span class="strong"><strong class="calibre2">!</strong></span>
<span class="strong"><strong class="calibre2">interface fa0/4</strong></span>
<span class="strong"><strong class="calibre2"> switchport mode access</strong></span>
<span class="strong"><strong class="calibre2"> switchport access vlan 3</strong></span>
<span class="strong"><strong class="calibre2"> no shutdown</strong></span>
<span class="strong"><strong class="calibre2">!</strong></span>
<span class="strong"><strong class="calibre2">interface fa0/5</strong></span>
<span class="strong"><strong class="calibre2"> switchport mode access</strong></span>
<span class="strong"><strong class="calibre2"> switchport access vlan 3</strong></span>
<span class="strong"><strong class="calibre2"> no shutdown</strong></span>
<span class="strong"><strong class="calibre2">!</strong></span>
<span class="strong"><strong class="calibre2">interface fa0/6</strong></span>
<span class="strong"><strong class="calibre2"> switchport mode access</strong></span>
<span class="strong"><strong class="calibre2"> switchport access vlan 3</strong></span>
<span class="strong"><strong class="calibre2"> no shutdown</strong></span>
<span class="strong"><strong class="calibre2">!</strong></span>
<span class="strong"><strong class="calibre2">interface fa0/7</strong></span>
<span class="strong"><strong class="calibre2"> switchport mode access</strong></span>
<span class="strong"><strong class="calibre2"> switchport access vlan 2</strong></span>
<span class="strong"><strong class="calibre2"> no shutdown</strong></span>
<span class="strong"><strong class="calibre2">!</strong></span>
<span class="strong"><strong class="calibre2">interface fa0/8</strong></span>
<span class="strong"><strong class="calibre2"> switchport mode access</strong></span>
<span class="strong"><strong class="calibre2"> switchport access vlan 2</strong></span>
<span class="strong"><strong class="calibre2"> no shutdown</strong></span>
<span class="strong"><strong class="calibre2">!</strong></span>
<span class="strong"><strong class="calibre2">interface fa0/9</strong></span>
<span class="strong"><strong class="calibre2"> switchport mode access</strong></span>
<span class="strong"><strong class="calibre2"> switchport access vlan 2</strong></span>
<span class="strong"><strong class="calibre2"> no shutdown</strong></span>
<span class="strong"><strong class="calibre2">!</strong></span>
<span class="strong"><strong class="calibre2">interface fa0/10</strong></span>
<span class="strong"><strong class="calibre2"> switchport mode access</strong></span>
<span class="strong"><strong class="calibre2"> switchport access vlan 2</strong></span>
<span class="strong"><strong class="calibre2"> no shutdown</strong></span>
<span class="strong"><strong class="calibre2">!</strong></span>
<span class="strong"><strong class="calibre2">interface fa0/11</strong></span>
<span class="strong"><strong class="calibre2"> switchport mode access</strong></span>
<span class="strong"><strong class="calibre2"> switchport access vlan 2</strong></span>
<span class="strong"><strong class="calibre2"> description IDS</strong></span>
<span class="strong"><strong class="calibre2"> no shutdown</strong></span>
<span class="strong"><strong class="calibre2">!</strong></span>
<span class="strong"><strong class="calibre2">interface fa0/12</strong></span>
<span class="strong"><strong class="calibre2"> switchport mode access</strong></span>
<span class="strong"><strong class="calibre2"> switchport access vlan 4</strong></span>
<span class="strong"><strong class="calibre2"> description Trusted WLAN</strong></span>
<span class="strong"><strong class="calibre2"> no shutdown</strong></span>
<span class="strong"><strong class="calibre2">exit</strong></span>
</pre></div><p class="calibre9">As you can see, the <a id="id176" class="calibre1"/>work with the virtual network device corresponds to the work with the hardware configuration case; there is a little difference in the way how physical devices are connected to each other.</p><p class="calibre9">If you work with virtual network devices, it is not so important to properly harden them like hardware devices.</p></div></div>

<div class="book" title="Configuring virtual wired network devices">
<div class="book" title="Gateway"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch03lvl2sec27" class="calibre1"/>Gateway</h2></div></div></div><p class="calibre9">There is no <a id="id177" class="calibre1"/>significant difference in configuring hardware and virtual devices; therefore, we do the same as we did in the case of hardware configuration:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">interface fa0/0.1</strong></span>
<span class="strong"><strong class="calibre2"> encapsulation dot1Q 1</strong></span>
<span class="strong"><strong class="calibre2"> ip address 10.1.0.1 255.255.255.0</strong></span>
<span class="strong"><strong class="calibre2">!</strong></span>
<span class="strong"><strong class="calibre2">interface fa0/0.2</strong></span>
<span class="strong"><strong class="calibre2"> encapsulation dot1Q 2</strong></span>
<span class="strong"><strong class="calibre2"> ip address 10.0.0.1 255.255.255.0</strong></span>
<span class="strong"><strong class="calibre2">!</strong></span>
<span class="strong"><strong class="calibre2">interface fa0/0.3</strong></span>
<span class="strong"><strong class="calibre2"> encapsulation dot1Q 3</strong></span>
<span class="strong"><strong class="calibre2"> ip address 172.16.0.1 255.255.255.0</strong></span>
<span class="strong"><strong class="calibre2">!</strong></span>
<span class="strong"><strong class="calibre2">interface fa0/0.4</strong></span>
<span class="strong"><strong class="calibre2"> encapsulation dot1Q 4</strong></span>
<span class="strong"><strong class="calibre2"> ip address 172.16.1.1 255.255.255.0</strong></span>

<span class="strong"><strong class="calibre2">interface fa0/0</strong></span>
<span class="strong"><strong class="calibre2"> no shutdown</strong></span>

<span class="strong"><strong class="calibre2">ip dhcp pool users</strong></span>
<span class="strong"><strong class="calibre2"> network 172.16.0.0 255.255.255.0</strong></span>
<span class="strong"><strong class="calibre2"> dns-server 172.16.0.1 8.8.8.8</strong></span>
<span class="strong"><strong class="calibre2"> default-router 172.16.0.1</strong></span>
<span class="strong"><strong class="calibre2">!</strong></span>
<span class="strong"><strong class="calibre2">ip dhcp pool trusted</strong></span>
<span class="strong"><strong class="calibre2"> network 172.16.1.0 255.255.255.0</strong></span>
<span class="strong"><strong class="calibre2"> dns-server 172.16.1.1 8.8.8.8</strong></span>
<span class="strong"><strong class="calibre2"> default-router 172.16.1.1</strong></span>

<span class="strong"><strong class="calibre2">!interface fa0/0.1</strong></span>
<span class="strong"><strong class="calibre2"> ip nat inside</strong></span>
<span class="strong"><strong class="calibre2">!</strong></span>
<span class="strong"><strong class="calibre2">interface fa0/0.2</strong></span>
<span class="strong"><strong class="calibre2"> ip nat inside</strong></span>
<span class="strong"><strong class="calibre2">!</strong></span>
<span class="strong"><strong class="calibre2">interface fa0/0.3</strong></span>
<span class="strong"><strong class="calibre2"> ip nat inside</strong></span>
<span class="strong"><strong class="calibre2">!</strong></span>
<span class="strong"><strong class="calibre2">interface fa0/0.4</strong></span>
<span class="strong"><strong class="calibre2"> ip nat inside</strong></span>
<span class="strong"><strong class="calibre2">!</strong></span>
<span class="strong"><strong class="calibre2">interface fa0/0.5</strong></span>
<span class="strong"><strong class="calibre2"> ip address dhcp</strong></span>
<span class="strong"><strong class="calibre2"> ip nat outside</strong></span>
<span class="strong"><strong class="calibre2"> ip nat inside source list 102 interface Ethernet1 overload </strong></span>

<span class="strong"><strong class="calibre2"> ip classless</strong></span>
<span class="strong"><strong class="calibre2"> ip route 0.0.0.0 0.0.0.0 192.168.0.1</strong></span>
</pre></div></div></div>

<div class="book" title="Configuring virtual wired network devices">
<div class="book" title="Virtual host emulation"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_4"><a id="ch03lvl2sec28" class="calibre1"/>Virtual host emulation</h2></div></div></div><p class="calibre9">Now, we <a id="id178" class="calibre1"/>need to check our virtual network's working capacity with host emulators. We will show you how to connect VirtualBox VMs to the virtual network in the next chapter, but at the moment the functionality of emulators is enough for testing purposes.</p><p class="calibre9">Such emulators are already provided by GNS; they are stubs of the type <span class="strong"><strong class="calibre2">VPCS</strong></span>. These virtual devices allow us to perform basic operations for emulating real devices based on IP connections (ICMP ping and TCP/UDP connections). The interaction with such devices is done by the console and manual input of commands. In our case, for setting up addresses in the device console, we just need to input a command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">ip dhcp</strong></span>
</pre></div><p class="calibre9">Of course, we can use static addresses for this purpose in the device console input command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">ip 10.0.0.101 255.255.255.0 10.0.0.1</strong></span>
</pre></div><p class="calibre9">Where:</p><div class="book"><ul class="itemizedlist"><li class="listitem">10.0.0.101 is the host address</li><li class="listitem">255.255.255.0 is the network mask</li><li class="listitem">10.0.0.1 is the gateway address</li></ul></div><p class="calibre9">For testing <a id="id179" class="calibre1"/>network connectivity and operability, we can use the ICMP-based commands <code class="literal">ping</code> and <code class="literal">tracert</code>:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">ping 10.0.0.1</strong></span>
<span class="strong"><strong class="calibre2">tracert 10.0.0.1</strong></span>
</pre></div><div class="informalexample" title="Note"><h3 class="title2"><a id="note13" class="calibre1"/>Note</h3><p class="calibre9">Using GNS, we can also easily capture network traffic, for example, with Wireshark.</p><p class="calibre9">You need to do the following:</p><p class="calibre9">1) Right-click on the link between the two devices.</p><p class="calibre9">2) Choose the item <span class="strong"><strong class="calibre2">Сapture</strong></span> from the context menu.</p><p class="calibre9">3) After that, Wireshark will start (or another application that was set in the <span class="strong"><strong class="calibre2">Packet capture</strong></span> tab of GNS3 preferences).</p><p class="calibre9">In the Wireshark window, we will have all the intercepted packets.</p></div></div></div>

<div class="book" title="Configuring virtual wired network devices">
<div class="book" title="Wireless hardware devices"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_5"><a id="ch03lvl2sec29" class="calibre1"/>Wireless hardware devices</h2></div></div></div><p class="calibre9">The only type<a id="id180" class="calibre1"/> of network device that we cannot virtualize is a wireless access points. Therefore, we will use the physical network devices. As in the case of hardware configuration, it will be an access point and a SOHO router.</p><p class="calibre9">For interaction with the external world, GNS3 provides a tool <span class="strong"><strong class="calibre2">Cloud</strong></span>, which is the built-in connector between the GNS3 virtual infrastructure and the network adapter of the host computer.</p><p class="calibre9">If your host computer has two Ethernet adapters, you can use two clouds to connect to each physical device. But if your host computer is a laptop, as in our case, you can use an Ethernet adapter for connecting to the SOHO router and use the wireless adapter of your host computer as the access point instead of a hardware access point. </p><p class="calibre9">If you have only one Ethernet adapter and still do not want to use the wireless adapter of the host computer, you have two options:</p><div class="book"><ul class="itemizedlist"><li class="listitem">Manually switching between hardware devices (AP and SOHO router)</li><li class="listitem">Preparing an additional VM with a software AP and a USB Wi-Fi interface connected to it using the USB-forwarding feature of VirtualBox (we briefly show how to install the necessary software and implement such a scenario in <a class="calibre1" title="Chapter 7. Preparing a Wireless Penetration Testing Platform" href="part0047_split_000.html#1CQAE1-3ecab517ca6e4afbb3c20ab15f7b4d82">Chapter 7</a>, <span class="strong"><em class="calibre10">Preparing a Wireless Penetration Testing Platform</em></span>)</li></ul></div><p class="calibre9">Now, let's see how to connect a network adapter of the host computer to our virtual infrastructure.</p><p class="calibre9">Right-click <a id="id181" class="calibre1"/>on the icon of the <span class="strong"><strong class="calibre2">Сloud</strong></span> tool and open the configuration window of <span class="strong"><strong class="calibre2">Cloud</strong></span> by selecting <span class="strong"><strong class="calibre2">Configure</strong></span> from the context menu. We should specify the network adapter that we want to use in the field <span class="strong"><strong class="calibre2">Ethernet NIO</strong></span> in the configuration window by navigating to <span class="strong"><strong class="calibre2">Cloud</strong></span> | <span class="strong"><strong class="calibre2">Ethernet</strong></span>. After that, click on the button <span class="strong"><strong class="calibre2">Add</strong></span>.</p><div class="mediaobject"><img src="../images/00022.jpeg" alt="Wireless hardware devices" class="calibre11"/><div class="caption"><p class="calibre15">The Cloud configuration window</p></div></div><p class="calibre12"> </p><p class="calibre9">Now, <span class="strong"><strong class="calibre2">Cloud</strong></span> is configured. Quite simple, isn't it?</p></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Configuring WLANs" id="PNV61-3ecab517ca6e4afbb3c20ab15f7b4d82"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch03lvl1sec20" class="calibre1"/>Configuring WLANs</h1></div></div></div><p class="calibre9">Now, let's<a id="id182" class="calibre1"/> consider the creation of a wireless network as part of our test infrastructure. Based on the resources that we have, we can create wireless networks using three techniques:</p><div class="book"><ul class="itemizedlist"><li class="listitem">Guest WLAN based on the SOHO router</li><li class="listitem">Trusted WLAN based on the hardware access point</li><li class="listitem">Trusted WLAN based on the software access point</li></ul></div><p class="calibre9">Each technique has its own characteristics (advantages and disadvantages) and provides a number of choices. We will cover all three options.</p></div>

<div class="book" title="Configuring WLANs" id="PNV61-3ecab517ca6e4afbb3c20ab15f7b4d82">
<div class="book" title="Guest WLAN"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch03lvl2sec30" class="calibre1"/>Guest WLAN</h2></div></div></div><p class="calibre9">As our<a id="id183" class="calibre1"/> guest WLAN is based on a SOHO router, we will discuss both wired and wireless configurations here to build a guest WLAN and provide Internet access (external network) for the whole lab network.</p><p class="calibre9">All modern SOHO routers (like ASUS, Linksys, and D-Link) provide pretty much the same capabilities and configuration options and modes regardless of the model. Therefore, we are not going to provide step-by-step instructions on where to click and what to type in the web interface of a certain router model (especially because it does not make any sense for IT specialists). However, we are going to just provide you certain settings instead to assure that we have the same network configs with our readers and will not have any compatibility issues in later chapters.</p><p class="calibre9">Please enable a DHCP server role for the LAN network if it was not enabled yet and set the following configs:</p><div class="informalexample"><table border="1" class="calibre16"><colgroup class="calibre17"><col class="calibre18"/><col class="calibre18"/></colgroup><thead class="calibre19"><tr class="calibre20"><th valign="bottom" class="calibre21">
<p class="calibre22">Settings</p>
</th><th valign="bottom" class="calibre21">
<p class="calibre22">Values</p>
</th></tr></thead><tbody class="calibre23"><tr class="calibre20"><td valign="top" class="calibre24">
<p class="calibre22">LAN IP address</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">192.168.0.2</p>
</td></tr><tr class="calibre20"><td valign="top" class="calibre24">
<p class="calibre22">DHCP IP pool start</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">192.168.0.3</p>
</td></tr><tr class="calibre20"><td valign="top" class="calibre24">
<p class="calibre22">DHCP IP pool end</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">192.168.0.20</p>
</td></tr></tbody></table></div><p class="calibre9">Now, configure the WLAN settings on your SOHO router and set your guest WLAN name (SSID) to whatever you like (we just name it <code class="literal">Guest</code>), set the protection type as WPA2, and set a strong passphrase (we assume that as a security specialist you know what makes a strong passphrase, so we will not discuss password rules here).</p><p class="calibre9">As the last steps in the SOHO router configuration, reboot it, connect any client device to the guest WLAN, and test the Internet connection.</p></div></div>

<div class="book" title="Configuring WLANs" id="PNV61-3ecab517ca6e4afbb3c20ab15f7b4d82">
<div class="book" title="Preparing the hardware access point"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch03lvl2sec31" class="calibre1"/>Preparing the hardware access point</h2></div></div></div><p class="calibre9">Let's continue<a id="id184" class="calibre1"/> installing and configuring our hardware access point. Now, we can connect to the access point device directly via a COM-port and follow the instructions given here. Since we are using devices from one manufacturer and are working with the same software platform, the configuration process is very similar to our previous tasks. Of course, configuring an access point has its own nuances, which we will now outline. First, let's go to privileged mode:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">enable</strong></span>
<span class="strong"><strong class="calibre2">conf t</strong></span>
</pre></div><p class="calibre9">Set a hostname for our device:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">hostname TrustedWiFiAP</strong></span>
</pre></div><p class="calibre9">Limit access to the device (only the local access level):</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2"> line vty 0 4</strong></span>
<span class="strong"><strong class="calibre2">  login local</strong></span>
<span class="strong"><strong class="calibre2">  exit</strong></span>
<span class="strong"><strong class="calibre2"> line console 0</strong></span>
<span class="strong"><strong class="calibre2">  login local</strong></span>
<span class="strong"><strong class="calibre2">  exit</strong></span>
</pre></div><p class="calibre9">Next, we will set a password for the privileged mode:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">enable secret 0 secret_password</strong></span>
</pre></div><p class="calibre9">Finally, we should configure a bridge network interface to allow the trusted WLAN to communicate with the rest of our lab infrastructure:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2"> interface bv1</strong></span>
<span class="strong"><strong class="calibre2">  ip address 172.16.1.2 255.255.255.0</strong></span>
<span class="strong"><strong class="calibre2">  exit</strong></span>
<span class="strong"><strong class="calibre2"> ip default-gateway 172.16.1.1</strong></span>
</pre></div><p class="calibre9">Now, we just need to save the new configuration and finish the WLAN setup for now:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">copy running-config startup-config</strong></span>
</pre></div><p class="calibre9">We will leave further hardware AP configuration (as well as software AP) for <a class="calibre1" title="Chapter 5. Implementing Security" href="part0038_split_000.html#147LC2-3ecab517ca6e4afbb3c20ab15f7b4d82">Chapter 5</a>, <span class="strong"><em class="calibre10">Implementing Security</em></span>, where we will already have a RADIUS server installed to be able to apply proper security to our trusted WLAN.</p></div></div>
<div class="book" title="Summary" id="QMFO1-3ecab517ca6e4afbb3c20ab15f7b4d82"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch03lvl1sec21" class="calibre1"/>Summary</h1></div></div></div><p class="calibre9">In this chapter, we discussed the network communication and access rules in our lab environment. You saw two options for building your lab network: based on hardware Cisco devices and based on virtual ones.</p><p class="calibre9">You can now configure your devices and get a working network for any of the two provided options, depending on which one you chose for your lab budget.</p><p class="calibre9">Whenever you need it, you can go further and add and configure more network components/devices/subnets to extend your lab in much the same way as we have configured our basic lab network.</p><p class="calibre9">In the next chapter, we will show you how to design application lab components that will fulfill our main lab task: learning and practicing penetration testing.</p></div></body></html>