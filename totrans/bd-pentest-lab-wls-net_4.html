<html><head></head><body>
<div id="page" style="height:0pt"/><div class="book" title="Chapter&#xA0;4.&#xA0;Designing Application Lab Components" id="RL0A1-3ecab517ca6e4afbb3c20ab15f7b4d82"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch04" class="calibre1"/>Chapter 4. Designing Application Lab Components</h1></div></div></div><p class="calibre9">In the previous chapter, we prepared a network "basis" for the lab in two options: hardware and virtual. Now, it is time to fill the lab network with application-level functional components such as web servers and database servers. Those components are needed to build a lab network that has most of the capabilities of a real enterprise network to let a penetration tester practice the most common and "must-know" cases and techniques.</p><p class="calibre9">Usually, applications <a id="id185" class="calibre1"/>and network services are the main goal for attackers and the main target of their attacks. Such components are usually used to process and store financial and private data, trade secrets, and other sensitive confidential data. They are often used to manage other network components and accounts, thus controlling the access to network resources. Some of them can provide various customer services and are therefore one of the key profit or reputation systems for a commercial company, so-called business-critical systems (or application/services).</p><p class="calibre9">Needless to say, companies place high emphasis on protecting such systems and services and often tend to get another third-party opinion, ordering penetration tests and other information security consultancy services.</p><p class="calibre9">That is why you have to be well-prepared to meet at least some of the popular network services and we will see how to reach that goal in this chapter.</p><p class="calibre9">This chapter covers the following topics:</p><div class="book"><ul class="itemizedlist"><li class="listitem">Planning services</li><li class="listitem">Creating virtual servers and workstations</li><li class="listitem">Installing and configuring domain services</li><li class="listitem">Installing a certification authority</li><li class="listitem">Installing a remote management service</li><li class="listitem">Installing an e-mail service</li><li class="listitem">Installing vulnerable network services</li><li class="listitem">Installing web applications</li></ul></div></div>

<div class="book" title="Chapter&#xA0;4.&#xA0;Designing Application Lab Components" id="RL0A1-3ecab517ca6e4afbb3c20ab15f7b4d82">
<div class="book" title="Planning services"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_1"><a id="ch04lvl1sec22" class="calibre1"/>Planning services</h1></div></div></div><p class="calibre9">As usual, before you start building something, it should be planned and all prerequisites should be fulfilled.</p><p class="calibre9">In the <a id="id186" class="calibre1"/>current topic, we are going to define which server will host which services and applications. We are going to try to host several applications and services at one server, because most of us are limited with computing resources and server hardware, remember?</p><p class="calibre9">So, depending on your capabilities and budget, you can use relatively powerful servers to host several relatively powerful VMs or you can use SOHO computers to host VMs with limited RAM and CPUs.</p><div class="informalexample" title="Note"><h3 class="title2"><a id="tip15" class="calibre1"/>Tip</h3><p class="calibre9">
<span class="strong"><strong class="calibre2">Lab environment flexibility</strong></span>
</p><p class="calibre9">It is worth reminding that it depends on your own needs and preferences which hosts to include in your lab and which ones to omit. We just want to show the most useful options of installing lab components, but it is totally up to you what exactly to use and what to do not use.</p><p class="calibre9">A good thing about using virtual machines is that you do not have to keep all the servers turned on at the same time. For most of your lab tasks, you do not even need to turn on your network devices. In most cases, it is enough to just turn one VM on and keep everything else suspended.</p></div><p class="calibre9">As we have already decided in the previous chapters, the IP range for our server subnet is 10.0.0.0/24 and the IP address 10.0.0.1 is already assigned to the core router's subinterface. Workstations will get their dynamic IP addresses from the router via DHCP, so we don't need to plan their address space now, except the admin workstation which has the IP address 10.1.0.30.</p><p class="calibre9">Keeping all that in mind, let's draw another table to summarize what and on which IP addresses we are going to install:</p><div class="informalexample"><table border="1" class="calibre16"><colgroup class="calibre17"><col class="calibre18"/><col class="calibre18"/><col class="calibre18"/><col class="calibre18"/></colgroup><thead class="calibre19"><tr class="calibre20"><th valign="bottom" class="calibre21">
<p class="calibre22">IP address</p>
</th><th valign="bottom" class="calibre21">
<p class="calibre22">OS</p>
</th><th valign="bottom" class="calibre21">
<p class="calibre22">Apps and services</p>
</th><th valign="bottom" class="calibre21">
<p class="calibre22">Remarks</p>
</th></tr></thead><tbody class="calibre23"><tr class="calibre20"><td valign="top" class="calibre24">
<p class="calibre22">10.0.0.2</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">Windows Server 2008</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">Directory services</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">AD, e-mail server, certification authority, SSH</p>
</td></tr><tr class="calibre20"><td valign="top" class="calibre24">
<p class="calibre22">10.0.0.3</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">Linux</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">Metasploitable 2</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">Vulnerable network services</p>
</td></tr><tr class="calibre20"><td valign="top" class="calibre24">
<p class="calibre22">10.0.0.4</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">CentOS</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">vulnVoIP</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">Vulnerable VoIP service</p>
</td></tr><tr class="calibre20"><td valign="top" class="calibre24">
<p class="calibre22">10.0.0.5</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">Ubuntu Server</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">Web application server</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">Liferay Portal CE,</p>
<p class="calibre22">OWASP WebGoat,</p>
<p class="calibre22">DVWA</p>
</td></tr></tbody></table></div><p class="calibre9">You can always <a id="id187" class="calibre1"/>get back to this table to quickly refresh the server subnet's layout in your memory.</p><div class="informalexample" title="Note"><h3 class="title2"><a id="tip16" class="calibre1"/>Tip</h3><p class="calibre9">
<span class="strong"><strong class="calibre2">Back up your lab systems</strong></span>
</p><p class="calibre9">Do not forget to make snapshots of your VMs after finishing installations. There is a big probability of unintentionally breaking something during further hacking exercises and it is good to have a backup image which you can quickly restore—a snapshot in case of VM.</p><p class="calibre9">You will also probably want to have several snapshots of some VMs having various configurations or security levels to be able to quickly switch between them according to your current lab tasks.</p></div></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Creating virtual servers and workstations"><div class="book" id="SJGS2-3ecab517ca6e4afbb3c20ab15f7b4d82"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch04lvl1sec23" class="calibre1"/>Creating virtual servers and workstations</h1></div></div></div><p class="calibre9">Now we know<a id="id188" class="calibre1"/> which services and servers we want to have, but before we install them, let's quickly review how we can create VMs and connect them to our lab network. We will use Oracle VirtualBox virtualization software for that purpose, because it is free and powerful at the same time.</p></div>

<div class="book" title="Creating virtual servers and workstations">
<div class="book" title="VirtualBox overview and installation"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch04lvl2sec32" class="calibre1"/>VirtualBox overview and installation</h2></div></div></div><p class="calibre9">As we said <a id="id189" class="calibre1"/>earlier, we will use Oracle VM VirtualBox as the virtualization platform for hosts. VirtualBox is a powerful, feature-rich, high-performance virtualization solution for enterprise as well as home use. VirtualBox is freely available as open source software under the terms of the GNU <span class="strong"><strong class="calibre2">General Public License</strong></span> (<span class="strong"><strong class="calibre2">GPL</strong></span>) Version 2.</p><div class="informalexample" title="Note"><h3 class="title2"><a id="tip17" class="calibre1"/>Tip</h3><p class="calibre9">You can always refer to the official VirtualBox documentation to get more information (<a class="calibre1" href="https://www.virtualbox.org/wiki/Documentation">https://www.virtualbox.org/wiki/Documentation</a>).</p></div><p class="calibre9">VirtualBox can be launched on different operating systems and supports a large number of guest operating systems including but not limited to Windows and Linux.</p><p class="calibre9">Support for images of hard drives <a id="id190" class="calibre1"/><span class="strong"><strong class="calibre2">VMDK</strong></span> (<span class="strong"><strong class="calibre2">VMware</strong></span>) and <span class="strong"><strong class="calibre2">VHD</strong></span> (<span class="strong"><strong class="calibre2">Microsoft Virtual PC</strong></span>) is <a id="id191" class="calibre1"/>able to create and use portable virtual hosts. But most importantly, VirtualBox supports snapshots, which greatly facilitates the work in our test infrastructure. So, that fact makes VirtualBox the best choice for our purpose.</p><p class="calibre9">Firstly, we <a id="id192" class="calibre1"/>need to get the distribution packet of VirtualBox. We can download it from the <a class="calibre1" href="https://www.virtualbox.org/wiki/Downloads">https://www.virtualbox.org/wiki/Downloads</a> website. Choose the binaries packet for your platform and just click on the link.</p><p class="calibre9">After downloading, execute the obtained file. The installation process is simple and does not require specific manipulations.</p><p class="calibre9">After starting the VirtualBox application, you will see the Virtual Machine management interface window. This interface is pretty straightforward and does not require further explanation.</p><div class="mediaobject"><img src="../images/00023.jpeg" alt="VirtualBox overview and installation" class="calibre11"/><div class="caption"><p class="calibre15">The Oracle VM VirtualBox management interface</p></div></div><p class="calibre12"> </p></div></div>

<div class="book" title="Creating virtual servers and workstations">
<div class="book" title="Creating virtual machines"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch04lvl2sec33" class="calibre1"/>Creating virtual machines</h2></div></div></div><p class="calibre9">For creating<a id="id193" class="calibre1"/> a new virtual machine, we need to click on the <span class="strong"><strong class="calibre2">New</strong></span> button in main toolbar of the management interface and the <span class="strong"><strong class="calibre2">Create Virtual Machine</strong></span> wizard will start. In the window that opens, we need to set the name of the new virtual machine and select the template based on the version of the operating system. Once a template is selected, choose the default answers for the following questions (such as the location of the virtual machine files and its characteristics). After the wizard is done, we should set the installation image of the operating system. Click on the <span class="strong"><strong class="calibre2">Start</strong></span> button on the main toolbar to start our new virtual machine.</p><p class="calibre9">You can get an image of the operating system on the Microsoft Corporation site. For example, for our laboratory, we used Microsoft Windows Server 2008 R2 Evaluation as a Windows server operating system. You can download this on <a class="calibre1" href="https://www.microsoft.com/en-US/download/details.aspx?id=11093">https://www.microsoft.com/en-US/download/details.aspx?id=11093</a>. Of course, you can use your own (purchased earlier) operating system installation images.</p><p class="calibre9">After starting the virtual machine, a new window will open where you can see the screen of our virtual machine and menu options to manage the virtual machine. Here, we can interact with the virtual machine like a normal application using the keyboard and mouse.</p><p class="calibre9">As a regular computer, the virtual machine on startup will attempt to find a bootable media and try to boot from it. If we set the image of the installation image of the operating system, then the process of the new operating system installation will start.</p><p class="calibre9">The process of installing an operating system is simple, and we will not describe it here. Now, we need to install two types of OS: server and workstation. In our case, we install Microsoft Windows Server 2008 R2 and Microsoft Windows 7 Professional for the demo purposes, but we recommend you to install several various Windows versions: the latest ones and a couple of the old ones (not to learn the basics of network attacks, but to stay up-to-date).</p><p class="calibre9">After installation of the OS, we should configure basic settings like language and regional settings, time, and time zone. In case of virtual machines, the basic settings also include the installation of an additional package: <span class="strong"><strong class="calibre2">VirtualBox Guest Additions</strong></span>.</p><p class="calibre9">VirtualBox Guest Additions (<a class="calibre1" href="https://www.virtualbox.org/manual/ch04.html">https://www.virtualbox.org/manual/ch04.html</a>) is a set of software installed in the guest operating system and expands its ability to interact with the system and the virtualization host system. For example, after you install the special driver <span class="strong"><em class="calibre10">virtual video</em></span>, it is possible to change the desktop resolution of the guest OS in an arbitrary manner after the window size VirtualBox, which is running the virtual machine.</p><p class="calibre9">When our first Windows server and Windows workstation are installed, we should shut down the virtual machines and save them (take snapshots). We will continue to use them as templates for quick deployment of new instances.</p></div></div>

<div class="book" title="Creating virtual servers and workstations">
<div class="book" title="Configuring network settings of lab components"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch04lvl2sec34" class="calibre1"/>Configuring network settings of lab components</h2></div></div></div><p class="calibre9">The last<a id="id194" class="calibre1"/> action that we need to do with our virtual machines is configuring network adapters for the virtual machines. We have two main approaches that depend on implementation of our network infrastructure (based on hardware network devices and based on virtual network infrastructure).</p><p class="calibre9">In case of network infrastructure based on hardware devices, we need to set the network adapter in bridged mode and our virtual machine will interact with the outer world via a hardware Ethernet port of the host computer. For this, we go to the <span class="strong"><strong class="calibre2">Network</strong></span> tab of the virtual machine settings. The virtual machine should be in <span class="strong"><strong class="calibre2">Shutdown</strong></span> state at this moment. Select the <span class="strong"><strong class="calibre2">Bridged Adapter</strong></span> item in the <span class="strong"><strong class="calibre2">Attached to</strong></span> combo box. From the <span class="strong"><strong class="calibre2">Name</strong></span> combo box, select your network adapter. It is connected to the core switch. In our case, it looks like the following screenshot:</p><div class="mediaobject"><img src="../images/00024.jpeg" alt="Configuring network settings of lab components" class="calibre11"/><div class="caption"><p class="calibre15">The network interface settings of a virtual machine</p></div></div><p class="calibre12"> </p><p class="calibre9">In case of virtual <a id="id195" class="calibre1"/>network infrastructure based on GNS3, we need to perform the following steps for each virtual machine:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Start GNS3 and go to the <span class="strong"><strong class="calibre2">VirtualBox VMs </strong></span>settings tab. We had briefly described it in <a class="calibre1" title="Chapter 3. Configuring Networking Lab Components" href="part0024_split_000.html#MSDG1-3ecab517ca6e4afbb3c20ab15f7b4d82">Chapter 3</a>, <span class="strong"><em class="calibre10">Configuring Networking Lab Components</em></span>, so you should remember. Anyway, this can be achieved by navigating to <span class="strong"><strong class="calibre2">Edit</strong></span> | <span class="strong"><strong class="calibre2">Preferences</strong></span>. In the window that opens, select <span class="strong"><strong class="calibre2">VirtualBox VMs</strong></span>.</li><li class="listitem" value="2">In the <span class="strong"><strong class="calibre2">VirtualBox VM Templates</strong></span> section, we have a list of virtual machines (if you access this tab the first time, it should be clean) and three management buttons: <span class="strong"><strong class="calibre2">New</strong></span>, <span class="strong"><strong class="calibre2">Edit</strong></span>, and <span class="strong"><strong class="calibre2">Delete</strong></span>.</li><li class="listitem" value="3">By pressing the <span class="strong"><strong class="calibre2">New</strong></span> button, it will start a wizard to add a new virtual machine. In first window, it asks about which existing virtual machine we would like to connect to our virtual network infrastructure.</li><li class="listitem" value="4">After a virtual machine is selected, GNS3 will automatically create new <span class="strong"><em class="calibre10">linked</em></span> clone of the virtual machine with special network parameters, for example, we have following network settings in our case:<div class="mediaobject"><img src="../images/00025.jpeg" alt="Configuring network settings of lab components" class="calibre11"/><div class="caption"><p class="calibre15">Network interface settings of the virtual machine</p></div></div><p class="calibre26"> </p></li></ol><div class="calibre14"/></div></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Installing and configuring domain services"><div class="book" id="TI1E2-3ecab517ca6e4afbb3c20ab15f7b4d82"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch04lvl1sec24" class="calibre1"/>Installing and configuring domain services</h1></div></div></div><p class="calibre9">As<a id="id196" class="calibre1"/> the<a id="id197" class="calibre1"/> next step, let's install and <a id="id198" class="calibre1"/>configure <a id="id199" class="calibre1"/>the core of any Windows-based corporate network: the domain and its services.</p></div>

<div class="book" title="Installing and configuring domain services">
<div class="book" title="Creating a domain"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch04lvl2sec35" class="calibre1"/>Creating a domain</h2></div></div></div><p class="calibre9">In the next step, we <a id="id200" class="calibre1"/>create a domain and its services based on Microsoft Active Directory. It will provide the central services for managing application levels of our infrastructure (managing users and computers, name service, and so on).</p><p class="calibre9">First, we create a new virtual machine by cloning our Windows server template in VirtualBox. For this, we just need to select <span class="strong"><strong class="calibre2">Clone…</strong></span> from the context menu of the virtual machine list of the VirtualBox management interface. In the wizard, we should check the option <span class="strong"><strong class="calibre2">Reinitialize the MAC address of all network cards</strong></span> in the first window and select the <span class="strong"><strong class="calibre2">Full clone</strong></span> option in the second window of the wizard.</p><p class="calibre9">After cloning, start the new virtual machine. So, the clean operating system is running and we have a basic configuration. For creating a domain, we need to configure the domain controller on this virtual server. For this, we should perform the following steps:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">In the <span class="strong"><strong class="calibre2">Initial Configuration Tasks</strong></span> page, we need to set the computer name. We choose the name <span class="strong"><strong class="calibre2">DC</strong></span>. It is short and clear.</li><li class="listitem" value="2">Next, we should set the IP configuration of the server network adapter. We need to use a static IP address, because this server would be the domain controller as well as the DNS server. We should choose the IP address from the previously defined address space. Now, our configuration for the IP of the domain controller is as follows:<div class="informalexample"><table border="1" class="calibre16"><colgroup class="calibre17"><col class="calibre18"/><col class="calibre18"/></colgroup><thead class="calibre19"><tr class="calibre20"><th valign="bottom" class="calibre21">
<p class="calibre22">Parameter</p>
</th><th valign="bottom" class="calibre21">
<p class="calibre22">Value</p>
</th></tr></thead><tbody class="calibre23"><tr class="calibre20"><td valign="top" class="calibre24">
<p class="calibre22">IP address</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">10.0.0.2</p>
</td></tr><tr class="calibre20"><td valign="top" class="calibre24">
<p class="calibre22">Net mask</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">255.255.255.0</p>
</td></tr><tr class="calibre20"><td valign="top" class="calibre24">
<p class="calibre22">Gateway</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">10.0.0.1</p>
</td></tr><tr class="calibre20"><td valign="top" class="calibre24">
<p class="calibre22">DNS</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">10.0.0.2</p>
</td></tr></tbody></table></div></li><li class="listitem" value="3">Next, we should define the <span class="strong"><strong class="calibre2">Active Directory Domain Controller</strong></span> role for our server. So, go to <span class="strong"><strong class="calibre2">Server Manager</strong></span> and select <span class="strong"><strong class="calibre2">Roles</strong></span> from the left-hand side panel. And next, click on the link <span class="strong"><strong class="calibre2">Add Roles</strong></span> in the right-hand side panel. In the opened window <span class="strong"><strong class="calibre2">Before You Begin</strong></span>, we should click on the <span class="strong"><strong class="calibre2">Next</strong></span> button. In the next window, check the <span class="strong"><strong class="calibre2">Active Directory Domain Services</strong></span> item.<p class="calibre27">In this page, you can also check additional roles to add to our server and install additional features, or you can do this later because now we do not need it.</p><p class="calibre27">It should be noted that Active Directory requires the DNS server, but now we do not add this role. Later in the domain installation process, this role will be added automatically.</p></li><li class="listitem" value="4">The <a id="id201" class="calibre1"/>second main step of creating the domain controller is executing the <code class="literal">dcpromo</code> utility. Now, go to the <span class="strong"><strong class="calibre2">Start</strong></span> menu and type <code class="literal">dcpromo</code> in the <span class="strong"><strong class="calibre2">Run</strong></span> textbox. You will find it in the list. Click on <span class="strong"><strong class="calibre2">dcpromo</strong></span>.</li><li class="listitem" value="5">As a result, we run the wizard <span class="strong"><strong class="calibre2">Welcome to the Active Directory Domain Service Installation Wizard</strong></span>. We do not need advanced options in this scenario, so just click on the <span class="strong"><strong class="calibre2">Next</strong></span> button.</li><li class="listitem" value="6">In the <span class="strong"><strong class="calibre2">Operating System Compatibility</strong></span> page, the wizard warned us that our NT and non-Microsoft SMB customers will experience problems with some of the cryptographic algorithm used in Windows Server 2008 R2. We have no such problems in our test environment, so just click on the <span class="strong"><strong class="calibre2">Next</strong></span> button.</li><li class="listitem" value="7">In the <span class="strong"><strong class="calibre2">Choose a Deployment Configuration</strong></span> page, we should select <span class="strong"><strong class="calibre2">Create a new domain in a new forest</strong></span>. We do this for the simple reason that it is a new domain in a new forest.</li><li class="listitem" value="8">In the <span class="strong"><strong class="calibre2">Name the Forest Root Domain</strong></span> page, we should enter the domain name in the <span class="strong"><strong class="calibre2">FQDN of the root domain in the forest</strong></span> textbox. In our case, we call the <code class="literal">lab.local</code> domain. You can name your domain as you like; but if you use a name that is already in use on the Internet (a name that has already been registered), then you may have a problem with names. Click on the <span class="strong"><strong class="calibre2">Next</strong></span> button.</li><li class="listitem" value="9">In the <span class="strong"><strong class="calibre2">Set Forest Functional Level</strong></span> page, select the <span class="strong"><strong class="calibre2">Windows Server 2008 R2</strong></span> option. Click on <span class="strong"><strong class="calibre2">Next</strong></span>.</li><li class="listitem" value="10">In the <span class="strong"><strong class="calibre2">Additional Domain Controller Options</strong></span> page, we have only one choice: DNS server. The Global catalog option is selected and is not an option for selection; as long as it is the only DC in the domain, so it must be a global catalog server. The option domain controller read-only permission is not checked, since it is necessary to have other non-RODCs on the network to enable this option. Let's select the DNS server option and click on the <span class="strong"><strong class="calibre2">Next</strong></span> button.</li><li class="listitem" value="11">A dialog <a id="id202" class="calibre1"/>box appears saying that it is impossible to create a delegation for this DNS server, because the authoritative parent zone can not be found or does not use the Windows DNS server. The reason is that this is the first DC network. So, we just click on the <span class="strong"><strong class="calibre2">Yes</strong></span> button to continue.</li><li class="listitem" value="12">In the next page, let's leave paths to the database, log files, and SYSVOL by default, and click on the <span class="strong"><strong class="calibre2">Next</strong></span> button.</li><li class="listitem" value="13">In the <span class="strong"><strong class="calibre2">Directory Service Restore Mode Administrator Password</strong></span> page, let's enter a strong password in the <span class="strong"><strong class="calibre2">Password</strong></span> and <span class="strong"><strong class="calibre2">Confirm password</strong></span> text fields.</li><li class="listitem" value="14">Now, let's check the information on the page <span class="strong"><strong class="calibre2">Summary</strong></span> and click on the <span class="strong"><strong class="calibre2">Next</strong></span> button for installing Active Directory. The installation process takes several minutes. After installing, we should reboot our server.</li></ol><div class="calibre14"/></div><p class="calibre9">Finally, the installation is complete after you log in. It should be noted that the DNS service was installed during the installation of Active Directory, so we do not need to worry about it. Now, we have ready the domain controller and the <code class="literal">lab.local</code> domain.</p></div></div>

<div class="book" title="Installing and configuring domain services">
<div class="book" title="Creating users"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch04lvl2sec36" class="calibre1"/>Creating users</h2></div></div></div><p class="calibre9">Now, let's <a id="id203" class="calibre1"/>create user accounts in our domain. In Active Directory, it's a very simple process. The method of user creating based on the use of the snap-in <span class="strong"><strong class="calibre2">Active Directory Users and Computers</strong></span> is the most convenient, because it uses a graphical user interface and wizard. The disadvantage of this method is that when you create a user account, you cannot set most of the account attributes when you create a user account, and you have to add them by additionally editing the created account. In order to create a user account, follow these steps:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Open the snap-in <span class="strong"><strong class="calibre2">Active Directory - Users and Computers</strong></span>. You can do this by navigating to <span class="strong"><strong class="calibre2">Start</strong></span> | <span class="strong"><strong class="calibre2">Administrative Tools</strong></span> | <span class="strong"><strong class="calibre2">Active Directory - Users and Computers</strong></span>. You can also use the key combination <span class="strong"><em class="calibre10">Win</em></span> + <span class="strong"><em class="calibre10">R</em></span> to open the dialog <span class="strong"><strong class="calibre2">Run</strong></span> and enter the <code class="literal">dsa.msc</code> command to execute.</li><li class="listitem" value="2">In the tree, expand your domain and go to the folder <span class="strong"><strong class="calibre2">Users</strong></span>. Right-click on it and from the context menu, go to <span class="strong"><strong class="calibre2">New</strong></span> | <span class="strong"><strong class="calibre2">User</strong></span>. It will start a wizard.</li><li class="listitem" value="3">In the dialog box <span class="strong"><strong class="calibre2">New Object - User</strong></span>, enter the information about creating the user (first name, last name, and logon name). Click on the <span class="strong"><strong class="calibre2">Next</strong></span> button.</li><li class="listitem" value="4">In the <a id="id204" class="calibre1"/>next page of the wizard, you have to enter the initial password in the <span class="strong"><strong class="calibre2">Password</strong></span> field and re-enter it in the <span class="strong"><strong class="calibre2">Confirm</strong></span> textbox. In addition, you can also set the basic parameters of the password policy.</li><li class="listitem" value="5">In the last page of the wizard, you will see a summary of the parameters you entered. If information is entered correctly, click on the <span class="strong"><strong class="calibre2">Finish</strong></span> button to create a user account and complete the wizard.</li><li class="listitem" value="6">After the user account is created, you can find it in the user account list in the right-hand side panel. By clicking on the <span class="strong"><strong class="calibre2">Preferences</strong></span> item in the context menu of the user account, you can configure all the attributes of the user account.</li></ol><div class="calibre14"/></div><p class="calibre9">So, now you can create several user accounts.</p></div></div>

<div class="book" title="Installing and configuring domain services">
<div class="book" title="Adding hosts to the domain"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch04lvl2sec37" class="calibre1"/>Adding hosts to the domain</h2></div></div></div><p class="calibre9">Now, we <a id="id205" class="calibre1"/>have to create several workstations including the admin one. For this purpose, let's create new virtual machines by cloning our Windows workstation template in VirtualBox. For this, as in case of the Windows server template, we just need to select the <span class="strong"><strong class="calibre2">Clone…</strong></span> item from the context menu of the virtual machine list of the VirtualBox management interface. In the wizard, we should check the <span class="strong"><strong class="calibre2">Reinitialize the MAC address of all network cards</strong></span> option in the first window and select the <span class="strong"><strong class="calibre2">Full clone</strong></span> option in the second window.</p><p class="calibre9">After cloning and starting our new virtual machine, let's join it to the domain. It would give us the possibility to use all advantages of a domain, such as centralized management, group policies, and much more.</p><p class="calibre9">Before joining the computer to the domain, let's make sure that the following prerequisites are met:</p><div class="book"><ul class="itemizedlist"><li class="listitem">The network adapter of our virtual workstation is working and has the right IP address. The operating system settings for the network adapter of our workstation is set to DHCP.</li><li class="listitem">Virtual workstations have "network visibility" to the domain controller. We can check this by a ping utility based on ICMP requests.<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">ping 10.0.0.2</strong></span>
</pre></div></li><li class="listitem">On a <a id="id206" class="calibre1"/>virtual workstation, you are logged on as the local administrator.</li></ul></div><p class="calibre9">Next, let's perform the following steps:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Open <span class="strong"><strong class="calibre2">System Properties</strong></span> by clicking on <span class="strong"><strong class="calibre2">Start</strong></span>, then right-click on <span class="strong"><strong class="calibre2">Computer</strong></span> and click on the <span class="strong"><strong class="calibre2">Properties</strong></span> item from the context menu.</li><li class="listitem" value="2">In the <span class="strong"><strong class="calibre2">Computer name, domain, and workgroup settings</strong></span> section, click on the <span class="strong"><strong class="calibre2">Change settings</strong></span> link.</li><li class="listitem" value="3">In the <span class="strong"><strong class="calibre2">Computer Name</strong></span> tab, click on the <span class="strong"><strong class="calibre2">Change</strong></span> button.</li><li class="listitem" value="4">In the <span class="strong"><strong class="calibre2">Computer name</strong></span> textbox, enter the hostname of our workstation.</li><li class="listitem" value="5">In the <span class="strong"><strong class="calibre2">Member of</strong></span> section, check the <span class="strong"><strong class="calibre2">Domain</strong></span> radio button and enter the name of the domain to which you want to connect. In our case, it's <code class="literal">lab.local</code>.<div class="mediaobject"><img src="../images/00026.jpeg" alt="Adding hosts to the domain" class="calibre11"/><div class="caption"><p class="calibre15">Join workstation to domain</p></div></div><p class="calibre26"> </p></li><li class="listitem" value="6">After clicking <a id="id207" class="calibre1"/>on the <span class="strong"><strong class="calibre2">OK</strong></span> button, you will be prompted to enter your domain administrator name and password.</li><li class="listitem" value="7">After successfully joining the computer to the domain, you will be prompted to reboot. To finish you should do so.</li></ol><div class="calibre14"/></div><p class="calibre9">Install the admin workstation in the same way, but do not forget that the VM's network interface should be in a bridge mode with the static IP address 10.0.1.30 and it should be connected to the appropriate switch port. Do not forget to create an administrative user account on the domain controller and log it in on the admin's workstation.</p></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Certification authority services" id="UGI01-3ecab517ca6e4afbb3c20ab15f7b4d82"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch04lvl1sec25" class="calibre1"/>Certification authority services</h1></div></div></div><p class="calibre9">In any modern <a id="id208" class="calibre1"/>organization, there is an important security subsystem called <a id="id209" class="calibre1"/><span class="strong"><strong class="calibre2">cryptography</strong></span>. This subsystem <a id="id210" class="calibre1"/>provides important properties of information security such as confidentiality, integrity, and authenticity. All three of these are needed in secure transport, management, and access. Cryptography and security mechanisms built on it are a vast topic and out of the scope of our book. But we are going to briefly demonstrate how to create a certificate system based on OpenSSL.</p><p class="calibre9">OpenSSL is a<a id="id211" class="calibre1"/> free software utility. You can download a binary copy to run on your Windows<a id="id212" class="calibre1"/> installation from <a class="calibre1" href="https://www.openssl.org/community/binaries.html">https://www.openssl.org/community/binaries.html</a>. OpenSSL is all you need to create your own private certificate authority.</p><p class="calibre9">So, download this software and extract in a folder on one of your servers. In our case, we use <code class="literal">C:\OpenSSL\</code> directory on our domain controller (<code class="literal">dc.lab.local</code>).</p><p class="calibre9">The process for creating our own certificate authority is pretty straightforward:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Create a private key.</li><li class="listitem" value="2">Self sign.</li><li class="listitem" value="3">Install a root CA on workstations.</li></ol><div class="calibre14"/></div><p class="calibre9">Once we do that, every service that we used can be protected by a certificate created with the following steps:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Create a certificate.</li><li class="listitem" value="2">Sign the certificate with a root CA key.</li></ol><div class="calibre14"/></div></div>

<div class="book" title="Certification authority services" id="UGI01-3ecab517ca6e4afbb3c20ab15f7b4d82">
<div class="book" title="Creating a root certificate"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch04lvl2sec38" class="calibre1"/>Creating a root certificate</h2></div></div></div><p class="calibre9">First, we need to<a id="id213" class="calibre1"/> generate a root key which will be used further in a root certificate. It can be done with the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openssl genrsa -out rootCA.key 2048</strong></span>
</pre></div><p class="calibre9">Here:</p><div class="book"><ul class="itemizedlist"><li class="listitem"><code class="literal">2048</code>: This is our key length in bits</li><li class="listitem"><code class="literal">rootCA.key</code>: This is a filename of our root key</li></ul></div><p class="calibre9">After that, we execute a second command for creating a self-signed root certificate:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openssl req -x509 -new -key rootCA.key -days 1200 -out rootCA.crt</strong></span>
</pre></div><p class="calibre9">Here:</p><div class="book"><ul class="itemizedlist"><li class="listitem"><code class="literal">rootCA.key</code>: This is our secret key of CA</li><li class="listitem"><code class="literal">1200</code>: This is the validity period of our certificate in days (1,200 days approximately equals 3 years)</li></ul></div><p class="calibre9">Here, we are asked a few questions; you can answer them as you like:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">Country Name (2 letter code) [US]: RU</strong></span>
<span class="strong"><strong class="calibre2">State or Province Name (full name) [Some-State]:</strong></span>
<span class="strong"><strong class="calibre2">Locality Name (eg, city) []:Moscow</strong></span>
<span class="strong"><strong class="calibre2">Organization Name (eg, company) [Internet Widgits Pty Ltd]: Test Lab</strong></span>
<span class="strong"><strong class="calibre2">Organizational Unit Name (eg, section) []: Lab</strong></span>
<span class="strong"><strong class="calibre2">Common Name (e.g. server FQDN or YOUR name) []: lab.local</strong></span>
<span class="strong"><strong class="calibre2">Email Address []: support@lab.local</strong></span>
</pre></div><p class="calibre9">After these manipulations, we have two files:</p><div class="book"><ul class="itemizedlist"><li class="listitem"><code class="literal">rootCA.crt</code>: A public key for installation on servers or workstations and also for public distribution</li><li class="listitem"><code class="literal">rootCA.key</code>: A private key, which should be in secret</li></ul></div><p class="calibre9">Now, we can create certificates <a id="id214" class="calibre1"/>for our services and install a root certificate to our workstations.</p></div></div>

<div class="book" title="Certification authority services" id="UGI01-3ecab517ca6e4afbb3c20ab15f7b4d82">
<div class="book" title="Creating a working certificate"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch04lvl2sec39" class="calibre1"/>Creating a working certificate</h2></div></div></div><p class="calibre9">So, let's create a <a id="id215" class="calibre1"/>certificate (for example, for some web service) signed by our CA. This process is pretty simple:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Generate a key:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openssl genrsa -out web.lab.local.key 2048</strong></span>
</pre></div></li><li class="listitem" value="2">Create the certificate signing request:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openssl req -new -key web.lab.local.key -out web.lab.local.csr</strong></span>
</pre></div><p class="calibre27">Here, it is important to specify the name of the server: domain or IP (in our case, <code class="literal">web.lab.local</code>):</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">Common Name (eg, YOUR name) []: web.lab.local</strong></span>
</pre></div></li><li class="listitem" value="3">We should sign a certificate request by our root certificate:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">openssl x509 -req -in web.lab.local.csr -CA rootCA.crt -CAkey rootCA.key -CAcreateserial -out web.lab.local.crt -days 365</strong></span>
</pre></div></li></ol><div class="calibre14"/></div></div></div>

<div class="book" title="Certification authority services" id="UGI01-3ecab517ca6e4afbb3c20ab15f7b4d82">
<div class="book" title="Installing a root certificate"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch04lvl2sec40" class="calibre1"/>Installing a root certificate</h2></div></div></div><p class="calibre9">Now, we can <a id="id216" class="calibre1"/>install a root certificate into our servers and workstations. For this, we will need to install the root certificate into trusted host certificate repositories. Some browsers use the default operating system repository. For instance, in Windows, both Internet Explorer and Chrome use the default certificate management. They both take you to the same place, the Windows certificate repository. So, we can open Internet Explorer and go to <span class="strong"><strong class="calibre2">Internet Options</strong></span> | <span class="strong"><strong class="calibre2">Content</strong></span> | <span class="strong"><strong class="calibre2">Certificates</strong></span>. Now, we can install the root CA certificate under the <span class="strong"><strong class="calibre2">Trusted Root Certificate Authorities</strong></span> tab. However, Windows Firefox has its own certificate repository, so if you use IE or Chrome as well as Firefox, you will have to install the root certificate into both the Windows repository and the Firefox repository.</p><div class="informalexample" title="Note"><h3 class="title2"><a id="note14" class="calibre1"/>Note</h3><p class="calibre9">A good manual about building CAs based on OpenSSL is located at <a class="calibre1" href="https://jamielinux.com/docs/openssl-certificate-authority/index.html">https://jamielinux.com/docs/openssl-certificate-authority/index.html</a>.</p></div></div></div>
<div class="book" title="Installing a remote management service" id="VF2I1-3ecab517ca6e4afbb3c20ab15f7b4d82"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch04lvl1sec26" class="calibre1"/>Installing a remote management service</h1></div></div></div><p class="calibre9">Now that <a id="id217" class="calibre1"/>we have prepared servers and the ability to create security certificates, let's look at the possibility of installing a<a id="id218" class="calibre1"/> secure remote management service for our servers. The best solution for this purpose is SSH.</p><p class="calibre9">
<span class="strong"><strong class="calibre2">SSH</strong></span> (short for <span class="strong"><strong class="calibre2">Secure Shell</strong></span>) is a<a id="id219" class="calibre1"/> network application layer protocol that allows remotely managing operating systems and the tunneling of TCP connections (for example, to transfer files). It has similar functionality as telnet or rlogin, but unlike them, it encrypts all traffic, including transmitted passwords. SSH clients and SSH servers are available for most network operating systems.</p><p class="calibre9">While SSH is built-in in all Linux server distributions, Windows does not have it by default and we would like to install it in order to make our lab more complicated, which is always good for attack practicing.</p><p class="calibre9">There are several solutions in the software market, but in our laboratory we are using freeSSHd. Like its name says, freeSSHd is a free, simple implementation of an SSH server that provides full functionality of SSH protocol.</p><p class="calibre9">The installation packet can be found on the website <a class="calibre1" href="http://www.freesshd.com/?ctt=download">http://www.freesshd.com/?ctt=download</a>. After downloading and installing freeSSHd, we can start freeSSHd as a normal application or as a Windows service. In the management application, we can set up the main parameters:</p><div class="book"><ul class="itemizedlist"><li class="listitem">Start or stop SSH server</li><li class="listitem">Select encryption cipher</li><li class="listitem">Traffic tunneling parameters</li><li class="listitem">Manage host restrictions</li><li class="listitem">Setup interface and port number which will be used</li><li class="listitem">Setup command shell that will be used</li><li class="listitem">Select encryption key that will be used (this is the most important one)</li></ul></div><p class="calibre9">All parameters are intuitive, so we will not be consider them in detail. But we will consider user management as the most important part of it at the moment.</p><p class="calibre9">In the <span class="strong"><strong class="calibre2">Users</strong></span> tab <a id="id220" class="calibre1"/>we have three buttons: <span class="strong"><strong class="calibre2">New</strong></span>, <span class="strong"><strong class="calibre2">Edit</strong></span>, and <span class="strong"><strong class="calibre2">Remove</strong></span>. Click on <span class="strong"><strong class="calibre2">New</strong></span> and the <span class="strong"><strong class="calibre2">User properties</strong></span> window appears. Here, we should choose the authorization method. We have three options:</p><div class="book"><ul class="itemizedlist"><li class="listitem"><span class="strong"><strong class="calibre2">NT authentications</strong></span> (Use functionality of the operating system)</li><li class="listitem"><span class="strong"><strong class="calibre2">Password stored as SHA1 hash</strong></span> (Use built-in functionality of freeSSHd)</li><li class="listitem"><span class="strong"><strong class="calibre2">Public key (SSH only)</strong></span></li></ul></div><p class="calibre9">Since we have a domain and we can use domain user authentication procedures, let's select <span class="strong"><strong class="calibre2">NT authentication</strong></span>. We need to specify the domain name in the <span class="strong"><strong class="calibre2">Domain</strong></span> textbox; in our case, it is <code class="literal">lab.local</code>. In the <span class="strong"><strong class="calibre2">Login</strong></span> textbox, we should enter the username of the existing domain user. After all of this, let's set up rights which will be granted to this user by checking the appropriate fields in the <span class="strong"><strong class="calibre2">User can use </strong></span>section (shell, file transfers, and traffic tunneling).</p><p class="calibre9">After the user account is created and the service is started, we can try to connect to our management service on a remote server.</p><div class="informalexample" title="Note"><h3 class="title2"><a id="note15" class="calibre1"/>Note</h3><p class="calibre9">Windows servers are usually managed using native Windows solutions like Remote Desktop, but in our case we want to have a complicated and vulnerable instance. Thus, we add excessive functions and software.</p></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Corporative e-mail service" id="10DJ41-3ecab517ca6e4afbb3c20ab15f7b4d82"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch04lvl1sec27" class="calibre1"/>Corporative e-mail service</h1></div></div></div><p class="calibre9">In <a id="id221" class="calibre1"/>our lab, we <a id="id222" class="calibre1"/>simulate a small organization and the base of IT services of any organization information infrastructure is the ability to exchange information between users. Usually, the interaction between users is organized on the basis of e-mail, which has become the de facto standard. So, we cannot miss the e-mail service. As a solution to organize e-mail, we will consider free software hMailServer.</p><p class="calibre9">hMailServer is a free e-mail server for the Windows platform. It runs as a Windows service and includes administration and backup tools. It supports mail protocols IMAP, POP3, and SMTP. To store the settings and indexes hMailServer uses a database such as MySQL, MS SQL, or PostgreSQL, e-mail messages are stored on the hard drive in the MIME format.</p><p class="calibre9">hMailServer supports all the basic functions, such as multi-domain, aliases, and mailing lists. User authentication can be performed using the local user database or through Active Directory.</p><p class="calibre9">Well, let's start to install hMailServer, but before we start we need to configure our DNS server.</p></div>

<div class="book" title="Corporative e-mail service" id="10DJ41-3ecab517ca6e4afbb3c20ab15f7b4d82">
<div class="book" title="Configuring a DNS server"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch04lvl2sec41" class="calibre1"/>Configuring a DNS server</h2></div></div></div><p class="calibre9">To be able to<a id="id223" class="calibre1"/> receive e-mails, we must set up MX records for our domain. The MX records are entries in the DNS server that tells other computers on the net which computer (hostname) is hosting the e-mail service for our domain.</p><p class="calibre9">We can do this in<a id="id224" class="calibre1"/> the DNS management snap-in of our domain controller, which serves as our additional DNS server. So, let's interact with the domain controller and start the <span class="strong"><strong class="calibre2">DNS</strong></span> snap-in by selecting the <span class="strong"><strong class="calibre2">DNS</strong></span> item in the <span class="strong"><strong class="calibre2">Administrative Tools</strong></span> folder of the <span class="strong"><strong class="calibre2">Start</strong></span> menu.</p><p class="calibre9">In the DNS tree on the left-hand side panel of the opened snap-in, expand the <span class="strong"><strong class="calibre2">Forward Lookup Zones</strong></span> item corresponding to our domain controller (DC). Now, select the item that's our domain (<code class="literal">lab.local</code>). In the right-hand side panel, we can see a list of DNS records that exist at this moment. Now, we should check for the existing DNS A-record of the server on which we will install hMailServer. If such a record does not exist, let's add it. Right-click to open the context menu and select <span class="strong"><strong class="calibre2">New Host (A or AAAA)…</strong></span> for creating a DNS A-record. In the opened window, we have to enter the name of our mail server and its IP address that will be pointed by the name. Then, click on the <span class="strong"><strong class="calibre2">Add Host</strong></span> button.</p><p class="calibre9">In our case, we deploy the mail server on the domain controller host, so our option looks like this:</p><div class="informalexample"><table border="1" class="calibre16"><colgroup class="calibre17"><col class="calibre18"/><col class="calibre18"/><col class="calibre18"/></colgroup><thead class="calibre19"><tr class="calibre20"><th valign="bottom" class="calibre21">
<p class="calibre22">Name</p>
</th><th valign="bottom" class="calibre21">
<p class="calibre22">FQDN</p>
</th><th valign="bottom" class="calibre21">
<p class="calibre22">IP address</p>
</th></tr></thead><tbody class="calibre23"><tr class="calibre20"><td valign="top" class="calibre24">
<p class="calibre22">
<code class="literal1">mail</code>
</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">
<code class="literal1">mail.lab.local</code>
</p>
</td><td valign="top" class="calibre24">
<p class="calibre22">10.0.0.2</p>
</td></tr></tbody></table></div><p class="calibre9">After creating the DNS A-record of the mail server or if A-record already exists, we should add MX-record. We can to do this like we added A-record, but select the <span class="strong"><strong class="calibre2">New Mail Exchanger (MX)…</strong></span> item instead of <span class="strong"><strong class="calibre2">New Host (A or AAAA)…</strong></span>. In the window that opens, we should leave the <span class="strong"><strong class="calibre2">Host or child domain</strong></span> textbox blank and enter the name of our mail server (in our case <code class="literal">mail.lab.local</code>) in the <span class="strong"><strong class="calibre2">FQDN of mail server</strong></span> textbox.</p><p class="calibre9">The<a id="id225" class="calibre1"/> result <a id="id226" class="calibre1"/>will be something like this:</p><div class="mediaobject"><img src="../images/00027.jpeg" alt="Configuring a DNS server" class="calibre11"/><div class="caption"><p class="calibre15">DNS zone contents</p></div></div><p class="calibre12"> </p></div></div>

<div class="book" title="Corporative e-mail service" id="10DJ41-3ecab517ca6e4afbb3c20ab15f7b4d82">
<div class="book" title="Installing and configuring hMailServer"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch04lvl2sec42" class="calibre1"/>Installing and configuring hMailServer</h2></div></div></div><p class="calibre9">So it is time<a id="id227" class="calibre1"/> to install hMailServer. The latest version can be downloaded from the website (<a class="calibre1" href="https://www.hmailserver.com/download">https://www.hmailserver.com/download</a>). The installation process is simple. Run <a id="id228" class="calibre1"/>through the installation wizard and it should not cause problems. At the end of the installation, the existing wizard will prompt for an administrator password.</p><p class="calibre9">Start <a id="id229" class="calibre1"/>hMailServer Administrator (management console) and create a new connection to localhost. After hMailServer <a id="id230" class="calibre1"/>Administrator is launched and the connection to a server is established, configure our mail server<a id="id231" class="calibre1"/> for our domain (<code class="literal">lab.local</code>). It takes a bit of time and consists of the following basic steps:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">In the <span class="strong"><strong class="calibre2">Domains</strong></span> tab, click on the <span class="strong"><strong class="calibre2">Add</strong></span> button. In the page that opens, enter the name of our domain (<code class="literal">lab.local</code>) in the <span class="strong"><strong class="calibre2">Domain</strong></span> textbox and click on the <span class="strong"><strong class="calibre2">Save</strong></span> button. A new domain will be added.</li><li class="listitem" value="2">Let's click on the <span class="strong"><strong class="calibre2">Accounts</strong></span> subitem of the domain tree and click on the <span class="strong"><strong class="calibre2">Add</strong></span> button on the right-hand side panel (account's page).</li><li class="listitem" value="3">In the page that opens, go to the <span class="strong"><strong class="calibre2">Active Directory</strong></span> tab, we should check the <span class="strong"><strong class="calibre2">Active Directory account</strong></span> option and enter the domain and user name of the existing domain user for whom we create the mail account. In the <span class="strong"><strong class="calibre2">General</strong></span> tab, we should enter the address of the mailbox for the current account in the <span class="strong"><strong class="calibre2">Address</strong></span> textbox.</li><li class="listitem" value="4">Click on the <span class="strong"><strong class="calibre2">Save</strong></span> button.</li><li class="listitem" value="5">Now on the list of accounts, we have ready sample user mail boxes:<div class="mediaobject"><img src="../images/00028.jpeg" alt="Installing and configuring hMailServer" class="calibre11"/><div class="caption"><p class="calibre15">Mail accounts list</p></div></div><p class="calibre26"> </p></li><li class="listitem" value="6">Go to <span class="strong"><strong class="calibre2">Settings</strong></span> | <span class="strong"><strong class="calibre2">Protocols</strong></span> | <span class="strong"><strong class="calibre2">SMTP</strong></span> | <span class="strong"><strong class="calibre2">Delivery of email</strong></span> and in the hostname setting, enter the hostname of our server (<code class="literal">mail.lab.local</code>).</li></ol><div class="calibre14"/></div><p class="calibre9">Now, we <a id="id232" class="calibre1"/>have a working mail server ready and we can use configured mail client software for sending and receiving mail messages.</p><p class="calibre9">Next, you <a id="id233" class="calibre1"/>should walk through the mail server <a id="id234" class="calibre1"/>settings for creating hardening configuration. You <a id="id235" class="calibre1"/>can do, for example, the following:</p><div class="book"><ul class="itemizedlist"><li class="listitem">Change standard ports of SMTP, POP3, and IMAP protocols and set connection security for using SSL/TLS based on the security certificate, which can be created on our certification authority (described earlier)</li><li class="listitem">Set to use only TLSv1.2</li><li class="listitem">Create a backup copy</li><li class="listitem">Configure a built-in anti-spam subsystem</li></ul></div><div class="informalexample" title="Note"><h3 class="title2"><a id="note16" class="calibre1"/>Note</h3><p class="calibre9">More information about<a id="id236" class="calibre1"/> hMailServer is available at <a class="calibre1" href="https://www.hmailserver.com/documentation/latest/?page=overview">https://www.hmailserver.com/documentation/latest/?page=overview</a>.</p></div><p class="calibre9">Now that we have created a working instance of a mail server, other possibilities can be explored.</p></div></div>
<div class="book" title="Installing vulnerable services" id="11C3M1-3ecab517ca6e4afbb3c20ab15f7b4d82"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch04lvl1sec28" class="calibre1"/>Installing vulnerable services</h1></div></div></div><p class="calibre9">The <a id="id237" class="calibre1"/>easiest <a id="id238" class="calibre1"/>way to prepare most of the servers and network services that you will need for your penetration testing trainings is to download preconfigured VM images intentionally left vulnerable (vulnerable virtual machines). Such vulnerable VMs are the best way to get instances prepared for practicing various attacks but save your time on downloading and installing everything on your own.</p><div class="informalexample" title="Note"><h3 class="title2"><a id="tip18" class="calibre1"/>Tip</h3><p class="calibre9">
<span class="strong"><strong class="calibre2">Staying safe with preinstalled VM images</strong></span>
</p><p class="calibre9">You probably know any sources of preinstalled VM images than those which we have mentioned in this chapter and you probably would like to use them for downloading and using certain images in your lab. But be careful and check whether the sources are trusted enough before using them to obtain an image, as there is a big risk that untrusted sources can distribute potentially dangerous images containing malware. Such images can pose high security risks not only for your lab, but also for the network your lab is connected to.</p></div><p class="calibre9">Let's include the most useful and well-known of them into our lab network.</p></div>

<div id="page" style="height:0pt"/><div class="book" title="Installing web applications"><div class="book" id="12AK82-3ecab517ca6e4afbb3c20ab15f7b4d82"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch04lvl1sec29" class="calibre1"/>Installing web applications</h1></div></div></div><p class="calibre9">Nowadays <a id="id239" class="calibre1"/>when a lot of businesses <a id="id240" class="calibre1"/>are going online or at least have to be present on the Web, penetration testers mostly deal with web applications rather than with infrastructure pentests. Therefore, it is essential for a penetration tester to acquire web application hacking skills and improve them constantly.</p><div class="informalexample" title="Note"><h3 class="title2"><a id="tip19" class="calibre1"/>Tip</h3><p class="calibre9">
<span class="strong"><strong class="calibre2">Working with limited computing resources</strong></span>
</p><p class="calibre9">If you experience a lack of computing power for creating other virtual servers, you can install all web applications on the same server. Alternatively, you can install some of them on the "attacker's machine" or the penetration testing machine that you are going to use for hacking.</p></div><p class="calibre9">We will use a <a id="id241" class="calibre1"/><span class="strong"><strong class="calibre2">LAMP</strong></span> (<span class="strong"><strong class="calibre2">Linux, Apache, and MySQL*PHP</strong></span>) server based on Ubuntu Server 14.03.4 LTS to install web applications. But if you prefer to use Windows for some reason, you can use XAMPP—an Apache distribution containing MySQL, PHP, and Perl.</p></div>

<div class="book" title="Installing web applications">
<div class="book" title="Preparing a web server"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch04lvl2sec43" class="calibre1"/>Preparing a web server</h2></div></div></div><p class="calibre9">We will <a id="id242" class="calibre1"/>install all our lab web applications on the same web server under Ubuntu Server 14.0.3.4 LTS in a NAT mode without connecting the VM to our lab network yet. Then, we will change the network interface mode and settings according to our lab network settings. The steps are as follows:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">As a first step, download the latest Ubuntu Server <code class="literal">.iso</code> installation image from the official website.</li><li class="listitem" value="2">Create a new 64-bit Ubuntu-based VirtualBox VM with 1024 MB RAM and a dynamically allocated hard drive.</li><li class="listitem" value="3">Insert the installation image into the VM's CD/DVD drive and start the VM.</li><li class="listitem" value="4">Install the Ubuntu Server by answering the installation dialog questions. The process is quite straightforward until you are asked which services to install (don't forget the account password that you provided during the installation).<div class="mediaobject"><img src="../images/00029.jpeg" alt="Preparing a web server" class="calibre11"/><div class="caption"><p class="calibre15">Services installation dialog</p></div></div><p class="calibre26"> </p></li><li class="listitem" value="5">Chose <a id="id243" class="calibre1"/>OpenSSH and LAMP servers and continue the installation.</li><li class="listitem" value="6">Enter a MySQL root password when asked and be sure you don't forget it—you will need it later.</li><li class="listitem" value="7">Reboot the VM and log in under the account created during the installation.<p class="calibre27">Now, we need to configure the correct networking settings in order to be able to access the Internet for software installation and at the same time have a static IP to access web applications.</p></li><li class="listitem" value="8">Set up the VM's network interface in a bridge mode and select the physical interface to which the virtual one should be bridged.</li><li class="listitem" value="9">First, we need to switch the Network Manager service into the manually starting mode so that it does not reset our networking settings after every reboot. Run the following commands to do it:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">sudo stop network-manager</strong></span>
<span class="strong"><strong class="calibre2">echo "manual"|sudo tee /etc/init/network-manager.override</strong></span>
</pre></div></li><li class="listitem" value="10">Now, let's <a id="id244" class="calibre1"/>set the new network settings by editing the file <code class="literal">/etc/network/interfaces</code>. Change or add the following settings for the interface <code class="literal">eth0</code>:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">auto eth0</strong></span>
<span class="strong"><strong class="calibre2">iface eth0 inet static</strong></span>
<span class="strong"><strong class="calibre2">        address 10.0.0.5</strong></span>
<span class="strong"><strong class="calibre2">        netmask 255.255.255.0</strong></span>
<span class="strong"><strong class="calibre2">        network 10.0.0.0</strong></span>
<span class="strong"><strong class="calibre2">        broadcast 10.0.0.255</strong></span>
<span class="strong"><strong class="calibre2">        gateway 10.0.0.1</strong></span>
<span class="strong"><strong class="calibre2">        dns-nameservers 10.0.0.2 10.0.0.1</strong></span>
</pre></div></li><li class="listitem" value="11">Restart the networking service with the following command or just reboot the VM to apply the changes and check the interface settings with the <code class="literal">ifconfig</code> command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">sudo service networking restart</strong></span>
<span class="strong"><strong class="calibre2">ifconfig eth0</strong></span>
</pre></div></li></ol><div class="calibre14"/></div><p class="calibre9">You should be able to plug in a network cable and access the Internet.</p><p class="calibre9">Alternatively, you can use a NAT mode to download all the necessary software and then switch the VM to a host-only network mode, which allows the host machine and other guest machines access to your current one. You can use the VM in this mode as a standalone web server for direct web application attacks and perform the four networking configuration steps listed in the preceding list when you want to connect the VM to your lab network.</p><p class="calibre9">Let's install the necessary prerequisites:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">We need Java 6 or higher for our web applications to work. Check if it is installed with the command <code class="literal">java -version</code> and use <code class="literal">apt-get</code> to install it if not. We are installing OpenJDK 7:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">sudo apt-get install openjdk-7-jre</strong></span>
</pre></div></li><li class="listitem" value="2">You will also need the <code class="literal">unzip</code> utility installed in order to unpack the web application's archives, so let's install it first:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">sudo apt-get install unzip</strong></span>
</pre></div></li></ol><div class="calibre14"/></div><p class="calibre9">At this point, our web server is ready for installing web applications.</p></div></div>

<div class="book" title="Installing web applications">
<div class="book" title="WebGoat"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch04lvl2sec44" class="calibre1"/>WebGoat</h2></div></div></div><p class="calibre9">The<a id="id245" class="calibre1"/> OWASP project WebGoat (<a class="calibre1" href="https://www.owasp.org/index.php/Category:OWASP_WebGoat_Project">https://www.owasp.org/index.php/Category:OWASP_WebGoat_Project</a>) is one the most known vulnerable web applications for learning purposes. The coolest thing about WebGoat is that it not only offers you some vulnerabilities for exploitation, but also involves you in the fixing process offering to change the application's source code. It is extremely helpful for developing really useful effective vulnerability fix recommendations when a penetration tester has not much of a web development background.</p><p class="calibre9">WebGoat is <a id="id246" class="calibre1"/>distributed as a web application package rather than a VM image and you need to have a prepared server first in order to be able to run it.</p><p class="calibre9">As we have already prepared a server, let's get the WebGoat application running:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Download the web application package from GitHub. You can do it with the <code class="literal">wget</code> utility, but check if you are downloading the latest version:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">wget https://github.com/WebGoat/WebGoat-Legacy/releases/download/v6.0.1/WebGoat-6.0.1-war-exec.jar</strong></span>
</pre></div></li><li class="listitem" value="2">Run the web application:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">java -jar WebGoat-6.0.1-war-exec.jar</strong></span>
</pre></div></li></ol><div class="calibre14"/></div><p class="calibre9">Check if the app works by opening the browser on another machine and navigate to <code class="literal">http://10.0.0.5:8080/WebGoat</code> (the URI is case sensitive).</p><div class="mediaobject"><img src="../images/00030.jpeg" alt="WebGoat" class="calibre11"/><div class="caption"><p class="calibre15">WebGoat login screen</p></div></div><p class="calibre12"> </p></div></div>

<div class="book" title="Installing web applications">
<div class="book" title="DVWA"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch04lvl2sec45" class="calibre1"/>DVWA</h2></div></div></div><p class="calibre9">Another<a id="id247" class="calibre1"/> example of a useful web application for penetration<a id="id248" class="calibre1"/> testing training is <span class="strong"><strong class="calibre2">Damn Vulnerable Web Application</strong></span> (<a class="calibre1" href="http://www.dvwa.co.uk">http://www.dvwa.co.uk</a>) written <a id="id249" class="calibre1"/>in PHP and using MySQL. It contains all the vulnerabilities from the OWASP top-10 list and allows us to use the web application in three security levels corresponding to different pentesting skill levels.</p><p class="calibre9">Let's see how to install <a id="id250" class="calibre1"/>and run DVWA:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Log in and change the current directory to the Apache's default directory:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">cd /var/www/html</strong></span>
</pre></div></li><li class="listitem" value="2">Download the application's archive and unpack it:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">wget https://github.com/RandomStorm/DVWA/archive/v1.0.8.zip</strong></span>
<span class="strong"><strong class="calibre2">unzip v1.0.8.zip</strong></span>
</pre></div></li><li class="listitem" value="3">Now, we <a id="id251" class="calibre1"/>need to configure a MySQL connection. Open the file <code class="literal">DVWA-1.0.8/config/config.inc.php</code> in an editor and find the following line:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">$_DVWA[ 'db_password' ] = 'p@ssw0rd';</strong></span>
</pre></div></li><li class="listitem" value="4">Change <code class="literal">p@ssw0rd</code> to the MySQL root password that you set during the server installation process and save the file.</li><li class="listitem" value="5">Change the DVWA directory's name (in convenience consideration) and permissions:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">mv DVWA-1.0.8 dvwa</strong></span>
<span class="strong"><strong class="calibre2">chmod -R 777 /var/www/html/dvwa</strong></span>
</pre></div></li><li class="listitem" value="6">Log in into MySQL and create a database for DVWA:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">mysql -u root -p</strong></span>
<span class="strong"><strong class="calibre2"> create database dvwa;</strong></span>
<span class="strong"><strong class="calibre2"> exit</strong></span>
</pre></div></li><li class="listitem" value="7">Now, you <a id="id252" class="calibre1"/>need to navigate from another machine's browser to the DVWA setup interface (we use the server's IP 10.0.0.5 assuming you have already set the static networking settings) <code class="literal">http://10.0.0.5/dvwa/setup.php</code> and click on the <span class="strong"><strong class="calibre2">Create/Reset Database</strong></span> button.</li></ol><div class="calibre14"/></div><p class="calibre9">You can now navigate to <code class="literal">http://10.0.0.5/dvwa/login.php</code>, log in with the default credentials <code class="literal">admin:password</code>, and use the application.</p><div class="mediaobject"><img src="../images/00031.jpeg" alt="DVWA" class="calibre11"/><div class="caption"><p class="calibre15">DVWA is ready to be hacked</p></div></div><p class="calibre12"> </p></div></div>

<div class="book" title="Installing web applications">
<div class="book" title="Liferay Portal"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_4"><a id="ch04lvl2sec46" class="calibre1"/>Liferay Portal</h2></div></div></div><p class="calibre9">One of <a id="id253" class="calibre1"/>the web applications that we frequently meet during penetration tests is Liferay Portal. It is an open source, portlet-based enterprise <a id="id254" class="calibre1"/><span class="strong"><strong class="calibre2">Content Management System</strong></span> (<span class="strong"><strong class="calibre2">CMS</strong></span>) that can be customized to fulfill various business needs. Liferay Portal is written in Java and is used for both intranet and external web portals.</p><p class="calibre9">Its popularity on <a id="id255" class="calibre1"/>the market means that you probably will meet it if you conduct commercial penetration tests for your customers and you probably want to know in advance how to approach it in the context of hacking. What is especially cool with Liferay in our current context is that there is not only a commercial, but also a community version of the portal available.</p><p class="calibre9">The <span class="strong"><strong class="calibre2">Community edition</strong></span> (<span class="strong"><strong class="calibre2">CE</strong></span>) is<a id="id256" class="calibre1"/> distributed for free and you can download it at Liferay's website <a class="calibre1" href="http://www.liferay.com">http://www.liferay.com</a> without <a id="id257" class="calibre1"/>a registration. Since we need it for learning and research purposes, you will not have any legal or licensing problems.</p><p class="calibre9">We are going to install Liferay Portal CE on a server under the Ubuntu Server 14 operating system, and it is easier to prepare a server first and then download Liferay directly to a VM.</p><p class="calibre9">Let's list the<a id="id258" class="calibre1"/> steps you need to make in order to get your working server <a id="id259" class="calibre1"/>with a running Liferay Portal:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Download a zip-archive of the community edition from the official Liferay website (<a class="calibre1" href="http://www.liferay.com/de/downloads/liferay-portal/available-releases">http://www.liferay.com/de/downloads/liferay-portal/available-releases</a>).</li><li class="listitem" value="2">Unpack the archive to the <code class="literal">/srv/</code> directory.</li><li class="listitem" value="3">Start Tomcat with the following command (putting the correct version numbers):<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">sudo /srv/liferay-{version}/tomcat-{version}/bin/startup.sh</strong></span>
</pre></div></li><li class="listitem" value="4">Wait for a minute or two, depending on the hardware of the VM.</li><li class="listitem" value="5">To check if the application started successfully and is reachable from other hosts, run the following command and check if the application listens on 0.0.0.0 (all interfaces):<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">netstat -antp|grep 8080</strong></span>
</pre></div><div class="mediaobject"><img src="../images/00032.jpeg" alt="Liferay Portal" class="calibre11"/><div class="caption"><p class="calibre15">Listening web server</p></div></div><p class="calibre26"> </p></li><li class="listitem" value="6">Open a browser on another machine and navigate to <code class="literal">http://10.0.0.5:8080</code>. You should see the basic configuration dialog:<div class="mediaobject"><img src="../images/00033.jpeg" alt="Liferay Portal" class="calibre11"/><div class="caption"><p class="calibre15">Liferay basic configuration page</p></div></div><p class="calibre26"> </p></li><li class="listitem" value="7">You <a id="id260" class="calibre1"/>can change the values if you want, but do not uncheck the <span class="strong"><strong class="calibre2">Add Sample Data</strong></span> checkbox because it will be useful when you research the portal.</li><li class="listitem" value="8">Click on <span class="strong"><strong class="calibre2">Finish configuration</strong></span> and wait for a while until the installation process is finished.</li><li class="listitem" value="9">Then, navigate to <a id="id261" class="calibre1"/>the portal and read and accept the user agreement.</li></ol><div class="calibre14"/></div><p class="calibre9">Now Liferay Portal is installed and ready to use in our lab. You can already start playing around with the portal in order to understand how it works, review the portal's internal structure and configs, and so on.</p><p class="calibre9">The portal is already filled with some sample data, but you can go further and create an account at Liferay's Marketplace (<a class="calibre1" href="https://www.liferay.com/marketplace/">https://www.liferay.com/marketplace/</a>) to download and install other web applications to your portal.</p></div></div>

<div class="book" title="Installing web applications">
<div class="book" title="Metasploitable"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_5"><a id="ch04lvl2sec47" class="calibre1"/>Metasploitable</h2></div></div></div><p class="calibre9">Most of <a id="id262" class="calibre1"/>the popular vulnerable VM images are created to practice <a id="id263" class="calibre1"/>web application penetration testing, but there are VMs that are targeted more on the system and network software level, let's say classic hacking. They are very convenient for learning and practicing software and OS exploitation, fuzzing, bruteforcing, tunneling, privilege escalation, and so on.</p><p class="calibre9">One such VM is Metasploitable 2 (basically, the newer and extended version of its ancestor Metasploitable) provided by a well-known IT security company Rapid7 and we are going to add it to our lab environment.</p><p class="calibre9">Let's quote the official<a id="id264" class="calibre1"/> description of Metasploitable 2 (<a class="calibre1" href="https://community.rapid7.com/docs/DOC-1875">https://community.rapid7.com/docs/DOC-1875</a>):</p><div class="blockquote"><blockquote class="blockquote1"><p class="calibre25">"The Metasploitable virtual machine is an intentionally vulnerable version of Ubuntu Linux designed for testing security tools and demonstrating common vulnerabilities. Version 2 of this virtual machine is available for download and ships with even more vulnerabilities than the original image. This virtual machine is compatible with VMWare, VirtualBox, and other common virtualization platforms."</p></blockquote></div><p class="calibre9">As we understand, Metasploitable was created mainly for learning the popular hacking framework Metasploit Framework, but it also fits in a far bigger range of various penetration testing learning tasks.</p><p class="calibre9">By default, Metasploitable 2 contains<a id="id265" class="calibre1"/> the following preinstalled network services:</p><div class="book"><ul class="itemizedlist"><li class="listitem">FTP</li><li class="listitem">SSH</li><li class="listitem">Telnet</li><li class="listitem">SMTP</li><li class="listitem">Web server</li><li class="listitem">rlogin</li><li class="listitem">NFS</li><li class="listitem">MySQL</li><li class="listitem">PostgreSQL</li><li class="listitem">VNC</li><li class="listitem">Backdoors</li></ul></div><p class="calibre9">The following <a id="id266" class="calibre1"/>attack techniques can be practiced with the listed services:</p><div class="book"><ul class="itemizedlist"><li class="listitem">Information gathering</li><li class="listitem">Scanning</li><li class="listitem">Buffer and stack overflow exploitation</li><li class="listitem">Password guessing / bruteforcing</li><li class="listitem">Fuzzing</li><li class="listitem">Exploit development</li><li class="listitem">SMTP redirection</li><li class="listitem">Man-in-the-middle</li><li class="listitem">Privilege escalation</li></ul></div><p class="calibre9">The installation process<a id="id267" class="calibre1"/> of Metasploitable 2 is pretty straightforward as well as for the most of the preinstalled intentionally vulnerable VM images:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">First, unpack the Metasploitable 2 <code class="literal">.zip</code> archive to the directory where you keep your lab VMs.</li><li class="listitem" value="2">Then, create a 32-bit Ubuntu Linux VM with 512 MB RAM and network interface in a bridge mode, and chose the existing virtual disk from the Metasploitable 2 directory (<code class="literal">Metasploitable.vmdk</code>) when VirtualBox asks you about creating a virtual disk.</li><li class="listitem" value="3">Start the VM and log in with the default credentials <code class="literal">msfadmin:msfadmin</code>.</li><li class="listitem" value="4">Set your networking settings similar to what we have done on our Liferay Ubuntu Server, but use the correct IP address 10.0.0.3.</li></ol><div class="calibre14"/></div><div class="informalexample" title="Note"><h3 class="title2"><a id="note17" class="calibre1"/>Note</h3><p class="calibre9">
<span class="strong"><strong class="calibre2">Practicing direct attacks</strong></span>
</p><p class="calibre9">If you want to practice direct attacks with Metasploitable 2, you can switch the VM's network interface into the host-only network mode and hack it from a VM running on the same host machine. You can find a tutorial on how to do it at the following link: <a class="calibre1" href="https://community.rapid7.com/message/4137">https://community.rapid7.com/message/4137</a>.</p></div><p class="calibre9">At this point, Metasploitable 2 is ready to receive your evil packets, have fun!</p></div></div>

<div class="book" title="Installing web applications">
<div class="book" title="Vulnerable VoIP server"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_6"><a id="ch04lvl2sec48" class="calibre1"/>Vulnerable VoIP server</h2></div></div></div><p class="calibre9">With the <a id="id268" class="calibre1"/>spread of IP networks and technologies, it became very common to have enterprise IP-based telephone networks and it means that you will meet those systems from time to time as a part of a scope infrastructure penetration testing project or as a separate VoIP pentest project if you are going to work on commercial projects.</p><p class="calibre9">In turn, it means that you would like to be well prepared for such systems and try to research and attack it in your lab.</p><p class="calibre9">Luckily for us, there is a preinstalled image of a vulnerable VoIP server based on CentOS and Asterisk called<a id="id269" class="calibre1"/> <span class="strong"><strong class="calibre2">vulnVoIP</strong></span>.</p><p class="calibre9">The official description and the download link can be found at the <a class="calibre1" href="http://www.rebootuser.com">http://www.rebootuser.com</a> under the <span class="strong"><strong class="calibre2">HackLAB</strong></span> section. It is a bit old now, but it's still good for understanding how the technology and its hacks work.</p><p class="calibre9">vulnVoIP is distributed as a VMware image, so you can install a free VMware Player software or probably you have a VMware license if you built your lab in an enterprise environment and you can run the image as is.</p><div class="mediaobject"><img src="../images/00034.jpeg" alt="Vulnerable VoIP server" class="calibre11"/><div class="caption"><p class="calibre15">Web interface on vulnVoIP</p></div></div><p class="calibre12"> </p><p class="calibre9">If you prefer <a id="id270" class="calibre1"/>VirtualBox, you can perform the following simple steps:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Unpack the <code class="literal">.7zip</code> vulnVoIP archive.</li><li class="listitem" value="2">Create a new 32-bit Linux-based VM. Give it a name and 512 MB RAM.</li><li class="listitem" value="3">When asked about a hard disk, choose the <code class="literal">vulnVoIP.vmdk</code> virtual disk file from the unpacked vulnVoIP directory.</li></ol><div class="calibre14"/></div><p class="calibre9">The developer <a id="id271" class="calibre1"/>of vulnVoIP doesn't supply a root password with the image and offers to hack the system in order to get the root access. So, we will not deprive you of a good lesson and let you acquire root access as it is supposed by the vulnVoIP author.</p><p class="calibre9">After getting the root access, you can set the static IP 10.0.04 and connect vulnVoIP to the rest of your lab network.</p></div></div>
<div class="book" title="Summary" id="1394Q1-3ecab517ca6e4afbb3c20ab15f7b4d82"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch04lvl1sec30" class="calibre1"/>Summary</h1></div></div></div><p class="calibre9">In this chapter, you saw how to fill your lab with the useful components that actually bring sense to the whole story of building a lab network. We installed the common services that you are most likely to meet in the scope of a commercial penetration testing project and the ones you most probably would like to be able to hack.</p><p class="calibre9">If you need to practice some specific skills, you can and should extend your lab by installing and configuring additional specific network services or applications according to your requirements.</p><p class="calibre9">You can find, for example, a lot of preinstalled VM images at the following websites:</p><div class="book"><ul class="itemizedlist"><li class="listitem"><a class="calibre1" href="http://virtualboxes.org/">http://virtualboxes.org/</a></li><li class="listitem"><a class="calibre1" href="https://virtualboximages.com/">https://virtualboximages.com/</a></li></ul></div><p class="calibre9">In the next chapter, we will see how to leverage your lab level by installing and configuring security solutions.</p></div></body></html>