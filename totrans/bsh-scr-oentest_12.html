<html><head></head><body>
  <div id="_idContainer130">
   <h1 class="chapter-number" id="_idParaDest-160">
    <a id="_idTextAnchor260">
    </a>
    <span class="koboSpan" id="kobo.1.1">
     10
    </span>
   </h1>
   <h1 id="_idParaDest-161">
    <a id="_idTextAnchor261">
    </a>
    <span class="koboSpan" id="kobo.2.1">
     Network and Infrastructure Pentesting with Bash
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.3.1">
     This chapter explores how to use Bash for network and infrastructure pentesting.
    </span>
    <span class="koboSpan" id="kobo.3.2">
     We’ll look at how Bash can be a powerful tool for probing network systems, identifying vulnerabilities, and simulating attack scenarios.
    </span>
    <span class="koboSpan" id="kobo.3.3">
     You’ll gain a comprehensive understanding of how to use Bash for scanning, enumeration, and vulnerability assessment in an internal
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.4.1">
      network environment.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.5.1">
     In this chapter, we’re going to cover the following
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.6.1">
      main topics:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.7.1">
      Fundamentals of network pentesting
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.8.1">
       with Bash
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.9.1">
      Advanced network scanning techniques
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.10.1">
       in Bash
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.11.1">
      Enumerating network services and protocols
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.12.1">
       using Bash
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.13.1">
      Infrastructure vulnerability assessment
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.14.1">
       with Bash
      </span>
     </span>
    </li>
   </ul>
   <h1 id="_idParaDest-162">
    <a id="_idTextAnchor262">
    </a>
    <span class="koboSpan" id="kobo.15.1">
     Technical requirements
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.16.1">
     To follow along, at a minimum, you will need access to a Bash shell.
    </span>
    <span class="koboSpan" id="kobo.16.2">
     To perform the demonstrated exercises, you will need to build the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.17.1">
      Game of Active Directory
     </span>
    </strong>
    <span class="koboSpan" id="kobo.18.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.19.1">
      GOAD
     </span>
    </strong>
    <span class="koboSpan" id="kobo.20.1">
     ) lab.
    </span>
    <span class="koboSpan" id="kobo.20.2">
     You can find GOAD
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.21.1">
      at
     </span>
    </span>
    <a href="https://github.com/Orange-Cyberdefense/GOAD">
     <span class="No-Break">
      <span class="koboSpan" id="kobo.22.1">
       https://github.com/Orange-Cyberdefense/GOAD
      </span>
     </span>
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.23.1">
      .
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.24.1">
     GOAD is an Active Directory exploitation lab.
    </span>
    <span class="koboSpan" id="kobo.24.2">
     If you’re not familiar with Active Directory, it’s a system for managing a large number of related Microsoft Windows systems.
    </span>
    <span class="koboSpan" id="kobo.24.3">
     The default Windows and Active Directory configurations frequently have vulnerabilities that can be exploited.
    </span>
    <span class="koboSpan" id="kobo.24.4">
     There are additional exploitable misconfigurations in the lab beyond default settings.
    </span>
    <span class="koboSpan" id="kobo.24.5">
     The Active Directory vulnerabilities in the GOAD lab are frequently found on internal network pentests, making this one of the best labs for practice or for testing new
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.25.1">
      pentest tools.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.26.1">
     I use Ludus to deploy my GOAD lab.
    </span>
    <span class="koboSpan" id="kobo.26.2">
     I run a Ludus server, and on the client side (my laptop), I use the Ludus client to automate building, starting, and stopping my lab environment.
    </span>
    <span class="koboSpan" id="kobo.26.3">
     Ludus makes it easy to automate lab deployment of complex network environments.
    </span>
    <span class="koboSpan" id="kobo.26.4">
     I have deployed my Ludus range with both GOAD and Vulhub templates for a mix of internal network pentesting targets along with a mix of known vulnerable web applications.
    </span>
    <span class="koboSpan" id="kobo.26.5">
     You can read more about Ludus
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.27.1">
      at
     </span>
    </span>
    <a href="https://docs.ludus.cloud">
     <span class="No-Break">
      <span class="koboSpan" id="kobo.28.1">
       https://docs.ludus.cloud
      </span>
     </span>
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.29.1">
      .
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.30.1">
     Which should you choose, GOAD or Ludus?
    </span>
    <span class="koboSpan" id="kobo.30.2">
     GOAD must be installed on a Linux system, but you can continue to use that Linux system for other uses.
    </span>
    <span class="koboSpan" id="kobo.30.3">
     The Ludus server requires installing it
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.31.1">
      bare metal
     </span>
    </em>
    <span class="koboSpan" id="kobo.32.1">
     on a computer.
    </span>
    <span class="koboSpan" id="kobo.32.2">
     After installing Ludus, you will not be able to use that computer for anything other than a virtual server.
    </span>
    <span class="koboSpan" id="kobo.32.3">
     If you can, I recommend dedicating a computer to running Ludus and deploying GOAD from there.
    </span>
    <span class="koboSpan" id="kobo.32.4">
     You will need a lab environment throughout your pentesting career, and Ludus makes running a lab
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.33.1">
      environment easy.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.34.1">
     The code for this chapter can be found
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.35.1">
      at
     </span>
    </span>
    <a href="https://github.com/PacktPublishing/Bash-Shell-Scripting-for-Pentesters/tree/main/Chapter10">
     <span class="No-Break">
      <span class="koboSpan" id="kobo.36.1">
       https://github.com/PacktPublishing/Bash-Shell-Scripting-for-Pentesters/tree/main/Chapter10
      </span>
     </span>
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.37.1">
      .
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.38.1">
     Run the following commands to install the prerequisites
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.39.1">
      in Kali:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.40.1">
$ </span><a id="_idTextAnchor263"/><a id="_idTextAnchor264"/><span class="koboSpan" id="kobo.41.1">sudo apt update &amp;&amp; sudo apt install -y tmux netexec nmap masscan tcpdump wordlists hashcat xmlstarlet</span></pre>
   <p>
    <span class="koboSpan" id="kobo.42.1">
     Install Greenbone Community Edition, formerly known as OpenVAS.
    </span>
    <span class="koboSpan" id="kobo.42.2">
     The hardware or virtual hardware minimum requirements are
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.43.1">
      as follows:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.44.1">
       CPU
      </span>
     </strong>
     <span class="koboSpan" id="kobo.45.1">
      :
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.46.1">
       2 cores
      </span>
     </span>
    </li>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.47.1">
       RAM
      </span>
     </strong>
     <span class="koboSpan" id="kobo.48.1">
      :
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.49.1">
       4 GB
      </span>
     </span>
    </li>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.50.1">
       Storage
      </span>
     </strong>
     <span class="koboSpan" id="kobo.51.1">
      :
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.52.1">
       20 GB
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.53.1">
     Run the following command to install and
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.54.1">
      configure Greenbone:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.55.1">
$ </span><a id="_idTextAnchor265"/><a id="_idTextAnchor266"/><span class="koboSpan" id="kobo.56.1">sudo apt install -y gvm
$ </span><a id="_idTextAnchor267"/><a id="_idTextAnchor268"/><span class="koboSpan" id="kobo.57.1">sudo gvm-setup</span></pre>
   <p>
    <span class="koboSpan" id="kobo.58.1">
     Make a note of the admin account password in the output.
    </span>
    <span class="koboSpan" id="kobo.58.2">
     Once the setup completes, run the following command to ensure everything is
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.59.1">
      in order:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.60.1">
$ sudo gvm-check-setup</span></pre>
   <p>
    <span class="koboSpan" id="kobo.61.1">
     In the output, if everything went well, you should see this at the end:
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.62.1">
      It seems like your GVM-[version] installation
     </span>
    </strong>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.63.1">
       is OK.
      </span>
     </strong>
    </span>
   </p>
   <h1 id="_idParaDest-163">
    <a id="_idTextAnchor269">
    </a>
    <a id="_idTextAnchor270">
    </a>
    <span class="koboSpan" id="kobo.64.1">
     Fundamentals of network pentesting with Bash
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.65.1">
     Network pentesting, or pentesting, is a critical practice in cybersecurity.
    </span>
    <span class="koboSpan" id="kobo.65.2">
     It involves simulating attacks on a network to identify vulnerabilities before malicious actors can exploit them.
    </span>
    <span class="koboSpan" id="kobo.65.3">
     Various methodologies guide pentesters through this process, ensuring thorough and
    </span>
    <a id="_idIndexMarker563">
    </a>
    <span class="koboSpan" id="kobo.66.1">
     systematic assessments.
    </span>
    <span class="koboSpan" id="kobo.66.2">
     Bash scripting, a powerful tool in the Unix/Linux environment, plays a significant role in automating and enhancing these methodologies.
    </span>
    <span class="koboSpan" id="kobo.66.3">
     Let’s dive into the core methodologies of network pentesting and explore how Bash scripting can be
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.67.1">
      leveraged effectively.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-164">
    <a id="_idTextAnchor271">
    </a>
    <span class="koboSpan" id="kobo.68.1">
     Core methodologies in network pentesting
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.69.1">
     The core methodologies in network
    </span>
    <a id="_idIndexMarker564">
    </a>
    <span class="koboSpan" id="kobo.70.1">
     pentesting include
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.71.1">
      the following:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.72.1">
       Reconnaissance
      </span>
     </strong>
     <span class="koboSpan" id="kobo.73.1">
      : Reconnaissance is the initial phase where information about the target network is
     </span>
     <a id="_idIndexMarker565">
     </a>
     <span class="koboSpan" id="kobo.74.1">
      gathered.
     </span>
     <span class="koboSpan" id="kobo.74.2">
      This can be
     </span>
     <a id="_idIndexMarker566">
     </a>
     <span class="koboSpan" id="kobo.75.1">
      passive (e.g., searching public records) or active (e.g., scanning
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.76.1">
       the network).
      </span>
     </span>
    </li>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.77.1">
       Scanning
      </span>
     </strong>
     <span class="koboSpan" id="kobo.78.1">
      : In this phase, pentesters
     </span>
     <a id="_idIndexMarker567">
     </a>
     <span class="koboSpan" id="kobo.79.1">
      use tools to discover live hosts, open
     </span>
     <a id="_idIndexMarker568">
     </a>
     <span class="koboSpan" id="kobo.80.1">
      ports, and services running on the network.
     </span>
     <span class="koboSpan" id="kobo.80.2">
      This helps in mapping the network and identifying potential
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.81.1">
       entry points.
      </span>
     </span>
    </li>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.82.1">
       Enumeration
      </span>
     </strong>
     <span class="koboSpan" id="kobo.83.1">
      : Enumeration involves
     </span>
     <a id="_idIndexMarker569">
     </a>
     <span class="koboSpan" id="kobo.84.1">
      extracting more detailed information from
     </span>
     <a id="_idIndexMarker570">
     </a>
     <span class="koboSpan" id="kobo.85.1">
      the network, such as user accounts, machine names, and network shares.
     </span>
     <span class="koboSpan" id="kobo.85.2">
      This phase builds on the data gathered
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.86.1">
       during scanning.
      </span>
     </span>
    </li>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.87.1">
       Exploitation
      </span>
     </strong>
     <span class="koboSpan" id="kobo.88.1">
      : Here, pentesters
     </span>
     <a id="_idIndexMarker571">
     </a>
     <span class="koboSpan" id="kobo.89.1">
      attempt to exploit identified
     </span>
     <a id="_idIndexMarker572">
     </a>
     <span class="koboSpan" id="kobo.90.1">
      vulnerabilities to gain unauthorized access to systems or data.
     </span>
     <span class="koboSpan" id="kobo.90.2">
      This phase tests the effectiveness of security measures
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.91.1">
       in place.
      </span>
     </span>
    </li>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.92.1">
       Post-exploitation
      </span>
     </strong>
     <span class="koboSpan" id="kobo.93.1">
      : After gaining access, pentesters assess the extent of the breach, maintain access, and gather
     </span>
     <a id="_idIndexMarker573">
     </a>
     <span class="koboSpan" id="kobo.94.1">
      additional information.
     </span>
     <span class="koboSpan" id="kobo.94.2">
      This
     </span>
     <a id="_idIndexMarker574">
     </a>
     <span class="koboSpan" id="kobo.95.1">
      phase helps in understanding the potential impact of
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.96.1">
       an attack.
      </span>
     </span>
    </li>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.97.1">
       Reporting
      </span>
     </strong>
     <span class="koboSpan" id="kobo.98.1">
      : Finally, pentesters
     </span>
     <a id="_idIndexMarker575">
     </a>
     <span class="koboSpan" id="kobo.99.1">
      compile their findings into a
     </span>
     <a id="_idIndexMarker576">
     </a>
     <span class="koboSpan" id="kobo.100.1">
      report, detailing vulnerabilities, exploited weaknesses, and recommendations
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.101.1">
       for remediation.
      </span>
     </span>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.102.1">
     We covered reconnaissance in
    </span>
    <a href="B22229_08.xhtml#_idTextAnchor213">
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.103.1">
        Chapter 8
       </span>
      </em>
     </span>
    </a>
    <span class="koboSpan" id="kobo.104.1">
     .
    </span>
    <span class="koboSpan" id="kobo.104.2">
     This chapter will focus on scanning, enumeration, and exploitation.
    </span>
    <span class="koboSpan" id="kobo.104.3">
     Post-exploitation and reporting will follow in
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.105.1">
      later chapters.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.106.1">
     Pentesters need to be able to hyper-focus on attention to detail to be effective.
    </span>
    <span class="koboSpan" id="kobo.106.2">
     Pentests are usually time-boxed, meaning you have limited time between a scheduled start and stop date.
    </span>
    <span class="koboSpan" id="kobo.106.3">
     The value of having Bash scripting skills is the time it saves.
    </span>
    <span class="koboSpan" id="kobo.106.4">
     We want to automate running scanning and enumeration, saving us precious time to focus on the details output from our tools.
    </span>
    <span class="koboSpan" id="kobo.106.5">
     This is where Bash scripting
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.107.1">
      is valuable.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.108.1">
     During a pentest, we need to run a list of tools.
    </span>
    <span class="koboSpan" id="kobo.108.2">
     Often, we must chain together the output of one tool with the input of another.
    </span>
    <span class="koboSpan" id="kobo.108.3">
     This process usually involves transforming data, as we have seen in
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.109.1">
      earlier chapters.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-165">
    <a id="_idTextAnchor272">
    </a>
    <span class="koboSpan" id="kobo.110.1">
     Setting up the pentest environment
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.111.1">
     My first step when starting a
    </span>
    <a id="_idIndexMarker577">
    </a>
    <span class="koboSpan" id="kobo.112.1">
     network pentest is to create a directory structure to hold the data.
    </span>
    <span class="koboSpan" id="kobo.112.2">
     The top-level directory is the name of the pentest.
    </span>
    <span class="koboSpan" id="kobo.112.3">
     In this case, I’ll call it
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.113.1">
      bashbook
     </span>
    </strong>
    <span class="koboSpan" id="kobo.114.1">
     .
    </span>
    <span class="koboSpan" id="kobo.114.2">
     Then, I create directories under
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.115.1">
      bashbook
     </span>
    </strong>
    <span class="koboSpan" id="kobo.116.1">
     for logs, scans,
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.117.1">
      and loot.
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer108">
     <span class="koboSpan" id="kobo.118.1">
      <img alt="Figure 10.1 – Network pentest directory structure example" src="image/B22229_10_01.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.119.1">
     Figure 10.1 – Network pentest directory structure example
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.120.1">
     Under the top-level directory,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.121.1">
      bashbook
     </span>
    </strong>
    <span class="koboSpan" id="kobo.122.1">
     , I’ll create two files,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.123.1">
      scope.txt
     </span>
    </strong>
    <span class="koboSpan" id="kobo.124.1">
     and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.125.1">
      exclusions.txt
     </span>
    </strong>
    <span class="koboSpan" id="kobo.126.1">
     .
    </span>
    <span class="koboSpan" id="kobo.126.2">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.127.1">
      scope.txt
     </span>
    </strong>
    <span class="koboSpan" id="kobo.128.1">
     file is where I list the IP or network addresses I’m authorized to test.
    </span>
    <span class="koboSpan" id="kobo.128.2">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.129.1">
      exclusions.txt
     </span>
    </strong>
    <span class="koboSpan" id="kobo.130.1">
     file includes any IP addresses or hostnames that are off-limits.
    </span>
    <span class="koboSpan" id="kobo.130.2">
     This way, if my
    </span>
    <a id="_idIndexMarker578">
    </a>
    <span class="koboSpan" id="kobo.131.1">
     authorized scope is the network address
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.132.1">
      10.2.10.0/24
     </span>
    </strong>
    <span class="koboSpan" id="kobo.133.1">
     but
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.134.1">
      10.2.10.13
     </span>
    </strong>
    <span class="koboSpan" id="kobo.135.1">
     is excluded, I can put that address in
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.136.1">
      exclusions.txt
     </span>
    </strong>
    <span class="koboSpan" id="kobo.137.1">
     to ensure I skip
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.138.1">
      that address.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.139.1">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.140.1">
      logs
     </span>
    </strong>
    <span class="koboSpan" id="kobo.141.1">
     directory is where I’ll place a copy of the output of every command I run in the terminal.
    </span>
    <span class="koboSpan" id="kobo.141.2">
     For terminal logging, I’m a
    </span>
    <a id="_idIndexMarker579">
    </a>
    <span class="koboSpan" id="kobo.142.1">
     huge fan of the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.143.1">
      tee
     </span>
    </strong>
    <span class="koboSpan" id="kobo.144.1">
     command.
    </span>
    <span class="koboSpan" id="kobo.144.2">
     There are methods to log all command-line activity to a single file, but I personally like to append the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.145.1">
      tee
     </span>
    </strong>
    <span class="koboSpan" id="kobo.146.1">
     command to each command and save individual log files.
    </span>
    <span class="koboSpan" id="kobo.146.2">
     This saves the output to a file that will have a date and time stamp and a meaningful filename.
    </span>
    <span class="koboSpan" id="kobo.146.3">
     If my customer reports an outage and asks me what I was doing, I can look in my
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.147.1">
      logs
     </span>
    </strong>
    <span class="koboSpan" id="kobo.148.1">
     directory at the timestamps and provide an answer.
    </span>
    <span class="koboSpan" id="kobo.148.2">
     Additionally, these log files are valuable in case I realize after testing ends that I’ve missed a screenshot for the report.
    </span>
    <span class="koboSpan" id="kobo.148.3">
     I can simply
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.149.1">
      cat
     </span>
    </strong>
    <span class="koboSpan" id="kobo.150.1">
     the log file and take a screenshot.
    </span>
    <span class="koboSpan" id="kobo.150.2">
     These log files will also be used when I need to parse data to discover all affected hosts for a report finding.
    </span>
    <span class="koboSpan" id="kobo.150.3">
     To execute a command and see the output while saving the output to a file, use the Bash pipe symbol (
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.151.1">
      |
     </span>
    </strong>
    <span class="koboSpan" id="kobo.152.1">
     ) between the command
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.153.1">
      and
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.154.1">
       tee
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.155.1">
      .
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.156.1">
     Here is
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.157.1">
      an example:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.158.1">
$ netexec smb 10.2.10.0/24 -u user -p password --shares | tee logs/netexec-user-shares.log</span></pre>
   <p>
    <span class="koboSpan" id="kobo.159.1">
     Now, I have a meaningful log filename with a timestamp and the output of my command for
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.160.1">
      parsing later.
     </span>
    </span>
   </p>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.161.1">
     Tip
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.162.1">
     If you run another command and pipe it to
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.163.1">
      tee
     </span>
    </strong>
    <span class="koboSpan" id="kobo.164.1">
     and an existing filename, the file will be overwritten.
    </span>
    <span class="koboSpan" id="kobo.164.2">
     To append to a file, use
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.165.1">
      tee -
     </span>
    </strong>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.166.1">
       a [filename]
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.167.1">
      .
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-166">
    <a id="_idTextAnchor273">
    </a>
    <span class="koboSpan" id="kobo.168.1">
     Using tmux for persistent sessions
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.169.1">
     Before we start
    </span>
    <a id="_idIndexMarker580">
    </a>
    <span class="koboSpan" id="kobo.170.1">
     hacking, I want to introduce you to
    </span>
    <a id="_idIndexMarker581">
    </a>
    <span class="koboSpan" id="kobo.171.1">
     another shell utility,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.172.1">
      tmux
     </span>
    </strong>
    <span class="koboSpan" id="kobo.173.1">
     .
    </span>
    <span class="koboSpan" id="kobo.173.2">
     Let’s take a look at the output of the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.174.1">
      man
     </span>
    </strong>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.175.1">
       tmux
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.176.1">
      command:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.177.1">
tmux is a terminal multiplexer: it enables a number of terminals to be created, accessed, and controlled from a single screen.  tmux may be detached from a screen and continue running in the background, then later reattached.</span></pre>
   <p>
    <span class="koboSpan" id="kobo.178.1">
     The reason why
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.179.1">
      tmux
     </span>
    </strong>
    <span class="koboSpan" id="kobo.180.1">
     is so important to our work is that pentesters frequently work remotely and must connect to or through remote systems to do their work.
    </span>
    <span class="koboSpan" id="kobo.180.2">
     For example, I work 100 percent remotely.
    </span>
    <span class="koboSpan" id="kobo.180.3">
     When I perform an internal network pentest for a customer, I don’t go onsite.
    </span>
    <span class="koboSpan" id="kobo.180.4">
     I ship a small computer such as an Intel NUC or a System76 Meerkat to my customer site.
    </span>
    <span class="koboSpan" id="kobo.180.5">
     The customer plugs it into the network and turns it on.
    </span>
    <span class="koboSpan" id="kobo.180.6">
     The device then connects to a
    </span>
    <a id="_idIndexMarker582">
    </a>
    <span class="koboSpan" id="kobo.181.1">
     bastion host on my team’s
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.182.1">
      network demilitarized zone
     </span>
    </strong>
    <span class="koboSpan" id="kobo.183.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.184.1">
      DMZ
     </span>
    </strong>
    <span class="koboSpan" id="kobo.185.1">
     ) using the Wireguard protocol.
    </span>
    <span class="koboSpan" id="kobo.185.2">
     I then use SSH with public and private keys to securely connect to my customer’s internal network through my
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.186.1">
      Bastion host.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.187.1">
     After establishing my SSH session, I immediately start or resume a
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.188.1">
      tmux
     </span>
    </strong>
    <span class="koboSpan" id="kobo.189.1">
     session.
    </span>
    <span class="koboSpan" id="kobo.189.2">
     You may be disconnected from a remote system while running a scan, or worse, after you’ve exploited a system and established a reverse shell.
    </span>
    <span class="koboSpan" id="kobo.189.3">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.190.1">
      tmux
     </span>
    </strong>
    <span class="koboSpan" id="kobo.191.1">
     program keeps your shell session and running processes alive if you get disconnected.
    </span>
    <span class="koboSpan" id="kobo.191.2">
     Without it, if you run a command and get disconnected from the SSH session, all running processes
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.192.1">
      are killed.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.193.1">
     Let’s explore how to use
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.194.1">
      tmux
     </span>
    </strong>
    <span class="koboSpan" id="kobo.195.1">
     .
    </span>
    <span class="koboSpan" id="kobo.195.2">
     First, run
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.196.1">
      tmux
     </span>
    </strong>
    <span class="koboSpan" id="kobo.197.1">
     and start a
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.198.1">
      new session:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.199.1">
$ tmux new -s [session name]</span></pre>
   <p>
    <span class="koboSpan" id="kobo.200.1">
     The session name is not required.
    </span>
    <span class="koboSpan" id="kobo.200.2">
     You may also start a new session by simply entering
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.201.1">
      tmux
     </span>
    </strong>
    <span class="koboSpan" id="kobo.202.1">
     .
    </span>
    <span class="koboSpan" id="kobo.202.2">
     If you work with others and are sharing a system, it’s a good idea to name
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.203.1">
      your session.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.204.1">
     Now, our terminal window will have the name of the session and a single default window in the lower left-hand corner.
    </span>
    <span class="koboSpan" id="kobo.204.2">
     The current window is denoted by the addition of the asterisk (
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.205.1">
      *
     </span>
    </strong>
    <span class="koboSpan" id="kobo.206.1">
     ) at the end of the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.207.1">
      window name.
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer109">
     <span class="koboSpan" id="kobo.208.1">
      <img alt="Figure 10.2 – A new tmux session status line is displayed" src="image/B22229_10_02.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.209.1">
     Figure 10.2 – A new tmux session status line is displayed
    </span>
   </p>
   <p>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.210.1">
      tmux
     </span>
    </strong>
    <span class="koboSpan" id="kobo.211.1">
     may be controlled from an
    </span>
    <a id="_idIndexMarker583">
    </a>
    <span class="koboSpan" id="kobo.212.1">
     attached client by using a key combination of a prefix key,
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.213.1">
      Ctrl
     </span>
    </em>
    <span class="koboSpan" id="kobo.214.1">
     +
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.215.1">
      b
     </span>
    </em>
    <span class="koboSpan" id="kobo.216.1">
     by default, followed by a command key.
    </span>
    <span class="koboSpan" id="kobo.216.2">
     To detach from the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.217.1">
      tmux
     </span>
    </strong>
    <span class="koboSpan" id="kobo.218.1">
     session, enter the key combination
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.219.1">
      Ctrl
     </span>
    </em>
    <span class="koboSpan" id="kobo.220.1">
     +
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.221.1">
      b
     </span>
    </em>
    <span class="koboSpan" id="kobo.222.1">
     ,
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.223.1">
      d
     </span>
    </em>
    <span class="koboSpan" id="kobo.224.1">
     .
    </span>
    <span class="koboSpan" id="kobo.224.2">
     This means pressing and holding the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.225.1">
      Ctrl
     </span>
    </em>
    <span class="koboSpan" id="kobo.226.1">
     key (
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.227.1">
      control
     </span>
    </em>
    <span class="koboSpan" id="kobo.228.1">
     key on macOS keyboards), then
    </span>
    <a id="_idIndexMarker584">
    </a>
    <span class="koboSpan" id="kobo.229.1">
     pressing and releasing the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.230.1">
      b
     </span>
    </em>
    <span class="koboSpan" id="kobo.231.1">
     key, then releasing the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.232.1">
      Ctrl
     </span>
    </em>
    <span class="koboSpan" id="kobo.233.1">
     key and pressing the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.234.1">
      d
     </span>
    </em>
    <span class="koboSpan" id="kobo.235.1">
     key.
    </span>
    <span class="koboSpan" id="kobo.235.2">
     When you reconnect to the SSH session, you reconnect to the session by entering
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.236.1">
      tmux a -t [session name]
     </span>
    </strong>
    <span class="koboSpan" id="kobo.237.1">
     .
    </span>
    <span class="koboSpan" id="kobo.237.2">
     This means
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.238.1">
      tmux
     </span>
    </strong>
    <span class="koboSpan" id="kobo.239.1">
     will attach (
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.240.1">
      a
     </span>
    </strong>
    <span class="koboSpan" id="kobo.241.1">
     ) to a target session (
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.242.1">
      -t
     </span>
    </strong>
    <span class="koboSpan" id="kobo.243.1">
     ) followed by the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.244.1">
      session name.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.245.1">
     Next, let’s create a new window by entering
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.246.1">
      Ctrl
     </span>
    </em>
    <span class="koboSpan" id="kobo.247.1">
     +
    </span>
    <span class="No-Break">
     <em class="italic">
      <span class="koboSpan" id="kobo.248.1">
       b
      </span>
     </em>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.249.1">
      ,
     </span>
    </span>
    <span class="No-Break">
     <em class="italic">
      <span class="koboSpan" id="kobo.250.1">
       c
      </span>
     </em>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.251.1">
      .
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer110">
     <span class="koboSpan" id="kobo.252.1">
      <img alt="Figure 10.3 – A new window is created in the tmux session" src="image/B22229_10_03.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.253.1">
     Figure 10.3 – A new window is created in the tmux session
    </span>
   </p>
   <p>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.254.1">
      tmux
     </span>
    </strong>
    <span class="koboSpan" id="kobo.255.1">
     is able to rename windows based on the running command.
    </span>
    <span class="koboSpan" id="kobo.255.2">
     However, if you want to manually rename a window, use the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.256.1">
      Ctrl
     </span>
    </em>
    <span class="koboSpan" id="kobo.257.1">
     +
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.258.1">
      b
     </span>
    </em>
    <span class="koboSpan" id="kobo.259.1">
     ,
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.260.1">
      ,
     </span>
    </em>
    <span class="koboSpan" id="kobo.261.1">
     (Press
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.262.1">
      Ctrl
     </span>
    </em>
    <span class="koboSpan" id="kobo.263.1">
     +
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.264.1">
      b
     </span>
    </em>
    <span class="koboSpan" id="kobo.265.1">
     key combination, release the keys, then press the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.266.1">
      ,
     </span>
    </em>
    <span class="koboSpan" id="kobo.267.1">
     (comma) key) followed by the desired name and the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.268.1">
      Enter
     </span>
    </em>
    <span class="koboSpan" id="kobo.269.1">
     key.
    </span>
    <span class="koboSpan" id="kobo.269.2">
     Notice that the current window is now
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.270.1">
      named
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.271.1">
       foo
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.272.1">
      :
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer111">
     <span class="koboSpan" id="kobo.273.1">
      <img alt="Figure 10.4 – The current window is renamed" src="image/B22229_10_04.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.274.1">
     Figure 10.4 – The current window is renamed
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.275.1">
     To switch between windows, press
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.276.1">
      Ctrl
     </span>
    </em>
    <span class="koboSpan" id="kobo.277.1">
     +
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.278.1">
      b
     </span>
    </em>
    <span class="koboSpan" id="kobo.279.1">
     +
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.280.1">
      n
     </span>
    </em>
    <span class="koboSpan" id="kobo.281.1">
     to switch to the next window or
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.282.1">
      Ctrl
     </span>
    </em>
    <span class="koboSpan" id="kobo.283.1">
     +
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.284.1">
      b
     </span>
    </em>
    <span class="koboSpan" id="kobo.285.1">
     +
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.286.1">
      [window number]
     </span>
    </em>
    <span class="koboSpan" id="kobo.287.1">
     to switch to a specific window.
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.288.1">
      tmux
     </span>
    </strong>
    <span class="koboSpan" id="kobo.289.1">
     can also split the terminal into multiple panes.
    </span>
    <span class="koboSpan" id="kobo.289.2">
     To see
    </span>
    <a id="_idIndexMarker585">
    </a>
    <span class="koboSpan" id="kobo.290.1">
     the default hotkeys, enter
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.291.1">
      man tmux
     </span>
    </strong>
    <span class="koboSpan" id="kobo.292.1">
     in your Bash shell.
    </span>
    <span class="koboSpan" id="kobo.292.2">
     If
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.293.1">
      tmux
     </span>
    </strong>
    <span class="koboSpan" id="kobo.294.1">
     is not already installed, you
    </span>
    <a id="_idIndexMarker586">
    </a>
    <span class="koboSpan" id="kobo.295.1">
     can install it with the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.296.1">
      sudo apt update &amp;&amp; sudo apt install
     </span>
    </strong>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.297.1">
       tmux
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.298.1">
      command.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.299.1">
     Now that we have set up our pentest system and are familiar with the basic tools, let’s
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.300.1">
      start scanning!
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-167">
    <a id="_idTextAnchor274">
    </a>
    <span class="koboSpan" id="kobo.301.1">
     Basic network scanning with Nmap
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.302.1">
     In
    </span>
    <a href="B22229_06.xhtml#_idTextAnchor148">
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.303.1">
        Chapter 6
       </span>
      </em>
     </span>
    </a>
    <span class="koboSpan" id="kobo.304.1">
     , you learned how to use
    </span>
    <a id="_idIndexMarker587">
    </a>
    <span class="koboSpan" id="kobo.305.1">
     Bash for very basic port scans.
    </span>
    <span class="koboSpan" id="kobo.305.2">
     Those concepts are useful in situations where you’re in a limited network
    </span>
    <a id="_idIndexMarker588">
    </a>
    <span class="koboSpan" id="kobo.306.1">
     environment and cannot install standard scanning tools such as Nmap.
    </span>
    <span class="koboSpan" id="kobo.306.2">
     However, a pure Bash port scanner would not be my first choice of tool when performing network pentesting scans.
    </span>
    <span class="koboSpan" id="kobo.306.3">
     Here, we’ll start working with Nmap
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.307.1">
      and Masscan.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.308.1">
     The following command is an example of the most basic
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.309.1">
      Nmap scan:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.310.1">
$ nmap 10.2.10.0/24</span></pre>
   <p>
    <span class="koboSpan" id="kobo.311.1">
     Note that the IP address in your GOAD environment may differ from the examples
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.312.1">
      shown here.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.313.1">
     The following figure shows the partial output from
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.314.1">
      this scan:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer112">
     <span class="koboSpan" id="kobo.315.1">
      <img alt="Figure 10.5 – Partial output from a basic Nmap TCP port scan" src="image/B22229_10_05.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.316.1">
     Figure 10.5 – Partial output from a basic Nmap TCP port scan
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.317.1">
     Notice that we have very
    </span>
    <a id="_idIndexMarker589">
    </a>
    <span class="koboSpan" id="kobo.318.1">
     basic information shown in the preceding figure.
    </span>
    <span class="koboSpan" id="kobo.318.2">
     The output for each port lists services that are the defaults for the port number.
    </span>
    <span class="koboSpan" id="kobo.318.3">
     Since we didn’t use any other scan flags, Nmap used a
    </span>
    <a id="_idIndexMarker590">
    </a>
    <span class="koboSpan" id="kobo.319.1">
     connect scan (
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.320.1">
      -sT
     </span>
    </strong>
    <span class="koboSpan" id="kobo.321.1">
     ) by default, and didn’t perform service fingerprinting, and the output wasn’t saved to
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.322.1">
      a file.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.323.1">
     The previous scan showed a default TCP scan.
    </span>
    <span class="koboSpan" id="kobo.323.2">
     To scan UDP ports, use the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.324.1">
      -sU
     </span>
    </strong>
    <span class="koboSpan" id="kobo.325.1">
     flag,
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.326.1">
      as follows:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.327.1">
$ sudo nmap -sU 10.2.10.0/24</span></pre>
   <p>
    <span class="koboSpan" id="kobo.328.1">
     The output from the UDP scan can be seen in the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.329.1">
      following figure:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer113">
     <span class="koboSpan" id="kobo.330.1">
      <img alt="Figure 10.6 – Partial output from a basic UDP port scan with Nmap" src="image/B22229_10_06.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.331.1">
     Figure 10.6 – Partial output from a basic UDP port scan with Nmap
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.332.1">
     We’ll explore more
    </span>
    <a id="_idIndexMarker591">
    </a>
    <span class="koboSpan" id="kobo.333.1">
     advanced usage in the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.334.1">
      next
     </span>
    </span>
    <span class="No-Break">
     <a id="_idIndexMarker592">
     </a>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.335.1">
      section.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-168">
    <a id="_idTextAnchor275">
    </a>
    <span class="koboSpan" id="kobo.336.1">
     Fast network scanning with Masscan
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.337.1">
     Another popular port
    </span>
    <a id="_idIndexMarker593">
    </a>
    <span class="koboSpan" id="kobo.338.1">
     scanner is Masscan, which is an extremely fast port scanner.
    </span>
    <span class="koboSpan" id="kobo.338.2">
     It can scan the whole internet in a matter
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.339.1">
      of minutes.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.340.1">
     Nmap is more full-featured than
    </span>
    <a id="_idIndexMarker594">
    </a>
    <span class="koboSpan" id="kobo.341.1">
     Masscan; however, Masscan has the capability to perform scans much faster by including a
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.342.1">
      --rate
     </span>
    </strong>
    <span class="koboSpan" id="kobo.343.1">
     option.
    </span>
    <span class="koboSpan" id="kobo.343.2">
     Yes, Nmap also has the ability to tweak scan speed; however, Masscan can be much faster.
    </span>
    <span class="koboSpan" id="kobo.343.3">
     Be careful with this option as you may overwhelm network devices such as routers and switches.
    </span>
    <span class="koboSpan" id="kobo.343.4">
     When you have a
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.344.1">
      kickoff call
     </span>
    </em>
    <span class="koboSpan" id="kobo.345.1">
     with project stakeholders before the pentest starts, you should ask whether you will be scanning through outdated network devices that may not be able to withstand
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.346.1">
      high throughput.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.347.1">
     A basic Masscan example can be found in the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.348.1">
      following figure:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer114">
     <span class="koboSpan" id="kobo.349.1">
      <img alt="Figure 10.7 – Partial output of an example Masscan scan" src="image/B22229_10_07.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.350.1">
     Figure 10.7 – Partial output of an example Masscan scan
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.351.1">
     On very large networks, I’ll frequently
    </span>
    <a id="_idIndexMarker595">
    </a>
    <span class="koboSpan" id="kobo.352.1">
     use Masscan to discover a list of live hosts, which are then fed to another more advanced scan.
    </span>
    <span class="koboSpan" id="kobo.352.2">
     The following
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.353.1">
      masscan
     </span>
    </strong>
    <span class="koboSpan" id="kobo.354.1">
     command is what I use to discover
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.355.1">
      live hosts:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.356.1">
$ sudo masscan -p 22,445 --open -oL [outputfile] -iL [inputfile] --rate=5000</span></pre>
   <p>
    <span class="koboSpan" id="kobo.357.1">
     Let’s break this down to
    </span>
    <a id="_idIndexMarker596">
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.358.1">
      understand it:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.359.1">
       -p 22,445
      </span>
     </strong>
     <span class="koboSpan" id="kobo.360.1">
      : On an internal network, every Linux host will have port
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.361.1">
       22
      </span>
     </strong>
     <span class="koboSpan" id="kobo.362.1">
      (SSH) exposed, and every Windows host will have port
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.363.1">
       445
      </span>
     </strong>
     <span class="koboSpan" id="kobo.364.1">
      (
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.365.1">
       SMB) exposed.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.366.1">
       --open
      </span>
     </strong>
     <span class="koboSpan" id="kobo.367.1">
      : We specify
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.368.1">
       open
      </span>
     </strong>
     <span class="koboSpan" id="kobo.369.1">
      because don’t want to see closed or
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.370.1">
       filtered ports.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.371.1">
       -oL [outputfile]
      </span>
     </strong>
     <span class="koboSpan" id="kobo.372.1">
      : We specify the name of the file to save the results in list format.
     </span>
     <span class="koboSpan" id="kobo.372.2">
      Other possible output formats include JSON, NDJSON, Grepable, Binary, XML,
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.373.1">
       and Unicorn.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.374.1">
       -iL [inputfile]
      </span>
     </strong>
     <span class="koboSpan" id="kobo.375.1">
      : We specify the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.376.1">
       scope.txt
      </span>
     </strong>
     <span class="koboSpan" id="kobo.377.1">
      file containing the networks
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.378.1">
       in scope.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.379.1">
       --rate=5000
      </span>
     </strong>
     <span class="koboSpan" id="kobo.380.1">
      : This sends TCP
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.381.1">
       SYN
      </span>
     </em>
     <span class="koboSpan" id="kobo.382.1">
      packets at a rate of 5,000 packets
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.383.1">
       per second.
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.384.1">
     On my lab network running GOAD and Vulhub, the output of my scan looks like the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.385.1">
      following figure:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer115">
     <span class="koboSpan" id="kobo.386.1">
      <img alt="Figure 10.8 – Masscan host discovery output file content" src="image/B22229_10_08.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.387.1">
     Figure 10.8 – Masscan host discovery output file content
    </span>
   </p>
   <h2 id="_idParaDest-169">
    <a id="_idTextAnchor276">
    </a>
    <span class="koboSpan" id="kobo.388.1">
     Processing scan results with Bash
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.389.1">
     To display only live
    </span>
    <a id="_idIndexMarker597">
    </a>
    <span class="koboSpan" id="kobo.390.1">
     hosts, enter the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.391.1">
      following
     </span>
    </span>
    <span class="No-Break">
     <a id="_idIndexMarker598">
     </a>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.392.1">
      command:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.393.1">
$ awk '$1 == "open" { print $4 }' masscan.lst | sort -uV &gt; livehosts.txt</span></pre>
   <p>
    <span class="koboSpan" id="kobo.394.1">
     Here is
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.395.1">
      the explanation:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.396.1">
       '
      </span>
     </strong>
     <span class="koboSpan" id="kobo.397.1">
      : A single quote character starts and ends the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.398.1">
       awk
      </span>
     </strong>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.399.1">
       command block.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.400.1">
       $1 == "open"
      </span>
     </strong>
     <span class="koboSpan" id="kobo.401.1">
      : The first column is the word
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.402.1">
       open
      </span>
     </strong>
     <span class="koboSpan" id="kobo.403.1">
      , as seen in
     </span>
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.404.1">
        Figure 10
       </span>
      </em>
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.405.1">
       .8
      </span>
     </em>
     <span class="koboSpan" id="kobo.406.1">
      .
     </span>
     <span class="koboSpan" id="kobo.406.2">
      Remember from
     </span>
     <a href="B22229_04.xhtml#_idTextAnchor073">
      <span class="No-Break">
       <em class="italic">
        <span class="koboSpan" id="kobo.407.1">
         Chapter 4
        </span>
       </em>
      </span>
     </a>
     <span class="koboSpan" id="kobo.408.1">
      that
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.409.1">
       awk
      </span>
     </strong>
     <span class="koboSpan" id="kobo.410.1">
      splits columns on whitespace by default, which includes both spaces and tabs.
     </span>
     <span class="koboSpan" id="kobo.410.2">
      If the columns were separated by tabs, this command would still work.
     </span>
     <span class="koboSpan" id="kobo.410.3">
      Otherwise, include the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.411.1">
       -F
      </span>
     </strong>
     <span class="koboSpan" id="kobo.412.1">
      option to specify a different
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.413.1">
       field separator.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.414.1">
       { print $4 }
      </span>
     </strong>
     <span class="koboSpan" id="kobo.415.1">
      : Print the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.416.1">
       fourth column.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.417.1">
       masscan.lst
      </span>
     </strong>
     <span class="koboSpan" id="kobo.418.1">
      : The Masscan output file that we want to parse using
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.419.1">
       this command.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.420.1">
       | sort -uV
      </span>
     </strong>
     <span class="koboSpan" id="kobo.421.1">
      : We pipe the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.422.1">
       awk
      </span>
     </strong>
     <span class="koboSpan" id="kobo.423.1">
      command output to sort, specifying the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.424.1">
       sort
      </span>
     </strong>
     <span class="koboSpan" id="kobo.425.1">
      options unique (
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.426.1">
       -u
      </span>
     </strong>
     <span class="koboSpan" id="kobo.427.1">
      ) and
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.428.1">
       version (
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.429.1">
        -V
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.430.1">
       ).
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.431.1">
       &gt; livehosts.txt
      </span>
     </strong>
     <span class="koboSpan" id="kobo.432.1">
      : We redirect the output of the preceding commands from
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.433.1">
       stdout
      </span>
     </strong>
     <span class="koboSpan" id="kobo.434.1">
      to
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.435.1">
       a file.
      </span>
     </span>
    </li>
   </ul>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.436.1">
     Tip
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.437.1">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.438.1">
      sort -V
     </span>
    </strong>
    <span class="koboSpan" id="kobo.439.1">
     (version) option is useful for sorting IP addresses and
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.440.1">
      version numbers.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.441.1">
     The output looks like the following
    </span>
    <a id="_idIndexMarker599">
    </a>
    <span class="koboSpan" id="kobo.442.1">
     if you remove the
    </span>
    <a id="_idIndexMarker600">
    </a>
    <span class="koboSpan" id="kobo.443.1">
     redirect to a file and print
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.444.1">
      to
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.445.1">
       stdout
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.446.1">
      :
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer116">
     <span class="koboSpan" id="kobo.447.1">
      <img alt="Figure 10.9 – Our unique sorted list of live IP addresses" src="image/B22229_10_09.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.448.1">
     Figure 10.9 – Our unique sorted list of live IP addresses
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.449.1">
     Comparing the output in
    </span>
    <span class="No-Break">
     <em class="italic">
      <span class="koboSpan" id="kobo.450.1">
       Figure 10
      </span>
     </em>
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.451.1">
      .8
     </span>
    </em>
    <span class="koboSpan" id="kobo.452.1">
     (unsorted) to
    </span>
    <span class="No-Break">
     <em class="italic">
      <span class="koboSpan" id="kobo.453.1">
       Figure 10
      </span>
     </em>
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.454.1">
      .9
     </span>
    </em>
    <span class="koboSpan" id="kobo.455.1">
     (sorted), you can see how the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.456.1">
      sort -V
     </span>
    </strong>
    <span class="koboSpan" id="kobo.457.1">
     option is useful for sorting version numbers, IP addresses, or any string that is a combination of numbers separated
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.458.1">
      by periods.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.459.1">
     Now, you have a list of live hosts, saving you valuable time when scanning very
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.460.1">
      large networks.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-170">
    <a id="_idTextAnchor277">
    </a>
    <span class="koboSpan" id="kobo.461.1">
     Conclusion
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.462.1">
     This wraps up the section on the fundamentals of network pentesting with Bash.
    </span>
    <span class="koboSpan" id="kobo.462.2">
     The foundation created by the concepts in this fundamental section, plus the previous work we covered in
    </span>
    <a href="B22229_06.xhtml#_idTextAnchor148">
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.463.1">
        Chapter 6
       </span>
      </em>
     </span>
    </a>
    <span class="koboSpan" id="kobo.464.1">
     on networking and basic port scans, will be used in the next section to learn about more advanced
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.465.1">
      scanning techniques.
     </span>
    </span>
   </p>
   <h1 id="_idParaDest-171">
    <a id="_idTextAnchor278">
    </a>
    <span class="koboSpan" id="kobo.466.1">
     Advanced network scanning techniques in Bash
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.467.1">
     This section will go more
    </span>
    <a id="_idIndexMarker601">
    </a>
    <span class="koboSpan" id="kobo.468.1">
     in depth, demonstrating some of the most common advanced options of Nmap.
    </span>
    <span class="koboSpan" id="kobo.468.2">
     Then, we’ll follow up with a primer on parsing the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.469.1">
      report output.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.470.1">
     This is the Nmap scan command I use most of
    </span>
    <a id="_idTextAnchor279">
    </a>
    <a id="_idTextAnchor280">
    </a>
    <span class="koboSpan" id="kobo.471.1">
     ten for
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.472.1">
      network pentesting:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.473.1">
$ sudo nmap -sS -sV -sC -p 21,22,23,25,53,80,81,88,110,111,123,137-139,161,389,443,445,500,512,513,548,623-624,1099,1241,1433-1434,1521,2049,2483-2484,3268,3269,3306,3389,4333,4786,4848,5432,5800,5900,5901,5985,5986,6000,6001,7001,8000,8080,8181,8443,10000,16992-16993,27017,32764 --open -oA [output file] -iL [input file] --exclude-file [exclude file]</span></pre>
   <p>
    <span class="koboSpan" id="kobo.474.1">
     Here is
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.475.1">
      the explanation:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.476.1">
       -sS
      </span>
     </strong>
     <span class="koboSpan" id="kobo.477.1">
      :
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.478.1">
       SYN
      </span>
     </em>
     <span class="koboSpan" id="kobo.479.1">
      scan, or half-open scan.
     </span>
     <span class="koboSpan" id="kobo.479.2">
      This sends only the first part of the TCP handshake and scans much faster than the default connect (
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.480.1">
       -sT
      </span>
     </strong>
     <span class="koboSpan" id="kobo.481.1">
      ) scan, which completes the TCP
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.482.1">
       three-way handshake.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.483.1">
       -sV
      </span>
     </strong>
     <span class="koboSpan" id="kobo.484.1">
      : A version scan fingerprints the service name and version instead of the default, which only prints the default service name associated with the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.485.1">
       port number.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.486.1">
       -sC
      </span>
     </strong>
     <span class="koboSpan" id="kobo.487.1">
      : Runs Nmap scripts against all open ports.
     </span>
     <span class="koboSpan" id="kobo.487.2">
      The output of these scripts frequently reveals important or even
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.488.1">
       exploitable information.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.489.1">
       -p [port list]
      </span>
     </strong>
     <span class="koboSpan" id="kobo.490.1">
      : The list of ports to scan.
     </span>
     <span class="koboSpan" id="kobo.490.2">
      These are port numbers that I have found to be the most common exploitable ports in my experience.
     </span>
     <span class="koboSpan" id="kobo.490.3">
      If you’re scanning a single host or small number of hosts, or you absolutely must find every open port, use
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.491.1">
       -p-
      </span>
     </strong>
     <span class="koboSpan" id="kobo.492.1">
      instead, which is shorthand for
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.493.1">
       all ports.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.494.1">
       --open
      </span>
     </strong>
     <span class="koboSpan" id="kobo.495.1">
      : Only record open ports; don’t show closed or filtered ports in
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.496.1">
       the output.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.497.1">
       -oA [output file]
      </span>
     </strong>
     <span class="koboSpan" id="kobo.498.1">
      : The
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.499.1">
       A
      </span>
     </strong>
     <span class="koboSpan" id="kobo.500.1">
      option equates to all formats.
     </span>
     <span class="koboSpan" id="kobo.500.2">
      If you named the output file
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.501.1">
       nmapquick
      </span>
     </strong>
     <span class="koboSpan" id="kobo.502.1">
      , you would find the following three output files in the current directory once the scan completes:
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.503.1">
       nmapquick.nmap
      </span>
     </strong>
     <span class="koboSpan" id="kobo.504.1">
      ,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.505.1">
       nmapquick.gnmap
      </span>
     </strong>
     <span class="koboSpan" id="kobo.506.1">
      ,
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.507.1">
       and
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.508.1">
        nmapquick.xml
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.509.1">
       .
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.510.1">
       -iL [input file]
      </span>
     </strong>
     <span class="koboSpan" id="kobo.511.1">
      : The file containing the list of IP addresses, network addresses, or hostnames
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.512.1">
       to scan.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.513.1">
       --exclude-file [exclude file]
      </span>
     </strong>
     <span class="koboSpan" id="kobo.514.1">
      : The file containing a list of IP addresses, network addresses, or hostnames to exclude from your scan.
     </span>
     <span class="koboSpan" id="kobo.514.2">
      See the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.515.1">
       Rules of Engagement
      </span>
     </em>
     <span class="koboSpan" id="kobo.516.1">
      document for your pentest to find a list of any hosts to
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.517.1">
       be excluded.
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.518.1">
     In the scan output, we
    </span>
    <a id="_idIndexMarker602">
    </a>
    <span class="koboSpan" id="kobo.519.1">
     examine one of the hosts in the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.520.1">
      following figure:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer117">
     <span class="koboSpan" id="kobo.521.1">
      <img alt="Figure 10.10 – The output of our scan on one host" src="image/B22229_10_10.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.522.1">
     Figure 10.10 – The output of our scan on one host
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.523.1">
     The Nmap script output can be seen by the dashed lines and the output they contain in the figure.
    </span>
    <span class="koboSpan" id="kobo.523.2">
     This reveals the hostname and service versions.
    </span>
    <span class="koboSpan" id="kobo.523.3">
     Additionally, we can guess that this is an Active Directory domain controller because it’s running Microsoft Windows, and ports
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.524.1">
      53
     </span>
    </strong>
    <span class="koboSpan" id="kobo.525.1">
     ,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.526.1">
      88
     </span>
    </strong>
    <span class="koboSpan" id="kobo.527.1">
     ,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.528.1">
      3268
     </span>
    </strong>
    <span class="koboSpan" id="kobo.529.1">
     , and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.530.1">
      3269
     </span>
    </strong>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.531.1">
      are open.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.532.1">
     Scanning can be a trade-off between fast and thorough.
    </span>
    <span class="koboSpan" id="kobo.532.2">
     For example, in the scan that we ran last, which specified a limited number of common ports, the output for host
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.533.1">
      10.2.10.1
     </span>
    </strong>
    <span class="koboSpan" id="kobo.534.1">
     shows one
    </span>
    <a id="_idIndexMarker603">
    </a>
    <span class="koboSpan" id="kobo.535.1">
     open port, as seen in the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.536.1">
      following figure:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer118">
     <span class="koboSpan" id="kobo.537.1">
      <img alt="Figure 10.11 – Nmap scan output using a limited number of common ports" src="image/B22229_10_11.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.538.1">
     Figure 10.11 – Nmap scan output using a limited number of common ports
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.539.1">
     If we rescan this host using the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.540.1">
      -p-
     </span>
    </strong>
    <span class="koboSpan" id="kobo.541.1">
     (all ports) option, we find that the host actually has seven open ports, some running vulnerable applications.
    </span>
    <span class="koboSpan" id="kobo.541.2">
     This example illustrates the difference between fast and thorough scanning.
    </span>
    <span class="koboSpan" id="kobo.541.3">
     What I normally do when testing small networks is scan all ports.
    </span>
    <span class="koboSpan" id="kobo.541.4">
     If I’m testing a large network, I run one fast scan specifying a limited number of ports, and while I’m working through that scan result, I start a second scan running targeting all ports, which I expect to take a day or more
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.542.1">
      to complete.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.543.1">
     Now that you have a firm grasp of different port scanning techniques, let’s move on to the next section and explore various exploitable
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.544.1">
      network protocols.
     </span>
    </span>
   </p>
   <h1 id="_idParaDest-172">
    <a id="_idTextAnchor281">
    </a>
    <span class="koboSpan" id="kobo.545.1">
     Enumerating network services and protocols using Bash
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.546.1">
     I perform a network packet
    </span>
    <a id="_idIndexMarker604">
    </a>
    <span class="koboSpan" id="kobo.547.1">
     capture on every internal network pentest.
    </span>
    <span class="koboSpan" id="kobo.547.2">
     I’m looking for the default
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.548.1">
      Hot Standby Router Protocol
     </span>
    </strong>
    <span class="koboSpan" id="kobo.549.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.550.1">
      HSRP
     </span>
    </strong>
    <span class="koboSpan" id="kobo.551.1">
     ) default
    </span>
    <a id="_idIndexMarker605">
    </a>
    <span class="koboSpan" id="kobo.552.1">
     password of
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.553.1">
      'cisco'
     </span>
    </strong>
    <span class="koboSpan" id="kobo.554.1">
     , DHCPv6 discovering broadcasts without a corresponding offer, and broadcast or multicast protocols such as LLMNR, NBT-NS, and MDNS, which can yield
    </span>
    <a id="_idIndexMarker606">
    </a>
    <span class="koboSpan" id="kobo.555.1">
     password hashes or be relayed to crack into
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.556.1">
      other systems.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.557.1">
     The following code can be found on this chapter’s GitHub page
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.558.1">
      as
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.559.1">
       packetcap.sh
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.560.1">
      :
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.561.1">
#!/usr/bin/env bash
if [ "$#" -ne 1 ]; then
  echo "You must specify a network adapter as an argument."
</span><span class="koboSpan" id="kobo.561.2">  echo "Usage: $0 [network adapter]"
  exit 1
fi</span></pre>
   <p>
    <span class="koboSpan" id="kobo.562.1">
     The first block of code is
    </span>
    <a id="_idIndexMarker607">
    </a>
    <span class="koboSpan" id="kobo.563.1">
     the familiar shebang, followed by an
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.564.1">
      if
     </span>
    </strong>
    <span class="koboSpan" id="kobo.565.1">
     statement
    </span>
    <a id="_idIndexMarker608">
    </a>
    <span class="koboSpan" id="kobo.566.1">
     that prints usage information and exits if exactly one argument is
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.567.1">
      not provided.
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.568.1">
echo "[+] Please wait; capturing network traffic on $1 for 2.5 minutes."
</span><span class="koboSpan" id="kobo.568.2">sudo timeout 150 tcpdump -i "$1" -s0 -w packetcapture.pcap</span></pre>
   <p>
    <span class="koboSpan" id="kobo.569.1">
     This block of code lets the user know what’s happening before running tcpdump for two and a half minutes.
    </span>
    <span class="koboSpan" id="kobo.569.2">
     After
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.570.1">
      sudo
     </span>
    </strong>
    <span class="koboSpan" id="kobo.571.1">
     , the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.572.1">
      timeout 150
     </span>
    </strong>
    <span class="koboSpan" id="kobo.573.1">
     command preceding
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.574.1">
      tcpdump
     </span>
    </strong>
    <span class="koboSpan" id="kobo.575.1">
     runs
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.576.1">
      tcpdump
     </span>
    </strong>
    <span class="koboSpan" id="kobo.577.1">
     for 150 seconds
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.578.1">
      and quits.
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.579.1">
echo "[+] Testing for default HSRP password 'cisco'..."
</span><span class="koboSpan" id="kobo.579.2">tcpdump -XX -r packetcapture.pcap 'udp port 1985 or udp port 2029' | grep -B4 cisco</span></pre>
   <p>
    <span class="koboSpan" id="kobo.580.1">
     This block of code detects plaintext HSRP broadcasts using the default
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.581.1">
      'cisco'
     </span>
    </strong>
    <span class="koboSpan" id="kobo.582.1">
     password.
    </span>
    <span class="koboSpan" id="kobo.582.2">
     If you have this password, you
    </span>
    <a id="_idIndexMarker609">
    </a>
    <span class="koboSpan" id="kobo.583.1">
     can poison the HSRP election process and take over as the default router, and execute a
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.584.1">
      Man-in-the-Middle
     </span>
    </strong>
    <span class="koboSpan" id="kobo.585.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.586.1">
      MITM
     </span>
    </strong>
    <span class="koboSpan" id="kobo.587.1">
     ) attack on
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.588.1">
      all traffic.
     </span>
    </span>
   </p>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.589.1">
     Tip
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.590.1">
     If you detect the default HSRP password in use on a network, I caution you to not attempt to execute an MITM attack on it.
    </span>
    <span class="koboSpan" id="kobo.590.2">
     If you’re not on-site with the system running the attack and you lose your network connection, you may cause a denial of service to the network and you won’t be there to stop it.
    </span>
    <span class="koboSpan" id="kobo.590.3">
     This is very risky to exploit.
    </span>
    <span class="koboSpan" id="kobo.590.4">
     It’s best to report it and
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.591.1">
      move on.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.592.1">
     In the next code block, we start
    </span>
    <a id="_idIndexMarker610">
    </a>
    <span class="koboSpan" id="kobo.593.1">
     testing for
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.594.1">
      IP version 6
     </span>
    </strong>
    <span class="koboSpan" id="kobo.595.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.596.1">
      IPv6
     </span>
    </strong>
    <span class="koboSpan" id="kobo.597.1">
     )
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.598.1">
      network traffic:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.599.1">
echo "[+] Testing for DHCPv6."
</span><span class="koboSpan" id="kobo.599.2">echo "[+] If detected, try mitm6!"
</span><span class="koboSpan" id="kobo.599.3">tcpdump -r packetcapture.pcap '(udp port 546 or 547) or icmp6'
sudo rm packetcapture.pcap</span></pre>
   <p>
    <span class="koboSpan" id="kobo.600.1">
     This block of code tests for
    </span>
    <a id="_idIndexMarker611">
    </a>
    <span class="koboSpan" id="kobo.601.1">
     DHCPv6 traffic.
    </span>
    <span class="koboSpan" id="kobo.601.2">
     If you see DHCPv6 discover
    </span>
    <a id="_idIndexMarker612">
    </a>
    <span class="koboSpan" id="kobo.602.1">
     broadcasts without a responding offer, the network is likely to be vulnerable to an attack where you can run the mitm6 tool and capture
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.603.1">
      password hashes.
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.604.1">
echo "[+] Please wait; running Responder for 5 minutes."
</span><span class="koboSpan" id="kobo.604.2">echo "[+] If hashes are captured, crack them or run Responder again with impacket-ntlmrelayx to relay."
</span><span class="koboSpan" id="kobo.604.3">responder=$(sudo timeout 300 responder -I "$1")
cat /usr/share/responder/logs/Responder-Session.log</span></pre>
   <p>
    <span class="koboSpan" id="kobo.605.1">
     This block of code runs the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.606.1">
      Responder
     </span>
    </em>
    <span class="koboSpan" id="kobo.607.1">
     tool in a subshell so that you won’t see the output.
    </span>
    <span class="koboSpan" id="kobo.607.2">
     Then, it prints anything in the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.608.1">
      Responder-Session
     </span>
    </strong>
    <span class="koboSpan" id="kobo.609.1">
     log.
    </span>
    <span class="koboSpan" id="kobo.609.2">
     You may see password hashes or plaintext passwords in
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.610.1">
      the output.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.611.1">
     The following figures show the script in action.
    </span>
    <span class="koboSpan" id="kobo.611.2">
     This shows the start of the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.612.1">
      script output:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer119">
     <span class="koboSpan" id="kobo.613.1">
      <img alt="Figure 10.12 – Starting the network sniffer script" src="image/B22229_10_12.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.614.1">
     Figure 10.12 – Starting the network sniffer script
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.615.1">
     Further down in the output, you see password hashes printed to the screen.
    </span>
    <span class="koboSpan" id="kobo.615.2">
     This is an NTLMv2 password hash, which you should attempt to crack using
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.616.1">
      hashcat
     </span>
    </strong>
    <span class="koboSpan" id="kobo.617.1">
     .
    </span>
    <span class="koboSpan" id="kobo.617.2">
     You can also reconfigure
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.618.1">
      Responder
     </span>
    </strong>
    <span class="koboSpan" id="kobo.619.1">
     and run it again along with
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.620.1">
      impacket-ntlmrelayx
     </span>
    </strong>
    <span class="koboSpan" id="kobo.621.1">
     to relay to other systems to run commands or
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.622.1">
      dump credentials.
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer120">
     <span class="koboSpan" id="kobo.623.1">
      <img alt="Figure 10.13 – Responder captures a password hash" src="image/B22229_10_13.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.624.1">
     Figure 10.13 – Responder captures a password hash
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.625.1">
     Next, let’s attempt to crack them
    </span>
    <a id="_idIndexMarker613">
    </a>
    <span class="koboSpan" id="kobo.626.1">
     using
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.627.1">
      hashcat
     </span>
    </strong>
    <span class="koboSpan" id="kobo.628.1">
     .
    </span>
    <span class="koboSpan" id="kobo.628.2">
     Before running the following command, copy and save
    </span>
    <a id="_idIndexMarker614">
    </a>
    <span class="koboSpan" id="kobo.629.1">
     those hashes to a file.
    </span>
    <span class="koboSpan" id="kobo.629.2">
     Next, run
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.630.1">
      hashcat
     </span>
    </strong>
    <span class="koboSpan" id="kobo.631.1">
     as shown in the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.632.1">
      following command:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.633.1">
$ sudo hashcat -m 5700 hashes.txt /usr/share/wordlists/rockyou.txt.gz</span></pre>
   <p>
    <span class="koboSpan" id="kobo.634.1">
     The following figure shows that we cracked one of the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.635.1">
      password hashes!
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer121">
     <span class="koboSpan" id="kobo.636.1">
      <img alt="Figure 10.14 – Hashcat is used to crack an NTLMv2 password hash" src="image/B22229_10_14.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.637.1">
     Figure 10.14 – Hashcat is used to crack an NTLMv2 password hash
    </span>
   </p>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.638.1">
     Tip
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.639.1">
     You aren’t limited to only cracking password hashes from these protocols; you can also relay them.
    </span>
    <span class="koboSpan" id="kobo.639.2">
     Search the internet for
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.640.1">
      relay LLMNR
     </span>
    </strong>
    <span class="koboSpan" id="kobo.641.1">
     to find out more about
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.642.1">
      the subject.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.643.1">
     Don’t overlook these protocols on your network.
    </span>
    <span class="koboSpan" id="kobo.643.2">
     While they aren’t listening services that you can point an exploit at and get a shell, they are
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.644.1">
      dangerous default
     </span>
    </em>
    <span class="koboSpan" id="kobo.645.1">
     protocols that you’re likely to find broadcast on any Windows domain, and they are usually the fastest way to
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.646.1">
      exploit
     </span>
    </span>
    <span class="No-Break">
     <a id="_idIndexMarker615">
     </a>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.647.1">
      systems.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.648.1">
     In the next
    </span>
    <a id="_idIndexMarker616">
    </a>
    <span class="koboSpan" id="kobo.649.1">
     section, we’ll explore using Bash with vulnerabi
    </span>
    <a id="_idTextAnchor282">
    </a>
    <a id="_idTextAnchor283">
    </a>
    <span class="koboSpan" id="kobo.650.1">
     lity assessment and
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.651.1">
      exploitation tools.
     </span>
    </span>
   </p>
   <h1 id="_idParaDest-173">
    <a id="_idTextAnchor284">
    </a>
    <span class="koboSpan" id="kobo.652.1">
     Infrastructure vulnerability assessment with Bash
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.653.1">
     Assessing infrastructure vulnerabilities is a critical step in maintaining network security.
    </span>
    <span class="koboSpan" id="kobo.653.2">
     With Bash, we can leverage powerful tools to automate network host discovery and vulnerability scanning, streamlining the
    </span>
    <a id="_idIndexMarker617">
    </a>
    <span class="koboSpan" id="kobo.654.1">
     assessment process.
    </span>
    <span class="koboSpan" id="kobo.654.2">
     This section covers two essential techniques: identifying network hosts with NetExec and automating vulnerability scans using Greenbone.
    </span>
    <span class="koboSpan" id="kobo.654.3">
     Each technique offers a practical approach to improving your security posture by reducing manual effort while enhancing efficiency and accuracy in
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.655.1">
      detecting vulnerabilities.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-174">
    <a id="_idTextAnchor285">
    </a>
    <span class="koboSpan" id="kobo.656.1">
     Enumerating network hosts with NetExec
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.657.1">
     Starting from an unauthenticated
    </span>
    <a id="_idIndexMarker618">
    </a>
    <span class="koboSpan" id="kobo.658.1">
     perspective, we will examine TCP port
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.659.1">
      445
     </span>
    </strong>
    <span class="koboSpan" id="kobo.660.1">
     since it’s historically had a lot of vulnerabilities
    </span>
    <a id="_idIndexMarker619">
    </a>
    <span class="koboSpan" id="kobo.661.1">
     and can yield a lot of information.
    </span>
    <span class="koboSpan" id="kobo.661.2">
     We will use the NetExec tool to enumerate
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.662.1">
      network hosts.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.663.1">
     First, let’s attempt to use
    </span>
    <a id="_idIndexMarker620">
    </a>
    <span class="koboSpan" id="kobo.664.1">
     an SMB null session to enumerate SMB shares.
    </span>
    <span class="koboSpan" id="kobo.664.2">
     Run the following command, replacing the network address with the a
    </span>
    <a id="_idTextAnchor286">
    </a>
    <a id="_idTextAnchor287">
    </a>
    <a id="_idTextAnchor288">
    </a>
    <span class="koboSpan" id="kobo.665.1">
     ppropriate address for your
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.666.1">
      lab instance:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.667.1">
$ netexec smb 10.2.10.0/24 -u a -p '' --shares</span></pre>
   <p>
    <span class="koboSpan" id="kobo.668.1">
     Here is
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.669.1">
      the explanation:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.670.1">
       netexec smb
      </span>
     </strong>
     <span class="koboSpan" id="kobo.671.1">
      : Here, we specify the protocol for NetExec to use.
     </span>
     <span class="koboSpan" id="kobo.671.2">
      The
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.672.1">
       netexec
      </span>
     </strong>
     <span class="koboSpan" id="kobo.673.1">
      command has multi-protocol support,
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.674.1">
       including SMB.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.675.1">
       10.2.10.0/24
      </span>
     </strong>
     <span class="koboSpan" id="kobo.676.1">
      : The target goes after
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.677.1">
       netexec
      </span>
     </strong>
     <span class="koboSpan" id="kobo.678.1">
      and the protocol.
     </span>
     <span class="koboSpan" id="kobo.678.2">
      The target can be an IP address, hostname, network address, or a file containing targets (one
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.679.1">
       per line).
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.680.1">
       -u a -p ''
      </span>
     </strong>
     <span class="koboSpan" id="kobo.681.1">
      : We specify a random username (
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.682.1">
       a
      </span>
     </strong>
     <span class="koboSpan" id="kobo.683.1">
      ), followed by a blank
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.684.1">
       password (
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.685.1">
        ''
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.686.1">
       ).
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.687.1">
       --shares
      </span>
     </strong>
     <span class="koboSpan" id="kobo.688.1">
      : This is a
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.689.1">
       netexec
      </span>
     </strong>
     <span class="koboSpan" id="kobo.690.1">
      command to enumerate
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.691.1">
       SMB shares.
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.692.1">
     The following figure shows
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.693.1">
      the
     </span>
    </span>
    <span class="No-Break">
     <a id="_idIndexMarker621">
     </a>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.694.1">
      output:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer122">
     <span class="koboSpan" id="kobo.695.1">
      <img alt="Figure 10.15 – Performing SMB null session SMB share enumeration with NetExec." src="image/B22229_10_15.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.696.1">
     Figure 10.15 – Performing SMB null session SMB share enumeration with NetExec.
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.697.1">
     Note that this is a cropped
    </span>
    <a id="_idIndexMarker622">
    </a>
    <span class="koboSpan" id="kobo.698.1">
     screenshot and doesn’t show the hostname or IP address of each system.
    </span>
    <span class="koboSpan" id="kobo.698.2">
     Without
    </span>
    <a id="_idIndexMarker623">
    </a>
    <span class="koboSpan" id="kobo.699.1">
     cropping the image, the text would be too small to read.
    </span>
    <span class="koboSpan" id="kobo.699.2">
     Notice where we have read or write permissions in the preceding figure.
    </span>
    <span class="koboSpan" id="kobo.699.3">
     In this case, I recommend taking the time to connect to these SMB shares and look for interesting information, such as passwords
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.700.1">
      in files.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.701.1">
     Next, let’s attempt to use an SMB null session to enumerate users.
    </span>
    <span class="koboSpan" id="kobo.701.2">
     Run the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.702.1">
      following command:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.703.1">
$ netexec smb 10.2.10.0/24 -u a -p '' --users</span></pre>
   <p>
    <span class="koboSpan" id="kobo.704.1">
     The only difference between this and the previous command is we’ve changed shares (
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.705.1">
      --shares
     </span>
    </strong>
    <span class="koboSpan" id="kobo.706.1">
     ) to users (
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.707.1">
      --users
     </span>
    </strong>
    <span class="koboSpan" id="kobo.708.1">
     ).
    </span>
    <span class="koboSpan" id="kobo.708.2">
     We check the output and see we had no luck enumerating users.
    </span>
    <span class="koboSpan" id="kobo.708.3">
     Before giving up, let’s r
    </span>
    <a id="_idTextAnchor289">
    </a>
    <a id="_idTextAnchor290">
    </a>
    <span class="koboSpan" id="kobo.709.1">
     evise the command as follows and
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.710.1">
      try again:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.711.1">
$ netexec smb 10.2.10.0/24 -u '' -p '' --users</span></pre>
   <p>
    <span class="koboSpan" id="kobo.712.1">
     Here, instead of specifying a username, we’ve used a
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.713.1">
      blank username.
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer123">
     <span class="koboSpan" id="kobo.714.1">
      <img alt="Figure 10.16 – Using an SMB null session to list domain users" src="image/B22229_10_16.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.715.1">
     Figure 10.16 – Using an SMB null session to list domain users
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.716.1">
     So why did one method of specifying an invalid username fail and the other succeed?
    </span>
    <span class="koboSpan" id="kobo.716.2">
     Without going too far off the
    </span>
    <a id="_idIndexMarker624">
    </a>
    <span class="koboSpan" id="kobo.717.1">
     track of our Bash topic, it’s due to how the libraries used in this tool authenticate to
    </span>
    <a id="_idIndexMarker625">
    </a>
    <span class="koboSpan" id="kobo.718.1">
     Microsoft Windows SMB shares.
    </span>
    <span class="koboSpan" id="kobo.718.2">
     I’ll leave that as an exercise to you.
    </span>
    <span class="koboSpan" id="kobo.718.3">
     I just want you to be aware of
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.719.1">
      this quirk.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.720.1">
     Using these usernames, you
    </span>
    <a id="_idIndexMarker626">
    </a>
    <span class="koboSpan" id="kobo.721.1">
     can use NetExec to password spray common passwords and maybe you’ll get lucky.
    </span>
    <span class="koboSpan" id="kobo.721.2">
     But do you really need to password spray?
    </span>
    <span class="koboSpan" id="kobo.721.3">
     Go and take another look at
    </span>
    <span class="No-Break">
     <em class="italic">
      <span class="koboSpan" id="kobo.722.1">
       Figure 10
      </span>
     </em>
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.723.1">
      .16
     </span>
    </em>
    <span class="koboSpan" id="kobo.724.1">
     and check the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.725.1">
      Description
     </span>
    </strong>
    <span class="koboSpan" id="kobo.726.1">
     column.
    </span>
    <span class="koboSpan" id="kobo.726.2">
     Do you see the password for Samwell Tarly?
    </span>
    <span class="koboSpan" id="kobo.726.3">
     You would be surprised how often this happens on the average corporate network!
    </span>
    <span class="koboSpan" id="kobo.726.4">
     Many system administrators don’t realize that null sessions and unprivileged users can see this information.
    </span>
    <span class="koboSpan" id="kobo.726.5">
     Let’s test this password, as seen in the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.727.1">
      next figure:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer124">
     <span class="koboSpan" id="kobo.728.1">
      <img alt="Figure 10.17 – Testing credentials with NetExec" src="image/B22229_10_17.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.729.1">
     Figure 10.17 – Testing credentials with NetExec
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.730.1">
     In the preceding figure, we see that the credentials for Samwell Tarly are authenticated to three systems, but this account isn’t an administrator on any of them, otherwise, the output would show
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.731.1">
      Pwn3d!
     </span>
    </strong>
    <span class="koboSpan" id="kobo.732.1">
     .
    </span>
    <span class="koboSpan" id="kobo.732.2">
     There’s a lot more we can do with these credentials.
    </span>
    <span class="koboSpan" id="kobo.732.3">
     I’ll leave it as an exercise for you to
    </span>
    <a id="_idIndexMarker627">
    </a>
    <span class="koboSpan" id="kobo.733.1">
     run
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.734.1">
      netexec
     </span>
    </strong>
    <span class="koboSpan" id="kobo.735.1">
     with the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.736.1">
      --help
     </span>
    </strong>
    <span class="koboSpan" id="kobo.737.1">
     and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.738.1">
      -L
     </span>
    </strong>
    <span class="koboSpan" id="kobo.739.1">
     (list modules) options to explore the
    </span>
    <a id="_idIndexMarker628">
    </a>
    <span class="koboSpan" id="kobo.740.1">
     commands and modules available
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.741.1">
      to you.
     </span>
    </span>
   </p>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.742.1">
     Hint
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.743.1">
     If you’re following along in your own GOAD lab, take a look at the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.744.1">
      petitpotam
     </span>
    </strong>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.745.1">
      SMB module.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.746.1">
     Next, we’ll dive into
    </span>
    <a id="_idIndexMarker629">
    </a>
    <span class="koboSpan" id="kobo.747.1">
     vulnerability scanning from the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.748.1">
      Bash shell.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-175">
    <a id="_idTextAnchor291">
    </a>
    <span class="koboSpan" id="kobo.749.1">
     Automating vulnerability scanning with Greenbone
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.750.1">
     There are a number of top
    </span>
    <a id="_idIndexMarker630">
    </a>
    <span class="koboSpan" id="kobo.751.1">
     vulnerability scan products on the market.
    </span>
    <span class="koboSpan" id="kobo.751.2">
     All have a web interface.
    </span>
    <span class="koboSpan" id="kobo.751.3">
     However, you should learn how to automate these scans from the Bash shell to save yourself valuable time.
    </span>
    <span class="koboSpan" id="kobo.751.4">
     When I
    </span>
    <a id="_idIndexMarker631">
    </a>
    <span class="koboSpan" id="kobo.752.1">
     was responsible for enterprise vulnerability scanning of a global corporation, I used Bash shell to interface
    </span>
    <a id="_idIndexMarker632">
    </a>
    <span class="koboSpan" id="kobo.753.1">
     with the scanner API to automate as much of my job as I could, including gathering statistics for
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.754.1">
      custom reports.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.755.1">
     We will use the Greenbone Community Edition, formerly known as OpenVAS.
    </span>
    <span class="koboSpan" id="kobo.755.2">
     If you want to follow along in your own lab, you should first review the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.756.1">
      Technical requirements
     </span>
    </em>
    <span class="koboSpan" id="kobo.757.1">
     section if you have not already
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.758.1">
      installed Greenbone.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.759.1">
     Create a scan target as shown here, replac
    </span>
    <a id="_idTextAnchor292">
    </a>
    <a id="_idTextAnchor293">
    </a>
    <a id="_idTextAnchor294">
    </a>
    <a id="_idTextAnchor295">
    </a>
    <span class="koboSpan" id="kobo.760.1">
     ing the password and network with your
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.761.1">
      own values:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.762.1">
$ sudo -u _gvm gvm-cli --gmp-username admin --gmp-password [password] socket --xml "&lt;create_target&gt;&lt;name&gt;My Target&lt;/name&gt;&lt;hosts&gt;10.2.10.0/24&lt;/hosts&gt;&lt;port_range&gt;1-65535&lt;/port_range&gt;&lt;/create_target&gt;"</span></pre>
   <p>
    <span class="koboSpan" id="kobo.763.1">
     The output of this command can be found in the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.764.1">
      following figure:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer125">
     <span class="koboSpan" id="kobo.765.1">
      <img alt="Figure 10.18 – Creating a scan target in GVM" src="image/B22229_10_18.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.766.1">
     Figure 10.18 – Creating a scan target in GVM
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.767.1">
     Copy the target ID output
    </span>
    <a id="_idIndexMarker633">
    </a>
    <span class="koboSpan" id="kobo.768.1">
     from creating a target to cr
    </span>
    <a id="_idTextAnchor296">
    </a>
    <a id="_idTextAnchor297">
    </a>
    <span class="koboSpan" id="kobo.769.1">
     eate a task for a full and fast scan, as
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.770.1">
      shown here:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.771.1">
$ sudo -u _gvm gvm-cli --gmp-username admin --gmp-password [password] socket --xml "&lt;create_task&gt;&lt;name&gt;My Task&lt;/name&gt;&lt;comment&gt;Scanning 10.2.10.0/24&lt;/comment&gt;&lt;config id='daba56c8-73ec-11df-a475-002264764cea'/&gt;&lt;target id=29590015-db97-4d3e-8aab-694abb3b1c4c/&gt;&lt;/create_task&gt;"</span></pre>
   <p>
    <span class="koboSpan" id="kobo.772.1">
     The output of this command
    </span>
    <a id="_idIndexMarker634">
    </a>
    <span class="koboSpan" id="kobo.773.1">
     can be found in the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.774.1">
      following figure:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer126">
     <span class="koboSpan" id="kobo.775.1">
      <img alt="Figure 10.19 – A scan task is created in GVM for demonstration" src="image/B22229_10_19.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.776.1">
     Figure 10.19 – A scan task is created in GVM for demonstration
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.777.1">
     Start the task using the task I
    </span>
    <a id="_idTextAnchor298">
    </a>
    <a id="_idTextAnchor299">
    </a>
    <span class="koboSpan" id="kobo.778.1">
     D
    </span>
    <a id="_idIndexMarker635">
    </a>
    <span class="koboSpan" id="kobo.779.1">
     found in the response from the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.780.1">
      previous command:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.781.1">
$ sudo -u _gvm gvm-cli --gmp-username admin --gmp-password [password] socket --xml "&lt;start_task task_id=abc324d4-7464-4415-8a77-de8dfa13606b'/&gt;"</span></pre>
   <p>
    <span class="koboSpan" id="kobo.782.1">
     The output of this command can be found in the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.783.1">
      following figure:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer127">
     <span class="koboSpan" id="kobo.784.1">
      <img alt="Figure 10.20 – Starting a task in GVM﻿﻿" src="image/B22229_10_20.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.785.1">
     Figure 10.20 – Starting a task in GVM
    </span>
    <a id="_idTextAnchor300">
    </a>
    <a id="_idTextAnchor301">
    </a>
   </p>
   <p>
    <span class="koboSpan" id="kobo.786.1">
     Check the task status
    </span>
    <a id="_idIndexMarker636">
    </a>
    <span class="koboSpan" id="kobo.787.1">
     using the command
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.788.1">
      as shown:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.789.1">
$ sudo -u _gvm gvm-cli --gmp-username admin --gmp-password [password] socket --xml "&lt;get_tasks task_id=7f6996b2-bdf5-49e8-8bb0-699cad0778ec'/&gt;" | xmllint --format -</span></pre>
   <p>
    <span class="koboSpan" id="kobo.790.1">
     The output of this command can be found in the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.791.1">
      following figure:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer128">
     <span class="koboSpan" id="kobo.792.1">
      <img alt="Figure 10.21 – Demonstrating checking the scan task status" src="image/B22229_10_21.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.793.1">
     Figure 10.21 – Demonstrating checking the scan task status
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.794.1">
     Download the report using the
    </span>
    <a id="_idIndexMarker637">
    </a>
    <span class="koboSpan" id="kobo.795.1">
     report ID from the
    </span>
    <a id="_idIndexMarker638">
    </a>
    <span class="koboSpan" id="kobo.796.1">
     previous command output, as
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.797.1">
      shown here:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.798.1">
$ sudo -u _gvm gvm-cli --gmp-username admin --gmp-password [password] socket --xml "&lt;get_reports report_id='7c39338b-8c15-4e3a-93ff-bca125ff2ddf' format_id='c402cc3e-b531-11e1-9163-406186ea4fc5'/&gt;" &gt; scan_result.xml</span></pre>
   <p>
    <span class="koboSpan" id="kobo.799.1">
     Next, let’s create a script to automate this process and parse the report.
    </span>
    <span class="koboSpan" id="kobo.799.2">
     The following code can be found in this chapter’s GitHub repository
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.800.1">
      as
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.801.1">
       ch10_gvm_scan.sh
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.802.1">
      :
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.803.1">
#!/usr/bin/env bash
# User and argument validation
if [ "$(whoami)" != "_gvm" ]; then
  echo "This script must be run as user _gvm."
</span><span class="koboSpan" id="kobo.803.2">  exit 1
fi</span></pre>
   <p>
    <span class="koboSpan" id="kobo.804.1">
     The preceding block of code begins
    </span>
    <a id="_idIndexMarker639">
    </a>
    <span class="koboSpan" id="kobo.805.1">
     with the familiar shebang line.
    </span>
    <span class="koboSpan" id="kobo.805.2">
     It then checks to ensure the user running the
    </span>
    <a id="_idIndexMarker640">
    </a>
    <span class="koboSpan" id="kobo.806.1">
     script is the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.807.1">
      _gvm
     </span>
    </strong>
    <span class="koboSpan" id="kobo.808.1">
     user, which is a user created during the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.809.1">
      gvm
     </span>
    </strong>
    <span class="koboSpan" id="kobo.810.1">
     installation process.
    </span>
    <span class="koboSpan" id="kobo.810.2">
     If not running as this user, the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.811.1">
      script exits.
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.812.1">
if [ $# -lt 2 ]; then
  echo "Usage: $0 &lt;password&gt; &lt;target_host&gt;"
  exit 1
fi</span></pre>
   <p>
    <span class="koboSpan" id="kobo.813.1">
     The script will exit if there are less than
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.814.1">
      two arguments.
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.815.1">
password="$1"
target_host="$2"</span></pre>
   <p>
    <span class="koboSpan" id="kobo.816.1">
     In the preceding code, we
    </span>
    <a id="_idIndexMarker641">
    </a>
    <span class="koboSpan" id="kobo.817.1">
     assign the first argument to the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.818.1">
      password
     </span>
    </strong>
    <span class="koboSpan" id="kobo.819.1">
     variable, and the second argument to the
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.820.1">
       target_host
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.821.1">
      variable.
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.822.1">
# Generate target name
target_name=$(echo -n "$target_host" | sed 's/\//_/g')</span></pre>
   <p>
    <span class="koboSpan" id="kobo.823.1">
     Here, we’re simply replacing any
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.824.1">
      /
     </span>
    </strong>
    <span class="koboSpan" id="kobo.825.1">
     character in the target with
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.826.1">
      an underscore.
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.827.1">
# Create target
echo "[+] Creating target"
target_id=$(gvm-cli --gmp-username admin --gmp-password "$password" socket --xml "&lt;create_target&gt;&lt;name&gt;$target_name&lt;/name&gt;&lt;hosts&gt;$target_host&lt;/hosts&gt;&lt;port_range&gt;1-65535&lt;/port_range&gt;&lt;/create_target&gt;" | grep -o 'id="[^"]*"' | sed -e 's/id="//' -e 's/"//')
if [ -z "$target_id" ]; then
  echo "[-] Failed to create target"
  exit 1
fi</span></pre>
   <p>
    <span class="koboSpan" id="kobo.828.1">
     The preceding code block creates a target in the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.829.1">
      GVM system:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.830.1">
      It uses
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.831.1">
       gvm-cli
      </span>
     </strong>
     <span class="koboSpan" id="kobo.832.1">
      to send an XML request to create
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.833.1">
       a target.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.834.1">
      The target is created with the specified name, host, and
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.835.1">
       port range.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.836.1">
      It extracts the
     </span>
     <a id="_idIndexMarker642">
     </a>
     <span class="koboSpan" id="kobo.837.1">
      target ID from
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.838.1">
       the response.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.839.1">
      If target
     </span>
     <a id="_idIndexMarker643">
     </a>
     <span class="koboSpan" id="kobo.840.1">
      creation fails (empty
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.841.1">
       target_id
      </span>
     </strong>
     <span class="koboSpan" id="kobo.842.1">
      ), the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.843.1">
       script exits.
      </span>
     </span>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.844.1">
     The following code
    </span>
    <a id="_idIndexMarker644">
    </a>
    <span class="koboSpan" id="kobo.845.1">
     will create a
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.846.1">
      scan task:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.847.1">
# Create task
echo "[+] Creating task"
task_id=$(gvm-cli --gmp-username admin --gmp-password "$password" socket --xml "&lt;create_task&gt;&lt;name&gt;Task_$target_name&lt;/name&gt;&lt;comment&gt;Scanning $target_host&lt;/comment&gt;&lt;config id='daba56c8-73ec-11df-a4</span><a id="_idTextAnchor302"/><a id="_idTextAnchor303"/><span class="koboSpan" id="kobo.848.1">75-002264764cea'/&gt;&lt;target id='$target_id'/&gt;&lt;/create_task&gt;" | grep -o 'id="[^"]*"' | sed -e 's/id="//' -e 's/"//')
if [ -z "$task_id" ]; then
  echo "[-] Failed to create task"
  exit 1
fi</span></pre>
   <p>
    <span class="koboSpan" id="kobo.849.1">
     This section creates a task in the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.850.1">
      GVM system:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.851.1">
      It uses
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.852.1">
       gvm-cli
      </span>
     </strong>
     <span class="koboSpan" id="kobo.853.1">
      to send an XML request to create
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.854.1">
       a task.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.855.1">
      The task is created with a name, comment, configuration, and the previously
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.856.1">
       created target.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.857.1">
      It extracts the task ID from
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.858.1">
       the response.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.859.1">
      The
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.860.1">
       grep -o 'id="[^"]*"'
      </span>
     </strong>
     <span class="koboSpan" id="kobo.861.1">
      command searches for all occurrences of
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.862.1">
       pattern id="[^"]*"
      </span>
     </strong>
     <span class="koboSpan" id="kobo.863.1">
      in the input text and outputs only the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.864.1">
       matching parts:
      </span>
     </span>
     <ul>
      <li>
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.865.1">
         id="
        </span>
       </strong>
       <span class="koboSpan" id="kobo.866.1">
        matches the literal
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.867.1">
         string,
        </span>
       </span>
       <span class="No-Break">
        <strong class="source-inline">
         <span class="koboSpan" id="kobo.868.1">
          id="
         </span>
        </strong>
       </span>
      </li>
     </ul>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.869.1">
       [^"]*
      </span>
     </strong>
     <span class="koboSpan" id="kobo.870.1">
      matches zero
     </span>
     <a id="_idIndexMarker645">
     </a>
     <span class="koboSpan" id="kobo.871.1">
      or more characters that are not a double quote (
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.872.1">
       "
      </span>
     </strong>
     <span class="koboSpan" id="kobo.873.1">
      ).
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.874.1">
       [^"]
      </span>
     </strong>
     <span class="koboSpan" id="kobo.875.1">
      is a negated
     </span>
     <a id="_idIndexMarker646">
     </a>
     <span class="koboSpan" id="kobo.876.1">
      character class meaning any character
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.877.1">
       except
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.878.1">
        "
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.879.1">
       :
      </span>
     </span>
     <ul>
      <li>
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.880.1">
         "
        </span>
       </strong>
       <span class="koboSpan" id="kobo.881.1">
        matches the closing
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.882.1">
         double quote
        </span>
       </span>
      </li>
     </ul>
    </li>
    <li>
     <span class="koboSpan" id="kobo.883.1">
      If task creation fails (empty
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.884.1">
       task_id
      </span>
     </strong>
     <span class="koboSpan" id="kobo.885.1">
      ), the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.886.1">
       script exits.
      </span>
     </span>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.887.1">
     Next, we need to start
    </span>
    <a id="_idIndexMarker647">
    </a>
    <span class="koboSpan" id="kobo.888.1">
     the scan, as shown in this
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.889.1">
      code block:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.890.1">
# Start task and wait for completion
echo "[+] Starting task"
report_id=$(gvm-cli --gmp-username admin --gmp-passwor</span><a id="_idTextAnchor304"/><a id="_idTextAnchor305"/><a id="_idTextAnchor306"/><a id="_idTextAnchor307"/><span class="koboSpan" id="kobo.891.1">d "$password" socket --xml "&lt;start_task task_id='$task_id'/&gt;" | grep -oP '(?&lt;=&lt;report_id&gt;).*?(?=&lt;/report_id&gt;)')</span></pre>
   <p>
    <span class="koboSpan" id="kobo.892.1">
     The preceding code starts the scan task using variables captured from previous commands and extracts
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.893.1">
      report_id
     </span>
    </strong>
    <span class="koboSpan" id="kobo.894.1">
     from
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.895.1">
      the response:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.896.1">
       (?&lt;=&lt;report_id&gt;).*?(?=&lt;/report_id&gt;)
      </span>
     </strong>
     <span class="koboSpan" id="kobo.897.1">
      : This is the regular expression that
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.898.1">
       is used.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.899.1">
       (?&lt;=&lt;report_id&gt;)
      </span>
     </strong>
     <span class="koboSpan" id="kobo.900.1">
      : This is a positive
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.901.1">
       look-behind assertion.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.902.1">
       (?&lt;=...)
      </span>
     </strong>
     <span class="koboSpan" id="kobo.903.1">
      : This syntax specifies a look behind, which ensures that what precedes the current position in the string is the specified
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.904.1">
       pattern,
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.905.1">
        &lt;report_id&gt;
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.906.1">
       .
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.907.1">
       &lt;report_id&gt;
      </span>
     </strong>
     <span class="koboSpan" id="kobo.908.1">
      : This is the literal string that must precede
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.909.1">
       the match.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.910.1">
       .*?
      </span>
     </strong>
     <span class="koboSpan" id="kobo.911.1">
      : This is a non-greedy
     </span>
     <a id="_idIndexMarker648">
     </a>
     <span class="koboSpan" id="kobo.912.1">
      match for any
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.913.1">
       character sequence.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.914.1">
       .
      </span>
     </strong>
     <span class="koboSpan" id="kobo.915.1">
      : This matches any
     </span>
     <a id="_idIndexMarker649">
     </a>
     <span class="koboSpan" id="kobo.916.1">
      character except
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.917.1">
       a newline.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.918.1">
       *?
      </span>
     </strong>
     <span class="koboSpan" id="kobo.919.1">
      : This matches zero or more of the preceding elements (
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.920.1">
       .
      </span>
     </strong>
     <span class="koboSpan" id="kobo.921.1">
      in this case), but in a non-greedy (or lazy) manner, meaning it will match as few characters
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.922.1">
       as possible.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.923.1">
       (?=&lt;/report_id&gt;)
      </span>
     </strong>
     <span class="koboSpan" id="kobo.924.1">
      : This is a positive
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.925.1">
       look-ahead assertion.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.926.1">
       (?=...)
      </span>
     </strong>
     <span class="koboSpan" id="kobo.927.1">
      : This syntax specifies a look-ahead, which ensures that what follows the current position in the string is the specified
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.928.1">
       pattern,
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.929.1">
        &lt;/report_id&gt;
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.930.1">
       .
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.931.1">
       &lt;/report_id&gt;
      </span>
     </strong>
     <span class="koboSpan" id="kobo.932.1">
      : This is the literal string that must follow
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.933.1">
       the match.
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.934.1">
     The next code section
    </span>
    <a id="_idIndexMarker650">
    </a>
    <span class="koboSpan" id="kobo.935.1">
     continuously checks for task completion every
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.936.1">
      60 seconds:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.937.1">
# Wait for task to complete
echo "[-] Waiting for scan result. </span><span class="koboSpan" id="kobo.937.2">This may take a while."
</span><span class="koboSpan" id="kobo.937.3">while true; do
    output=$(gvm-cli --gmp-username admin --gmp-password "$password" socket --xml "&lt;get_tasks task_id='$task_id'/&gt;" 2&gt;/dev/null | xmllint --format -)
    if echo "$output" | grep -q '&lt;status&gt;Done&lt;/status&gt;'; then
        break
    fi
    sleep 60
done
echo "[+] The scan is complete."</span></pre>
   <p>
    <span class="koboSpan" id="kobo.938.1">
     The preceding code starts a
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.939.1">
      while
     </span>
    </strong>
    <span class="koboSpan" id="kobo.940.1">
     loop.
    </span>
    <span class="koboSpan" id="kobo.940.2">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.941.1">
      gvm-cli
     </span>
    </strong>
    <span class="koboSpan" id="kobo.942.1">
     command output is printed in a line-by-line format by
    </span>
    <a id="_idIndexMarker651">
    </a>
    <span class="koboSpan" id="kobo.943.1">
     piping it to
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.944.1">
      xmlstarlet
     </span>
    </strong>
    <span class="koboSpan" id="kobo.945.1">
     , then saved to the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.946.1">
      output
     </span>
    </strong>
    <span class="koboSpan" id="kobo.947.1">
     variable.
    </span>
    <span class="koboSpan" id="kobo.947.2">
     If the output status confirms it’s completed, it breaks out of the loop.
    </span>
    <span class="koboSpan" id="kobo.947.3">
     Otherwise, there is a one-minute pause before
    </span>
    <a id="_idIndexMarker652">
    </a>
    <span class="koboSpan" id="kobo.948.1">
     the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.949.1">
      loop repeats.
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.950.1">
# Create report
echo "[+] Printing scan results..."
</span><span class="koboSpan" id="kobo.950.2">gvm-cli --gmp-username admin --gmp-password "$password" socket --xml "</span><a id="_idTextAnchor308"/><a id="_idTextAnchor309"/><span class="koboSpan" id="kobo.951.1">&lt;get_results task_id=\"$task_id\" filter='notes=1 overrides=1'/&gt;" |\
xmlstarlet sel -t -m "//result" \
  -v "host" -o "|" \
  -v "host/hostname" -o "|" \
  -v "port" -o "|</span><a id="_idTextAnchor310"/><a id="_idTextAnchor311"/><span class="koboSpan" id="kobo.952.1">" \
  -v "threat" -o </span><a id="_idTextAnchor312"/><a id="_idTextAnchor313"/><span class="koboSpan" id="kobo.953.1">"|" \
  -v "name" -o "|" \
  -v "severity" -n |
sort -t'|' -k6,6nr |
awk -F'|' '{printf "%s\t%s\t%s\t%s\t%s\n", $1, $2, $3, $4, $5}'</span></pre>
   <p>
    <span class="koboSpan" id="kobo.954.1">
     The preceding code block requests the scan results (vulnerabilities) detected in the scan task.
    </span>
    <span class="koboSpan" id="kobo.954.2">
     It pipes the output to
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.955.1">
      xmlstarlet
     </span>
    </strong>
    <span class="koboSpan" id="kobo.956.1">
     to parse the XML content and output the most interesting parts.
    </span>
    <span class="koboSpan" id="kobo.956.2">
     Finally, it sorts based on the sixth column (
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.957.1">
      severity
     </span>
    </strong>
    <span class="koboSpan" id="kobo.958.1">
     ) and prints the data fields
    </span>
    <a id="_idIndexMarker653">
    </a>
    <span class="koboSpan" id="kobo.959.1">
     with a tab (
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.960.1">
      \
     </span>
    </strong>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.961.1">
       t
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.962.1">
      ) separator:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.963.1">
       xmlstarlet
      </span>
     </strong>
     <span class="koboSpan" id="kobo.964.1">
      is a command-line tool for parsing, querying, transforming, and editing XML files.
     </span>
     <span class="koboSpan" id="kobo.964.2">
      It can be used to extract specific data from XML documents, modify XML structures, and perform various other
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.965.1">
       XML-related tasks.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.966.1">
       sel -t
      </span>
     </strong>
     <span class="koboSpan" id="kobo.967.1">
      : This is short for
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.968.1">
       select
      </span>
     </em>
     <span class="koboSpan" id="kobo.969.1">
      .
     </span>
     <span class="koboSpan" id="kobo.969.2">
      It indicates that we are using the selection sub-command to query XML data.
     </span>
     <span class="koboSpan" id="kobo.969.3">
      The
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.970.1">
       -t
      </span>
     </strong>
     <span class="koboSpan" id="kobo.971.1">
      stands for
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.972.1">
       template
      </span>
     </em>
     <span class="koboSpan" id="kobo.973.1">
      .
     </span>
     <span class="koboSpan" id="kobo.973.2">
      It is used to define the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.974.1">
       output template.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.975.1">
       -m "//result"
      </span>
     </strong>
     <span class="koboSpan" id="kobo.976.1">
      : This stands for
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.977.1">
       match
      </span>
     </em>
     <span class="koboSpan" id="kobo.978.1">
      .
     </span>
     <span class="koboSpan" id="kobo.978.2">
      It specifies an XPath expression to select nodes from the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.979.1">
       XML document.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.980.1">
       //result
      </span>
     </strong>
     <span class="koboSpan" id="kobo.981.1">
      : This XPath expression selects all result elements in the XML document, regardless of their location
     </span>
     <a id="_idIndexMarker654">
     </a>
     <span class="koboSpan" id="kobo.982.1">
      in
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.983.1">
       the hierarchy.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.984.1">
       sort -t'|' -k6,6nr
      </span>
     </strong>
     <span class="koboSpan" id="kobo.985.1">
      : The
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.986.1">
       -k
      </span>
     </strong>
     <span class="koboSpan" id="kobo.987.1">
      option specifies the key (field) to sort by, and the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.988.1">
       nr
      </span>
     </strong>
     <span class="koboSpan" id="kobo.989.1">
      suffix indicates the
     </span>
     <a id="_idIndexMarker655">
     </a>
     <span class="koboSpan" id="kobo.990.1">
      type of sorting (numerical and
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.991.1">
       reverse order).
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.992.1">
       -k6,6
      </span>
     </strong>
     <span class="koboSpan" id="kobo.993.1">
      : This option tells
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.994.1">
       sort
      </span>
     </strong>
     <span class="koboSpan" id="kobo.995.1">
      to use the sixth field as the key for sorting.
     </span>
     <span class="koboSpan" id="kobo.995.2">
      The
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.996.1">
       6,6
      </span>
     </strong>
     <span class="koboSpan" id="kobo.997.1">
      syntax means it should start and stop sorting on the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.998.1">
       sixth field.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.999.1">
       awk -F'|' '{printf "%s\t%s\t%s\t%s\t%s\n", $1, $2, $3, $4, $5}'
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1000.1">
      : This code determines how the data
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1001.1">
       is printed:
      </span>
     </span>
     <ul>
      <li>
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.1002.1">
         -F
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1003.1">
        : This option tells
       </span>
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.1004.1">
         awk
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1005.1">
        to use a specific character as the
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.1006.1">
         field separator.
        </span>
       </span>
      </li>
      <li>
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.1007.1">
         '|'
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1008.1">
        : The pipe character is specified as the delimiter.
       </span>
       <span class="koboSpan" id="kobo.1008.2">
        This means
       </span>
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.1009.1">
         awk
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1010.1">
        will consider the text between pipe characters as
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.1011.1">
         separate fields.
        </span>
       </span>
      </li>
      <li>
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.1012.1">
         { ...
        </span>
        <span class="koboSpan" id="kobo.1012.2">
         }
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1013.1">
        : Encloses the action to be performed on each
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.1014.1">
         input line.
        </span>
       </span>
      </li>
      <li>
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.1015.1">
         printf
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1016.1">
        : A function in
       </span>
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.1017.1">
         awk
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1018.1">
        (and many programming languages) used for
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.1019.1">
         formatted output.
        </span>
       </span>
      </li>
      <li>
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.1020.1">
         "%s\t%s\t%s\t%s\t%s\n"
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1021.1">
        : This format string tells
       </span>
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.1022.1">
         printf
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1023.1">
        to output five string fields (
       </span>
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.1024.1">
         %s
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1025.1">
        ), each followed by a tab character (
       </span>
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.1026.1">
         \t
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1027.1">
        ), and end the line with a newline
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.1028.1">
         character (
        </span>
       </span>
       <span class="No-Break">
        <strong class="source-inline">
         <span class="koboSpan" id="kobo.1029.1">
          \n
         </span>
        </strong>
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.1030.1">
         ).
        </span>
       </span>
      </li>
      <li>
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.1031.1">
         $1, $2, $3, $4, $5
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1032.1">
        : These are field variables in
       </span>
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.1033.1">
         awk
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1034.1">
        .
       </span>
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.1035.1">
         $1
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1036.1">
        refers to the first field,
       </span>
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.1037.1">
         $2
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1038.1">
        to the second field, and so on.
       </span>
       <span class="koboSpan" id="kobo.1038.2">
        Since the field separator is a pipe (
       </span>
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.1039.1">
         |
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1040.1">
        ), these variables correspond to the data between
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.1041.1">
         the pipes.
        </span>
       </span>
      </li>
     </ul>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.1042.1">
     The script must be run as
    </span>
    <a id="_idIndexMarker656">
    </a>
    <span class="koboSpan" id="kobo.1043.1">
     the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1044.1">
      _gvm
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1045.1">
     user.
    </span>
    <span class="koboSpan" id="kobo.1045.2">
     When we prefix each command with
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1046.1">
      sudo
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1047.1">
     inside the script, there’s enough time between some of the steps that it will prompt you for credentials while you’ve stepped away, unaware
    </span>
    <a id="_idIndexMarker657">
    </a>
    <span class="koboSpan" id="kobo.1048.1">
     that it’s waiting for your input.
    </span>
    <span class="koboSpan" id="kobo.1048.2">
     Instead, we’ll run the script with
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1049.1">
      sudo -u _gvm
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1050.1">
     prefixed, so you’ll need to run the following comma
    </span>
    <a id="_idTextAnchor314">
    </a>
    <a id="_idTextAnchor315">
    </a>
    <span class="koboSpan" id="kobo.1051.1">
     nds to
    </span>
    <a id="_idIndexMarker658">
    </a>
    <span class="koboSpan" id="kobo.1052.1">
     set up directory and file permissions before running
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1053.1">
      the script:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.1054.1">
$ mkdir ~/shared_scripts
$ cp ch10_gvm_scan.sh ~/shared_scripts
$ sudo chmod 775 /home/kali/shared_scripts
$ sudo chown -R kali:_gvm /home/kali/shared_scripts</span></pre>
   <p>
    <span class="koboSpan" id="kobo.1055.1">
     Let’s look at
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1056.1">
      the explanation:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.1057.1">
      We created a new directory using the
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1058.1">
        mkdir
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1059.1">
       command.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1060.1">
      The script is copied to the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1061.1">
       new directory.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1062.1">
      The directory permissions are changed to set user and group permissions to
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1063.1">
       7
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1064.1">
      .
     </span>
     <span class="koboSpan" id="kobo.1064.2">
      The number
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1065.1">
       7
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1066.1">
      for the user and group equates to read (4), write (2), and execute (1) (
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.1067.1">
       4 + 2 + 1 = 7
      </span>
     </em>
     <span class="koboSpan" id="kobo.1068.1">
      ), and the other permissions to read (4) and execute (1) (
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.1069.1">
       4 + 1 =
      </span>
     </em>
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.1070.1">
        5
       </span>
      </em>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1071.1">
       ).
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1072.1">
      Finally, the owner is changed recursively to the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1073.1">
       kali
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1074.1">
      user and
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1075.1">
       _gvm
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1076.1">
      group on the new directory and everything inside
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1077.1">
       the directory.
      </span>
     </span>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.1078.1">
     The following figure
    </span>
    <a id="_idIndexMarker659">
    </a>
    <span class="koboSpan" id="kobo.1079.1">
     demonstrates how to run the script and shows the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1080.1">
      script output:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer129">
     <span class="koboSpan" id="kobo.1081.1">
      <img alt="Figure 10.22 – The Greenbone scan script is demonstrated and shows the scan results" src="image/B22229_10_22.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.1082.1">
     Figure 10.22 – The Greenbone scan script is demonstrated and shows the scan results
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1083.1">
     You can learn more about
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1084.1">
      gvm-cli
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1085.1">
     usage
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1086.1">
      at
     </span>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1087.1">
      https://docs.greenbone.net/GSM-Manual/gos-22.04/en/gmp.html#starting-a-scan-using-the-command-gvm-cli
     </span>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1088.1">
      .
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1089.1">
     This concludes the section where
    </span>
    <a id="_idIndexMarker660">
    </a>
    <span class="koboSpan" id="kobo.1090.1">
     we focused on
    </span>
    <a id="_idIndexMarker661">
    </a>
    <span class="koboSpan" id="kobo.1091.1">
     vulnerability scanning automation.
    </span>
    <span class="koboSpan" id="kobo.1091.2">
     Our attention and focus abilities are finite.
    </span>
    <span class="koboSpan" id="kobo.1091.3">
     Always automate the mundane, repeatable tasks so you have more time and the ability to focus on carefully reviewing scan results for the smallest details to uncover
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1092.1">
      exploitable vulnerabilities.
     </span>
    </span>
   </p>
   <h1 id="_idParaDest-176">
    <a id="_idTextAnchor316">
    </a>
    <span class="koboSpan" id="kobo.1093.1">
     Summary
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.1094.1">
     This chapter explored the topic of using Bash scripting for network pentesting and automation.
    </span>
    <span class="koboSpan" id="kobo.1094.2">
     Port scanning was thoroughly explored, from basic command-line options through advanced techniques necessary to tune for speed and depth of results.
    </span>
    <span class="koboSpan" id="kobo.1094.3">
     We went through the discovery of common network protocols that are frequently exploited.
    </span>
    <span class="koboSpan" id="kobo.1094.4">
     Finally, we dived into the automation of network vulnerability
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1095.1">
      scanning tools.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1096.1">
     The next chapter will focus on post-exploitation privilege escalation techniques in a Bash environment.
    </span>
    <span class="koboSpan" id="kobo.1096.2">
     When remote network services are exploited, they commonly result in a non-root shell.
    </span>
    <span class="koboSpan" id="kobo.1096.3">
     In
    </span>
    <a href="B22229_11.xhtml#_idTextAnchor317">
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.1097.1">
        Chapter 11
       </span>
      </em>
     </span>
    </a>
    <span class="koboSpan" id="kobo.1098.1">
     , we will dive in and explore how to enumerate Linux systems in a Bash shell to escalate our privileges for a complete
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1099.1">
      system takeover.
     </span>
    </span>
   </p>
  </div>
 </body></html>