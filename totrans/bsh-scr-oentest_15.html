<html><head></head><body>
  <div id="_idContainer195">
   <h1 class="chapter-number" id="_idParaDest-203">
    <a id="_idTextAnchor434">
    </a>
    <span class="koboSpan" id="kobo.1.1">
     13
    </span>
   </h1>
   <h1 id="_idParaDest-204">
    <a id="_idTextAnchor435">
    </a>
    <span class="koboSpan" id="kobo.2.1">
     Pentest Reporting with Bash
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.3.1">
     In this chapter, we explore the role Bash can play in streamlining the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.4.1">
      reporting
     </span>
    </strong>
    <span class="koboSpan" id="kobo.5.1">
     phase of pentesting.
    </span>
    <span class="koboSpan" id="kobo.5.2">
     As security professionals know, the final report is a critical deliverable that communicates findings, risks, and recommendations to stakeholders.
    </span>
    <span class="koboSpan" id="kobo.5.3">
     However, compiling these reports can be time-consuming and prone to inconsistencies.
    </span>
    <span class="koboSpan" id="kobo.5.4">
     We’ll examine how Bash scripting can automate and enhance various aspects of the reporting process, from data collection to
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.6.1">
      report generation.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.7.1">
     Throughout the chapter, we’ll cover techniques for automating data extraction from tool outputs, generating preliminary reports, and integrating Bash with other reporting tools.
    </span>
    <span class="koboSpan" id="kobo.7.2">
     You’ll learn how to create scripts that can parse raw data and populate
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.8.1">
      report templates.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.9.1">
     By the end of this chapter, you’ll have a solid foundation in using Bash to create efficient, accurate, and professional pentest reports.
    </span>
    <span class="koboSpan" id="kobo.9.2">
     These skills will not only save time but also enhance the quality and consistency of your deliverables, allowing you to focus more on analysis and less on manual
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.10.1">
      report compilation.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.11.1">
     In this chapter, we’re going to cover the following
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.12.1">
      main topics:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <a id="_idTextAnchor436">
     </a>
     <a id="_idTextAnchor437">
     </a>
     <span class="koboSpan" id="kobo.13.1">
      Automating data collection for reporting
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.14.1">
       with Bash
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.15.1">
      Storing and managing pentest data
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.16.1">
       with SQLite
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.17.1">
      Integrating Bash with
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.18.1">
       reporting tools
      </span>
     </span>
    </li>
   </ul>
   <h1 id="_idParaDest-205">
    <a id="_idTextAnchor438">
    </a>
    <span class="koboSpan" id="kobo.19.1">
     Technical requirements
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.20.1">
     The code for this chapter can be found
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.21.1">
      at
     </span>
    </span>
    <a href="https://github.com/PacktPublishing/Bash-Shell-Scripting-for-Pentesters/tree/main/Chapter13">
     <span class="No-Break">
      <span class="koboSpan" id="kobo.22.1">
       https://github.com/PacktPublishing/Bash-Shell-Scripting-for-Pentesters/tree/main/Chapter13
      </span>
     </span>
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.23.1">
      .
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.24.1">
     Enter the following commands to install prerequisites on your Kali
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.25.1">
      Linux system:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.26.1">
$ </span><a id="_idTextAnchor439"/><a id="_idTextAnchor440"/><span class="koboSpan" id="kobo.27.1">sudo apt install libxml2-utils jq sqlite3 texlive-base xmlstarlet</span></pre>
   <p>
    <span class="koboSpan" id="kobo.28.1">
     The following commands assume that you have Go installed.
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.29.1">
      See
     </span>
    </span>
    <a href="https://go.dev/doc/install">
     <span class="No-Break">
      <span class="koboSpan" id="kobo.30.1">
       https://go.dev/doc/install
      </span>
     </span>
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.31.1">
      :
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.32.1">
$ </span><a id="_idTextAnchor441"/><a id="_idTextAnchor442"/><span class="koboSpan" id="kobo.33.1">go install -v github.com/projectdiscovery/httpx/cmd/httpx@latest
$ </span><a id="_idTextAnchor443"/><a id="_idTextAnchor444"/><span class="koboSpan" id="kobo.34.1">go install -v github.com/projectdiscovery/mapcidr/cmd/mapcidr@latest</span></pre>
   <p>
    <span class="koboSpan" id="kobo.35.1">
     With the prerequisites out of the way, it’s time to dive into reporting, every pentester’s
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.36.1">
      favorite subject!
     </span>
    </span>
   </p>
   <h1 id="_idParaDest-206">
    <a id="_idTextAnchor445">
    </a>
    <span class="koboSpan" id="kobo.37.1">
     Automating data collection for reporting with Bash
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.38.1">
     Efficient
    </span>
    <a id="_idIndexMarker812">
    </a>
    <span class="koboSpan" id="kobo.39.1">
     data collection is a pillar of effective pentesting reporting.
    </span>
    <span class="koboSpan" id="kobo.39.2">
     This section explores how to leverage Bash scripting to automate the gathering and
    </span>
    <a id="_idIndexMarker813">
    </a>
    <span class="koboSpan" id="kobo.40.1">
     organization of critical information from various phases of
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.41.1">
      a pentest.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.42.1">
     By automating data collection, pentesters can do
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.43.1">
      the following:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.44.1">
      Reduce manual errors in
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.45.1">
       data gathering
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.46.1">
      Standardize the format of
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.47.1">
       collected information
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.48.1">
      Save time on repetitive data
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.49.1">
       extraction tasks
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.50.1">
      Ensure consistency across multiple tests
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.51.1">
       and reports
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.52.1">
     We’ll examine techniques for identifying key data points, extracting information from tool outputs, cleaning raw data, storing data in a database, and templating reports.
    </span>
    <span class="koboSpan" id="kobo.52.2">
     These methods will help streamline the reporting process and allow testers to focus more on analysis and less on
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.53.1">
      data management.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.54.1">
     Let’s begin by looking at how to identify and extract the most relevant data for pentest reports
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.55.1">
      using Bash.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-207">
    <a id="_idTextAnchor446">
    </a>
    <span class="koboSpan" id="kobo.56.1">
     Identifying key data points
    </span>
   </h2>
   <p>
    <strong class="bold">
     <span class="koboSpan" id="kobo.57.1">
      Key data points
     </span>
    </strong>
    <span class="koboSpan" id="kobo.58.1">
     are essential pieces
    </span>
    <a id="_idIndexMarker814">
    </a>
    <span class="koboSpan" id="kobo.59.1">
     of information that provide a comprehensive overview of the test findings, vulnerabilities, and overall security posture of the target system or network.
    </span>
    <span class="koboSpan" id="kobo.59.2">
     These data points form the backbone of an effective
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.60.1">
      pentest report.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.61.1">
     Key data points
    </span>
    <a id="_idIndexMarker815">
    </a>
    <span class="koboSpan" id="kobo.62.1">
     typically include
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.63.1">
      the following:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.64.1">
       Executive
      </span>
     </strong>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.65.1">
        summary data
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.66.1">
       :
      </span>
     </span>
     <ul>
      <li>
       <span class="koboSpan" id="kobo.67.1">
        Total number of vulnerabilities
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.68.1">
         by severity
        </span>
       </span>
      </li>
      <li>
       <span class="koboSpan" id="kobo.69.1">
        Key findings and
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.70.1">
         critical issues
        </span>
       </span>
      </li>
      <li>
       <span class="koboSpan" id="kobo.71.1">
        Overall
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.72.1">
         risk rating
        </span>
       </span>
      </li>
     </ul>
    </li>
    <li>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.73.1">
        Compliance information
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.74.1">
       :
      </span>
     </span>
     <ul>
      <li>
       <span class="koboSpan" id="kobo.75.1">
        Relevant compliance standards (e.g., PCI DSS
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.76.1">
         and HIPAA)
        </span>
       </span>
      </li>
      <li>
       <span class="koboSpan" id="kobo.77.1">
        Specific compliance violations
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.78.1">
         or gaps
        </span>
       </span>
      </li>
     </ul>
    </li>
    <li>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.79.1">
        Test metadata
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.80.1">
       :
      </span>
     </span>
     <ul>
      <li>
       <span class="koboSpan" id="kobo.81.1">
        Date and duration of
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.82.1">
         the test
        </span>
       </span>
      </li>
      <li>
       <span class="koboSpan" id="kobo.83.1">
        Scope of
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.84.1">
         the assessment
        </span>
       </span>
      </li>
      <li>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.85.1">
         Tester information
        </span>
       </span>
      </li>
      <li>
       <span class="koboSpan" id="kobo.86.1">
        Tools used during
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.87.1">
         the assessment
        </span>
       </span>
      </li>
     </ul>
    </li>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.88.1">
       Successful attacks
      </span>
     </strong>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.89.1">
        or exploits
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.90.1">
       :
      </span>
     </span>
     <ul>
      <li>
       <span class="koboSpan" id="kobo.91.1">
        Description of successful
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.92.1">
         penetration attempts
        </span>
       </span>
      </li>
      <li>
       <span class="koboSpan" id="kobo.93.1">
        Data accessed
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.94.1">
         or exfiltrated
        </span>
       </span>
      </li>
      <li>
       <span class="koboSpan" id="kobo.95.1">
        Potential
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.96.1">
         real-world consequences
        </span>
       </span>
      </li>
     </ul>
    </li>
    <li>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.97.1">
        Vulnerability information
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.98.1">
       :
      </span>
     </span>
     <ul>
      <li>
       <span class="koboSpan" id="kobo.99.1">
        Vulnerability name
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.100.1">
         and description
        </span>
       </span>
      </li>
      <li>
       <span class="koboSpan" id="kobo.101.1">
        Severity rating (e.g., Critical, High, Medium,
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.102.1">
         or Low)
        </span>
       </span>
      </li>
      <li>
       <strong class="bold">
        <span class="koboSpan" id="kobo.103.1">
         Common Vulnerability Scoring System
        </span>
       </strong>
       <span class="koboSpan" id="kobo.104.1">
        (
       </span>
       <span class="No-Break">
        <strong class="bold">
         <span class="koboSpan" id="kobo.105.1">
          CVSS
         </span>
        </strong>
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.106.1">
         ) score
        </span>
       </span>
      </li>
      <li>
       <span class="koboSpan" id="kobo.107.1">
        Affected systems
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.108.1">
         or components
        </span>
       </span>
      </li>
     </ul>
    </li>
    <li>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.109.1">
        Technical details
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.110.1">
       :
      </span>
     </span>
     <ul>
      <li>
       <span class="koboSpan" id="kobo.111.1">
        IP addresses and hostnames of
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.112.1">
         affected systems
        </span>
       </span>
      </li>
      <li>
       <span class="koboSpan" id="kobo.113.1">
        Port numbers and
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.114.1">
         services running
        </span>
       </span>
      </li>
      <li>
       <span class="koboSpan" id="kobo.115.1">
        Software versions and
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.116.1">
         patch levels
        </span>
       </span>
      </li>
      <li>
       <span class="koboSpan" id="kobo.117.1">
        Exploit methods or proof
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.118.1">
         of concept
        </span>
       </span>
      </li>
     </ul>
    </li>
    <li>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.119.1">
        Risk assessment
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.120.1">
       :
      </span>
     </span>
     <ul>
      <li>
       <span class="koboSpan" id="kobo.121.1">
        Potential impact of
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.122.1">
         each vulnerability
        </span>
       </span>
      </li>
      <li>
       <span class="koboSpan" id="kobo.123.1">
        Likelihood
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.124.1">
         of exploitation
        </span>
       </span>
      </li>
      <li>
       <span class="koboSpan" id="kobo.125.1">
        Business
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.126.1">
         impact analysis
        </span>
       </span>
      </li>
     </ul>
    </li>
    <li>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.127.1">
        Testing artifacts
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.128.1">
       :
      </span>
     </span>
     <ul>
      <li>
       <span class="koboSpan" id="kobo.129.1">
        Screenshots of vulnerabilities
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.130.1">
         or exploits
        </span>
       </span>
      </li>
      <li>
       <span class="koboSpan" id="kobo.131.1">
        Log
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.132.1">
         file excerpts
        </span>
       </span>
      </li>
      <li>
       <span class="koboSpan" id="kobo.133.1">
        Command outputs
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.134.1">
         from tools
        </span>
       </span>
      </li>
     </ul>
    </li>
    <li>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.135.1">
        Remediation information
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.136.1">
       :
      </span>
     </span>
     <ul>
      <li>
       <span class="koboSpan" id="kobo.137.1">
        Recommended
       </span>
       <a id="_idIndexMarker816">
       </a>
       <span class="koboSpan" id="kobo.138.1">
        fixes
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.139.1">
         or mitigations
        </span>
       </span>
      </li>
      <li>
       <span class="koboSpan" id="kobo.140.1">
        Priority
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.141.1">
         of remediation
        </span>
       </span>
      </li>
      <li>
       <span class="koboSpan" id="kobo.142.1">
        Estimated effort
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.143.1">
         for remediation
        </span>
       </span>
      </li>
     </ul>
    </li>
   </ul>
   <h2 id="_idParaDest-208">
    <a id="_idTextAnchor447">
    </a>
    <span class="koboSpan" id="kobo.144.1">
     Parsing and cleaning raw data using Bash
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.145.1">
     Pentest
    </span>
    <a id="_idIndexMarker817">
    </a>
    <span class="koboSpan" id="kobo.146.1">
     tool’s primary
    </span>
    <a id="_idIndexMarker818">
    </a>
    <span class="koboSpan" id="kobo.147.1">
     report output formats include
    </span>
    <a id="_idIndexMarker819">
    </a>
    <span class="koboSpan" id="kobo.148.1">
     plain text files (
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.149.1">
      .txt
     </span>
    </strong>
    <span class="koboSpan" id="kobo.150.1">
     ),
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.151.1">
      Comma-Separated Values
     </span>
    </strong>
    <span class="koboSpan" id="kobo.152.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.153.1">
      CSV
     </span>
    </strong>
    <span class="koboSpan" id="kobo.154.1">
     ),
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.155.1">
      Extensible Markup Language
     </span>
    </strong>
    <span class="koboSpan" id="kobo.156.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.157.1">
      XML
     </span>
    </strong>
    <span class="koboSpan" id="kobo.158.1">
     ), and
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.159.1">
      JavaScript Object Notation
     </span>
    </strong>
    <span class="koboSpan" id="kobo.160.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.161.1">
      JSON
     </span>
    </strong>
    <span class="koboSpan" id="kobo.162.1">
     ).
    </span>
    <span class="koboSpan" id="kobo.162.2">
     Since plain text output isn’t
    </span>
    <a id="_idIndexMarker820">
    </a>
    <span class="koboSpan" id="kobo.163.1">
     organized into any specific format, it won’t be covered in this section and
    </span>
    <a id="_idIndexMarker821">
    </a>
    <span class="koboSpan" id="kobo.164.1">
     what you previously learned about regular expressions in
    </span>
    <a href="B22229_04.xhtml#_idTextAnchor073">
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.165.1">
        Chapter 4
       </span>
      </em>
     </span>
    </a>
    <span class="koboSpan" id="kobo.166.1">
     will suffice.
    </span>
    <span class="koboSpan" id="kobo.166.2">
     The rest of this section will include strategies for parsing the other
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.167.1">
      data formats.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.168.1">
     Let’s begin with CSV data.
    </span>
    <span class="koboSpan" id="kobo.168.2">
     The best tool in the Bash toolbox for parsing tabular data is undoubtedly
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.169.1">
      awk
     </span>
    </strong>
    <span class="koboSpan" id="kobo.170.1">
     .
    </span>
    <span class="koboSpan" id="kobo.170.2">
     The
    </span>
    <a id="_idIndexMarker822">
    </a>
    <span class="koboSpan" id="kobo.171.1">
     basic syntax for
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.172.1">
      awk
     </span>
    </strong>
    <span class="koboSpan" id="kobo.173.1">
     is
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.174.1">
      a
     </span>
     <a id="_idTextAnchor448">
     </a>
     <a id="_idTextAnchor449">
     </a>
     <span class="koboSpan" id="kobo.175.1">
      s follows:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.176.1">
awk 'pattern {action}' input_file</span></pre>
   <p>
    <span class="koboSpan" id="kobo.177.1">
     Here, please
    </span>
    <a id="_idIndexMarker823">
    </a>
    <span class="koboSpan" id="kobo.178.1">
     note
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.179.1">
      the
     </span>
    </span>
    <span class="No-Break">
     <a id="_idIndexMarker824">
     </a>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.180.1">
      following:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.181.1">
       pattern
      </span>
     </strong>
     <span class="koboSpan" id="kobo.182.1">
      is an optional condition
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.183.1">
       to match.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.184.1">
       action
      </span>
     </strong>
     <span class="koboSpan" id="kobo.185.1">
      is what to do when the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.186.1">
       pattern matches.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.187.1">
       input_file
      </span>
     </strong>
     <span class="koboSpan" id="kobo.188.1">
      is the file
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.189.1">
       to process.
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.190.1">
     Of course, you can remove the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.191.1">
      input_file
     </span>
    </strong>
    <span class="koboSpan" id="kobo.192.1">
     variable if you are piping (
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.193.1">
      |
     </span>
    </strong>
    <span class="koboSpan" id="kobo.194.1">
     ) data because awk can accept input from
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.195.1">
      stdin
     </span>
    </strong>
    <span class="koboSpan" id="kobo.196.1">
     or
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.197.1">
      input files.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.198.1">
     Let’s say we have a CSV file with the following content named
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.199.1">
      scan_results.csv
     </span>
    </strong>
    <span class="koboSpan" id="kobo.200.1">
     .
    </span>
    <span class="koboSpan" id="kobo.200.2">
     You can find this file in this chapter’s
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.201.1">
      GitHub
     </span>
     <a id="_idTextAnchor450">
     </a>
     <a id="_idTextAnchor451">
     </a>
     <a id="_idTextAnchor452">
     </a>
     <a id="_idTextAnchor453">
     </a>
     <span class="koboSpan" id="kobo.202.1">
      repository:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.203.1">
IP,Hostname,Port,Service,Version
192.168.1.1,gateway,80,http,Apache 2.4.41
192.168.1.10,webserver,443,https,nginx 1.18.0
192.168.1.20,database,3306,mysql,MySQL 5.7.32
192.168.1.30,fileserver,22,ssh,OpenSSH 8.2p1</span></pre>
   <p>
    <span class="koboSpan" id="kobo.204.1">
     Here’s how to extract only the IP and
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.205.1">
      P
     </span>
     <a id="_idTextAnchor454">
     </a>
     <a id="_idTextAnchor455">
     </a>
     <span class="koboSpan" id="kobo.206.1">
      ort columns:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.207.1">
awk -F',</span><a id="_idTextAnchor456"/><a id="_idTextAnchor457"/><span class="koboSpan" id="kobo.208.1">' '{print $1 "," $3}' nmap_results.csv</span></pre>
   <p>
    <span class="koboSpan" id="kobo.209.1">
     This is
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.210.1">
      the output:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.211.1">
IP,Port
192.168.1.1,80
192.168.1.10,443
192.168.1.20,3306
192.168.1.30,22</span></pre>
   <p>
    <span class="koboSpan" id="kobo.212.1">
     The explanation is
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.213.1">
      as follows:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.214.1">
       -F','
      </span>
     </strong>
     <span class="koboSpan" id="kobo.215.1">
      sets the field separator to
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.216.1">
       a comma.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.217.1">
       $1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.218.1">
      and
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.219.1">
       $3
      </span>
     </strong>
     <span class="koboSpan" id="kobo.220.1">
      refer to the first and third
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.221.1">
       fields, respectively.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.222.1">
       ","
      </span>
     </strong>
     <span class="koboSpan" id="kobo.223.1">
      prints a comma between the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.224.1">
       $1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.225.1">
      and
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.226.1">
       $
      </span>
     </strong>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.227.1">
        3
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.228.1">
       fields.
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.229.1">
     Here’s how to show only entries with open web ports
    </span>
    <a id="_idTextAnchor458">
    </a>
    <a id="_idTextAnchor459">
    </a>
    <span class="koboSpan" id="kobo.230.1">
     (
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.231.1">
      80
     </span>
    </strong>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.232.1">
      or
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.233.1">
       443
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.234.1">
      ):
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.235.1">
awk -F',' '$3 == 80 || $3 == 443 {print $1 "," $2 "," $3}' nmap_results.csv</span></pre>
   <p>
    <span class="koboSpan" id="kobo.236.1">
     The output is
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.237.1">
      as follows:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.238.1">
192.168.1.1,gateway,80
192.168.1.10,webserver,443</span></pre>
   <p>
    <span class="koboSpan" id="kobo.239.1">
     To add a header and a footer to our output, do
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.240.1">
      th
     </span>
     <a id="_idTextAnchor460">
     </a>
     <a id="_idTextAnchor461">
     </a>
     <a id="_idTextAnchor462">
     </a>
     <a id="_idTextAnchor463">
     </a>
     <span class="koboSpan" id="kobo.241.1">
      e following:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.242.1">
awk -F',' 'BEGIN {print "Open Web Servers:"} $3 == 80 </span><a id="_idTextAnchor464"/><a id="_idTextAnchor465"/><span class="koboSpan" id="kobo.243.1">|| $3 == 443 {print $1 "," $2 "," $3} END {print "End of list"}' nmap_results.csv</span></pre>
   <p>
    <span class="koboSpan" id="kobo.244.1">
     This is the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.245.1">
      resultant output:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.246.1">
Open Web Servers:
192.168.1.1,gateway,80
192.168.1.10,webserver,443
End of list</span></pre>
   <p>
    <span class="koboSpan" id="kobo.247.1">
     Since we’re
    </span>
    <a id="_idIndexMarker825">
    </a>
    <span class="koboSpan" id="kobo.248.1">
     adding something
    </span>
    <a id="_idIndexMarker826">
    </a>
    <span class="koboSpan" id="kobo.249.1">
     new here, let’s review
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.250.1">
      an explanation:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.251.1">
      The awk pattern is
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.252.1">
       awk 'pattern {
      </span>
     </strong>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.253.1">
        action}' input_file
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.254.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.255.1">
      The pattern is
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.256.1">
       $3 == 80 || $3 ==
      </span>
     </strong>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.257.1">
        443
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.258.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.259.1">
      The action is
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.260.1">
       {print $1 "," $2 "," $
      </span>
     </strong>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.261.1">
        3}
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.262.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.263.1">
      The
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.264.1">
       BEGIN
      </span>
     </strong>
     <span class="koboSpan" id="kobo.265.1">
      code prints
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.266.1">
       Open Web Servers:
      </span>
     </strong>
     <span class="koboSpan" id="kobo.267.1">
      and goes before
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.268.1">
       the pattern.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.269.1">
      The
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.270.1">
       END
      </span>
     </strong>
     <span class="koboSpan" id="kobo.271.1">
      code prints
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.272.1">
       End of list
      </span>
     </strong>
     <span class="koboSpan" id="kobo.273.1">
      and goes after
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.274.1">
       the action.
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.275.1">
     Let’s examine an example showing how to calculate statistics.
    </span>
    <span class="koboSpan" id="kobo.275.2">
     Let’s say we have a
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.276.1">
      vulnerability_scan.csv
     </span>
    </strong>
    <span class="koboSpan" id="kobo.277.1">
     file with
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.278.1">
      se
     </span>
     <a id="_idTextAnchor466">
     </a>
     <a id="_idTextAnchor467">
     </a>
     <a id="_idTextAnchor468">
     </a>
     <span class="koboSpan" id="kobo.279.1">
      verity levels:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.280.1">
IP,Vulnerability,Severity
192.168.1.1,SQL Injection,High
192.168.1.1,XSS,Medium
192.168.1.10,Outdated SSL,Low
192.168.1.20,Weak Password,High
192.168.1.30,Information Disclosure,Medium</span></pre>
   <p>
    <span class="koboSpan" id="kobo.281.1">
     Here’s how to count vulnerabilities
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.282.1">
      by severity:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.283.1">
awk -F',' 'NR&gt;1 {gsub(/\r/,""); if($3!="") count[$3]++} END {for (severity in count) print severity ": " count[severity]}' vulnerability_scan.csv</span></pre>
   <p>
    <span class="koboSpan" id="kobo.284.1">
     This
    </span>
    <a id="_idIndexMarker827">
    </a>
    <span class="koboSpan" id="kobo.285.1">
     is
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.286.1">
      the
     </span>
    </span>
    <span class="No-Break">
     <a id="_idIndexMarker828">
     </a>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.287.1">
      output:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.288.1">
Low: 1
Medium: 2
High: 2</span></pre>
   <p>
    <span class="koboSpan" id="kobo.289.1">
     Here’s
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.290.1">
      the explanation:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.291.1">
       -F','
      </span>
     </strong>
     <span class="koboSpan" id="kobo.292.1">
      : This option sets the field separator to a comma.
     </span>
     <span class="koboSpan" id="kobo.292.2">
      The option tells awk to split each line into fields using commas
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.293.1">
       as delimiters.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.294.1">
       '...'
      </span>
     </strong>
     <span class="koboSpan" id="kobo.295.1">
      : The single quotes contain the awk
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.296.1">
       program itself.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.297.1">
       NR&gt;1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.298.1">
      : This condition checks whether the current record (line) number is greater than 1.
     </span>
     <span class="koboSpan" id="kobo.298.2">
      It effectively skips the first line (header) of the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.299.1">
       CSV file.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.300.1">
       {...}
      </span>
     </strong>
     <span class="koboSpan" id="kobo.301.1">
      : This block contains the main processing logic for each line that meets the
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.302.1">
        NR&gt;1
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.303.1">
       condition.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.304.1">
       gsub(/\r/,"")
      </span>
     </strong>
     <span class="koboSpan" id="kobo.305.1">
      : This function globally substitutes (
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.306.1">
       gsub
      </span>
     </strong>
     <span class="koboSpan" id="kobo.307.1">
      ) any carriage return characters (
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.308.1">
       \r
      </span>
     </strong>
     <span class="koboSpan" id="kobo.309.1">
      ) with an empty string, effectively removing them from the line.
     </span>
     <span class="koboSpan" id="kobo.309.2">
      This helps handle potential Windows-style
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.310.1">
       line endings.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.311.1">
       if($3!="")
      </span>
     </strong>
     <span class="koboSpan" id="kobo.312.1">
      : This condition checks whether the third field (severity level) is empty
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.313.1">
       or not.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.314.1">
       count[$3]++
      </span>
     </strong>
     <span class="koboSpan" id="kobo.315.1">
      : If the condition is
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.316.1">
       true
      </span>
     </strong>
     <span class="koboSpan" id="kobo.317.1">
      , this increments the count for the severity level found in the third field.
     </span>
     <span class="koboSpan" id="kobo.317.2">
      It uses an associative array named
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.318.1">
       count
      </span>
     </strong>
     <span class="koboSpan" id="kobo.319.1">
      with the severity level as
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.320.1">
       the key.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.321.1">
       END {...}
      </span>
     </strong>
     <span class="koboSpan" id="kobo.322.1">
      : This block specifies actions to be performed after processing
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.323.1">
       all lines.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.324.1">
       for (severity in count)
      </span>
     </strong>
     <span class="koboSpan" id="kobo.325.1">
      : This loop iterates over all unique severity levels stored as keys in the
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.326.1">
        count
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.327.1">
       array.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.328.1">
       print severity ": " count[severity]
      </span>
     </strong>
     <span class="koboSpan" id="kobo.329.1">
      : For each severity level, this prints the severity followed by a colon and space, then the count
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.330.1">
       of occurrences.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.331.1">
       vulnerability_scan.csv
      </span>
     </strong>
     <span class="koboSpan" id="kobo.332.1">
      : This is the
     </span>
     <a id="_idIndexMarker829">
     </a>
     <span class="koboSpan" id="kobo.333.1">
      input file that the
     </span>
     <a id="_idIndexMarker830">
     </a>
     <span class="koboSpan" id="kobo.334.1">
      AWK
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.335.1">
       command processes.
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.336.1">
     In summary, this AWK command reads a CSV file, skips the header, removes carriage returns, counts the occurrences of each non-empty severity level, and then prints out a summary of these counts.
    </span>
    <span class="koboSpan" id="kobo.336.2">
     It’s designed to handle potential issues such as Windows line endings and empty fields, making it more robust for processing real-world
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.337.1">
      CSV data.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.338.1">
     In another example, we may need to combine multiple files.
    </span>
    <span class="koboSpan" id="kobo.338.2">
     Here we have another
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.339.1">
      fil
     </span>
     <a id="_idTextAnchor469">
     </a>
     <a id="_idTextAnchor470">
     </a>
     <a id="_idTextAnchor471">
     </a>
     <span class="koboSpan" id="kobo.340.1">
      e,
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.341.1">
       asset_info.csv
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.342.1">
      :
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.343.1">
IP,Owner,Department
192.168.1.1,John,IT
192.168.1.10,Alice,Marketing
192.168.1.20,Bob,Finance
192.168.1.30,Carol,HR</span></pre>
   <p>
    <span class="koboSpan" id="kobo.344.1">
     We can combine this with our
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.345.1">
      v
     </span>
     <a id="_idTextAnchor472">
     </a>
     <a id="_idTextAnchor473">
     </a>
     <a id="_idTextAnchor474">
     </a>
     <span class="koboSpan" id="kobo.346.1">
      ul
     </span>
     <a id="_idTextAnchor475">
     </a>
     <a id="_idTextAnchor476">
     </a>
     <span class="koboSpan" id="kobo.347.1">
      nerability data:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.348.1">
$ awk -F',' 'NR==FNR {owner[$1]=$2; dept[$1]=$3; next}{print $11 "," $2 "," $3 "," owner[$1] "," dept[$1]}' asset_info.csv vulnerability_scan.csv</span></pre>
   <p>
    <span class="koboSpan" id="kobo.349.1">
     This is the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.350.1">
      resultant output:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.351.1">
IP,Vulnerability,Severity,Owner,Department
192.168.1.1,SQL Injection,High,John,IT
192.168.1.1,XSS,Medium,John,IT
192.168.1.10,Outdated SSL,Low,Alice,Marketing
192.168.1.20,Weak Password,High,Bob,Finance
192.168.1.30,Information Disclosure,Medium,Carol,HR</span></pre>
   <p>
    <span class="koboSpan" id="kobo.352.1">
     This script first
    </span>
    <a id="_idIndexMarker831">
    </a>
    <span class="koboSpan" id="kobo.353.1">
     reads
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.354.1">
      asset_info.csv
     </span>
    </strong>
    <span class="koboSpan" id="kobo.355.1">
     into memory, then processes
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.356.1">
      vulnerability_scan.csv
     </span>
    </strong>
    <span class="koboSpan" id="kobo.357.1">
     , adding the owner and department information to each
    </span>
    <a id="_idIndexMarker832">
    </a>
    <span class="koboSpan" id="kobo.358.1">
     line.
    </span>
    <span class="koboSpan" id="kobo.358.2">
     Let’s look at
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.359.1">
      the explanation:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.360.1">
       -F','
      </span>
     </strong>
     <span class="koboSpan" id="kobo.361.1">
      : This option sets the field separator to a comma, which is appropriate for
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.362.1">
       CSV files.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.363.1">
       NR==FNR
      </span>
     </strong>
     <span class="koboSpan" id="kobo.364.1">
      : This condition is true only when processing the first file (
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.365.1">
       asset_info.csv
      </span>
     </strong>
     <span class="koboSpan" id="kobo.366.1">
      ).
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.367.1">
       NR
      </span>
     </strong>
     <span class="koboSpan" id="kobo.368.1">
      is the current record number across all files, while
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.369.1">
       FNR
      </span>
     </strong>
     <span class="koboSpan" id="kobo.370.1">
      is the record number in the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.371.1">
       current file.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.372.1">
       {owner[$1]=$2; dept[$1]=$3; next}
      </span>
     </strong>
     <span class="koboSpan" id="kobo.373.1">
      : This block executes
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.374.1">
       for
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.375.1">
        asset_info.csv
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.376.1">
       :
      </span>
     </span>
     <ul>
      <li>
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.377.1">
         owner[$1]=$2
        </span>
       </strong>
       <span class="koboSpan" id="kobo.378.1">
        : Creates an associative array,
       </span>
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.379.1">
         owner
        </span>
       </strong>
       <span class="koboSpan" id="kobo.380.1">
        , where the key is the first field (an asset ID) and the value is the second field (
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.381.1">
         owner name)
        </span>
       </span>
      </li>
      <li>
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.382.1">
         dept[$1]=$3
        </span>
       </strong>
       <span class="koboSpan" id="kobo.383.1">
        : Creates an associative array,
       </span>
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.384.1">
         dept
        </span>
       </strong>
       <span class="koboSpan" id="kobo.385.1">
        , where the key is the first field and the value is the third field (
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.386.1">
         department name)
        </span>
       </span>
      </li>
      <li>
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.387.1">
         next
        </span>
       </strong>
       <span class="koboSpan" id="kobo.388.1">
        : Skips to the next record without executing th
       </span>
       <a id="_idTextAnchor477">
       </a>
       <a id="_idTextAnchor478">
       </a>
       <a id="_idTextAnchor479">
       </a>
       <span class="koboSpan" id="kobo.389.1">
        e rest of
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.390.1">
         the script
        </span>
       </span>
      </li>
     </ul>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.391.1">
       {print $1 "," $2 "," $3 "," owner[$1] "," dept[$1]}
      </span>
     </strong>
     <span class="koboSpan" id="kobo.392.1">
      : This block executes
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.393.1">
       for
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.394.1">
        vulnerability_scan.csv
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.395.1">
       :
      </span>
     </span>
     <ul>
      <li>
       <span class="koboSpan" id="kobo.396.1">
        Prints the first three fields from the current line
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.397.1">
         of
        </span>
       </span>
       <span class="No-Break">
        <strong class="source-inline">
         <span class="koboSpan" id="kobo.398.1">
          vulnerability_scan.csv
         </span>
        </strong>
       </span>
      </li>
      <li>
       <span class="koboSpan" id="kobo.399.1">
        Adds the owner and department information by looking up the first field (asset ID) in the
       </span>
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.400.1">
         owner
        </span>
       </strong>
       <span class="koboSpan" id="kobo.401.1">
        and
       </span>
       <span class="No-Break">
        <strong class="source-inline">
         <span class="koboSpan" id="kobo.402.1">
          dept
         </span>
        </strong>
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.403.1">
         arrays
        </span>
       </span>
      </li>
     </ul>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.404.1">
       asset_info.csv vulnerability_scan.csv
      </span>
     </strong>
     <span class="koboSpan" id="kobo.405.1">
      : These are the input files.
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.406.1">
       asset_info.csv
      </span>
     </strong>
     <span class="koboSpan" id="kobo.407.1">
      is processed first,
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.408.1">
       then
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.409.1">
        vulnerability_scan.csv
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.410.1">
       .
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.411.1">
     These examples demonstrate how
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.412.1">
      awk
     </span>
    </strong>
    <span class="koboSpan" id="kobo.413.1">
     can be used to process and analyze CSV data from pentesting
    </span>
    <a id="_idIndexMarker833">
    </a>
    <span class="koboSpan" id="kobo.414.1">
     activities.
    </span>
    <span class="koboSpan" id="kobo.414.2">
     By combining these techniques, you can
    </span>
    <a id="_idIndexMarker834">
    </a>
    <span class="koboSpan" id="kobo.415.1">
     create powerful scripts to automate data parsing and report generation for your
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.416.1">
      pentest findings.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.417.1">
     Bash provides several tools that can be used to parse XML data.
    </span>
    <span class="koboSpan" id="kobo.417.2">
     We’ll focus on using
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.418.1">
      xmllint
     </span>
    </strong>
    <span class="koboSpan" id="kobo.419.1">
     and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.420.1">
      xpath
     </span>
    </strong>
    <span class="koboSpan" id="kobo.421.1">
     , which are commonly available on
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.422.1">
      Linux systems.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.423.1">
     First, let’s take a look at the structure of our Nmap XML report.
    </span>
    <span class="koboSpan" id="kobo.423.2">
     The Nmap XML file can be found in this chapter’s GitHub repository as
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.424.1">
      nmap.xml
     </span>
    </strong>
    <span class="koboSpan" id="kobo.425.1">
     .
    </span>
    <span class="koboSpan" id="kobo.425.2">
     The following is the abbreviated content of this file, showing the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.426.1">
      XML nodes:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.427.1">
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE nmaprun&gt;
&lt;nmaprun scanner="nmap" ...&gt;
  &lt;scaninfo .../&gt;
  &lt;verbose .../&gt;
  &lt;debugging .../&gt;
  &lt;host ...&gt;
    &lt;status .../&gt;
    &lt;address .../&gt;
    &lt;hostnames&gt;...&lt;/hostnames&gt;
    &lt;ports&gt;
      &lt;port ...&gt;
        &lt;state .../&gt;
        &lt;service .../&gt;
        &lt;script .../&gt;
      &lt;/port&gt;
      ...
</span><span class="koboSpan" id="kobo.427.2">    &lt;/ports&gt;
    ...
</span><span class="koboSpan" id="kobo.427.3">  &lt;/host&gt;
  ...
</span><span class="koboSpan" id="kobo.427.4">&lt;/nmaprun&gt;</span></pre>
   <p>
    <span class="koboSpan" id="kobo.428.1">
     Let’s extract all the IP addresses from the scan using
    </span>
    <a id="_idTextAnchor480">
    </a>
    <a id="_idTextAnchor481">
    </a>
    <span class="koboSpan" id="kobo.429.1">
     the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.430.1">
      following command:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.431.1">
$ xmllint --xpath "//host/address[@addrtype='ipv4']/@addr" nmap.xml</span></pre>
   <p>
    <span class="koboSpan" id="kobo.432.1">
     I strongly recommend you have the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.433.1">
      nmap.xml
     </span>
    </strong>
    <span class="koboSpan" id="kobo.434.1">
     file open in GitHub and compare it to the following explanation as we step
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.435.1">
      through it.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.436.1">
     This command uses
    </span>
    <a id="_idIndexMarker835">
    </a>
    <span class="koboSpan" id="kobo.437.1">
     XPath to select all
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.438.1">
      addr
     </span>
    </strong>
    <span class="koboSpan" id="kobo.439.1">
     attributes of
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.440.1">
      address
     </span>
    </strong>
    <span class="koboSpan" id="kobo.441.1">
     elements
    </span>
    <a id="_idIndexMarker836">
    </a>
    <span class="koboSpan" id="kobo.442.1">
     that are children of
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.443.1">
      host
     </span>
    </strong>
    <span class="koboSpan" id="kobo.444.1">
     elements and have an
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.445.1">
      addrtype
     </span>
    </strong>
    <span class="koboSpan" id="kobo.446.1">
     of
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.447.1">
      ipv4
     </span>
    </strong>
    <span class="koboSpan" id="kobo.448.1">
     .
    </span>
    <span class="koboSpan" id="kobo.448.2">
     With this information in mind, go back and read the XML data again to see this
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.449.1">
      XML structure.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.450.1">
     Here’s
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.451.1">
      the explanation:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.452.1">
       //host
      </span>
     </strong>
     <span class="koboSpan" id="kobo.453.1">
      : This selects all host elements anywhere in
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.454.1">
       the document.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.455.1">
       /address
      </span>
     </strong>
     <span class="koboSpan" id="kobo.456.1">
      : This selects address elements that are direct children of the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.457.1">
       host elements.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.458.1">
       [@addrtype='ipv4']
      </span>
     </strong>
     <span class="koboSpan" id="kobo.459.1">
      : This is a predicate that filters for address elements where the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.460.1">
       addrtype
      </span>
     </strong>
     <span class="koboSpan" id="kobo.461.1">
      attribute
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.462.1">
       equals
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.463.1">
        ipv4
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.464.1">
       .
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.465.1">
       /@addr
      </span>
     </strong>
     <span class="koboSpan" id="kobo.466.1">
      : This selects the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.467.1">
       addr
      </span>
     </strong>
     <span class="koboSpan" id="kobo.468.1">
      attribute of the matching
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.469.1">
       address elements.
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.470.1">
     The output can be seen in the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.471.1">
      following figure:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer189">
     <span class="koboSpan" id="kobo.472.1">
      <img alt="Figure 13.1 – The output of the Nmap XML filter" src="image/B22229_13_01.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.473.1">
     Figure 13.1 – The output of the Nmap XML filter
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.474.1">
     Let’s create a
    </span>
    <a id="_idIndexMarker837">
    </a>
    <span class="koboSpan" id="kobo.475.1">
     more complex filter using two criteria from the Nmap XML
    </span>
    <a id="_idIndexMarker838">
    </a>
    <span class="koboSpan" id="kobo.476.1">
     data.
    </span>
    <span class="koboSpan" id="kobo.476.2">
     We’ll find all hosts that have port
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.477.1">
      80
     </span>
    </strong>
    <span class="koboSpan" id="kobo.478.1">
     open and are running Microsoft IIS.
    </span>
    <span class="koboSpan" id="kobo.478.2">
     This combines filtering on port status and
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.479.1">
      service information.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.480.1">
     H
    </span>
    <a id="_idTextAnchor482">
    </a>
    <a id="_idTextAnchor483">
    </a>
    <a id="_idTextAnchor484">
    </a>
    <span class="koboSpan" id="kobo.481.1">
     ere’s how we can
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.482.1">
      do this:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.483.1">
$ xmllint --xpath "//host[ports/port[@portid='80' and state/@state='open' and service/@product='Microsoft IIS httpd']]/address[@addrtype='ipv4']/@addr" nmap.xml</span></pre>
   <p>
    <span class="koboSpan" id="kobo.484.1">
     Here, you can see the output of the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.485.1">
      preceding command:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer190">
     <span class="koboSpan" id="kobo.486.1">
      <img alt="Figure 13.2 – The output of the command" src="image/B22229_13_02.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.487.1">
     Figure 13.2 – The output of the command
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.488.1">
     As you can see, this is as simple as combining multiple XML queries separated by
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.489.1">
      and
     </span>
    </strong>
    <span class="koboSpan" id="kobo.490.1">
     .
    </span>
    <span class="koboSpan" id="kobo.490.2">
     If you want to include ports
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.491.1">
      80
     </span>
    </strong>
    <span class="koboSpan" id="kobo.492.1">
     or
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.493.1">
      443
     </span>
    </strong>
    <span class="koboSpan" id="kobo.494.1">
     , separate them with an
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.495.1">
       or
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.496.1">
      keyword.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.497.1">
     Next, let’s examine how to parse JSON data.
    </span>
    <span class="koboSpan" id="kobo.497.2">
     In these examples, I’m using the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.498.1">
      mapcidr
     </span>
    </strong>
    <span class="koboSpan" id="kobo.499.1">
     and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.500.1">
      httpx
     </span>
    </strong>
    <span class="koboSpan" id="kobo.501.1">
     tools from ProjectDiscovery.
    </span>
    <span class="koboSpan" id="kobo.501.2">
     My lab network has the network address
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.502.1">
      10.2.10.0/24
     </span>
    </strong>
    <span class="koboSpan" id="kobo.503.1">
     .
    </span>
    <span class="koboSpan" id="kobo.503.2">
     I run the following command to fingerprint HTTP/S se
    </span>
    <a id="_idTextAnchor485">
    </a>
    <a id="_idTextAnchor486">
    </a>
    <span class="koboSpan" id="kobo.504.1">
     rvers on my
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.505.1">
      lab network:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.506.1">
echo 10.2.10.0/24 | mapcidr -silent | httpx -silent -j &gt; httpx.json</span></pre>
   <p>
    <span class="koboSpan" id="kobo.507.1">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.508.1">
      httpx.json
     </span>
    </strong>
    <span class="koboSpan" id="kobo.509.1">
     file can be found in this chapter’s directory in the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.510.1">
      GitHub repository.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.511.1">
     Let’s look at
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.512.1">
      the explanation:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.513.1">
       echo 10.2.10.0/24 |
      </span>
     </strong>
     <span class="koboSpan" id="kobo.514.1">
      : This simply sends the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.515.1">
       10.2.10.0/24
      </span>
     </strong>
     <span class="koboSpan" id="kobo.516.1">
      string into the pipeline (
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.517.1">
       |
      </span>
     </strong>
     <span class="koboSpan" id="kobo.518.1">
      ) and suppresses the program’s
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.519.1">
       banner (
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.520.1">
        -silent
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.521.1">
       ).
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.522.1">
       mapcidr -silent |
      </span>
     </strong>
     <span class="koboSpan" id="kobo.523.1">
      : This takes the input, expands it into individual IP addresses, and passes them into
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.524.1">
       the pipeline.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.525.1">
       httpx -silent -j
      </span>
     </strong>
     <span class="koboSpan" id="kobo.526.1">
      : This takes the IP addresses passed in as
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.527.1">
       stdin
      </span>
     </strong>
     <span class="koboSpan" id="kobo.528.1">
      input, fingerprints any webservers listening on default ports, and prints the output in
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.529.1">
       JSON format.
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.530.1">
     The following
    </span>
    <a id="_idIndexMarker839">
    </a>
    <span class="koboSpan" id="kobo.531.1">
     shows the abbreviated
    </span>
    <a id="_idIndexMarker840">
    </a>
    <span class="koboSpan" id="kobo.532.1">
     output of
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.533.1">
      this command:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.534.1">
{"timestamp":"2024-08-24T17:17:41.515583292-04:00","port":"80","url":"http://10.2.10.10","input":"10.2.10.10","title":"IIS Windows Server","scheme":"http","webserver":"Microsoft-IIS/10.0","content_type":"text/html","method":"GET","host":"10.2.10.10","path":"/","time":"91.271935ms","a":["10.2.10.10"],"tech":["IIS:10.0","Microsoft ASP.NET","Windows Server"],"words":27,"lines":32,"status_code":200,"content_length":703,"failed":false,"knowledgebase":{"PageType":"nonerror","pHash":0}}</span></pre>
   <p>
    <span class="koboSpan" id="kobo.535.1">
     The first thing you should do when examining JSON data structures is view the hierarchy by passing the data to
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.536.1">
      jq .
     </span>
    </strong>
    <span class="koboSpan" id="kobo.537.1">
     .
    </span>
    <span class="koboSpan" id="kobo.537.2">
     The following example command uses JSON to output all data in the file in a format that’s easier to read to determine how the data
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.538.1">
      is structured:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.539.1">
cat httpx.json | jq .</span></pre>
   <p>
    <span class="koboSpan" id="kobo.540.1">
     The abbreviated output of this command can be seen in the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.541.1">
      following figure:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer191">
     <span class="koboSpan" id="kobo.542.1">
      <img alt="Figure 13.3 – The JSON data structure from httpx" src="image/B22229_13_03.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.543.1">
     Figure 13.3 – The JSON data structure from httpx
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.544.1">
     The following script
    </span>
    <a id="_idIndexMarker841">
    </a>
    <span class="koboSpan" id="kobo.545.1">
     parses this JSON data and outputs each field, one per
    </span>
    <a id="_idIndexMarker842">
    </a>
    <span class="koboSpan" id="kobo.546.1">
     line.
    </span>
    <span class="koboSpan" id="kobo.546.2">
     Let’s examine each line of the script to learn how to parse the JSON fields.
    </span>
    <span class="koboSpan" id="kobo.546.3">
     This script can be found in this chapter’s GitHub repository
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.547.1">
      as
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.548.1">
       ch13_parse_httpx.sh
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.549.1">
      :
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.550.1">
#!/usr/bin/env bash
# Function to parse a single JSON object
parse_json() {
    local json="$1"
    # Extract specific fields
    local timestamp=$(echo "$json" | jq -r '.timestamp')
    local url=$(echo "$json" | jq -r '.url')
    local title=$(echo "$json" | jq -r '.title')
    local webserver=$(echo "$json" | jq -r '.webserver')
    local status_code=$(echo "$json" | jq -r '.status_code')
    # Print extracted information
    echo "Timestamp: $timestamp"
    echo "URL: $url"
    echo "Title: $title"
    echo "Web Server: $webserver"
    echo "Status Code: $status_code"
    echo "---"
}
# Read JSON objects line by line
while IFS= read -r line; do
    parse_json "$line"
done</span></pre>
   <p>
    <span class="koboSpan" id="kobo.551.1">
     The
    </span>
    <a id="_idIndexMarker843">
    </a>
    <span class="koboSpan" id="kobo.552.1">
     output is
    </span>
    <a id="_idIndexMarker844">
    </a>
    <span class="koboSpan" id="kobo.553.1">
     shown in the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.554.1">
      following figure:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer192">
     <span class="koboSpan" id="kobo.555.1">
      <img alt="Figure 13.4 – The output of script ch13_parse_httpx.sh" src="image/B22229_13_04.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.556.1">
     Figure 13.4 – The output of script ch13_parse_httpx.sh
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.557.1">
     Now, let’s discuss how to adapt this lesson to any
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.558.1">
      JSON output:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.559.1">
       Identify the structure
      </span>
     </strong>
     <span class="koboSpan" id="kobo.560.1">
      : First, examine your JSON output to understand its structure.
     </span>
     <span class="koboSpan" id="kobo.560.2">
      Look for the key fields you want
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.561.1">
       to extract.
      </span>
     </span>
    </li>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.562.1">
       Modify the
      </span>
     </strong>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.563.1">
       parse_json
      </span>
     </strong>
     <strong class="bold">
      <span class="koboSpan" id="kobo.564.1">
       function
      </span>
     </strong>
     <span class="koboSpan" id="kobo.565.1">
      : Update the function to extract the fields specific to your JSON structure.
     </span>
     <span class="koboSpan" id="kobo.565.2">
      For example, if your JSON has a field called
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.566.1">
       user_name
      </span>
     </strong>
     <span class="koboSpan" id="kobo.567.1">
      , you add
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.568.1">
       the following:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.569.1">local user_name=$(echo "$json" | jq -r '.user_name')</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.570.1">
      Modify the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.571.1">
       echo
      </span>
     </strong>
     <span class="koboSpan" id="kobo.572.1">
      statements to print the fields you’ve extracted.
     </span>
     <span class="koboSpan" id="kobo.572.2">
      If your JSON contains nested objects or arrays, you can use more complex
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.573.1">
       jq
      </span>
     </strong>
     <span class="koboSpan" id="kobo.574.1">
      queries.
     </span>
     <span class="koboSpan" id="kobo.574.2">
      Here’s
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.575.1">
       an example:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.576.1">local first_tech=$(echo "$json" | jq -r '.tech[0]')</span></strong></pre>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.577.1">
     Before examining the preceding code, take a look at
    </span>
    <span class="No-Break">
     <em class="italic">
      <span class="koboSpan" id="kobo.578.1">
       Figure 13
      </span>
     </em>
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.579.1">
      .3
     </span>
    </em>
    <span class="koboSpan" id="kobo.580.1">
     and find the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.581.1">
      tech
     </span>
    </strong>
    <span class="koboSpan" id="kobo.582.1">
     node.
    </span>
    <span class="koboSpan" id="kobo.582.2">
     Using
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.583.1">
      .tech[0]
     </span>
    </strong>
    <span class="koboSpan" id="kobo.584.1">
     , we selected and returned the first result in the array.
    </span>
    <span class="koboSpan" id="kobo.584.2">
     If you wanted to return all array results, you would instead use
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.585.1">
      .tech[]
     </span>
    </strong>
    <span class="koboSpan" id="kobo.586.1">
     , which is the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.587.1">
      whole array.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.588.1">
     The following are
    </span>
    <a id="_idIndexMarker845">
    </a>
    <span class="koboSpan" id="kobo.589.1">
     quick tips to help you pa
    </span>
    <a id="_idTextAnchor487">
    </a>
    <a id="_idTextAnchor488">
    </a>
    <span class="koboSpan" id="kobo.590.1">
     rse nested JSON data
    </span>
    <a id="_idIndexMarker846">
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.591.1">
      with
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.592.1">
       jq
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.593.1">
      :
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.594.1">
      For nested objects, use dot
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.595.1">
       notation:
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.596.1">
        .parent.child
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.597.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.598.1">
      For arrays, use
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.599.1">
       brackets:
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.600.1">
        .array[]
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.601.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.602.1">
      Combine these for deeply nested
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.603.1">
       structures:
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.604.1">
        .parent.array[].child
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.605.1">
       .
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.606.1">
     Let’s expand on how to select nested data with examples.
    </span>
    <span class="koboSpan" id="kobo.606.2">
     Review the following JSON data before
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.607.1">
      moving on:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.608.1">
{
  "parent": {
    "name": "Family Tree",
    "child": {
      "name": "John",
      "age": 10
    },
    "siblings": [
      {
        "child": {
          "name": "Emma",
          "age": 8
        }
      },
      {
        "child": {
          "name": "Michael",
          "age": 12
        }
      }
    ]
  }
}</span></pre>
   <p>
    <span class="koboSpan" id="kobo.609.1">
     Next, let’s
    </span>
    <a id="_idIndexMarker847">
    </a>
    <span class="koboSpan" id="kobo.610.1">
     examine some example
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.611.1">
      jq
     </span>
    </strong>
    <span class="koboSpan" id="kobo.612.1">
     queries for this
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.613.1">
      nested
     </span>
    </span>
    <span class="No-Break">
     <a id="_idIndexMarker848">
     </a>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.614.1">
      structure:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.615.1">
      Get the parent name:
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.616.1">
        jq '.parent.name'
       </span>
      </strong>
     </span>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.617.1">
       Output:
      </span>
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.618.1">
        "
       </span>
      </strong>
      <span class="No-Break">
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.619.1">
         Family Tree"
        </span>
       </strong>
      </span>
     </p>
    </li>
    <li>
     <span class="koboSpan" id="kobo.620.1">
      Get direct child’s name:
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.621.1">
        jq '.parent.child.name'
       </span>
      </strong>
     </span>
     <p class="list-inset">
      <span class="No-Break">
       <span class="koboSpan" id="kobo.622.1">
        Output:
       </span>
      </span>
      <span class="No-Break">
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.623.1">
         "John"
        </span>
       </strong>
      </span>
     </p>
    </li>
    <li>
     <span class="koboSpan" id="kobo.624.1">
      Get all sibling names (array traversal):
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.625.1">
        jq '.parent.siblings[].child.name'
       </span>
      </strong>
     </span>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.626.1">
       Output:
      </span>
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.627.1">
        "
       </span>
      </strong>
      <span class="No-Break">
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.628.1">
         Emma" "Michael"
        </span>
       </strong>
      </span>
     </p>
    </li>
    <li>
     <span class="koboSpan" id="kobo.629.1">
      Get all ages from both direct child and siblings:
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.630.1">
       jq '.
      </span>
     </strong>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.631.1">
        parent.child.age, .parent.siblings[].child.age'
       </span>
      </strong>
     </span>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.632.1">
       Output:
      </span>
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.633.1">
        10
       </span>
      </strong>
      <span class="No-Break">
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.634.1">
         8 12
        </span>
       </strong>
      </span>
     </p>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.635.1">
     Armed with the knowledge needed to parse common pentest tool report formats, you’re prepared for the next step.
    </span>
    <span class="koboSpan" id="kobo.635.2">
     In the next section, you’ll learn how to store data parsed from pentest tool reports into
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.636.1">
      SQLite databases.
     </span>
    </span>
   </p>
   <h1 id="_idParaDest-209">
    <a id="_idTextAnchor489">
    </a>
    <span class="koboSpan" id="kobo.637.1">
     Storing and managing pentest data with SQLite
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.638.1">
     SQLite
    </span>
    <a id="_idIndexMarker849">
    </a>
    <span class="koboSpan" id="kobo.639.1">
     is a lightweight, serverless database engine that provides an efficient way to store and manage data collected during pentesting.
    </span>
    <span class="koboSpan" id="kobo.639.2">
     This section explores how to leverage SQLite in conjunction with Bash scripting to create a system for organizing and querying
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.640.1">
      pentest findings.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.641.1">
     SQLite offers several advantages
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.642.1">
      for pentesters:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.643.1">
       Portability
      </span>
     </strong>
     <span class="koboSpan" id="kobo.644.1">
      : SQLite
     </span>
     <a id="_idIndexMarker850">
     </a>
     <span class="koboSpan" id="kobo.645.1">
      databases are self-contained files, making them easy to transfer and
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.646.1">
       back up.
      </span>
     </span>
    </li>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.647.1">
       No setup required
      </span>
     </strong>
     <span class="koboSpan" id="kobo.648.1">
      : Unlike full-fledged database servers, SQLite doesn’t need installation
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.649.1">
       or configuration.
      </span>
     </span>
    </li>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.650.1">
       Efficient querying
      </span>
     </strong>
     <span class="koboSpan" id="kobo.651.1">
      : SQLite supports SQL, allowing for complex data retrieval
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.652.1">
       and analysis.
      </span>
     </span>
    </li>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.653.1">
       Language integration
      </span>
     </strong>
     <span class="koboSpan" id="kobo.654.1">
      : Many programming languages, including Bash through command-line tools, can interact with
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.655.1">
       SQLite databases.
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.656.1">
     In this section, we’ll cover the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.657.1">
      following topics:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.658.1">
      How to create SQLite databases using
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.659.1">
       Bash commands?
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.660.1">
      How to write scripts that parse tool output and insert data into
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.661.1">
       SQLite tables?
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.662.1">
      How to run queries on SQLite databases to generate
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.663.1">
       report content?
      </span>
     </span>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.664.1">
     By combining Bash
    </span>
    <a id="_idIndexMarker851">
    </a>
    <span class="koboSpan" id="kobo.665.1">
     scripting with SQLite, pentesters can create a flexible and powerful system for managing test data and streamlining the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.666.1">
      reporting process.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.667.1">
     First, let’s create an
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.668.1">
      SQLite3
     </span>
    </strong>
    <span class="koboSpan" id="kobo.669.1">
     database to store our Nmap scan results.
    </span>
    <span class="koboSpan" id="kobo.669.2">
     The following script can be found in
    </span>
    <a id="_idTextAnchor490">
    </a>
    <a id="_idTextAnchor491">
    </a>
    <span class="koboSpan" id="kobo.670.1">
     this chapter’s GitH
    </span>
    <a id="_idTextAnchor492">
    </a>
    <a id="_idTextAnchor493">
    </a>
    <span class="koboSpan" id="kobo.671.1">
     ub repository
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.672.1">
      as
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.673.1">
       ch13_create
      </span>
      <a id="_idTextAnchor494">
      </a>
      <a id="_idTextAnchor495">
      </a>
      <span class="koboSpan" id="kobo.674.1">
       _db.sh
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.675.1">
      :
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.676.1">
#!/usr/bin/env bash
DB_NAME="pentest_results.db"
sqlite3 $DB_NAME &lt;&lt;EOF
CREATE TABLE IF NOT EXISTS nmap_scans (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    ip_address TEXT,
    hostname TEXT,
    port INTEGER,
    protocol TEXT,
    service TEXT,
    version TEXT,
    scan_date DATETIME DEFAULT CURRENT_TIMESTAMP,
    vulnerability TEXT
);
EOF</span></pre>
   <p>
    <span class="koboSpan" id="kobo.677.1">
     Here’s
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.678.1">
      the explanation:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.679.1">
      First, it
     </span>
     <a id="_idIndexMarker852">
     </a>
     <span class="koboSpan" id="kobo.680.1">
      defines the database name
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.681.1">
       as
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.682.1">
        pentest_results.db
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.683.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.684.1">
      Then, it uses a heredoc (
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.685.1">
       &lt;&lt;EOF
      </span>
     </strong>
     <span class="koboSpan" id="kobo.686.1">
      ) to pass SQL commands
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.687.1">
       to
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.688.1">
        SQLite3
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.689.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.690.1">
      Next, it creates a table named
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.691.1">
       nmap_scans
      </span>
     </strong>
     <span class="koboSpan" id="kobo.692.1">
      if it doesn’t
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.693.1">
       already exist.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.694.1">
      Lastly, it defines columns for IP address, hostname, port, protocol, service, version, scan date,
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.695.1">
       and vulnerability.
      </span>
     </span>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.696.1">
     Next, let’s create a script that takes an Nmap scan as input and inserts the results into our database.
    </span>
    <span class="koboSpan" id="kobo.696.2">
     The following script can be found in
    </span>
    <a id="_idTextAnchor496">
    </a>
    <a id="_idTextAnchor497">
    </a>
    <span class="koboSpan" id="kobo.697.1">
     this chapter’s GitH
    </span>
    <a id="_idTextAnchor498">
    </a>
    <a id="_idTextAnchor499">
    </a>
    <span class="koboSpan" id="kobo.698.1">
     ub repository
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.699.1">
      as
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.700.1">
       ch13_nmap_to_db.sh
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.701.1">
      :
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.702.1">
#!/usr/bin/env bash
DB_NAME="pentest_results.db"
xmlstarlet sel -t -m "//host" \
    -v "address/@addr" -o "|" \
    -v "hostnames/hostname/@name" -o "|" \
    -m "ports/port" \
        -v "@portid" -o "|" \
        -v "@protocol" -o "|" \
        -v "service/@name" -o "|" \
        -v "service/@version" -n \
    "$1" | while IFS='|' read -r ip hostname port protocol service version; do
    sqlite3 $DB_NAME &lt;&lt;EOF
INSERT INTO nmap_scans (ip_address, hostname, port, protocol, service, version)
VALUES ('$ip', '$hostname', '$port', '$protocol', '$service', '$version');
EOF
done</span></pre>
   <p>
    <span class="koboSpan" id="kobo.703.1">
     Execute the script
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.704.1">
      as follows:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.705.1">
$ ./ch13_nmap_to_db.sh nmap.xml</span></pre>
   <p>
    <span class="koboSpan" id="kobo.706.1">
     When the script
    </span>
    <a id="_idIndexMarker853">
    </a>
    <span class="koboSpan" id="kobo.707.1">
     completes, it will print
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.708.1">
      Data import completed
     </span>
    </strong>
    <span class="koboSpan" id="kobo.709.1">
     to
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.710.1">
      the terminal.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.711.1">
     Let’s look at
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.712.1">
      the explanation:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.713.1">
      The
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.714.1">
       DB_NAME
      </span>
     </strong>
     <span class="koboSpan" id="kobo.715.1">
      variable defines the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.716.1">
       database name.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.717.1">
      It uses
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.718.1">
       xmlstarlet
      </span>
     </strong>
     <span class="koboSpan" id="kobo.719.1">
      to parse the XML Nmap report, extracting
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.720.1">
       relevant information.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.721.1">
      It then formats the extracted data with
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.722.1">
       |
      </span>
     </strong>
     <span class="koboSpan" id="kobo.723.1">
      as
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.724.1">
       a delimiter.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.725.1">
      A
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.726.1">
       while
      </span>
     </strong>
     <span class="koboSpan" id="kobo.727.1">
      loop is used to read the formatted data line
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.728.1">
       by line.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.729.1">
      For each line, it inserts the data into the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.730.1">
       nmap_scans
      </span>
     </strong>
     <span class="koboSpan" id="kobo.731.1">
      table
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.732.1">
       using
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.733.1">
        sqlite3
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.734.1">
       .
      </span>
     </span>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.735.1">
     You may have noticed that our database has a field for
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.736.1">
      vulnerability
     </span>
    </strong>
    <span class="koboSpan" id="kobo.737.1">
     , but we didn’t insert any data in this field because we were only populating data from the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.738.1">
      Nmap scan.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.739.1">
     To update an
    </span>
    <a id="_idIndexMarker854">
    </a>
    <span class="koboSpan" id="kobo.740.1">
     existing record in the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.741.1">
      nmap_scans
     </span>
    </strong>
    <span class="koboSpan" id="kobo.742.1">
     table to add a vulnerability where it was previously NULL, you can use the SQL UPDATE statement.
    </span>
    <span class="koboSpan" id="kobo.742.2">
     Here’s how you can do this using Bash and the Sqlite3
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.743.1">
      command-line tool:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.744.1">
$ sqlite3 pentest_results.db "UPDATE nmap_scans SET vulnerability = 'VULNERABILITY_DESCRIPTION' WHERE ip_address = 'IP_ADDRESS' AND port = PORT_NUMBER AND vulnerability IS NULL;"</span></pre>
   <p>
    <span class="koboSpan" id="kobo.745.1">
     Replace the placeholders with your
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.746.1">
      actual data:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.747.1">
       VULNERABILITY_DESCRIPTION
      </span>
     </strong>
     <span class="koboSpan" id="kobo.748.1">
      : The description of the vulnerability you want
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.749.1">
       to add.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.750.1">
       IP_ADDRESS
      </span>
     </strong>
     <span class="koboSpan" id="kobo.751.1">
      : The IP address of the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.752.1">
       target system.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.753.1">
       PORT_NUMBER
      </span>
     </strong>
     <span class="koboSpan" id="kobo.754.1">
      : The port number where the vulnerability
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.755.1">
       was found.
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.756.1">
     For example, if you want to update the record for the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.757.1">
      10.2.10.10
     </span>
    </strong>
    <span class="koboSpan" id="kobo.758.1">
     IP on port
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.759.1">
      80
     </span>
    </strong>
    <span class="koboSpan" id="kobo.760.1">
     to add an
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.761.1">
      SQL Injection vulnerability
     </span>
    </strong>
    <span class="koboSpan" id="kobo.762.1">
     de
    </span>
    <a id="_idTextAnchor500">
    </a>
    <a id="_idTextAnchor501">
    </a>
    <a id="_idTextAnchor502">
    </a>
    <span class="koboSpan" id="kobo.763.1">
     scription, you will use
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.764.1">
      the following:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.765.1">
$ sqlite3 pentest_results.db "UPDATE nmap_scans SET vulnerability = 'SQL Injection vulnerability' WHERE ip_address = 10.2.10.10 AND port = 80 AND vulnerability IS NULL;"</span></pre>
   <p>
    <span class="koboSpan" id="kobo.766.1">
     This command will update the vulnerability field for the record that matches the specified IP address and port, but only if the vulnerability field is currently
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.767.1">
      NULL
     </span>
    </strong>
    <span class="koboSpan" id="kobo.768.1">
     .
    </span>
    <span class="koboSpan" id="kobo.768.2">
     This ensures you don’t overwrite any existing
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.769.1">
      vulnerability descriptions.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.770.1">
     If you want to update the vulnerability regardless of whether it’s
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.771.1">
      NULL
     </span>
    </strong>
    <span class="koboSpan" id="kobo.772.1">
     or not, you can remove th
    </span>
    <a id="_idTextAnchor503">
    </a>
    <a id="_idTextAnchor504">
    </a>
    <a id="_idTextAnchor505">
    </a>
    <span class="koboSpan" id="kobo.773.1">
     e
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.774.1">
      AND vulnerability IS
     </span>
    </strong>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.775.1">
       NULL
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.776.1">
      condition:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.777.1">
$ sqlite3 pentest_results.db "UPDATE nmap_scans SET vulnerability = 'SQL Injection vulnerability' WHERE ip_address = 10.2.10.10' AND port = 80;"</span></pre>
   <p>
    <span class="koboSpan" id="kobo.778.1">
     Now that we
    </span>
    <a id="_idIndexMarker855">
    </a>
    <span class="koboSpan" id="kobo.779.1">
     have data in our database, let’s create a script to query and display the results.
    </span>
    <span class="koboSpan" id="kobo.779.2">
     The following script can be found
    </span>
    <a id="_idTextAnchor506">
    </a>
    <a id="_idTextAnchor507">
    </a>
    <span class="koboSpan" id="kobo.780.1">
     in this chapter’s GitHub repository
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.781.1">
      as
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.782.1">
       ch13_read_db.sh
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.783.1">
      :
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.784.1">
#!/usr/bin/env bash
DB_NAME="pentest_results.db"
# Function to truncate strings to a specified length
truncate() {
    local str="$1"
    local max_length="$2"
    if [ ${#str} -gt $max_length ]; then
        echo "${str:0:$max_length-3}..."
</span><span class="koboSpan" id="kobo.784.2">    else
        printf "%-${max_length}s" "$str"
    fi
}
# Print header
printf "%-15s | %-15s | %-5s | %-8s | %-15s | %-20s | %s\n" \
    "IP Address" "Hostname" "Port" "Protocol" "Service" "Version" "Vulnerability"
printf "%s\n" "$(printf '=%.0s' {1..109})"
# Query and format the results
sqlite3 -separator "|" "$DB_NAME" "SELECT ip_address, hostname, port, protocol, service, version, vulnerability FROM nmap_scans ORDER BY ip_address, port;" |
while IFS='|' read -r ip hostname port protocol service version vulnerability; do
    ip=$(truncate "$ip" 15)
    hostname=$(truncate "$hostname" 15)
    port=$(truncate "$port" 5)
    protocol=$(truncate "$protocol" 8)
    service=$(truncate "$service" 15)
    version=$(truncate "$version" 20)
    vulnerability=$(truncate "$vulnerability" 20)
    printf "%-15s | %-15s | %-5s | %-8s | %-15s | %-20s | %s\n" \
        "$ip" "$hostname" "$port" "$protocol" "$service" "$version" "$vulnerability"
done
echo "Query completed."</span></pre>
   <p>
    <span class="koboSpan" id="kobo.785.1">
     The following
    </span>
    <a id="_idIndexMarker856">
    </a>
    <span class="koboSpan" id="kobo.786.1">
     figure shows the output from
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.787.1">
      this script:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer193">
     <span class="koboSpan" id="kobo.788.1">
      <img alt="Figure 13.5 – The database contents" src="image/B22229_13_05.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.789.1">
     Figure 13.5 – The database contents
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.790.1">
     Here’s an explanation of
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.791.1">
      the code:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.792.1">
       DB_NAME="pentest_results.db"
      </span>
     </strong>
     <span class="koboSpan" id="kobo.793.1">
      sets a variable with the name of the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.794.1">
       database file.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.795.1">
      The
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.796.1">
       truncate()
      </span>
     </strong>
     <span class="koboSpan" id="kobo.797.1">
      function is defined.
     </span>
     <span class="koboSpan" id="kobo.797.2">
      It takes two arguments: a string and a maximum length.
     </span>
     <span class="koboSpan" id="kobo.797.3">
      It checks whether the string is longer than the maximum length.
     </span>
     <span class="koboSpan" id="kobo.797.4">
      If it is, it cuts the string short and adds
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.798.1">
       ...
      </span>
     </strong>
     <span class="koboSpan" id="kobo.799.1">
      at the end.
     </span>
     <span class="koboSpan" id="kobo.799.2">
      If not, it pads the string with spaces to reach the maximum length.
     </span>
     <span class="koboSpan" id="kobo.799.3">
      This function helps format the output to fit in
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.800.1">
       fixed-width columns.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.801.1">
      The script then prints a header row.
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.802.1">
       printf
      </span>
     </strong>
     <span class="koboSpan" id="kobo.803.1">
      is used to format the output.
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.804.1">
       %-15s
      </span>
     </strong>
     <span class="koboSpan" id="kobo.805.1">
      means left-align this string and pad it to 15 characters.
     </span>
     <span class="koboSpan" id="kobo.805.2">
      The
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.806.1">
       |
      </span>
     </strong>
     <span class="koboSpan" id="kobo.807.1">
      characters are used to visually separate columns.
     </span>
     <span class="koboSpan" id="kobo.807.2">
      A line of equal signs is printed to separate the header from the data.
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.808.1">
       printf '=%.0s' {1..109}
      </span>
     </strong>
     <span class="koboSpan" id="kobo.809.1">
      prints 109
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.810.1">
       equal signs.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.811.1">
      The script then queries the database.
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.812.1">
       sqlite3
      </span>
     </strong>
     <span class="koboSpan" id="kobo.813.1">
      is the command to interact with the SQLite database.
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.814.1">
       -separator "|"
      </span>
     </strong>
     <span class="koboSpan" id="kobo.815.1">
      tells SQLite to use pipe characters (
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.816.1">
       |)
      </span>
     </strong>
     <span class="koboSpan" id="kobo.817.1">
      to separate columns in its output.
     </span>
     <span class="koboSpan" id="kobo.817.2">
      The SQL query selects all columns from the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.818.1">
       nmap_scans
      </span>
     </strong>
     <span class="koboSpan" id="kobo.819.1">
      table, ordered by IP address
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.820.1">
       and port.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.821.1">
      The output
     </span>
     <a id="_idIndexMarker857">
     </a>
     <span class="koboSpan" id="kobo.822.1">
      of the query is piped into a while loop.
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.823.1">
       IFS='|
      </span>
     </strong>
     <span class="koboSpan" id="kobo.824.1">
      ’ sets the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.825.1">
       Internal Field Separator
      </span>
     </strong>
     <span class="koboSpan" id="kobo.826.1">
      to
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.827.1">
       |
      </span>
     </strong>
     <span class="koboSpan" id="kobo.828.1">
      , which tells the script how to split the
     </span>
     <a id="_idIndexMarker858">
     </a>
     <span class="koboSpan" id="kobo.829.1">
      input into fields.
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.830.1">
       read -r
      </span>
     </strong>
     <span class="koboSpan" id="kobo.831.1">
      reads a line of input and splits it into variables.
     </span>
     <span class="koboSpan" id="kobo.831.2">
      Inside the loop, each field (
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.832.1">
       ip
      </span>
     </strong>
     <span class="koboSpan" id="kobo.833.1">
      ,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.834.1">
       hostname
      </span>
     </strong>
     <span class="koboSpan" id="kobo.835.1">
      , etc.) is processed by the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.836.1">
       truncate
      </span>
     </strong>
     <span class="koboSpan" id="kobo.837.1">
      function.
     </span>
     <span class="koboSpan" id="kobo.837.2">
      This ensures each field fits within its designated column width.
     </span>
     <span class="koboSpan" id="kobo.837.3">
      The formatted data is then printed using
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.838.1">
       printf
      </span>
     </strong>
     <span class="koboSpan" id="kobo.839.1">
      .
     </span>
     <span class="koboSpan" id="kobo.839.2">
      This creates neatly aligned columns in
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.840.1">
       the output.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.841.1">
      After the loop ends,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.842.1">
       Query completed.
      </span>
     </strong>
     <span class="koboSpan" id="kobo.843.1">
      is printed to indicate the script has
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.844.1">
       finished running.
      </span>
     </span>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.845.1">
     This script takes data from an SQLite database and presents it in a neatly formatted table, making it easy to read and analyze the results of
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.846.1">
      network scans.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.847.1">
     By using these scriptdatabase andtomate the process of running Nmap scans, storing the results in a SQLite3 database, and querying the data for analysis.
    </span>
    <span class="koboSpan" id="kobo.847.2">
     This approach allows for efficient data management and retrieval during
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.848.1">
      pentesting activities.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.849.1">
     In the next section, you’ll learn how to extract data from the database and integrate it with
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.850.1">
      reporting tools.
     </span>
    </span>
   </p>
   <h1 id="_idParaDest-210">
    <a id="_idTextAnchor508">
    </a>
    <span class="koboSpan" id="kobo.851.1">
     Integrating Bash with reporting tools
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.852.1">
     Writing a
    </span>
    <a id="_idIndexMarker859">
    </a>
    <span class="koboSpan" id="kobo.853.1">
     pentest report is both the most important as
    </span>
    <a id="_idIndexMarker860">
    </a>
    <span class="koboSpan" id="kobo.854.1">
     well as the least liked part of any pentest.
    </span>
    <span class="koboSpan" id="kobo.854.2">
     Customers or system owners never get to see the work you do.
    </span>
    <span class="koboSpan" id="kobo.854.3">
     Their opinion of how well you performed a pentest depends on the quality of the report.
    </span>
    <span class="koboSpan" id="kobo.854.4">
     Pentesters usually dislike reporting because it’s not nearly as fun as
    </span>
    <span class="No-Break">
     <em class="italic">
      <span class="koboSpan" id="kobo.855.1">
       popping shells
      </span>
     </em>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.856.1">
      .
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.857.1">
     Automating data normalization and report generation can significantly improve report quality while reducing time spent on reporting.
    </span>
    <span class="koboSpan" id="kobo.857.2">
     This section provides Bash tools and techniques to streamline your reporting process.
    </span>
    <span class="koboSpan" id="kobo.857.3">
     While not creating a comprehensive pentest report, it offers adaptable examples you can tailor to your standards
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.858.1">
      and workflow.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.859.1">
     This section will cover the basics of LaTeX, explain how to interact with the SQLite3 database using Bash, and demonstrate how to generate a
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.860.1">
      PDF report.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.861.1">
     LaTeX
    </span>
    <a id="_idIndexMarker861">
    </a>
    <span class="koboSpan" id="kobo.862.1">
     is a high-quality typesetting system designed for the production of technical and scientific documentation.
    </span>
    <span class="koboSpan" id="kobo.862.2">
     It is widely used in academia and professional settings for creating complex documents with consistent formatting, mathematical equations,
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.863.1">
      and cross-references.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.864.1">
     For pentesters, LaTeX offers
    </span>
    <a id="_idIndexMarker862">
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.865.1">
      several advantages:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.866.1">
      Consistent formatting across
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.867.1">
       large documents
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.868.1">
      Easy integration of code snippets and
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.869.1">
       command outputs
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.870.1">
      Ability to generate professional-looking
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.871.1">
       reports programmatically
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.872.1">
      Support for complex tables
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.873.1">
       and figures
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.874.1">
     Let’s start by creating a Bash script to query our
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.875.1">
      SQLite3
     </span>
    </strong>
    <span class="koboSpan" id="kobo.876.1">
     database and format the results for use in our LaTeX document.
    </span>
    <span class="koboSpan" id="kobo.876.2">
     The following script can be
    </span>
    <a id="_idTextAnchor509">
    </a>
    <a id="_idTextAnchor510">
    </a>
    <span class="koboSpan" id="kobo.877.1">
     found in this chapter’s GitHub repository
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.878.1">
      as
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.879.1">
       ch13_generate_report.sh
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.880.1">
      :
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.881.1">
#!/usr/bin/env bash
DB_NAME="pentest_results.db"
# Function to query the database and format results
query_db() {
    sqlite3 -header -csv $DB_NAME "$1"
}
# Get all unique IP addresses
ip_addresses=$(query_db "SELECT DISTINCT ip_address FROM nmap_scans;")
# Create LaTeX content
create_latex_content() {
    echo "\\documentclass{article}"
    echo "\\usepackage[margin=1in]{geometry}"
    echo "\\usepackage{longtable}"
    echo "\\usepackage{pdflscape}"
    echo "\\begin{document}"
    echo "\\title{Penetration Test Report}"
    echo "\\author{Your Name}"
    echo "\\maketitle"
    echo "\\section{Scan Results}"
    IFS=$'\n'
    for ip in $ip_addresses; do
        echo "\\subsection{IP Address: $ip}"
        echo "\\begin{landscape}"
        echo "\\begin{longtable}{|p{2cm}|p{2cm}|p{1.5cm}|p{1.5cm}|p{3cm}|p{3cm}|p{4cm}|}"
        echo "\\hline"
        echo "Hostname &amp; IP &amp; Port &amp; Protocol &amp; Service &amp; Version &amp; Vulnerability \\\\ \\hline"
        echo "\\endfirsthead"
        echo "\\hline"
        echo "Hostname &amp; IP &amp; Port &amp; Protocol &amp; Service &amp; Version &amp; Vulnerability \\\\ \\hline"
        echo "\\endhead"
        query_db "SELECT hostname, ip_address, port, protocol, service, version, vulnerability
                  FROM nmap_scans
                  WHERE ip_address='$ip';" | sed 's/,/ \&amp; /g; s/$/\\\\ \\hline/'
        echo "\\end{longtable}"
        echo "\\end{landscape}"
    done
    echo "\\end{document}"
}
# Generate LaTeX file
create_latex_content &gt; pentest_report.tex
# Compile LaTeX to PDF
pdflatex pentest_report.tex</span></pre>
   <p>
    <span class="koboSpan" id="kobo.882.1">
     Let’s
    </span>
    <a id="_idIndexMarker863">
    </a>
    <span class="koboSpan" id="kobo.883.1">
     look at
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.884.1">
      the
     </span>
    </span>
    <span class="No-Break">
     <a id="_idIndexMarker864">
     </a>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.885.1">
      explanation:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.886.1">
       query_db()
      </span>
     </strong>
     <span class="koboSpan" id="kobo.887.1">
      : This creates a function to query
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.888.1">
       the database.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.889.1">
       sqlite3 -header -csv $DB_NAME "$1"
      </span>
     </strong>
     <span class="koboSpan" id="kobo.890.1">
      : This function executes SQLite queries.
     </span>
     <span class="koboSpan" id="kobo.890.2">
      It uses the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.891.1">
       -header
      </span>
     </strong>
     <span class="koboSpan" id="kobo.892.1">
      option to include column names and
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.893.1">
       -csv
      </span>
     </strong>
     <span class="koboSpan" id="kobo.894.1">
      to output in
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.895.1">
       CSV format.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.896.1">
       escape_latex()
      </span>
     </strong>
     <span class="koboSpan" id="kobo.897.1">
      : This function escapes special LaTeX characters to prevent
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.898.1">
       compilation errors.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.899.1">
       ip_addresses=$(query_db "SELECT DISTINCT ip_address FROM nmap_scans WHERE vulnerability IS NOT NULL AND vulnerability != '';" | tail -n +2)
      </span>
     </strong>
     <span class="koboSpan" id="kobo.900.1">
      : This query fetches all unique IP addresses with vulnerabilities, skipping the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.901.1">
       header row.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.902.1">
       create_latex_content()
      </span>
     </strong>
     <span class="koboSpan" id="kobo.903.1">
      : This function generates the LaTeX
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.904.1">
       document structure.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.905.1">
       for ip in $ip_addresses; do
      </span>
     </strong>
     <span class="koboSpan" id="kobo.906.1">
      : This loop processes each IP address, creating a subsection
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.907.1">
       for each.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.908.1">
       query_db "SELECT hostname,…
      </span>
     </strong>
     <span class="koboSpan" id="kobo.909.1">
      : This nested loop processes each vulnerability for a given IP address, formatting it for the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.910.1">
       LaTeX table.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.911.1">
      These commands generate the LaTeX file and compile it into
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.912.1">
       a PDF:
      </span>
     </span>
     <ul>
      <li>
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.913.1">
         create_latex_content &gt;
        </span>
       </strong>
       <span class="No-Break">
        <strong class="source-inline">
         <span class="koboSpan" id="kobo.914.1">
          pentest_report.tex
         </span>
        </strong>
       </span>
      </li>
      <li>
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.915.1">
         pdflatex -
        </span>
       </strong>
       <span class="No-Break">
        <strong class="source-inline">
         <span class="koboSpan" id="kobo.916.1">
          interaction=nonstopmode pentest_report.tex
         </span>
        </strong>
       </span>
      </li>
     </ul>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.917.1">
     To generate
    </span>
    <a id="_idIndexMarker865">
    </a>
    <span class="koboSpan" id="kobo.918.1">
     your
    </span>
    <a id="_idIndexMarker866">
    </a>
    <span class="koboSpan" id="kobo.919.1">
     pente
    </span>
    <a id="_idTextAnchor511">
    </a>
    <a id="_idTextAnchor512">
    </a>
    <span class="koboSpan" id="kobo.920.1">
     st report, simply run the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.921.1">
      Bash script:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.922.1">
$ chmod +x ch13_generate_report.sh
./generate_report.sh</span></pre>
   <p>
    <span class="koboSpan" id="kobo.923.1">
     This will create a file named
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.924.1">
      pentest_report.pdf
     </span>
    </strong>
    <span class="koboSpan" id="kobo.925.1">
     in your
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.926.1">
      current directory.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.927.1">
     The following figure shows our very simple
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.928.1">
      pentest report:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer194">
     <span class="koboSpan" id="kobo.929.1">
      <img alt="Figure 13.6 – Our simple pentest report PDF" src="image/B22229_13_06.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.930.1">
     Figure 13.6 – Our simple pentest report PDF
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.931.1">
     You can further
    </span>
    <a id="_idIndexMarker867">
    </a>
    <span class="koboSpan" id="kobo.932.1">
     customize your report by adding more sections, such as
    </span>
    <a id="_idIndexMarker868">
    </a>
    <span class="koboSpan" id="kobo.933.1">
     an executive summary or recommendations, including graphics or charts to visualize data, using LaTeX packages for syntax highlighting of
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.934.1">
      code snippets.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.935.1">
     For example, to add an executive summary, you could modify the
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.936.1">
       create_latex_content
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.937.1">
      function:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.938.1">
create_latex_content() {
    # ... </span><span class="koboSpan" id="kobo.938.2">(previous content)
    echo "\\section{Executive Summary}"
    echo "This penetration test was conducted to assess the security posture of the target network.
</span><span class="koboSpan" id="kobo.938.3">    The scan revealed multiple vulnerabilities across various systems, including outdated software versions and misconfigured services. </span><span class="koboSpan" id="kobo.938.4">Detailed findings are presented in the following sections."
</span><span class="koboSpan" id="kobo.938.5">    # ... </span><span class="koboSpan" id="kobo.938.6">(rest of the content)
}</span></pre>
   <p>
    <span class="koboSpan" id="kobo.939.1">
     This section explored methods for using Bash scripts to streamline the creation of professional pentesting reports.
    </span>
    <span class="koboSpan" id="kobo.939.2">
     It covered techniques for interfacing Bash with document preparation systems such as LaTeX to generate polished PDF reports.
    </span>
    <span class="koboSpan" id="kobo.939.3">
     Adapt the provided methodology to your own standards to streamline your
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.940.1">
      reporting process.
     </span>
    </span>
   </p>
   <h1 id="_idParaDest-211">
    <a id="_idTextAnchor513">
    </a>
    <span class="koboSpan" id="kobo.941.1">
     Summary
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.942.1">
     This chapter focused on using Bash to streamline the reporting phase of pentesting.
    </span>
    <span class="koboSpan" id="kobo.942.2">
     It covered techniques for automating data collection, organizing findings, and generating comprehensive reports.
    </span>
    <span class="koboSpan" id="kobo.942.3">
     We explored how to extract relevant information from tool outputs, parse and clean data, and store it efficiently using SQLite databases.
    </span>
    <span class="koboSpan" id="kobo.942.4">
     We also addressed integrating Bash scripts with reporting tools such as LaTeX to create professional PDF reports.
    </span>
    <span class="koboSpan" id="kobo.942.5">
     By leveraging Bash for these tasks, pentesters can significantly reduce the time and effort required for report generation while ensuring accuracy and consistency in
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.943.1">
      their findings.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.944.1">
     The next chapter will examine methods for creating Bash scripts that can evade detection by endpoint security during
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.945.1">
      pentesting engagements.
     </span>
    </span>
   </p>
  </div>
 </body></html>