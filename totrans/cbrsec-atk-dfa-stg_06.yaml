- en: Chasing a User's Identity
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In the last chapter, you learned different techniques you can use to compromise
    a system. However, in the current threat landscape, compromised credentials are
    now being used to compromise systems and networks further. According to the 2016
    *Data Breach Investigation Report* from Verizon, 63% of confirmed data breaches
    happened due to weak, default, or stolen passwords, which was driven by the number
    of attacks targeting the user's credentials. This threat landscape pushes enterprises
    to develop new strategies to enhance the overall security aspect of a user's identity.
  prefs: []
  type: TYPE_NORMAL
- en: 'In this chapter, we''re going to be covering the following topics:'
  prefs: []
  type: TYPE_NORMAL
- en: Identity is the new perimeter
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Strategies to compromise a user's identity
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Hacking a user's identity
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Identity is the new perimeter
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: As was briefly explained in [Chapter 1](3a4a477a-d673-4f0d-bbe8-f8e2a1289d38.xhtml),
    *Security Posture* the protection surrounding the identity must be enhanced, and
    that's why the industry is in common agreement that identity is the new perimeter.
    This occurs because every time a new credential is created, the majority of the
    time this credential is composed only of a username and password. While multifactor
    authentication is gaining popularity, it is still not the default method used
    to authenticate users. On top of that, there are lots of legacy systems that rely
    purely on usernames and passwords in order to work properly.
  prefs: []
  type: TYPE_NORMAL
- en: 'Credential theft is a growing trend in different scenarios, such as:'
  prefs: []
  type: TYPE_NORMAL
- en: '**Enterprise users**: Hackers that are trying to gain access to a corporate
    network and want to infiltrate without making any noise. One of the best ways
    to do that is by using valid credentials to authenticate, and be part of, the
    network.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Home users**: Many banking Trojans, such as the Dridex family, are still
    actively in use because they target a user''s bank credentials, and that''s where
    money is.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The problem with this current identity threat landscape is that home users are
    also corporate users, and are bringing their own devices to consume corporate
    data. Now you have a scenario where a user's identity for his personal application,
    resides in the same device that has his corporate credentials in use to access
    corporate-related data.
  prefs: []
  type: TYPE_NORMAL
- en: The problem with users handling multiple credentials for different tasks is
    that users might utilize the same password for these different services.
  prefs: []
  type: TYPE_NORMAL
- en: For example, a user using the same password for his cloud-based email service
    and corporate domain credentials will help hackers because they only need to identify
    the username, since once one password is cracked, all others will be the same.
    Nowadays, browsers are being used as the main platform for users to consume applications,
    and browser's vulnerabilities can be exploited to steal a user's credentials.
    Such a scenario happened in May 2017, when a vulnerability was discovered in Google
    Chrome.
  prefs: []
  type: TYPE_NORMAL
- en: 'Although the issue seems to be related to end users and enterprises, the reality
    is that no one is safe, and anyone can be targeted, even someone in politics.
    In an attack revealed in June 2017 by *The Times*, it was reported that the email
    addresses and passwords of Justine Greening (the education secretary) and Greg
    Clark (the business secretary) of the UK government, were among the tens of thousands
    of government officials'' credentials that were stolen, and later sold on the
    darknet. The problem with stolen credentials is not only using those credentials
    to access privileged information, but also being used to start a targeted spear-phishing
    campaign. The following diagram shows an example of how stolen credentials can
    be used:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](assets/3ab621f4-4488-4aa2-a832-1afe729cae82.png)'
  prefs: []
  type: TYPE_IMG
- en: An interesting part of the workflow shown in the previous diagram, is that the
    hacker doesn't really need to prepare the entire infrastructure to launch the
    attack. Nowadays, they can just rent bots that belong to someone else. This strategy
    was used in 2016 during the IoT DDoS attack, and according to ZingBox, *"*the
    price for 50,000 bots with attack duration of 3600 secs (1 hour) and 5-10-minute
    cooldown time is approximately $3,000 to $4,000 per 2 weeks."
  prefs: []
  type: TYPE_NORMAL
- en: As cloud computing grows, the amount of **Software as a Service** (**SaaS**)
    apps that use the cloud provider's identity management system also grows, which
    means, more Google accounts, more Microsoft Azure accounts, and so on. These cloud
    vendors usually offer two-factor authentication, to add an extra layer of protection.
    However, the weakest link is still the user, which means this is not a bulletproof
    system. While it is correct to say that two-factor authentication enhances the
    security of the authentication process, it has been proved that it is possible
    to hack into this process.
  prefs: []
  type: TYPE_NORMAL
- en: One famous example of broken two-factor authentication involved the activist
    DeRay Mckesson. Hackers called Verizon, and using social engineering skills, they
    pretended they were Mckesson, and convinced them that his phone had a problem.
    They convinced the Verizon technician to reset his SIM card. They activated the
    new SIM with the phone in their possession, and when the text message came the
    hackers were able to get the code and it was game over.
  prefs: []
  type: TYPE_NORMAL
- en: Strategies for compromising a user's identity
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'As you can see, identity plays a big role in how hackers gain access to the
    system and execute their mission, which in most cases is to access privileged
    data or hijack that data. The **Red Team** must be aware of all these risks, and
    how to exploit them during the attack exercise. For this reason, it is important
    to establish a plan of attack before we start acting. This plan should take into
    consideration the current threat landscape, which includes three stages:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](assets/8441f5cf-c690-4430-8596-921e5c3a058c.png)'
  prefs: []
  type: TYPE_IMG
- en: During **Stage 1**, the **Red Team** will study the different adversaries that
    the company has. In other words, who can potentially attack us? The first step
    to answer this question is to perform a self-assessment and understand what type
    of information the company has, and who would benefit from obtaining it. You might
    not be able to map all adversaries, but at least you will be able to create a
    basic adversary profile, and based on that you can move on to the next stage.
  prefs: []
  type: TYPE_NORMAL
- en: In **Stage 2**, the **Red Team** will research the most common attacks launched
    by these adversaries. Remember, that many of these groups have a pattern. While
    it is not fully guaranteed that they will use the same technique, they might use
    a similar workflow. By understanding the category of the attack, and how they
    are created, you can try to emulate something similar during your attack exercise.
  prefs: []
  type: TYPE_NORMAL
- en: The last stage again starts with research, but this time to understand how these
    attacks are executed, the order in which they were executed, and so on.
  prefs: []
  type: TYPE_NORMAL
- en: The goal here is to learn from this stage, and apply them to production during
    the exercise. What the Red Team is doing here is just trying to be accurate with
    reality. It doesn't really help if the Red Team starts an attack exercise without
    a purpose and without tangible evidence that other hacking groups might do the
    same.
  prefs: []
  type: TYPE_NORMAL
- en: Another important aspect of this planning phase is to understand that attackers
    will not stop if they fail to infiltrate on the first attempt, they are likely
    to attack again, but this time using different techniques, until they are able
    to break in. The Red Team must operate with this hacker mindset, and continue
    their mission despite initial failure.
  prefs: []
  type: TYPE_NORMAL
- en: The Red Team needs to define some strategies to gain access to user credentials,
    and continue their attack within the network until the mission is accomplished.
    In most cases the mission is to gain access to privileged information. Therefore,
    before you start the exercise it is important to be clear on this mission. Efforts
    must be synchronized and organized otherwise you increase the likelihood of being
    caught, and the Blue Team wins.
  prefs: []
  type: TYPE_NORMAL
- en: It is important to keep in mind that this is a suggestion of how to create attack
    exercises. Each company should perform a self-assessment, and based on the result
    of this assessment, create exercises that are relevant to their reality.
  prefs: []
  type: TYPE_NORMAL
- en: Gaining access to the network
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Part of the planning process is to gain access to a user''s credentials and
    understand how to get access to the internal network from outside (external-internet).
    One of the most successful attacks is still the old phishing email. The reason
    this attack is so successful is because it uses social engineering techniques
    to entice the end user to perform a specific action. Before creating a crafted
    email with a malicious dropper, it is recommended to perform recon using social
    media to try to understand the target user''s behavior outside of work. Try to
    identify things such as:'
  prefs: []
  type: TYPE_NORMAL
- en: Hobbies
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Places that he/she usually checks into
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Preferred food
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Sites that are commonly visited
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The intent here is to be able to create a crafted email that it is relevant
    to one of those subjects. By elaborating an email that has relevance to the user's
    daily activities you are increasing the likelihood that this user will read the
    email, and take the desired action.
  prefs: []
  type: TYPE_NORMAL
- en: Harvesting credentials
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: If during the recon process you have already identified unpatched vulnerabilities
    that could lead to credential exploitation, this could be the easiest path to
    take.
  prefs: []
  type: TYPE_NORMAL
- en: For example, if the target computer is vulnerable to CVE-2017-8563 (allows an
    elevation of privilege vulnerability due to Kerberos falling back to NTLM Authentication
    Protocol), it will be easier to perform a privilege escalation, and potentially
    gain access to a local administrator account. Most attackers will perform a lateral
    movement within the network, trying to obtain access to an account that has privileged
    access to the system, therefore the same approach should be used by the Red Team.
  prefs: []
  type: TYPE_NORMAL
- en: One attack that gained popularity once Hernan Ochoa published the Pass-The-Hash
    Toolkit, is the pass-the-hash attack. To understand how this attack works, you
    need to understand that a password has a hash, and this hash is a direct, one-way,
    mathematical derivation of the password itself, which only changes when the user
    changes the password. Depending on how the authentication is performed, it is
    possible to present the password hash instead of a plaintext password as proof
    of the user's identity to the operating system. Once the attacker obtains this
    hash, he can use it to assume the identity of the user (victim), and continue
    his attack within the network.
  prefs: []
  type: TYPE_NORMAL
- en: '![](assets/4bf3b813-76dc-4c57-aac9-025cfd580e7a.png)'
  prefs: []
  type: TYPE_IMG
- en: Lateral movement is very useful for compromising more machines within the environment,
    and it can also be used to hop between systems to harvest more valuable information.
  prefs: []
  type: TYPE_NORMAL
- en: Remember that the mission is to obtain sensitive data, and sometimes you don't
    need to move to the server in order to obtain this data.
  prefs: []
  type: TYPE_NORMAL
- en: In the previous image, there was a lateral movement from Alex to Sandra's computer,
    and a privilege escalation from Sandra to the web server. This can be done because
    within Sandra's workstation there was another user that had administrative access
    to this server.
  prefs: []
  type: TYPE_NORMAL
- en: It is important to emphasize that the account that was harvested locally by
    the attacker cannot be used in further attacks. Using the previous diagram as
    an example, if a domain admin account was never used to authenticate on Alex and
    Sandra's workstations, this account will not be available to an attacker that
    has compromised these workstations.
  prefs: []
  type: TYPE_NORMAL
- en: 'As mentioned previously, to execute the pass the hash attack successful, you
    must obtain access to an account with administrative privileges on the Windows
    system. Once the Red Team gains access to the local computer, they can try to
    steal the hash from the following locations:'
  prefs: []
  type: TYPE_NORMAL
- en: The **Security Accounts Manager** (**SAM**) database
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The **Local Security Authority Subsystem** (**LSASS**) process memory
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The **Domain Active Directory Database** (domain controllers only)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The **Credential Manager** (**CredMan**) store
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The **Local Security Authority** (**LSA**) secrets in the registry
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: In the next section, you will learn how to perform these actions in a lab environment
    prior to executing your attack exercise.
  prefs: []
  type: TYPE_NORMAL
- en: Hacking a user's identity
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Now that you know the strategies, it is time for some hands-on activity. However,
    before that, here are some important considerations:'
  prefs: []
  type: TYPE_NORMAL
- en: Do not perform these steps in a production environment
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Create an isolated lab to test any type of Red Team operation
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Once all tests are done and validated, make sure you build your own plan to
    reproduce these tasks in a production environment as part of the Red Team attack
    exercise
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Before performing the attack exercise, make sure you have the agreement of your
    manager, and that the entire command chain is aware of this exercise
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The tests that follow could be applied in an on-premises environment, as well
    as in a VM located in the cloud (IaaS).
  prefs: []
  type: TYPE_NORMAL
- en: Brute force
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'The first attack exercise might be the oldest one, but it is still valid for
    testing two aspects of your defense controls:'
  prefs: []
  type: TYPE_NORMAL
- en: '**The accuracy of your monitoring system**: Since brute force attacks may cause
    noise, it is expected that your defense security controls can catch the activity
    while it is happening. If it doesn''t catch it, you have a serious problem in
    your defense strategy.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**How strong is your password policy?**: If your password policy is weak, chances
    are that this attack will be able to obtain many credentials. If it does, you
    have another serious problem.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: For this exercise, there is an assumption that the attacker is already part
    of the network and it could be a case of an internal threat trying to compromise
    a user's credentials for nefarious reasons.
  prefs: []
  type: TYPE_NORMAL
- en: 'On a Linux computer running Kali, open the Applications menu, click Exploitation
    Tools, and select metasploit-framework:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](assets/f2052b54-0a16-4862-b3c9-26937910f2d1.png)'
  prefs: []
  type: TYPE_IMG
- en: 'When the Metasploit console opens, type `use exploit/windows/smb/psexec`, and
    your prompt will change as shown in the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](assets/bb7044f2-83cd-4582-83a3-0dda24ca3ba7.png)'
  prefs: []
  type: TYPE_IMG
- en: Now, switch prompt again since you will leverage the SMB Login Scanner. For
    that, type `use auxiliary/scanner/smb/smb_login`. Configure the remote host using
    the command `set rhosts <target>`, configure the user that you want to attack
    with the command set `smbuser <username>`, and make sure to turn verbose mode
    on by using the command `set verbose true`.
  prefs: []
  type: TYPE_NORMAL
- en: 'Once all this is done, you can follow the steps from the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](assets/58bcce10-e7da-433a-b78d-5a735b092e97.png)'
  prefs: []
  type: TYPE_IMG
- en: As you can see, the command sequence is simple. The power of the attack relies
    on the password file. If this file contains a lot of combinations you increase
    the likelihood of success, but it will also take more time and potentially trigger
    alerts in the monitoring system due to the amount of SMB traffic. If, for some
    reason, it does raise alerts, as a member of the Red Team you should back off,
    and try a different approach.
  prefs: []
  type: TYPE_NORMAL
- en: Social engineering
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: The next exercise starts from outside. In other words, the attacker is coming
    from the internet, and gaining access to the system in order to perform the attack.
    One approach to that is by driving the user's activity to a malicious site in
    order to obtain a user's identity.
  prefs: []
  type: TYPE_NORMAL
- en: Another method that is commonly used is sending a phishing email that will install
    a piece of malware in the local computer. Since this is one of the most effective
    methods, we will use this one for this example. To prepare this crafted email,
    we will use the **Social Engineering Toolkit** (**SET**) which comes with Kali.
  prefs: []
  type: TYPE_NORMAL
- en: 'On the Linux computer running Kali, open the Applications menu, click Exploitation
    Tools, and select Social Engineering Toolkit:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](assets/0bff682c-7a22-4f7b-802a-416e58488309.png)'
  prefs: []
  type: TYPE_IMG
- en: 'On this initial screen you have six options to select from. Since the intent
    is to create a crafted email that will be used for a socially engineered attack,
    select option 1 and you will see the following screen:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](assets/99128da9-0d01-4387-8bd6-4fdd4cd2e459.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Select the first option in this screen, which will allow you to start creating
    a crafted email to be used in your spear-phishing attack:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](assets/6b01d3e6-03ab-4ee8-b21d-6c3d34fa0ee9.png)'
  prefs: []
  type: TYPE_IMG
- en: As member of the Red Team, you probably don't want to use the first option (mass
    email attack), since you have a very specific target obtained during your recon
    process via social media.
  prefs: []
  type: TYPE_NORMAL
- en: 'For this reason, the right choices at this point are either the second (payload)
    or the third (template). For the purpose of this example, you will use the second
    option:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](assets/24a08d4c-49f2-4b7d-aeaf-7147aef8ac0c.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Let''s say that during your recon process you noticed that the user you are
    targeting uses a lot of PDF files, which makes him a very good candidate to open
    an email that has a PDF attached. In this case, select option 16 (Adobe PDF Embedded
    EXE Social Engineering), and you will see the following screen:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](assets/c865d084-3a8a-44f2-94de-0e106094c664.png)'
  prefs: []
  type: TYPE_IMG
- en: 'The option that you choose here depends on having a PDF or not. If you, as
    a member of the Red Team, have a crafted PDF, select option 1, but for the purpose
    of this example use option 2 to use a built-in blank PDF for this attack. Once
    you select this option the following screen appears:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](assets/c78c5028-b8e3-47cf-8399-a829c50730a4.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Select option 2, and follow the interactive prompt that appears asking about
    your local IP address to be used as `LHOST`, and the port to connect back with
    this host:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](assets/e04e0b89-b275-4a7e-9469-180733725076.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Now you want to be cool, and select the second option to customize the file
    name. In this case the file name will be `financialreport.pdf`. Once you type
    the new name, the available options are shown as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](assets/6606457e-bf51-4cd0-96dc-ece408c1a8d9.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Since this is a specific-target attack, and you know the email addresses of
    the victim, select the first option:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](assets/731a3e83-d610-47ac-bdd9-302638866e9d.png)'
  prefs: []
  type: TYPE_IMG
- en: 'In this case, we will select the status report, and after selecting this option
    you have to provide the target''s email and the sender''s email. Notice that for
    this case, we are using the second option, which is a Gmail account:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](assets/65cf2a1e-9be7-4b70-b203-8e7c25042c73.png)'
  prefs: []
  type: TYPE_IMG
- en: 'At this point the file `financialreport.pdf` is already saved in the local
    system. You can use the command `ls` to view the location of this file as shown
    in the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](assets/7f7989b0-aa91-4510-9a18-8de9d1d3ea5a.png)'
  prefs: []
  type: TYPE_IMG
- en: This 60 KB PDF file will be enough for you to gain access to the user's command
    prompt and from there use `mimikatz` to compromise a user's credentials as you
    will see in the next section.
  prefs: []
  type: TYPE_NORMAL
- en: 'If you want to evaluate the content of this PDF, you can use the PDF Examiner
    from [https://www.malwaretracker.com/pdfsearch.php](https://www.malwaretracker.com/pdfsearch.php).
    Upload the PDF file to this site, click submit, and check the results. The core
    report should look like this:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](assets/0a1ada22-bf56-4453-b2a9-77e056fb2da3.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Notice that there is an execution of an `.exe` file. If you click on the hyperlink
    for this line, you will see that this executable is `cmd.exe`, as shown in the
    following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](assets/84ff8e18-1405-4842-9902-72e2ff0ceef3.png)'
  prefs: []
  type: TYPE_IMG
- en: The last decoding piece of this report shows the action Launch for the executable
    `cmd.exe`.
  prefs: []
  type: TYPE_NORMAL
- en: Pass the hash
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: At this point you have access to `cmd.exe`, and from there you can launch PowerShell
    using the command `start powershell -NoExit`. The reason you want to launch PowerShell
    is because you want to download `mimikatz` from GitHub.
  prefs: []
  type: TYPE_NORMAL
- en: 'To do that, run the following command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: 'Also, make sure to download the PsExec tool from Sysinternals, since you will
    need it later. To do that, use the following command from the same PowerShell
    console:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: 'In the PowerShell console, use the command `expand-archive -path` to extract
    the content from `mimikatz_trunk.zip`. Now you can launch `mimikatz`. One of the
    first steps is to verify if the user running command prompt has administrative
    privileges. If they do, you will see the following results when you run the `privilege::debug`
    command:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](assets/c5b61ae2-2925-4b07-9edc-4f9a6ccb6802.png)'
  prefs: []
  type: TYPE_IMG
- en: The next step is to dump all active users, services, and their associated NTLM/SHA1
    hashes. This is a very important step, because it will give you an idea of the
    number of users that you can try to compromise to continue your mission.
  prefs: []
  type: TYPE_NORMAL
- en: 'To do that, use the command `sekurlsa::logonpasswords`:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](assets/ff26de25-f529-4053-8736-c0078812629a.png)'
  prefs: []
  type: TYPE_IMG
- en: If the target computer is running any Windows version up to Windows 7, you may
    see the actual password in clear text. The reason we say "may," is because if
    the target computer has the MS16-014 update installed, Windows will forcibly clear
    leaked logon session credentials after 30 seconds.
  prefs: []
  type: TYPE_NORMAL
- en: 'Moving forward you can perform the attack, since you now have had the hash.
    The attack can be performed on a Windows system using mimikatz and the `psexec`
    tool (the one that you downloaded previously). For this scenario, we are going
    to use the following command as an example:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs: []
  type: TYPE_PRE
- en: 'The command prompt will open using the context of that particular user. If
    that user has administrative privileges, it''s game over. The execution of the
    attack can also be done from Metasploit, on a computer running Kali. The sequence
    of commands is shown as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs: []
  type: TYPE_PRE
- en: 'Once these steps are done, run the `exploit` command and see the results:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](assets/23bde0ee-2f8d-4989-bcf2-c98197028101.png)'
  prefs: []
  type: TYPE_IMG
- en: Since this is only a Red Team exercise, the intent here is to prove that the
    system is vulnerable to this type of attack. Notice that we didn't compromise
    any data, only showed how vulnerable the entire identity protection really is.
  prefs: []
  type: TYPE_NORMAL
- en: Other methods to hack identity
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: While it is safe to say that a lot of damage can be done using the three approaches
    that were previously mentioned, it also safe to say that there are still more
    ways to hack identities. The Red Team can use the cloud infrastructure as the
    target for the attack. The Nimbostratus tool by Andres Riancho is a great resource
    for exploiting Amazon Cloud infrastructure.
  prefs: []
  type: TYPE_NORMAL
- en: As a member of the Red Team, you may also need to pursue attacks against the
    hypervisor (VMWare or Hyper-V). For this type of attack, you can use PowerMemory
    ([https://github.com/giMini/PowerMemory/](https://github.com/giMini/PowerMemory/))
    to exploit the VM's passwords.
  prefs: []
  type: TYPE_NORMAL
- en: References
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Stealing Windows Credentials Using Google Chrome: [http://defensecode.com/news_article.php?id=21](http://defensecode.com/news_article.php?id=21)'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Russian hackers selling login credentials of UK politicians, diplomats - report
    [https://www.theregister.co.uk/2017/06/23/russian_hackers_trade_login_credentials/](https://www.theregister.co.uk/2017/06/23/russian_hackers_trade_login_credentials/)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Botnet-as-a-Service is For Sale this Cyber Monday! [https://www.zingbox.com/blog/botnet-as-a-service-is-for-sale-this-cyber-monday/](https://www.zingbox.com/blog/botnet-as-a-service-is-for-sale-this-cyber-monday/)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'How Anywhere Computing Just Killed Your Phone-Based Two-Factor Authentication:
    [http://fc16.ifca.ai/preproceedings/24_Konoth.pdf](http://fc16.ifca.ai/preproceedings/24_Konoth.pdf)'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Attackers Hit Weak Spots in 2-Factor Authentication: [https://krebsonsecurity.com/2012/06/attackers-target-weak-spots-in-2-factor-authentication/](https://krebsonsecurity.com/2012/06/attackers-target-weak-spots-in-2-factor-authentication/)'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Microsoft Windows CVE-2017-8563 Remote Privilege Escalation Vulnerability:
    [https://www.symantec.com/security_response/vulnerability.jsp?bid=99402](https://www.symantec.com/security_response/vulnerability.jsp?bid=99402)'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Pass-The-Hash Toolkit: [https://www.coresecurity.com/corelabs-research-special/open-source-tools/pass-hash-toolkit](https://www.coresecurity.com/corelabs-research-special/open-source-tools/pass-hash-toolkit)'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Nimbostratus Tool: [http://andresriancho.github.io/nimbostratus/](http://andresriancho.github.io/nimbostratus/)'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: How activist DeRay Mckesson's Twitter account was hacked
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[https://techcrunch.com/2016/06/10/how-activist-deray-mckessons-twitter-account-was-hacked/](https://techcrunch.com/2016/06/10/how-activist-deray-mckessons-twitter-account-was-hacked/)'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Summary
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In this chapter, you learned about the importance of identity for the overall
    security posture of an organization. You learned about the different strategies
    to compromise a user's identity that can be used by the Red Team. By learning
    more about the current threat landscape, the potential adversaries, and how they
    act, you can create a more accurate attack exercise to test the defense security
    controls. You learned about brute force attacks, social engineering using SET
    from Kali, pass-the-hash, and how these attacks can be used to perform lateral
    movement in order to accomplish the attack's mission.
  prefs: []
  type: TYPE_NORMAL
- en: In the next chapter, you will learn more about lateral movement, how the Red
    Team will use the hacker's mindset to continue their mission of mapping the network,
    and avoiding alerts.
  prefs: []
  type: TYPE_NORMAL
