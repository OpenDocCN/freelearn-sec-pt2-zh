<html><head></head><body><div id="sbo-rt-content"><div id="_idContainer089">
			<h1 id="_idParaDest-185"><em class="italic"><a id="_idTextAnchor188"/>Chapter 7</em>: System Hacking</h1>
			<p>System hacking refers to the activities hackers use to gain access to, and compromise, digital devices such as computers, smartphones, tablets, and even entire networks. This course explains the main methods of system hacking—password cracking, privilege escalation, spyware installation, keylogging, and other tactics. We'll also learn the countermeasures <strong class="bold">information technology</strong> (<strong class="bold">IT</strong>) security professionals can use to fight different attacks.</p>
			<p>Learning about system hacking will help you implement the strongest possible security practices and help you assess your current security protection and which possible vulnerabilities may be on your systems and networks. You'll learn which security features work the best for your environment, how to discover and fix security vulnerabilities, and how to anticipate them. </p>
			<p>In this chapter, we will cover the following topics:</p>
			<ul>
				<li>Understanding our objectives</li>
				<li>Phase 1 – Gaining access and cracking passwords</li>
				<li>Phase 2 – Escalating privileges</li>
				<li>Phase 3 – Maintaining access and executing applications</li>
				<li>Phase 4 – Maintaining access and hiding your tools</li>
				<li>Phase 5 – Covering your tracks – Clearing logs and evidence</li>
			</ul>
			<h1 id="_idParaDest-186"><a id="_idTextAnchor189"/>Understanding our objectives</h1>
			<p>We have <a id="_idIndexMarker694"/>three goals for this chapter, as follows:</p>
			<ul>
				<li><strong class="bold">Gain access to the target</strong>: Identify the target, understanding the services available and which ports are open. Also, understand the user accounts that may be on the machine and, possibly, some vulnerabilities. </li>
				<li><strong class="bold">Maintain access</strong>: Nothing's worse than getting into a machine only to be kicked out later because someone has made it more difficult for us to get in a second time. </li>
				<li><strong class="bold">Covering your tracks</strong>: If you love watching animal or nature documentaries, as I do, you know dogs are genetically related to wolves, which explains why they have a lot in common. They particularly share one disgusting habit—eating their <a id="_idIndexMarker695"/>feces to cover their tracks, because their feces would announce their presence to other predators or prey in the area. As with wolves and dogs, we need to cover our tracks. If we don't, people will see that we're in the system. They will reimage the system or take it offline, fix all the problems we've created, and restrict our access. Covering your tracks is part of maintaining that access.</li>
			</ul>
			<p>To accomplish these three goals, there are five phases we must pass through during the system hacking stage. </p>
			<h2 id="_idParaDest-187"><a id="_idTextAnchor190"/>The five phases</h2>
			<p>Here is <a id="_idIndexMarker696"/>a brief overview of the five phases we will cover in this chapter:</p>
			<ul>
				<li><strong class="bold">Phase 1: Gaining access to the system</strong>. Again, we've identified the system, we understand which services are running, and—possibly—know user account information. We need <em class="italic">two</em> pieces of information to gain access to the machine: username and password. There are several methods we can use for cracking passwords.</li>
				<li><strong class="bold">Phase 2: Escalating privileges</strong>. We can either escalate the privilege of an account we create or take an account that already exists—such as Billy Bob in the mailroom—and give the account user administrative rights. Guess who will be in trouble if I get discovered. Poor Billy Bob. Now, we don't have to pick on a particular user account; we can use service accounts that are already active.</li>
				<li><strong class="bold">Phase 3: Maintaining access</strong>. How do we do that? By launching applications or our tools. We have a toolset of things we like to work with, and there are specific tools I enjoy. I will launch those applications to continue my attack from the inside. If I have hit the initial target, or this is my intended or final target, I need to launch my application so that I can get back in more easily. </li>
				<li><strong class="bold">Phase 4: Hiding your tools</strong>. Because we don't want people to see us on the system. You don't want somebody browsing around seeing a particular application installed on your machine. You need to hide that information. There are several ways to hide tools, including rootkits and steganography.</li>
				<li><strong class="bold">Phase 5: Covering your tracks</strong>. How do we do that? Well, what's on a machine that typically tracks everything we do on a system? The <strong class="bold">log files</strong>. I sometimes refer to it as the big brother. This is where we separate the good hackers from the great hackers. To achieve our goal here, we will delete log files or modify them.</li>
			</ul>
			<p>Let's discuss each of the five phases in more working detail.</p>
			<h1 id="_idParaDest-188"><a id="_idTextAnchor191"/>Phase 1 – Gaining access and cracking passwords</h1>
			<p>If you know me, you know I have a big issue with passwords. I always jump on my soapbox <a id="_idIndexMarker697"/>whenever talking about passwords, because let's face it, we create online entities, and use accounts online all the time within <a id="_idIndexMarker698"/>our network or outside—on the internet. Everything about us is contained in these entities and we are to protect these with passwords. Now, here comes my soapbox…people are so stinking lazy when it comes to creating passwords—it drives me absolutely bonkers. As we move along, you'll understand why I'm so passionate about this subject. </p>
			<p>Matt Mullenweg, who created WordPress, had this great quote: <em class="italic">Love is great…but not as a password.</em> Did you know that <em class="italic">love</em> is one of the top 20 passwords that people use, with a variation at the end of it? So, again, our whole goal here in this phase of gaining access is attempting to crack a password. We don't necessarily go after the big bad administrative password right away, because the second phase of gaining access is escalating privileges. So, we first need to see if we can find a password to gain access. </p>
			<h2 id="_idParaDest-189"><a id="_idTextAnchor192"/>What's cracking?</h2>
			<p><strong class="bold">Cracking</strong> is going <a id="_idIndexMarker699"/>through and looking for or discovering passwords that are stored on a machine locally or trying to do this during transmission. A great example <a id="_idIndexMarker700"/>of this is <strong class="bold">File Transfer Protocol</strong> (<strong class="bold">FTP</strong>). When you log your username and password, the default is to transmit both the username and password in clear text. Obviously, that's something I could pick up. </p>
			<p>People ask me: "Is there a really good reason for cracking?" Yes, there is. Often, people forget their passwords, especially when it comes to standalone machines. I would never recommend trying to crack someone's password if you're in a domain environment because that's the purpose of the feature—being able to reset a password—but oftentimes, neighbors come over to me and say: "I forgot the password on my machine and I can't get in." Of course, I usually have a lot of red flags going up in my brain when they say: "All of a sudden, I can't get in." But we can reset local account passwords. Sometimes, a disgruntled person does something malicious in the domain environment, such as locking out everyone's password. This shows there are some good purposes for cracking. </p>
			<p>When it comes to cracking, we have two different ways we can do it—we can automate or do it manually by using some interesting tools. </p>
			<p>The problem we have when it comes to cracking passwords is that most users pick something they know because they must remember it, and that's what makes it easy to crack people's passwords. Most people will use a name of a family member, their pet's name, their favorite sports team, comic book heroes, swear words, favorite city, religious names, or a school they went to—college, elementary, or high school. These things might be easy to remember because they mean something to you as the user, but that's the reason why passwords are easily hacked. </p>
			<p>Most people start off with these types of words and then add numbers at the end or the beginning of that password. Usually, those numbers also mean something to them. Most people use their birth year, graduation year, wedding anniversary, and so on. </p>
			<p>However, while we require people to create difficult passwords, they still need to be easy to remember. Otherwise, we get help tickets being opened all day long: "Hey, I locked myself out. I don't remember my password." So, in my book, as far as a proper password <a id="_idIndexMarker701"/>policy is concerned, we typically rely on four different options: biometrics, thumbprint, <strong class="bold">two-factor authentication</strong> (<strong class="bold">2FA</strong>), and retinal scans, which is one of the exciting things about Windows 10: Microsoft is building biometrics into it, and it can't be tricked easily. If your laptop or tablet has a camera on it, it can <a id="_idIndexMarker702"/>use your face to log you in. And don't worry—they've done it with a <strong class="bold">three-dimensional</strong> (<strong class="bold">3D</strong>) aspect, something they learned from Xbox. Remember the Kinect? It does 3D recognition of your face and—sometimes—your body, which I find scary. </p>
			<p>The geniuses <a id="_idIndexMarker703"/>behind this technology created it in such a way that if you hold up a picture of your face in front of the camera, it sees it as a flat structure. It realizes there's no depth. The demo they show you is of a gentleman holding a picture of himself up in front of his face and the laptop doesn't log him in. Once he removes the picture, exposing his face, the laptop immediately logs him in. With this, nobody can steal your biometrics, unless, of course, they cut your finger off. </p>
			<p>We also <a id="_idIndexMarker704"/>have the option of using the <strong class="bold">Common Access Cards</strong> (<strong class="bold">CACs</strong>) you swipe. Unfortunately, somebody can steal them, which is why utilizing a <a id="_idIndexMarker705"/>password would provide additional security. I'm a big fan of <strong class="bold">multi-factor authentication</strong> (<strong class="bold">MFA</strong>), whereby you type in a password, then receive a text message with a code on your cell phone or to your email confirming you've registered. You verify with a code that the company has sent to you. </p>
			<p>With the number of passwords that are getting cracked, I think we're going to see a huge change, and we're probably leaning toward biometrics.</p>
			<h2 id="_idParaDest-190"><a id="_idTextAnchor193"/>Complexity</h2>
			<p>Complexity means <a id="_idIndexMarker706"/>as we create these passwords, we need to make them more difficult for attackers to guess. Typically, at least in Microsoft, we handle this by using three of the following four options—and they're good options as far as a rule of thumb is concerned: </p>
			<ul>
				<li>The first option is using uppercase characters in your password. Now, I wouldn't necessarily make all my characters uppercase—my computer might think I'm yelling at it. </li>
				<li>We can also use lowercase characters, and you can use these two in any order—you don't have to start off with an uppercase character then end with lowercase or vice versa. </li>
				<li>We can also inject numbers. So, at this point, we have what they refer to as an alphanumeric-based password. </li>
				<li>We can also use salting techniques (we'll talk about this later) to help randomize the password hashes.</li>
			</ul>
			<p>However, if these four are the only ones you're using for your complexity, someone will eventually <em class="italic">pwn</em> you and, therefore, this is why we like special characters. </p>
			<p>However, we need to be careful with special characters because there are some assumptions that both users and attackers make. </p>
			<p>Any special characters will help you create complexity, but one of my favorite special characters—which drives attackers crazy—is the spacebar, but just because it's complex doesn't mean you're safe. You still must be careful. </p>
			<p>First, you have <a id="_idIndexMarker707"/>to be careful about <a id="_idIndexMarker708"/>what we'll refer to as the <strong class="bold">Fab Five</strong>. This includes the <strong class="source-inline">@</strong>, <strong class="source-inline">$</strong>, <strong class="source-inline">3</strong>, <strong class="source-inline">0</strong>, and <strong class="source-inline">!</strong> characters, which a lot of people think will trick attackers, assuming they'll never guess that the dollar sign represents <em class="italic">S</em>, the zero an <em class="italic">O</em>, and the 3 an <em class="italic">E</em>. Well, attackers have dictionaries and mechanisms to help them figure these out. Don't try <strong class="source-inline">0penm3up</strong>, assuming attackers will not guess your 3 is <em class="italic">E</em> or <strong class="source-inline">L3tm3in</strong> is <em class="italic">Letmein</em>. My other favorite is <strong class="source-inline">op3ns3same</strong>. You don't think that's in a dictionary? I know this is a cool password, but it's not going to fool an attacker. </p>
			<p>The reason why I always use <strong class="source-inline">Pa$$w0rd</strong> is that it's the default password for all Microsoft labs in the training environment. Microsoft requires that three of the four complexity requirements are fulfilled, and this one fulfills it. But complexity is not everything. </p>
			<p>The strength of a password lies in its length. Never use real words because they're what we refer to as dictionaries out there. A dictionary contains a bunch of words, and there are tons of dictionaries for different subjects. </p>
			<p>For example, assuming you know I like Batman, we'll put <strong class="source-inline">batmanrules</strong> in the password file shown here: </p>
			<div>
				<div id="_idContainer081" class="IMG---Figure">
					<img src="Images/B17486_07_001.jpg" alt="Figure 7.1 – Password security checker at https://security.org&#13;&#10;" width="1072" height="744"/>
				</div>
			</div>
			<p class="figure-caption">Figure 7.1 – Password security checker at https://security.org</p>
			<p>If I try to brute-force attack this, it will take about 1 day to crack the password because it's made up of real words. In fact, if it wasn't as long as that (for example, <strong class="source-inline">batman</strong>), it would happen instantaneously because it will be in a dictionary somewhere.</p>
			<p>I do a lot of <a id="_idIndexMarker709"/>community-based talks and seminars, and one thing I try to teach users (because this is such a pet peeve for me) is how to create complex passwords but still make them easy to remember for the end user. </p>
			<p>One of the <a id="_idIndexMarker710"/>most effective ways to do this is by using a syntax we use daily. For example, I'm using a <strong class="bold">Domain Name Service</strong> (<strong class="bold">DNS</strong>) naming syntax, but because of the length and special characters of the periods, my password takes a little bit longer to brute-force attack. And hopefully, if my policy has me change my password before many years go by, it doesn't necessarily have to follow an actual DNS syntax. In fact, I'll do <em class="italic">M</em> because it's an upside-down <em class="italic">W</em>, or maybe I'll throw in a capital in there—<strong class="source-inline">MMM.ilovecrafstmantools.whatever</strong>. Yes, it doesn't have to be a real website—it can be anything you want. </p>
			<p>Let's try to crack <strong class="source-inline">ilovecraftsman.tools</strong>. It's extremely long; we might have to go through the time-space continuum (or at least get our DeLorean up to 88 miles an hour to go forward in time before it gets cracked through brute force), as it would take almost 900 trillion years to brute-force this password. I just typed in one of my passwords: 9 sextillion years to crack. Game over—I win!</p>
			<h2 id="_idParaDest-191"><a id="_idTextAnchor194"/>Password architecture</h2>
			<p>We can try to hack a password either while it's in storage or while it's in transmission, or what's referred <a id="_idIndexMarker711"/>to as in motion. So, where are passwords stored? Well, that depends on your operating system and the environment you're in. For example, when it comes to Windows, if this is just a machine that is not part of a domain, maybe a home PC or grandma's PC, or your laptop, there's a database on the hard drive <a id="_idIndexMarker712"/>referred to as the <strong class="bold">Security Account Manager (SAM) database</strong>. </p>
			<p>The SAM database is located wherever you've installed Windows. The default is <strong class="source-inline">C:windows/system32/config/sam</strong>. In fact, let's look at it here. In the following screenshot, I've opened my File Explorer and I've gone to my <strong class="source-inline">C:</strong> drive where I installed Windows under <strong class="source-inline">System32</strong>. There's a directory called <strong class="source-inline">config</strong>—if you expand it, you'll notice there's this nifty little file called a <strong class="source-inline">SAM</strong> file inside. The passwords are stored in a <em class="italic">hash</em>, and this location or database is mounted up as a registry entry:</p>
			<div>
				<div id="_idContainer082" class="IMG---Figure">
					<img src="Images/B17486_07_002.jpg" alt="Figure 7.2 – Location of the SAM database&#13;&#10;" width="978" height="384"/>
				</div>
			</div>
			<p class="figure-caption"> </p>
			<p class="figure-caption">Figure 7.2 – Location of the SAM database</p>
			<p>If you're in a domain environment, user accounts are not stored on the local drive of the client machine but in a file known as <strong class="source-inline">ntds.dit</strong>, which is located on every single domain controller in your environment. On your domain controllers, it's stored inside of a directory known as <strong class="source-inline">C:\windows\ntds.dit</strong>. </p>
			<p>So, here I am on the <strong class="source-inline">C:</strong> drive of my domain controller and inside of my Windows directory. I have a <a id="_idIndexMarker713"/>subdirectory called <strong class="source-inline">NTDS</strong>, which is short for <strong class="bold">New Technology Directory Services</strong>:</p>
			<div>
				<div id="_idContainer083" class="IMG---Figure">
					<img src="Images/B17486_07_003.jpg" alt="Figure 7.3 – Location of the NTDS subdirectory" width="919" height="359"/>
				</div>
			</div>
			<p class="figure-caption">Figure 7.3 – Location of the NTDS subdirectory</p>
			<p>Therein is <a id="_idIndexMarker714"/>the famous <strong class="source-inline">ntds.dit</strong> file, the database file that has all my accounts for my infrastructure, as we can see here: </p>
			<div>
				<div id="_idContainer084" class="IMG---Figure">
					<img src="Images/B17486_07_004.jpg" alt="Figure 7.4 – Location of the ntds.dit Active Directory (AD) account database" width="813" height="335"/>
				</div>
			</div>
			<p class="figure-caption"> </p>
			<p class="figure-caption">Figure 7.4 – Location of the ntds.dit Active Directory (AD) account database </p>
			<p>Now, don't think Linux doesn't do the same thing, because guess what? It does! It stores its passwords inside of the <strong class="source-inline">etc</strong> directory in a file that's called <strong class="source-inline">shadow</strong> <strong class="source-inline">(etc/shadow)</strong>. </p>
			<p> For Apple, we store it in a file that's called a <strong class="source-inline">plist</strong> file, located in the <strong class="source-inline">var</strong> directory under <strong class="source-inline">/var/db/dslocal/nods/default/users</strong>.</p>
			<p>With this file, the user is inside of the greater-than and less-than brackets <strong class="source-inline">(&lt;user&gt;.plist</strong>). <strong class="source-inline">plist</strong> has a shadow hash data property associated with it, and there are ways you can open this file up. Typically, you can't just grab these. If you're thinking you'll just go grab them, guess what? These files contain your authentication credentials, but they're stored as hash values. You can't just open it up. In fact, most of the files are going to be locked while the operating system is running. As far as it being hashed is concerned, you need to know that it's a one-way algorithm, which means I can't reverse the hash. "Okay, that's cool, then obviously I'm secure." Well—no, you're not, because as an attacker, I can steal it. </p>
			<h2 id="_idParaDest-192"><a id="_idTextAnchor195"/>Methods for cracking/password hacking</h2>
			<p>There are <a id="_idIndexMarker715"/>several techniques used for cracking, as outlined here:</p>
			<ul>
				<li>Dictionary attacks (one of the most common ways we can go after passwords)</li>
				<li>Brute-force attacks </li>
				<li>Syllable attacks</li>
				<li>Hybrid attacks </li>
				<li>Rule-based attacks</li>
				<li>Good old reliable guessing</li>
			</ul>
			<p>Let's look at them in detail.</p>
			<h3>Dictionary attacks </h3>
			<p>Dictionary attacks are <a id="_idIndexMarker716"/>exactly what they sound like. We <a id="_idIndexMarker717"/>have files that we can go and download off the internet (<strong class="source-inline">https://zip-password-cracker.com</strong> or <a href="https://apasscracker.com">https://apasscracker.com</a>) and we can create our own because they are just text documents of words. When I say <em class="italic">words</em> in a dictionary attack, I mean I can find a dictionary based on different languages, whether that's English, French, German, Russian, or Klingon. </p>
			<p>We also have dictionaries based on subjects. There's a dictionary out there that has medical terms in it, historical accounts, places, characters in books, their names, and even something specific to the book itself, such as a catchphrase.</p>
			<p>Characters would also include movie characters—I have a dictionary that's filled with names from J.R.R. Tolkien's <em class="italic">Lord of the Rings</em> series. I also have a dictionary of famous people's names, movie stars, historical figures, locations, and events. Don't think you're getting tricky just because you're using a password that may not be a traditional password, because you're basing it on a real word. Please don't do that. And don't think for a second <em class="italic">I'll just put it in backward</em> because any password-cracking tool out there that's worth its weight in salt will do string manipulation. It'll take the word and try it in different combinations or reverse. So, no—you're not tricking me. </p>
			<h3>Brute-force attacks </h3>
			<p>Listen to me now, hear me later, understand me next week (using my Arnold Schwarzenegger voice). Brute-force attacks take longer to accomplish. What we mean by a <a id="_idIndexMarker718"/>brute-force attack is we try every combination of alphanumeric <a id="_idIndexMarker719"/>and specialized characters in a password. Now, obviously, if the password is only 6 characters long, brute-force attacks will go by relatively quickly, but when we get into passwords beyond 14 characters, it gets a lot more difficult. It requires more cycles to go through, and brute force has to try every variation. Tools such as John the Ripper, Cain &amp; Abel, or Aircrack-ng are very useful.</p>
			<p>There's an upshot to brute-force attacks, even though it does take longer and it tries every combination, which takes more cycles. Guess what? It takes time, but it's 100% effective. And who has time? The attackers do. </p>
			<h3>Syllable attacks </h3>
			<p>With a <a id="_idIndexMarker720"/>syllable attack, we take a password—in this case, we'll <a id="_idIndexMarker721"/>say the password is <strong class="source-inline">pass</strong>—and then do a combination of a dictionary and brute force and try every possible arrangement of every entry in the dictionary. </p>
			<h3>Hybrid attacks </h3>
			<p>A hybrid attack still <a id="_idIndexMarker722"/>uses a dictionary, but based on users being complacent, we're going to try different variations by including numbers and special characters at <a id="_idIndexMarker723"/>the beginning or end of the password. So, let's say I have <strong class="source-inline">Batman</strong>, and next month I must change my password, so I change it to <strong class="source-inline">Batman1</strong>, and next month I change it to <strong class="source-inline">Batman2</strong>. Well, a hybrid attack is going to eventually crack this one. </p>
			<p>By the way, if you or your users just modify passwords each month by adding a character <a id="_idIndexMarker724"/>or two to at the very end of it, smack yourself on the forehead and promise you'll never do that again. But don't smack your users' foreheads—you might get called in by <strong class="bold">Human Resources</strong> (<strong class="bold">HR</strong>)! </p>
			<h3>Rule-based attacks </h3>
			<p>What do I mean by rule-based attacks? Remember enumeration? If you're not familiar with this, you can reference <a href="B17486_05_ePub.xhtml#_idTextAnchor131"><em class="italic">Chapter 5</em></a> of this book, <em class="italic">Enumeration</em>. With enumeration, we can <a id="_idIndexMarker725"/>use the rules we've discovered, such as requiring <a id="_idIndexMarker726"/>users to have at least an 8-character password. I'm going to use those against you. And, knowing you use complexity, I'm able to discover you require two digits. So, I use a combination of brute-force, dictionary, and syllable attacks. Again, if I know that you only have 8 characters, it's all you require for your passwords, I won't try 9 or 10 characters. Or, if you don't require a digit, then why run through those digits?</p>
			<h3>Good old reliable guessing</h3>
			<p>There's also <a id="_idIndexMarker727"/>good old reliable guessing, which entails some reconnaissance and footprinting. This is where we try to figure out as much as we can about the target, whether it's a user or a company. Often, users base passwords on things they know. So, if I go on social media, there's a chance I will figure out their favorite sports team, what their pet dog was growing up, and their spouse's birth date. We share way too much information. </p>
			<h2 id="_idParaDest-193"><a id="_idTextAnchor196"/>Types of attacks</h2>
			<p>Now that <a id="_idIndexMarker728"/>we know the different techniques used to do some cracking, let's talk about types of attacks. </p>
			<p>Attacks are typically summed up in four different categories, as follows: </p>
			<ul>
				<li>Passive online attacks</li>
				<li>Active online attacks</li>
				<li>Offline attacks</li>
				<li>Non-electronic attacks</li>
			</ul>
			<p>Let's discuss each category and the attacks that relate to each category.</p>
			<h3>Passive online attacks</h3>
			<p>These <a id="_idIndexMarker729"/>types of attacks are passive, which means we're <a id="_idIndexMarker730"/>not necessarily going to have direct communication with the machine or the target. </p>
			<h4>Sniffing</h4>
			<p>Passive online <a id="_idIndexMarker731"/>attacks include things such as sniffing <a id="_idIndexMarker732"/>the network to see if we can discover passwords going back and forth. An example of this is FTP, which uses clear text by default, so, just sitting there sniffing, we might be able to pick up some passwords.</p>
			<h4>Man-in-the-Middle (MitM) attacks </h4>
			<p>This type <a id="_idIndexMarker733"/>of attack occurs when an attacker places their machine or their hacking device between the source and the destination. They just handle all the traffic going back and forth. Again, I'm not modifying anything—it's so passive that it's hard for anyone to tell I'm doing anything. I'll just be capturing the data, making sure it all passes through me before it goes to a switch. </p>
			<h4>Sidejacking</h4>
			<p>This <a id="_idIndexMarker734"/>attack was made famous by a Firefox plugin that <a id="_idIndexMarker735"/>was called <strong class="bold">firesheep</strong>. It allowed an attacker to go to any Wi-Fi access point, such as at a Starbucks, some coffee shop, or internet café, and if they were on the same Wi-Fi access point as other users, they could steal their cookies in the middle of their transaction. They could then do things such as log on to their Facebook account or take over their Facebook session. Again, these are relatively passive—I'm not attacking a specific target. </p>
			<h3>Active online attacks </h3>
			<p>An active <a id="_idIndexMarker736"/>online attack is exactly that—it's a lot more active. We <a id="_idIndexMarker737"/>know the more active we are, the more chances we have of getting caught. </p>
			<h4>Hash injection</h4>
			<p>This is <a id="_idIndexMarker738"/>where we inject a compromised hash into a <a id="_idIndexMarker739"/>current session and then use the hash to authenticate to the network resources. </p>
			<p>A hash is basically an encrypted password, and passwords are basically stored in the systems in the form of hashes. Now, if I had a file that stored usernames and passwords and it was completely clear text, there would be no use in having security, right? The reason is anybody could find that file. Remember that SAM database? Well, it stores user accounts and passwords in a hashed format. </p>
			<p>Back in the day, Microsoft used something called a <strong class="bold">LAN Manager (LM) hash</strong>, which was a nightmare and still is a nightmare sometimes. I get this all the time whenever I teach about ethical hacking: "<em class="italic">Why talk about hash words and all this stuff with older operating systems? Why not be talking about the new stuff?</em>" Well, I'll be honest with you—it's almost like being a hunter. If I'm going to go out and hunt my prey, I'm not going to <a id="_idIndexMarker740"/>go out after the latest, newest target out there—I want to <a id="_idIndexMarker741"/>go after the oldest, because it's slower, and no one's paying attention to it. Who knows if it's been updated? The new stuff has newer technologies and sometimes makes it harder for me. I taught a class that had two IT people from a huge state organization, and as we were talking, they told me they still have some XP machines and some Server 2000 and 2003 systems. </p>
			<p>You may be shaking your head, wondering why you need to upgrade a machine that maybe does one task. In my two students' case, the machine handled their imaging system for documentation. In another manufacturing facility was a robotic arm being controlled by a Windows machine. It just went back and forth all day long. Do these machines need to have Windows 10 on them if they work just fine with XP? If you created a password that was 14 characters or fewer, the LM hash would take all the letters—it wouldn't matter if you had upper- and lowercase characters—and convert them to all uppercase. After converting them to all uppercase, it would then pad any leftover fields to fill out all 14 characters. So, in this case here, I'd have three padded spaces. Then, things got kind of crazy. The LM hash then went through and split up the password into two 7-character strings. The two 7-character strings were then encrypted and combined back together. </p>
			<p>For example, <strong class="source-inline">BatmanR</strong> would be hashed out to this value, and the leftover <strong class="source-inline">ULES</strong> with its padded spaces would be encrypted to this hash. Then, they would be combined, and that would be your LM hash, as illustrated here: </p>
			<div>
				<div id="_idContainer085" class="IMG---Figure">
					<img src="Images/B17486_07_005.jpg" alt="Figure 7.5 – How LM hashes are created&#13;&#10;" width="532" height="117"/>
				</div>
			</div>
			<p class="figure-caption">Figure 7.5 – How LM hashes are created</p>
			<p>Microsoft then added NTLM, which is the NT LAN Manager hash. So, the result we would see inside of the SAM account database would include the user's name (in this case, <strong class="source-inline">Bwayne</strong>), a number listed after their name, followed by the next 32 characters, which was the LM hash, and then an NTLM hash appended. Now, the big difference between these two was in the password hash algorithm. LM used what they referred to as <strong class="bold">diz</strong>, which <a id="_idIndexMarker742"/>was very easy to crack. </p>
			<p>Then, they came out with NTLM <strong class="bold">version 1</strong> (<strong class="bold">v1</strong>), which got <a id="_idIndexMarker743"/>us to using <strong class="bold">Message Digest 4</strong> (<strong class="bold">MD4</strong>), which was a better algorithm, but NTLM <strong class="bold">version 2</strong> (<strong class="bold">v2</strong>) used MD5, which is even better, and technically, you should use it whenever possible. So, then you might see <a id="_idIndexMarker744"/>another account listed in there as <strong class="source-inline">administrator</strong>, followed by 500 for that number. 500's the <strong class="bold">security identifier</strong> (<strong class="bold">SID</strong>)—all administrative <a id="_idIndexMarker745"/>accounts in the Microsoft world end with 500 at the end of the SID. Again, I would <a id="_idIndexMarker746"/>see a combination of the LM hash and the NTLM hash. </p>
			<p class="callout-heading">Note</p>
			<p class="callout">Anytime you see a hash that ends with a double <strong class="source-inline">AAD3B435B51404EE</strong>, this should mean something to you. This is a very common ending hash, and it describes the last 7 characters—remember that we must pad it to make sure we equal 14 characters? It tells me the password is 7 or fewer characters in length. Something similar happens if somebody types in a password that's over 14 characters. Remember that this happens with 14 characters. If it's over 14 characters, then the LM hash value is dumped and not utilized. Operating systems today, since Vista and higher, have the LM hash turned off. </p>
			<h4>Keyloggers</h4>
			<p>When it comes to keyloggers, we monitor every single key stroke going on a particular system or target. All those keystrokes, depending on the keylogger itself, could be transmitted back to the attacker.</p>
			<p>Keyloggers are <a id="_idIndexMarker747"/>software programs that monitor and record keystrokes, mouse strokes, screenshots, who logged in, and at what time. It's amazing what some <a id="_idIndexMarker748"/>of these software programs do, but most of them will log keystrokes. There's a lot of software out there, and some have a legitimate purpose to them—for example, some parents or guardians want to monitor what their kids are doing on the computer. </p>
			<p>We also have hardware-based keyloggers, which are extremely hard to detect. They will monitor every keystroke, and it doesn't look like it's a big bad device, but some of them have small applications built into them so that they either keep a log file and I just recover the device or they will simply email me the logs. </p>
			<p>As a security expert, you need to know what's installed on your machines, both software and hardware. If you were to look on the back of a machine and saw one of the following devices plugged into the back of your system and the mouse was plugged into it, what would you assume? </p>
			<div>
				<div id="_idContainer086" class="IMG---Figure">
					<img src="Images/B17486_07_006.jpg" alt="Figure 7.6 – Keyloggers" width="289" height="148"/>
				</div>
			</div>
			<p class="figure-caption">Figure 7.6 – Keyloggers</p>
			<p>The question is: <em class="italic">Is there a legitimate use for these devices?</em> It may be the company's business to know what people are typing—what information they're sharing. And it doesn't stop at devices that look like these.</p>
			<p>There are keyboards you can modify—you can do this yourself and install a keylogger piece of hardware inside of the keyboard. You can also buy these new and deploy them out to your end users. Or, how about if I just send you a free one and it's connected to your system so that we're able to capture screenshots and record which websites you've visited? I can even read your email because as you type it in, it's going to be recorded. I could also capture login names. "<em class="italic">But hang on a second—when I type in my passwords, I get an asterisk.</em>" Well, guess what? Keyloggers don't log in asterisks—that's what you see visually. </p>
			<p>If you are saying "<em class="italic">Those are physically connected devices</em>", I have bad news for you. There <a id="_idIndexMarker749"/>are Wi-Fi keyloggers out there. You are also in trouble <a id="_idIndexMarker750"/>if you have a Bluetooth keyboard (and most Microsoft keyboards are Bluetooth-based as far as connectivity from the keyboard to the system goes). </p>
			<p>This looks <a id="_idIndexMarker751"/>like a <strong class="bold">Universal Serial Bus</strong> (<strong class="bold">USB</strong>) charger, but built inside of it is a Bluetooth keylogger:</p>
			<div>
				<div id="_idContainer087" class="IMG---Figure">
					<img src="Images/B17486_07_007.jpg" alt="Figure 7.7 – A keylogger hidden inside a USB charger" width="297" height="245"/>
				</div>
			</div>
			<p class="figure-caption"> </p>
			<p class="figure-caption">Figure 7.7 – A keylogger hidden inside a USB charger</p>
			<p>I don't have to be hooked up to your system. I can plug this in, and you'll just think: "<em class="italic">As a matter of fact, I could use it as a charger for my phone.</em>" In the meantime, it'll be picking up Bluetooth signals and detecting what people are typing on their Bluetooth keyboards. </p>
			<p>Here's where it gets scary… they have acoustic keyloggers now. What does that mean? There are apps that are being experimented with right now. It takes time because it has to learn the sound of the keystrokes, but after a while, it'll be able to predict via sound waves which keys are being typed. </p>
			<p>If that doesn't scare you enough, how about a rootkit logger? Yes—there are two that have been found in the wild already. One of <a id="_idIndexMarker752"/>them is called <strong class="bold">Jellyfish</strong>, a keylogger <a id="_idIndexMarker753"/>that runs inside the <strong class="bold">graphics processing unit</strong> (<strong class="bold">GPU</strong>) of the <a id="_idIndexMarker754"/>video card instead of through the processor or the <strong class="bold">central processing unit</strong> (<strong class="bold">CPU</strong>) of the system, and I don't know very many antivirus products that are looking at what's running on GPUs! </p>
			<p>To raise <a id="_idIndexMarker755"/>the hair on the back of your neck, we also have <a id="_idIndexMarker756"/>hypervisor keyloggers. These are keyloggers that will reside in a piece of malware that is hypervised. It runs underneath the operating system, so it remains <a id="_idIndexMarker757"/>untouched, just like a <strong class="bold">virtual machine</strong> (<strong class="bold">VM</strong>). </p>
			<p>We also have form-grabbing-based keyloggers. These are basically a piece of software that's going to record web form data and then send it across the internet to show the attacker which form data you're filling out. And no—it's not specific to PCs.</p>
			<h3>Offline attacks</h3>
			<p>These are <a id="_idIndexMarker758"/>interesting because. with offline attacks, we have all the <a id="_idIndexMarker759"/>time in the world. What's meant by an offline attack? If I can somehow get access to whatever is storing your passwords and user accounts and I get to play with it offline, I'm not going to hit that machine. I grab a database such as the SAM account database, or maybe I grab your <strong class="source-inline">ntds.dit</strong> file, and I can start throwing things such as a rainbow attack (which we'll discuss in more detail later).</p>
			<p>We could also use one of the following. </p>
			<h4>Distributed network attacks </h4>
			<p>A <strong class="bold">distributed network attack</strong> (<strong class="bold">DNA</strong>) extends <a id="_idIndexMarker760"/>decryption capabilities beyond a single computer by using the distributed <a id="_idIndexMarker761"/>power of multiple computers across a network to decrypt files, find passphrases, and recover passwords. </p>
			<h4>Precomputed hashes </h4>
			<p>Here, an <a id="_idIndexMarker762"/>attacker can decrypt each word in a dictionary <a id="_idIndexMarker763"/>using a hash function and then compare it to the encrypted password. The downside to this is that it does require a lot of space, but the payoff is that it's extremely fast. </p>
			<h3>Non-electronic attacks </h3>
			<p>Non-electronic <a id="_idIndexMarker764"/>attacks are possible ways to gain access <a id="_idIndexMarker765"/>to valuable information without the use of technology. While these methods may be less common, they can still be very effective in obtaining the data or access you need.</p>
			<h4>Dumpster diving</h4>
			<p>This is where <a id="_idIndexMarker766"/>we look through trash. Now, that <a id="_idIndexMarker767"/>may seem beneath you, but trust me, it happens. Oracle caught Microsoft in a fib because they had done some dumpster diving in Microsoft trash bins. </p>
			<p>Dumpster diving is a means for attackers to find information they could use to create trust. You can find medical records, resumes, personal photos, emails, bank statements, account details, information about software, tech support logs, government records, medical bills, resumes, and the like simply by exploring the intended victim's garbage. Once garbage is collected, the information is used to piece together identity profiles, making social engineering more likely to succeed.</p>
			<h4>Shoulder surfing </h4>
			<p>In this type <a id="_idIndexMarker768"/>of attack, somebody is obviously watching over your shoulder <a id="_idIndexMarker769"/>or using some type of mechanism. The latest and greatest now is, I have an electronic cell phone in my hand that does video. How about if I hold it up to my ear as if I'm talking to somebody, but I point my camera to where you're typing in a password? As a matter of fact, I'm paranoid about such things. When I'm out shopping, if I'm going to run my credit card somewhere, I always stop and look around and see if somebody's pretending to be on their cell phone and it happens to be pointing my way. </p>
			<h4>Social engineering </h4>
			<p>There's something we can do with social engineering that is a non-electronic attack, but kind of <a id="_idIndexMarker770"/>borderline. It's a very famous attack and it entails using a USB switch blade. Here, as an attacker, I configure a USB drive, and <a id="_idIndexMarker771"/>when you plug it in, it goes through and does some interesting things such as installing a keylogger for me, maybe a piece of malware, and it does it all silently. Maybe even the emails knew your logging credentials that I detected, and what I do is take that USB drive and just arbitrarily leave it some place where I know somebody will find it—for example, at the parking lot of a company, in the main lobby, in a hallway, near a bathroom: some place near the target company. If somebody picks it up, what's the first thing they're going to try to do? Plug in this bad boy and bing—they just got <em class="italic">pwned</em>!</p>
			<h2 id="_idParaDest-194"><a id="_idTextAnchor197"/>Authentication methods designed to help</h2>
			<p>Included <a id="_idIndexMarker772"/>next are additional cracking concepts to assist you in the cracking process.</p>
			<h3>When NTLM authentication doesn't work for you</h3>
			<p>This authentication mechanism is proprietary to Microsoft and it's the default authentication <a id="_idIndexMarker773"/>that is used if some specific situations exist. I know you are saying: "They're using Kerberos." I know that, except if <a id="_idIndexMarker774"/>the following situations apply to you. It's only used when there is no Kerberos trust between two different forests and you're trying to share resources.</p>
			<p>Another time NTLM gets utilized instead of Kerberos is if authentication is being attempted by an IP instead of by a DNS name because Kerberos requires DNS or a domain name environment. Also, if one or both systems are not a part of the same domain, don't think that you're not using NTLM, because you very well could be. </p>
			<p>Another situation is if you have a firewall that's blocking Kerberos. Now that we know when it's used, how is it used? Well, it's based on a challenge-response algorithm. </p>
			<p>The cool thing about this is passwords are never transmitted because you're just going to respond to a request or a challenge. As I mentioned before, NTLM came in v1 back with Windows NT. v2 was <a id="_idIndexMarker775"/>released with <strong class="bold">Service Pack 4</strong> (<strong class="bold">SP 4</strong>), so if by chance you come across an older NT system, odds are it will be running v2.</p>
			<p>This is how it works: you have your client machine, and the user gets their login screen and types in their username and password. After this, Windows takes that password and runs it through a hash algorithm to generate a hash for the password that's been entered. The client then sends a login request to the domain controller, and since the computer <a id="_idIndexMarker776"/>has joined the domain, the domain controller is very much aware of that hash value associated with that login name. So, the <a id="_idIndexMarker777"/>domain controller then creates a random string and sends it and basically says: "If you are who you say you are, you should be able to answer this request." The client encrypts this request with the hash and sends it back to the domain controller. The domain controller then goes through, retrieves the password or the hash of the user's password, and compares it to see if it's the correct answer. If it's the same answer, then you're allowed to cross t<a id="_idTextAnchor198"/>he bridge. If it's wrong, you don't get to pass. It reminds me of the famous <em class="italic">Monty Python and the Holy Grail</em> movie scene of the three questions and bridge of death.</p>
			<h3>Kerberos authentication</h3>
			<p>This is what <a id="_idIndexMarker778"/>we're using, pretty much up to date with the latest and greatest from Microsoft. Kerberos gets its name from the three-headed dog that <a id="_idIndexMarker779"/>guards the gates of Hell—or Fluffy, if you're a <em class="italic">Harry Potter</em> fan. It is ticket-based, so we issue tickets that are then used to represent the credentials. It's fast, because we don't have to keep re-authenticating the user over and over—or, possibly, the computer. Again, it avoids the transmission of passwords. </p>
			<p>Now, there is one little kicker on this one and that is it's time-based. If you remember our chapter <a id="_idIndexMarker780"/>on enumeration, you should remember the <strong class="bold">primary domain controller</strong> (<strong class="bold">PDC</strong>). It's in charge of syncing everybody's clock to itself because when it comes to Kerberos, the default with Microsoft is you cannot have more than 5 minutes time difference between the PDC and your system clock. If you are, it won't authenticate you. So, let's look at how Fluffy is used. </p>
			<p>First, we have a computer, a user, and a domain controller. The domain controllers have some special <a id="_idIndexMarker781"/>services running on them, and one of them is a <strong class="bold">key distribution center</strong> (<strong class="bold">KDC</strong>). If we have a file server that we're trying to gain access to, the user is going to make a request to the domain controller, saying: "I need to be authenticated, please." The domain controller responds back with: "Yes, what can I do for you? I can authenticate you.", to which the user's computer says: "I need to <a id="_idIndexMarker782"/>get a <strong class="bold">ticket-granting ticket</strong> (<strong class="bold">TGT</strong>)." Because the computer and the domain controller are members of the same domain, the domain <a id="_idIndexMarker783"/>controller can issue this TGT or ticket to the user or computer to be then utilized when they want to gain access to <a id="_idIndexMarker784"/>resources. When the user/computer wants to gain access to the file on the file server, they just simply present their TGT, the file server sees it's from a trusted source, and it will quickly check with the domain controller and say: "Is this account still valid?" The reason it does this is in case an administrator has locked the user out. Now, just because tickets are being utilized here doesn't mean that you're safe. We'll be looking at a tool later in another chapter called John the Ripper—a very famous tool, and probably one of the more powerful tools out there today. It's a Linux tool that can crack Unix, LM hash passwords, NTLM passwords, and Kerberos passwords.</p>
			<h3>Salting</h3>
			<p>Salting? Yes...my hash <a id="_idIndexMarker785"/>needs a little salt. So, what happens if you have two users <a id="_idIndexMarker786"/>with the exact same, identical, password? What is their hash going to look like? The solution? We can randomize the hashes by appending or prepending random strings—we call these salts—to the password before we hash. This helps us in having duplicate hashes and makes it hard for an attacker to find out what's going on. </p>
			<p>Each salt needs to make sure it's unique for each password. Don't use the same string of characters for every password. If you do, all I must do as an attacker is figure out what your salting string is, and I'll then get everybody's password. For example, I have two accounts that are both using the same password, the hash values will be identical. If I use a salt, I can append some unique characters to the end of the password; therefore, two different accounts using the same password have different hash values. To check if the password is correct, we must be able to have access to the salt, so it's usually stored in a user account database along with the hash or as part of the hash string itself. </p>
			<p>Now, I'll give you an unfortunate shout-out here because Microsoft won't use this. They kind of use it, in the aspect that the passwords in AD are hashed, but the ending hash is just the username itself. So, again, make sure that if you're going to salt your passwords, each salt is unique to each password. If you're a developer and you're creating your application and want to make it so that people have to log in, a common mistake is they'll hardcode in a salt into the program or generate a salt only once and then reuse it. If I'm using the same salt for every password, two users with the same password will have the same hash. </p>
			<p>There's also <a id="_idIndexMarker787"/>the issue of your salts not being long enough—for example, 3 characters. 3 characters narrow down the limits of the number of possibilities <a id="_idIndexMarker788"/>the attacker needs to consider. Now, because I just told you the hash needs to be available, that creates a dilemma, right? If the key is kept on the system and the attacker gains full access to the system, they'll be able to steal the key no matter how long the salt is. The key needs to be stored in external systems such as a physically separated server dedicated to password validation. There is specialized hardware out there that also helps with storing salt keys.</p>
			<h2 id="_idParaDest-195"><a id="_idTextAnchor199"/>Other cracking methods</h2>
			<p>Besides <a id="_idIndexMarker789"/>the methods we spoke about previously, there are a couple of other methods that deserve a mention.</p>
			<h3>Rainbow tables and other options</h3>
			<p>A rainbow table <a id="_idIndexMarker790"/>is a precomputed hash table, so I don't have to try every variation of the hash values—I precomputed them ahead of time. I just do comparisons. Unfortunately, these precomputed hashes take up a lot of storage space. There are, however, free rainbow tables you can download. </p>
			<p class="callout-heading">Note</p>
			<p class="callout">You'd have to google them and be prepared for a HUGE file (<strong class="bold">terabytes</strong> (<strong class="bold">TB</strong>), in some cases). Go to <a href="https://freerainbowtables.com">https://freerainbowtables.com</a> for examples.</p>
			<p>You can also create your own rainbow tables if you have the storage space to handle these. What's <a id="_idIndexMarker791"/>interesting is, with new technology such as <strong class="bold">solid-state drives</strong> (<strong class="bold">SSDs</strong>) and cloud computing, attackers are utilizing these technologies to create rainbow tables at record speeds and utilizing the processing power of Amazon's cloud system or Azure. After they compile them, attackers will then go off and sell them. </p>
			<h3>Lookup tables</h3>
			<p>We can <a id="_idIndexMarker792"/>also utilize <strong class="bold">lookup tables</strong> (<strong class="bold">LUTs</strong>), which are just plain old tables. What this basically <a id="_idIndexMarker793"/>says is: "Does any hash out there equal this hash? Oh, look—I found one, and the password was password5," because that's what the hash equaled.</p>
			<p>Here <a id="_idIndexMarker794"/>are some examples:</p>
			<ul>
				<li>Does any hash equal the following?</li>
			</ul>
			<p><strong class="source-inline">5f4dcc3b5aa765d61d8327deb882cf99: FOUND: password5</strong></p>
			<p>It then continues to go through those tables, saying: "Hey, what about this one?" Oh, not in the database, so nobody has that password or hash.</p>
			<ul>
				<li>What about the following?</li>
			</ul>
			<p><strong class="source-inline">6cbe615c106f422d23669b610b564800: not in database</strong></p>
			<p>Your cracking tool will then continue: "Hey, can I get a letMEin12? Any responses?" </p>
			<ul>
				<li>Can I get the following?</li>
			</ul>
			<p><strong class="source-inline">630bf032efe4507f2c57b280995925a9: FOUND: letMEin12</strong></p>
			<p>"Yes, here's another one—try this one." Here it is:</p>
			<ul>
				<li><strong class="source-inline">386f43fab5d096a7a66d67c8f213e5ec: FOUND: mcd0nalds</strong></li>
			</ul>
			<p>And it will continue, depending on the size of the table you download. </p>
			<h3>Reverse LUTs</h3>
			<p>Similar <a id="_idIndexMarker795"/>to a LUT is a reverse LUT. These operate by saying: "I have <a id="_idIndexMarker796"/>a hash for the password of apple123—who on this list uses that hash? Oh, a couple of accounts... There's alice3, 0bob0, and charles8."</p>
			<p>I love technology but sometimes, I look at new things and ask myself: "What's this going to do me security-wise?" </p>
			<p>Let me show you something. The following screenshot depicts a computer system with multiple video cards. It was done as a project:</p>
			<div>
				<div id="_idContainer088" class="IMG---Figure">
					<img src="Images/B17486_07_008.jpg" alt="Figure 7.8 – GPU cracking system&#13;&#10;" width="417" height="300"/>
				</div>
			</div>
			<p class="figure-caption">Figure 7.8 – GPU cracking system</p>
			<p>Many of today's <a id="_idIndexMarker797"/>video cards have a GPU on them, and GPUs love cracking <a id="_idIndexMarker798"/>passwords. We typically think of a CPU as having multiple cores—for example, i7 might have 8 cores, or maybe you got a dual-core. Well, GPUs have hundreds of cores in them. In this research project, they set up five of <a id="_idIndexMarker799"/>these systems. They had 25 <strong class="bold">Advanced Micro Devices</strong> (<strong class="bold">AMD</strong>) GPUs and, between the five systems, they were connected at 10 gigabits per second (Gbps). Guess what? We don't have to do rainbow tables anymore. With this system and brute force, this cluster went through 348 billion NTLM passwords per second. What this means is a 14-character password took only 6 minutes to hack.</p>
			<p>What about MD5? Well, I'll do 180 billion per second with this rig and, even if you think you're <a id="_idIndexMarker800"/>being secure and you're using <strong class="bold">Secure Hash Algorithm 1</strong> (<strong class="bold">SHA-1</strong>), you'll only slow me down to 63 billion passwords per second being brute-forced. Remember—a system such as this, I would use in an offline attack. I'll get your database and, probably, within a day or two, I'm going to have several login options for you.</p>
			<p>Now that we have worked on gaining access and cracking passwords, let's discuss escalating privileges next.</p>
			<h1 id="_idParaDest-196"><a id="_idTextAnchor200"/>Phase 2 – Escalating privileges</h1>
			<p>Wanting <a id="_idIndexMarker801"/>local administrative rights, even though you're not allowed them, is what escalating privileges is all about. So, the problem we have here is now we've gone through and hacked a password and figured out the user ID, we're stuck with the privilege of that user—or are we? </p>
			<p>Kevin Mitnick, the world-famous hacker said the following: </p>
			<p class="author-quote">It's true, I had hacked into a lot of companies and took copies of the source code to analyze it for security bugs. If I could locate security bugs, I could become better at hacking into their systems—it was all towards becoming a better hacker.</p>
			<p>When you think about it, what he was doing was elevating his privileges by getting to know the source code and seeing which bugs or vulnerabilities he had to escalate out of. </p>
			<h2 id="_idParaDest-197"><a id="_idTextAnchor201"/>We've made it in. What now?</h2>
			<p>What do we do now? Remember how we made it in this far? We found a user account and cracked their password. Our goal now is to give ourselves adequate rights and permissions to do what we wish. So, never assume that just because you're not an administrator or don't have administrative rights, you can't accomplish your goal. </p>
			<p>Once we make it in, our next step is to look around. If we make it in as a local administrator, I'm going to look at any configuration mistakes that have been made. I might also check out any design errors from the network infrastructure level. Again, there are many times you might find a target through a Google hack, and you make your way in just using a default username and password. You get in and think to yourself: "Well, I haven't fully reconned this environment yet", so, we may want to take another look at these design errors. Maybe they've been misconfigured or didn't change default passwords or default settings. </p>
			<p>I also want to get a layout. This target I've hit, what is its purpose on the network? I'll also be looking at any programming flaws. I know—programmers <em class="italic">don't make mistakes</em>, right? They just come out with patches to enhance the application. That's kind of like IT people—they <em class="italic">don't make mistakes</em>. They just improve the performance. </p>
			<p>Now, as far as our overall goals are concerned, we have four basic methods for escalation, as follows:</p>
			<ul>
				<li><strong class="bold">Pwning the admin/root account</strong></li>
			</ul>
			<p>One of <a id="_idIndexMarker802"/>the goals we're going to have is being able to <em class="italic">pwn</em> the <strong class="source-inline">admin</strong> or the <strong class="source-inline">root</strong> account. </p>
			<ul>
				<li><strong class="bold">Taking advantage of vulnerabilities</strong></li>
			</ul>
			<p>The second <a id="_idIndexMarker803"/>method is to take advantage of a vulnerability that may be in the application or in the operating system that's going to allow you access as a privileged user. There are many applications that raise the privilege of the currently logged-in user on the backend you may not have considered. </p>
			<p>Try using <a href="http://www.exploit-db.com">www.exploit-db.com</a>. It gives insights about vulnerabilities you could take advantage of. Some of them we will go through. We can do a privilege escalation with this one. </p>
			<ul>
				<li><strong class="bold">Using escalation tools</strong></li>
			</ul>
			<p>Another method of escalation is firing up a tool such as Metasploit, a complete framework <a id="_idIndexMarker804"/>and hacking suite designed to allow you to see if you have any exploits or any type of vulnerabilities in your network. But obviously, we know attackers are going to use these types of tools against us. The downside to Metasploit is it's extremely easy to use. You might find a YouTube video about it, which means that some 12-year-old is out there coming at your system. </p>
			<p>There are more tools such as these out there, including Canvas and Core Impact, which is a complete pentesting tool, and Armitage, which is basically a GUI frontend for Metasploit.</p>
			<ul>
				<li><strong class="bold">Social engineering </strong></li>
			</ul>
			<p>What if we <a id="_idIndexMarker805"/>just get somebody to do it for us? That's called social engineering. As an attacker, I can persuade people to run an application for me or maybe to look at a file for me. I must entice them somehow using one of the core emotions of social engineering. Typically, I'm going to do it either out of fear or greed, or I need some help—which is a very reliable social engineering aspect, because as humans, we like to help, right? All I can do is send you an email, attach a script or a program to it, and ask <a id="_idIndexMarker806"/>you to double-click on it because it's going to <em class="italic">patch your system for you</em>. I'll make it look as though the email <a id="_idIndexMarker807"/>came from IT staff. I could create a <strong class="bold">Portable Document Format</strong> (<strong class="bold">PDF</strong>) file that, when opened, executes a program for me. </p>
			<h2 id="_idParaDest-198"><a id="_idTextAnchor202"/>Countermeasures</h2>
			<p>How do <a id="_idIndexMarker808"/>we stop this? Well, there are some countermeasures, but you need to remember your job is not to stop them – because you can't. You can only slow them down. And how do we do that? Here's how:</p>
			<ul>
				<li>The first way is using encryption, which helps you protect data that is considered sensitive. If I've encrypted data to a particular user, then regardless of what that user's permissions are or what my user permissions will be, I won't have access to that information. </li>
				<li>You could also consider giving least privilege when it comes to your users and applications. What we mean by this is don't overallocate your privileges. If somebody needs the ability to do something on a machine, take the time to figure out which rights and permissions they need and only give them those rights and permissions. </li>
				<li>You could also look at making sure your updates are done. It drives me bonkers because a lot of the privilege escalation issues can be avoided by making sure you are patching your systems. </li>
				<li>Another thing you can do is limit the interactive login. Interactive login is the right to throw a three-finger salute or the <em class="italic">Ctrl + Delete</em> keys on a box and log in. By default, regular users don't have the right to log in interactively on a server. </li>
				<li>You could also make sure that your service accounts are limited, using the same concept that applies to least privilege. I see this mistake done all the time where IT will go to install an application—a server application such as <strong class="bold">Structured Query Language</strong> (<strong class="bold">SQL</strong>) or SharePoint—and they need a service account that utilizes <a id="_idIndexMarker809"/>the machine. As far as the machine is concerned, a user is doing all the work, but it's being done by this account. Sometimes, IT will use the administrator account on the local box. Again, you need to evaluate what access these service accounts need because it could create a vulnerability or a hole for you. </li>
				<li>Another option is limiting the extent of the code if you're the developer and you are creating an application that runs at a high privilege level. Again, typically, it's when we take shortcuts that we create issues. </li>
				<li>You can <a id="_idIndexMarker810"/>also do privilege separation. With this type of approach, we limit the scope of programming errors and possible bugs. </li>
				<li>You can also test the operating system and your apps meticulously and review code if you're a developer. If you are an IT person and a developer says: "Here's a new app we're going to be using", there should be some type of documentation that says what was done where. You should question any type of code somebody wants you to place in your environment. And, if you are a developer, don't go off and download somebody's sample code and just copy and paste it. Make sure you understand what each line does. </li>
				<li>Using multi-factor is another countermeasure. This way, we place another safety-net layer for us. </li>
				<li>Do some stress tests. This is because many times when an application or an operating system gets overloaded, it creates vulnerabilities. You may even want to consider <a id="_idIndexMarker811"/>performing debugging using <strong class="bold">BoundsChecker</strong>. However, please realize none of these will stop everything from happening, but at least it'll make you feel as though you've got a handle on things.</li>
			</ul>
			<p>Next, we'll discuss the types of escalation that will help us accomplish our purpose.</p>
			<h2 id="_idParaDest-199"><a id="_idTextAnchor203"/>Types of escalations</h2>
			<p>Now that <a id="_idIndexMarker812"/>we know the different countermeasures used, let's talk about the different types of escalations.</p>
			<h3>Privilege escalation</h3>
			<p>This is any <a id="_idIndexMarker813"/>condition that allows an attacker to gain elevated access after the system has been compromised. So, we take a lower-end account <a id="_idIndexMarker814"/>and escalate its rights and permissions to a higher account, which allows us to pivot and have all kinds of fun. We also have what they <a id="_idIndexMarker815"/>refer to as <strong class="bold">information disclosure</strong>. This is basically any type of vulnerability that allows the attacker to gain access to data that is sensitive or protected. We <a id="_idIndexMarker816"/>also have what they refer to as <strong class="bold">security feature bypass</strong>. Now, this is typically caused by a software weakness that allows an <a id="_idIndexMarker817"/>attacker to bypass policies, validation, or even other safeguards such as bypassing <strong class="bold">User Account Control</strong> (<strong class="bold">UAC</strong>) or any type of filter. There are different types of escalation that you can perform. Determining which one you use will depend on what it is you're trying to accomplish. Privilege escalation can be <a id="_idIndexMarker818"/>accomplished by using <strong class="bold">dynamic link library</strong> (<strong class="bold">DLL</strong>) injection.</p>
			<h3>Horizontal escalation</h3>
			<p>In security <a id="_idIndexMarker819"/>terms, horizontal escalation is one of <a id="_idIndexMarker820"/>the most common methods used by attackers to achieve their objectives.</p>
			<p>Attackers will often look for a way through the perimeter to get an initial foothold within a network. Often, they find a low-hanging fruit such as a user who has left their password blank or a web application that lacks proper security controls.</p>
			<p>Once they have gained access to the network, the attackers will then look for ways to move laterally and spread their infection to as many systems as possible. By doing so, they can gather more valuable data or even take control of the entire network.</p>
			<h3>Offline access</h3>
			<p>Offline access is typically looking at machines that may not be always hooked up to the network. If a laptop <a id="_idIndexMarker821"/>gets stolen or if I'm able to compromise that laptop, I'm <a id="_idIndexMarker822"/>going to have all the time in the world because it's offline. And because of that, I can use some simple exploits to give myself total control of this machine, and then, hopefully, when you hook it back in, I'll be able to continue my total domination. </p>
			<h3>DLL and DYLIB hijacking</h3>
			<p>DLLs haunt us. It's something we must deal with. Most Windows applications don't use a fully qualified <a id="_idIndexMarker823"/>path when they load a DLL, so there's no structure. It basically says: <em class="italic">Run this DLL.</em> Instead, the default is that when an application <a id="_idIndexMarker824"/>launches, it first searches the directory from which it's been launched. Knowing most application developers and people take shortcuts—by not specifying a path—an attacker can load up a DLL inside of the application <a id="_idIndexMarker825"/>directory with malicious intent. An example of this is if an application <a id="_idIndexMarker826"/>needs the <strong class="source-inline">library.dll</strong> file (which is in the system directory) to install the application. If it can't find it, or if it finds it first in the path you're installing at, it'll never see the one in the system's directory of Windows. So, when the user goes through and loads up the application, it uses the DLL and the attacker will have full remote access to that box. Hmm—maybe this should make you wonder about downloading torrent files now, right? </p>
			<p><em class="italic">Fortnite</em>, a game that gets played by both children and adults, is extremely popular. Knowing this, attackers used to release <em class="italic">patches</em> to make players invincible or to give them extra guns. Well, sure it does, but it's mostly loaded with something else. In fact, security researchers discovered that flaw. </p>
			<p>Don't think <a id="_idIndexMarker827"/>for a second Windows is alone in this. Apple is very much a target. But instead of using DLLs, Apple uses <strong class="bold">DYnamically linked LIBraries</strong> (<strong class="bold">DYLIBs</strong>), which is basically the same concept. This is a dynamic library, hence the name, that an application may call, but DYLIBs are typically specific to a user. So, depending on how we want to deploy this, an attacker can just simply place a malicious DYLIB into a specific location. In a ton of cases, the loader in OS X is going to search for dynamic libraries in multiple paths. This is going to help the attacker inject a malicious DYLIB into one of the primary directories and then simply load the malicious DYLIB at runtime. This allows attackers to bypass security software, as well as even bypass Gatekeeper—a security feature of the macOS system that enforces code signing and verifies downloaded applications before allowing them to run. But again, I can bypass that all by doing a DYLIB hijack. Okay—let's stop picking on software. Let's talk about hardware!</p>
			<h3>Using CPU flaws</h3>
			<p>Let's talk about Spectre and Meltdown, shall we? Both these vulnerabilities are CPU-based and, unfortunately, the vulnerability goes back through all different types of chips over a long period. Each <a id="_idIndexMarker828"/>one of them takes advantage of either the memory's <a id="_idIndexMarker829"/>cache and the execution order, and/or takes advantage of branch prediction. Now, these are geeky terms but know that the vulnerability is there. </p>
			<p>The other issue we have, especially when focusing on things such as Spectre, is that it has some <a id="_idIndexMarker830"/>interesting issues here because it affects CPUs from Apple, AMD, <strong class="bold">Advanced RISC Machines</strong> (<strong class="bold">ARM</strong>) CPUs, Intel, Samsung, and even Qualcomm. These are basically all the mobile phones on the planet, right? This vulnerability tricks the processor into exploiting a speculative execution to read restricted data. What that means is that if the chip identifies a program that includes multiple conditional statements, it'll start to execute and then conclude all possible outputs before the program does, which makes the system faster. This vulnerability allows the attacker to force the processor to accomplish a speculative execution of <a id="_idIndexMarker831"/>a read before bounds checking is performed. The result? The attacker can access and read <strong class="bold">out-of-bounds</strong> (<strong class="bold">OOB</strong>) memory locations. Those locations could include things such as confidential information—such as credentials that are stored in a browser—or even reading kernel memory or performing a web-based attack using JavaScript. </p>
			<p>When it comes to Meltdown, this one's not as prevalent in all the CPUs, but it does affect any of the processors, whether Intel- or ARM-based, that Apple deployed. This vulnerability tricks a process to access OOB memory by exploiting CPU optimization mechanisms through speculative execution. The attacker can use either one of these vulnerabilities to execute or escalate their privileges by forcing an unprivileged process to read other adjacent memory locations, such as the kernel memory or physical memory. </p>
			<p>One of the biggest problems with both these vulnerabilities is they're built into the chip, and the only fixes that they've been able to come out with to support the CPUs that were released that had this vulnerability, which goes back years, was a software fix that ended up slowing down the performance of the CPUs. </p>
			<h3>Access token manipulation</h3>
			<p>An attacker <a id="_idIndexMarker832"/>can gain escalated privileges through things <a id="_idIndexMarker833"/>such as access token manipulation. Windows itself uses access tokens to determine the owner of a running process. A user or an attacker can manipulate access tokens to make a running process appear as though it belongs to someone else other than the user that started the process. We refer to those as spoofed tokens. </p>
			<h3>Application shimming</h3>
			<p>This comes <a id="_idIndexMarker834"/>into play when the Windows operating <a id="_idIndexMarker835"/>system uses the <strong class="bold">Windows Communication Framework</strong> (<strong class="bold">WCF</strong>). We call it a <strong class="bold">shim</strong>, and it's <a id="_idIndexMarker836"/>what allows Windows 10 to execute or run older <a id="_idIndexMarker837"/>programs. For example, for programs that were created under XP and you've upgraded to Windows 10, you still want the application to run. These shims provide a buffer between the program and the operating system. </p>
			<p>If you have ever done a compatibility wizard for Windows when trying to run an application, it'll ask you questions such as: "Does it need elevated privileges or did it run in previous versions of Windows?" That's helping you to build that shim. Now, the buffer, which the shim creates, is referenced when a program is launched. It needs to verify whether the program has access to the shim database. Some shims can be used to bypass the UAC, inject malicious DLLs, capture memory addresses, or even give the attacker the ability to install backdoors or escalate their privileges. </p>
			<h2 id="_idParaDest-200"><a id="_idTextAnchor204"/>Other Windows issues</h2>
			<p>There are also <a id="_idIndexMarker838"/>a ton of processes within the Windows operating system that execute binaries automatically as part of their functionality or whatever it is they're trying to accomplish with this application. If the filesystem permissions on these binaries aren't set appropriately, the attacker can replace these with malicious files. We refer to this as a filesystem permission weakness. If the process that executes the binary has a higher-level permission, then the binary also executes under the higher-level permission, which may include the system account. Attackers can take advantage of this technique and replace the original binaries with their malicious ones to escalate or elevate their privileges. </p>
			<p>We also have <a id="_idIndexMarker839"/>something called <strong class="bold">path interception</strong>. This is a method attackers use of placing an executable in a particular path so that it'll be executed by the application in place of the legitimate target application. Path interception helps the attacker maintain persistence on the system as well as escalate their privileges. </p>
			<h2 id="_idParaDest-201"><a id="_idTextAnchor205"/>Scheduled tasks</h2>
			<p>The Windows <a id="_idIndexMarker840"/>operating system has this thing called task scheduler, which allows a user to configure to defragment their system every 3 days or so. A user with administrative privileges could use these utilities in conjunction with a task scheduler to schedule a script or a program that can be executed at a particular time and date. If a user provides proper authentication, they can schedule a task from a remote <a id="_idIndexMarker841"/>system using a <strong class="bold">remote procedure call</strong> (<strong class="bold">RPC</strong>). The attacker can use this technique to execute malicious programs at the system startup, during any type of maintenance, as well as performing remote execution and, of course, escalating our privileges. </p>
			<h2 id="_idParaDest-202"><a id="_idTextAnchor206"/>Apple issues</h2>
			<p>For non-Windows folks, for macOS or OS X, during the boot process, <strong class="source-inline">launchd</strong> is executed to <a id="_idIndexMarker842"/>complete the system initialization process. Parameters for each of the launch-on-demand and system-level daemons are loaded using <strong class="source-inline">launchd</strong>. These daemons have a property list file (<strong class="source-inline">plist</strong>) that's linked to the executables that run at the time of booting. The attackers can create and install a whole different launch daemon that can be configured to execute at bootup time. These weak configurations allow the attackers to alter the existing launch daemons executable to maintain persistence within the system or to escalate their privileges. </p>
			<p>I know—you're saying: "Please tell me that's all." No—there's even more. Remember that <strong class="source-inline">plist</strong> file I just told you about? Well, these files exist for any application or service. It includes the necessary information that's needed to configure them. The <strong class="source-inline">plist</strong> files themselves <a id="_idIndexMarker843"/>are technically just <strong class="bold">Extensible Markup Language</strong> (<strong class="bold">XML</strong>) files, and how easy is it to modify an XML file? Attackers can access and alter these <strong class="source-inline">plist</strong> files to execute malicious code on behalf of a legitimate user. They can also use them to maintain persistence, as well as escalate their privileges on that box. </p>
			<h2 id="_idParaDest-203"><a id="_idTextAnchor207"/>Linux issues</h2>
			<p>If you are <a id="_idIndexMarker844"/>a Linux person, you're probably saying: "Man, we're safe!" Well, both in Linux and in macOS, if an application uses a <strong class="source-inline">setuid</strong> or a <strong class="source-inline">setgid</strong> flag, then the application will execute with the privileges of the owning user or the group. Typically, applications run under the current user's privilege, but there are some circumstances where the program must be executed with elevated privileges, but the user running the program doesn't have those elevated privileges. In this case, someone, maybe the developer, could set the <strong class="source-inline">setuid</strong> or the <strong class="source-inline">setgid</strong> flag for their application. An attacker could exploit the application with the <strong class="source-inline">setuid</strong> or the <strong class="source-inline">setgid</strong> flags to execute malicious code with elevated privileges. Do you see what's going on here? We're elevating our privileges all over the place. </p>
			<h2 id="_idParaDest-204"><a id="_idTextAnchor208"/>Web shells</h2>
			<p>The last one is a web shell, which is just a script that can be uploaded to a web server—or maybe it <a id="_idIndexMarker845"/>becomes part of the server—that enables remote administration to a machine. This works well for things such as remote administration using PowerShell. The problem is, an attacker can create their own web shells and inject malicious scripts into the web server to maintain or escalate their privileges. They can also use them as a backdoor to gain access and control the server remotely. Typically, a web shell runs under the current user's privileges, but if that box has any type of vulnerabilities built into it, they can escalate their privilege and then install malicious software, change user permissions, add users and groups, steal credentials, read emails—almost anything.</p>
			<h2 id="_idParaDest-205"><a id="_idTextAnchor209"/>Buffer overflows</h2>
			<p>Let's first <a id="_idIndexMarker846"/>back up and understand what the ultimate purpose of any program is that runs on a computer—it's to process data of some type. Usually, that data is going to be provided by a user, so the program needs to store the data somewhere, and the best place to put it into is memory. This is where our troubles begin. Many developers assume that user input will be reasonable to a certain extent. It would seem kind of unreasonable for, as an example, a URL address to be more than, say, 500 characters. And usually, developers will pad this by multiplying in either by 2 or even by 10. So, based on this assumption, the developer could reserve memory for a web page <a id="_idIndexMarker847"/>address that could hold up to 5,000 characters. Now this memory <a id="_idIndexMarker848"/>space that's reserved is called a <strong class="bold">buffer</strong>, and it's a buffer in <strong class="bold">random-access memory</strong> (<strong class="bold">RAM</strong>). So, because the developer may never suspect that someone's <a id="_idIndexMarker849"/>going to use more than 5,000 characters, they usually don't apply any type of check. The data is just processed as it's applied. So, what happens if the user unintentionally—or possibly intentionally, with malicious motives—provides a web address that I don't know with 5,500 characters in it? Well, after writing that 5,000th character, anything else left over is bad, and it's placed in memory after the buffer, which results in a buffer overflow. Now, the purpose of these attacks is usually to allow the attacker to run their own code directly on this system. This is <a id="_idIndexMarker850"/>referred to as <strong class="bold">arbitrary code execution</strong>, or possibly they can execute their code and transmit it from one machine to another. This is <a id="_idIndexMarker851"/>sometimes referred to as <strong class="bold">remote code execution</strong>. </p>
			<h2 id="_idParaDest-206"><a id="_idTextAnchor210"/>Denial of service</h2>
			<p>Then we have, obviously, our most famous one (probably): <strong class="bold">denial of service</strong> (<strong class="bold">DoS</strong>). This includes <a id="_idIndexMarker852"/>conditions that allow attackers to consume all the resources of the CPU—the drive, connections, RAM—so that the process can no longer service legitimate requests. </p>
			<p>Another <a id="_idIndexMarker853"/>type of vulnerability is another famous one, <strong class="bold">cross-site scripting</strong> (<strong class="bold">XSS</strong>). This is a vulnerability whereby a malicious script is injected into a website, and then that script is downloaded and executed by the browser on an end user's system—or, should I say—a different user's system. </p>
			<p>Another famous one is directory transversal. This is a vulnerability that allows the attacker to access restricted directories from where they've entered. For example, if I were to maybe go to my home directory on my production network that is assigned to a <strong class="source-inline">D.</strong> <strong class="source-inline">Meredith</strong> directory on a server somewhere, if I'm able to execute some malicious code and be able to move over to B. Wayne's directory to see their information, or C. Kent's, or even L. Lane's, we <a id="_idIndexMarker854"/>might have some fun there. We also have what they refer to as <strong class="bold">cross-site request forgery</strong> (<strong class="bold">CSRF</strong>). These types of vulnerabilities allow unauthorized commands to be transmitted from the user to a web app.</p>
			<p>So far, we <a id="_idIndexMarker855"/>have cracked a password, figured out our user account, got into the system, elevated our privileges—so, we're done, right? Well, we may have <em class="italic">pwned</em> the machine so far, but a total pwn is when we can maintain access via executing applications.</p>
			<h1 id="_idParaDest-207"><a id="_idTextAnchor211"/>Phase 3 – Maintaining access and executing applications</h1>
			<p>Overall, the <a id="_idIndexMarker856"/>whole process in this phase is being able to make sure that we can always get back in. Again, from the attacker's perspective, you don't go through all the steps that we've gone through just to say: "Haha, I did it!" and walk away, right? We're also here to see what's going on and to get a clear picture of the system or the target machine. We are also detecting what other information could be available to us that might have been blocked to us before. </p>
			<p>Let's say I'm an attacker who's created a piece of software, and I put it out into the wild and it phones home, and one day I see three systems have installed my piece of software. I'll use that software to get back in and then use some additional software to make sure I have an extremely clear understanding of the environment. One of the things I'll be <a id="_idIndexMarker857"/>looking for is if they have any type of <strong class="bold">intrusion detection system</strong> (<strong class="bold">IDS</strong>). </p>
			<p>How do we execute applications? </p>
			<p>Well, this is typically applied in one of the following three ways:</p>
			<ul>
				<li><strong class="bold">Spyware</strong>: The most <a id="_idIndexMarker858"/>common and easiest way is via spyware. I know that's a hot word out in the industry and there are different levels of spyware—for example, there are legitimate spyware products out there. If I were to go in and install an application on my Android device, many times I'm saying: "Yes—go ahead and look at my contacts, or use my network connection." </li>
			</ul>
			<p>My father taught me something very valuable. He said: "There is no free lunch." If you are old enough to understand that phrase, you know he meant there's nothing for free out there. I know it says it's free—Gmail says: "Hey, it's free." But is it? We're paying a price for that. The price is Google going through and looking at <a id="_idIndexMarker859"/>your emails and looking for specific words so that they can sell marketing. That's how they make their money! Nobody's out there saying: "I'd like to be a Good Samaritan, spend countless hours creating an application, and just give it away for free." It doesn't work that way. </p>
			<ul>
				<li><strong class="bold">Backdoors</strong>: We can <a id="_idIndexMarker860"/>execute applications via a backdoor, which allows a user or an attacker to come back in without being noticed. With a keylogger, I can say anytime a specific keystroke or combination of keystrokes are executed, please execute my program. Backdoors are great because they're stealthy <a id="_idIndexMarker861"/>and can also be used in <strong class="bold">command and control</strong> (<strong class="bold">C2</strong>) scenarios to bypass firewalls and IDS systems.</li>
			</ul>
			<h2 id="_idParaDest-208"><a id="_idTextAnchor212"/>Spyware and backdoors</h2>
			<p>When we <a id="_idIndexMarker862"/>talk about spyware, we have this vision that comes up in our minds about uneducated users, such as grandmas (or, in my case, nieces and nephews), who install fake software or click on a link, and boom: "Bob's your uncle."</p>
			<p>Spyware is <a id="_idIndexMarker863"/>normally installed by us when we download a file, app, or free product. Typically, the manufacturer wants to know how you're running that product, or maybe they are going to make money. In fact, I think it's funny that the last time I installed Java, if I hadn't hit the <strong class="bold">Advanced</strong> button during installation, I would have also installed some additional toolbars and software that I'm sure Oracle gets paid for. </p>
			<p>Spyware is designed to capture our authentication credentials as we type them in. An attacker might even capture emails or fire up and record information when we type in something on a web form. Again, I'll use Google as an example since they're the big boy on the block and they give <em class="italic">everything away for free</em>. A lot of it is they're trying to capture habits. Well, think of that from the attacker's perspective. Could they not profile you a little better if they understood your habits? "What kind of habits?" That could be: "Hey, this target uses this password when it comes to banking sites", or "They use this password when it comes to their social networking sites", or "The target is just using a variation of a specific password." If I'm capturing both screenshots and keystrokes, I can start to capture habits. Even on your Android phone, if you download a free app from a torrent and sideload, it could be malicious, and these apps could start capturing your habits. Some legitimate apps track how long the user is using the app or even finger-swiping actions on your devices.</p>
			<p>Also, when <a id="_idIndexMarker864"/>you go to install an application on your tablet, phone, computer, do you sit down and read the <strong class="bold">user license agreement</strong> (<strong class="bold">ULA</strong>)? No? I know—I sometimes don't either. But I understand the overall gist of it. That is—one: you don't own the software; and two: we are going to collect information about you, possibly <a id="_idIndexMarker865"/>access your contacts, see how long you use our app, and maybe <a id="_idIndexMarker866"/>see which app you open after using our app. If I deem the app to be that worthwhile, I'll accept that as a risk. However, I only accept it as a risk from legitimate software companies. </p>
			<h2 id="_idParaDest-209"><a id="_idTextAnchor213"/>Types of spyware </h2>
			<p>Spyware is typically <a id="_idIndexMarker867"/>installed while installing an application. For example, if I download a copy of WinZip, and then during installation, I just hit <strong class="bold">Next</strong>, <strong class="bold">Next</strong>, <strong class="bold">Next</strong>, <strong class="bold">Next</strong>, <strong class="bold">Next</strong>, <strong class="bold">Next</strong>, <strong class="bold">Next</strong>, <strong class="bold">Next</strong>—which they're hoping I do—I might install <a id="_idIndexMarker868"/>a new toolbar, and that toolbar in <strong class="bold">Internet Explorer</strong> (<strong class="bold">IE</strong>) will track some of my activities. </p>
			<p>Now, think of this from an attacker's perspective. Let's say a new version of Photoshop comes out, and as an attacker, I crack that product and put in my own piece of spyware so that when the user installs the app, my spyware gets installed. I'm going to make sure it's hidden so that they can't see it running. Yes, I can hide it from your Task Manager. </p>
			<h3>It's in videos</h3>
			<p>We also have <a id="_idIndexMarker869"/>spyware that comes across via video. I'm not talking about YouTube, although I'm pretty sure YouTube does monitor which videos you're watching on their channel. But that would be legitimate, right? Other video sources might tempt you with the latest blockbuster movie for free, but the truth is… it's not. I had a nephew who brought me his computer once and said: "Hey, it's running really slow and sluggish." </p>
			<p class="callout-heading">Important Note</p>
			<p class="callout">Slow performance is one of the signs you have spyware installed. </p>
			<p>As I'm going through and looking at it, I see all these programs that are firing up during startup, and as I'm talking to him, he tells me about finding this really cool website where he can stream movies that are still in the theater for free. Now, again, I'm sure Netflix spies <a id="_idIndexMarker870"/>on us; however, I'm more worried about someone coming to my house and making a mistake on my network or systems. My nephew tried to pull up the web page so that I could see it, and I jumped up: "Noooo", and quickly unplugged the network cable because I know what's out there. </p>
			<h3>Your printer is spying on you</h3>
			<p>There's also spyware for printing. How about if I load a piece of spyware and everything you print, I get a <a id="_idIndexMarker871"/>copy of it, please? Think about that for a second. What do you print? Are you sure you've never printed tax forms, medical records, or—better yet—let's say your doctor gets a piece of spyware on their machine because the doctor's receptionist thinks every time a popup comes up saying "You need to install this piece of software" Is this because they visit inappropriate or malicious websites? An attacker can install a piece of spyware and get a copy of every single document printed. </p>
			<h3>USB is guilty too</h3>
			<p>We also <a id="_idIndexMarker872"/>have USB-based spyware. Here, I have this piece <a id="_idIndexMarker873"/>of software that I show as kind of a <strong class="bold">proof of concept</strong> (<strong class="bold">POC</strong>). It's used quite often out there but I always have students come up to me and say: "Is there any way you can give me a copy of this whitepaper?" Or, they say: "Can you give me a copy of these VMs?" If I had malicious intentions, I could simply say: "Sure, just bring me a USB drive", and when they do, I would plug it in. I would have a little program whereby as I'm copying files to their USB drive, I'm also injecting spyware onto their USB drive so that when they plug it into their system, it injects everything silently, without their knowledge. It would also download everything on their USB drive to my machine as well.</p>
			<h3>Mic check – 1,2…1,2</h3>
			<p>We also have <a id="_idIndexMarker874"/>spyware that's injected into audio. There is no such thing as free MP3s! Again, let's think about both sides—legitimate reasons for spyware and the dark side of spyware. </p>
			<p>Let's say you have an account with Spotify, Google, or Google Music. I guarantee those companies are monitoring and seeing what you're doing with their audio files: how many machines you've installed it on, how many times you've listened to it, and so on. Some of this is done with cookies, but if you're installing any type of application or plugin in your web browsers, I guarantee you're getting some type of tracking software.</p>
			<p>If I want to <a id="_idIndexMarker875"/>get spyware on your machine, I'll go for a new album coming out by a popular musician or band, rip it, add my spyware, and post it on torrent sites. Whenever somebody downloads it and starts to play music, my spyware would kick in. </p>
			<h3>Email and phishing</h3>
			<p>We also have spyware that's distributed via email and the internet. We've talked about malicious <a id="_idIndexMarker876"/>websites, and I've seen them. People get emails saying: "Hey, this is the IRS. We're going to start filing charges against you because of your tax forms… click here." And you or the user clicks on the link, goes to a site, or executes a script that's malicious in nature.</p>
			<p>Don't think for a second that attacks are limited to PCs/laptops. This is exploding on the mobile platform. One of the things I do before installing an application on my phone—because I know there could be something there to track what I'm doing—is look at the permissions to see what it is they need access to. If it's a game, I don't care how cool the game is. If it wants access to my contacts, there's no way it's going on my device. Likewise, review the permissions of applications. Most of the big vendors require you to do this, whether you're getting it from the iTunes Store, the App Store, Google, or Amazon—those I would consider somewhat trusted sources. History shows us that there have been many bad apps sneaking into their stores.</p>
			<p>Be very careful about downloading software or applications from different repositories out there, even if it's the coolest thing ever. In fact, that's part of the social engineering aspect of hacking. I'm counting on the fact that you want this so stinking bad, you're willing to justify and jump through some hoops and maybe install a piece of software that's going to help me <em class="italic">pwn</em> you.</p>
			<p>Next, we'll discuss the use of backdoors to further our ability to access our targets. </p>
			<h2 id="_idParaDest-210"><a id="_idTextAnchor214"/>More about backdoors</h2>
			<p>When it <a id="_idIndexMarker877"/>comes to backdoors, we want to make sure we understand what they are. </p>
			<p>Backdoors consist of two components—one of them is on the client side, while the other is on the server side. </p>
			<p>The client is what I want to hopefully install on my targets, while the server is the box that all the clients will report into. </p>
			<p>Many backdoors will also have automation built into them. Some of that automation could include <a id="_idIndexMarker878"/>things such as a <strong class="bold">connect-back technique</strong>. This is where I can get the client side installed on a target (maybe because they've downloaded my free evil copy of Photoshop), and, to bypass the security of most firewalls (most firewalls block all inbound connections unless they've been initiated by an outbound connection), I have the client connect back through the firewall to my server side. </p>
			<p>We might also use what's referred to as the first-line backdoor, which is sending the initial malware. The primary backdoor acts as a downloader for other malware that we then get to install. Normally, when somebody is infected, there's going to be multiple backdoors created, not just one. So, if I get the first-line backdoor installed, then the second-line backdoor is what goes out and steals the information I'm looking for. </p>
			<p>You may be thinking "I'll just delete it if I detect it" or "I have antivirus installed". Well, the issue here is that part of the automation of most of these backdoors and spyware programs includes the ability to make it impossible to update Windows. They disable your antivirus product, infect your host file, make sure you can't open it, and lock down the system to stop you from fixing it. Or, at least, it's going to take somebody with some computer knowledge, which typically isn't the standard user, to repair it.</p>
			<h3>Common backdoors</h3>
			<p>Some of the more common backdoors are the most popular ones out there. Back Orifice was a popular one. This was created by an organization that was called <em class="italic">Cult of the Dead Cow</em>. They got the name <em class="italic">Back Orifice</em> from the fact that Microsoft had a product line for all their server platform products. Not only Server 2000, but also SQL and Exchange, were all part of the BackOffice product line, so, making fun of it, they called it Back Orifice. </p>
			<p>Sercomm manufactures most routers and parts that go on the router, and routers are sold by Netgear, Cisco, Linux and so on. Well, there was a backdoor in these devices, and it's funny that they came out with a patch that was supposed to fix the backdoor but didn't—all it did was hide the backdoor. Their backdoor worked across a particular port so that an attacker could open up a remote shell, reset the router, or even make modifications to the configuration. </p>
			<p>When we talk <a id="_idIndexMarker879"/>about backdoors, I can't go very far without talking about some government agencies. Some of these backdoors were included in hardware being sold <a id="_idIndexMarker880"/>to other countries. The <strong class="bold">National Security Agency</strong> (<strong class="bold">NSA</strong>) has been working hard to come up with backdoors for encryption technologies. In fact, in early 2015, Microsoft issued a security advisory where they <a id="_idIndexMarker881"/>admitted they were aware of a security feature bypass vulnerability, which was known as <strong class="bold">FREAK</strong>. <strong class="bold">FREAK</strong> is short for <strong class="bold">Factoring Attack on RSA-EXPORT Keys</strong> and is a known MitM vulnerability caused by weak website encryption. It made it possible for attackers to backdoor in and spy on secured communications. You'll never guess who took advantage of that one! </p>
			<p>There are also consumer products. Remote exec is probably one of the more popular ones out there. You can use this product to install applications silently, meaning that the user doesn't see an application being installed, executing scripts, copying, modifying, or deleting files. Maybe do a filter and say: <em class="italic">send me all DOCs</em>. I could even change the admin password or turn the machine off or on at any given time. Again, this product is designed for administrators to manage their environment, but if I install something such as this on your machine or get a client to install it, and have it report back to my server, I'll have total control of your box.</p>
			<p>We've discussed how to maintain access and execute applications through several different tools and options, allowing us continued access to a system or network while remaining undetected. Next, we'll discuss hiding our tools.</p>
			<h1 id="_idParaDest-211"><a id="_idTextAnchor215"/>Phase 4 – Maintaining access and hiding your tools</h1>
			<p>I know <a id="_idIndexMarker882"/>what you're thinking. There's no way he can <a id="_idIndexMarker883"/>come up with a joke for this one, right? So, when I'm talking about hiding your tools, what we're really getting into here is something I saw on one of those sarcastic t-shirts: <em class="italic">Shhhh…I'm hiding from stupid people!</em> That's what we're going to do here—hide our tools so that less intelligent people or those who are not security-minded will not be able to find them. Again, the <a id="_idIndexMarker884"/>last thing we want to do is go through <a id="_idIndexMarker885"/>all this effort to get our machine totally pwned and then lose it because we don't hide our software from users or IT experts. </p>
			<h2 id="_idParaDest-212"><a id="_idTextAnchor216"/>Rootkits</h2>
			<p>When you <a id="_idIndexMarker886"/>find a rootkit in your environment, you're going to be terrified beyond the capacity for rational thought. You'll think, mother-puss-bucket! </p>
			<p class="callout-heading">Security Note</p>
			<p class="callout">If you discover a system with a rootkit installed, you should never trust it. Don't <em class="italic">clean</em> it. Don't try to fix it. You need to reimage the system from scratch—operating system and apps, all new. Please don't make the mistake of trying to <em class="italic">save</em> the system.</p>
			<p>Rootkits were first discovered by something that Sony tried to slip past everybody. This was back <a id="_idIndexMarker887"/>in 2005 when Sony started loading copy protection measures on about 22 million <strong class="bold">compact discs</strong> (<strong class="bold">CDs</strong>). When you inserted the CD into a computer, the CD installed a piece of software that modified the operating system so that it would interfere if you tried to copy the CD. What was bad is this: 1) The rootkit couldn't be uninstalled; 2) It created additional vulnerabilities. And one of the programs that they <a id="_idIndexMarker888"/>utilized actually installed even if the user denied or refused its <strong class="bold">end-user license agreement</strong> (<strong class="bold">EULA</strong>), and it phoned home and reported what the user's listening habits were. Now, this is back during the height of things such as Napster. </p>
			<p>This was discovered by Mark Russinovich, the gentleman who created the Sysinternals software suite. He saw something going on with the CDs and he reported it. Nobody believed him, except <a id="_idIndexMarker889"/>for one small antivirus firm called <strong class="bold">F-Secure</strong>. F-Secure was one of the first companies that came out with one of the first rootkits and uninstallers. </p>
			<p>So, why do we use rootkits? Well, they have two primary functions associated with them: remote control or a backdoor. As well as eavesdropping, rootkits allow an attacker to gain administrative control over a computer. This means that they can run any program, see what people are doing on the system, and even change the system's configuration. </p>
			<p>There are different types of rootkits out there allowing for different functionality, but the biggest issue is these are extremely hard to remove. Rootkits are the mother of all infections if you want to think of it from a virus perspective. So, again, why are rootkits used? Well, we'll gain remote-control access and watch what's going on with the environment. If you're thinking "I just got my antivirus and it's doing just fine—it didn't detect it", you need to make sure your antivirus is always up to date, but there is something out <a id="_idIndexMarker890"/>there referred to as the polymorphism of rootkits. This technology makes rootkits extremely difficult to find because of what it allows a rootkit to do. It allows a rootkit to rewrite the core assembly code. So, now, suddenly, your antivirus, especially if it's signature-based, is useless. </p>
			<p>The only way to find rootkits that use polymorphism would be to use technology that looks deep inside the operating system and compares it against a baseline of what a good operating system, or a healthy operating system, would be like. </p>
			<p>There are several types of rootkits out there, as outlined here:</p>
			<ul>
				<li><strong class="bold">User-mode rootkit</strong>: In user mode, the rootkit runs on the computer with administrative <a id="_idIndexMarker891"/>rights or privileges. This allows <a id="_idIndexMarker892"/>the rootkit to alter security, as well as hide processes, files, system drivers, and system services, and the rootkit stays installed by just simply copying the files to the computer's hard drive and automatically launching them every time the system boots. The downside, at least from the attacker's perspective, is that user mode is one of the only types that antivirus and anti-spyware applications can detect. </li>
				<li><strong class="bold">Kernel-mode rootkit</strong>: What the attackers have done at this point is they know user-mode <a id="_idIndexMarker893"/>rootkits can be detected—so, how about if we just <a id="_idIndexMarker894"/>load the rootkit at the same level as the operating system? At this point, the operating system can't be trusted. One <a id="_idIndexMarker895"/>of the most famous kernel-mode rootkits was Da IOS Rootkit, which was focused on Cisco's <strong class="bold">iPhone OS</strong> (<strong class="bold">iOS</strong>) operating system. So, yes—you can get rootkits on network devices. </li>
				<li><strong class="bold">Hybrid rootkit</strong>: This is <a id="_idIndexMarker896"/>the best of both worlds, where we can take <a id="_idIndexMarker897"/>some of the characteristics from a user-mode rootkit, being that it's easy to use and stable, along with the kernel-mode rootkit—meaning: I can hide this thing. This is one of the more popular rootkits out there today. </li>
				<li><strong class="bold">Firmware</strong>: This type <a id="_idIndexMarker898"/>of rootkit is similar to a user-mode <a id="_idIndexMarker899"/>or a kernel-mode rootkit, but this rootkit actually hides in the firmware when the computer shuts down—so, when you restart the computer, the rootkit just reinstalls itself. When we say that it hides itself inside of firmware, it <a id="_idIndexMarker900"/>could be anything from a microprocessor code to a <strong class="bold">Peripheral Component Interconnect</strong> (<strong class="bold">PCI</strong>) expansion card firmware. And again, on every restart, the rootkit gets reinjected. </li>
				<li><strong class="bold">Virtual rootkit</strong>: These <a id="_idIndexMarker901"/>are relatively new, and the most popular <a id="_idIndexMarker902"/>one I can think of is called Blue Pill, which is based on x86 virtualization. It was a POC that was presented in <em class="italic">Black Hat</em> back in 2006. The concept of Blue Pill was to trap a running instance of an operating system by simply starting a thin hypervisor and then virtualizing the rest of the machine underneath it. The previous operating system would remain, and any references to devices or files, or anything that dealt with hardware interrupts or requests for data, including system time, could be intercepted or faked by the new hypervisor. </li>
			</ul>
			<p>The gentleman who came up with this made a statement at <em class="italic">Black Hat</em> that he felt it would be 100% undetectable because the rootkit itself was virtualized. You might say: "Yes, but I still have an antivirus, and I keep it up to date." Well, it doesn't matter. Your antivirus might pick up the fact that you have a rootkit on your machine, and you can try to clean it off, but I want you to repeat after me, this is SuperDale rule number 385: "Any system that's been detected with a rootkit is no longer trusted." What that means is you're going to take it offline, format the hard drive, and reinstall. Do not—this is my personal feeling—continue using an operating system that has already been compromised because you don't know if it's firmware-based; cleaning it may clean the one instance, but as soon as you restart the machine, you're back to square one. </p>
			<p>Now that we're here, let's look at some interesting rootkits. </p>
			<h2 id="_idParaDest-213"><a id="_idTextAnchor217"/>Horse Pill </h2>
			<p>This rootkit <a id="_idIndexMarker903"/>was presented at <em class="italic">Black Hat</em> back in 2016 by a security engineer and member of the Red Team for Intel. Horse Pill was a POC Linux rootkit. That was really kind of interesting because it infected the internal RAM disk. Once there, it was put into <a id="_idIndexMarker904"/>a mount and a <strong class="bold">persistent ID</strong> (<strong class="bold">PID</strong>) namespace that allowed it to run covertly, including its storage. This also allowed it to run some network systems without the user knowing, such as a DNS tunnel. </p>
			<p>Don't worry—I'm not going to just pick on Linux! Yes—we've got Windows too. There's one out there known as the GrayFish rootkit, which runs inside the Windows operating system. It is one of the most modern and sophisticated malwares implanted from a group that <a id="_idIndexMarker905"/>was called the <strong class="bold">Equation Group</strong> and was designed to provide an almost invisible presence using hidden storage, as well as malicious commands executed inside the Windows operating system. This was developed around 2013, but variations of it have been popping up all over the place. The reason it's so malicious is when the computer starts, GrayFish hijacks the operating system loading mechanisms by injecting its own code into the boot record. This basically allows it to control the launching of Windows at each stage, bypassing the Windows Secure Boot controls. Rootkits use stealthy storage, but GrayFish implemented its own encrypted virtual filesystem inside of the Windows registry. </p>
			<p>If that's not emough to scare you, check this out. Hold on to your socks here. You ready? The Equation Group has released a module named <strong class="source-inline">nls_933w.dll</strong> that was the first of its kind that was designed to reprogram or reflash a computer's hard drive and its firmware with the malicious code. It has been found in drives from Seagate to Toshiba, Samsung, Western Digital, Micron, Nextdoor, IBM, and Hitachi. You may be saying: "Wow, whoever created this really thought this through." Yes—its origins are from some of the tools that my big brother—as I like to call the NSA—uses.</p>
			<h2 id="_idParaDest-214"><a id="_idTextAnchor218"/>Alternate Data Streams </h2>
			<p>First, I need to <a id="_idIndexMarker906"/>make sure I have your attention. Next to passwords, this is my next biggest pet peeve. When it comes to <strong class="bold">Alternate Data Streams</strong> (<strong class="bold">ADS</strong>), there's something you need to understand. First, this is not a well-known feature. I'm surprised how many times I teach a security class and I mention ADS to people that have been in IT for years whose jaws drop as they say: "I didn't know that was something that could be done." </p>
			<p>ADS has been around since NT 3.1. That's a long time ago, but it's still being used today. The reason this feature was first created was—thanks, Steve Jobs—so that Microsoft could be <a id="_idIndexMarker907"/>compatible with the Macintosh <strong class="bold">Hierarchical File System</strong> (<strong class="bold">HFS</strong>). Now, the Macintosh filesystem stores its data in two parts. There's a data fork and resource fork. The data fork is where we store the data itself about that file. The resource fork is what gives us additional information about a file. Because of these two forks, we're able to hide files extremely efficiently. So, this is one of those necessary evils. We want to be able to store additional data about a document, as well as the document itself. </p>
			<h2 id="_idParaDest-215"><a id="_idTextAnchor219"/>Detecting rootkits</h2>
			<p>As far as <a id="_idIndexMarker908"/>detecting rootkits is concerned, it depends on the type of rootkit that is installed. It could be one of the following methods:</p>
			<ul>
				<li><strong class="bold">Integrity-based detection</strong>: This can be regarded as a substitute to both signatures <a id="_idIndexMarker909"/>in a heuristic-based <a id="_idIndexMarker910"/>detection. What happens is the user will run a tool such as Tripwire or <strong class="bold">Advanced Intrusion Detection Equipment</strong> (<strong class="bold">AIDE</strong>) on a clean system. The tool then creates a baseline of a clean system and stores it in a database, and then we can use that database to compare existing workstations to see if there are any issues. </li>
				<li><strong class="bold">Signature-based detection</strong>: This is like a fingerprint. It compares the characteristics <a id="_idIndexMarker911"/>of all the system <a id="_idIndexMarker912"/>processes, as well as the executable files with a database that's been created of known rootkit fingerprints—very similar to how most of our virus programs work. </li>
				<li><strong class="bold">Runtime execution path profiling</strong>: This technique compares the runtime execution <a id="_idIndexMarker913"/>path of all the <a id="_idIndexMarker914"/>processes and the executable files. Normally, the rootkit adds new code near to the routine's execution path, which destabilizes it, and this runtime execution path profile picks it up. </li>
				<li><strong class="bold">Heuristic/behavior-based detection</strong>: This works by identifying the deviations of the normal operating system behaviors and their patterns. The cool thing <a id="_idIndexMarker915"/>about these types of detection <a id="_idIndexMarker916"/>is that they are normally capable of identifying new, as well as previously unidentified, rootkits. They're able to do this because they can see a difference in what would be considered normal as far as the system pattern or its behaviors is concerned. </li>
			</ul>
			<p>There are <a id="_idIndexMarker917"/>tons of tools out in the world that will help you detect rootkits, and that's fine and dandy, but a lot of times, attackers are coming up with new ways of bypassing or being undetected by this type of protection. So, it's sometimes best to check manually, and there are <em class="italic">two</em> different steps to do that. </p>
			<p>The first and most common step is doing it through the filesystem by typing in <strong class="source-inline">d-i-r</strong>, which is short for directory; <strong class="source-inline">/s</strong> is to include subdirectories, followed by <strong class="source-inline">/b</strong>, which uses a bare format, meaning: I don't need any header information or summary; I just need the information itself. We will then type <strong class="source-inline">/a</strong>, which basically says: I want to include the following attributes. The attribute we're specifying here is <strong class="source-inline">h</strong>, which is hidden files. We would save that result, and then run a very similar command, except that you'll notice it's a little different on <strong class="source-inline">ah</strong>. Instead of <strong class="source-inline">ah</strong>, we do <strong class="source-inline">a-h</strong>. <strong class="source-inline">h</strong> means not—so, don't give me the hidden attributes. You would save those results and boot off a clean CD—it could be a Windows CD, an installation CD—and you get to Command Prompt and run the same commands again and save that output. </p>
			<p>The second step is where we determine what the differences are. </p>
			<p>We'll download a program called WinDiff by Microsoft and run that on the two sets of results to detect file-hiding ghostware. What we mean by that is files that aren't recognized while the system is on, which is what we did in the first two steps, versus files that are exposed or visible because we booted off the CD. Now, it should be noted that sometimes, you'll get some false positives, and you'll just need to track those down. This <a id="_idIndexMarker918"/>method doesn't detect stealth software that's hiding, for example, in the <strong class="bold">basic input/output system</strong> (<strong class="bold">BIOS</strong>) or in a bad disk sector or an alternate data stream, or even video card e-prompts. But it's something, right?</p>
			<h2 id="_idParaDest-216"><a id="_idTextAnchor220"/>Steganography</h2>
			<p><strong class="bold">Steganography</strong>, or—as we sometimes refer to it, <strong class="bold">stega</strong>—is the ability to take a document and <a id="_idIndexMarker919"/>hide it in plain sight. We do that by placing the document in—more commonly—a photo so that we can hide it behind or inside of other data. Unlike ADS, the size of the picture file—in this case, a photo—will increase in size. If I have a picture that's 1 <strong class="bold">megabyte</strong> (<strong class="bold">MB</strong>) in a file and a document that's 4 MB, the picture file becomes 5 MB in size. It hides inside of the other file by replacing the unused data bits with bits from the file you're trying to hide. It's extremely difficult to detect. In fact, some will say it's almost impossible to detect. </p>
			<p>Steganography is broken into two classifications, technical and linguistic. </p>
			<p>Technical steganography hides the message using a scientific method, whereas linguistic steganography hides the message inside of what they refer to as a carrier or some type of media that's used to transfer files back and forth or communicate. As far as the type of steganography that's accessible to us is concerned, we can hide files in an image. We can also use steganography to hide files in another document, very similar to what we saw with ADS. </p>
			<p>Steganography can also be used to hide files inside of a folder, or the object representing the folder, and audio. Yes—I can hide a hidden message or file inside of an audio file. In fact, this is one of the things that's going on right now in fighting terrorism. A lot of terrorist organizations communicate with each other by hiding their messages inside audio and video-based files. You always hear on the news that a new video's been released by some terrorist organization and that the government is currently <em class="italic">reviewing</em> it. What they're doing here is going through and checking to see if there's anything hidden inside the video, as well as looking at the video in depth to find out if they can find out where it's coming from by looking at backgrounds and listening to background noises. </p>
			<p>We can also hide our files inside of web-based applications or websites so that you must know exactly where to go within the website, either to a hidden image, a hidden URL, or just a hidden location on the page that would reveal information that is normally not visible. </p>
			<p>We can also use it to hide information that we refer to as white space. We do this with a program called <strong class="bold">Snow</strong> that <a id="_idIndexMarker920"/>conceals the message, which is normally in an <strong class="bold">American Standard Code for Information Interchange</strong> (<strong class="bold">ASCII</strong>) format by pinning white space to the end of each line. Now, because the space and tabs are generally not visible in text viewers, the message is effectively hidden, and if you use built-in encryption, the message can even be read even if it's detected. </p>
			<p>Steganography can also be used to hide files in emails. In fact, it's very similar to the web-based <a id="_idIndexMarker921"/>steganography types because most emails will support <strong class="bold">HyperText Markup Language</strong> (<strong class="bold">HTML</strong>). So, again, we can hide files or messages inside of emails. </p>
			<p>We can also <a id="_idIndexMarker922"/>use it to hide files inside <strong class="bold">digital versatile discs</strong> (<strong class="bold">DVDs</strong>). So, again, I ask you this: Where did you get your last copy of the latest movie release? I could be hiding my tools, and when you run the movie or go to watch it, my tools inject. </p>
			<p>Natural <a id="_idIndexMarker923"/>text-based is another type of steganography. These types of programs will convert information you're trying to transmit into a flow of text like a play. So, if somebody's looking at your text document, they'll be wondering: "What is this guy talking about? He's just talking about one day he went for a walk with his dog."</p>
			<p>One of the more popular programs out there, Sams Big G PlayMaker, goes through and you hide your text within the play itself. </p>
			<p>Another type of steganography is hidden operating system-based. This is where I inject my tool inside of some of your hidden operating system files and my tools execute anytime your operating system needs to use those files. </p>
			<p>Now that we have been able to maintain access and hide our tools, let's discuss how we get out without leaving a trail and being detected by clearing logs and evidence we've been there.</p>
			<h1 id="_idParaDest-217"><a id="_idTextAnchor221"/>Phase 5 – Covering your tracks – Clearing logs and evidence</h1>
			<p>So, why <a id="_idIndexMarker924"/>do we clear our tracks? </p>
			<p>First, we want to remain obscure. We don't want somebody knowing that we've gotten into the system. Otherwise, all our hard work has gone to waste. </p>
			<p>Second, we want to avoid tracebacks. This is where the victim hires a forensic expert to figure out <a id="_idIndexMarker925"/>exactly what happened. Back in the day when I had my own <strong class="bold">internet service provider</strong> (<strong class="bold">ISP</strong>) service, I had a customer who was complaining he wasn't getting the speeds he was paying for. Together with one of my friends, a white <a id="_idIndexMarker926"/>hat from Microsoft and author of several security and <strong class="bold">integrated security system</strong> (<strong class="bold">ISS</strong>) books, we saw something going on with this customer's antenna. We discovered the customer had plugged the internet connection directly into his company laptop without going through a router, and he got totally pwned. We found out the reason he wasn't getting the speeds is because somebody had uploaded movies on his laptop and was using his laptop as a parted FTP server. My friend was able to use some of the log files we were looking at <a id="_idIndexMarker927"/>to see the IP addresses of the connections coming in, and we were able to trace it back to an IP address in Germany. There wasn't much we could do about it at that point, which I guess really does sum up one of our biggest problems with the internet today: there is no sheriff in town. But that's what we want to avoid. We want to avoid tracebacks. </p>
			<p>Third, we want to convince the victim or victims there is nothing is going on. "This machine has not been compromised; continue to do what you're doing." In fact, it's when machines start acting funny that people start getting their suspicions up, right? Now, we could also talk about the big issue for attackers not wanting to be detected as they don't want to go to jail. </p>
			<p>Next, we'll look at a basic method of clearing our tracks, which would be the action of a good attacker, and then we'll look at what a great attacker might accomplish.</p>
			<h2 id="_idParaDest-218"><a id="_idTextAnchor222"/>Basic method – Five things to do</h2>
			<p>A basic method is what a good attacker would accomplish or do while covering their tracks. They're going to do some basic things, and most of this will be detected very easily. This is what they'll do:</p>
			<ul>
				<li><strong class="bold">Clear browser history</strong>: A basic <a id="_idIndexMarker928"/>method would be to clear any browser history on that machine relating to looking up information about the target, the vulnerabilities that are on the target, or if they're trying to upload a file or download a file from a website. If they've done any type of research, they're going to want to clear out the browser history. </li>
				<li><strong class="bold">Delete cookies</strong>: There's also the issue of internal users not wanting the IT department <a id="_idIndexMarker929"/>or security professionals to know that they are looking up things about how to crack a hash on a Windows 7 box. They might also delete cookies. In the case of a website, cookies are designed to contain information about your preferences for that website. I'm always amazed that I have a lot of people that will come to me and say: "Can you help me clean up my computer?" and I'll be looking around only to notice their history and browser have been cleared out, but they forgot about the cookies. Well, it's all about the cookie. Cookies contain information about the sites they've visited, so this would be another entry that an attacker would want to delete. </li>
				<li><strong class="bold">Delete downloads</strong>: You will <a id="_idIndexMarker930"/>want to delete any downloads that may have been done on this machine. Maybe as an attacker, I've downloaded a payload file that I made available on a website somewhere or an FTP site, so I would want to delete those. </li>
				<li><strong class="bold">Delete passwords</strong>: I'd also <a id="_idIndexMarker931"/>want to clean out any password managers that may be on this machine. This would be more toward the aspect of an internal user who wants to make sure that nobody sees what their passwords are, but this would also possibly apply to an attacker. </li>
				<li><strong class="bold">Delete private data</strong>: They'll <a id="_idIndexMarker932"/>also want to delete any private data that may be on the machine. </li>
			</ul>
			<p>As an instructor, I go to different training centers, and most of them provide an instructor <a id="_idIndexMarker933"/>machine for me which I use while I'm teaching. While I'm using that machine, I may check my email, load up my Dropbox or my OneDrive, and on the very last day, I have a script I carry around with me now on a thumb drive I execute off. It goes through and clears out all that private data for me. You could say these would be some good guidelines to follow if you were ever in fear of somebody utilizing the same machine you've been using. </p>
			<h2 id="_idParaDest-219"><a id="_idTextAnchor223"/>Advanced methods</h2>
			<p>Advanced methods are what great hackers do. This is about clearing out the logs. There are certain files <a id="_idIndexMarker934"/>on the system tracking everything happening on a machine and recording it inside of a text file. Now, you must be careful how this is done if you're clearing out the logs—you don't want to raise a flag about your activity. It can raise an obvious flag something has been messed with and removed. In fact, you'll see an event ID 1102, which is a <em class="italic">log was cleared</em> error.</p>
			<p>The overall concept here with advanced methods is a great attacker is not going to just clear out the logs. They are going to use tools to help them do the following: </p>
			<ul>
				<li>Disable and turn off auditing so that the system is no longer looking at what they are doing. Simply open Command Prompt and use a built-in utility called Auditpol for audit policy. I want to set a category called Logon/logoff, and I'd like to change the success rate, so that any successful logins are disabled, as well as any failures.After disabling auditing, they then do their damage, try to hack the password, make modifications to files—whatever they need to do. </li>
				<li>Then, after they are done, they simply turn the auditing back on.</li>
			</ul>
			<p>We have now covered the necessary steps to leave a system that's been hacked and some of the best ways to leave while covering our tracks. </p>
			<h1 id="_idParaDest-220"><a id="_idTextAnchor224"/>Summary</h1>
			<p>In this chapter, we discussed the five phases of system hacking. In <em class="italic">Phase 1</em>, we covered how to gain access to the system. Once we understand the system and which services are running, we need to find out what the username and password are. We also discussed the various ways to crack passwords. <em class="italic">Phase 2</em> discussed escalating privileges. We can either escalate the privilege of an account we create or take an account that already exists. In <em class="italic">Phase 3</em>, we discussed how to maintain access by launching applications and tools that will allow you to continue your attack from inside the system and allow you to can get back in more easily. <em class="italic">Phase 4</em> discussed the various ways of hiding our tools. This allows us to hide information or anything we may want to use in our attack. <em class="italic">Phase 5</em> discussed covering our tracks and how we do that. It covered how to disable auditing, allowing you to accomplish the purposes of your hacking, and then how to enable auditing and get back out of the system undetected. </p>
			<p>There are plenty of advantages to learning how to hack a system. You will be able to discover holes in your security, and if you know how to hack, you'll know how to better set up and protect yourself from other hackers, and you'll know the main issues involved in keeping your systems safe.</p>
			<p>Next up, we get to hack humans, or what is called social engineering.</p>
			<h1 id="_idParaDest-221"><a id="_idTextAnchor225"/>Questions</h1>
			<p>As we conclude, here is a list of questions for you to test your knowledge regarding this chapter's material. You will find the answers in the <em class="italic">Assessments</em> section of the <em class="italic">Appendix</em>:</p>
			<ol>
				<li value="1">Which filesystems are supported by <strong class="bold">Alternate Data Streams</strong> (<strong class="bold">ADSes</strong>)?<ol><li>VHD</li><li>FAT32</li><li>NTFS</li><li>CDFS</li></ol></li>
				<li>What utility can be used to stop the auditing or logging of events?<ol><li>Auditpol</li><li>ADS</li><li>Regedit</li><li>NTFS</li></ol></li>
				<li>An attacker adding higher privileges to their account (adding themselves to the administrators group) is called what?<ol><li>Trinity slide</li><li>Vertical escalation</li><li>Sideloading</li><li>Pass the hash</li></ol></li>
				<li>Clark brings in a new keyboard to work and gives it to Lois; soon after, Lois's credentials are being used on other systems. What do you suspect is the cause?<ol><li>A keylogger</li><li>Malware</li><li>MFA attacks</li><li>Ransomware</li></ol></li>
			</ol>
		</div>
	</div></body></html>