<html><head></head><body>
		<div id="_idContainer023">
			<h1 id="_idParaDest-81" class="chapter-number"><a id="_idTextAnchor080"/>5</h1>
			<h1 id="_idParaDest-82"><a id="_idTextAnchor081"/>Pentesting AWS Features through Serverless Applications and Tools</h1>
			<p>You’ve been a very patient reader so far. Understanding concepts and theory is important before you start learning how to conduct the practical aspect of pentesting. You’ve now reached the first chapter of the book where we’ll not just be theorizing but also putting our knowledge <span class="No-Break">into action.</span></p>
			<p>This chapter features step-by-step guides to using the <strong class="bold">Amazon Web Services</strong> (<strong class="bold">AWS</strong>) first-party security tools to check security configurations and conduct vulnerability assessments to configure the most popular third-party AWS pentesting tools. We will also discuss the pentesting steps to find credentials, enumerate AWS services, conduct vulnerability scans, and discover exposed services with Prowler <span class="No-Break">and Pacu.</span></p>
			<p>This chapter comprises the following <span class="No-Break">main topics:</span></p>
			<ul>
				<li>How to get an <span class="No-Break">AWS network</span></li>
				<li>Using AWS PowerShell and the <span class="No-Break">AWS CLI</span></li>
				<li>Exploring AWS native <span class="No-Break">security tools</span></li>
				<li>Installing and preparing AWS <span class="No-Break">pentesting tools</span></li>
				<li>Exploiting <span class="No-Break">AWS applications</span></li>
			</ul>
			<p>Let’s <span class="No-Break">get started!</span></p>
			<h1 id="_idParaDest-83"><a id="_idTextAnchor082"/>Technical requirements</h1>
			<p>We will be working with Microsoft’s infrastructure. Massive Azure data centers will be doing the bulk of the computer processing work for the exercises in this chapter, so, fortunately, you don’t need to have a top-of-the-line workstation. You will need <span class="No-Break">the following:</span></p>
			<ul>
				<li>A <span class="No-Break">web browser</span></li>
				<li>A desktop or <span class="No-Break">laptop PC</span></li>
				<li>An Android or <span class="No-Break">iPhone smartphone</span></li>
				<li>A good reliable <span class="No-Break">internet connection</span></li>
			</ul>
			<p>Check out the following video to view the Code in <span class="No-Break">Action: </span><a href="https://bit.ly/3Qo5Ewg"><span class="No-Break">https://bit.ly/3Qo5Ewg</span></a></p>
			<h1 id="_idParaDest-84"><a id="_idTextAnchor083"/>How to get an AWS network</h1>
			<p>Before we prepare to pentest AWS<a id="_idIndexMarker358"/> services, we need AWS services to pentest! There are two things you <span class="No-Break">could do:</span></p>
			<ul>
				<li>You can acquire AWS credentials from the organization you <span class="No-Break">work for</span></li>
				<li>Or if you’re just learning and you’re not working for an organization yet, you can set up your own AWS instance free <span class="No-Break">of charge</span></li>
			</ul>
			<p>Amazon allows people to do a lot of things on its infrastructure through free services and <span class="No-Break">free trials.</span></p>
			<p>Keep in mind that whether you’re using your organization’s paid AWS instance or your own free AWS instance, the same AWS pentesting policies apply. Refer to <em class="italic">Chapters 2 </em>and <em class="italic">3</em> for more details. You may also review AWS’s pentesting policies <span class="No-Break">here: </span><a href="https://github.com/prowler-cloud/prowler"><span class="No-Break">https://github.com/prowler-cloud/prowler</span></a><span class="No-Break">.</span></p>
			<p>If you need to set up a free AWS instance, I’ll walk you through the setup process. Follow <span class="No-Break">these steps:</span></p>
			<ol>
				<li>Visit <a href="https://aws.amazon.com/">https://aws.amazon.com/</a> in your <span class="No-Break">web browser.</span></li>
				<li>Click on the orange button on the upper-right side of the web page that says <strong class="bold">Create an </strong><span class="No-Break"><strong class="bold">AWS Account</strong></span><span class="No-Break">.</span></li>
				<li>Under <strong class="bold">Root user email address</strong>, enter an email address that you have reliable access to. I would recommend that you use your main personal email account so that you can keep your AWS account even if you <span class="No-Break">switch employers.</span></li>
				<li>Under <strong class="bold">AWS account name</strong>, enter a unique name that’s memorable to you. Make sure it’s not something you’d be embarrassed to show a company you’re working for. Also, make sure your account name doesn’t reveal any of your passwords or other sensitive data. Don’t put your social security number <span class="No-Break">in there!</span></li>
				<li>You’ll be sent a verification code to the email address you used. Check your email to retrieve the verification code, input it into the form field, and click <strong class="bold">Verify</strong>. Be quick—it expires in <span class="No-Break">10 minutes!</span></li>
				<li>Create a new password<a id="_idIndexMarker359"/> and enter it in both form fields for verification. Your password should be long and complex. I would recommend using a password manager to generate a secure password and remember it <span class="No-Break">for you.</span></li>
				<li>Under <strong class="bold">How do you plan to use AWS?</strong>, select <strong class="bold">Personal</strong>. Enter your full name, phone number, and mailing address in the rest of the form. Make sure that the phone number is connected<a id="_idIndexMarker360"/> to a smartphone that belongs to you, in case you need to use it for <strong class="bold">multi-factor authentication</strong> (<strong class="bold">MFA</strong>). Check the <strong class="bold">I have read and agree to the terms of the AWS Customer Agreement</strong> box and click <span class="No-Break">on </span><span class="No-Break"><strong class="bold">Continue</strong></span><span class="No-Break">.</span></li>
				<li>You will be asked to enter your credit card number. AWS will warn you if you try to do something that will result in a credit card charge, and you can always verify whether or not you’ve been charged for something in the billing section of <span class="No-Break">your account.</span></li>
			</ol>
			<p class="callout-heading">Note</p>
			<p class="callout">None of the tutorials in this chapter will result in a credit card charge, but some of the services I will demonstrate in this chapter (such as Amazon Inspector) have a limited free trial. Be sure to cancel<a id="_idIndexMarker361"/> your AWS account before your free trials expire if you don’t want to be billed. See the <em class="italic">AWS Free Tier</em> guide for more <span class="No-Break">details (</span><a href="https://aws.amazon.com/free/"><span class="No-Break">https://aws.amazon.com/free/</span></a><span class="No-Break">).</span></p>
			<p>Once you’ve set up your AWS account<a id="_idIndexMarker362"/> or have acquired access to your organization’s AWS account, you’re ready to move on with the rest of <span class="No-Break">this chapter.</span></p>
			<h1 id="_idParaDest-85"><a id="_idTextAnchor084"/>Using AWS PowerShell and the AWS CLI</h1>
			<p>A lot of the exercises<a id="_idIndexMarker363"/> in this chapter can be executed directly from AWS CloudShell. As long<a id="_idIndexMarker364"/> as you have a Windows, Linux, or Mac computer with internet access and a web browser, AWS CloudShell is easy to access. Your computer doesn’t need to have a workstation or gaming PC hardware specifications, because all the virtualization and computation are conducted on Amazon’s infrastructure. But I would definitely recommend that you use some sort of desktop or laptop computer, and not a phone or tablet. AWS CloudShell’s UI works best with a <span class="No-Break">physical keyboard.</span></p>
			<p>When you’re logged in to your AWS account in your web browser, you can access AWS CloudShell at any time by clicking on an icon at the top of your screen. The AWS CloudShell icon looks like a small square with a <span class="No-Break">command prompt:</span></p>
			<div>
				<div id="_idContainer015" class="IMG---Figure">
					<img src="image/B18672_05_01.jpg" alt="Figure 5.1 – AWS CloudShell icon"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 5.1 – AWS CloudShell icon</p>
			<p>If you would prefer to access the AWS CLI without AWS CloudShell, you can install the <strong class="source-inline">aws-shell</strong> application from GitHub (<a href="https://github.com/awslabs/aws-shell">https://github.com/awslabs/aws-shell</a>). It requires the <strong class="bold">Bourne Again Shell</strong> (<strong class="bold">Bash</strong>) command line, so<a id="_idIndexMarker365"/> a Linux OS or macOS <span class="No-Break">works best.</span></p>
			<p class="callout-heading">Note</p>
			<p class="callout">All demonstrations in this book<a id="_idIndexMarker366"/> use CloudShell. But if you’d prefer to install the AWS CLI desktop application, you can find it <span class="No-Break">here: </span><a href="https://aws.amazon.com/cli/"><span class="No-Break">https://aws.amazon.com/cli/</span></a><span class="No-Break">.</span></p>
			<p>Here’s a handy guide to commands you can use at the AWS CloudShell command prompt. These commands will also work directly in the AWS <span class="No-Break">CLI application.</span></p>
			<p>Whether you’re in AWS CloudShell or the AWS CLI application, you should always check which command line you have installed first with <span class="No-Break">this command:</span></p>
			<pre class="console">
aws –-version</pre>			<p>The command line will display information about your OS (in AWS, not on your own computer), the version of Python that’s installed, and so on. The output will look something like this, but it may say something different depending on what you <span class="No-Break">have installed:</span></p>
			<pre class="source-code">
aws-cli/2.10.0 Python/3.11.2 Linux/4.14.133-113.105.amzn2.x86_64 botocore/1.13</pre>			<p>If you have a version of Linux or Mac installed, you can use Bash<a id="_idIndexMarker367"/> commands. The particular Bash commands I mention here also work in <strong class="bold">Z Shell</strong> (<strong class="bold">Zsh</strong>), which is the default for Mac. If you have Windows installed in AWS, you can use Windows PowerShell Command Prompt commands. Bash, Zsh, and Windows PowerShell support is all built into AWS CloudShell <a id="_idIndexMarker368"/>and the separate AWS CLI<a id="_idIndexMarker369"/> application. You don’t need to install anything extra in order to use any of <span class="No-Break">these commands.</span></p>
			<h2 id="_idParaDest-86"><a id="_idTextAnchor085"/>Bash commands</h2>
			<p>Here are some handy<a id="_idIndexMarker370"/> Bash (and <span class="No-Break">Zsh) commands:</span></p>
			<ul>
				<li>This will list all of the files and folders in your <span class="No-Break">current directory:</span><ul><li><span class="No-Break"><strong class="source-inline">ls</strong></span></li></ul></li>
				<li>This will change which directory you have open. Don’t use the brackets! Enter the path of the directory in <span class="No-Break">that space:</span><ul><li><strong class="source-inline">cd &lt;insert directory </strong><span class="No-Break"><strong class="source-inline">name here&gt;</strong></span></li></ul></li>
				<li>This will show which directory you’re in, in case you <span class="No-Break">get lost:</span><ul><li><span class="No-Break"><strong class="source-inline">pwd</strong></span></li></ul></li>
				<li>If you’re unsure of what a command does, this will tell you. Don’t use <span class="No-Break">the brackets!</span><ul><li><strong class="source-inline">man &lt;</strong><span class="No-Break"><strong class="source-inline">command name&gt;</strong></span></li></ul></li>
				<li>This handy command will get you out of a shell script you’ve executed, an SSH session, or will exit you out of AWS PowerShell or the <span class="No-Break">AWS CLI:</span><ul><li><span class="No-Break"><strong class="source-inline">exit</strong></span></li></ul></li>
				<li>Get information about whichever<a id="_idIndexMarker371"/> processes<a id="_idIndexMarker372"/> are running, complete with their <strong class="bold">process </strong><span class="No-Break"><strong class="bold">IDs</strong></span><span class="No-Break"> (</span><span class="No-Break"><strong class="bold">PIDs</strong></span><span class="No-Break">):</span><ul><li><span class="No-Break"><strong class="source-inline">ps</strong></span></li></ul></li>
				<li>If there’s a process you’d like to stop and you know its PID, use <span class="No-Break">this command:</span><ul><li><strong class="source-inline">kill &lt;</strong><span class="No-Break"><strong class="source-inline">process ID&gt;</strong></span></li></ul></li>
				<li>If you forget which commands you’ve used during your session, this command will <span class="No-Break">show you:</span><ul><li><span class="No-Break"><strong class="source-inline">history</strong></span></li></ul></li>
				<li>Move or rename <span class="No-Break">a directory:</span><ul><li><strong class="source-inline">mv &lt;current directory name&gt; &lt;new </strong><span class="No-Break"><strong class="source-inline">directory name&gt;</strong></span></li></ul></li>
				<li>Make a <span class="No-Break">new directory:</span><ul><li><strong class="source-inline">mkdir &lt;new </strong><span class="No-Break"><strong class="source-inline">directory name&gt;</strong></span></li></ul></li>
				<li>Create a new file with a <span class="No-Break">new filename:</span><ul><li><strong class="source-inline">touch &lt;</strong><span class="No-Break"><strong class="source-inline">new filename&gt;</strong></span></li></ul></li>
				<li>Read the contents of a file. This will only work for text files and scripts, not for things without text such as <span class="No-Break">media files:</span><ul><li><span class="No-Break"><strong class="source-inline">less &lt;filename&gt;</strong></span></li></ul></li>
				<li>Type <strong class="source-inline">sudo</strong> before your command if you need to do something that requires root permissions. You may need to enter your <span class="No-Break">password afterward:</span><ul><li><span class="No-Break"><strong class="source-inline">sudo &lt;command&gt;</strong></span></li></ul></li>
				<li>Use these commands to install programs that are in one of your repositories, or a Python program<a id="_idIndexMarker373"/> with the <strong class="source-inline">pip</strong> <span class="No-Break">package installer:</span><ul><li><strong class="source-inline">sudo install &lt;program name </strong><span class="No-Break"><strong class="source-inline">in repository&gt;</strong></span></li><li><strong class="source-inline">sudo pip3 install &lt;</strong><span class="No-Break"><strong class="source-inline">program name&gt;</strong></span></li><li><strong class="source-inline">sudo &lt;name of package manager here, such as apt or yum&gt; install &lt;</strong><span class="No-Break"><strong class="source-inline">program name&gt;</strong></span></li></ul></li>
			</ul>
			<p>Let’s look at a few PowerShell <span class="No-Break">commands next.</span></p>
			<h2 id="_idParaDest-87"><a id="_idTextAnchor086"/>PowerShell commands</h2>
			<p>If your AWS server<a id="_idIndexMarker374"/> is running Windows, here are some handy Windows PowerShell commands you can use. As long as your AWS instance is running Windows, these commands will work both in AWS PowerShell and the AWS <span class="No-Break">CLI application:</span></p>
			<ul>
				<li>This is probably the most important Windows command to remember. It’ll show you a list of other commands you can use and what <span class="No-Break">they do:</span><ul><li><span class="No-Break"><strong class="source-inline">help</strong></span></li></ul></li>
				<li>Just as in Bash (and Zsh), this will change the directory you <span class="No-Break">have open:</span><ul><li><strong class="source-inline">cd &lt;</strong><span class="No-Break"><strong class="source-inline">directory name&gt;</strong></span></li></ul></li>
				<li>The command for making a new directory in PowerShell is the same as in Bash <span class="No-Break">and Zsh:</span><ul><li><strong class="source-inline">mkdir &lt;new </strong><span class="No-Break"><strong class="source-inline">directory name&gt;</strong></span></li></ul></li>
				<li>This command moves a file to a <span class="No-Break">new destination:</span><ul><li><strong class="source-inline">move &lt;file or directory&gt; &lt;</strong><span class="No-Break"><strong class="source-inline">destination directory&gt;</strong></span></li></ul></li>
				<li>This command changes which directory you <span class="No-Break">have open:</span><ul><li><span class="No-Break"><strong class="source-inline">chdir &lt;directory&gt;</strong></span></li></ul></li>
				<li>See which processes are running and <span class="No-Break">their PIDs:</span><ul><li><span class="No-Break"><strong class="source-inline">ps</strong></span></li></ul></li>
				<li>Get information about your currently <span class="No-Break">open directory:</span><ul><li><span class="No-Break"><strong class="source-inline">pwd</strong></span></li></ul></li>
				<li>Remove a file <span class="No-Break">or directory:</span><ul><li><span class="No-Break"><strong class="source-inline">rm &lt;filename&gt;</strong></span></li><li><strong class="source-inline">rmdir &lt;</strong><span class="No-Break"><strong class="source-inline">directory name&gt;</strong></span></li></ul></li>
				<li>Displays some of the contents<a id="_idIndexMarker375"/> of a file. This works best with text files or files that <span class="No-Break">are scripts:</span><ul><li><span class="No-Break"><strong class="source-inline">cat &lt;filename&gt;</strong></span></li></ul></li>
				<li>Create a new file <span class="No-Break">or directory:</span><ul><li><strong class="source-inline">ni &lt;new filename or new </strong><span class="No-Break"><strong class="source-inline">directory name&gt;</strong></span></li></ul><p class="list-inset">If you create <a id="_idIndexMarker376"/>a new file, the file may have no contents. However, you can then open the file in a text editor or <strong class="bold">integrated development environment</strong> (<strong class="bold">IDE</strong>) and create contents in <span class="No-Break">the file.</span></p></li>
			</ul>
			<p>Now that we have looked<a id="_idIndexMarker377"/> into AWS and the AWS CLI, it is time to learn about the tools AWS provides us to help us <span class="No-Break">with cybersecurity.</span></p>
			<h1 id="_idParaDest-88"><a id="_idTextAnchor087"/>Exploring AWS-native security tools</h1>
			<p>AWS provides<a id="_idIndexMarker378"/> you with two native tools that will be especially useful to you as a pentester: AWS Security Hub and <span class="No-Break">Amazon Inspector.</span></p>
			<p>First, let’s take a look at AWS <span class="No-Break">Security Hub.</span></p>
			<h2 id="_idParaDest-89"><a id="_idTextAnchor088"/>AWS Security Hub</h2>
			<p>AWS Security Hub<a id="_idIndexMarker379"/> is an easy way to view all of your AWS security configurations, AWS-native security scan reports, and security alerts. It can combine data from Amazon GuardDuty, Amazon Inspector, Amazon Macie, and AWS <span class="No-Break">Network Firewall.</span></p>
			<p>If there are any major security problems in your AWS instance, AWS Security Hub will notify you! You can mention data you find in AWS Security Hub in your pentest report. But by conducting vulnerability scans and pentests with third-party applications, you may be able to find additional vulnerabilities. I recommend using both the tools AWS provides and third-party tools to get the most thorough data about the security posture of your <span class="No-Break">AWS instance.</span></p>
			<p>Let’s take a look at AWS Security Hub for the first time. Follow <span class="No-Break">these steps:</span></p>
			<ol>
				<li>Once you’ve logged in to your AWS account from your web browser, you can find AWS Security Hub by searching for <strong class="source-inline">AWS Security Hub</strong> in the search bar at the top. It’s to the left of the icon that you use to launch AWS CloudShell. If you have a Free Tier AWS account, you can sign up for a 30-day free trial. Alternatively, you can find AWS Security Hub under the <span class="No-Break"><strong class="bold">Services</strong></span><span class="No-Break"> tab.</span></li>
			</ol>
			<p class="callout-heading">Warning!</p>
			<p class="callout">Be careful to go to your billing to cancel AWS Security Hub before your free trial expires if this is your own free AWS account for <span class="No-Break">educational purposes.</span></p>
			<ol>
				<li value="2">On the right, click on <strong class="bold">Go to Security Hub</strong>. If you’re setting it up for the first time, you will need to select <strong class="bold">Enable AWS Config</strong>. Next, where it says <strong class="bold">You can enable resource recording manually from the AWS Config console</strong>, click on the <strong class="bold">AWS Config </strong><span class="No-Break"><strong class="bold">console</strong></span><span class="No-Break"> link.</span></li>
				<li>Then, you’ll be taken to a page<a id="_idIndexMarker380"/> for AWS Config. On the right-hand side, click on <span class="No-Break"><strong class="bold">1-click setup</strong></span><span class="No-Break">:</span></li>
			</ol>
			<div>
				<div id="_idContainer016" class="IMG---Figure">
					<img src="image/B18672_05_02.jpg" alt="Figure 5.2 – The 1-click setup option"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 5.2 – The 1-click setup option</p>
			<p class="list-inset">Review the default settings, and then click on the orange <strong class="bold">Confirm</strong> button on the lower-right side. An <strong class="bold">Amazon Simple Storage Service</strong> (<strong class="bold">S3</strong>) bucket will be created for you. This may<a id="_idIndexMarker381"/> take a <span class="No-Break">few moments.</span></p>
			<ol>
				<li value="4">When the bucket has been created, you will be taken to the main <strong class="bold">AWS Security Hub</strong> dashboard. For now, we can leave all the defaults as they are. Go to your web browser tab that says <strong class="bold">Enable AWS </strong><span class="No-Break"><strong class="bold">Security Hub</strong></span><span class="No-Break">.</span></li>
				<li>Under the <strong class="bold">Security standards</strong> heading, leave the <span class="No-Break">defaults selected:</span><ul><li><strong class="bold">Enable AWS Foundational Security Best </strong><span class="No-Break"><strong class="bold">Practices v1.0.0</strong></span></li><li><strong class="bold">Enable CIS AWS Foundations </strong><span class="No-Break"><strong class="bold">Benchmark v1.2.0</strong></span></li></ul></li>
			</ol>
			<div>
				<div id="_idContainer017" class="IMG---Figure">
					<img src="image/B18672_05_03.jpg" alt="Figure 5.3 – AWS Security Hub setup screen"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 5.3 – AWS Security Hub setup screen</p>
			<ol>
				<li value="6">If this was the AWS network<a id="_idIndexMarker382"/> for the company you’re working for, they may have their own security benchmarks they need to be compliant with. But if you’re just using a free AWS account to learn for yourself, you can just leave the default benchmarks as they are. For that reason, also leave <strong class="bold">AWS Integrations</strong> and <strong class="bold">Delegated Administrator</strong> (the default is no integrations and no additional delegated administrator) as they are. Click on the orange button that says <strong class="bold">Enable </strong><span class="No-Break"><strong class="bold">Security Hub</strong></span><span class="No-Break">.</span></li>
				<li>Now, you should see the <strong class="bold">AWS Security </strong><span class="No-Break"><strong class="bold">Hub</strong></span><span class="No-Break"> dashboard.</span></li>
			</ol>
			<div>
				<div id="_idContainer018" class="IMG---Figure">
					<img src="image/B18672_05_04.jpg" alt="Figure 5.4 – AWS Security Hub dashboard"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 5.4 – AWS Security Hub dashboard</p>
			<p class="list-inset">You should be on the <strong class="bold">Summary</strong> page now. No scans have been run so far, so all the possible information sources such as <strong class="bold">Findings</strong> and <strong class="bold">Insights</strong> will have no data <span class="No-Break">to display.</span></p>
			<ol>
				<li value="8">But I did see something<a id="_idIndexMarker383"/> interesting. Go to the left menu and click <span class="No-Break">on </span><span class="No-Break"><strong class="bold">Findings</strong></span><span class="No-Break">.</span><p class="list-inset">It appears that when I enabled AWS Config, the system already performed a number of security checks! There were about a dozen failed checks, with severity ratings ranked <strong class="source-inline">LOW</strong>, <strong class="source-inline">MEDIUM</strong>, and <strong class="source-inline">CRITICAL</strong>. Here’s an example of a failed security check. Your results will probably <span class="No-Break">be different:</span></p><pre class="source-code">
MEDIUM    NEW    ACTIVE    us-east-2    489********(my account ID)    AWS Security Hub    Network ACLs should not allow ingress from 0.0.0.0/0 to port 22 or port 3389</pre></li>				<li>Now, click on <strong class="bold">Security standards</strong> in the <span class="No-Break">left menu.</span></li>
				<li>I found a box for <strong class="bold">AWS Foundational Security Best Practices v1.0.0</strong>. I clicked on <strong class="bold">View results</strong>. There were lots of failed checks there. Here’s an example <span class="No-Break">of one:</span><pre class="source-code">
CRITICAL    CodeBuild.1    CodeBuild GitHub or Bitbucket source repository URLs should use OAuth</pre></li>			</ol>
			<p>So, AWS Security Hub will give you a lot of very useful vulnerability information from the get-go. You can definitely mention these details in your pentest report, but I would recommend also running some third-party tools, as I’ll describe later in this chapter. Multiple tools can find more vulnerabilities, and if more than one tool finds the same vulnerability, that’s useful information too. Remember—your pentest report shouldn’t just be an output from logs. You will describe in your own words how these vulnerabilities impact your organization<a id="_idIndexMarker384"/> and your advice for <span class="No-Break">remediating them.</span></p>
			<p>Now, let’s move on to <span class="No-Break">Amazon Inspector.</span></p>
			<h2 id="_idParaDest-90"><a id="_idTextAnchor089"/>Amazon Inspector</h2>
			<p>Amazon Inspector<a id="_idIndexMarker385"/> is the built-in vulnerability scanner in AWS. It does a pretty good job of scanning your AWS applications for known vulnerabilities. It can also find the parts of your AWS network that are insecurely exposed to the public internet. I recommend running scans with Amazon Inspector before you conduct scans with <span class="No-Break">third-party applications.</span></p>
			<p>I’ll show you how to use Amazon Inspector, step <span class="No-Break">by step:</span></p>
			<ol>
				<li>I found Amazon Inspector<a id="_idIndexMarker386"/> by searching for <strong class="source-inline">Inspector</strong> in the top search bar. If you don’t have Amazon Inspector set up yet, a white box on the top right will say <strong class="bold">Get started with Inspector</strong> and offer you a 15-day trial. Click on the orange <strong class="bold">Get Started</strong> button. But if you’re just playing around in your free AWS account, then please remember to cancel Amazon Inspector before the 15-day period <span class="No-Break">is over.</span></li>
				<li>If you’re just trying things out in your free account, then you can leave <strong class="bold">Delegated administrator</strong> and <strong class="bold">Service permissions</strong> as they are. Click on the <strong class="bold">Activate Inspector</strong> button on the bottom right. The activation may take a <span class="No-Break">few moments.</span></li>
				<li>Upon activation, you<a id="_idIndexMarker387"/> will see a screen that says <strong class="bold">Summary</strong> at the<a id="_idIndexMarker388"/> top. If you click on the <strong class="bold">Manage all accounts</strong> button in the top-right corner, you can get Amazon Inspector working in your <strong class="bold">Amazon Elastic Compute Cloud</strong> (<strong class="bold">Amazon EC2</strong>), <strong class="bold">Amazon Elastic Container Registry</strong> (<strong class="bold">Amazon ECR</strong>), and AWS Lambda <span class="No-Break">instances too.</span></li>
				<li>A green notification<a id="_idIndexMarker389"/> at the top says <strong class="bold">Welcome to Inspector. Your first scan is underway.</strong> So, we’ll wait for the automatic scan to complete, then look at the results. My first scan took about half <span class="No-Break">an hour.</span><p class="list-inset">If you get impatient while waiting, there’s something fun you can do. Look at the menu on the left side. Click on <strong class="bold">Video tutorials</strong>. There’s a page with a bunch of embedded YouTube videos, such as <strong class="bold">Introduction to the New Amazon Inspector</strong> and <strong class="bold">Amazon Inspector for AWS Lambda workloads</strong>. I would recommend watching all of them! The information you’ll learn will help you use Amazon Inspector more effectively as <span class="No-Break">a pentester.</span></p></li>
				<li>When your scan is done, click on <strong class="bold">Findings</strong> in the left menu. You can sort your findings<a id="_idIndexMarker390"/> by vulnerability, by account, by instance, and so on by clicking the tabs at the top. Each finding will show its <strong class="bold">Common Vulnerability Scoring System</strong> (<strong class="bold">CVSS</strong>) severity rating such as <strong class="bold">CRITICAL</strong>, <strong class="bold">HIGH</strong>, or <strong class="bold">MEDIUM</strong>. <strong class="bold">Common Vulnerabilities and Exposures</strong> (<strong class="bold">CVE</strong>) numbers for each finding are also shown, and you<a id="_idIndexMarker391"/> can click on each CVE database link to read more <span class="No-Break">about it.</span></li>
			</ol>
			<p>As you can see, Amazon Inspector is a really useful tool for pentesting AWS. I really appreciate the CVE data that Inspector shows. It’s very useful details to put in a <span class="No-Break">pentest report.</span></p>
			<p>Now, let’s move on to some third-party<a id="_idIndexMarker392"/> tools. I recommend that you use a variety of tools in your pentests and red team engagements for the sake of being thorough. In these situations, using more tools is generally better because you can get even <span class="No-Break">more information.</span></p>
			<h1 id="_idParaDest-91"><a id="_idTextAnchor090"/>Installing and preparing AWS pentesting tools</h1>
			<p>Let’s install and prepare<a id="_idIndexMarker393"/> the third-party software<a id="_idIndexMarker394"/> we’ll be using in the <span class="No-Break">next section.</span></p>
			<p class="callout-heading">Important note</p>
			<p class="callout">If you encounter problems with disk space while installing any of these tools, you may have to delete old files to make space. Files can be deleted with the Bash commands earlier in this chapter. You also may have to deploy<a id="_idIndexMarker395"/> a new AWS EC2 instance. See the official AWS documentation for more <span class="No-Break">information: </span><a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/EC2_GetStarted.html"><span class="No-Break">https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/EC2_GetStarted.html</span></a><span class="No-Break">.</span></p>
			<p>As much as possible, I will be using<a id="_idIndexMarker396"/> AWS CloudShell to <span class="No-Break">install </span><span class="No-Break"><a id="_idIndexMarker397"/></span><span class="No-Break">applications.</span></p>
			<p>First, let’s start <span class="No-Break">with Prowler.</span></p>
			<h2 id="_idParaDest-92"><a id="_idTextAnchor091"/>Prowler</h2>
			<p>Prowler<a id="_idIndexMarker398"/> is a vulnerability<a id="_idIndexMarker399"/> scanner for cloud platforms. Prowler can scan AWS for vulnerabilities and security misconfigurations based on the <strong class="bold">Center for Internet Security</strong> (<strong class="bold">CIS</strong>), <strong class="bold">National Institute of Standards and Technology</strong> (<strong class="bold">NIST</strong>) 800, NIST <strong class="bold">Cybersecurity Framework</strong> (<strong class="bold">CSF</strong>), the <strong class="bold">Cybersecurity and Infrastructure Security Agency</strong> (<strong class="bold">CISA</strong>), the <strong class="bold">Federal Risk and Authorization Management</strong> (<strong class="bold">FedRAMP</strong>), the <strong class="bold">Payment Card Industry Data Security Standard</strong> (<strong class="bold">PCI-DSS</strong>), the <strong class="bold">General Data Protection Regulation</strong> (<strong class="bold">GDPR</strong>), the <strong class="bold">Health Insurance Portability and Accountability Act</strong> (<strong class="bold">HIPAA</strong>), and other <span class="No-Break">security standards.</span></p>
			<p>Open AWS CloudShell by logging in to your AWS account in a web browser (a small square icon with a <span class="No-Break">command prompt).</span></p>
			<p>Before we install Prowler, you may have to update the version of Python in AWS CloudShell to Python 3.9. You can update Python with the commands <span class="No-Break">shown next.</span></p>
			<p>First, check which version of Python you <span class="No-Break">already have:</span></p>
			<pre class="console">
python --version</pre>			<p>If it says Python 3.9, you’re good to go. Otherwise, <span class="No-Break">do this:</span></p>
			<pre class="console">
sudo apt update
sudo apt-get install python3.9</pre>			<p>Once the installation process is done, you can verify that it works with <span class="No-Break">this command:</span></p>
			<pre class="console">
python --version</pre>			<p>Here are the commands <span class="No-Break">to enter:</span></p>
			<ul>
				<li>This uses the <strong class="source-inline">yum</strong> installer to install some Prowler dependencies. You may be asked to enter your AWS <span class="No-Break">account password:</span><pre class="source-code">
<strong class="bold">sudo yum -y install gcc openssl-devel bzip2-devel libffi-devel</strong></pre></li>				<li>This downloads the package for Python 3.9, a dependency for installing Prowler <span class="No-Break">from </span><span class="No-Break"><strong class="source-inline">pip</strong></span><span class="No-Break">:</span><pre class="source-code">
<strong class="bold">wget https://www.python.org/ftp/python/3.9.16/Python-3.9.16.tgz</strong></pre></li>				<li>This installs the Python<a id="_idIndexMarker400"/> package, configures it, and sets “enable<a id="_idIndexMarker401"/> optimizations.” Sometimes, a command may take a few minutes <span class="No-Break">to execute:</span></li>
			</ul>
			<p class="callout-heading">Note</p>
			<p class="callout">Be careful to make sure that <strong class="source-inline">--</strong> is entered as two hyphens with no space in between. Some web browsers might change <strong class="source-inline">--</strong> into one long <strong class="source-inline">–</strong>. That will cause <span class="No-Break">an error.</span></p>
			<pre class="source-code">
<strong class="bold">tar zxf Python-3.9.16.tgz</strong>
<strong class="bold">cd Python-3.9.16/</strong>
<strong class="bold">./configure --enable-optimizations</strong>
<strong class="bold">sudo make altinstall</strong>
<strong class="bold">python3.9 –-version</strong>
<strong class="bold">cd</strong></pre>			<p class="list-inset">Now, you’re back in your <span class="No-Break">home directory.</span></p>
			<ul>
				<li>This installs Prowler <span class="No-Break">from </span><span class="No-Break"><strong class="source-inline">pip</strong></span><span class="No-Break">:</span><pre class="source-code">
<strong class="bold">pip3.9 install prowler</strong>
<strong class="bold">prowler -v</strong></pre></li>			</ul>
			<p>Congratulations! Later on, when we actually use Prowler, you can find the output of your pentests and vulnerability assessments by clicking on <strong class="bold">Actions</strong> in the top-right corner of the AWS PowerShell screen. Then, go to <strong class="bold">Download File</strong> and open the CSV file. It will have a location and filename <span class="No-Break">like this:</span></p>
			<pre class="source-code">
/home/cloudshell-user/output/prowler-output-&lt;a bunch of numbers&gt;.csv</pre>			<p>If <strong class="bold">Actions</strong> | <strong class="bold">Download File</strong> doesn’t work, you may need to open AWS CloudShell in Google Chrome. If you don’t have Chrome, install it by visiting <a href="https://www.google.com/chrome/">https://www.google.com/chrome/</a>. Hopefully, you have your AWS root account email address and password recorded somewhere<a id="_idIndexMarker402"/> safe so that you can switch web<a id="_idIndexMarker403"/> browsers <span class="No-Break">when needed!</span></p>
			<p>Now, let’s <span class="No-Break">install Pacu.</span></p>
			<h2 id="_idParaDest-93"><a id="_idTextAnchor092"/>Pacu</h2>
			<p>Pacu is an AWS pentesting <a id="_idIndexMarker404"/>application. If you’ve already followed my instructions<a id="_idIndexMarker405"/> for installing Prowler, then you’ll already have Python installed. That’s great, as we can use <strong class="source-inline">pip</strong> to install Pacu, <span class="No-Break">like so:</span></p>
			<pre class="console">
pip3 install  pip</pre>			<p>This prepares the <span class="No-Break"><strong class="source-inline">pip</strong></span><span class="No-Break"> installer:</span></p>
			<pre class="console">
pip3 install  pacu</pre>			<p>This installs Pacu. Now, let’s <span class="No-Break">execute it!</span></p>
			<pre class="console">
Pacu</pre>			<h2 id="_idParaDest-94"><a id="_idTextAnchor093"/>Cred Scanner</h2>
			<p>Now, let’s install<a id="_idIndexMarker406"/> Cred Scanner. It’s a very simple script to scan the files in your AWS <a id="_idIndexMarker407"/>instance for sensitive credentials. You absolutely do not want passwords and the like to be exposed to cyber attackers! Follow the <span class="No-Break">next steps:</span></p>
			<ol>
				<li>First, open the Python script in your web browser from GitHub <span class="No-Break">here: </span><a href="https://github.com/disruptops/cred_scanner/blob/master/cred_scanner.py"><span class="No-Break">https://github.com/disruptops/cred_scanner/blob/master/cred_scanner.py</span></a><span class="No-Break">.</span></li>
				<li>Copy the entire Python script. Paste it into a text editor and make sure the file is saved <span class="No-Break">as </span><span class="No-Break"><strong class="source-inline">cred_scanner.py</strong></span><span class="No-Break">.</span></li>
				<li>Next, we need to upload the script from your local computer to your AWS server. Click on <strong class="bold">Actions</strong> in the top-right corner of your AWS CloudShell screen. Then, go to <strong class="bold">Upload file</strong>, click on <strong class="bold">Select file</strong>, navigate to where you saved <strong class="source-inline">cred_scanner.py</strong> on your local computer, and <span class="No-Break">open it.</span></li>
				<li>Go to <a href="https://github.com/disruptops/cred_scanner/blob/master/requirements.txt">https://github.com/disruptops/cred_scanner/blob/master/requirements.txt</a> and do just about the same. It’s just one line of code that says <strong class="source-inline">click</strong>. But you still need to save it as a file named <strong class="source-inline">requirements.txt</strong>. Then, upload the file in AWS CloudShell the same way you <span class="No-Break">uploaded </span><span class="No-Break"><strong class="source-inline">cred_scanner.py</strong></span><span class="No-Break">.</span></li>
				<li>Now, back to the command line! Make sure Cred Scanner has its requirements by entering <span class="No-Break">the following:</span><pre class="source-code">
<strong class="bold">pip install -r ./requirements.txt</strong></pre></li>				<li>Then, we can execute the <span class="No-Break">Python script:</span><pre class="source-code">
<strong class="bold">python cred_scanner.py</strong></pre><p class="list-inset">Let’s continue with Cred Scanner. Here’s what a scan can <span class="No-Break">look like:</span></p></li>			</ol>
			<div>
				<div id="_idContainer019" class="IMG---Figure">
					<img src="image/B18672_05_010.jpg" alt="Figure 5.5 – Cred Scanner scan output"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 5.5 – Cred Scanner scan output</p>
			<p>Alternatively, you can install Cred Scanner by cloning its GitHub repository. In order to clone a repository, follow the instructions in the GitHub <span class="No-Break">documentation: </span><a href="https://docs.github.com/en/repositories/creating-and-managing-repositories/cloning-a-repository"><span class="No-Break">https://docs.github.com/en/repositories/creating-and-managing-repositories/cloning-a-repository</span></a><span class="No-Break">.</span></p>
			<p>The code you need to clone can be <span class="No-Break">found here:</span></p>
			<p><a href="https://github.com/disruptops/cred_scanner"><span class="No-Break">https://github.com/disruptops/cred_scanner</span></a></p>
			<p>Then, run <span class="No-Break">this command:</span></p>
			<pre class="console">
pip install -r ./requirements.txt</pre>			<p>Using Cred Scanner<a id="_idIndexMarker408"/> is so simple that I’ll show you how to do a scan right<a id="_idIndexMarker409"/> now instead of explaining it in the <span class="No-Break">next section:</span></p>
			<ul>
				<li>This will display Cred <span class="No-Break">Scanner’s options:</span><pre class="source-code">
<strong class="bold">python cred_scanner.py –-help</strong></pre></li>				<li>This will show you secret keys in the directory you have open at the <span class="No-Break">command line:</span><pre class="source-code">
<strong class="bold">python cred_scanner.py –-secret</strong></pre></li>				<li>This will run Cred Scanner in <span class="No-Break">another directory:</span><pre class="source-code">
<strong class="bold">python cred_scanner.py –-path &lt;directory path&gt;</strong></pre></li>			</ul>
			<p>Alternatively, you can use<a id="_idIndexMarker410"/> the <strong class="source-inline">cd</strong> command to change to the directory<a id="_idIndexMarker411"/> you want to run Cred <span class="No-Break">Scanner in.</span></p>
			<h2 id="_idParaDest-95"><a id="_idTextAnchor094"/>CloudFrunt</h2>
			<p>CloudFrunt is a script developed<a id="_idIndexMarker412"/> by MindPoint Group<a id="_idIndexMarker413"/> for identifying misconfigurations in <span class="No-Break">AWS CloudFront.</span></p>
			<p>I’m going to show both installing and executing CloudFrunt here as well, due to its simplicity. Remember—you must have AWS CloudFront configured on your AWS server in order for CloudFrunt to <span class="No-Break">work properly.</span></p>
			<p>At the AWS CloudShell command line, download the <span class="No-Break">CloudFrunt script:</span></p>
			<pre class="console">
git clone --recursive https://github.com/MindPointGroup/cloudfrunt</pre>			<p>Here’s <span class="No-Break">the result:</span></p>
			<div>
				<div id="_idContainer020" class="IMG---Figure">
					<img src="image/B18672_05_011.jpg" alt="Figure 5.6 – CloudFrunt installation"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 5.6 – CloudFrunt installation</p>
			<p>Then, install it and <span class="No-Break">its dependencies:</span></p>
			<pre class="console">
pip install -r requirements.txt</pre>			<p>Now, assuming we have CloudFrunt installed, let’s give it <span class="No-Break">a go!</span></p>
			<p>Here’s the command structure for <span class="No-Break">using </span><span class="No-Break"><strong class="source-inline">cloudfrunt.py</strong></span><span class="No-Break">:</span></p>
			<pre class="console">
python cloudfrunt.py -o cloudfrunt.com.s3-website-us-east-1.amazonaws.com -i S3-cloudfrunt -l list.txt</pre>			<p>Don’t enter that exact command. You’ll need to modify it according<a id="_idIndexMarker414"/> to your situation. Anything in <strong class="source-inline">-&lt;letter&gt;</strong> is called <span class="No-Break">an argument.</span></p>
			<p>Replace <strong class="source-inline">cloudfrunt.com.s3-website-us-east-1.amazonaws.com</strong> with the domain<a id="_idIndexMarker415"/> that you’re scanning. Replace <strong class="source-inline">S3-cloudfrunt</strong> with the origin of the vulnerable domain<a id="_idIndexMarker416"/> that you’re adding. Replace <strong class="source-inline">list.txt</strong> with a text file of domains <span class="No-Break">to scan.</span></p>
			<p>This is how you display the guide to <span class="No-Break">using CloudFrunt:</span></p>
			<pre class="console">
python cloudfrunt.py –-help</pre>			<p>This is what it <span class="No-Break">will display:</span></p>
			<div>
				<div id="_idContainer021" class="IMG---Figure">
					<img src="image/B18672_05_012.jpg" alt="Figure 5.7 – CloudFrunt help screen"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 5.7 – CloudFrunt help screen</p>
			<p>Use this as your guide to executing CloudFrunt. If you use <strong class="source-inline">-s</strong> or <strong class="source-inline">--save</strong> when you execute CloudFrunt, you’ll be able to find your CloudFrunt scan results by clicking on <strong class="bold">Actions</strong> in the top-right corner of the AWS PowerShell screen. Then, go to <strong class="bold">Download File</strong> and open the text file. It will have a location<a id="_idIndexMarker417"/> and filename<a id="_idIndexMarker418"/> <span class="No-Break">like this:</span></p>
			<pre class="source-code">
/home/cloudshell-user/output/results.txt</pre>			<p>On to <span class="No-Break">Redboto next!</span></p>
			<h2 id="_idParaDest-96"><a id="_idTextAnchor095"/>Redboto</h2>
			<p>The last third-party<a id="_idIndexMarker419"/> tool I’ll walk you through installing is the Redboto Python<a id="_idIndexMarker420"/> script collection. The scripts perform red team operations against the AWS API. First, let’s install <span class="No-Break">its prerequisites:</span></p>
			<pre class="console">
pip install cryptography boto3 texttable</pre>			<p>Next, open its GitHub collection in another web <span class="No-Break">browser tab:</span></p>
			<p><a href="https://github.com/ihamburglar/Redboto"><span class="No-Break">https://github.com/ihamburglar/Redboto</span></a></p>
			<p>Redboto is a collection of scripts. Open each web page for each script you’d like to try. Remember how I walked you through copying scripts from GitHub, pasting the script into a text editor, saving it with its specific filename, and then uploading files with <strong class="bold">Actions</strong> | <strong class="bold">Upload file</strong> | <strong class="bold">Select file </strong>in the AWS CloudShell web UI? Do this with each of the Redboto scripts you’d like to use. The Redboto GitHub repository provides an explanation of what each script does. Then, in the directory you uploaded files to, you can execute each script <span class="No-Break">like this:</span></p>
			<pre class="console">
python checkAWSKey.py
python describeUserData.py
python runSSMShellScript.py
python &lt;insert a different Reboto Python script name here&gt;</pre>			<p>Afterward, you should be able to go to <strong class="bold">Actions</strong> | <strong class="bold">Download File</strong> from the AWS CloudShell UI and find output files in <span class="No-Break">this directory:</span></p>
			<pre class="source-code">
/home/cloudshell-user/output/</pre>			<p>Remember that directory well because if the tutorials I give you in this chapter are your labor, the contents of that directory are the fruits of your labor. But you won’t simply be giving your pentesting client the output in that directory. You will be using the output files as information you’ll deploy when you write your pentest report for your client. Being a good pentester isn’t simply a matter of executing scripts and sharing outputs and other logs. Your job is to interpret the logs and help your client and the defensive security team understand<a id="_idIndexMarker421"/> them and use the vulnerability information to security harden your client’s AWS networks<a id="_idIndexMarker422"/> <span class="No-Break">and applications.</span></p>
			<p>Alright! Now, it’s time to conduct some general pentesting and vulnerability scanning activities in Prowler <span class="No-Break">and Pacu.</span></p>
			<h1 id="_idParaDest-97"><a id="_idTextAnchor096"/>Exploiting AWS applications</h1>
			<p>Now that we’ve installed<a id="_idIndexMarker423"/> a number of pentesting applications and run some simple scripts, let’s get deeper into AWS exploitation with Prowler <span class="No-Break">and Pacu.</span></p>
			<h2 id="_idParaDest-98"><a id="_idTextAnchor097"/>Prowler</h2>
			<p>First, let’s conduct some<a id="_idIndexMarker424"/> pentesting and vulnerability scanning<a id="_idIndexMarker425"/> activities <span class="No-Break">in Prowler.</span></p>
			<p>Have your AWS credentials ready. You can verify them by logging in to your AWS account from your web<a id="_idIndexMarker426"/> browser. On the top menu bar, look at the far right drop-down menu with your username. Click on <strong class="bold">Security credentials</strong> to navigate to the correct AWS <strong class="bold">Identity and Access Management</strong> (<strong class="bold">IAM</strong>) page. At the top, it should say <strong class="bold">My security credentials (root user)</strong>. Make a note of your AWS account ID, access key ID, and secret access key. Then, follow <span class="No-Break">these steps:</span></p>
			<ol>
				<li>Now, let’s open AWS CloudShell again. Enter this command to configure <span class="No-Break">your key:</span><pre class="source-code">
<strong class="bold">aws configure</strong></pre></li>				<li>In the <strong class="source-inline">AWS_ACCESS_KEY_ID=</strong> field, paste the key ID you generated and hit <em class="italic">Enter</em>. Hit <em class="italic">Enter</em> for all the other fields too; we’ll be leaving <span class="No-Break">them blank.</span></li>
			</ol>
			<p class="callout-heading">Note</p>
			<p class="callout">If you want to save a 0.0003 USD charge to your account per AWS configure occurrence, you can configure AWS with <span class="No-Break">the following:</span></p>
			<p class="callout"><span class="No-Break"><strong class="source-inline">export AWS_ACCESS_KEY_ID=your_access_key_id</strong></span></p>
			<p class="callout"><span class="No-Break"><strong class="source-inline">export AWS_SECRET_ACCESS_KEY=your_secret_access_key)</strong></span></p>
			<ol>
				<li value="3"><span class="No-Break">Execute Prowler:</span><pre class="source-code">
<strong class="bold">prowler</strong></pre><p class="list-inset">If that doesn’t work, follow the instructions earlier in this chapter to install <span class="No-Break">Prowler again.</span></p><p class="list-inset">By default, the output of your Prowler scans should be somewhere around here, with a filename <span class="No-Break">like this:</span></p><pre class="source-code">/home/cloudshell-user/output/prowler-output-&lt;a bunch of 
numbers&gt;.csv</pre></li>			</ol>
			<p>The Prowler command<a id="_idIndexMarker427"/> on its own will execute a default scan that shows<a id="_idIndexMarker428"/> the AWS services that you have (such as EC2, IAM, and so on), whether the scan passed or failed, and the number of critical, high, medium, and low vulnerabilities each service has according to the CVSS score. It’ll run through dozens of checks, such as <strong class="source-inline">check121</strong>, <strong class="source-inline">check122</strong>, <strong class="source-inline">check23</strong>, and <strong class="source-inline">check24</strong>. It may print to the screen (and to your CSV logs) all kinds of information that’ll be useful in your pentest report, such as <span class="No-Break">the following:</span></p>
			<pre class="source-code">
[check25] Ensure AWS Config is enabled in all regions – configservice [Medium]
FAIL! au-north-1: AWS Config recorder disabled</pre>			<p>In this example, <strong class="source-inline">check25</strong> scanned all of your AWS services to see if they have AWS Config enabled. AWS Config on its own doesn’t guarantee security. But it needs to be enabled in order to securely configure it, kind of like how your car must have seatbelts installed. The seatbelts being there doesn’t guarantee that the driver and passengers will wear them, but they cannot wear their seatbelts if they aren’t there in the <span class="No-Break">first place.</span></p>
			<p class="callout-heading">Note</p>
			<p class="callout">You may encounter AWS secret<a id="_idIndexMarker429"/> access key issues. If so, visit <a href="https://console.aws.amazon.com/kms">https://console.aws.amazon.com/kms</a> for <strong class="bold">AWS Key Management Service</strong> (<strong class="bold">AWS KMS</strong>) and make a new key while making<a id="_idIndexMarker430"/> a note of your secret<a id="_idIndexMarker431"/> access key. You can also get troubleshooting<a id="_idIndexMarker432"/> help in the AWS documentation at <a href="https://docs.aws.amazon.com/kms/latest/developerguide/find-cmk-id-arn.html">https://docs.aws.amazon.com/kms/latest/developerguide/find-cmk-id-arn.html</a> <span class="No-Break">and </span><a href="https://docs.aws.amazon.com/kms/latest/developerguide/programming-keys.html"><span class="No-Break">https://docs.aws.amazon.com/kms/latest/developerguide/programming-keys.html</span></a><span class="No-Break">.</span></p>
			<p>If you want to get more<a id="_idIndexMarker433"/> refined, you can start by seeing which specific checks<a id="_idIndexMarker434"/> or services you can execute from Prowler with one of <span class="No-Break">these commands:</span></p>
			<pre class="console">
prowler --list-checks
prowler –-list-services</pre>			<p>When you find checks you’d like to execute, you can use <span class="No-Break">this syntax:</span></p>
			<pre class="console">
prowler -c check11,check12</pre>			<p>Of course, replace <strong class="source-inline">check11</strong> and <strong class="source-inline">check12</strong> with the checks that you’d like <span class="No-Break">to execute.</span></p>
			<p>You can also run all of the checks <em class="italic">except</em> for some of them, <span class="No-Break">like this:</span></p>
			<pre class="console">
./prowler -E check32,check33</pre>			<p>That will run all of the checks <em class="italic">except</em> for <strong class="source-inline">check32</strong> <span class="No-Break">and </span><span class="No-Break"><strong class="source-inline">check33</strong></span><span class="No-Break">.</span></p>
			<p>By default, Prowler will scan your AWS services in all of the regions that have opted in. But you can limit scanning to only some regions, <span class="No-Break">like this:</span></p>
			<pre class="console">
./prowler -f 'eu-west-1 us-east-s'</pre>			<p>So, in that case, only your servers in <strong class="source-inline">eu-west-1</strong> and <strong class="source-inline">us-east-s</strong> will <span class="No-Break">be scanned.</span></p>
			<p>And those are the basics<a id="_idIndexMarker435"/> of executing vulnerability scans and pentests in AWS<a id="_idIndexMarker436"/> with Prowler. For more information, refer to Prowler’s README file (<a href="https://github.com/prowler-cloud/prowler#readme">https://github.com/prowler-cloud/prowler#readme</a>) <span class="No-Break">and documentation.</span></p>
			<h2 id="_idParaDest-99"><a id="_idTextAnchor098"/>Pacu</h2>
			<p>Now, it’s time for Pacu. I will walk you through executing<a id="_idIndexMarker437"/> a vulnerability scanning<a id="_idIndexMarker438"/> module. I will also show you how to find the output reports from your Pacu scans. Follow the <span class="No-Break">next steps:</span></p>
			<ol>
				<li>There are one of two methods you can use. You could enter this sequence of commands to prepare your access key to use Pacu free <span class="No-Break">of charge:</span><pre class="source-code">
<strong class="bold">export AWS_ACCESS_KEY_ID=your_access_key_id</strong>
<strong class="bold">export AWS_SECRET_ACCESS_KEY=your_secret_access_key</strong></pre></li>				<li>As an alternative to <em class="italic">step 1</em>, you can enter this command to configure <span class="No-Break">your key:</span></li>
			</ol>
			<p class="callout-heading">Warning</p>
			<p class="callout">This command may incur a charge of 0.0003 USD to your <span class="No-Break">AWS account.</span></p>
			<pre class="source-code">
<strong class="bold">aws configure</strong></pre>			<ol>
				<li value="3">Then, input the key ID that we used for Prowler. Navigate to the directory that we installed <span class="No-Break">Pacu in:</span><pre class="source-code">
<strong class="bold">cd /Pacu</strong></pre></li>				<li>At the AWS CloudShell command line, we’ll first look at the <span class="No-Break">help options:</span><pre class="source-code">
<strong class="bold">pacu –-help</strong></pre></li>				<li>If that doesn’t work, try the alternative installation<a id="_idIndexMarker439"/> instructions here: <a href="https://rhinosecuritylabs.com/aws/pacu-open-source-aws-exploitation-framework/">https://rhinosecuritylabs.com/aws/pacu-open-source-aws-exploitation-framework/</a>. If you installed Pacu that alternative way, you can execute Pacu with this command. Just make sure you’re in the <span class="No-Break">correct directory:</span><pre class="source-code">
<strong class="bold">python3 pacu.py</strong></pre></li>				<li>When Pacu asks<a id="_idIndexMarker440"/> you to name a new session, come up with whatever<a id="_idIndexMarker441"/> name for the session you’d like to use, and hit <em class="italic">Enter</em>. For instance, you can <span class="No-Break">try </span><span class="No-Break"><strong class="source-inline">TestPacuSession</strong></span><span class="No-Break">.</span></li>
				<li>See a list of the modules you <span class="No-Break">can try:</span><pre class="source-code">
<strong class="bold">ls</strong></pre><p class="list-inset">Here’s what <span class="No-Break">to expect:</span></p></li>			</ol>
			<div>
				<div id="_idContainer022" class="IMG---Figure">
					<img src="image/B18672_05_013.jpg" alt="Figure 5.8 – Pacu help screen"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 5.8 – Pacu help screen</p>
			<p>Try whichever modules<a id="_idIndexMarker442"/> you’d like. For example, one<a id="_idIndexMarker443"/> of the modules is named <strong class="source-inline">backdoor_users_password</strong>. Are there any backdoors into your AWS services that could reveal a user password? You can also look at a full list of modules <span class="No-Break">here: </span><a href="https://github.com/RhinoSecurityLabs/pacu/wiki/Module-Details"><span class="No-Break">https://github.com/RhinoSecurityLabs/pacu/wiki/Module-Details</span></a><span class="No-Break">.</span></p>
			<p>Try <span class="No-Break">this command:</span></p>
			<pre class="console">
run &lt;module name&gt;</pre>			<p>For example, you could try <span class="No-Break">the following:</span></p>
			<pre class="console">
run backdoor_users_password</pre>			<p>Afterward, you should be able to go to <strong class="bold">Actions</strong> | <strong class="bold">Download file</strong> from the AWS CloudShell UI and find output files in <span class="No-Break">this directory:</span></p>
			<pre class="source-code">
/home/cloudshell-user/output/</pre>			<p>I recommend checking out the Pacu<a id="_idIndexMarker444"/> wiki for more information about getting the most<a id="_idIndexMarker445"/> out of using Pacu to <span class="No-Break">pentest AWS:</span></p>
			<p><a href="https://github.com/RhinoSecurityLabs/pacu/wiki"><span class="No-Break">https://github.com/RhinoSecurityLabs/pacu/wiki</span></a></p>
			<h1 id="_idParaDest-100"><a id="_idTextAnchor099"/>Summary</h1>
			<p>Anyone can set up an AWS account under their Free Tier to try out some general AWS <span class="No-Break">pentesting tools.</span></p>
			<p>AWS has its own applications that will be useful to you as a pentester. They include AWS CloudShell, AWS Security Hub, and <span class="No-Break">Amazon Inspector.</span></p>
			<p>AWS CloudShell gives you a CLI you can use from your web browser once you’ve logged in to your AWS account. Alternatively, you can use the AWS CLI application, which you can install directly on your Windows, Mac, or <span class="No-Break">Linux PC.</span></p>
			<p>AWS Security Hub is a handy unified application for checking all of your AWS security settings, configurations, <span class="No-Break">and reports.</span></p>
			<p>Amazon Inspector is AWS’s native vulnerability scanning application. I would recommend using it in addition to the other vulnerability scanners and pentesting applications I demonstrate in <span class="No-Break">this book.</span></p>
			<p>A wide range of vulnerability scans and pentests can be executed with Prowler, Cred Scanner, CloudFrunt, and Pacu. These tools help you find security problems such as exposed services and poor security configurations. Remember—you will need to interpret the outputs of these tools yourself and explain them in your pentesting report. If you just share the CSV output files of scans, you’re not doing your job as <span class="No-Break">a pentester!</span></p>
			<p>In <a href="B18672_06.xhtml#_idTextAnchor101"><span class="No-Break"><em class="italic">Chapter 6</em></span></a>, we will return to our AWS account to try containerization with Docker and Kubernetes. Then, we’ll test the Docker and Kubernetes instances we <span class="No-Break">will make.</span></p>
			<h1 id="_idParaDest-101"><a id="_idTextAnchor100"/>Further reading</h1>
			<p>To learn more about the topics covered in this chapter, you can visit the <span class="No-Break">following links:</span></p>
			<ul>
				<li>AWS CloudShell <span class="No-Break">documentation: </span><a href="https://docs.aws.amazon.com/cloudshell/"><span class="No-Break">https://docs.aws.amazon.com/cloudshell/</span></a></li>
				<li>Install <span class="No-Break">Prowler: </span><a href="https://github.com/prowler-cloud/prowler"><span class="No-Break">https://github.com/prowler-cloud/prowler</span></a></li>
				<li>Prowler <span class="No-Break">documentation: </span><a href="https://docs.prowler.cloud/en/latest/"><span class="No-Break">https://docs.prowler.cloud/en/latest/</span></a></li>
				<li><span class="No-Break">Pacu: </span><a href="https://github.com/RhinoSecurityLabs/pacu"><span class="No-Break">https://github.com/RhinoSecurityLabs/pacu</span></a></li>
			</ul>
		</div>
	</body></html>