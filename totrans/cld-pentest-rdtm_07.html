<html><head></head><body>
		<div id="_idContainer035">
			<h1 id="_idParaDest-116" class="chapter-number"><a id="_idTextAnchor115"/>7</h1>
			<h1 id="_idParaDest-117"><a id="_idTextAnchor116"/>Security Features in Azure</h1>
			<p>As a cloud pentester, it’s important for you to understand one of the most popular cloud platforms out there—that is, Azure. You’ll probably be pentesting Azure networks and <span class="No-Break">applications frequently.</span></p>
			<p>In this chapter, we will first examine some of the most commonly used aspects of the Azure ecosystem along with the most popular Azure services, applications, and features, and why they’re used. After that, we’ll look into Azure <strong class="bold">Software-as-a-Service</strong> (<strong class="bold">SaaS</strong>), <strong class="bold">Infrastructure-as-a-Service</strong> (<strong class="bold">IaaS</strong>), and <strong class="bold">Platform-as-a-Service</strong> (<strong class="bold">PaaS</strong>) features. We will conclude the chapter by discussing Microsoft’s own Azure security tools and third-party <span class="No-Break">security tools.</span></p>
			<p>This chapter covers the following <span class="No-Break">main topics:</span></p>
			<ul>
				<li>Introduction <span class="No-Break">to Azure</span></li>
				<li>Frequently used Azure <span class="No-Break">SaaS applications</span></li>
				<li>Azure <span class="No-Break">IaaS applications</span></li>
				<li>Azure <span class="No-Break">PaaS applications</span></li>
				<li>Azure security controls <span class="No-Break">and tools</span></li>
			</ul>
			<p>Let’s jump <span class="No-Break">right in!</span></p>
			<h1 id="_idParaDest-118"><a id="_idTextAnchor117"/>Introduction to Azure</h1>
			<p>At the beginning of the 2000s, Microsoft’s data center infrastructure was smaller than their current cloud platform<a id="_idIndexMarker512"/> competitors, Amazon and Google. But Microsoft’s pockets were comparatively deep. When it launched Xbox Live in 2002 (now known as the Xbox network), it had built immense<a id="_idIndexMarker513"/> backend infrastructure to support what was then the highest-capacity online gaming service ever. From that point on, Microsoft steadily expanded its own data center capacity as it got into the network services business (MSN doesn’t count) concurrently with its expansion into the video game <span class="No-Break">console business.</span></p>
			<p>From what I can tell, building Xbox Live/the Xbox network for the consumer market gave Microsoft the experience it needed to start providing network services for the enterprise market. Amazon launched AWS as “<em class="italic">Amazon.com Web Services</em>” in 2002, its initiative to provide cloud services to the enterprise. Microsoft probably thought, “I’d like a piece of <span class="No-Break">that action.”</span></p>
			<p>It took a few more years <a id="_idIndexMarker514"/>of research and development and building more infrastructure. But by October 2008, Microsoft was ready to announce “Project <span class="No-Break">Red Dog.”</span></p>
			<p class="callout-heading">Project Red Dog</p>
			<p class="callout">Project Red Dog was Microsoft’s<a id="_idIndexMarker515"/> cloud operating system project that was a precursor to Azure. There is no “Red Dog” operating system; it evolved into the Azure services that are mentioned in <span class="No-Break">this chapter.</span></p>
			<p>By 2010, its new cloud service launched as Windows Azure, and by 2014 it was renamed <span class="No-Break">Microsoft Azure.</span></p>
			<p>As with its main competitors Amazon and Google, over the past several years Microsoft has been steadily adding new features and services to its <span class="No-Break">cloud platform.</span></p>
			<p>One of Microsoft’s major advantages is the market dominance of its business operating systems and applications. Companies that run lots of on-premises computers with Windows Server and Active Directory experience great synergy when Azure runs its cloud networks and applications. AWS and GCP can work with Windows Server and Active Directory, but doing that is like eating Italian food made by French people. Windows Server and Microsoft Azure is like eating Italian food made by Italian people! So, it makes sense that many organizations choose to integrate Azure into their networks, whether their cloud is all Azure <span class="No-Break">or multi-cloud.</span></p>
			<p>Before you pentest any Azure network, it’s important to make sure that you’re abiding by Microsoft’s <em class="italic">Penetration Testing Rules of Engagement</em>. Here’s what it says on Microsoft’s <span class="No-Break">website (</span><a href="https://www.microsoft.com/en-us/msrc/pentest-rules-of-engagement"><span class="No-Break">https://www.microsoft.com/en-us/msrc/pentest-rules-of-engagement</span></a><span class="No-Break">):</span></p>
			<p>“<em class="italic">The goal of this program is to enable customers to test their services hosted in Microsoft Cloud services without causing harm to any other </em><span class="No-Break"><em class="italic">Microsoft customers.</em></span></p>
			<p><em class="italic">The following activities </em><span class="No-Break"><em class="italic">are prohibited:</em></span></p>
			<ul>
				<li><em class="italic">Scanning or testing assets belonging to any other Microsoft </em><span class="No-Break"><em class="italic">Cloud customers.</em></span></li>
				<li><em class="italic">Gaining access to any data that is not wholly </em><span class="No-Break"><em class="italic">your own.</em></span></li>
				<li><em class="italic">Performing any kind of denial of </em><span class="No-Break"><em class="italic">service testing.</em></span></li>
				<li><em class="italic">Performing network intensive fuzzing against any asset except your Azure </em><span class="No-Break"><em class="italic">Virtual Machine</em></span></li>
				<li><em class="italic">Performing </em><em class="italic"><a id="_idIndexMarker516"/></em><em class="italic">automated testing of services that generates significant amounts </em><span class="No-Break"><em class="italic">of traffic.</em></span></li>
				<li><em class="italic">Deliberately accessing any other </em><span class="No-Break"><em class="italic">customer’s data.</em></span></li>
				<li><em class="italic">Moving beyond “proof of concept” repro steps for infrastructure execution issues (i.e. proving that you have sysadmin access with SQLi is acceptable, running xp_cmdshell </em><span class="No-Break"><em class="italic">is not).</em></span></li>
				<li><em class="italic">Using our services in a way that violates the Acceptable Use Policy, as set forth in the Microsoft Online </em><span class="No-Break"><em class="italic">Service Terms.</em></span></li>
				<li><em class="italic">Attempting phishing or other social engineering attacks against </em><span class="No-Break"><em class="italic">our employees.</em></span></li>
			</ul>
			<p><em class="italic">The following activities </em><span class="No-Break"><em class="italic">are encouraged:</em></span></p>
			<ul>
				<li><em class="italic">Create a small number of test accounts and/or trial tenants for demonstrating and proving cross-account or cross-tenant data access. However, it is prohibited to use one of these accounts to access the data of another customer </em><span class="No-Break"><em class="italic">or account.</em></span></li>
				<li><em class="italic">Fuzz, port scan, or run vulnerability assessment tools against your own Azure </em><span class="No-Break"><em class="italic">Virtual Machines.</em></span></li>
				<li><em class="italic">Load testing your application by generating traffic which is expected to be seen during the normal course of business. This includes testing </em><span class="No-Break"><em class="italic">surge capacity.</em></span></li>
				<li><em class="italic">Testing security monitoring and detections (e.g. generating anomalous security logs, dropping </em><span class="No-Break"><em class="italic">EICAR, etc).</em></span></li>
				<li><em class="italic">Attempt to break out of a shared service container such as Azure Websites or Azure Functions. However, should you succeed you must both immediately report it to Microsoft and cease digging deeper. Deliberately accessing another customer’s data is a violation of </em><span class="No-Break"><em class="italic">the terms.</em></span></li>
				<li><em class="italic">Applying conditional access or mobile application management (MAM) policies within Microsoft Intune to test the enforcement of the restriction enforced by </em><span class="No-Break"><em class="italic">those policies.</em></span></li>
			</ul>
			<p><em class="italic">Even with these prohibitions, Microsoft reserves the right to respond to any actions on its networks that appear to be malicious. Many automated mitigation mechanisms are employed across the Microsoft Cloud. These will not be disabled to facilitate a </em><span class="No-Break"><em class="italic">penetration test.</em></span><span class="No-Break">”</span></p>
			<p>In a nutshell, you can<a id="_idIndexMarker517"/> pentest in Azure without getting Microsoft’s permission. But you’re limited in what you’re allowed to do. You cannot perform activities that disrupt other Azure <a id="_idIndexMarker518"/>customers, such as <strong class="bold">distributed denial-of-service</strong> (<strong class="bold">DDoS</strong>) attack simulations or stress tests. You may not even attempt to access Azure data and assets that don’t belong to the company you work for. Simulating criminal infrastructure execution exploits is strictly forbidden. You may load-test your company’s own services and applications, but you may not generate more data or consume more bandwidth than what would be used for normal operations. Microsoft encourages you to create new user accounts to test for IAM problems, as long as you don’t try to access any data that doesn’t belong to the company that you work for. Of course, you will also need written permission from the company you work for to perform any sort of pentest, security test, or red team <span class="No-Break">engagement whatsoever.</span></p>
			<p>Microsoft Azure is a unique cloud platform. But in many ways, it’s similar to AWS and GCP. As with AWS, GCP, and many other cloud providers, Azure offers a wide range of cloud services that can be categorized according to how much responsibility Microsoft has and how much responsibility the customer (the business you work for) has. As with other cloud platforms, all Azure services can be categorized as either SaaS, PaaS, <span class="No-Break">or IaaS.</span></p>
			<p>No matter whether the service is SaaS, PaaS, or IaaS, organizations are responsible for the security of their own data. If a software vulnerability in a customer’s own code is exploited in a cyber attack, it’s the customer’s problem to deal with. Microsoft offers a lot of very useful security tools that can greatly improve an organization’s security posture in Azure, but they have to actually be used in order for them <span class="No-Break">to work.</span></p>
			<p>And no matter what, Microsoft is responsible for the security of its Azure infrastructure. That’s why no one is allowed to visit any of its data centers without Microsoft’s explicit permission and close supervision. That’s also why pentesters are limited in what they’re allowed to do when they execute pentesting and red team engagements in Azure. Customers are responsible for <a id="_idIndexMarker519"/>their security in the cloud; cloud providers are responsible for the security of the cloud. A customer’s own code and applications are their business; Microsoft’s servers, networking devices, data center buildings, and Microsoft’s own code is <span class="No-Break">its business.</span></p>
			<p><a href="B18672_03.xhtml#_idTextAnchor050"><span class="No-Break"><em class="italic">Chapter 3</em></span></a> goes into detail about the shared responsibility model of cloud computing. But for the sake of convenience, you can review Microsoft’s <em class="italic">Penetration Testing Rules of Engagement</em> (<a href="https://www.microsoft.com/en-us/msrc/pentest-rules-of-engagement">https://www.microsoft.com/en-us/msrc/pentest-rules-of-engagement</a>) and the <em class="italic">Microsoft Online Subscription Agreement</em> (<a href="https://azure.microsoft.com/en-us/support/legal/subscription-agreement/">https://azure.microsoft.com/en-us/support/legal/subscription-agreement/</a>). It’s of the utmost importance that you understand and abide by Microsoft’s rules before you commence any pentesting in Azure. So, review those resources and re-read <a href="B18672_03.xhtml#_idTextAnchor050"><span class="No-Break"><em class="italic">Chapter 3</em></span></a> to make sure you understand what you’re permitted to do and what’s forbidden. If the organization you’re working for asks you to do something that Microsoft forbids, Microsoft’s authority trumps theirs. When you pentest Azure, you’re a guest in <span class="No-Break">Microsoft’s house.</span></p>
			<p>SaaS, PaaS, and IaaS indicate how much of an Azure service is Microsoft’s and how much responsibility and autonomy the company you work for has. In SaaS, a lot of the software code belongs to Microsoft. Your company does the least amount of work (relative to PaaS and IaaS). Your company’s data is running in Microsoft’s online applications. In IaaS, Microsoft is providing its own infrastructure and little else. Your organization has the most flexibility and control, but it also has to build and maintain almost all of the software code and networking configurations that it’s using in Microsoft’s infrastructure. PaaS is in the middle of those two extremes. PaaS comes with more Microsoft APIs and service features than IaaS. Microsoft is providing an application and services platform, but it’s supporting your organization’s <span class="No-Break">own software.</span></p>
			<p>Now, let’s explore the most frequently used <span class="No-Break">Azure services.</span></p>
			<h1 id="_idParaDest-119"><a id="_idTextAnchor118"/>Frequently used Azure SaaS applications</h1>
			<p>I’ll summarize the<a id="_idIndexMarker520"/> most popular SaaS applications in Azure. It’s unlikely that you will be pentesting them because Microsoft has more responsibility for the security of its SaaS than for its PaaS and IaaS. Your company just inputs its own data into these applications or embeds them in its own applications. But it’s important as an Azure pentester to understand the many ways Azure is used so that you can contextualize how SaaS fits in with the rest of Azure and how the company you work for may be using Azure SaaS applications. Plus, the data your organization inputs into Azure’s SaaS applications is your organization’s security responsibility. For instance, if someone in your organization <a id="_idIndexMarker521"/>puts their sensitive bank account information into Microsoft Cost Management outside of the cryptography Microsoft has implemented, that’s your organization’s problem. If your organization has a PaaS or IaaS application that interfaces with a SaaS application, that data flow can likely be pentested from the PaaS or <span class="No-Break">IaaS end.</span></p>
			<h2 id="_idParaDest-120"><a id="_idTextAnchor119"/>Azure Maps</h2>
			<p><strong class="bold">Azure Maps</strong> is similar to Google Maps. It offers detailed maps of pretty much every built-up part of the world. There are <a id="_idIndexMarker522"/>built-in features that use IP and GPS geolocation <a id="_idIndexMarker523"/>so that users can see where they are on the map and where they’re going. Azure Maps can be integrated into the mobile and web applications that Azure customers develop. So, for instance, businesses can show a map of the physical location of their premises in an embedded Azure Maps applet on their web pages. Azure Maps has about 250 different code samples hosted on GitHub (<a href="https://samples.azuremaps.com/">https://samples.azuremaps.com/</a>) to make<a id="_idIndexMarker524"/> integration easy for developers. There are code samples for everything, from animating multiple points on a map to showing different map layers with different kinds of geographic and meteorological data to implementing maps of indoor spaces with Azure Maps <span class="No-Break">Web Control:</span></p>
			<div>
				<div id="_idContainer030" class="IMG---Figure">
					<img src="image/B18672_07_01.jpg" alt="Figure 7.1 – Screenshot of Azure Maps"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.1 – Screenshot of Azure Maps</p>
			<p>Azure Maps has multiple<a id="_idIndexMarker525"/> data feeds for traffic, weather, photographic imagery, and data visualization. For instance, where are the tallest mountain peaks and <a id="_idIndexMarker526"/>deepest canyons? Which areas get the most precipitation in a given year? Where are all of a retailer’s stores located? Azure Maps’s data visualization features work with a business customer’s <span class="No-Break">own data.</span></p>
			<h2 id="_idParaDest-121"><a id="_idTextAnchor120"/>Azure Digital Twins</h2>
			<p><strong class="bold">Azure Digital Twins</strong> uses a customer’s <a id="_idIndexMarker527"/>own IoT devices to create digital models of physical objects, business processes, and places. When the IoT devices detect <a id="_idIndexMarker528"/>changes in a physical environment, Azure Digital Twins can adjust the digital models accordingly. It integrates with REST APIs, Azure IoT Hub, Logic Apps, Event Hubs, Azure Data Explorer, and Azure Synapse Analytics. It’s kind of weird but also kind <span class="No-Break">of cool.</span></p>
			<h2 id="_idParaDest-122"><a id="_idTextAnchor121"/>Azure Monitor</h2>
			<p>The two previous applications (Azure Maps and Azure Digital Twins) are more specialized. But <strong class="bold">Azure Monitor</strong> is a lot more <a id="_idIndexMarker529"/>generalized. Azure Monitor can be configured so that organizations can see a wide range of business networking data through dynamic dashboard <a id="_idIndexMarker530"/>interfaces. Metrics, logs, changes, and traces are fed into Azure Monitor. Then, administrators can watch a variety of different network events, and not all of them are directly related to security events. You can also display live data for metrics such as “<em class="italic">How many users are using which applications, </em><span class="No-Break"><em class="italic">and when?</em></span><span class="No-Break">”</span></p>
			<p>Azure Monitor integrates into every Azure service and application possible. You can also implement data from other cloud provider services (multi-cloud environments) and on-premises networks through <span class="No-Break">Azure Arc.</span></p>
			<h2 id="_idParaDest-123"><a id="_idTextAnchor122"/>Microsoft Cost Management</h2>
			<p><strong class="bold">Microsoft Cost Management</strong> gives Azure customers very detailed information about how much they’re spending on their various<a id="_idIndexMarker531"/> Azure services, applications, and features. There are detailed panels for cost analysis, cost alerts, budgetary <a id="_idIndexMarker532"/>data, billing charges and usage, and Azure costs related to company departments <span class="No-Break">and accounts.</span></p>
			<p>Graphs can be shown that<a id="_idIndexMarker533"/> show trends and patterns in a customer’s spending on Azure services. Accountants and <strong class="bold">chief financial officers</strong> (<strong class="bold">CFOs</strong>) love this sort of stuff. It’s not just “<em class="italic">Our company spent $25,657 on Azure this month.</em>” Microsoft Cost Management shows every possible Azure spending metric that can be shown on an accountant’s ledger. So, of course, customers can see pie graphs that break down overall Azure spending into all the <span class="No-Break">applicable categories.</span></p>
			<h2 id="_idParaDest-124"><a id="_idTextAnchor123"/>Azure Advisor</h2>
			<p><strong class="bold">Azure Advisor</strong> is similar to Microsoft<a id="_idIndexMarker534"/> Cost Management, but instead of budgetary and <a id="_idIndexMarker535"/>billing information, it shows a variety of metrics related to security, reliability, performance, operational excellence, <span class="No-Break">and cost:</span></p>
			<div>
				<div id="_idContainer031" class="IMG---Figure">
					<img src="image/B18672_07_02.jpg" alt="Figure 7.2 – Screenshot of Azure Advisor"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.2 – Screenshot of Azure Advisor</p>
			<p>Azure Advisor can be launched<a id="_idIndexMarker536"/> through the <strong class="bold">Azure command-line interface</strong> (<strong class="bold">Azure CLI</strong>), the Advisor API, or <a id="_idIndexMarker537"/>the Azure portal to show metrics that are relevant in context. If an administrator asks “<em class="italic">How can we manage our Azure resources and applications more effectively?</em>”, Azure Advisor <a id="_idIndexMarker538"/>will provide the information they need in order to make those kinds <span class="No-Break">of decisions.</span></p>
			<h2 id="_idParaDest-125"><a id="_idTextAnchor124"/>Network Watcher</h2>
			<p><strong class="bold">Network Watcher</strong> is an overall network<a id="_idIndexMarker539"/> performance monitoring<a id="_idIndexMarker540"/> and diagnostics solution. It shows dashboards with dynamic real-time networking metrics from <strong class="bold">virtual machines</strong> (<strong class="bold">VMs</strong>), <strong class="bold">virtual private networks</strong> (<strong class="bold">VPNs</strong>), and <a id="_idIndexMarker541"/>network <span class="No-Break">traffic </span><span class="No-Break"><a id="_idIndexMarker542"/></span><span class="No-Break">patterns.</span></p>
			<p>See how much network bandwidth each part of your organization’s Azure cloud uses! View general security metrics, resource security hygiene, security alerts, and compliance data through Security Center. Network Watcher can also be used to diagnose various <span class="No-Break">connectivity issues.</span></p>
			<p>Now that we have looked at<a id="_idIndexMarker543"/> SaaS, let’s get into IaaS. While SaaS gives Microsoft the maximum control and security responsibility, IaaS gives most of the control and security responsibility to the organization that you <span class="No-Break">work for.</span></p>
			<h1 id="_idParaDest-126"><a id="_idTextAnchor125"/>Azure IaaS applications</h1>
			<p>Azure IaaS gives your organization just the <a id="_idIndexMarker544"/>very basics as far as software code is concerned. The vast majority of the code your organization deploys in IaaS belongs to your organization and is your organization’s responsibility as far as cybersecurity <span class="No-Break">is concerned.</span></p>
			<p>Here are some of the most commonly used IaaS applications <span class="No-Break">in Azure.</span></p>
			<h2 id="_idParaDest-127"><a id="_idTextAnchor126"/>Azure Virtual Machines</h2>
			<p><strong class="bold">Azure Virtual Machines</strong> enables your organization to deploy VMs with Windows and Linux. You can deploy lots and lots of <a id="_idIndexMarker545"/>virtualized Windows and Linux servers to do anything and everything Linux and Windows<a id="_idIndexMarker546"/> servers do, from running huge enterprise applications to deploying web servers and other kinds of <span class="No-Break">internet services.</span></p>
			<h2 id="_idParaDest-128"><a id="_idTextAnchor127"/>Azure Kubernetes Service</h2>
			<p><strong class="bold">Azure Kubernetes Service</strong> (<strong class="bold">AKS</strong>) supports Kubernetes containerization orchestration in <span class="No-Break">Azure (</span><a href="https://azure.microsoft.com/en-ca/products/kubernetes-service/"><span class="No-Break">https://azure.microsoft.com/en-ca/products/kubernetes-service/</span></a><span class="No-Break">).</span></p>
			<p>AKS is specially designed for<a id="_idIndexMarker547"/> Kubernetes clusters, so<a id="_idIndexMarker548"/> it is the best way to deploy Kubernetes-based applications in Azure. I was able to deploy Kubernetes with AKS in Azure within minutes, whereas deploying Kubernetes in Azure without AKS is at least hours of work and a lot <span class="No-Break">of hassle:</span></p>
			<div>
				<div id="_idContainer032" class="IMG---Figure">
					<img src="image/B18672_07_03.jpg" alt="Figure 7.3 – Screenshot of AKS"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.3 – Screenshot of AKS</p>
			<p>There will be a lot more <a id="_idIndexMarker549"/>information about<a id="_idIndexMarker550"/> AKS in <a href="B18672_09.xhtml#_idTextAnchor159"><span class="No-Break"><em class="italic">Chapter 9</em></span></a><span class="No-Break">!</span></p>
			<h2 id="_idParaDest-129"><a id="_idTextAnchor128"/>Azure Container Instances</h2>
			<p><strong class="bold">Azure Container Instances</strong> (<strong class="bold">ACI</strong>) empowers Azure<a id="_idIndexMarker551"/> customers to <a id="_idIndexMarker552"/>develop and deploy their own software applications without having to manage VMs or learn <span class="No-Break">new tools:</span></p>
			<div>
				<div id="_idContainer033" class="IMG---Figure">
					<img src="image/B18672_07_04.jpg" alt="Figure 7.4 – Screenshot of ACI"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.4 – Screenshot of ACI</p>
			<p>ACI can work with AKS and Azure Functions (more on that in the immediate next section) to support complex applications <a id="_idIndexMarker553"/>with lots <span class="No-Break">of </span><span class="No-Break"><a id="_idIndexMarker554"/></span><span class="No-Break">containers.</span></p>
			<h2 id="_idParaDest-130"><a id="_idTextAnchor129"/>Azure Dedicated Host</h2>
			<p><strong class="bold">Azure Dedicated Host</strong> is a dedicated physical <a id="_idIndexMarker555"/>server to host Azure VMs running<a id="_idIndexMarker556"/> Windows and Linux. Yes—with Azure Dedicated Host, your organization gets its very own physical server machine on Microsoft’s premises. That’s a relatively expensive option for enterprises that have the budget for it, but it gives them the maximum control they can possibly have within the <span class="No-Break">Azure ecosystem:</span></p>
			<div>
				<div id="_idContainer034" class="IMG---Figure">
					<img src="image/B18672_07_05.jpg" alt="Figure 7.5 – Screenshot of Azure Dedicated Host"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.5 – Screenshot of Azure Dedicated Host</p>
			<p>Now, let’s take a look at PaaS <span class="No-Break">in Azure.</span></p>
			<h1 id="_idParaDest-131"><a id="_idTextAnchor130"/>Azure PaaS applications</h1>
			<p>Azure PaaS is in between SaaS and IaaS<a id="_idIndexMarker557"/> as far as the amount of control and autonomy of Azure customers (such as the business organization you work for) <span class="No-Break">is concerned.</span></p>
			<p>In PaaS, Azure provides a platform. Only Azure SaaS provides Azure’s own complete applications that customers deploy their data in, whereas Azure IaaS basically provides Azure’s server hardware and networking infrastructure with absolutely minimal Azure code. The vast majority of the code in an IaaS deployment belongs to the customer and is <span class="No-Break">their responsibility.</span></p>
			<p>Here are Azure PaaS services where customers run the applications they develop, but within platform systems that <span class="No-Break">Microsoft develops.</span></p>
			<h2 id="_idParaDest-132"><a id="_idTextAnchor131"/>Azure SQL Database</h2>
			<p><strong class="bold">Azure SQL Database</strong> enables customers to build<a id="_idIndexMarker558"/> applications with <a id="_idIndexMarker559"/>SQL databases. SQL is one of the top vendor-neutral database development technologies. A wide variety of types of applications that need support from backend services use SQL, not just mobile apps or <span class="No-Break">web apps.</span></p>
			<h2 id="_idParaDest-133"><a id="_idTextAnchor132"/>Web Apps</h2>
			<p><strong class="bold">Web Apps</strong> is used to host <a id="_idIndexMarker560"/>ASP.NET web applications. ASP.NET is a developer platform of tools, programming languages, and <a id="_idIndexMarker561"/>libraries for building web apps. It uses HTML, CSS, JavaScript, Node.js, Python, Java, <span class="No-Break">and C#.</span></p>
			<h2 id="_idParaDest-134"><a id="_idTextAnchor133"/>Mobile Apps</h2>
			<p><strong class="bold">Mobile Apps</strong> is Microsoft Azure’s<a id="_idIndexMarker562"/> service for deploying the backend for all kinds of apps for iOS and Android. It <a id="_idIndexMarker563"/>deploys <strong class="bold">single sign-on</strong> (<strong class="bold">SSO</strong>) authentication with Azure Active Directory. It integrates with <a id="_idIndexMarker564"/>Facebook, Twitter, and Google APIs. It also enables apps to work offline for extended periods of time, although mobile apps should be online periodically <span class="No-Break">for synchronization.</span></p>
			<h2 id="_idParaDest-135"><a id="_idTextAnchor134"/>Azure Logic Apps</h2>
			<p><strong class="bold">Azure Logic Apps</strong> is a very specialized<a id="_idIndexMarker565"/> logic application development tool. A logic app creates and automates workflows without having to write a lot of code. Logic apps can be built with diagrams where <a id="_idIndexMarker566"/>events <span class="No-Break">trigger actions.</span></p>
			<h2 id="_idParaDest-136"><a id="_idTextAnchor135"/>Azure Functions</h2>
			<p><strong class="bold">Azure Functions</strong> is a serverless compute<a id="_idIndexMarker567"/> platform, which means that Azure customers can deploy applications without their having to manage a server. Azure <a id="_idIndexMarker568"/>Functions is event-driven, which means that if certain defined events occur in the applications your organization develops, Azure Functions will respond to those events in a way that your organization <span class="No-Break">defines (</span><a href="https://azure.microsoft.com/en-us/products/functions/"><span class="No-Break">https://azure.microsoft.com/en-us/products/functions/</span></a><span class="No-Break">).</span></p>
			<p>Now, let’s look at the applications Microsoft provides Azure users with for <span class="No-Break">managing cybersecurity.</span></p>
			<h1 id="_idParaDest-137"><a id="_idTextAnchor136"/>Azure security controls and tools</h1>
			<p>It’s possible to use Microsoft Azure to deploy cloud networks with excellent security. But cybersecurity is everyday work. As a cloud pentester, you’ll be deploying pentests, red team engagements, and vulnerability scans that will give the organization the vulnerability data it needs to continuously security harden its networks and applications. Defensive security specialists need to put your security recommendations into practice. They also need to actually use the variety of security tools that Microsoft provides <span class="No-Break">for Azure.</span></p>
			<p>Excellent cybersecurity is possible with Azure. But you’ve got to do the work and use the tools Microsoft <span class="No-Break">gives you!</span></p>
			<h2 id="_idParaDest-138"><a id="_idTextAnchor137"/>Security controls</h2>
			<p>Microsoft provides a<a id="_idIndexMarker569"/> number of applications to help your organization maintain the cybersecurity of its applications and services in Azure. They are also useful for pentesters to check, to look for security alerts and vulnerabilities that Microsoft’s own security controls <span class="No-Break">can find.</span></p>
			<p>Here are the main security controls that Microsoft provides for <span class="No-Break">securing Azure.</span></p>
			<h3>Microsoft Defender for Cloud</h3>
			<p><strong class="bold">Microsoft Defender for Cloud</strong> is its main unified cloud-native application protection platform. If you’re already familiar with <a id="_idIndexMarker570"/>Microsoft Defender in Windows, Microsoft Defender for Cloud includes a lot of those<a id="_idIndexMarker571"/> features and expands upon them for functionality that’s required for securing <span class="No-Break">cloud networks.</span></p>
			<p>Microsoft Defender for Cloud provides visibility into your security posture not only in Azure, but also in AWS, GCP, and your organization’s on-premises network. It provides antimalware and security monitoring for a variety of services. Administrators can see critical risks prioritized with context-aware security. It<a id="_idIndexMarker572"/> also provides <strong class="bold">extended detection and response</strong> (<strong class="bold">XDR</strong>) to detect and respond to cyber attacks. You can even see real-time data about your network’s <span class="No-Break">regulatory compliance.</span></p>
			<p>If Microsoft Defender for Cloud is running in the services you’re pentesting, your organization should see detailed information about the cyber attacks <span class="No-Break">you’re simulating!</span></p>
			<h3>Microsoft Defender External Attack Surface Management</h3>
			<p><strong class="bold">Microsoft Defender External Attack Surface Management</strong> (<strong class="bold">Defender EASM</strong>) builds upon Microsoft Defender’s<a id="_idIndexMarker573"/> basic features. Organizations <a id="_idIndexMarker574"/>can have unique external cyber-attack surfaces. Defender EASM discovers unknown resources so that organizations can have full visibility into their <span class="No-Break">security posture.</span></p>
			<p>Defender EASM works dynamically and in real time, so administrators can be alerted to new external-facing resources as <span class="No-Break">they appear.</span></p>
			<p class="callout-heading">Note</p>
			<p class="callout">Shadow IT is a huge problem in many organizations. Shadow IT refers to when employees, contractors, and other people internal to an organization use their own applications and devices with a company’s network. The problem with shadow IT is that the new technologies that insiders introduce to a company’s network aren’t managed by their cybersecurity or IT team. So, shadow IT can introduce new attack vectors, vulnerabilities, and malware that an organization is often completely unaware of. Shadow IT is one of the many kinds of external risks that Defender EASM can detect <span class="No-Break">and mitigate.</span></p>
			<h3>Azure DDoS Protection</h3>
			<p><strong class="bold">Azure DDoS Protection</strong> is as it sounds. In a DDoS attack, cyber attackers overwhelm your applications and networked <a id="_idIndexMarker575"/>services with an overwhelming volume of malicious data in order to shut them down. It’s a major attack on the availability<a id="_idIndexMarker576"/> of data in the CIA triad of cybersecurity. The <em class="italic">distributed</em> part means that the attacker leverages a number of distributed machines in order to execute their attacks. The most common method for DDoS attacks is to use a botnet of zombie malware-infected computing devices, which can include any combination of PCs, servers, phones, tablets, IoT devices, and routers. The attacker controls their botnet through<a id="_idIndexMarker577"/> their <strong class="bold">command and control</strong> (<strong class="bold">C2</strong>) server. So, botnets offer a lot of computing power that can be used to execute <span class="No-Break">DDoS attacks.</span></p>
			<p>Azure DDoS Protection uses <a id="_idIndexMarker578"/>adaptive <strong class="bold">threat intelligence</strong> (<strong class="bold">TI</strong>) with <strong class="bold">artificial intelligence</strong> (<strong class="bold">AI</strong>) and DDoS mitigation<a id="_idIndexMarker579"/> capacity. The latter feature uses Microsoft’s data processing and networking infrastructure to absorb an attacker’s large volumes of malicious data before it can harm your organization’s own Azure services <span class="No-Break">and applications.</span></p>
			<h3>Azure Bastion</h3>
			<p><strong class="bold">Azure Bastion</strong> makes it possible <a id="_idIndexMarker580"/>for organizations to deploy remote access to their VMs in a secure way. That’s a common need <a id="_idIndexMarker581"/>because these days, businesses support more remote workers than ever before. If an employee connects to their employer’s Azure-hosted VMs from their home, it should be routed through <span class="No-Break">Azure Bastion.</span></p>
			<p>A direct connection for RDP and SSH (common remote networking internet protocols) sessions in the Azure portal can be launched at any time. Your organization’s VMs don’t need any additional software to use Azure Bastion. Azure Bastion integrates into your firewalls and other security controls. And most importantly, Azure Bastion prevents the IP addresses assigned to your VMs from being exposed to the public. That makes it much harder for external cyber attackers to access and harm your <span class="No-Break">organization’s VMs.</span></p>
			<h3>Azure Firewall</h3>
			<p><strong class="bold">Azure Firewall</strong> is designed to securely manage and limit access to your organization’s Azure <strong class="bold">Virtual Network</strong> (<strong class="bold">VNet</strong>). Traffic can<a id="_idIndexMarker582"/> be dynamically denied from malicious IP addresses and domains. It uses <strong class="bold">Transport Layer Security</strong> (<strong class="bold">TLS</strong>) to prevent malware<a id="_idIndexMarker583"/> transmission through encrypted sessions. Network and <a id="_idIndexMarker584"/>application firewall rules can be managed throughout all of your organization’s <span class="No-Break">virtual networks.</span></p>
			<p>Azure Firewall also features built-in <strong class="bold">Intrusion Detection and Prevention System</strong> (<strong class="bold">IDPS</strong>) capabilities to generate <a id="_idIndexMarker585"/>security incident alerts and output logs and block many kinds of attacks in real time. So, it has not only the basic firewall functionality of blocking or filtering traffic according to a series of security rules, but it also uses <strong class="bold">Machine Learning</strong> (<strong class="bold">ML</strong>) to improve its functionality over time by learning from your organization’s network <span class="No-Break">traffic patterns.</span></p>
			<h3>Azure Web Application Firewall</h3>
			<p><strong class="bold">Azure Web Application Firewall</strong> (<strong class="bold">WAF</strong>) is a specialized firewall for web applications. <strong class="bold">Open Web Application Security Project</strong> (<strong class="bold">OWASP</strong>) is an organization that maintains<a id="_idIndexMarker586"/> web security standards <a id="_idIndexMarker587"/>including their Top 10 security risks. Azure WAF is specifically designed to mitigate <span class="No-Break">those risks.</span></p>
			<p>There are a variety of technologies that are<a id="_idIndexMarker588"/> particular to web applications and web servers, so Azure WAF is designed to work natively in that <span class="No-Break">use case.</span></p>
			<h3>Azure Firewall Manager</h3>
			<p><strong class="bold">Azure Firewall Manager</strong> is listed as its own application. It simply works as a configuration and management interface<a id="_idIndexMarker589"/> for Azure Firewall. It presents <a id="_idIndexMarker590"/>administrators with a unified control plane dashboard so that they can see everything that Azure Firewall is doing at any given time, and also see their security alerts. Multiple Azure Firewall instances can be managed through one Azure Firewall Manager control plane. It can also integrate with<a id="_idIndexMarker591"/> third-party <strong class="bold">Security-as-a-Service</strong> (<span class="No-Break"><strong class="bold">SECaaS</strong></span><span class="No-Break">) applications.</span></p>
			<h3>Microsoft Sentinel</h3>
			<p><strong class="bold">Microsoft Sentinel</strong> is a <strong class="bold">Security Information and Event Management</strong> (<strong class="bold">SIEM</strong>) system that’s directly integrated into Azure. Your<a id="_idIndexMarker592"/> organization may use it if they have a <strong class="bold">Security Operations </strong><span class="No-Break"><strong class="bold">Center</strong></span><span class="No-Break"> (</span><span class="No-Break"><strong class="bold">SOC</strong></span><span class="No-Break">).</span></p>
			<p class="callout-heading">What does a SOC do?</p>
			<p class="callout">A SOC is a defensive cybersecurity team and department that watches for security events and incidents in real time and responds <span class="No-Break">to them.</span></p>
			<p>A SIEM system analyzes the various<a id="_idIndexMarker593"/> network and server logs that<a id="_idIndexMarker594"/> are fed into the SIEM system and shows the SOC analysts security alerts when it looks like a security incident could be occurring, which are generally <span class="No-Break">cyber attacks.</span></p>
			<p>The SOC plays an integral <a id="_idIndexMarker595"/>role in <strong class="bold">incident response</strong> (<strong class="bold">IR</strong>). Their job is to mitigate or contain an attack or breach as soon as possible while it’s happening to mitigate as much harm <span class="No-Break">as possible.</span></p>
			<p>In layperson’s terms, with Microsoft Sentinel, SOC analysts can view a control plane and dashboard that shows through network and application activity that something bad is happening. When something really bad appears to be happening, the SOC analysts get a notification that says something to the effect of “<em class="italic">Danger, danger!</em>” Then, they can use Microsoft Sentinel to investigate the incident to help stop the bad thing <span class="No-Break">from happening.</span></p>
			<h3>Key Vault</h3>
			<p><strong class="bold">Key Vault</strong> stores the various <a id="_idIndexMarker596"/>cryptographic keys and secrets that your organization uses in Azure. Keys and secrets are<a id="_idIndexMarker597"/> used to acquire privileged access to sensitive data and applications. It would be super dangerous for any of those keys to fall into the wrong hands. So, they’re kept in a <span class="No-Break">metaphorical vault!</span></p>
			<p>Key Vault ensures that applications have no direct access to keys. Keys can both be created by and imported to <span class="No-Break">Key Vault.</span></p>
			<p>As much of your organization’s data in transit and in storage as possible should be encrypted. That’s a part of <em class="italic">Cybersecurity 101</em>. Scrambling plaintext data into ciphertext gibberish protects both the confidentiality and integrity components of the <span class="No-Break">CIA triad.</span></p>
			<p>Azure has all the tools your organization needs to make sure that all data in storage and in transit is strongly <a id="_idIndexMarker598"/>encrypted. Key Vault should be used so that<a id="_idIndexMarker599"/> unauthorized parties and cyber attackers cannot “unlock” any <span class="No-Break">of it.</span></p>
			<h3>Microsoft Azure Attestation</h3>
			<p><strong class="bold">Microsoft Azure Attestation</strong> exists because the Azure clouds organizations deploy don’t only implement entities within the Azure <a id="_idIndexMarker600"/>ecosystem. Many <a id="_idIndexMarker601"/>organizations also implement third-party services and applications into their Azure networks. Microsoft Azure Attestation verifies the identities and security postures of third-party platforms before they’re <span class="No-Break">interacted with.</span></p>
			<p>Your organization has a lot of different security policies, baselines, and standards. Microsoft Azure Attestation will verify if they can be established in third-party platforms. If so, Microsoft Azure Attestation can make sure that those security policies, baselines, and standards are enforced <span class="No-Break">through them.</span></p>
			<p>Active Directory is what Windows Server uses to manage the security of user accounts, user groups, and administrative accounts. <strong class="bold">Azure Active Directory</strong> extends those sorts of IAM features <span class="No-Break">into Azure.</span></p>
			<p>Controlling what user accounts are allowed to do is a major part of security operations, as is making sure those accounts have proper authentication and authorization. A control plane provides full visibility of how accounts are being used. Azure Active Directory also implements SSO and <strong class="bold">multi-factor authentication</strong> (<strong class="bold">MFA</strong>) systems. MFA is absolutely crucial! MFA often isn’t a default, but it should be. Even the best passwords are vulnerable to data breaches and certain kinds of cryptoanalysis attacks. Augmenting passwords with additional authentication vectors such as biometrics and <strong class="bold">one-time password</strong> (<strong class="bold">OTP</strong>)/PIN applications greatly improves <span class="No-Break">account security.</span></p>
			<h3>Azure Information Protection</h3>
			<p><strong class="bold">Azure Information Protection</strong> (<strong class="bold">AIP</strong>) is another <a id="_idIndexMarker602"/>generic name for a service that explains exactly what it does. It <a id="_idIndexMarker603"/>conducts a lot of <strong class="bold">Data Loss Prevention</strong> (<strong class="bold">DLP</strong>) features by classifying data according to sensitivity labels and then making sure that data is only shared outside of <a id="_idIndexMarker604"/>your organization as it’s permitted to <span class="No-Break">do so.</span></p>
			<p>AIP can protect documents, many other types of files, and email. As cybersecurity practitioners, we think about email attachments as a malware vector all the time. We’re also aware of how often phishing<a id="_idIndexMarker605"/> emails with links to dangerous phishing websites are sent and received. But email is also a major<a id="_idIndexMarker606"/> vector for breaching confidential or sensitive data! AIP helps protect against sensitive data being breached <span class="No-Break">by email.</span></p>
			<h3>Azure Dedicated HSM</h3>
			<p><strong class="bold">Azure Dedicated HSM</strong> is a very specialized<a id="_idIndexMarker607"/> Azure cybersecurity application. <strong class="bold">HSM</strong> stands for <strong class="bold">hardware security module</strong>. An HSM is a physical computing device, often the size of a RAM or graphics<a id="_idIndexMarker608"/> card, that <a id="_idIndexMarker609"/>protects cryptographic keys, performs encryption and decryption for digital signatures, and assures strong authentication in <span class="No-Break">additional ways.</span></p>
			<p>Organizations can use HSM devices with their endpoint and client computers and in their on-premises networks. Azure Dedicated HSM is a backend to support those HSMs that run in Azure’s cloud platform. Azure Dedicated HSM can be used to manage access to HSMs within your organization and also to configure them with your <span class="No-Break">Azure services.</span></p>
			<h3>VPN Gateway</h3>
			<p><strong class="bold">VPN Gateway</strong> enables organizations<a id="_idIndexMarker610"/> to integrate their own VPN infrastructure with their Azure services. A VPN is a way to implement <strong class="bold">end-to-end</strong> (<strong class="bold">E2E</strong>) encryption<a id="_idIndexMarker611"/> between two endpoints through a computer network, most often<a id="_idIndexMarker612"/> through the internet. Enterprises often have their own VPN servers so that they have full control over how that technology <span class="No-Break">is used.</span></p>
			<p>Many organizations mandate that VPNs be used in situations such as people working remotely from home and connecting to their employer’s network, and also to protect use cases such as employee<a id="_idIndexMarker613"/> travel and <strong class="bold">Bring-Your-Own-Device</strong> (<strong class="bold">BYOD</strong>) policies. A good VPN<a id="_idIndexMarker614"/> can protect against <strong class="bold">man-in-the-middle</strong> (<strong class="bold">MITM</strong>) attacks whereby a cyber attacker intercepts a network session to breach confidentiality or tamper with the integrity of <span class="No-Break">network-transmitted data.</span></p>
			<h3>App Configuration</h3>
			<p><strong class="bold">App Configuration</strong> is for organizations that develop and deploy their own apps in Azure. App Configuration enables<a id="_idIndexMarker615"/> organizations to unify security configuration settings across all of their own Azure apps and<a id="_idIndexMarker616"/> app users. That’s especially useful for both regulatory compliance and for complying with an organization’s own <span class="No-Break">security policies.</span></p>
			<p>If there’s a critical problem with an app’s configuration, the problem can be fixed in real time without having to redeploy the app. Distributed components shared between multiple apps can also be troubleshooted and remediated if they have security vulnerabilities <span class="No-Break">or misconfigurations.</span></p>
			<p>So, that’s all of the major security controls that Microsoft provides to Azure customers so that they can improve the security of their Azure networks, applications, <span class="No-Break">and services.</span></p>
			<p>Now, let’s examine some top third-party Azure pentesting and vulnerability <span class="No-Break">scanning tools!</span></p>
			<h2 id="_idParaDest-139"><a id="_idTextAnchor138"/>Security tools</h2>
			<p>There are a lot of third-party-developed vulnerability assessment and pentesting tools for Azure. You’ll probably be <a id="_idIndexMarker617"/>using at least a few of these as a pentester! In <em class="italic">Chapters 8 </em>and <em class="italic">9</em>, I’ll walk you through using some of these tools so that you can discover Azure cybersecurity vulnerabilities in a way that’s permitted by Microsoft’s <span class="No-Break">Azure policies.</span></p>
			<h3>Prowler</h3>
			<p>If you’ve read <em class="italic">Chapters 5</em> and <em class="italic">6</em> about pentesting AWS, you’re<a id="_idIndexMarker618"/> already familiar with <strong class="bold">Prowler</strong> (<a href="https://github.com/prowler-cloud/prowler">https://github.com/prowler-cloud/prowler</a>). Prowler can also be used to pentest Azure! Prowler <a id="_idIndexMarker619"/>can be run from the CLI to check for common security misconfigurations and also conduct vulnerability scans based on <span class="No-Break">CIS Benchmarks.</span></p>
			<p>As with AWS, when you use Prowler with Azure, you can generate vulnerability scanning logs that give you data that you can <a id="_idIndexMarker620"/>use directly in your pentesting reports, complete with <strong class="bold">Common Vulnerability Scoring System</strong> (<strong class="bold">CVSS</strong>) vulnerability <a id="_idIndexMarker621"/>scoring in critical, high, medium, and<a id="_idIndexMarker622"/> <span class="No-Break">low categories.</span></p>
			<h3>MicroBurst</h3>
			<p><strong class="bold">MicroBurst</strong> is a collection of Microsoft Azure security<a id="_idIndexMarker623"/> assessment scripts, developed by <span class="No-Break">NetSPI (</span><a href="https://github.com/NetSPI/MicroBurst"><span class="No-Break">https://github.com/NetSPI/MicroBurst</span></a><span class="No-Break">).</span></p>
			<p>It can discover Azure services in your <a id="_idIndexMarker624"/>network, audit weak configurations, and simulate cyber-attacker actions such as <span class="No-Break">credential dumping.</span></p>
			<p>MicroBurst works with Az, AzureAD, and MSOnline PowerShell modules. PowerShell is the CLI that Microsoft uses for administrating both Windows Server <span class="No-Break">and Azure.</span></p>
			<p>MicroBurst uses the Az module to acquire sensitive passwords, keys, certificates, and other sensitive authentication and authorization secrets from App Services, Storage accounts, Cosmos DB, Key Vault, Automation accounts, <span class="No-Break">and AKS.</span></p>
			<h3>AzureAD</h3>
			<p><strong class="bold">AzureAD</strong> is a depreciated PowerShell<a id="_idIndexMarker625"/> module, so well-patched Azure deployments that don’t support legacy systems won’t be using it. But if you’re pentesting an Azure instance with legacy systems (which tend to be extra vulnerable in the first place!), the <a id="_idIndexMarker626"/>AzureAD module will help MicroBurst exploit vulnerabilities that pertain to how Active Directory is implemented in Azure. Insecure Active Directory configurations can lead to dangerous privilege escalation attacks! And they can also lead to attackers acquiring unauthorized access to privileged user accounts. Active Directory is central to how IAM works in Azure and Windows Server, so discovering Active Directory vulnerabilities and mitigating them is <span class="No-Break">extremely important.</span></p>
			<h3>MSOnline</h3>
			<p><strong class="bold">MSOnline</strong> is another depreciated PowerShell <a id="_idIndexMarker627"/>module, so it’s only useful for<a id="_idIndexMarker628"/> Azure networks that support legacy systems with the first outdated version of Azure Active Directory. The MSOnline module enables MicroBurst to support similar IAM-related exploits as in the <span class="No-Break">AzureAD module.</span></p>
			<h3>PowerZure</h3>
			<p><strong class="bold">PowerZure</strong> (<a href="https://github.com/hausec/PowerZure">https://github.com/hausec/PowerZure</a>) is another useful Azure pentesting tool that works with PowerShell, developed <span class="No-Break">by</span><span class="No-Break"><a id="_idIndexMarker629"/></span><span class="No-Break"> hausec.</span></p>
			<p>As with<a id="_idIndexMarker630"/> MicroBurst, PowerZure uses the <strong class="source-inline">az</strong> PowerShell module to scan for Active Directory vulnerabilities in Azure. PowerZure can exploit vulnerabilities for information collection, data extraction, and malicious credential access. Once PowerZure is installed, it can be executed with a few simple commands at <span class="No-Break">the CLI.</span></p>
			<h3>ScoutSuite</h3>
			<p><strong class="bold">ScoutSuite</strong> (<a href="https://github.com/nccgroup/ScoutSuite">https://github.com/nccgroup/ScoutSuite</a>) is a CLI application that’s developed by nccgroup. nccgroup used to <a id="_idIndexMarker631"/>develop Azucar, a “<em class="italic">security auditing tool for Azure environments.</em>” As it no longer maintains Azucar, it recommends using <span class="No-Break">ScoutSuite instead.</span></p>
			<p>ScoutSuite is a multi-cloud<a id="_idIndexMarker632"/> security auditing tool. So, as with Prowler, it can also be used for AWS and GCP. ScoutSuite is also <a id="_idIndexMarker633"/>developing support for Alibaba Cloud and <strong class="bold">Oracle Cloud Infrastructure</strong> (<strong class="bold">OCI</strong>), two cloud platforms that aren’t covered in <span class="No-Break">this book.</span></p>
			<p>ScoutSuite scans APIs for common vulnerabilities, and using the tool can give pentesters a more accurate scope of the external cyber-attack surfaces of their <span class="No-Break">cloud environments.</span></p>
			<h3>Azurite</h3>
			<p><strong class="bold">Azurite</strong> (<a href="https://github.com/FSecureLABS/Azurite">https://github.com/FSecureLABS/Azurite</a>) is developed by FSecureLABS, and it features two components—<em class="italic">Azurite Explorer</em> and <em class="italic">Azurite Visualizer</em>. Azurite is a novel way to use PowerShell for<a id="_idIndexMarker634"/> pentesting Azure. Let’s look at its components in a bit<a id="_idIndexMarker635"/> <span class="No-Break">more detail:</span></p>
			<ul>
				<li><em class="italic">Azurite Explorer</em> can import<a id="_idIndexMarker636"/> PowerShell modules to fingerprint an Azure instance and retrieve sensitive configuration data. That’s bad news and something you need to watch out for and simulate as an Azure pentester. A real cyber attacker can do a lot of harm if they know how your organization’s Azure services and accounts <span class="No-Break">are configured!</span></li>
				<li><em class="italic">Azurite Visualizer</em> takes the<a id="_idIndexMarker637"/> output from Azurite Explorer and generates a visualization of the data. Visualizations can help pentesters and security administrators better<a id="_idIndexMarker638"/> understand the relationships between different<a id="_idIndexMarker639"/> <span class="No-Break">Azure vulnerabilities.</span></li>
			</ul>
			<p>Azurite scans the following <span class="No-Break">Azure components:</span></p>
			<ul>
				<li><span class="No-Break">VNets</span></li>
				<li><span class="No-Break">Subnets</span></li>
				<li><span class="No-Break">VNet gateways</span></li>
				<li>Azure <span class="No-Break">SQL servers</span></li>
				<li>Azure <span class="No-Break">SQL databases</span></li>
				<li><span class="No-Break">Azure websites</span></li>
				<li>Azure <span class="No-Break">key vaults</span></li>
			</ul>
			<h3>Cloud Katana</h3>
			<p><strong class="bold">Cloud Katana</strong> (<a href="https://github.com/Azure/Cloud-Katana">https://github.com/Azure/Cloud-Katana</a>) is an open source tool with development led by Microsoft. Cloud Katana (<a href="https://cloud-katana.com/intro.html">https://cloud-katana.com/intro.html</a>) is used to assess and evaluate the <a id="_idIndexMarker640"/>security tools that customers use in their <a id="_idIndexMarker641"/>Azure networks. It’s a serverless application that’s built on top of <span class="No-Break">Azure Functions.</span></p>
			<h3>SkyArk</h3>
			<p><strong class="bold">SkyArk</strong> (<a href="https://github.com/cyberark/SkyArk">https://github.com/cyberark/SkyArk</a>) is developed by CyberArk and it’s used to discover, assess, and secure the <a id="_idIndexMarker642"/>most privileged entities in Azure. It also<a id="_idIndexMarker643"/> works <span class="No-Break">in AWS.</span></p>
			<p>SkyArk’s AzureStealth module is what’s used to scan <span class="No-Break">Azure environments.</span></p>
			<p>SkyArk’s purpose is simple—discover the most privileged <span class="No-Break">cloud users!</span></p>
			<p>If a cyber attacker can acquire malicious access to a highly privileged Azure account, they can do enormous damage. They can install all sorts of malware in an Azure environment, they can acquire very sensitive data, and they can even make an Azure network completely dysfunctional. Data breaches and ransomware deployment are two of the <a id="_idIndexMarker644"/>major cybersecurity problems that attackers can execute with ease if they have access to an <span class="No-Break">administrative </span><span class="No-Break"><a id="_idIndexMarker645"/></span><span class="No-Break">account!</span></p>
			<p>Cloud shadow admins are a major security risk, and SkyArk will help pentesters and security administrators discover them and protect against vulnerabilities that give attackers privileged and <span class="No-Break">administrative access.</span></p>
			<h3>MFASweep</h3>
			<p><strong class="bold">MFASweep</strong> (<a href="https://github.com/dafthack/MFASweep">https://github.com/dafthack/MFASweep</a>) is a tool developed by dafthack to see whether MFA is enabled in a <a id="_idIndexMarker646"/>variety of Microsoft services, including those used <span class="No-Break">in Azure.</span></p>
			<p>Unlike cloud shadow admins, which are<a id="_idIndexMarker647"/> a very, very bad thing, MFA is a very, very good thing! Hopefully while using MFASweep, you’ll find MFA enabled on all of your organization’s <span class="No-Break">Azure accounts!</span></p>
			<p>Passwords are frequently exposed in data breaches, so the cybersecurity community believes in the consensus that securing accounts with MFA is necessary. A second factor to a password can be a biometric scan (such as with fingerprints and irises) or an OTP sent to a user’s device that expires <span class="No-Break">within minutes.</span></p>
			<p>MFASweep scans the <span class="No-Break">following services:</span></p>
			<ul>
				<li>Microsoft <span class="No-Break">Graph API</span></li>
				<li>Azure Service <span class="No-Break">Management API</span></li>
				<li>Microsoft 365 Exchange <span class="No-Break">Web Services</span></li>
				<li>Microsoft 365 web portal (Windows, Linux, macOS, Android Phone, iPhone, <span class="No-Break">Windows Phone)</span></li>
				<li>Microsoft <span class="No-Break">365 ActiveSync</span></li>
				<li><strong class="bold">Active Directory Federation </strong><span class="No-Break"><strong class="bold">Service</strong></span><span class="No-Break"> (</span><span class="No-Break"><strong class="bold">ADFS</strong></span><span class="No-Break">)</span></li>
			</ul>
			<h3>Azure AD Connect</h3>
			<p>The <strong class="bold">Azure AD Connect</strong> password extraction (<a href="https://github.com/dirkjanm/adconnectdump">https://github.com/dirkjanm/adconnectdump</a>) toolkit is developed by Foxit. It’s exactly what it sounds like. It exploits vulnerabilities in how Active Directory is configured in Azure to extract <a id="_idIndexMarker648"/>passwords. If a real cyber attacker can do<a id="_idIndexMarker649"/> it, your organization’s Azure network has some very dangerous <span class="No-Break">Azure vulnerabilities!</span></p>
			<p>The toolkit can extract highly privileged credentials from Azure <span class="No-Break">Active Directory.</span></p>
			<h3>CloudBrute</h3>
			<p><strong class="bold">CloudBrute</strong> (<a href="https://github.com/0xsha/CloudBrute">https://github.com/0xsha/CloudBrute</a>) is a multi-cloud enumerator tool that’s developed by 0xsha. If your <a id="_idIndexMarker650"/>organization has a public URL for your websites and web applications, it’s very important that sensitive parts of your cloud <a id="_idIndexMarker651"/>networks aren’t exposed to cyber attackers <span class="No-Break">that way.</span></p>
			<p>CloudBrute not only works with Azure and other Microsoft services, but also with AWS, GCP, DigitalOcean, Alibaba, Vultr, <span class="No-Break">and Linode.</span></p>
			<p>CloudBrute will help you find if there are sensitive cloud entities that your organization is exposing through the internet. Exposed services are a major cloud network attack vector! Ideally, no services should be exposed in a way that makes them susceptible to <span class="No-Break">cyber attacks.</span></p>
			<h3>BlobHunter</h3>
			<p><strong class="bold">BlobHunter</strong> (<a href="https://github.com/cyberark/blobhunter">https://github.com/cyberark/blobhunter</a>) is another tool from CyberArk. While CloudBrute looks for <a id="_idIndexMarker652"/>exposed cloud services in general, BlobHunter <a id="_idIndexMarker653"/>looks for Azure Blob Storage containers that are publicly accessible on <span class="No-Break">the internet.</span></p>
			<p>It can find poorly configured containers that can store lots of sensitive data. Find misconfigurations before an attacker gets <span class="No-Break">to them!</span></p>
			<p>As you can see, there’s a wide range of applications in Azure, and also third-party tools for <span class="No-Break">pentesting Azure.</span></p>
			<h1 id="_idParaDest-140"><a id="_idTextAnchor139"/>Summary</h1>
			<p>Microsoft Azure offers a wide variety of SaaS, PaaS, and IaaS applications and services. Your organization will choose which Azure components you use according to your specific <span class="No-Break">business needs.</span></p>
			<p>Microsoft also provides a variety of security controls so that Azure instances can have effective cybersecurity. That includes protecting IAM through Active Directory, preventing exposed services, and protecting highly sensitive cryptographic keys and other kinds of authentication data <span class="No-Break">and components.</span></p>
			<p>Several third parties develop open source Azure pentesting and vulnerability scanning tools that you’ll use as a pentester. Using those tools is an effective way of finding vulnerabilities in Azure environments while avoiding activities that violate Microsoft’s <span class="No-Break">pentesting policies.</span></p>
			<p>In the next chapter, we’ll deploy our own Azure network and run some pentests <span class="No-Break">in it.</span></p>
			<h1 id="_idParaDest-141"><a id="_idTextAnchor140"/>Further reading</h1>
			<p>To learn more on the topics covered in this chapter, you can visit the <span class="No-Break">following links:</span></p>
			<ul>
				<li><em class="italic">A listing of Microsoft Azure </em><span class="No-Break"><em class="italic">services</em></span><span class="No-Break">: </span><a href="https://azure.microsoft.com/en-ca/products/"><span class="No-Break">https://azure.microsoft.com/en-ca/products/</span></a></li>
				<li><em class="italic">Microsoft Azure’s definition of </em><span class="No-Break"><em class="italic">PaaS</em></span><span class="No-Break">: </span><a href="https://azure.microsoft.com/en-ca/resources/cloud-computing-dictionary/what-is-paas"><span class="No-Break">https://azure.microsoft.com/en-ca/resources/cloud-computing-dictionary/what-is-paas</span></a></li>
				<li><em class="italic">Microsoft Azure’s definition of </em><span class="No-Break"><em class="italic">IaaS</em></span><span class="No-Break">: </span><a href="https://azure.microsoft.com/en-ca/resources/cloud-computing-dictionary/what-is-azure/azure-iaas/"><span class="No-Break">https://azure.microsoft.com/en-ca/resources/cloud-computing-dictionary/what-is-azure/azure-iaas/</span></a></li>
				<li><em class="italic">Kyuu-Ji’s collection of Azure pentesting tools on </em><span class="No-Break"><em class="italic">GitHub</em></span><span class="No-Break">: </span><a href="https://github.com/Kyuu-Ji/Awesome-Azure-Pentest"><span class="No-Break">https://github.com/Kyuu-Ji/Awesome-Azure-Pentest</span></a></li>
			</ul>
		</div>
	</body></html>