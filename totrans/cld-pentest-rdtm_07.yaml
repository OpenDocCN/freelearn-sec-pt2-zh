- en: '7'
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Security Features in Azure
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: As a cloud pentester, it’s important for you to understand one of the most popular
    cloud platforms out there—that is, Azure. You’ll probably be pentesting Azure
    networks and applications frequently.
  prefs: []
  type: TYPE_NORMAL
- en: In this chapter, we will first examine some of the most commonly used aspects
    of the Azure ecosystem along with the most popular Azure services, applications,
    and features, and why they’re used. After that, we’ll look into Azure **Software-as-a-Service**
    (**SaaS**), **Infrastructure-as-a-Service** (**IaaS**), and **Platform-as-a-Service**
    (**PaaS**) features. We will conclude the chapter by discussing Microsoft’s own
    Azure security tools and third-party security tools.
  prefs: []
  type: TYPE_NORMAL
- en: 'This chapter covers the following main topics:'
  prefs: []
  type: TYPE_NORMAL
- en: Introduction to Azure
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Frequently used Azure SaaS applications
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Azure IaaS applications
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Azure PaaS applications
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Azure security controls and tools
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Let’s jump right in!
  prefs: []
  type: TYPE_NORMAL
- en: Introduction to Azure
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: At the beginning of the 2000s, Microsoft’s data center infrastructure was smaller
    than their current cloud platform competitors, Amazon and Google. But Microsoft’s
    pockets were comparatively deep. When it launched Xbox Live in 2002 (now known
    as the Xbox network), it had built immense backend infrastructure to support what
    was then the highest-capacity online gaming service ever. From that point on,
    Microsoft steadily expanded its own data center capacity as it got into the network
    services business (MSN doesn’t count) concurrently with its expansion into the
    video game console business.
  prefs: []
  type: TYPE_NORMAL
- en: From what I can tell, building Xbox Live/the Xbox network for the consumer market
    gave Microsoft the experience it needed to start providing network services for
    the enterprise market. Amazon launched AWS as “*Amazon.com Web Services*” in 2002,
    its initiative to provide cloud services to the enterprise. Microsoft probably
    thought, “I’d like a piece of that action.”
  prefs: []
  type: TYPE_NORMAL
- en: It took a few more years of research and development and building more infrastructure.
    But by October 2008, Microsoft was ready to announce “Project Red Dog.”
  prefs: []
  type: TYPE_NORMAL
- en: Project Red Dog
  prefs: []
  type: TYPE_NORMAL
- en: Project Red Dog was Microsoft’s cloud operating system project that was a precursor
    to Azure. There is no “Red Dog” operating system; it evolved into the Azure services
    that are mentioned in this chapter.
  prefs: []
  type: TYPE_NORMAL
- en: By 2010, its new cloud service launched as Windows Azure, and by 2014 it was
    renamed Microsoft Azure.
  prefs: []
  type: TYPE_NORMAL
- en: As with its main competitors Amazon and Google, over the past several years
    Microsoft has been steadily adding new features and services to its cloud platform.
  prefs: []
  type: TYPE_NORMAL
- en: One of Microsoft’s major advantages is the market dominance of its business
    operating systems and applications. Companies that run lots of on-premises computers
    with Windows Server and Active Directory experience great synergy when Azure runs
    its cloud networks and applications. AWS and GCP can work with Windows Server
    and Active Directory, but doing that is like eating Italian food made by French
    people. Windows Server and Microsoft Azure is like eating Italian food made by
    Italian people! So, it makes sense that many organizations choose to integrate
    Azure into their networks, whether their cloud is all Azure or multi-cloud.
  prefs: []
  type: TYPE_NORMAL
- en: 'Before you pentest any Azure network, it’s important to make sure that you’re
    abiding by Microsoft’s *Penetration Testing Rules of Engagement*. Here’s what
    it says on Microsoft’s website ([https://www.microsoft.com/en-us/msrc/pentest-rules-of-engagement](https://www.microsoft.com/en-us/msrc/pentest-rules-of-engagement)):'
  prefs: []
  type: TYPE_NORMAL
- en: “*The goal of this program is to enable customers to test their services hosted
    in Microsoft Cloud services without causing harm to any other* *Microsoft customers.*
  prefs: []
  type: TYPE_NORMAL
- en: '*The following activities* *are prohibited:*'
  prefs: []
  type: TYPE_NORMAL
- en: '*Scanning or testing assets belonging to any other Microsoft* *Cloud customers.*'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '*Gaining access to any data that is not wholly* *your own.*'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '*Performing any kind of denial of* *service testing.*'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '*Performing network intensive fuzzing against any asset except your Azure*
    *Virtual Machine*'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '*Performing* *automated testing of services that generates significant amounts*
    *of traffic.*'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '*Deliberately accessing any other* *customer’s data.*'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '*Moving beyond “proof of concept” repro steps for infrastructure execution
    issues (i.e. proving that you have sysadmin access with SQLi is acceptable, running
    xp_cmdshell* *is not).*'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '*Using our services in a way that violates the Acceptable Use Policy, as set
    forth in the Microsoft Online* *Service Terms.*'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '*Attempting phishing or other social engineering attacks against* *our employees.*'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '*The following activities* *are encouraged:*'
  prefs: []
  type: TYPE_NORMAL
- en: '*Create a small number of test accounts and/or trial tenants for demonstrating
    and proving cross-account or cross-tenant data access. However, it is prohibited
    to use one of these accounts to access the data of another customer* *or account.*'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '*Fuzz, port scan, or run vulnerability assessment tools against your own Azure*
    *Virtual Machines.*'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '*Load testing your application by generating traffic which is expected to be
    seen during the normal course of business. This includes testing* *surge capacity.*'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '*Testing security monitoring and detections (e.g. generating anomalous security
    logs, dropping* *EICAR, etc).*'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '*Attempt to break out of a shared service container such as Azure Websites
    or Azure Functions. However, should you succeed you must both immediately report
    it to Microsoft and cease digging deeper. Deliberately accessing another customer’s
    data is a violation of* *the terms.*'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '*Applying conditional access or mobile application management (MAM) policies
    within Microsoft Intune to test the enforcement of the restriction enforced by*
    *those policies.*'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '*Even with these prohibitions, Microsoft reserves the right to respond to any
    actions on its networks that appear to be malicious. Many automated mitigation
    mechanisms are employed across the Microsoft Cloud. These will not be disabled
    to facilitate a* *penetration test.*”'
  prefs: []
  type: TYPE_NORMAL
- en: In a nutshell, you can pentest in Azure without getting Microsoft’s permission.
    But you’re limited in what you’re allowed to do. You cannot perform activities
    that disrupt other Azure customers, such as **distributed denial-of-service**
    (**DDoS**) attack simulations or stress tests. You may not even attempt to access
    Azure data and assets that don’t belong to the company you work for. Simulating
    criminal infrastructure execution exploits is strictly forbidden. You may load-test
    your company’s own services and applications, but you may not generate more data
    or consume more bandwidth than what would be used for normal operations. Microsoft
    encourages you to create new user accounts to test for IAM problems, as long as
    you don’t try to access any data that doesn’t belong to the company that you work
    for. Of course, you will also need written permission from the company you work
    for to perform any sort of pentest, security test, or red team engagement whatsoever.
  prefs: []
  type: TYPE_NORMAL
- en: Microsoft Azure is a unique cloud platform. But in many ways, it’s similar to
    AWS and GCP. As with AWS, GCP, and many other cloud providers, Azure offers a
    wide range of cloud services that can be categorized according to how much responsibility
    Microsoft has and how much responsibility the customer (the business you work
    for) has. As with other cloud platforms, all Azure services can be categorized
    as either SaaS, PaaS, or IaaS.
  prefs: []
  type: TYPE_NORMAL
- en: No matter whether the service is SaaS, PaaS, or IaaS, organizations are responsible
    for the security of their own data. If a software vulnerability in a customer’s
    own code is exploited in a cyber attack, it’s the customer’s problem to deal with.
    Microsoft offers a lot of very useful security tools that can greatly improve
    an organization’s security posture in Azure, but they have to actually be used
    in order for them to work.
  prefs: []
  type: TYPE_NORMAL
- en: And no matter what, Microsoft is responsible for the security of its Azure infrastructure.
    That’s why no one is allowed to visit any of its data centers without Microsoft’s
    explicit permission and close supervision. That’s also why pentesters are limited
    in what they’re allowed to do when they execute pentesting and red team engagements
    in Azure. Customers are responsible for their security in the cloud; cloud providers
    are responsible for the security of the cloud. A customer’s own code and applications
    are their business; Microsoft’s servers, networking devices, data center buildings,
    and Microsoft’s own code is its business.
  prefs: []
  type: TYPE_NORMAL
- en: '[*Chapter 3*](B18672_03.xhtml#_idTextAnchor050) goes into detail about the
    shared responsibility model of cloud computing. But for the sake of convenience,
    you can review Microsoft’s *Penetration Testing Rules of Engagement* ([https://www.microsoft.com/en-us/msrc/pentest-rules-of-engagement](https://www.microsoft.com/en-us/msrc/pentest-rules-of-engagement))
    and the *Microsoft Online Subscription Agreement* ([https://azure.microsoft.com/en-us/support/legal/subscription-agreement/](https://azure.microsoft.com/en-us/support/legal/subscription-agreement/)).
    It’s of the utmost importance that you understand and abide by Microsoft’s rules
    before you commence any pentesting in Azure. So, review those resources and re-read
    [*Chapter 3*](B18672_03.xhtml#_idTextAnchor050) to make sure you understand what
    you’re permitted to do and what’s forbidden. If the organization you’re working
    for asks you to do something that Microsoft forbids, Microsoft’s authority trumps
    theirs. When you pentest Azure, you’re a guest in Microsoft’s house.'
  prefs: []
  type: TYPE_NORMAL
- en: SaaS, PaaS, and IaaS indicate how much of an Azure service is Microsoft’s and
    how much responsibility and autonomy the company you work for has. In SaaS, a
    lot of the software code belongs to Microsoft. Your company does the least amount
    of work (relative to PaaS and IaaS). Your company’s data is running in Microsoft’s
    online applications. In IaaS, Microsoft is providing its own infrastructure and
    little else. Your organization has the most flexibility and control, but it also
    has to build and maintain almost all of the software code and networking configurations
    that it’s using in Microsoft’s infrastructure. PaaS is in the middle of those
    two extremes. PaaS comes with more Microsoft APIs and service features than IaaS.
    Microsoft is providing an application and services platform, but it’s supporting
    your organization’s own software.
  prefs: []
  type: TYPE_NORMAL
- en: Now, let’s explore the most frequently used Azure services.
  prefs: []
  type: TYPE_NORMAL
- en: Frequently used Azure SaaS applications
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: I’ll summarize the most popular SaaS applications in Azure. It’s unlikely that
    you will be pentesting them because Microsoft has more responsibility for the
    security of its SaaS than for its PaaS and IaaS. Your company just inputs its
    own data into these applications or embeds them in its own applications. But it’s
    important as an Azure pentester to understand the many ways Azure is used so that
    you can contextualize how SaaS fits in with the rest of Azure and how the company
    you work for may be using Azure SaaS applications. Plus, the data your organization
    inputs into Azure’s SaaS applications is your organization’s security responsibility.
    For instance, if someone in your organization puts their sensitive bank account
    information into Microsoft Cost Management outside of the cryptography Microsoft
    has implemented, that’s your organization’s problem. If your organization has
    a PaaS or IaaS application that interfaces with a SaaS application, that data
    flow can likely be pentested from the PaaS or IaaS end.
  prefs: []
  type: TYPE_NORMAL
- en: Azure Maps
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '**Azure Maps** is similar to Google Maps. It offers detailed maps of pretty
    much every built-up part of the world. There are built-in features that use IP
    and GPS geolocation so that users can see where they are on the map and where
    they’re going. Azure Maps can be integrated into the mobile and web applications
    that Azure customers develop. So, for instance, businesses can show a map of the
    physical location of their premises in an embedded Azure Maps applet on their
    web pages. Azure Maps has about 250 different code samples hosted on GitHub ([https://samples.azuremaps.com/](https://samples.azuremaps.com/))
    to make integration easy for developers. There are code samples for everything,
    from animating multiple points on a map to showing different map layers with different
    kinds of geographic and meteorological data to implementing maps of indoor spaces
    with Azure Maps Web Control:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Figure 7.1 – Screenshot of Azure Maps](image/B18672_07_01.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 7.1 – Screenshot of Azure Maps
  prefs: []
  type: TYPE_NORMAL
- en: Azure Maps has multiple data feeds for traffic, weather, photographic imagery,
    and data visualization. For instance, where are the tallest mountain peaks and
    deepest canyons? Which areas get the most precipitation in a given year? Where
    are all of a retailer’s stores located? Azure Maps’s data visualization features
    work with a business customer’s own data.
  prefs: []
  type: TYPE_NORMAL
- en: Azure Digital Twins
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '**Azure Digital Twins** uses a customer’s own IoT devices to create digital
    models of physical objects, business processes, and places. When the IoT devices
    detect changes in a physical environment, Azure Digital Twins can adjust the digital
    models accordingly. It integrates with REST APIs, Azure IoT Hub, Logic Apps, Event
    Hubs, Azure Data Explorer, and Azure Synapse Analytics. It’s kind of weird but
    also kind of cool.'
  prefs: []
  type: TYPE_NORMAL
- en: Azure Monitor
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The two previous applications (Azure Maps and Azure Digital Twins) are more
    specialized. But **Azure Monitor** is a lot more generalized. Azure Monitor can
    be configured so that organizations can see a wide range of business networking
    data through dynamic dashboard interfaces. Metrics, logs, changes, and traces
    are fed into Azure Monitor. Then, administrators can watch a variety of different
    network events, and not all of them are directly related to security events. You
    can also display live data for metrics such as “*How many users are using which
    applications,* *and when?*”
  prefs: []
  type: TYPE_NORMAL
- en: Azure Monitor integrates into every Azure service and application possible.
    You can also implement data from other cloud provider services (multi-cloud environments)
    and on-premises networks through Azure Arc.
  prefs: []
  type: TYPE_NORMAL
- en: Microsoft Cost Management
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '**Microsoft Cost Management** gives Azure customers very detailed information
    about how much they’re spending on their various Azure services, applications,
    and features. There are detailed panels for cost analysis, cost alerts, budgetary
    data, billing charges and usage, and Azure costs related to company departments
    and accounts.'
  prefs: []
  type: TYPE_NORMAL
- en: Graphs can be shown that show trends and patterns in a customer’s spending on
    Azure services. Accountants and **chief financial officers** (**CFOs**) love this
    sort of stuff. It’s not just “*Our company spent $25,657 on Azure this month.*”
    Microsoft Cost Management shows every possible Azure spending metric that can
    be shown on an accountant’s ledger. So, of course, customers can see pie graphs
    that break down overall Azure spending into all the applicable categories.
  prefs: []
  type: TYPE_NORMAL
- en: Azure Advisor
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '**Azure Advisor** is similar to Microsoft Cost Management, but instead of budgetary
    and billing information, it shows a variety of metrics related to security, reliability,
    performance, operational excellence, and cost:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Figure 7.2 – Screenshot of Azure Advisor](image/B18672_07_02.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 7.2 – Screenshot of Azure Advisor
  prefs: []
  type: TYPE_NORMAL
- en: Azure Advisor can be launched through the **Azure command-line interface** (**Azure
    CLI**), the Advisor API, or the Azure portal to show metrics that are relevant
    in context. If an administrator asks “*How can we manage our Azure resources and
    applications more effectively?*”, Azure Advisor will provide the information they
    need in order to make those kinds of decisions.
  prefs: []
  type: TYPE_NORMAL
- en: Network Watcher
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '**Network Watcher** is an overall network performance monitoring and diagnostics
    solution. It shows dashboards with dynamic real-time networking metrics from **virtual
    machines** (**VMs**), **virtual private networks** (**VPNs**), and network traffic
    patterns.'
  prefs: []
  type: TYPE_NORMAL
- en: See how much network bandwidth each part of your organization’s Azure cloud
    uses! View general security metrics, resource security hygiene, security alerts,
    and compliance data through Security Center. Network Watcher can also be used
    to diagnose various connectivity issues.
  prefs: []
  type: TYPE_NORMAL
- en: Now that we have looked at SaaS, let’s get into IaaS. While SaaS gives Microsoft
    the maximum control and security responsibility, IaaS gives most of the control
    and security responsibility to the organization that you work for.
  prefs: []
  type: TYPE_NORMAL
- en: Azure IaaS applications
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Azure IaaS gives your organization just the very basics as far as software code
    is concerned. The vast majority of the code your organization deploys in IaaS
    belongs to your organization and is your organization’s responsibility as far
    as cybersecurity is concerned.
  prefs: []
  type: TYPE_NORMAL
- en: Here are some of the most commonly used IaaS applications in Azure.
  prefs: []
  type: TYPE_NORMAL
- en: Azure Virtual Machines
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '**Azure Virtual Machines** enables your organization to deploy VMs with Windows
    and Linux. You can deploy lots and lots of virtualized Windows and Linux servers
    to do anything and everything Linux and Windows servers do, from running huge
    enterprise applications to deploying web servers and other kinds of internet services.'
  prefs: []
  type: TYPE_NORMAL
- en: Azure Kubernetes Service
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '**Azure Kubernetes Service** (**AKS**) supports Kubernetes containerization
    orchestration in Azure ([https://azure.microsoft.com/en-ca/products/kubernetes-service/](https://azure.microsoft.com/en-ca/products/kubernetes-service/)).'
  prefs: []
  type: TYPE_NORMAL
- en: 'AKS is specially designed for Kubernetes clusters, so it is the best way to
    deploy Kubernetes-based applications in Azure. I was able to deploy Kubernetes
    with AKS in Azure within minutes, whereas deploying Kubernetes in Azure without
    AKS is at least hours of work and a lot of hassle:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Figure 7.3 – Screenshot of AKS](image/B18672_07_03.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 7.3 – Screenshot of AKS
  prefs: []
  type: TYPE_NORMAL
- en: There will be a lot more information about AKS in [*Chapter 9*](B18672_09.xhtml#_idTextAnchor159)!
  prefs: []
  type: TYPE_NORMAL
- en: Azure Container Instances
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '**Azure Container Instances** (**ACI**) empowers Azure customers to develop
    and deploy their own software applications without having to manage VMs or learn
    new tools:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Figure 7.4 – Screenshot of ACI](image/B18672_07_04.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 7.4 – Screenshot of ACI
  prefs: []
  type: TYPE_NORMAL
- en: ACI can work with AKS and Azure Functions (more on that in the immediate next
    section) to support complex applications with lots of containers.
  prefs: []
  type: TYPE_NORMAL
- en: Azure Dedicated Host
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '**Azure Dedicated Host** is a dedicated physical server to host Azure VMs running
    Windows and Linux. Yes—with Azure Dedicated Host, your organization gets its very
    own physical server machine on Microsoft’s premises. That’s a relatively expensive
    option for enterprises that have the budget for it, but it gives them the maximum
    control they can possibly have within the Azure ecosystem:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Figure 7.5 – Screenshot of Azure Dedicated Host](image/B18672_07_05.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 7.5 – Screenshot of Azure Dedicated Host
  prefs: []
  type: TYPE_NORMAL
- en: Now, let’s take a look at PaaS in Azure.
  prefs: []
  type: TYPE_NORMAL
- en: Azure PaaS applications
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Azure PaaS is in between SaaS and IaaS as far as the amount of control and autonomy
    of Azure customers (such as the business organization you work for) is concerned.
  prefs: []
  type: TYPE_NORMAL
- en: In PaaS, Azure provides a platform. Only Azure SaaS provides Azure’s own complete
    applications that customers deploy their data in, whereas Azure IaaS basically
    provides Azure’s server hardware and networking infrastructure with absolutely
    minimal Azure code. The vast majority of the code in an IaaS deployment belongs
    to the customer and is their responsibility.
  prefs: []
  type: TYPE_NORMAL
- en: Here are Azure PaaS services where customers run the applications they develop,
    but within platform systems that Microsoft develops.
  prefs: []
  type: TYPE_NORMAL
- en: Azure SQL Database
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '**Azure SQL Database** enables customers to build applications with SQL databases.
    SQL is one of the top vendor-neutral database development technologies. A wide
    variety of types of applications that need support from backend services use SQL,
    not just mobile apps or web apps.'
  prefs: []
  type: TYPE_NORMAL
- en: Web Apps
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '**Web Apps** is used to host ASP.NET web applications. ASP.NET is a developer
    platform of tools, programming languages, and libraries for building web apps.
    It uses HTML, CSS, JavaScript, Node.js, Python, Java, and C#.'
  prefs: []
  type: TYPE_NORMAL
- en: Mobile Apps
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '**Mobile Apps** is Microsoft Azure’s service for deploying the backend for
    all kinds of apps for iOS and Android. It deploys **single sign-on** (**SSO**)
    authentication with Azure Active Directory. It integrates with Facebook, Twitter,
    and Google APIs. It also enables apps to work offline for extended periods of
    time, although mobile apps should be online periodically for synchronization.'
  prefs: []
  type: TYPE_NORMAL
- en: Azure Logic Apps
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '**Azure Logic Apps** is a very specialized logic application development tool.
    A logic app creates and automates workflows without having to write a lot of code.
    Logic apps can be built with diagrams where events trigger actions.'
  prefs: []
  type: TYPE_NORMAL
- en: Azure Functions
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '**Azure Functions** is a serverless compute platform, which means that Azure
    customers can deploy applications without their having to manage a server. Azure
    Functions is event-driven, which means that if certain defined events occur in
    the applications your organization develops, Azure Functions will respond to those
    events in a way that your organization defines ([https://azure.microsoft.com/en-us/products/functions/](https://azure.microsoft.com/en-us/products/functions/)).'
  prefs: []
  type: TYPE_NORMAL
- en: Now, let’s look at the applications Microsoft provides Azure users with for
    managing cybersecurity.
  prefs: []
  type: TYPE_NORMAL
- en: Azure security controls and tools
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: It’s possible to use Microsoft Azure to deploy cloud networks with excellent
    security. But cybersecurity is everyday work. As a cloud pentester, you’ll be
    deploying pentests, red team engagements, and vulnerability scans that will give
    the organization the vulnerability data it needs to continuously security harden
    its networks and applications. Defensive security specialists need to put your
    security recommendations into practice. They also need to actually use the variety
    of security tools that Microsoft provides for Azure.
  prefs: []
  type: TYPE_NORMAL
- en: Excellent cybersecurity is possible with Azure. But you’ve got to do the work
    and use the tools Microsoft gives you!
  prefs: []
  type: TYPE_NORMAL
- en: Security controls
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Microsoft provides a number of applications to help your organization maintain
    the cybersecurity of its applications and services in Azure. They are also useful
    for pentesters to check, to look for security alerts and vulnerabilities that
    Microsoft’s own security controls can find.
  prefs: []
  type: TYPE_NORMAL
- en: Here are the main security controls that Microsoft provides for securing Azure.
  prefs: []
  type: TYPE_NORMAL
- en: Microsoft Defender for Cloud
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: '**Microsoft Defender for Cloud** is its main unified cloud-native application
    protection platform. If you’re already familiar with Microsoft Defender in Windows,
    Microsoft Defender for Cloud includes a lot of those features and expands upon
    them for functionality that’s required for securing cloud networks.'
  prefs: []
  type: TYPE_NORMAL
- en: Microsoft Defender for Cloud provides visibility into your security posture
    not only in Azure, but also in AWS, GCP, and your organization’s on-premises network.
    It provides antimalware and security monitoring for a variety of services. Administrators
    can see critical risks prioritized with context-aware security. It also provides
    **extended detection and response** (**XDR**) to detect and respond to cyber attacks.
    You can even see real-time data about your network’s regulatory compliance.
  prefs: []
  type: TYPE_NORMAL
- en: If Microsoft Defender for Cloud is running in the services you’re pentesting,
    your organization should see detailed information about the cyber attacks you’re
    simulating!
  prefs: []
  type: TYPE_NORMAL
- en: Microsoft Defender External Attack Surface Management
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: '**Microsoft Defender External Attack Surface Management** (**Defender EASM**)
    builds upon Microsoft Defender’s basic features. Organizations can have unique
    external cyber-attack surfaces. Defender EASM discovers unknown resources so that
    organizations can have full visibility into their security posture.'
  prefs: []
  type: TYPE_NORMAL
- en: Defender EASM works dynamically and in real time, so administrators can be alerted
    to new external-facing resources as they appear.
  prefs: []
  type: TYPE_NORMAL
- en: Note
  prefs: []
  type: TYPE_NORMAL
- en: Shadow IT is a huge problem in many organizations. Shadow IT refers to when
    employees, contractors, and other people internal to an organization use their
    own applications and devices with a company’s network. The problem with shadow
    IT is that the new technologies that insiders introduce to a company’s network
    aren’t managed by their cybersecurity or IT team. So, shadow IT can introduce
    new attack vectors, vulnerabilities, and malware that an organization is often
    completely unaware of. Shadow IT is one of the many kinds of external risks that
    Defender EASM can detect and mitigate.
  prefs: []
  type: TYPE_NORMAL
- en: Azure DDoS Protection
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: '**Azure DDoS Protection** is as it sounds. In a DDoS attack, cyber attackers
    overwhelm your applications and networked services with an overwhelming volume
    of malicious data in order to shut them down. It’s a major attack on the availability
    of data in the CIA triad of cybersecurity. The *distributed* part means that the
    attacker leverages a number of distributed machines in order to execute their
    attacks. The most common method for DDoS attacks is to use a botnet of zombie
    malware-infected computing devices, which can include any combination of PCs,
    servers, phones, tablets, IoT devices, and routers. The attacker controls their
    botnet through their **command and control** (**C2**) server. So, botnets offer
    a lot of computing power that can be used to execute DDoS attacks.'
  prefs: []
  type: TYPE_NORMAL
- en: Azure DDoS Protection uses adaptive **threat intelligence** (**TI**) with **artificial
    intelligence** (**AI**) and DDoS mitigation capacity. The latter feature uses
    Microsoft’s data processing and networking infrastructure to absorb an attacker’s
    large volumes of malicious data before it can harm your organization’s own Azure
    services and applications.
  prefs: []
  type: TYPE_NORMAL
- en: Azure Bastion
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: '**Azure Bastion** makes it possible for organizations to deploy remote access
    to their VMs in a secure way. That’s a common need because these days, businesses
    support more remote workers than ever before. If an employee connects to their
    employer’s Azure-hosted VMs from their home, it should be routed through Azure
    Bastion.'
  prefs: []
  type: TYPE_NORMAL
- en: A direct connection for RDP and SSH (common remote networking internet protocols)
    sessions in the Azure portal can be launched at any time. Your organization’s
    VMs don’t need any additional software to use Azure Bastion. Azure Bastion integrates
    into your firewalls and other security controls. And most importantly, Azure Bastion
    prevents the IP addresses assigned to your VMs from being exposed to the public.
    That makes it much harder for external cyber attackers to access and harm your
    organization’s VMs.
  prefs: []
  type: TYPE_NORMAL
- en: Azure Firewall
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: '**Azure Firewall** is designed to securely manage and limit access to your
    organization’s Azure **Virtual Network** (**VNet**). Traffic can be dynamically
    denied from malicious IP addresses and domains. It uses **Transport Layer Security**
    (**TLS**) to prevent malware transmission through encrypted sessions. Network
    and application firewall rules can be managed throughout all of your organization’s
    virtual networks.'
  prefs: []
  type: TYPE_NORMAL
- en: Azure Firewall also features built-in **Intrusion Detection and Prevention System**
    (**IDPS**) capabilities to generate security incident alerts and output logs and
    block many kinds of attacks in real time. So, it has not only the basic firewall
    functionality of blocking or filtering traffic according to a series of security
    rules, but it also uses **Machine Learning** (**ML**) to improve its functionality
    over time by learning from your organization’s network traffic patterns.
  prefs: []
  type: TYPE_NORMAL
- en: Azure Web Application Firewall
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: '**Azure Web Application Firewall** (**WAF**) is a specialized firewall for
    web applications. **Open Web Application Security Project** (**OWASP**) is an
    organization that maintains web security standards including their Top 10 security
    risks. Azure WAF is specifically designed to mitigate those risks.'
  prefs: []
  type: TYPE_NORMAL
- en: There are a variety of technologies that are particular to web applications
    and web servers, so Azure WAF is designed to work natively in that use case.
  prefs: []
  type: TYPE_NORMAL
- en: Azure Firewall Manager
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: '**Azure Firewall Manager** is listed as its own application. It simply works
    as a configuration and management interface for Azure Firewall. It presents administrators
    with a unified control plane dashboard so that they can see everything that Azure
    Firewall is doing at any given time, and also see their security alerts. Multiple
    Azure Firewall instances can be managed through one Azure Firewall Manager control
    plane. It can also integrate with third-party **Security-as-a-Service** (**SECaaS**)
    applications.'
  prefs: []
  type: TYPE_NORMAL
- en: Microsoft Sentinel
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: '**Microsoft Sentinel** is a **Security Information and Event Management** (**SIEM**)
    system that’s directly integrated into Azure. Your organization may use it if
    they have a **Security Operations** **Center** (**SOC**).'
  prefs: []
  type: TYPE_NORMAL
- en: What does a SOC do?
  prefs: []
  type: TYPE_NORMAL
- en: A SOC is a defensive cybersecurity team and department that watches for security
    events and incidents in real time and responds to them.
  prefs: []
  type: TYPE_NORMAL
- en: A SIEM system analyzes the various network and server logs that are fed into
    the SIEM system and shows the SOC analysts security alerts when it looks like
    a security incident could be occurring, which are generally cyber attacks.
  prefs: []
  type: TYPE_NORMAL
- en: The SOC plays an integral role in **incident response** (**IR**). Their job
    is to mitigate or contain an attack or breach as soon as possible while it’s happening
    to mitigate as much harm as possible.
  prefs: []
  type: TYPE_NORMAL
- en: In layperson’s terms, with Microsoft Sentinel, SOC analysts can view a control
    plane and dashboard that shows through network and application activity that something
    bad is happening. When something really bad appears to be happening, the SOC analysts
    get a notification that says something to the effect of “*Danger, danger!*” Then,
    they can use Microsoft Sentinel to investigate the incident to help stop the bad
    thing from happening.
  prefs: []
  type: TYPE_NORMAL
- en: Key Vault
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: '**Key Vault** stores the various cryptographic keys and secrets that your organization
    uses in Azure. Keys and secrets are used to acquire privileged access to sensitive
    data and applications. It would be super dangerous for any of those keys to fall
    into the wrong hands. So, they’re kept in a metaphorical vault!'
  prefs: []
  type: TYPE_NORMAL
- en: Key Vault ensures that applications have no direct access to keys. Keys can
    both be created by and imported to Key Vault.
  prefs: []
  type: TYPE_NORMAL
- en: As much of your organization’s data in transit and in storage as possible should
    be encrypted. That’s a part of *Cybersecurity 101*. Scrambling plaintext data
    into ciphertext gibberish protects both the confidentiality and integrity components
    of the CIA triad.
  prefs: []
  type: TYPE_NORMAL
- en: Azure has all the tools your organization needs to make sure that all data in
    storage and in transit is strongly encrypted. Key Vault should be used so that
    unauthorized parties and cyber attackers cannot “unlock” any of it.
  prefs: []
  type: TYPE_NORMAL
- en: Microsoft Azure Attestation
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: '**Microsoft Azure Attestation** exists because the Azure clouds organizations
    deploy don’t only implement entities within the Azure ecosystem. Many organizations
    also implement third-party services and applications into their Azure networks.
    Microsoft Azure Attestation verifies the identities and security postures of third-party
    platforms before they’re interacted with.'
  prefs: []
  type: TYPE_NORMAL
- en: Your organization has a lot of different security policies, baselines, and standards.
    Microsoft Azure Attestation will verify if they can be established in third-party
    platforms. If so, Microsoft Azure Attestation can make sure that those security
    policies, baselines, and standards are enforced through them.
  prefs: []
  type: TYPE_NORMAL
- en: Active Directory is what Windows Server uses to manage the security of user
    accounts, user groups, and administrative accounts. **Azure Active Directory**
    extends those sorts of IAM features into Azure.
  prefs: []
  type: TYPE_NORMAL
- en: Controlling what user accounts are allowed to do is a major part of security
    operations, as is making sure those accounts have proper authentication and authorization.
    A control plane provides full visibility of how accounts are being used. Azure
    Active Directory also implements SSO and **multi-factor authentication** (**MFA**)
    systems. MFA is absolutely crucial! MFA often isn’t a default, but it should be.
    Even the best passwords are vulnerable to data breaches and certain kinds of cryptoanalysis
    attacks. Augmenting passwords with additional authentication vectors such as biometrics
    and **one-time password** (**OTP**)/PIN applications greatly improves account
    security.
  prefs: []
  type: TYPE_NORMAL
- en: Azure Information Protection
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: '**Azure Information Protection** (**AIP**) is another generic name for a service
    that explains exactly what it does. It conducts a lot of **Data Loss Prevention**
    (**DLP**) features by classifying data according to sensitivity labels and then
    making sure that data is only shared outside of your organization as it’s permitted
    to do so.'
  prefs: []
  type: TYPE_NORMAL
- en: AIP can protect documents, many other types of files, and email. As cybersecurity
    practitioners, we think about email attachments as a malware vector all the time.
    We’re also aware of how often phishing emails with links to dangerous phishing
    websites are sent and received. But email is also a major vector for breaching
    confidential or sensitive data! AIP helps protect against sensitive data being
    breached by email.
  prefs: []
  type: TYPE_NORMAL
- en: Azure Dedicated HSM
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: '**Azure Dedicated HSM** is a very specialized Azure cybersecurity application.
    **HSM** stands for **hardware security module**. An HSM is a physical computing
    device, often the size of a RAM or graphics card, that protects cryptographic
    keys, performs encryption and decryption for digital signatures, and assures strong
    authentication in additional ways.'
  prefs: []
  type: TYPE_NORMAL
- en: Organizations can use HSM devices with their endpoint and client computers and
    in their on-premises networks. Azure Dedicated HSM is a backend to support those
    HSMs that run in Azure’s cloud platform. Azure Dedicated HSM can be used to manage
    access to HSMs within your organization and also to configure them with your Azure
    services.
  prefs: []
  type: TYPE_NORMAL
- en: VPN Gateway
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: '**VPN Gateway** enables organizations to integrate their own VPN infrastructure
    with their Azure services. A VPN is a way to implement **end-to-end** (**E2E**)
    encryption between two endpoints through a computer network, most often through
    the internet. Enterprises often have their own VPN servers so that they have full
    control over how that technology is used.'
  prefs: []
  type: TYPE_NORMAL
- en: Many organizations mandate that VPNs be used in situations such as people working
    remotely from home and connecting to their employer’s network, and also to protect
    use cases such as employee travel and **Bring-Your-Own-Device** (**BYOD**) policies.
    A good VPN can protect against **man-in-the-middle** (**MITM**) attacks whereby
    a cyber attacker intercepts a network session to breach confidentiality or tamper
    with the integrity of network-transmitted data.
  prefs: []
  type: TYPE_NORMAL
- en: App Configuration
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: '**App Configuration** is for organizations that develop and deploy their own
    apps in Azure. App Configuration enables organizations to unify security configuration
    settings across all of their own Azure apps and app users. That’s especially useful
    for both regulatory compliance and for complying with an organization’s own security
    policies.'
  prefs: []
  type: TYPE_NORMAL
- en: If there’s a critical problem with an app’s configuration, the problem can be
    fixed in real time without having to redeploy the app. Distributed components
    shared between multiple apps can also be troubleshooted and remediated if they
    have security vulnerabilities or misconfigurations.
  prefs: []
  type: TYPE_NORMAL
- en: So, that’s all of the major security controls that Microsoft provides to Azure
    customers so that they can improve the security of their Azure networks, applications,
    and services.
  prefs: []
  type: TYPE_NORMAL
- en: Now, let’s examine some top third-party Azure pentesting and vulnerability scanning
    tools!
  prefs: []
  type: TYPE_NORMAL
- en: Security tools
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: There are a lot of third-party-developed vulnerability assessment and pentesting
    tools for Azure. You’ll probably be using at least a few of these as a pentester!
    In *Chapters 8* and *9*, I’ll walk you through using some of these tools so that
    you can discover Azure cybersecurity vulnerabilities in a way that’s permitted
    by Microsoft’s Azure policies.
  prefs: []
  type: TYPE_NORMAL
- en: Prowler
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: If you’ve read *Chapters 5* and *6* about pentesting AWS, you’re already familiar
    with **Prowler** ([https://github.com/prowler-cloud/prowler](https://github.com/prowler-cloud/prowler)).
    Prowler can also be used to pentest Azure! Prowler can be run from the CLI to
    check for common security misconfigurations and also conduct vulnerability scans
    based on CIS Benchmarks.
  prefs: []
  type: TYPE_NORMAL
- en: As with AWS, when you use Prowler with Azure, you can generate vulnerability
    scanning logs that give you data that you can use directly in your pentesting
    reports, complete with **Common Vulnerability Scoring System** (**CVSS**) vulnerability
    scoring in critical, high, medium, and low categories.
  prefs: []
  type: TYPE_NORMAL
- en: MicroBurst
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: '**MicroBurst** is a collection of Microsoft Azure security assessment scripts,
    developed by NetSPI ([https://github.com/NetSPI/MicroBurst](https://github.com/NetSPI/MicroBurst)).'
  prefs: []
  type: TYPE_NORMAL
- en: It can discover Azure services in your network, audit weak configurations, and
    simulate cyber-attacker actions such as credential dumping.
  prefs: []
  type: TYPE_NORMAL
- en: MicroBurst works with Az, AzureAD, and MSOnline PowerShell modules. PowerShell
    is the CLI that Microsoft uses for administrating both Windows Server and Azure.
  prefs: []
  type: TYPE_NORMAL
- en: MicroBurst uses the Az module to acquire sensitive passwords, keys, certificates,
    and other sensitive authentication and authorization secrets from App Services,
    Storage accounts, Cosmos DB, Key Vault, Automation accounts, and AKS.
  prefs: []
  type: TYPE_NORMAL
- en: AzureAD
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: '**AzureAD** is a depreciated PowerShell module, so well-patched Azure deployments
    that don’t support legacy systems won’t be using it. But if you’re pentesting
    an Azure instance with legacy systems (which tend to be extra vulnerable in the
    first place!), the AzureAD module will help MicroBurst exploit vulnerabilities
    that pertain to how Active Directory is implemented in Azure. Insecure Active
    Directory configurations can lead to dangerous privilege escalation attacks! And
    they can also lead to attackers acquiring unauthorized access to privileged user
    accounts. Active Directory is central to how IAM works in Azure and Windows Server,
    so discovering Active Directory vulnerabilities and mitigating them is extremely
    important.'
  prefs: []
  type: TYPE_NORMAL
- en: MSOnline
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: '**MSOnline** is another depreciated PowerShell module, so it’s only useful
    for Azure networks that support legacy systems with the first outdated version
    of Azure Active Directory. The MSOnline module enables MicroBurst to support similar
    IAM-related exploits as in the AzureAD module.'
  prefs: []
  type: TYPE_NORMAL
- en: PowerZure
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: '**PowerZure** ([https://github.com/hausec/PowerZure](https://github.com/hausec/PowerZure))
    is another useful Azure pentesting tool that works with PowerShell, developed
    by hausec.'
  prefs: []
  type: TYPE_NORMAL
- en: As with MicroBurst, PowerZure uses the **az** PowerShell module to scan for
    Active Directory vulnerabilities in Azure. PowerZure can exploit vulnerabilities
    for information collection, data extraction, and malicious credential access.
    Once PowerZure is installed, it can be executed with a few simple commands at
    the CLI.
  prefs: []
  type: TYPE_NORMAL
- en: ScoutSuite
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: '**ScoutSuite** ([https://github.com/nccgroup/ScoutSuite](https://github.com/nccgroup/ScoutSuite))
    is a CLI application that’s developed by nccgroup. nccgroup used to develop Azucar,
    a “*security auditing tool for Azure environments.*” As it no longer maintains
    Azucar, it recommends using ScoutSuite instead.'
  prefs: []
  type: TYPE_NORMAL
- en: ScoutSuite is a multi-cloud security auditing tool. So, as with Prowler, it
    can also be used for AWS and GCP. ScoutSuite is also developing support for Alibaba
    Cloud and **Oracle Cloud Infrastructure** (**OCI**), two cloud platforms that
    aren’t covered in this book.
  prefs: []
  type: TYPE_NORMAL
- en: ScoutSuite scans APIs for common vulnerabilities, and using the tool can give
    pentesters a more accurate scope of the external cyber-attack surfaces of their
    cloud environments.
  prefs: []
  type: TYPE_NORMAL
- en: Azurite
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: '**Azurite** ([https://github.com/FSecureLABS/Azurite](https://github.com/FSecureLABS/Azurite))
    is developed by FSecureLABS, and it features two components—*Azurite Explorer*
    and *Azurite Visualizer*. Azurite is a novel way to use PowerShell for pentesting
    Azure. Let’s look at its components in a bit more detail:'
  prefs: []
  type: TYPE_NORMAL
- en: '*Azurite Explorer* can import PowerShell modules to fingerprint an Azure instance
    and retrieve sensitive configuration data. That’s bad news and something you need
    to watch out for and simulate as an Azure pentester. A real cyber attacker can
    do a lot of harm if they know how your organization’s Azure services and accounts
    are configured!'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '*Azurite Visualizer* takes the output from Azurite Explorer and generates a
    visualization of the data. Visualizations can help pentesters and security administrators
    better understand the relationships between different Azure vulnerabilities.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Azurite scans the following Azure components:'
  prefs: []
  type: TYPE_NORMAL
- en: VNets
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Subnets
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: VNet gateways
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Azure SQL servers
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Azure SQL databases
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Azure websites
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Azure key vaults
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Cloud Katana
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: '**Cloud Katana** ([https://github.com/Azure/Cloud-Katana](https://github.com/Azure/Cloud-Katana))
    is an open source tool with development led by Microsoft. Cloud Katana ([https://cloud-katana.com/intro.html](https://cloud-katana.com/intro.html))
    is used to assess and evaluate the security tools that customers use in their
    Azure networks. It’s a serverless application that’s built on top of Azure Functions.'
  prefs: []
  type: TYPE_NORMAL
- en: SkyArk
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: '**SkyArk** ([https://github.com/cyberark/SkyArk](https://github.com/cyberark/SkyArk))
    is developed by CyberArk and it’s used to discover, assess, and secure the most
    privileged entities in Azure. It also works in AWS.'
  prefs: []
  type: TYPE_NORMAL
- en: SkyArk’s AzureStealth module is what’s used to scan Azure environments.
  prefs: []
  type: TYPE_NORMAL
- en: SkyArk’s purpose is simple—discover the most privileged cloud users!
  prefs: []
  type: TYPE_NORMAL
- en: If a cyber attacker can acquire malicious access to a highly privileged Azure
    account, they can do enormous damage. They can install all sorts of malware in
    an Azure environment, they can acquire very sensitive data, and they can even
    make an Azure network completely dysfunctional. Data breaches and ransomware deployment
    are two of the major cybersecurity problems that attackers can execute with ease
    if they have access to an administrative account!
  prefs: []
  type: TYPE_NORMAL
- en: Cloud shadow admins are a major security risk, and SkyArk will help pentesters
    and security administrators discover them and protect against vulnerabilities
    that give attackers privileged and administrative access.
  prefs: []
  type: TYPE_NORMAL
- en: MFASweep
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: '**MFASweep** ([https://github.com/dafthack/MFASweep](https://github.com/dafthack/MFASweep))
    is a tool developed by dafthack to see whether MFA is enabled in a variety of
    Microsoft services, including those used in Azure.'
  prefs: []
  type: TYPE_NORMAL
- en: Unlike cloud shadow admins, which are a very, very bad thing, MFA is a very,
    very good thing! Hopefully while using MFASweep, you’ll find MFA enabled on all
    of your organization’s Azure accounts!
  prefs: []
  type: TYPE_NORMAL
- en: Passwords are frequently exposed in data breaches, so the cybersecurity community
    believes in the consensus that securing accounts with MFA is necessary. A second
    factor to a password can be a biometric scan (such as with fingerprints and irises)
    or an OTP sent to a user’s device that expires within minutes.
  prefs: []
  type: TYPE_NORMAL
- en: 'MFASweep scans the following services:'
  prefs: []
  type: TYPE_NORMAL
- en: Microsoft Graph API
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Azure Service Management API
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Microsoft 365 Exchange Web Services
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Microsoft 365 web portal (Windows, Linux, macOS, Android Phone, iPhone, Windows
    Phone)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Microsoft 365 ActiveSync
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Active Directory Federation** **Service** (**ADFS**)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Azure AD Connect
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: The **Azure AD Connect** password extraction ([https://github.com/dirkjanm/adconnectdump](https://github.com/dirkjanm/adconnectdump))
    toolkit is developed by Foxit. It’s exactly what it sounds like. It exploits vulnerabilities
    in how Active Directory is configured in Azure to extract passwords. If a real
    cyber attacker can do it, your organization’s Azure network has some very dangerous
    Azure vulnerabilities!
  prefs: []
  type: TYPE_NORMAL
- en: The toolkit can extract highly privileged credentials from Azure Active Directory.
  prefs: []
  type: TYPE_NORMAL
- en: CloudBrute
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: '**CloudBrute** ([https://github.com/0xsha/CloudBrute](https://github.com/0xsha/CloudBrute))
    is a multi-cloud enumerator tool that’s developed by 0xsha. If your organization
    has a public URL for your websites and web applications, it’s very important that
    sensitive parts of your cloud networks aren’t exposed to cyber attackers that
    way.'
  prefs: []
  type: TYPE_NORMAL
- en: CloudBrute not only works with Azure and other Microsoft services, but also
    with AWS, GCP, DigitalOcean, Alibaba, Vultr, and Linode.
  prefs: []
  type: TYPE_NORMAL
- en: CloudBrute will help you find if there are sensitive cloud entities that your
    organization is exposing through the internet. Exposed services are a major cloud
    network attack vector! Ideally, no services should be exposed in a way that makes
    them susceptible to cyber attacks.
  prefs: []
  type: TYPE_NORMAL
- en: BlobHunter
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: '**BlobHunter** ([https://github.com/cyberark/blobhunter](https://github.com/cyberark/blobhunter))
    is another tool from CyberArk. While CloudBrute looks for exposed cloud services
    in general, BlobHunter looks for Azure Blob Storage containers that are publicly
    accessible on the internet.'
  prefs: []
  type: TYPE_NORMAL
- en: It can find poorly configured containers that can store lots of sensitive data.
    Find misconfigurations before an attacker gets to them!
  prefs: []
  type: TYPE_NORMAL
- en: As you can see, there’s a wide range of applications in Azure, and also third-party
    tools for pentesting Azure.
  prefs: []
  type: TYPE_NORMAL
- en: Summary
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Microsoft Azure offers a wide variety of SaaS, PaaS, and IaaS applications and
    services. Your organization will choose which Azure components you use according
    to your specific business needs.
  prefs: []
  type: TYPE_NORMAL
- en: Microsoft also provides a variety of security controls so that Azure instances
    can have effective cybersecurity. That includes protecting IAM through Active
    Directory, preventing exposed services, and protecting highly sensitive cryptographic
    keys and other kinds of authentication data and components.
  prefs: []
  type: TYPE_NORMAL
- en: Several third parties develop open source Azure pentesting and vulnerability
    scanning tools that you’ll use as a pentester. Using those tools is an effective
    way of finding vulnerabilities in Azure environments while avoiding activities
    that violate Microsoft’s pentesting policies.
  prefs: []
  type: TYPE_NORMAL
- en: In the next chapter, we’ll deploy our own Azure network and run some pentests
    in it.
  prefs: []
  type: TYPE_NORMAL
- en: Further reading
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'To learn more on the topics covered in this chapter, you can visit the following
    links:'
  prefs: []
  type: TYPE_NORMAL
- en: '*A listing of Microsoft Azure* *services*: [https://azure.microsoft.com/en-ca/products/](https://azure.microsoft.com/en-ca/products/)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '*Microsoft Azure’s definition of* *PaaS*: [https://azure.microsoft.com/en-ca/resources/cloud-computing-dictionary/what-is-paas](https://azure.microsoft.com/en-ca/resources/cloud-computing-dictionary/what-is-paas)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '*Microsoft Azure’s definition of* *IaaS*: [https://azure.microsoft.com/en-ca/resources/cloud-computing-dictionary/what-is-azure/azure-iaas/](https://azure.microsoft.com/en-ca/resources/cloud-computing-dictionary/what-is-azure/azure-iaas/)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '*Kyuu-Ji’s collection of Azure pentesting tools on* *GitHub*: [https://github.com/Kyuu-Ji/Awesome-Azure-Pentest](https://github.com/Kyuu-Ji/Awesome-Azure-Pentest)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
