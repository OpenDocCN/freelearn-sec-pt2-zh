<html><head></head><body>
		<div id="_idContainer053">
			<h1 id="_idParaDest-172" class="chapter-number"><a id="_idTextAnchor172"/>10</h1>
			<h1 id="_idParaDest-173"><a id="_idTextAnchor173"/>Security Features in GCP</h1>
			<p>Welcome to <strong class="bold">Google Cloud Platform</strong>, or <strong class="bold">GCP</strong> for short. GCP is the last of the top three most popular cloud platforms<a id="_idIndexMarker807"/> mentioned in this book. A lot of how GCP works is similar to AWS and Azure, but there are definitely some aspects to GCP that are unique and important for pentesters to understand before they pentest in <span class="No-Break">the platform.</span></p>
			<p>First, let’s examine some of the most commonly used aspects of the GCP ecosystem. In this chapter, you’ll learn about the most popular GCP services, applications, and features, and why they’re used. Next, we’ll look into GCP <strong class="bold">Software-as-a-Service</strong> (<strong class="bold">SaaS</strong>), <strong class="bold">Infrastructure-as-a-Service</strong> (<strong class="bold">IaaS</strong>), and <strong class="bold">Platform-as-a-Service</strong> (<strong class="bold">PaaS</strong>) features. We will conclude the chapter by discussing Google’s own GCP security tools and third-party <span class="No-Break">security tools.</span></p>
			<p>Before we pentest GCP, it helps to understand how the company we’re working for may use GCP, and what security features Google provides that can help pentesters understand the security posture of the GCP deployment they’re <span class="No-Break">working with.</span></p>
			<p>This chapter covers the following <span class="No-Break">main topics:</span></p>
			<ul>
				<li>Introduction <span class="No-Break">to GCP</span></li>
				<li>Frequently used GCP <span class="No-Break">SaaS applications</span></li>
				<li>GCP <span class="No-Break">IaaS services</span></li>
				<li>GCP <span class="No-Break">PaaS services</span></li>
				<li>GCP security controls <span class="No-Break">and tools</span></li>
			</ul>
			<p>Let’s get <span class="No-Break">into it!</span></p>
			<h1 id="_idParaDest-174"><a id="_idTextAnchor174"/>Introduction to GCP</h1>
			<p>The first service that Google<a id="_idIndexMarker808"/> launched was its eponymous search engine. That was back in 1998, during a time in which ordinary people were starting to use the internet<a id="_idIndexMarker809"/> in large numbers. The very first server (<a href="http://infolab.stanford.edu/pub/voy/museum/pictures/display/0-4-Google.htm">http://infolab.stanford.edu/pub/voy/museum/pictures/display/0-4-Google.htm</a>) that founders Larry Page and Sergey Brin used for Google featured 10 4 GB HDDs, and their hardware was held in a frame made out of LEGO bricks! Their first server ran on Stanford University’s networking infrastructure <span class="No-Break">and premises.</span></p>
			<p>Google’s first service that was specifically <a id="_idIndexMarker810"/>targeted to business customers was its AdWords advertising<a id="_idIndexMarker811"/> platform, now known as Google Ads (<a href="https://ads.google.com/home/">https://ads.google.com/home/</a>). In the years since, it has launched a handful of services that are still<a id="_idIndexMarker812"/> very popular, such as Gmail, and it has killed a much greater number of <span class="No-Break">services (</span><a href="https://killedbygoogle.com/"><span class="No-Break">https://killedbygoogle.com/</span></a><span class="No-Break">).</span></p>
			<p>One collection of services that should hopefully endure and evolve for many years to come <span class="No-Break">is GCP.</span></p>
			<p>GCP started as simply App Engine back in 2008 (<a href="https://cloudplatform.googleblog.com/2008/04/introducing-google-app-engine-our-new.html">https://cloudplatform.googleblog.com/2008/04/introducing-google-app-engine-our-new.html</a>). That was about two years after Amazon launched<a id="_idIndexMarker813"/> AWS as we now know it. App Engine is a way for businesses and other entities to launch their own web applications within Google’s platform. At the beginning of App Engine’s history, Google limited its use to 10,000 customers. That gave Google the opportunity to fix bugs and gradually expand its infrastructure so that it could be more competitive against Amazon’s AWS and <span class="No-Break">Microsoft Azure.</span></p>
			<p>By November 2011, Google made App Engine an officially supported product, available to anyone or any entity that’s willing to pay for its services and abide by its policies. Google gradually launched more cloud services, and App Engine became one of many products under the <span class="No-Break">GCP banner.</span></p>
			<p>As of 2023, you can get<a id="_idIndexMarker814"/> more disk storage (5 GB of cloud storage) in GCP’s Free Tier (<a href="https://cloud.google.com/free">https://cloud.google.com/free</a>) than the entire capacity of a single HDD in Google’s first server machine (4 GB). We sure have come a long way in 25 years of <span class="No-Break">Google services!</span></p>
			<p>Before you do any pentesting in GCP, it’s important to review Google’s <em class="italic">Google Cloud Platform Acceptable Use Policy</em> to make sure<a id="_idIndexMarker815"/> that we abide by it. This is taken from Google <span class="No-Break">Cloud (</span><a href="https://cloud.google.com/terms/aup?sjid=12831346254261876451-NA"><span class="No-Break">https://cloud.google.com/terms/aup?sjid=12831346254261876451-NA</span></a><span class="No-Break">):</span></p>
			<p><em class="italic">Customer agrees not to, and not to allow third parties to use </em><span class="No-Break"><em class="italic">the Services:</em></span></p>
			<ul>
				<li><em class="italic">to violate, or encourage the violation of, the legal rights </em><span class="No-Break"><em class="italic">of others;</em></span></li>
				<li><em class="italic">to engage in, promote or encourage illegal activity, including child sexual exploitation, child abuse, or terrorism or violence that can cause death, serious harm, or injury to individuals or groups </em><span class="No-Break"><em class="italic">of individuals;</em></span></li>
				<li><em class="italic">for any unlawful, invasive, infringing, defamatory or fraudulent purpose including Non-consensual Explicit Imagery (NCEI), violating intellectual property rights of others, phishing, or creating a </em><span class="No-Break"><em class="italic">pyramid scheme;</em></span></li>
				<li><em class="italic">to distribute viruses, worms, Trojan horses, corrupted files, hoaxes, or other items of a destructive or </em><span class="No-Break"><em class="italic">deceptive nature;</em></span></li>
				<li><em class="italic">to gain unauthorized access to, disrupt, or impair the use of the Services, or the equipment used to provide the Services, by customers, authorized resellers, or other </em><span class="No-Break"><em class="italic">authorized users;</em></span></li>
				<li><em class="italic">to disable, interfere with or circumvent any aspect of the Services, Software, or the equipment used to provide </em><span class="No-Break"><em class="italic">the Services;</em></span></li>
				<li><em class="italic">to generate, distribute, publish or facilitate unsolicited mass email, promotions, advertisements, or other solicitations (“</em><span class="No-Break"><em class="italic">spam”); or</em></span></li>
				<li><em class="italic">to use the Services, or any interfaces provided with the Services, to access any other Google product or service in a manner that violates the terms of service of such other Google product </em><span class="No-Break"><em class="italic">or service.</em></span></li>
			</ul>
			<p>In a nutshell, you can pentest in GCP<a id="_idIndexMarker816"/> without asking Google for permission. But what you’re allowed to do is limited. You absolutely cannot conduct any types of pentests that could disrupt GCP for other GCP customers. That means no DDoS attack simulations, no malware distribution, no attempting access outside of the assets the company you work for owns, and—obviously—no breaking the law. Encouraging illegal activity and distributing malware can also harm people who don’t use GCP. Vulnerability scanning and looking for exposures and unprotected sensitive data within the resources your company owns are permitted in GCP. Just make sure that your company gives<a id="_idIndexMarker817"/> you written legal permission to <span class="No-Break">do that.</span></p>
			<p>Now, let’s explore what GCP has <span class="No-Break">to offer.</span></p>
			<h1 id="_idParaDest-175"><a id="_idTextAnchor175"/>Frequently used GCP SaaS applications</h1>
			<p>There are a large number of applications<a id="_idIndexMarker818"/> and services within the GCP ecosystem. Many of those services are classified as SaaS. That means that Google provides the infrastructure, the platform, and the application that runs in it. As a user or organization, you’re only responsible for the code or data you enter into <span class="No-Break">its applications.</span></p>
			<p>As Google has more responsibility and control over its SaaS services, your ability to pentest those services while abiding by their policies is very limited to nonexistent. Google Support says the <span class="No-Break">following (</span><a href="https://support.google.com/cloud/answer/6262505?hl=en#zippy=%2Cdo-i-need-to-notify-google-that-i-plan-to-do-a-penetration-test-on-my-project"><span class="No-Break">https://support.google.com/cloud/answer/6262505?hl=en#zippy=%2Cdo-i-need-to-notify-google-that-i-plan-to-do-a-penetration-test-on-my-project</span></a><span class="No-Break">):</span></p>
			<p><em class="italic">Do I need to notify Google that I plan to do a penetration test on </em><span class="No-Break"><em class="italic">my project?</em></span></p>
			<p><em class="italic">If you plan to evaluate the security of your Cloud Platform infrastructure with penetration testing, you are not required to contact us. You will have to abide by the Cloud Platform Acceptable Use Policy and Terms of Service, and ensure that your tests only affect your projects (and not other customers’ applications). If a vulnerability is found, please report it via the Vulnerability </em><span class="No-Break"><em class="italic">Reward Program</em></span><span class="No-Break">.</span></p>
			<p>That pertains to infrastructure, not applications. You will have more freedom to pentest and vulnerability scan Google’s PaaS and <span class="No-Break">IaaS services.</span></p>
			<p>Nonetheless, it’s still important for cloud pentesters to understand which SaaS services are available within the GCP ecosystem. Understanding SaaS in GCP will help give you context into how the organization you work for uses GCP as a whole. Organizations will usually use some PaaS or IaaS services in addition to SaaS, and GCP services are able to connect to each other. Plus, sometimes, an organization’s IaaS and PaaS applications interface with GCP’s SaaS applications. If an organization’s data flows from an IaaS or PaaS application to a SaaS application, the security of that data may be able to be pentested from the IaaS or <span class="No-Break">PaaS end.</span></p>
			<p>Here are some of the most commonly used GCP <span class="No-Break">SaaS services.</span></p>
			<h2 id="_idParaDest-176"><a id="_idTextAnchor176"/>Google Workspace</h2>
			<p><strong class="bold">Google Workspace</strong> (<a href="https://workspace.google.com/">https://workspace.google.com/</a>) is more or less Google’s equivalent<a id="_idIndexMarker819"/> to Microsoft 365 for Business. Google Workspace’s defining<a id="_idIndexMarker820"/> feature is that it integrates well-known Google productivity<a id="_idIndexMarker821"/> applications, such as Gmail, Google Calendar, Google Meet, Google Chat, Google Drive, Google Docs, Google Sheets, Google Slides, and <span class="No-Break">Google Forms.</span></p>
			<p>If that all sounds familiar to you, that’s because the collection was previously known as G Suite. Google sure loves to change<a id="_idIndexMarker822"/> its branding every so often! It keeps us on our toes! Businesses, whether or not they subscribe to GCP, get a 14-day free trial if they’re using Google Workspace for the first time. Google Workspace and its components have a much greater usage capacity and enterprise-specific features that aren’t available in the consumer versions of Gmail, Google Docs, and <span class="No-Break">so on.</span></p>
			<h2 id="_idParaDest-177"><a id="_idTextAnchor177"/>Google App Engine</h2>
			<p><strong class="bold">Google App Engine</strong> was mentioned at the beginning<a id="_idIndexMarker823"/> of this chapter, as it was Google’s first cloud services<a id="_idIndexMarker824"/> offering for the enterprise market and the first ever <span class="No-Break">GCP component.</span></p>
			<p>App Engine (<a href="https://cloud.google.com/appengine">https://cloud.google.com/appengine</a>) is a “serverless” way to deploy web applications on Google’s<a id="_idIndexMarker825"/> infrastructure. There is technically a server, but App Engine users aren’t supposed to manage or <span class="No-Break">configure it.</span></p>
			<p>Because App Engine users don’t manage its platform or its infrastructure, it’s by its very definition a SaaS service. App Engine users can build their applications in Node.js, Java, Ruby, C#, Go, Python, and PHP, which are all very commonly used application development technologies. If developers are already well experienced in one or more of those languages in other platforms, learning how to use App Engine should be <span class="No-Break">pretty easy.</span></p>
			<h2 id="_idParaDest-178"><a id="_idTextAnchor178"/>Cost Management</h2>
			<p>AWS and Azure both have applications<a id="_idIndexMarker826"/> that users of their platforms can use to manage<a id="_idIndexMarker827"/> their spending on cloud services in those platforms. Google also offers such an application for <span class="No-Break">GCP—</span><span class="No-Break"><strong class="bold">Cost Management</strong></span><span class="No-Break">.</span></p>
			<p>Cost Management (<a href="https://cloud.google.com/cost-management">https://cloud.google.com/cost-management</a>) doesn’t just say “You spent $364.24 last month.” Rather, it offers<a id="_idIndexMarker828"/> a lot of charts and graphs so that you can make sense of your spending trends on every GCP component that <span class="No-Break">you use.</span></p>
			<p>When I walk you through deploying a GCP environment for pentesting educational purposes in <a href="B18672_11.xhtml#_idTextAnchor197"><span class="No-Break"><em class="italic">Chapter 11</em></span></a>, I strongly recommend checking Cost Management every so often to make sure you won’t be incurring<a id="_idIndexMarker829"/> any surprise charges. Free services can become paid services<a id="_idIndexMarker830"/> if you’re <span class="No-Break">not careful!</span></p>
			<h2 id="_idParaDest-179"><a id="_idTextAnchor179"/>Google Cloud app</h2>
			<p>The <strong class="bold">Google Cloud app</strong> (<a href="https://cloud.google.com/app">https://cloud.google.com/app</a>) can be installed on your iPhone or Android phone<a id="_idIndexMarker831"/> to give you an easy on-the-go way <a id="_idIndexMarker832"/>of checking your GCP services<a id="_idIndexMarker833"/> <span class="No-Break">and network.</span></p>
			<p>A laptop or desktop PC with a physical keyboard is the best interface for doing serious, detailed development and administrative work in your GCP services. But the Google Cloud app can help you understand and discover production issues, manage your resources such as projects, billing, App Engine apps, and Compute Engine VMs, receive and respond to production-related alerts, and make general changes to your <span class="No-Break">GCP deployment.</span></p>
			<p>The Google Cloud app’s features include alerts, error reporting, incident management, a customizable dashboard, billing, and a way to check your use of Compute Engine, Cloud Storage, Cloud SQL, and <span class="No-Break">App Engine.</span></p>
			<h2 id="_idParaDest-180"><a id="_idTextAnchor180"/>Google Marketing Platform</h2>
			<p>Google’s earliest monetization<a id="_idIndexMarker834"/> schemes<a id="_idIndexMarker835"/> were based <a id="_idIndexMarker836"/>on advertising<a id="_idIndexMarker837"/> revenue (Google AdWords, now known as Google Ads), and data-mining services to advertisers. So, Google knows marketing as well as it knows tech. Therefore, <strong class="bold">Google Marketing Platform</strong> can be useful <span class="No-Break">for businesses.</span></p>
			<p>Google Marketing<a id="_idIndexMarker838"/> Platform (<a href="https://marketingplatform.google.com/about/enterprise/">https://marketingplatform.google.com/about/enterprise/</a>) includes Analytics 360 for metrics about how users use your applications, Optimize 360 for testing your applications with marketing needs in mind, Search Ads 360 to better understand the effectiveness of your marketing campaigns, Tag Manager 360 to understand the effectiveness of the tags you use in your marketing, and Campaign Manager 360 to understand the effectiveness of your marketing efforts <span class="No-Break">per campaign.</span></p>
			<p>Now, let’s get into IaaS. Those are the kinds<a id="_idIndexMarker839"/> of cloud services that give companies<a id="_idIndexMarker840"/> the most control, while also delegating them the most responsibility in operating their services and keeping <span class="No-Break">them secure.</span></p>
			<h1 id="_idParaDest-181"><a id="_idTextAnchor181"/>GCP IaaS services</h1>
			<p>With GCP IaaS services, you get maximum<a id="_idIndexMarker841"/> control, but you also have maximum responsibility. Google provides its networking infrastructure and the hardware and tools for <span class="No-Break">deploying VMs.</span></p>
			<p>The main difference between using IaaS services and deploying an on-premises cloud network is that the organization you work for won’t have physical access to the infrastructure. No one in the organization you work for will be allowed to touch the physical power button on any of the computers in the GCP data centers. You aren’t even allowed to physically enter those <span class="No-Break">data centers.</span></p>
			<p>But you have a lot more freedom to conduct penetration testing activities in IaaS services. You should still make sure that you abide by the <em class="italic">Google Cloud Platform Acceptable Use Policy</em>. But don’t fret, because all of the pentesting tutorials that I give in <a href="B18672_11.xhtml#_idTextAnchor197"><span class="No-Break"><em class="italic">Chapter 11</em></span></a> and <a href="B18672_12.xhtml#_idTextAnchor215"><span class="No-Break"><em class="italic">Chapter 12</em></span></a> are <span class="No-Break">policy compliant!</span></p>
			<p>Here are the GCP components that give your organization Google’s infrastructure and let your organization do the rest. (These services can sometimes also be combined with other services for PaaS and <span class="No-Break">SaaS offerings.)</span></p>
			<h2 id="_idParaDest-182"><a id="_idTextAnchor182"/>Compute Engine</h2>
			<p><strong class="bold">Compute Engine</strong> (<a href="https://cloud.google.com/compute">https://cloud.google.com/compute</a>) is the GCP component that<a id="_idIndexMarker842"/> lets your organization<a id="_idIndexMarker843"/> run its VMs on Google’s infrastructure. Compute Engine<a id="_idIndexMarker844"/> is what it sounds like. It handles computer processing. Compute Engine also drives many GCP PaaS and SaaS services. But if you’re just using Compute Engine and Cloud Storage as is, then what you have is an <span class="No-Break">IaaS solution.</span></p>
			<p>Compute Engine is very useful for a wide range of cloud network application use cases because Google has way more hardware in their GCP data centers than most companies could ever have. Compute Engine<a id="_idIndexMarker845"/> is especially used for lots of DevOps and <strong class="bold">Continuous Integration/Continuous Deployment</strong> (<strong class="bold">CI/CD</strong>) needs. But you can also just deploy <a id="_idIndexMarker846"/>simple VMs in <span class="No-Break">Compute Engine.</span></p>
			<h2 id="_idParaDest-183"><a id="_idTextAnchor183"/>Cloud Storage</h2>
			<p>While Compute Engine<a id="_idIndexMarker847"/> basically serves the CPU function, <strong class="bold">Cloud Storage</strong> (<a href="https://cloud.google.com/storage">https://cloud.google.com/storage</a>) serves the disk function. A lot of SaaS<a id="_idIndexMarker848"/> and PaaS solutions also use Cloud Storage, but Cloud Storage<a id="_idIndexMarker849"/> can also be used as is for <span class="No-Break">IaaS setups.</span></p>
			<p>Google says that with Cloud Storage, you can store any amount of data and retrieve it as often as you’d like. That’s a bold statement, but Google has the infrastructure to store petabytes worth of your data if you’d like. Just not for free—it’ll cost you! When we deploy a GCP network for educational purposes in the next chapter, I’ll get 5 GB for free. That’s enough for my temporary<a id="_idIndexMarker850"/> <span class="No-Break">testing needs.</span></p>
			<h2 id="_idParaDest-184"><a id="_idTextAnchor184"/>Shielded VMs</h2>
			<p>If your organization<a id="_idIndexMarker851"/> deals with extra-sensitive<a id="_idIndexMarker852"/> data, such as—for instance—if you were in healthcare, law, or the public sector, Shielded VMs may be what’s best suited for your cloud security and regulatory <span class="No-Break">compliance needs.</span></p>
			<p><strong class="bold">Shielded VMs</strong> (<a href="https://cloud.google.com/shielded-vm">https://cloud.google.com/shielded-vm</a>) are specially configured to implement security <a id="_idIndexMarker853"/>controls that protect against bootkits and rootkits. Rootkits are malware that grants attackers malicious root (administrative) access, whereas bootkits are persistent malware that executes upon the operating system <span class="No-Break">boot process.</span></p>
			<p>Shielded VMs run<a id="_idIndexMarker854"/> off of specialized hardware that uses special <strong class="bold">Unified Extensible Firmware Interface</strong> (<strong class="bold">UEFI</strong>) firmware (the firmware that’s used to boot a physical machine before it boots the operating system or hypervisor), a virtual trusted platform module, and <span class="No-Break">integrity monitoring.</span></p>
			<p>It’s possible to run VMs in GCP’s standard Compute Engine configurations in a way that’s very secure and regulatory compliant, but Shielded VMs go a step further with their specialized hardware and other features. Organizations will often spend a bit more on Shielded VMs if their security needs are extra high<a id="_idIndexMarker855"/> and they have the budget for it. You will get in trouble for trying<a id="_idIndexMarker856"/> to pentest the extra security controls in Shielded VMs, so don’t even <span class="No-Break">consider it!</span></p>
			<h2 id="_idParaDest-185"><a id="_idTextAnchor185"/>Sole-tenant nodes</h2>
			<p><strong class="bold">Sole-tenant nodes</strong> are another possibly very expensive IaaS<a id="_idIndexMarker857"/> option to deploy extra sensitive applications<a id="_idIndexMarker858"/> on <span class="No-Break">Google’s infrastructure.</span></p>
			<p>Cloud platforms such as GCP can be used to deploy public clouds and private clouds. The majority of GCP users implement public cloud services, which simply means that our applications are running on hardware that’s also used for other GCP customers. Every time I walk you through deploying a cloud network for educational purposes in this book, we’re using public <span class="No-Break">cloud services.</span></p>
			<p>Private clouds can be hosted on a company’s own premises, but GCP and other cloud platforms also offer machines that can be dedicated to one customer only. By customer, I mean a person or company that subscribes to cloud services to host their own applications, not to a customer’s customers, if that makes any sense. I as a hypothetical GCP customer can pay for GCP services to host my shoe store e-commerce website. My customers who buy shoes from my GCP-hosted site aren’t GCP customers in that sense; I’m the GCP <span class="No-Break">customer. Whew!</span></p>
			<p>Anyway, what GCP<a id="_idIndexMarker859"/> calls sole-tenant nodes (<a href="https://cloud.google.com/compute/docs/nodes/sole-tenant-nodes">https://cloud.google.com/compute/docs/nodes/sole-tenant-nodes</a>) are another way to deploy private cloud services in GCP’s ecosystem. Some industries and companies are required to use private cloud services only, for the sake of regulatory compliance. So, they may pay Google the big bucks to make sure their machines aren’t shared with other <span class="No-Break">GCP customers.</span></p>
			<p>So, those are GCP services<a id="_idIndexMarker860"/> that can be used for IaaS deployments. Now, it’s time <span class="No-Break">for PaaS.</span></p>
			<h1 id="_idParaDest-186"><a id="_idTextAnchor186"/>GCP PaaS services</h1>
			<p>PaaS is the space between SaaS<a id="_idIndexMarker861"/> and IaaS. SaaS means you’re basically just running your code, commands, documents, or media in Google’s applications, on Google’s platform, and on Google’s infrastructure. IaaS means Google is letting you use its hardware, but you’re responsible for providing your own platforms and applications. PaaS means Google is offering you a platform you can run your own <span class="No-Break">applications in.</span></p>
			<p>PaaS is not quite as much responsibility and work as deploying with IaaS, but it’s still more work than SaaS. Here are some services in GCP that provide customers with Google’s platforms to support a customer’s own <span class="No-Break">custom applications.</span></p>
			<h2 id="_idParaDest-187"><a id="_idTextAnchor187"/>Cloud SDK</h2>
			<p><strong class="bold">Cloud SDK</strong> (<a href="https://cloud.google.com/sdk">https://cloud.google.com/sdk</a>) is a standard development<a id="_idIndexMarker862"/> kit for developers. It includes<a id="_idIndexMarker863"/> client libraries<a id="_idIndexMarker864"/> for Java, Python, Node.js, Ruby, Go, .NET, C++, PHP, and <strong class="bold">Advanced Business Application Programming</strong> (<strong class="bold">ABAP</strong>). It has special tools that can be integrated into the Google<a id="_idIndexMarker865"/> <span class="No-Break">Cloud CLI.</span></p>
			<p>In a nutshell, Cloud SDK is a collection of tools so that a developer can make their own custom applications that use various technologies in <span class="No-Break">GCP’s ecosystem.</span></p>
			<h2 id="_idParaDest-188"><a id="_idTextAnchor188"/>Cloud SQL</h2>
			<p><strong class="bold">Cloud SQL</strong> is for hosting <strong class="bold">Structured Query Language</strong> (<strong class="bold">SQL</strong>) databases on GCP. The vast majority<a id="_idIndexMarker866"/> of backend-driven<a id="_idIndexMarker867"/> applications, web-based or otherwise, require at least one database of some sort. And the vast majority of databases these days use some type <span class="No-Break">of SQL.</span></p>
			<p>Cloud SQL (<a href="https://cloud.google.com/sql">https://cloud.google.com/sql</a>) is a managed relational<a id="_idIndexMarker868"/> database service for MySQL, PostgreSQL, and SQL Server. It takes away a lot of the hassle of deploying SQL servers. Cloud SQL streamlines the SQL server deployment and <span class="No-Break">management processes.</span></p>
			<h2 id="_idParaDest-189"><a id="_idTextAnchor189"/>Cloud Run</h2>
			<p><strong class="bold">Cloud Run</strong> (<a href="https://cloud.google.com/run">https://cloud.google.com/run</a>) makes deploying containerized<a id="_idIndexMarker869"/> applications<a id="_idIndexMarker870"/> easier. Cloud Run<a id="_idIndexMarker871"/> can use Docker images if you want. (<strong class="bold">Google Kubernetes Engine</strong> (<strong class="bold">GKE</strong>) might be an even better option<a id="_idIndexMarker872"/> for Kubernetes <span class="No-Break">deployments, though.)</span></p>
			<p>Cloud Run supports Go, Python, Java, Node.js, .NET, Ruby, and many other popular application development <span class="No-Break">programming languages.</span></p>
			<h2 id="_idParaDest-190"><a id="_idTextAnchor190"/>GKE</h2>
			<p>So, that segues nicely<a id="_idIndexMarker873"/> <span class="No-Break">into GKE.</span></p>
			<p>Kubernetes is a containerization<a id="_idIndexMarker874"/> orchestration platform that builds upon Docker’s core features. Kubernetes is open source and uses many open standards, but it was initially developed by a team at Google, including Joe Beda, Brendan Burns, and Craig McLuckie. So, although one can definitely deploy Kubernetes in AWS and Azure with native support, one might argue<a id="_idIndexMarker875"/> that GCP is Kubernetes’ true home. GKE (<a href="https://cloud.google.com/kubernetes-engine">https://cloud.google.com/kubernetes-engine</a>) is the most convenient way to deploy Kubernetes <span class="No-Break">in GCP.</span></p>
			<h2 id="_idParaDest-191"><a id="_idTextAnchor191"/>Anthos</h2>
			<p><strong class="bold">Anthos</strong> (<a href="https://cloud.google.com/anthos">https://cloud.google.com/anthos</a>) is designed to help organizations<a id="_idIndexMarker876"/> deploy multi-cloud<a id="_idIndexMarker877"/> and <span class="No-Break">hybrid-cloud</span><span class="No-Break"><a id="_idIndexMarker878"/></span><span class="No-Break"> networks.</span></p>
			<p>As explained in the first two chapters of this book, hybrid clouds are when a company has services on a cloud platform and servers on its own premises, and the two aspects are integrated with each other. Multi-cloud is when organizations use more than one cloud provider, and their cloud services from multiple providers are integrated with <span class="No-Break">each other.</span></p>
			<p>So, an organization could have GCP services and some servers on their own premises, and that’s a hybrid cloud. They could have services on AWS, Azure, and GCP, and that’s multi-cloud. They could also have servers on their own premises and services in AWS, Azure, and GCP. That’s both a hybrid cloud and multi-cloud. That’s a <span class="No-Break">hybrid multi-cloud!</span></p>
			<p>Anthos makes<a id="_idIndexMarker879"/> managing all of those different kinds<a id="_idIndexMarker880"/> of cloud <span class="No-Break">configurations easier.</span></p>
			<p>Next, let’s look into some important GCP security controls <span class="No-Break">and applications.</span></p>
			<h1 id="_idParaDest-192"><a id="_idTextAnchor192"/>GCP security controls and tools</h1>
			<p>Let’s get into the applications and features Google makes available to GCP customers for the sake of improving their security. Your organization really ought to be using them! Then, we’ll get into some useful third-party <span class="No-Break">security tools.</span></p>
			<h2 id="_idParaDest-193"><a id="_idTextAnchor193"/>Security controls</h2>
			<p>Google provides a lot of useful applications<a id="_idIndexMarker881"/> that can help us manage our security posture in GCP. Let’s have a look <span class="No-Break">at them.</span></p>
			<h3>Identity and Access Management</h3>
			<p><strong class="bold">Identity and Access Management</strong> (<strong class="bold">IAM</strong>) (<a href="https://cloud.google.com/iam">https://cloud.google.com/iam</a>) is one of the crucial cloud security<a id="_idIndexMarker882"/> components, and GCP<a id="_idIndexMarker883"/> is <span class="No-Break">no exception.</span></p>
			<p>Users and groups of users<a id="_idIndexMarker884"/> are granted certain permissions and rights regarding what they’re allowed to do with your organization’s files, applications, and other sorts<a id="_idIndexMarker885"/> of cloud resources. Your organization should implement the <strong class="bold">Principle of Least Privilege</strong> (<strong class="bold">PoLP</strong>), so users and groups only have as much access as they need to perform their jobs, and <span class="No-Break">no more.</span></p>
			<p>IAM works with Cloud Identity to sync<a id="_idIndexMarker886"/> user accounts between applications and projects. <strong class="bold">Two-Factor Authentication</strong> (<strong class="bold">2FA</strong>) can be set up directly from the Google Admin console. That’s really useful because cloud security benchmarks and some data regulations require users to have more than just their password <span class="No-Break">for authentication.</span></p>
			<p>Requiring 2FA (or <strong class="bold">multi-factor authentication</strong>, <strong class="bold">MFA</strong>) isn’t just some silly rule to annoy administrators<a id="_idIndexMarker887"/> and users. Passwords are considered to be a weak method of authentication, as they’re often breached or cracked. Adding another factor of authentication can be as simple as a user installing Google Authenticator on their phone, and entering an OTP from that application when they’re logging in to their company’s <span class="No-Break">GCP services.</span></p>
			<p>IAM also features robust and detailed user account logging. Each and every user must be accountable for their actions, and IAM makes it possible for administrators to see who’s done what. These logs<a id="_idIndexMarker888"/> can also be fed into other security tools, such as an <strong class="bold">Intrusion Detection </strong><span class="No-Break"><strong class="bold">System</strong></span><span class="No-Break"> (</span><span class="No-Break"><strong class="bold">IDS</strong></span><span class="No-Break">).</span></p>
			<h3>Cloud IDS</h3>
			<p>Speaking<a id="_idIndexMarker889"/> of IDS, there’s <strong class="bold">Cloud IDS</strong>, GCP’s <span class="No-Break">native</span><span class="No-Break"><a id="_idIndexMarker890"/></span><span class="No-Break"> IDS.</span></p>
			<p>When Cloud IDS (<a href="https://cloud.google.com/intrusion-detection-system">https://cloud.google.com/intrusion-detection-system</a>) is used properly, it can detect<a id="_idIndexMarker891"/> many kinds of malware attacks and cyber attacks that are executed from <strong class="bold">Command and Control</strong> (<span class="No-Break"><strong class="bold">C2</strong></span><span class="No-Break">) servers.</span></p>
			<p>Cloud IDS can monitor both east-west traffic and north-south traffic within your GCP deployment. East-west traffic is between different services and machines inside of your cloud network, whereas north-south traffic is between your cloud network and the public internet and other external networks. Cyber attacks can travel between east and west and north <span class="No-Break">and south!</span></p>
			<p>Cloud IDS can generate alerts for administrators so that they can mitigate cyber attacks as <span class="No-Break">they’re happening.</span></p>
			<p>Data produced by Cloud IDS<a id="_idIndexMarker892"/> can also be used for investigating cyber incidents in the wake of <span class="No-Break">their occurrence.</span></p>
			<h3>Cloud Firewall</h3>
			<p><strong class="bold">Cloud Firewall</strong> can be configured to filter <a id="_idIndexMarker893"/>or restrict certain kinds<a id="_idIndexMarker894"/> of traffic or network activities within your <span class="No-Break">cloud network.</span></p>
			<p>Google<a id="_idIndexMarker895"/> says that Cloud Firewall (<a href="https://cloud.google.com/firewall">https://cloud.google.com/firewall</a>) can provide “<em class="italic">granular control, including micro-segmentation without network re-architecting.</em>” That’s a lot of fancy computer networking language that I’ll be happy to translate into plain English—Cloud Firewall lets administrators control really small activities and the smaller components of larger activities, including the ability to divide a network into even smaller administrative sections without the organization’s network having to be completely changed in how it’s <span class="No-Break">set up.</span></p>
			<p>There are so many ways<a id="_idIndexMarker896"/> that firewalls can regulate traffic, including<a id="_idIndexMarker897"/> Cloud Firewall. Traffic can be managed according to its TCP/IP ports, IP addresses, domain<a id="_idIndexMarker898"/> names, and user accounts. Cloud Firewall can use <strong class="bold">Threat Intelligence</strong> (<strong class="bold">TI</strong>) from third parties to determine IP addresses, domain names, and users <span class="No-Break">to block.</span></p>
			<h3>Secret Manager</h3>
			<p><strong class="bold">Secret Manager</strong> (<a href="https://cloud.google.com/secret-manager">https://cloud.google.com/secret-manager</a>) offers GCP customers a secure<a id="_idIndexMarker899"/> way to manage<a id="_idIndexMarker900"/> their secrets. These aren’t secrets<a id="_idIndexMarker901"/> such as “I used a calculator when I wasn’t allowed to in math class when I was a kid.” Rather, Secret Manager protects secrets such as passwords, cryptography certificates, API keys (they let applications communicate with other applications), and other sorts of sensitive <span class="No-Break">authentication data.</span></p>
			<p>So when you set up TLS certificates for a web server or a user creates a password for their account through IAM, they are stored in Secret Manager. Think of it as a massive bank vault with a thick bulletproof door, and all of your keys are inside. Protecting those keys is absolutely necessary so that cyber criminals and other malicious entities can’t do bad things to your GCP<a id="_idIndexMarker902"/> applications <span class="No-Break">and data.</span></p>
			<h3>Cloud DLP</h3>
			<p><strong class="bold">Cloud DLP</strong> (short for <strong class="bold">Data Loss Prevention</strong>) (<a href="https://cloud.google.com/dlp">https://cloud.google.com/dlp</a>) helps to make sure<a id="_idIndexMarker903"/> that your important data within GCP isn’t lost! Yes—its name is descriptive<a id="_idIndexMarker904"/> of its function, but obviously, the technology<a id="_idIndexMarker905"/> it uses takes a bit more effort <span class="No-Break">to describe.</span></p>
			<p>Cloud DLP can use masking and tokenization<a id="_idIndexMarker906"/> to obfuscate your data. So, for instance, if a credit card number going through the <strong class="bold">Point-of-Sale</strong> (<strong class="bold">POS</strong>) system of your e-commerce application is <strong class="source-inline">G2F69</strong> Cloud DLP may disguise it as <strong class="source-inline">B7K31</strong> (No real credit card numbers use that format; I’m being <span class="No-Break">extra safe!)</span></p>
			<p>Cloud DLP can also show security administrators that bit of data went through here, then over there, then out through that other<a id="_idIndexMarker907"/> component even further over there. Except, of course, it wouldn’t be that vague. Cloud DLP can also track data as it leaves your cloud and prevent sensitive<a id="_idIndexMarker908"/> data that’s not supposed to leave your cloud from <span class="No-Break">doing so.</span></p>
			<h3>Security Command Center</h3>
			<p><strong class="bold">Security Command Center</strong> (<a href="https://cloud.google.com/security-command-center">https://cloud.google.com/security-command-center</a>) is a unified interface that<a id="_idIndexMarker909"/> combines those GCP security<a id="_idIndexMarker910"/> controls and other GCP security<a id="_idIndexMarker911"/> controls <span class="No-Break">as well.</span></p>
			<p>Theoretically, you could have an IAM panel on one monitor, acting separately from a Cloud Firewall panel displaying on <span class="No-Break">another monitor.</span></p>
			<p>However, it helps security administrators immensely when all of these security applications are integrated with each other. It helps so much to defend against cyber attacks when administrators can see how one security component is working with another, or how a cyber attack is trying to do one type of bad thing, and <span class="No-Break">then another.</span></p>
			<p>Security Command Center makes it possible to identify security misconfigurations and many kinds of security vulnerabilities so that they can be addressed as quickly and effectively <span class="No-Break">as possible.</span></p>
			<p>In addition to helping administrators detect cyber threats, Security Command Center can also be set up to help a company make sure they’re being compliant with data security regulations that apply <span class="No-Break">to them.</span></p>
			<p>Now, onto the third-party stuff that you can use when you’re vulnerability scanning and pentesting <span class="No-Break">in GCP.</span></p>
			<h2 id="_idParaDest-194"><a id="_idTextAnchor194"/>Security tools</h2>
			<p>Many very talented pentesters have developed<a id="_idIndexMarker912"/> third-party pentesting and security testing tools that are designed to be used in GCP. All the tools mentioned here are open source and available through GitHub. In this section, you’ll find the GCP pentesting tools that I’ve found to be the <span class="No-Break">most useful.</span></p>
			<h3>GCPBucketBrute</h3>
			<p><strong class="bold">GCPBucketBrute</strong> (<a href="https://github.com/RhinoSecurityLabs/GCPBucketBrute">https://github.com/RhinoSecurityLabs/GCPBucketBrute</a>) is developed by Rhino Security Labs. You may have noticed<a id="_idIndexMarker913"/> so far in this book that Rhino Security Labs also develops some of the other pentesting tools that I’ve mentioned, such as Pacu <span class="No-Break">and CloudScraper.</span></p>
			<p>GCPBucketBrute is a script to enumerate Google Storage buckets, see which components and entities have access to them, and whether or not they can be privilege escalated. It’s very dangerous if cybercriminals have access to your organization’s buckets, especially if they can privilege escalate to do whatever they want. So, it’s a good idea for pentesters to run this tool to find these vulnerabilities and attack paths before the bad guys <span class="No-Break">find them.</span></p>
			<p>According to the README file (<a href="https://github.com/RhinoSecurityLabs/GCPBucketBrute/blob/master/README.md">https://github.com/RhinoSecurityLabs/GCPBucketBrute/blob/master/README.md</a>), these are the steps that the script takes to find <span class="No-Break">security problems:</span></p>
			<ol>
				<li><em class="italic">Given a keyword, this script enumerates Google Storage buckets based on a number of permutations generated from </em><span class="No-Break"><em class="italic">the keyword.</em></span></li>
				<li><em class="italic">Then, any discovered bucket will </em><span class="No-Break"><em class="italic">be output.</em></span></li>
				<li><em class="italic">Then, any permissions that you are granted (if any) to any discovered bucket will </em><span class="No-Break"><em class="italic">be output.</em></span></li>
				<li><em class="italic">Then the script will check those privileges for privilege escalation (storage.buckets.setIamPolicy) and will output anything interesting (such as publicly listable, publicly writable, authenticated listable, privilege </em><span class="No-Break"><em class="italic">escalation, etc).</em></span></li>
			</ol>
			<h3>Scout Suite</h3>
			<p>I’ve mentioned<a id="_idIndexMarker914"/> nccgroup’s Scout Suite (<a href="https://github.com/nccgroup/ScoutSuite">https://github.com/nccgroup/ScoutSuite</a>) before. It also<a id="_idIndexMarker915"/> works great with GCP, so I’ll mention it again. As the <span class="No-Break">README says:</span></p>
			<p>“<em class="italic">ScoutSuite is an open source multi-cloud security-auditing tool, which enables security posture assessment of cloud environments. Using the APIs exposed by cloud providers, Scout Suite gathers configuration data for manual inspection and highlights risk areas. Rather than going through dozens of pages on the web consoles, Scout Suite presents a clear view of the attack </em><span class="No-Break"><em class="italic">surface automatically.</em></span><span class="No-Break">”</span></p>
			<p>As with many of the tools that I mentioned, you can run ScoutSuite directly from the CLI that you use on each<a id="_idIndexMarker916"/> <span class="No-Break">cloud platform.</span></p>
			<h3>Hayat</h3>
			<p><strong class="bold">Hayat</strong> (<a href="https://github.com/DenizParlak/hayat">https://github.com/DenizParlak/hayat</a>) was developed by Deniz<a id="_idIndexMarker917"/> Parlak. Hayat means “life” in Turkish, and the developer<a id="_idIndexMarker918"/> also named his script after his niece. <span class="No-Break">How sweet!</span></p>
			<p>Hayat is a script that can audit Cloud SQL instances, IAM, Cloud Storage, networking configurations, VMs, logging and monitoring systems, and <span class="No-Break">Kubernetes clusters.</span></p>
			<p>Parlak says that’s it <em class="italic">for now</em>, which seems to imply that more features will be added in the future. I <span class="No-Break">can’t wait!</span></p>
			<h3>gcp_firewall_enum</h3>
			<p>Chris Moberly’s <strong class="bold">gcp_firewall_enum</strong> (<a href="https://gitlab.com/gitlab-com/gl-security/threatmanagement/redteam/redteam-public/gcp_firewall_enum">https://gitlab.com/gitlab-com/gl-security/threatmanagement/redteam/redteam-public/gcp_firewall_enum</a>) parses your GCP data output to enumerate<a id="_idIndexMarker919"/> compute instances that are exposed to the internet through their network ports! Too much of that is definitely a <span class="No-Break">bad thing.</span></p>
			<p>Then, gcp_firewall_enum generates Nmap scripts based on the results. Nmap is one of the most commonly used network security testing tools; it’s a network mapper that can be used to map a network. I love these descriptive names—they’re <span class="No-Break">very convenient.</span></p>
			<h3>Gcploit</h3>
			<p><strong class="bold">Gcploit</strong> (<a href="https://github.com/dxa4481/gcploit">https://github.com/dxa4481/gcploit</a>) is a collection of pentesting tools<a id="_idIndexMarker920"/> that are designed to find security vulnerabilities <span class="No-Break">in GCP.</span></p>
			<p>Let’s take a look <span class="No-Break">at them!</span></p>
			<ul>
				<li><strong class="bold">BFS Search</strong> is a threat modeling tool. It can help<a id="_idIndexMarker921"/> you figure out how threat actors could attack your <span class="No-Break">GCP applications.</span></li>
				<li><strong class="bold">Mock Graph</strong> can also be used for <span class="No-Break">threat</span><span class="No-Break"><a id="_idIndexMarker922"/></span><span class="No-Break"> modeling.</span></li>
				<li>Then, the main Gcploit<a id="_idIndexMarker923"/> component executes<a id="_idIndexMarker924"/> two particular exploits, <strong class="bold">actAs</strong> and <strong class="bold">dataproc</strong>. The Dataproc API is used for provisioning data resources and actAs is an exploit that can be used for <span class="No-Break">malicious access.</span></li>
			</ul>
			<p>Gcploit is based on Dylan Ayrey<a id="_idIndexMarker925"/> and Allison D’s presentation at Black Hat 2020. In Gcploit’s README, they mention that there are other exploits they’d like to add, but they <span class="No-Break">haven’t yet.</span></p>
			<h3>gcp-iam-role-permissions</h3>
			<p>Brad Geesaman and Josh Larsen’s <strong class="bold">gcp-iam-role-permissions</strong> (<a href="https://github.com/darkbitio/gcp-iam-role-permissions">https://github.com/darkbitio/gcp-iam-role-permissions</a>) is a script that looks for primitive and predefined<a id="_idIndexMarker926"/> GCP IAM roles and <span class="No-Break">their permissions.</span></p>
			<p>You need to be very careful when you set up user accounts in GCP, and leaving default settings is usually a very bad idea because attackers may try exploits based on those settings. User accounts and their access should be customized for some of the same reasons why default passwords should be <span class="No-Break">changed, too.</span></p>
			<p>Geesaman and Larsen’s tool helps pentesters to detect those sorts of vulnerabilities before the bad <span class="No-Break">guys do.</span></p>
			<h3>GCP Scanner</h3>
			<p><strong class="bold">GCP Scanner</strong> (<a href="https://github.com/google/gcp_scanner">https://github.com/google/gcp_scanner</a>) has a bunch of different contributors, and it’s released<a id="_idIndexMarker927"/> under Google’s official GitHub account. But the README starts with <span class="No-Break">this disclaimer:</span></p>
			<p>“<em class="italic">This project is not an official Google project. It is not supported by Google and Google specifically disclaims all warranties as to its quality, merchantability, or fitness for a </em><span class="No-Break"><em class="italic">particular purpose.</em></span><span class="No-Break">”</span></p>
			<p>That must have something to do with Google’s lawyers. It’s like Google’s saying “Here’s this cool pentesting tool for you folks, but don’t blame us if it doesn’t work properly.” I think you should try it anyway, especially if you want to give it a run in the GCP deployment you can make for your own <span class="No-Break">educational purposes.</span></p>
			<p>GCP Scanner can help you to determine the level of access of certain credentials you have within your GCP network and applications. You can use GCP Scanner’s findings in a pentest report, and also to security harden how your organization has <span class="No-Break">configured IAM.</span></p>
			<p>GCP Scanner works with these sorts <span class="No-Break">of credentials:</span></p>
			<ul>
				<li>GCP VM <span class="No-Break">instance metadata</span></li>
				<li>User credentials stored in Google Cloud (<span class="No-Break"><strong class="source-inline">gcloud</strong></span><span class="No-Break">) profiles</span></li>
				<li>OAuth2 refresh token with cloud-platform <span class="No-Break">scope granted</span></li>
				<li>GCP service account key in <span class="No-Break">JSON format</span></li>
			</ul>
			<p>GCP Scanner can test Compute Engine, App Engine, Cloud Storage, GKE, Bigtable, BigQuery, and <span class="No-Break">Cloud Functions.</span></p>
			<p>We will definitely run GCP Scanner<a id="_idIndexMarker928"/> at the CLI in <a href="B18672_11.xhtml#_idTextAnchor197"><span class="No-Break"><em class="italic">Chapter 11</em></span></a>; it should <span class="No-Break">be fun!</span></p>
			<h1 id="_idParaDest-195"><a id="_idTextAnchor195"/>Summary</h1>
			<p>GCP’s roots stem from when Google released App Engine in 2008, a way for businesses and other entities to launch their own web applications within Google’s platform. App Engine proved to be very popular. So, in the years since, Google has released a large number of additional cloud services that enterprises and organizations can use for their production networks and <span class="No-Break">networking applications.</span></p>
			<p>GCP is how Google competes with Amazon’s AWS and Microsoft Azure. However, many organizations deploy multi-cloud networks that use all of those cloud platforms <span class="No-Break">and more.</span></p>
			<p>The two most important GCP components that are used in IaaS (but can also be used in SaaS and PaaS) are Compute Engine and Cloud Storage. Compute Engine is like the CPU, and Cloud Storage is <span class="No-Break">your disks.</span></p>
			<p>Google also provides a lot of very useful security controls that your organization really ought to use to harden their security against cyber attacks. They include Cloud Firewall, IAM, Secret Manager, Cloud IDS, and some other applications. Administrators can use the integrated interface in Security Command Center for a comprehensive live view of your organization’s security posture, security events, <span class="No-Break">and vulnerabilities.</span></p>
			<p>There are a number of third-party tools that you can use to pentest GCP. They include Scout Suite, GCPBucketBrute, Hayat, GCP Scanner, Gcploit, <span class="No-Break">and gcp_firewall_enum.</span></p>
			<p>Now that we’ve explored pentesting GCP in general, in the next chapter, we will be pentesting Docker and Kubernetes clusters <span class="No-Break">in GCP.</span></p>
			<h1 id="_idParaDest-196"><a id="_idTextAnchor196"/>Further reading</h1>
			<p>To learn more on the topics covered in this chapter, you can visit the <span class="No-Break">following links:</span></p>
			<ul>
				<li><em class="italic">GCP Free </em><span class="No-Break"><em class="italic">Tier</em></span><span class="No-Break">: </span><a href="https://cloud.google.com/free&#13;"><span class="No-Break">https://cloud.google.com/free</span></a></li>
				<li><em class="italic">Google Cloud </em><span class="No-Break"><em class="italic">products</em></span><span class="No-Break">: </span><a href="https://cloud.google.com/products&#13;"><span class="No-Break">https://cloud.google.com/products</span></a></li>
				<li><em class="italic">Google Cloud Platform Terms of </em><span class="No-Break"><em class="italic">Service</em></span><span class="No-Break">: </span><a href="https://cloud.google.com/terms/"><span class="No-Break">https://cloud.google.com/terms/</span></a></li>
			</ul>
		</div>
	</body></html>