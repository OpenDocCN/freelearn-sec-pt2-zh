- en: '10'
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Security Features in GCP
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Welcome to **Google Cloud Platform**, or **GCP** for short. GCP is the last
    of the top three most popular cloud platforms mentioned in this book. A lot of
    how GCP works is similar to AWS and Azure, but there are definitely some aspects
    to GCP that are unique and important for pentesters to understand before they
    pentest in the platform.
  prefs: []
  type: TYPE_NORMAL
- en: First, let’s examine some of the most commonly used aspects of the GCP ecosystem.
    In this chapter, you’ll learn about the most popular GCP services, applications,
    and features, and why they’re used. Next, we’ll look into GCP **Software-as-a-Service**
    (**SaaS**), **Infrastructure-as-a-Service** (**IaaS**), and **Platform-as-a-Service**
    (**PaaS**) features. We will conclude the chapter by discussing Google’s own GCP
    security tools and third-party security tools.
  prefs: []
  type: TYPE_NORMAL
- en: Before we pentest GCP, it helps to understand how the company we’re working
    for may use GCP, and what security features Google provides that can help pentesters
    understand the security posture of the GCP deployment they’re working with.
  prefs: []
  type: TYPE_NORMAL
- en: 'This chapter covers the following main topics:'
  prefs: []
  type: TYPE_NORMAL
- en: Introduction to GCP
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Frequently used GCP SaaS applications
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: GCP IaaS services
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: GCP PaaS services
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: GCP security controls and tools
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Let’s get into it!
  prefs: []
  type: TYPE_NORMAL
- en: Introduction to GCP
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: The first service that Google launched was its eponymous search engine. That
    was back in 1998, during a time in which ordinary people were starting to use
    the internet in large numbers. The very first server ([http://infolab.stanford.edu/pub/voy/museum/pictures/display/0-4-Google.htm](http://infolab.stanford.edu/pub/voy/museum/pictures/display/0-4-Google.htm))
    that founders Larry Page and Sergey Brin used for Google featured 10 4 GB HDDs,
    and their hardware was held in a frame made out of LEGO bricks! Their first server
    ran on Stanford University’s networking infrastructure and premises.
  prefs: []
  type: TYPE_NORMAL
- en: Google’s first service that was specifically targeted to business customers
    was its AdWords advertising platform, now known as Google Ads ([https://ads.google.com/home/](https://ads.google.com/home/)).
    In the years since, it has launched a handful of services that are still very
    popular, such as Gmail, and it has killed a much greater number of services ([https://killedbygoogle.com/](https://killedbygoogle.com/)).
  prefs: []
  type: TYPE_NORMAL
- en: One collection of services that should hopefully endure and evolve for many
    years to come is GCP.
  prefs: []
  type: TYPE_NORMAL
- en: GCP started as simply App Engine back in 2008 ([https://cloudplatform.googleblog.com/2008/04/introducing-google-app-engine-our-new.html](https://cloudplatform.googleblog.com/2008/04/introducing-google-app-engine-our-new.html)).
    That was about two years after Amazon launched AWS as we now know it. App Engine
    is a way for businesses and other entities to launch their own web applications
    within Google’s platform. At the beginning of App Engine’s history, Google limited
    its use to 10,000 customers. That gave Google the opportunity to fix bugs and
    gradually expand its infrastructure so that it could be more competitive against
    Amazon’s AWS and Microsoft Azure.
  prefs: []
  type: TYPE_NORMAL
- en: By November 2011, Google made App Engine an officially supported product, available
    to anyone or any entity that’s willing to pay for its services and abide by its
    policies. Google gradually launched more cloud services, and App Engine became
    one of many products under the GCP banner.
  prefs: []
  type: TYPE_NORMAL
- en: As of 2023, you can get more disk storage (5 GB of cloud storage) in GCP’s Free
    Tier ([https://cloud.google.com/free](https://cloud.google.com/free)) than the
    entire capacity of a single HDD in Google’s first server machine (4 GB). We sure
    have come a long way in 25 years of Google services!
  prefs: []
  type: TYPE_NORMAL
- en: 'Before you do any pentesting in GCP, it’s important to review Google’s *Google
    Cloud Platform Acceptable Use Policy* to make sure that we abide by it. This is
    taken from Google Cloud ([https://cloud.google.com/terms/aup?sjid=12831346254261876451-NA](https://cloud.google.com/terms/aup?sjid=12831346254261876451-NA)):'
  prefs: []
  type: TYPE_NORMAL
- en: '*Customer agrees not to, and not to allow third parties to use* *the Services:*'
  prefs: []
  type: TYPE_NORMAL
- en: '*to violate, or encourage the violation of, the legal rights* *of others;*'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '*to engage in, promote or encourage illegal activity, including child sexual
    exploitation, child abuse, or terrorism or violence that can cause death, serious
    harm, or injury to individuals or groups* *of individuals;*'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '*for any unlawful, invasive, infringing, defamatory or fraudulent purpose including
    Non-consensual Explicit Imagery (NCEI), violating intellectual property rights
    of others, phishing, or creating a* *pyramid scheme;*'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '*to distribute viruses, worms, Trojan horses, corrupted files, hoaxes, or other
    items of a destructive or* *deceptive nature;*'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '*to gain unauthorized access to, disrupt, or impair the use of the Services,
    or the equipment used to provide the Services, by customers, authorized resellers,
    or other* *authorized users;*'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '*to disable, interfere with or circumvent any aspect of the Services, Software,
    or the equipment used to provide* *the Services;*'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '*to generate, distribute, publish or facilitate unsolicited mass email, promotions,
    advertisements, or other solicitations (“**spam”); or*'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '*to use the Services, or any interfaces provided with the Services, to access
    any other Google product or service in a manner that violates the terms of service
    of such other Google product* *or service.*'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: In a nutshell, you can pentest in GCP without asking Google for permission.
    But what you’re allowed to do is limited. You absolutely cannot conduct any types
    of pentests that could disrupt GCP for other GCP customers. That means no DDoS
    attack simulations, no malware distribution, no attempting access outside of the
    assets the company you work for owns, and—obviously—no breaking the law. Encouraging
    illegal activity and distributing malware can also harm people who don’t use GCP.
    Vulnerability scanning and looking for exposures and unprotected sensitive data
    within the resources your company owns are permitted in GCP. Just make sure that
    your company gives you written legal permission to do that.
  prefs: []
  type: TYPE_NORMAL
- en: Now, let’s explore what GCP has to offer.
  prefs: []
  type: TYPE_NORMAL
- en: Frequently used GCP SaaS applications
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: There are a large number of applications and services within the GCP ecosystem.
    Many of those services are classified as SaaS. That means that Google provides
    the infrastructure, the platform, and the application that runs in it. As a user
    or organization, you’re only responsible for the code or data you enter into its
    applications.
  prefs: []
  type: TYPE_NORMAL
- en: 'As Google has more responsibility and control over its SaaS services, your
    ability to pentest those services while abiding by their policies is very limited
    to nonexistent. Google Support says the following ([https://support.google.com/cloud/answer/6262505?hl=en#zippy=%2Cdo-i-need-to-notify-google-that-i-plan-to-do-a-penetration-test-on-my-project](https://support.google.com/cloud/answer/6262505?hl=en#zippy=%2Cdo-i-need-to-notify-google-that-i-plan-to-do-a-penetration-test-on-my-project)):'
  prefs: []
  type: TYPE_NORMAL
- en: '*Do I need to notify Google that I plan to do a penetration test on* *my project?*'
  prefs: []
  type: TYPE_NORMAL
- en: '*If you plan to evaluate the security of your Cloud Platform infrastructure
    with penetration testing, you are not required to contact us. You will have to
    abide by the Cloud Platform Acceptable Use Policy and Terms of Service, and ensure
    that your tests only affect your projects (and not other customers’ applications).
    If a vulnerability is found, please report it via the Vulnerability* *Reward Program*.'
  prefs: []
  type: TYPE_NORMAL
- en: That pertains to infrastructure, not applications. You will have more freedom
    to pentest and vulnerability scan Google’s PaaS and IaaS services.
  prefs: []
  type: TYPE_NORMAL
- en: Nonetheless, it’s still important for cloud pentesters to understand which SaaS
    services are available within the GCP ecosystem. Understanding SaaS in GCP will
    help give you context into how the organization you work for uses GCP as a whole.
    Organizations will usually use some PaaS or IaaS services in addition to SaaS,
    and GCP services are able to connect to each other. Plus, sometimes, an organization’s
    IaaS and PaaS applications interface with GCP’s SaaS applications. If an organization’s
    data flows from an IaaS or PaaS application to a SaaS application, the security
    of that data may be able to be pentested from the IaaS or PaaS end.
  prefs: []
  type: TYPE_NORMAL
- en: Here are some of the most commonly used GCP SaaS services.
  prefs: []
  type: TYPE_NORMAL
- en: Google Workspace
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '**Google Workspace** ([https://workspace.google.com/](https://workspace.google.com/))
    is more or less Google’s equivalent to Microsoft 365 for Business. Google Workspace’s
    defining feature is that it integrates well-known Google productivity applications,
    such as Gmail, Google Calendar, Google Meet, Google Chat, Google Drive, Google
    Docs, Google Sheets, Google Slides, and Google Forms.'
  prefs: []
  type: TYPE_NORMAL
- en: If that all sounds familiar to you, that’s because the collection was previously
    known as G Suite. Google sure loves to change its branding every so often! It
    keeps us on our toes! Businesses, whether or not they subscribe to GCP, get a
    14-day free trial if they’re using Google Workspace for the first time. Google
    Workspace and its components have a much greater usage capacity and enterprise-specific
    features that aren’t available in the consumer versions of Gmail, Google Docs,
    and so on.
  prefs: []
  type: TYPE_NORMAL
- en: Google App Engine
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '**Google App Engine** was mentioned at the beginning of this chapter, as it
    was Google’s first cloud services offering for the enterprise market and the first
    ever GCP component.'
  prefs: []
  type: TYPE_NORMAL
- en: App Engine ([https://cloud.google.com/appengine](https://cloud.google.com/appengine))
    is a “serverless” way to deploy web applications on Google’s infrastructure. There
    is technically a server, but App Engine users aren’t supposed to manage or configure
    it.
  prefs: []
  type: TYPE_NORMAL
- en: Because App Engine users don’t manage its platform or its infrastructure, it’s
    by its very definition a SaaS service. App Engine users can build their applications
    in Node.js, Java, Ruby, C#, Go, Python, and PHP, which are all very commonly used
    application development technologies. If developers are already well experienced
    in one or more of those languages in other platforms, learning how to use App
    Engine should be pretty easy.
  prefs: []
  type: TYPE_NORMAL
- en: Cost Management
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: AWS and Azure both have applications that users of their platforms can use to
    manage their spending on cloud services in those platforms. Google also offers
    such an application for GCP—**Cost Management**.
  prefs: []
  type: TYPE_NORMAL
- en: Cost Management ([https://cloud.google.com/cost-management](https://cloud.google.com/cost-management))
    doesn’t just say “You spent $364.24 last month.” Rather, it offers a lot of charts
    and graphs so that you can make sense of your spending trends on every GCP component
    that you use.
  prefs: []
  type: TYPE_NORMAL
- en: When I walk you through deploying a GCP environment for pentesting educational
    purposes in [*Chapter 11*](B18672_11.xhtml#_idTextAnchor197), I strongly recommend
    checking Cost Management every so often to make sure you won’t be incurring any
    surprise charges. Free services can become paid services if you’re not careful!
  prefs: []
  type: TYPE_NORMAL
- en: Google Cloud app
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The **Google Cloud app** ([https://cloud.google.com/app](https://cloud.google.com/app))
    can be installed on your iPhone or Android phone to give you an easy on-the-go
    way of checking your GCP services and network.
  prefs: []
  type: TYPE_NORMAL
- en: A laptop or desktop PC with a physical keyboard is the best interface for doing
    serious, detailed development and administrative work in your GCP services. But
    the Google Cloud app can help you understand and discover production issues, manage
    your resources such as projects, billing, App Engine apps, and Compute Engine
    VMs, receive and respond to production-related alerts, and make general changes
    to your GCP deployment.
  prefs: []
  type: TYPE_NORMAL
- en: The Google Cloud app’s features include alerts, error reporting, incident management,
    a customizable dashboard, billing, and a way to check your use of Compute Engine,
    Cloud Storage, Cloud SQL, and App Engine.
  prefs: []
  type: TYPE_NORMAL
- en: Google Marketing Platform
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Google’s earliest monetization schemes were based on advertising revenue (Google
    AdWords, now known as Google Ads), and data-mining services to advertisers. So,
    Google knows marketing as well as it knows tech. Therefore, **Google Marketing
    Platform** can be useful for businesses.
  prefs: []
  type: TYPE_NORMAL
- en: Google Marketing Platform ([https://marketingplatform.google.com/about/enterprise/](https://marketingplatform.google.com/about/enterprise/))
    includes Analytics 360 for metrics about how users use your applications, Optimize
    360 for testing your applications with marketing needs in mind, Search Ads 360
    to better understand the effectiveness of your marketing campaigns, Tag Manager
    360 to understand the effectiveness of the tags you use in your marketing, and
    Campaign Manager 360 to understand the effectiveness of your marketing efforts
    per campaign.
  prefs: []
  type: TYPE_NORMAL
- en: Now, let’s get into IaaS. Those are the kinds of cloud services that give companies
    the most control, while also delegating them the most responsibility in operating
    their services and keeping them secure.
  prefs: []
  type: TYPE_NORMAL
- en: GCP IaaS services
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: With GCP IaaS services, you get maximum control, but you also have maximum responsibility.
    Google provides its networking infrastructure and the hardware and tools for deploying
    VMs.
  prefs: []
  type: TYPE_NORMAL
- en: The main difference between using IaaS services and deploying an on-premises
    cloud network is that the organization you work for won’t have physical access
    to the infrastructure. No one in the organization you work for will be allowed
    to touch the physical power button on any of the computers in the GCP data centers.
    You aren’t even allowed to physically enter those data centers.
  prefs: []
  type: TYPE_NORMAL
- en: But you have a lot more freedom to conduct penetration testing activities in
    IaaS services. You should still make sure that you abide by the *Google Cloud
    Platform Acceptable Use Policy*. But don’t fret, because all of the pentesting
    tutorials that I give in [*Chapter 11*](B18672_11.xhtml#_idTextAnchor197) and
    [*Chapter 12*](B18672_12.xhtml#_idTextAnchor215) are policy compliant!
  prefs: []
  type: TYPE_NORMAL
- en: Here are the GCP components that give your organization Google’s infrastructure
    and let your organization do the rest. (These services can sometimes also be combined
    with other services for PaaS and SaaS offerings.)
  prefs: []
  type: TYPE_NORMAL
- en: Compute Engine
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '**Compute Engine** ([https://cloud.google.com/compute](https://cloud.google.com/compute))
    is the GCP component that lets your organization run its VMs on Google’s infrastructure.
    Compute Engine is what it sounds like. It handles computer processing. Compute
    Engine also drives many GCP PaaS and SaaS services. But if you’re just using Compute
    Engine and Cloud Storage as is, then what you have is an IaaS solution.'
  prefs: []
  type: TYPE_NORMAL
- en: Compute Engine is very useful for a wide range of cloud network application
    use cases because Google has way more hardware in their GCP data centers than
    most companies could ever have. Compute Engine is especially used for lots of
    DevOps and **Continuous Integration/Continuous Deployment** (**CI/CD**) needs.
    But you can also just deploy simple VMs in Compute Engine.
  prefs: []
  type: TYPE_NORMAL
- en: Cloud Storage
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: While Compute Engine basically serves the CPU function, **Cloud Storage** ([https://cloud.google.com/storage](https://cloud.google.com/storage))
    serves the disk function. A lot of SaaS and PaaS solutions also use Cloud Storage,
    but Cloud Storage can also be used as is for IaaS setups.
  prefs: []
  type: TYPE_NORMAL
- en: Google says that with Cloud Storage, you can store any amount of data and retrieve
    it as often as you’d like. That’s a bold statement, but Google has the infrastructure
    to store petabytes worth of your data if you’d like. Just not for free—it’ll cost
    you! When we deploy a GCP network for educational purposes in the next chapter,
    I’ll get 5 GB for free. That’s enough for my temporary testing needs.
  prefs: []
  type: TYPE_NORMAL
- en: Shielded VMs
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: If your organization deals with extra-sensitive data, such as—for instance—if
    you were in healthcare, law, or the public sector, Shielded VMs may be what’s
    best suited for your cloud security and regulatory compliance needs.
  prefs: []
  type: TYPE_NORMAL
- en: '**Shielded VMs** ([https://cloud.google.com/shielded-vm](https://cloud.google.com/shielded-vm))
    are specially configured to implement security controls that protect against bootkits
    and rootkits. Rootkits are malware that grants attackers malicious root (administrative)
    access, whereas bootkits are persistent malware that executes upon the operating
    system boot process.'
  prefs: []
  type: TYPE_NORMAL
- en: Shielded VMs run off of specialized hardware that uses special **Unified Extensible
    Firmware Interface** (**UEFI**) firmware (the firmware that’s used to boot a physical
    machine before it boots the operating system or hypervisor), a virtual trusted
    platform module, and integrity monitoring.
  prefs: []
  type: TYPE_NORMAL
- en: It’s possible to run VMs in GCP’s standard Compute Engine configurations in
    a way that’s very secure and regulatory compliant, but Shielded VMs go a step
    further with their specialized hardware and other features. Organizations will
    often spend a bit more on Shielded VMs if their security needs are extra high
    and they have the budget for it. You will get in trouble for trying to pentest
    the extra security controls in Shielded VMs, so don’t even consider it!
  prefs: []
  type: TYPE_NORMAL
- en: Sole-tenant nodes
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '**Sole-tenant nodes** are another possibly very expensive IaaS option to deploy
    extra sensitive applications on Google’s infrastructure.'
  prefs: []
  type: TYPE_NORMAL
- en: Cloud platforms such as GCP can be used to deploy public clouds and private
    clouds. The majority of GCP users implement public cloud services, which simply
    means that our applications are running on hardware that’s also used for other
    GCP customers. Every time I walk you through deploying a cloud network for educational
    purposes in this book, we’re using public cloud services.
  prefs: []
  type: TYPE_NORMAL
- en: Private clouds can be hosted on a company’s own premises, but GCP and other
    cloud platforms also offer machines that can be dedicated to one customer only.
    By customer, I mean a person or company that subscribes to cloud services to host
    their own applications, not to a customer’s customers, if that makes any sense.
    I as a hypothetical GCP customer can pay for GCP services to host my shoe store
    e-commerce website. My customers who buy shoes from my GCP-hosted site aren’t
    GCP customers in that sense; I’m the GCP customer. Whew!
  prefs: []
  type: TYPE_NORMAL
- en: Anyway, what GCP calls sole-tenant nodes ([https://cloud.google.com/compute/docs/nodes/sole-tenant-nodes](https://cloud.google.com/compute/docs/nodes/sole-tenant-nodes))
    are another way to deploy private cloud services in GCP’s ecosystem. Some industries
    and companies are required to use private cloud services only, for the sake of
    regulatory compliance. So, they may pay Google the big bucks to make sure their
    machines aren’t shared with other GCP customers.
  prefs: []
  type: TYPE_NORMAL
- en: So, those are GCP services that can be used for IaaS deployments. Now, it’s
    time for PaaS.
  prefs: []
  type: TYPE_NORMAL
- en: GCP PaaS services
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: PaaS is the space between SaaS and IaaS. SaaS means you’re basically just running
    your code, commands, documents, or media in Google’s applications, on Google’s
    platform, and on Google’s infrastructure. IaaS means Google is letting you use
    its hardware, but you’re responsible for providing your own platforms and applications.
    PaaS means Google is offering you a platform you can run your own applications
    in.
  prefs: []
  type: TYPE_NORMAL
- en: PaaS is not quite as much responsibility and work as deploying with IaaS, but
    it’s still more work than SaaS. Here are some services in GCP that provide customers
    with Google’s platforms to support a customer’s own custom applications.
  prefs: []
  type: TYPE_NORMAL
- en: Cloud SDK
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '**Cloud SDK** ([https://cloud.google.com/sdk](https://cloud.google.com/sdk))
    is a standard development kit for developers. It includes client libraries for
    Java, Python, Node.js, Ruby, Go, .NET, C++, PHP, and **Advanced Business Application
    Programming** (**ABAP**). It has special tools that can be integrated into the
    Google Cloud CLI.'
  prefs: []
  type: TYPE_NORMAL
- en: In a nutshell, Cloud SDK is a collection of tools so that a developer can make
    their own custom applications that use various technologies in GCP’s ecosystem.
  prefs: []
  type: TYPE_NORMAL
- en: Cloud SQL
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '**Cloud SQL** is for hosting **Structured Query Language** (**SQL**) databases
    on GCP. The vast majority of backend-driven applications, web-based or otherwise,
    require at least one database of some sort. And the vast majority of databases
    these days use some type of SQL.'
  prefs: []
  type: TYPE_NORMAL
- en: Cloud SQL ([https://cloud.google.com/sql](https://cloud.google.com/sql)) is
    a managed relational database service for MySQL, PostgreSQL, and SQL Server. It
    takes away a lot of the hassle of deploying SQL servers. Cloud SQL streamlines
    the SQL server deployment and management processes.
  prefs: []
  type: TYPE_NORMAL
- en: Cloud Run
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '**Cloud Run** ([https://cloud.google.com/run](https://cloud.google.com/run))
    makes deploying containerized applications easier. Cloud Run can use Docker images
    if you want. (**Google Kubernetes Engine** (**GKE**) might be an even better option
    for Kubernetes deployments, though.)'
  prefs: []
  type: TYPE_NORMAL
- en: Cloud Run supports Go, Python, Java, Node.js, .NET, Ruby, and many other popular
    application development programming languages.
  prefs: []
  type: TYPE_NORMAL
- en: GKE
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: So, that segues nicely into GKE.
  prefs: []
  type: TYPE_NORMAL
- en: Kubernetes is a containerization orchestration platform that builds upon Docker’s
    core features. Kubernetes is open source and uses many open standards, but it
    was initially developed by a team at Google, including Joe Beda, Brendan Burns,
    and Craig McLuckie. So, although one can definitely deploy Kubernetes in AWS and
    Azure with native support, one might argue that GCP is Kubernetes’ true home.
    GKE ([https://cloud.google.com/kubernetes-engine](https://cloud.google.com/kubernetes-engine))
    is the most convenient way to deploy Kubernetes in GCP.
  prefs: []
  type: TYPE_NORMAL
- en: Anthos
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '**Anthos** ([https://cloud.google.com/anthos](https://cloud.google.com/anthos))
    is designed to help organizations deploy multi-cloud and hybrid-cloud networks.'
  prefs: []
  type: TYPE_NORMAL
- en: As explained in the first two chapters of this book, hybrid clouds are when
    a company has services on a cloud platform and servers on its own premises, and
    the two aspects are integrated with each other. Multi-cloud is when organizations
    use more than one cloud provider, and their cloud services from multiple providers
    are integrated with each other.
  prefs: []
  type: TYPE_NORMAL
- en: So, an organization could have GCP services and some servers on their own premises,
    and that’s a hybrid cloud. They could have services on AWS, Azure, and GCP, and
    that’s multi-cloud. They could also have servers on their own premises and services
    in AWS, Azure, and GCP. That’s both a hybrid cloud and multi-cloud. That’s a hybrid
    multi-cloud!
  prefs: []
  type: TYPE_NORMAL
- en: Anthos makes managing all of those different kinds of cloud configurations easier.
  prefs: []
  type: TYPE_NORMAL
- en: Next, let’s look into some important GCP security controls and applications.
  prefs: []
  type: TYPE_NORMAL
- en: GCP security controls and tools
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Let’s get into the applications and features Google makes available to GCP customers
    for the sake of improving their security. Your organization really ought to be
    using them! Then, we’ll get into some useful third-party security tools.
  prefs: []
  type: TYPE_NORMAL
- en: Security controls
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Google provides a lot of useful applications that can help us manage our security
    posture in GCP. Let’s have a look at them.
  prefs: []
  type: TYPE_NORMAL
- en: Identity and Access Management
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: '**Identity and Access Management** (**IAM**) ([https://cloud.google.com/iam](https://cloud.google.com/iam))
    is one of the crucial cloud security components, and GCP is no exception.'
  prefs: []
  type: TYPE_NORMAL
- en: Users and groups of users are granted certain permissions and rights regarding
    what they’re allowed to do with your organization’s files, applications, and other
    sorts of cloud resources. Your organization should implement the **Principle of
    Least Privilege** (**PoLP**), so users and groups only have as much access as
    they need to perform their jobs, and no more.
  prefs: []
  type: TYPE_NORMAL
- en: IAM works with Cloud Identity to sync user accounts between applications and
    projects. **Two-Factor Authentication** (**2FA**) can be set up directly from
    the Google Admin console. That’s really useful because cloud security benchmarks
    and some data regulations require users to have more than just their password
    for authentication.
  prefs: []
  type: TYPE_NORMAL
- en: Requiring 2FA (or **multi-factor authentication**, **MFA**) isn’t just some
    silly rule to annoy administrators and users. Passwords are considered to be a
    weak method of authentication, as they’re often breached or cracked. Adding another
    factor of authentication can be as simple as a user installing Google Authenticator
    on their phone, and entering an OTP from that application when they’re logging
    in to their company’s GCP services.
  prefs: []
  type: TYPE_NORMAL
- en: IAM also features robust and detailed user account logging. Each and every user
    must be accountable for their actions, and IAM makes it possible for administrators
    to see who’s done what. These logs can also be fed into other security tools,
    such as an **Intrusion Detection** **System** (**IDS**).
  prefs: []
  type: TYPE_NORMAL
- en: Cloud IDS
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Speaking of IDS, there’s **Cloud IDS**, GCP’s native IDS.
  prefs: []
  type: TYPE_NORMAL
- en: When Cloud IDS ([https://cloud.google.com/intrusion-detection-system](https://cloud.google.com/intrusion-detection-system))
    is used properly, it can detect many kinds of malware attacks and cyber attacks
    that are executed from **Command and Control** (**C2**) servers.
  prefs: []
  type: TYPE_NORMAL
- en: Cloud IDS can monitor both east-west traffic and north-south traffic within
    your GCP deployment. East-west traffic is between different services and machines
    inside of your cloud network, whereas north-south traffic is between your cloud
    network and the public internet and other external networks. Cyber attacks can
    travel between east and west and north and south!
  prefs: []
  type: TYPE_NORMAL
- en: Cloud IDS can generate alerts for administrators so that they can mitigate cyber
    attacks as they’re happening.
  prefs: []
  type: TYPE_NORMAL
- en: Data produced by Cloud IDS can also be used for investigating cyber incidents
    in the wake of their occurrence.
  prefs: []
  type: TYPE_NORMAL
- en: Cloud Firewall
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: '**Cloud Firewall** can be configured to filter or restrict certain kinds of
    traffic or network activities within your cloud network.'
  prefs: []
  type: TYPE_NORMAL
- en: Google says that Cloud Firewall ([https://cloud.google.com/firewall](https://cloud.google.com/firewall))
    can provide “*granular control, including micro-segmentation without network re-architecting.*”
    That’s a lot of fancy computer networking language that I’ll be happy to translate
    into plain English—Cloud Firewall lets administrators control really small activities
    and the smaller components of larger activities, including the ability to divide
    a network into even smaller administrative sections without the organization’s
    network having to be completely changed in how it’s set up.
  prefs: []
  type: TYPE_NORMAL
- en: There are so many ways that firewalls can regulate traffic, including Cloud
    Firewall. Traffic can be managed according to its TCP/IP ports, IP addresses,
    domain names, and user accounts. Cloud Firewall can use **Threat Intelligence**
    (**TI**) from third parties to determine IP addresses, domain names, and users
    to block.
  prefs: []
  type: TYPE_NORMAL
- en: Secret Manager
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: '**Secret Manager** ([https://cloud.google.com/secret-manager](https://cloud.google.com/secret-manager))
    offers GCP customers a secure way to manage their secrets. These aren’t secrets
    such as “I used a calculator when I wasn’t allowed to in math class when I was
    a kid.” Rather, Secret Manager protects secrets such as passwords, cryptography
    certificates, API keys (they let applications communicate with other applications),
    and other sorts of sensitive authentication data.'
  prefs: []
  type: TYPE_NORMAL
- en: So when you set up TLS certificates for a web server or a user creates a password
    for their account through IAM, they are stored in Secret Manager. Think of it
    as a massive bank vault with a thick bulletproof door, and all of your keys are
    inside. Protecting those keys is absolutely necessary so that cyber criminals
    and other malicious entities can’t do bad things to your GCP applications and
    data.
  prefs: []
  type: TYPE_NORMAL
- en: Cloud DLP
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: '**Cloud DLP** (short for **Data Loss Prevention**) ([https://cloud.google.com/dlp](https://cloud.google.com/dlp))
    helps to make sure that your important data within GCP isn’t lost! Yes—its name
    is descriptive of its function, but obviously, the technology it uses takes a
    bit more effort to describe.'
  prefs: []
  type: TYPE_NORMAL
- en: Cloud DLP can use masking and tokenization to obfuscate your data. So, for instance,
    if a credit card number going through the **Point-of-Sale** (**POS**) system of
    your e-commerce application is **G2F69** Cloud DLP may disguise it as **B7K31**
    (No real credit card numbers use that format; I’m being extra safe!)
  prefs: []
  type: TYPE_NORMAL
- en: Cloud DLP can also show security administrators that bit of data went through
    here, then over there, then out through that other component even further over
    there. Except, of course, it wouldn’t be that vague. Cloud DLP can also track
    data as it leaves your cloud and prevent sensitive data that’s not supposed to
    leave your cloud from doing so.
  prefs: []
  type: TYPE_NORMAL
- en: Security Command Center
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: '**Security Command Center** ([https://cloud.google.com/security-command-center](https://cloud.google.com/security-command-center))
    is a unified interface that combines those GCP security controls and other GCP
    security controls as well.'
  prefs: []
  type: TYPE_NORMAL
- en: Theoretically, you could have an IAM panel on one monitor, acting separately
    from a Cloud Firewall panel displaying on another monitor.
  prefs: []
  type: TYPE_NORMAL
- en: However, it helps security administrators immensely when all of these security
    applications are integrated with each other. It helps so much to defend against
    cyber attacks when administrators can see how one security component is working
    with another, or how a cyber attack is trying to do one type of bad thing, and
    then another.
  prefs: []
  type: TYPE_NORMAL
- en: Security Command Center makes it possible to identify security misconfigurations
    and many kinds of security vulnerabilities so that they can be addressed as quickly
    and effectively as possible.
  prefs: []
  type: TYPE_NORMAL
- en: In addition to helping administrators detect cyber threats, Security Command
    Center can also be set up to help a company make sure they’re being compliant
    with data security regulations that apply to them.
  prefs: []
  type: TYPE_NORMAL
- en: Now, onto the third-party stuff that you can use when you’re vulnerability scanning
    and pentesting in GCP.
  prefs: []
  type: TYPE_NORMAL
- en: Security tools
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Many very talented pentesters have developed third-party pentesting and security
    testing tools that are designed to be used in GCP. All the tools mentioned here
    are open source and available through GitHub. In this section, you’ll find the
    GCP pentesting tools that I’ve found to be the most useful.
  prefs: []
  type: TYPE_NORMAL
- en: GCPBucketBrute
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: '**GCPBucketBrute** ([https://github.com/RhinoSecurityLabs/GCPBucketBrute](https://github.com/RhinoSecurityLabs/GCPBucketBrute))
    is developed by Rhino Security Labs. You may have noticed so far in this book
    that Rhino Security Labs also develops some of the other pentesting tools that
    I’ve mentioned, such as Pacu and CloudScraper.'
  prefs: []
  type: TYPE_NORMAL
- en: GCPBucketBrute is a script to enumerate Google Storage buckets, see which components
    and entities have access to them, and whether or not they can be privilege escalated.
    It’s very dangerous if cybercriminals have access to your organization’s buckets,
    especially if they can privilege escalate to do whatever they want. So, it’s a
    good idea for pentesters to run this tool to find these vulnerabilities and attack
    paths before the bad guys find them.
  prefs: []
  type: TYPE_NORMAL
- en: 'According to the README file ([https://github.com/RhinoSecurityLabs/GCPBucketBrute/blob/master/README.md](https://github.com/RhinoSecurityLabs/GCPBucketBrute/blob/master/README.md)),
    these are the steps that the script takes to find security problems:'
  prefs: []
  type: TYPE_NORMAL
- en: '*Given a keyword, this script enumerates Google Storage buckets based on a
    number of permutations generated from* *the keyword.*'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '*Then, any discovered bucket will* *be output.*'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '*Then, any permissions that you are granted (if any) to any discovered bucket
    will* *be output.*'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '*Then the script will check those privileges for privilege escalation (storage.buckets.setIamPolicy)
    and will output anything interesting (such as publicly listable, publicly writable,
    authenticated listable, privilege* *escalation, etc).*'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Scout Suite
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'I’ve mentioned nccgroup’s Scout Suite ([https://github.com/nccgroup/ScoutSuite](https://github.com/nccgroup/ScoutSuite))
    before. It also works great with GCP, so I’ll mention it again. As the README
    says:'
  prefs: []
  type: TYPE_NORMAL
- en: “*ScoutSuite is an open source multi-cloud security-auditing tool, which enables
    security posture assessment of cloud environments. Using the APIs exposed by cloud
    providers, Scout Suite gathers configuration data for manual inspection and highlights
    risk areas. Rather than going through dozens of pages on the web consoles, Scout
    Suite presents a clear view of the attack* *surface automatically.*”
  prefs: []
  type: TYPE_NORMAL
- en: As with many of the tools that I mentioned, you can run ScoutSuite directly
    from the CLI that you use on each cloud platform.
  prefs: []
  type: TYPE_NORMAL
- en: Hayat
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: '**Hayat** ([https://github.com/DenizParlak/hayat](https://github.com/DenizParlak/hayat))
    was developed by Deniz Parlak. Hayat means “life” in Turkish, and the developer
    also named his script after his niece. How sweet!'
  prefs: []
  type: TYPE_NORMAL
- en: Hayat is a script that can audit Cloud SQL instances, IAM, Cloud Storage, networking
    configurations, VMs, logging and monitoring systems, and Kubernetes clusters.
  prefs: []
  type: TYPE_NORMAL
- en: Parlak says that’s it *for now*, which seems to imply that more features will
    be added in the future. I can’t wait!
  prefs: []
  type: TYPE_NORMAL
- en: gcp_firewall_enum
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Chris Moberly’s **gcp_firewall_enum** ([https://gitlab.com/gitlab-com/gl-security/threatmanagement/redteam/redteam-public/gcp_firewall_enum](https://gitlab.com/gitlab-com/gl-security/threatmanagement/redteam/redteam-public/gcp_firewall_enum))
    parses your GCP data output to enumerate compute instances that are exposed to
    the internet through their network ports! Too much of that is definitely a bad
    thing.
  prefs: []
  type: TYPE_NORMAL
- en: Then, gcp_firewall_enum generates Nmap scripts based on the results. Nmap is
    one of the most commonly used network security testing tools; it’s a network mapper
    that can be used to map a network. I love these descriptive names—they’re very
    convenient.
  prefs: []
  type: TYPE_NORMAL
- en: Gcploit
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: '**Gcploit** ([https://github.com/dxa4481/gcploit](https://github.com/dxa4481/gcploit))
    is a collection of pentesting tools that are designed to find security vulnerabilities
    in GCP.'
  prefs: []
  type: TYPE_NORMAL
- en: Let’s take a look at them!
  prefs: []
  type: TYPE_NORMAL
- en: '**BFS Search** is a threat modeling tool. It can help you figure out how threat
    actors could attack your GCP applications.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Mock Graph** can also be used for threat modeling.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Then, the main Gcploit component executes two particular exploits, **actAs**
    and **dataproc**. The Dataproc API is used for provisioning data resources and
    actAs is an exploit that can be used for malicious access.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Gcploit is based on Dylan Ayrey and Allison D’s presentation at Black Hat 2020\.
    In Gcploit’s README, they mention that there are other exploits they’d like to
    add, but they haven’t yet.
  prefs: []
  type: TYPE_NORMAL
- en: gcp-iam-role-permissions
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Brad Geesaman and Josh Larsen’s **gcp-iam-role-permissions** ([https://github.com/darkbitio/gcp-iam-role-permissions](https://github.com/darkbitio/gcp-iam-role-permissions))
    is a script that looks for primitive and predefined GCP IAM roles and their permissions.
  prefs: []
  type: TYPE_NORMAL
- en: You need to be very careful when you set up user accounts in GCP, and leaving
    default settings is usually a very bad idea because attackers may try exploits
    based on those settings. User accounts and their access should be customized for
    some of the same reasons why default passwords should be changed, too.
  prefs: []
  type: TYPE_NORMAL
- en: Geesaman and Larsen’s tool helps pentesters to detect those sorts of vulnerabilities
    before the bad guys do.
  prefs: []
  type: TYPE_NORMAL
- en: GCP Scanner
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: '**GCP Scanner** ([https://github.com/google/gcp_scanner](https://github.com/google/gcp_scanner))
    has a bunch of different contributors, and it’s released under Google’s official
    GitHub account. But the README starts with this disclaimer:'
  prefs: []
  type: TYPE_NORMAL
- en: “*This project is not an official Google project. It is not supported by Google
    and Google specifically disclaims all warranties as to its quality, merchantability,
    or fitness for a* *particular purpose.*”
  prefs: []
  type: TYPE_NORMAL
- en: That must have something to do with Google’s lawyers. It’s like Google’s saying
    “Here’s this cool pentesting tool for you folks, but don’t blame us if it doesn’t
    work properly.” I think you should try it anyway, especially if you want to give
    it a run in the GCP deployment you can make for your own educational purposes.
  prefs: []
  type: TYPE_NORMAL
- en: GCP Scanner can help you to determine the level of access of certain credentials
    you have within your GCP network and applications. You can use GCP Scanner’s findings
    in a pentest report, and also to security harden how your organization has configured
    IAM.
  prefs: []
  type: TYPE_NORMAL
- en: 'GCP Scanner works with these sorts of credentials:'
  prefs: []
  type: TYPE_NORMAL
- en: GCP VM instance metadata
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: User credentials stored in Google Cloud (**gcloud**) profiles
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: OAuth2 refresh token with cloud-platform scope granted
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: GCP service account key in JSON format
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: GCP Scanner can test Compute Engine, App Engine, Cloud Storage, GKE, Bigtable,
    BigQuery, and Cloud Functions.
  prefs: []
  type: TYPE_NORMAL
- en: We will definitely run GCP Scanner at the CLI in [*Chapter 11*](B18672_11.xhtml#_idTextAnchor197);
    it should be fun!
  prefs: []
  type: TYPE_NORMAL
- en: Summary
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: GCP’s roots stem from when Google released App Engine in 2008, a way for businesses
    and other entities to launch their own web applications within Google’s platform.
    App Engine proved to be very popular. So, in the years since, Google has released
    a large number of additional cloud services that enterprises and organizations
    can use for their production networks and networking applications.
  prefs: []
  type: TYPE_NORMAL
- en: GCP is how Google competes with Amazon’s AWS and Microsoft Azure. However, many
    organizations deploy multi-cloud networks that use all of those cloud platforms
    and more.
  prefs: []
  type: TYPE_NORMAL
- en: The two most important GCP components that are used in IaaS (but can also be
    used in SaaS and PaaS) are Compute Engine and Cloud Storage. Compute Engine is
    like the CPU, and Cloud Storage is your disks.
  prefs: []
  type: TYPE_NORMAL
- en: Google also provides a lot of very useful security controls that your organization
    really ought to use to harden their security against cyber attacks. They include
    Cloud Firewall, IAM, Secret Manager, Cloud IDS, and some other applications. Administrators
    can use the integrated interface in Security Command Center for a comprehensive
    live view of your organization’s security posture, security events, and vulnerabilities.
  prefs: []
  type: TYPE_NORMAL
- en: There are a number of third-party tools that you can use to pentest GCP. They
    include Scout Suite, GCPBucketBrute, Hayat, GCP Scanner, Gcploit, and gcp_firewall_enum.
  prefs: []
  type: TYPE_NORMAL
- en: Now that we’ve explored pentesting GCP in general, in the next chapter, we will
    be pentesting Docker and Kubernetes clusters in GCP.
  prefs: []
  type: TYPE_NORMAL
- en: Further reading
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'To learn more on the topics covered in this chapter, you can visit the following
    links:'
  prefs: []
  type: TYPE_NORMAL
- en: '*GCP Free* *Tier*: [https://cloud.google.com/free](https://cloud.google.com/free'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: )
  prefs: []
  type: TYPE_NORMAL
- en: '*Google Cloud* *products*: [https://cloud.google.com/products](https://cloud.google.com/products'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: )
  prefs: []
  type: TYPE_NORMAL
- en: '*Google Cloud Platform Terms of* *Service*: [https://cloud.google.com/terms/](https://cloud.google.com/terms/)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
