<html><head></head><body>
        <section>

                            <header>
                    <h1 class="header-title">Setting Up a Lab</h1>
                </header>
            
            <article>
                
<p><span>In the previous chapter, we learned the concept of hacking. In this chapter, we are going to learn how to set up a virtual environment, so that we can later perform penetration tests on it. In this chapter, we will cover the concept of virtual machines, and will also perform its installation steps. Later in the chapter, we will learn how to install Kali Linux, and the two victim machines on VirtualBox: Windows and the Metasploitable machine. We will also discuss what each of these machines does, and why we are going to use them. Toward the end of the chapter, we will see the concept of snapshots, and how to implement them.</span></p>
<p><span>The following topics will be covered in this chapter:</span></p>
<ul>
<li>Lab overview</li>
<li>Installing Kali Linux</li>
<li>Installing Metasploitable</li>
<li>Installing Windows</li>
<li>Creating snapshots and using snapshots</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Lab overview</h1>
                </header>
            
            <article>
                
<p>Since this book is highly practical, we will need a lab, a place where we can learn and perform attacks. To create this, we're going to use a program called VirtualBox.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">VirtualBox</h1>
                </header>
            
            <article>
                
<p>VirtualBox is a program that will allow us to install machines, just like normal computers, inside our own machine. We will have one computer, and we will install other computers inside it, acting as virtual machines. These are very important in terms of penetration testing; we're going to be using them a lot in order to set up a lab. It's very important to note that a virtual machine is just like a completely separate, working machine; there is nothing we will lose by installing an operating system as a virtual machine, and it will perform just like it does when installed on a separate laptop. Basically, instead of having four or five computers or laptops around us (so that we can try to hack into them), we're going to install them as virtual machines inside our own machine. This might seem a bit vague now, but once we get further into the chapter, the concept of how VirtualBox works will become clearer.</p>
<p>Basically, we are going to have three computers inside our main computer. We will have the following three machines in our lab:</p>
<ul>
<li>Attacker machine: Kali Linux</li>
<li>Victim 1: Metasploitable</li>
<li>Victim 2: Windows</li>
</ul>
<p>For example, if our main computer has macOS, we are not going to do anything with that. We have a machine that will be an attacker machine, running Kali Linux, and we will learn more about Kali Linux in a later part of this chapter.</p>
<p>We will also have two victims:</p>
<ul>
<li>A victim that runs on Windows.</li>
<li>A victim that runs an operating system called <strong>Metasploitable.</strong></li>
</ul>
<p>So, we're going to have our own machine, and then have three separate machines inside it. This will be possible by using VirtualBox.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Installation of VirtualBox</h1>
                </header>
            
            <article>
                
<p>When downloading VirtualBox, just grab the version that's compatible with your operating system. There is VirtualBox for Windows, macOS X, and Linux.</p>
<div class="packt_infobox"><span>VirtualBox is free, and you can download it from the following link: <a href="https://www.virtualbox.org/wiki/Downloads" target="_blank">https://www.virtualbox.org/wiki/Downloads</a></span></div>
<p>So, just find the VirtualBox version that is compatible with your operating system, double-click on it, and install it. Installing it is very simple; you just double-click it, click <span class="packt_screen">Next</span>, <span class="packt_screen">Next</span>, and <span class="packt_screen">Next</span>, and it's installed. The following is a screenshot of VirtualBox; as we can see, it's installed, and we have no machines on the left-hand side of the window:</p>
<div class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-1052 image-border" src="assets/0c6d9ee4-e03f-4e5a-843d-13cd47eac267.png" style="width:98.83em;height:26.33em;"/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Installing Kali Linux</h1>
                </header>
            
            <article>
                
<p>Throughout this book, we're going to use a number of penetration testing tools. You can go ahead and install each of these tools manually, or you can do what most pen testers, including myself, do—save time and effort by using an operating system designed for hacking. We're going to use an operating system called Kali Linux, a flavor of Linux based on Debian. It comes with all of the programs and applications that we need to use, preinstalled and preconfigured. This means that we can just install the operating system and start to learn hacking.</p>
<p>There are two options for installing Kali: install it as a virtual machine inside the current operating system or install it in the main machine as the main operating system. Throughout this book, we are actually going to be using it as a virtual machine, because using it as a virtual machine works exactly the same as using it as the main machine; it will be completely isolated from our computer running inside VirtualBox. If we break it, or mess things up, it would be very easy to fix. It's very easy to go back to other snapshots or configurations, and we won't lose any functionality by using it as a virtual machine. That is why we always use it this way.</p>
<div class="packt_infobox">The steps are exactly the same, regardless of what operating system you use, whether you're on Windows, Linux, or OS X.</div>
<p>The steps for installing Kali Linux are as follows:</p>
<ol>
<li>Download the VirtualBox version for your computer.</li>
<li>After setting up VirtualBox, download Kali Linux, available at <a href="https://www.offensive-security.com/kali-linux-vm-vmware-virtualbox-hyperv-image-download/" target="_blank">https://www.offensive-security.com/kali-linux-vm-vmware-virtualbox-hyperv-image-download/</a>.</li>
<li>Scroll down, making sure to click on the Kali Linux VirtualBox Images, not on the VMware; then, download the version of Kali that's compatible with your system. So, if you have a 64-bit computer, download the 64-bit, and if you have a 32-bit computer, download the 32-bit.</li>
<li>After downloading it, you should get a file with a <kbd>.ova</kbd> extension; you will have the name followed by the <kbd>.ova</kbd> extension, as shown here:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-1054 image-border" src="assets/9e3b1d81-a973-4a20-9c8c-48701b35af4e.png" style="width:55.25em;height:13.75em;"/></div>
<ol start="5">
<li>To install this in VirtualBox, all we have to do is double-click on the file. You will see a window that will allow you to import the virtual machine. We're going to keep everything the same for now and we're just going to click on the <span class="packt_screen">Import</span> button.<span> That's it; the virtual machine is ready to be used:</span></li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-276 image-border" src="assets/20c5788e-550f-41df-a2df-cbecb917d486.png" style="width:106.58em;height:64.17em;"/></div>
<ol start="6">
<li>Before we start, we will look at how to modify some of the settings. We're going to click on the <span class="packt_screen">Kali-Linux</span> tab, which can be seen on the left side of the window. Then, we're going to click on the Settings. The first thing that we are going to do here is go to <span class="packt_screen">System</span> and modify the amount of RAM it has. Depending on how much RAM you have on your computer, you can give this a <span class="packt_screen">2</span>, but 1 GB is enough for Kali. Usually, I leave it at <span class="packt_screen">2</span>, because I have 16 GB of RAM.</li>
</ol>
<ol start="7">
<li>Also, when you click on the <span class="packt_screen">Processors</span> tab, you'll see that, by default, we have two processors assigned to it. Again, I have 8 CPUs, so 2 is not going to cause too much pressure on my computer; but 1 CPU is also enough for Kali.</li>
<li>Now, we're going to go to the <span class="packt_screen">Network</span> settings, and we're going to set this to use a NAT network. Sometimes, when we set this to a <span class="packt_screen">NAT Network</span>, we won't see a network name in here; for that, please check out the link <a href="https://www.youtube.com/watch?v=y0PMFg-oAEs" target="_blank">https://www.youtube.com/watch?v=y0PMFg-oAEs</a> and it will show how to create a <span class="packt_screen">NAT Network</span>. This setting is basically going to create a virtual network that our host machine will be the router for, and then all of the virtual machines are going to be clients connected to this network. So, they're going to get internet connection from the host machine and, at the same time, all of my virtual machines will be connected to a virtual network. This is very handy, because my virtual machines will be able to communicate with each other; we can use one of them to hack into another, and we can use it to test network attacks, and much more.</li>
</ol>
<p style="padding-left: 60px">This will allow my virtual machines to have internet connection, and it will also allow them to communicate with each other, all of this will be done through a virtual network. It will not use any of your wireless adapters or any of the wireless cards; it will create a virtual Ethernet network, so as far as the virtual machines are concerned, they're connected to a network through an Ethernet cable.</p>
<ol start="9">
<li>We can now click on <span class="packt_screen">OK</span> and start our virtual machine.</li>
<li>Now, to start it, all we have to do is click on the <span class="packt_screen">Start</span> button. Then, click inside the virtual machine, and hit <em>Enter</em>; now we are inside the virtual machine:</li>
</ol>
<div class="mce-root CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-277 image-border" src="assets/e64acac0-7093-4711-891a-f23d6e579d9b.png" style="width:106.58em;height:62.08em;"/></div>
<ol start="11">
<li>Now it's asking us for the username, and the default username is <kbd>root</kbd>, and then it's asking us for the password, and the default password is the reverse of that, which is <kbd>toor</kbd>. Since we installed this using the ready image, we can just click on the green button, or we can go to <span class="packt_screen">View</span> | <span class="packt_screen">Full-screen</span>; the screen will automatically resize to the size of our screen.</li>
<li>Now, note that top-right hand side of the screen, we should actually see a network icon, because we set this machine to use a NAT network. If we don't have a network icon, it means that the machine isn't connected to the NAT network, so if we open the browser, we will see that it's not connected to the internet.</li>
</ol>
<ol start="13">
<li>To fix this issue, we just have to go to the top of the screen, and it will display menus. Going to <span class="packt_screen">Devices</span> | <span class="packt_screen">Network</span>, we can click on <span class="packt_screen">Connect Network Adapter</span> as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-1055 image-border" src="assets/7a23d646-c8a8-468b-b53d-90af1b3035bf.png" style="width:35.42em;height:8.75em;"/></div>
<p style="padding-left: 60px">We only have to do this once, and then the virtual machine will automatically connect to the NAT network. Once this is done, in just a few seconds, we will have a network icon appear, and if we click on it, we will get connected to a wired network.</p>
<ol start="14">
<li>As we can see in the following screenshot, it says <span class="packt_screen">Wired Connected</span>, so Kali thinks it's connected to a wired network:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-1056 image-border" src="assets/63df1638-3db8-4f37-8d01-c197a890a3b3.png" style="width:14.42em;height:16.75em;"/></div>
<p style="padding-left: 60px">Now, if we just click <span class="packt_screen">Try Again</span> in the browser, we will see internet working. </p>
<p>Don't be intimidated by this new operating system; we're going to go through the basics, and we're going to use it a lot. It's actually going to become very easy for you to use.</p>
<p>Also, like I said, you won't lose any functionality when you install Kali Linux as a virtual machine. It's actually better to install it as a virtual machine, because it's completely isolated from your computer, and it will be very easy to fix if things go wrong.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Installing Metasploitable</h1>
                </header>
            
            <article>
                
<p>The second machine that we will use is Metasploitable. Metasploitable is another Linux machine, and you can think of it as the opposite of Kali. Kali is designed so that you can use it to hack into other devices, while Metasploitable is designed so that you hack into it, so it's designed for people who want to learn penetration testing. It is designed so that it has a number of vulnerabilities, and we're going to try to use Kali Linux in order to hack into Metasploitable. Therefore, this is going to be one of the target, or victim, machines.</p>
<p>You can download Metasploitable at <a href="https://information.rapid7.com/metasploitable-download.html" target="_blank">https://information.rapid7.com/metasploitable-download.html</a>.</p>
<p>You will end up with a ZIP file, like the following. Once you decompress it, you will get a directory named <kbd>metasploitable-linux-2.0.0.zip</kbd>; double-click it, and you'll see the following files:</p>
<div class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-1057 image-border" src="assets/484a89f1-17ff-442c-ae07-2d86f1143d5e.png" style="width:43.58em;height:8.75em;"/></div>
<p>So, we're going to create a new machine, through the following steps:</p>
<ol>
<li>To get a virtual machine, we will click on <span class="packt_screen">New</span>, and we will name it <kbd>Metasploitable</kbd> and change its type to a Linux machine. Then, hit <span class="packt_screen">Next</span>, and give it only 1 GB of RAM.</li>
<li>Then, we are going to use the existing virtual file option, unlike when we created Kali Linux (that is, when we created a new virtual hard disk). The reason for this is that the image we have now is actually designed for VMware Player. So, we're going to import the hard disk file, or the hard disk image, so that we have an installation ready without having to install it. We're just going to use an existing hard disk file. We will go into the <kbd>Metasploitable</kbd> directory and select the <kbd>.vmdk</kbd> file.</li>
</ol>
<ol start="3">
<li>Click on <span class="packt_screen">Open and Create</span>. We are going to start the machine right now. This is what we will see when the machine is running and fully installed:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-1058 image-border" src="assets/88103446-5bd2-4148-a92c-1890923e41d9.png" style="width:41.17em;height:24.92em;"/></div>
<ol start="4">
<li>We don't really need to install anything, as we just imported a pre-made installation, a ready hard disk. So, now it's asking for the username, <kbd>msfadmin</kbd>. The password is the same. We are now logged in:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-1192 image-border" src="assets/c8791987-a667-49dd-9e37-ae300738fc85.png" style="width:42.83em;height:8.67em;"/></div>
<p style="padding-left: 60px">This machine only has a Terminal, and it's giving you a warning that you should never expose this machine to an external internet connection because it is a vulnerable machine, designed to be vulnerable. It's only inside our lab, installed as a virtual machine, so nobody outside our lab can access it, which is a really good way of using it. As mentioned previously, in later chapters, we're going to discuss how we can try to hack into this machine. Again, don't be intimidated by the Terminal; we're going to be using it a lot, and we're going to learn how to use it step by step.</p>
<p style="padding-left: 60px">If we want to turn this machine off, all we have to do is type in <kbd>sudo poweroff</kbd>—just run the command. After asking for the admin password, the machine just turns off:</p>
<div class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-1060 image-border" src="assets/1039435b-61cf-4703-bac9-abf655084292.png" style="width:43.50em;height:11.67em;"/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Installing Windows</h1>
                </header>
            
            <article>
                
<p>The last machine that we're going to talk about installing is the Windows machine. This is just a normal Windows machine, with Windows 10. This is going to be another victim, and we are going to see how we can hack it. Again, we installed Metasploitable because it has a large number of vulnerabilities, and it's designed to be hacked into. It has a Terminal that is not very user friendly, and it doesn't really mimic a normal user. The Windows machine, on the other hand, will be used for scenarios that mimic a normal user, a user just using Windows to browse the internet or do whatever normal people do on their machines.</p>
<p>So, Microsoft has actually released free versions, or free virtual machines, that you can download and use. These are available on Microsoft's website. You can download them at <a href="https://developer.microsoft.com/en-us/microsoft-edge/tools/vms/" target="_blank">https://developer.microsoft.com/en-us/microsoft-edge/tools/vms/</a>.</p>
<p>So, we're going to create a new machine, through the following steps:</p>
<ol>
<li>Make sure that you select which host operating system you have. If you have Windows, you click on the <span class="packt_screen">Windows</span> tab, and if you have Mac, then click on the <span class="packt_screen">Mac</span> tab, and so on.</li>
<li>From the drop-down boxes, select <span class="packt_screen">MSEdge on Win (10)</span>, and make sure to select the VirtualBox image. These are all applications that allow us to install virtual machines. At the moment, we're using VirtualBox for everything, so just make sure you use the VirtualBox image. Once you do that, you will have a ZIP file named <kbd>MSEdge.Win10.VirtualBox.zip</kbd>. Uncompress it, and you will get the file <kbd>MSEDGE-Win10TH2.ova</kbd>.</li>
<li>Double-click on the <kbd>.ova</kbd> file, and VirtualBox will ask you to import the machine—it has already set up the settings for it. You can now import it the way it is, and modify the settings later and the Windows will be installed.</li>
<li>Before booting it, modify the settings, change RAM to 2 GB. We can then start it. Windows will start straight away—it is ready, given to us by Microsoft.</li>
</ol>
<p>We have a fully working Windows machine here, Windows 10, and this will be the third machine that we use in our lab. It will be our second attacking machine—our second victim or target machine.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Creating and using snapshots </h1>
                </header>
            
            <article>
                
<p>Now that we've created our virtual machines, it would be a good idea to take snapshots of them. A snapshot allows us to store the state of the current virtual machine, so that we can go back or forward in time, to a certain state. We can think of snapshots as bookmarks—for example, we can take snapshots of the fresh installations of the operating systems, and, if we update, configure, or break something in the future, we can go back to the fresh installations, or go back to the factory settings. We can also go forward to the updated system from there. We can take a snapshot whenever we want, and go back and forth between states.</p>
<p>The following are the steps for taking snapshots:</p>
<ol>
<li>Click on Kali Linux that we installed; it's very easy to create a snapshot of it. All you have to do is go to <span class="packt_screen">Snapshots</span> and click on the camera icon, which appears on the icon bar at the top:</li>
</ol>
<div class="mce-root CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-1061 image-border" src="assets/9736cd42-2cbc-4c52-acb0-5929851406fb.png" style="width:41.17em;height:6.00em;"/></div>
<ol start="2">
<li>It will ask us to name the snapshot, so we will just name it <kbd>Fresh Install</kbd>, and we will give it a description, saying it's a fresh snapshot, with no updates. It's always a good idea to give a meaningful name and description, so that in the future, we can actually remember what the snapshot stands for:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-284 image-border" src="assets/7d76ce6e-bdf6-4635-a206-aa1371b35e6c.png" style="width:49.67em;height:34.50em;"/></div>
<ol start="3">
<li>So now that we are done, we can click on <span class="packt_screen">OK</span>, and we will have the <span class="packt_screen">Current State</span>. We can update or install programs, and even install libraries, and, if we break something and/or want to go back to the fresh install, we can click on <span class="packt_screen">Fresh Install</span> to restore it.</li>
</ol>
<p>Now, we can go back to the normal details and start our virtual machine. We will see an example now. Let us create a new directory in Kali Linux—we are going to call it <kbd>test</kbd>. Let's suppose that we actually updated the system; when we update the system, there is a good chance that some programs will not be as up to date as the libraries that will be installed, and these programs might start having issues. If this happens, it is recommended to go back to, or downgrade to, an older version, without the update.</p>
<p>All we have to do is go back to the fresh installation. We just created a new file to show that once you go back, everything will go back to how it was before changes were made. Turning off Kali, if we go back to the snapshots, we will see the <span class="packt_screen">Current State</span> (the state that has been changed). If we updated and the update was successful, we can also create a snapshot called <span class="packt_screen">Updated System</span>, including the date, and a description, such as <em>updated with no problems</em>. Clicking on <span class="packt_screen">OK</span>, we will then see two snapshots—<span class="packt_screen">Fresh Install</span> and <span class="packt_screen">Updated System</span>.</p>
<p>If we have problems after updating, all we have to do is just click on the <span class="packt_screen">Fresh Install</span> that we just created, and then click on the restore icon to restore changes. Now, if we start the Kali machine, we will see that the new directory that we created disappeared. We're back to where we were without the new directory, without anything, so we are actually back to the fresh installation of Kali, to when we actually took the snapshot.</p>
<p>Let's suppose that we have gone back in time to our fresh installation, and for some reason we want to go to our updated state to see if we can fix the issue (perhaps by finding a solution online). If we want to go to a future state, we can just click on <span class="packt_screen">Updated System</span>, then <span class="packt_screen">Restore</span>, and—without creating a snapshot from the <span class="packt_screen">Current State—</span>start the machine. We'll be back to the updated state, to where we had the new directory created, the <kbd>test</kbd> directory.</p>
<p>As you can see, snapshots can be really useful. They allow us to bookmark the state of the operating system, so that we can actually have different configurations, switching between them as we please. Snapshots are also really useful if we have installed Windows, because Windows actually gives us a trial version, and we can go back to our fresh installation of Windows if there are problems in the future.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Summary</h1>
                </header>
            
            <article>
                
<p>In this chapter, we learned how to use VirtualBox, which allows us to install machines such as Kali Linux, and Windows, inside our own machine. We also learned how to install Kali Linux, which is going to be our attacking machine throughout the book, and how to install our victim machines, Windows and Metasploitable. Lastly, we studied what snapshots are, and how they can help us to retain our past setups in the virtual environment.</p>
<p>In upcoming chapters, we will see how to use the Kali Linux machine to attack both the Windows machine and the Metasploitable machine.</p>


            </article>

            
        </section>
    </body></html>