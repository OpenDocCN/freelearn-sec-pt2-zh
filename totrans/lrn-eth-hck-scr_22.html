<html><head></head><body>
        <section>

                            <header>
                    <h1 class="header-title">Discovering Vulnerabilities Automatically Using OWASP ZAP</h1>
                </header>
            
            <article>
                
<p>In the last chapter, we covered another important part of penetration testing, which was about exploiting cross-site scripting vulnerabilities.</p>
<p>Now, in this chapter, we are going to be studying a tool called ZAP, which will help us detect the risks and vulnerabilities of web applications. We will then explore various scans that we can perform and also learn to read the scan results. We will see this through a few examples. </p>
<p>This chapter will cover the following web penetration testing topics:</p>
<ul>
<li>OWASP ZAP start</li>
<li>OWASP ZAP result</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">OWASP ZAP start</h1>
                </header>
            
            <article>
                
<p class="mce-root">So far, we've learned how to manually discover a number of very dangerous vulnerabilities. We've seen how they work and how to exploit them. In this section, we will learn about a tool that will allow us to automatically discover vulnerabilities in web applications. It'll allow us to discover the vulnerabilities that we learned, plus many more. The reason we didn't study this tool at the start because I wanted to teach you how to discover vulnerabilities manually. Also, I wanted you to know how these vulnerabilities occur, so as to understand the reason behind them. So this program is just a tool, it can make mistakes and it can show false positives. It can also miss vulnerabilities in some cases.</p>
<p class="mce-root"/>
<p class="mce-root"/>
<p class="mce-root"/>
<p class="mce-root"/>
<p class="mce-root"/>
<p class="mceNonEditable"/>
<p class="mce-root">Therefore, I wanted you to know how to do these things manually, so that if the program doesn't work or misses something, you will be able to find it. The best way to use these programs is as a backup or just as a tool to help us with our penetration testing.</p>
<p class="mce-root">Using the tool is very simple. We are going to go to <span class="packt_screen">Applications</span> and then we are going to type in <kbd>ZAP</kbd>. It will ask us if we want to save the current session when we search for something, and we will select <span class="packt_screen">No, I do not want to persist this session at this moment in time</span> and click <span class="packt_screen">Start</span>:</p>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-1978 image-border" src="assets/5a68f4a2-fe59-4add-a48b-a831b17b0b77.png" style="width:28.17em;height:12.58em;"/></p>
<p class="mce-root">In the following screenshot is the main view of the tool. O<span>n the left are the websites that we will be targeting, on the right, we can attack and set the website URL, and at the bottom, we can see the results of our attack or our scan:</span></p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/aad43298-5494-4e63-8b1e-0d9cfb41c7a9.png"/></div>
<p class="mce-root"><span>If we go to the cog icon on the left, it will open a window, as seen in the following screenshot, which will allow us to modify the options for the program. We can modify certain aspects of it, the way the <span class="packt_screen">Fuzzer</span> works, the way the <span class="packt_screen">AJAX</span> <span class="packt_screen">Spider</span> works, the way the</span> scan <span>works: </span></p>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-1980 image-border" src="assets/008df137-c183-4b4e-9a2a-a3f5f13b90f2.png" style="width:45.08em;height:35.17em;"/></p>
<p class="mce-root"/>
<p class="mce-root"/>
<p class="mce-root"/>
<p class="mce-root"><span>We are not going to modify anything. </span>Another thing that we can modify is the policies used in the scan; something similar to the scans that we were using with Nmap, the intense scan and so on. So, we going to click on the plus sign, which is at the bottom of the screen, and we are going to click on <span class="packt_screen">Active Scan</span>:</p>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-1981 image-border" src="assets/f4f7002d-34fb-46cc-889d-8e7efe43a1fb.png" style="width:24.42em;height:11.50em;"/></p>
<p class="mce-root">Click on the Scan Policy Manager button, highlighted in the following screenshot:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/b6221304-e6f6-4afe-bd44-3a583d5576c1.png" style="width:24.67em;height:18.42em;"/></p>
<p class="mce-root">Select <span class="packt_screen">Default Policy</span>, now we can create our own policies by using the <span class="packt_screen">Add</span> button. We're going to click on <span class="packt_screen">Default Policy</span> and click on the <span class="packt_screen">Modify</span> button:</p>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-1983 image-border" src="assets/8a9b4f1b-dfd7-420e-af60-72603dd6715b.png" style="width:28.17em;height:4.17em;"/></p>
<p class="mce-root"/>
<p class="mce-root">Clicking on the <span class="packt_screen">Modify</span> button will show us the aspects that we can modify:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/bef906d4-2ff3-445f-8869-c45a4b37f4ac.png" style="width:38.17em;height:21.33em;"/></p>
<p class="mce-root">In the preceding screenshot, we can see that we can modify the <span class="packt_screen">Policy</span>, the <span class="packt_screen">Default Alert Threshold</span>, and the <span class="packt_screen">Default Attack Strength</span> for the global policy. Clicking on each of the categories will allow us to modify the specific scans that will be performed. For example, in the following screenshot, in the <span class="packt_screen">Injection</span> tab, we can see all the injection scans that the program is going to try, for example, <span class="packt_screen">Cross Site Scripting</span>: in the <span class="packt_screen">Threshold</span> column, when we click on type of threshold, we can set it to <span class="packt_screen">Default</span>, <span class="packt_screen">Low</span>, <span class="packt_screen">Medium</span>, or <span class="packt_screen">High</span>:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/b35f5937-dcad-484a-b1db-abcb130251cb.png" style="width:37.58em;height:21.00em;"/></p>
<p class="mce-root"/>
<p class="mce-root"/>
<p class="mce-root">Setting it to <span class="packt_screen">Default</span> will just default to the value selected, which is <span class="packt_screen">Medium</span> in the following screenshot:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/5ff94e33-1ed5-4f3c-8fbe-8ec8e5f3f1ee.png" style="width:29.08em;height:9.50em;"/></p>
<p class="mce-root">Or, for example, if a <span class="packt_screen">SQL Injection</span> is what we are looking for, if what we are looking for is access to the database, then we can set <span class="packt_screen">Threshold</span> to <span class="packt_screen">High</span> so that it'll try everything and it will try to find vulnerability in even difficult places:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/89a7a2bf-af2e-4c59-ab12-e0df5488ce0c.png" style="width:39.33em;height:20.42em;"/></p>
<p class="mce-root">Just leave everything as default. Now, we are going to start our attack against the mutillidae script. So, we have it in <kbd>10.0.2.4</kbd> running on the Metasploitable machine, and the URL is <kbd>http://10.0.2.4/mutillidae/</kbd>. Paste the URL in the <span class="packt_screen">URL to attack</span> textbox present in the OWASP tool and click the <span class="packt_screen">Attack</span> button:</p>
<p class="mce-root"/>
<p class="CDPAlignCenter CDPAlign"><img src="assets/b5d57c22-2cee-47ed-a778-8d0071b66542.png" style="width:50.33em;height:16.75em;"/></p>
<p class="mce-root">The tool is first try to find all the URLs and then it will try and attack the URLs based on the scan policy that we used. The output of the scan will be as follows:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/f2dba94f-eb42-4705-aa1f-210c2df81360.png"/></p>
<p class="mce-root"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">OWASP ZAP results</h1>
                </header>
            
            <article>
                
<p>After the scan is over and we can see our website on the left, clicking on it will show us some results from the Spider when it was looking for the files:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/bcaab2c3-7758-4ad5-839d-ba22e360e192.png" style="width:14.75em;height:15.25em;"/></p>
<p>The very interesting part is the <span class="packt_screen">Alerts</span> in the following screenshot. We can see all the vulnerabilities that have been discovered:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/ff31805c-b290-410f-b55b-48454294dfb4.png" style="width:24.00em;height:14.92em;"/></p>
<p>At the bottom-left of the preceding screenshot, we can see that we have 6 red flags, the High Priority Alerts, we have 4 orange flags, 5 yellow flags, and 0 blue. These are organized in order of severity.</p>
<p class="mce-root"/>
<p>Clicking on any of the categories will expand it and show the threats that have been found, for example, clicking on <span class="packt_screen">Path Traversal (10)</span>, we'll see all the URLs that can be exploited to read files from the server:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/46eb2954-4f04-40b9-a714-ef98ef4be8a5.png" style="width:43.25em;height:9.92em;"/></p>
<p>Clicking on any of the sites, we will see the HTTP request that was sent in order to discover this:</p>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-1993 image-border" src="assets/f1d24a90-02ce-4f23-937a-c66953e49238.png" style="width:19.42em;height:13.92em;"/></p>
<p>The following screenshot shows the response and why the tool thinks that this is vulnerable, and we can see that in the response the tool was able to get the contents of <kbd>/etc/passwd</kbd>:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/a74d3604-bc84-4adc-9aa0-a6684d820d4a.png" style="width:16.42em;height:10.08em;"/></p>
<p>In the following screenshot, we can see the <span class="packt_screen">URL</span>, the tool used to exploit the vulnerability, and we can see a <span class="packt_screen">Description</span> of what the current vulnerability is and how it has been exploited:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/3b5df714-07f9-4270-9d18-634d85f37493.png" style="width:58.00em;height:17.75em;"/></p>
<p>We can also see <span class="packt_screen">Risk</span>, which is <span class="packt_screen">High</span>. We can see <span class="packt_screen">Confidence</span>—how confident the tool is about the existence of this vulnerability. We can also see that it's been injected into a page and the <span class="packt_screen">Attack</span> is trying to get <kbd>/etc/passwd</kbd>. So, right-click on the page and click <span class="packt_screen">Open URL in Browser</span>:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/a83090ba-5317-4d2b-8cf3-e80840f3b09e.png" style="width:34.50em;height:16.00em;"/></p>
<p class="mce-root"/>
<p class="mce-root"/>
<p class="mce-root"/>
<p class="mce-root"/>
<p class="mce-root"/>
<p class="mceNonEditable"/>
<p>As we can see in the following screenshot, the tool has exploited the site for us. It shows us the output for the vulnerability, and we can read the contents of <kbd>/etc/passwd</kbd>:</p>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-2346 image-border" src="assets/af179346-1b94-4fb0-a83d-202748a4105b.png" style="width:59.58em;height:25.50em;"/></p>
<p>Let's have a look at another example, for example Cross Site Scripting. Again, the tool also checks for <kbd>POST</kbd> and <kbd>GET</kbd> parameters. Sometimes, when the injection is sent in textboxes, or even sent without textboxes, if it's sent in a <kbd>POST</kbd> parameter, we won't see it in the URL, so it actually checks for <kbd>POST</kbd> and <kbd>GET</kbd>. You can see in the following screenshot, it found a vulnerability in the <kbd>POST</kbd> request in the register page, and it also found one in a <kbd>GET</kbd> request:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/af264dbe-bb3b-4eb7-96b5-9f79ffdf7175.png" style="width:18.50em;height:10.50em;"/></p>
<p class="mce-root"/>
<p>Again, right-clicking and opening in the browser will execute it for us, and we can see that the code has been executed:</p>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-1999 image-border" src="assets/513e92c9-a2f8-43d3-b0a5-6bcb28a043f6.png" style="width:53.50em;height:23.67em;"/></p>
<p>Again, we can find the URL of the execution from the address bar in the browser. If we want to use it for any other tools, we can see it in tool as well, the URL that's being used to exploit the vulnerability.</p>
<p>Let's just have one more example of <span class="packt_screen">SQL Injection</span>. Again, click on the link:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/f899b91f-3d21-4999-8853-cb78327de528.png" style="width:24.25em;height:22.75em;"/></p>
<p>It will show us the URL and it will show us the <span class="packt_screen">Attack</span> that it used, <span class="packt_screen">ZAP'</span> <span class="packt_screen">AND '1'='1'</span>, which is in the <span class="packt_screen">Parameter</span> password, and if you remember, we actually did exploit this parameter manually:</p>
<div class="CDPAlignCenter CDPAlign packt_figref"><img class="aligncenter size-full wp-image-2002 image-border" src="assets/75148178-66f4-4a8b-b0cd-c61dbc3a0950.png" style="width:78.92em;height:9.75em;"/></div>
<div class="CDPAlignCenter CDPAlign packt_figref">Parameters used for exploit.</div>
<p>Opening the link in the browser will show us that the injection is working, and it's using a username and a password called <span class="packt_screen">ZAP</span>:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/7e778adb-250f-41dd-9efb-feee4d6b3174.png" style="width:28.17em;height:15.58em;"/></p>
<p>So, the tool is very simple, very powerful, and very useful. We can play around with it, we can play around with the proxy and with the options, and see how we can enhance the results and achieve even better results.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Summary</h1>
                </header>
            
            <article>
                
<p>In this chapter, we have looked at the last part of penetration testing, where we learned to use a tool called OWASP ZAP, which helps us understand the vulnerabilities in web applications. We studied this as the last part of web penetration testing because I wanted you to first learn how to penetration test manually. In the first section of this chapter, we  explored the GUI of the tool and all of the actions we can perform using it. The next part of the chapter covered the way we  perform scans and we even interpreted the results of scans.</p>


            </article>

            
        </section>
    </body></html>