<html><head></head><body><div class="chapter" title="Chapter&#xA0;1.&#xA0; Introduction to Mobile Security"><div class="titlepage"><div><div><h1 class="title"><a id="ch01"/>Chapter 1.  Introduction to Mobile Security </h1></div></div></div><p>In this chapter, we will cover the following recipes:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Installing and configuring Android SDK and ADB</li><li class="listitem" style="list-style-type: disc">Creating a simple Android app and running it in an emulator</li><li class="listitem" style="list-style-type: disc">Analyzing the Android permission model using ADB</li><li class="listitem" style="list-style-type: disc">Bypassing Android lock screen protection</li><li class="listitem" style="list-style-type: disc">Setting up the iOS development environment - Xcode and iOS simulator</li><li class="listitem" style="list-style-type: disc">Creating a simple iOS app and running it in the simulator</li><li class="listitem" style="list-style-type: disc">Setting up the Android pentesting environment</li><li class="listitem" style="list-style-type: disc">Setting up the iOS pentesting environment</li><li class="listitem" style="list-style-type: disc">Introduction to rooting and jailbreaking</li></ul></div><div class="section" title="Introduction"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec9"/>Introduction</h1></div></div></div><p>Today, smartphone usage is a much talked about subject. The world is quickly moving towards smartphone ownership, rather than traditional feature phones. Various studies and surveys have predicted increasing future usage of smartphones and tablets. There are incentives to do so; a lot of things are doable with these smartphones.</p><p>With increasing mobility comes risk. Attackers or cyber criminals look at all possible ways to attack users in order to obtain their personal data, credit card details, passwords, and other secrets. There have been threat reports from various security vendors on the increase in mobile attacks that comes with increased usage. Today, corporations are worried about data confidentiality and the resultant financial and reputational losses.</p><p>In this book, we introduce readers to some mobile device exploitation recipes, to let everyone understand the kind of attacks that are possible. Once people understand this, they will be more aware of such attack vectors and be better prepared to deal with them and secure their stuff.</p><p>This chapter will give the reader an idea about the basic security models of the two most popular mobile device platforms, Android and iOS. We will cover an introduction to their development environments and basic security models. We will set up a penetration testing environment and will introduce you to rooting and jailbreaking. This chapter builds the foundation for what is to be covered in the upcoming chapters, and is a pre-requisite for exploitation.</p></div></div>
<div class="section" title="Installing and configuring Android SDK and ADB"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec10"/>Installing and configuring Android SDK and ADB</h1></div></div></div><p>The very first step in Android development and security testing is to learn to install and configure the Android SDK and ADB. The <span class="strong"><strong>software development kit</strong></span> (<span class="strong"><strong>SDK</strong></span>) for Android comes in two installable versions; Android Studio and the standalone SDK tools. This recipe primarily uses Android Studio and later provides additional information about standalone SDK tools.</p><p>Android Debug Bridge (<span class="strong"><strong>ADB</strong></span>) is a very useful tool, which can connect to Android devices and emulators and is used to perform debugging and security testing for mobile applications.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note3"/>Note</h3><p>Whenever we use the words "Android devices" in this book, this means Android smartphones and tablets.</p></div></div><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec10"/>Getting ready</h2></div></div></div><p>Navigate to <a class="ulink" href="https://developer.android.com">https://developer.android.com</a> and download either <span class="strong"><strong>Android Studio</strong></span> or standalone SDK tools. You will also require JDK v7 or newer.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec11"/>How to do it...</h2></div></div></div><p>Let's set up using the first method, Android Studio:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Go to <a class="ulink" href="http://developer.android.com/sdk/index.html">
http://developer.android.com/sdk/index.html
</a> and download the latest Android Studio.</li><li class="listitem">Once you have downloaded the Android Studio installer file, the installer guides you through the next steps and you just have to follow the instructions.</li></ol></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note4"/>Note</h3><p>As of writing this, the installer file used is <code class="literal">android-studio-bundle-135.1740770-windows.exe</code>.</p></div></div><p>Android SDK and ABD are installed as part of the default installation. Unless you deselect these, they will be installed.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note5"/>Note</h3><p>
<span class="strong"><strong>AVD</strong></span> stands for Android Virtual Device, which in turn refers to the Android emulator. Emulators provide a virtualized setup to test, run, and debug Android applications. These are especially useful in cases where hardware devices are not available. Most development testing works using emulators. We will use an emulator in the next recipe.</p></div></div><p>Note the Android Studio and SDK installation paths. You will need them repeatedly in setup:</p><p>
</p><div class="mediaobject"><img src="graphics/image_01_001.jpg" alt="How to do it..."/></div><p>
</p><p>Once Android Studio is installed, run it. It will guide you through the next set of instructions. It downloads the Android SDK tools, which may take up to 4 hours depending upon the Internet speed.</p></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec12"/>How it works...</h2></div></div></div><p>The development environment is ready. Take a moment to make yourself familiar with the SDK installation directory (the path shown in the preceding screenshot). There are a few quick things you must know:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>SDK Manager</strong></span>: This is used to manage Android packages and can be used to install or uninstall newer/older versions as required.<p>
</p><div class="mediaobject"><img src="graphics/image_01_002.jpg" alt="How it works..."/></div><p>
</p></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>AVD Manager</strong></span>: This is used to manage AVD. Use it to create a few emulators that we will use at the appropriate time.<p>
</p><div class="mediaobject"><img src="graphics/image_01_003.jpg" alt="How it works..."/></div><p>
</p><p>Now run one of the emulators to test whether the installed setup is working well. An emulator takes 2-3 minutes to start up, so be patient and if the installation has gone well, the emulator should be up and running. (Please refer to the next recipe if you want to look at the emulator screenshot now.)</p></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>platform-tools</strong></span>: This folder contains useful tools such as ADB, SQLite3, and so on. We will use these tools in various recipes throughout this book.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>tools</strong></span>: This folder contains batch files and other executables. We will mostly use <code class="literal">emulator.exe</code>, as well as other <code class="literal">.exe</code> files in this folder.</li></ul></div></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec13"/>There's more...</h2></div></div></div><p>There is an alternative way to develop in Android, as many people prefer other IDEs. In such cases, the standalone SDK tools can be downloaded. This provides the SDK tools required for application development and these tools can be invoked from the command line.</p><p>These standalone tools are also useful for pentesters and black hats, for quick analysis of underlying, application-related stuff. A lot of the time, application development is not needed and there is a need to debug; in such cases, the standalone SDK tools can be used.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec14"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="emphasis"><em>Analyzing the Android permission model using ADB</em></span></li></ul></div></div></div>
<div class="section" title="Creating a simple Android app and running it in an emulator"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec11"/>Creating a simple Android app and running it in an emulator</h1></div></div></div><p>Now that we are ready with the Android SDK, let's write our first Android application. A little bit of coding skill is needed to get started. However, don't worry if source code scares you. There is a lot of sample code available in the Internet communities for you to use to get started.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec15"/>Getting ready</h2></div></div></div><p>To get ready to code the Android application, you need the SDK to be working well. If you have followed the first recipe and know a little bit of Java programming, the rest is easy and you are all set to code your very first Android application.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec16"/>How to do it...</h2></div></div></div><p>Let's write a very simple program to add two numbers together. I used the Eclipse IDE and created an Android application project called <code class="literal">Addition</code>:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Create the graphical layout. Drag and drop three text fields (one each for the first number and the second number, and the last one to print the sum of the first two numbers), two TextView boxes to display text so that the user knows to enter two numbers, and finally a button for the addition action.<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <code class="literal">activity_main.xml</code> file is autogenerated. Edit it to look like the following code:</li></ul></div><p>
</p><pre class="programlisting">&lt;RelativeLayout 
    
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:paddingBottom="@dimen/activity_vertical_margin"
    android:paddingLeft="@dimen/activity_horizontal_margin"
    android:paddingRight="@dimen/activity_horizontal_margin"
    android:paddingTop="@dimen/activity_vertical_margin"
    tools:context=".MainActivity" &gt;

    &lt;TextView&gt;
        android:id="@+id/textView1"
        android:layout_width="wrap_content"
        android:layout_height="match_parent"
        android:text="First Number"
Text displayed to guide user to input first number
    &lt;/TextView&gt;

    &lt;EditText&gt;
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:text=""
        android:id="@+id/e1"
Variable e1 is declared to be referenced in java file.
        android:inputType="textPassword"
    &lt;/EditText&gt;

    &lt;TextView&gt;
        android:id="@+id/textView2"
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:text="Second Number"
    &lt;/TextView&gt;

    &lt;EditText&gt;
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:text=""
        android:id="@+id/e2"
        android:inputType="textPassword"
    &lt;/EditText&gt;

    &lt;Button&gt;
        android:id="@+id/add"
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:layout_alignParentBottom="true"
        android:layout_alignParentLeft="true"
        android:layout_marginBottom="122dp"
        android:text="Add"
</pre><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Add the declared button:</li></ul></div><pre class="programlisting">    &lt;/Button&gt;   
    &lt;EditText&gt;
        android:text=""
        android:id="@+id/t3" 
</pre><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Finally, the third variable, which will contain the sum of the two numbers, is declared:</li></ul></div><pre class="programlisting">        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:inputType="textPassword"
    &lt;/EditText&gt;
&lt;/RelativeLayout&gt;
</pre></li><li class="listitem">Now we have to write Java code to input and add the numbers, and output the sum. At this point, don't worry if you do not know Activity, Intent, and so on. Just focus on getting the code error-free. Eclipse guides you at each step. We start our program with <code class="literal">MainActivity</code>, coded like this:<pre class="programlisting">package com.android.addition;
 
import android.os.Bundle;
import android.app.Activity;
import android.widget.EditText;
import android.widget.TextView;
import android.widget.Button;
import android.view.View;
 
public class MainActivity extends Activity {
    EditText e1;
    EditText e2;
    TextView t3;
    Button add;
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);
        add=(Button)findViewById(R.id.action_settings);
        add.setOnClickListener(new Button.OnClickListener()
            {
        public void onClick
        (View v){Sum();}});
    }
        private void Sum(){
          int s1=Integer.parseInt(e1.getText().toString());
          int s2=Integer.parseInt(e2.getText().toString());
          int s3=s1+s2;
          t3.setText(Integer.toString(s3));
         }
}
 
</pre><p>See how straightforward this program is; it just takes two numbers, adds them together, and provides the result.</p></li><li class="listitem">Debug and run the program. The emulator opens up and the program runs.</li></ol></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec17"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="emphasis"><em>Android In Action</em></span>, <span class="emphasis"><em>Ableson, Sen</em></span>, <span class="emphasis"><em>King</em></span>, <span class="emphasis"><em>Manning Publications Co</em></span>.</li></ul></div></div></div>
<div class="section" title="Analyzing the Android permission model using ADB"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec12"/>Analyzing the Android permission model using ADB</h1></div></div></div><p>Having set up the development environment and coded your first Android application, now it's time to understand the underlying permission model of the Android operating system. The underlying operating system is Linux; the Android operating system is built using Linux as the basis. Applications in Linux run with a specific user ID and group ID. Android uses the same Linux model to set permissions for applications; this separates and protects Android applications from each other.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec18"/>Getting ready</h2></div></div></div><p>Make sure you have ADB installed. You also need an Android emulator or an Android device to connect to ADB.</p><p>A device or emulator that has been used frequently is best for this purpose (as a newly created emulator or device may not contain much data to view using ADB). Furthermore, for learning purposes, a rooted phone is preferred.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec19"/>How to do it...</h2></div></div></div><p>Follow the steps given here for analyzing the Android permission model using ADB:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Enable <span class="strong"><strong>USB debugging</strong></span> mode on your Android device and connect it via a data cable to a computer on which ADB is running. ADB is a very powerful tool and can be used to run various useful commands, which can help us with the following tasks:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Pushing data into the phone/emulator</li><li class="listitem" style="list-style-type: disc">Pulling data from the phone/emulator</li><li class="listitem" style="list-style-type: disc">Obtaining a shell in the phone/emulator</li><li class="listitem" style="list-style-type: disc">Installing and removing applications</li><li class="listitem" style="list-style-type: disc">Navigating the filesystem</li><li class="listitem" style="list-style-type: disc">Stealing key system files</li><li class="listitem" style="list-style-type: disc">Stealing application-related files such as preferences and SQLite files</li><li class="listitem" style="list-style-type: disc">Viewing device logs</li></ul></div><p>
</p></li><li class="listitem">Use ADB to analyze the application permissions. To do this, we will have to first obtain the shell in the device using the <code class="literal">adb shell</code> command and then we will have to run the <code class="literal">ps</code> command to find the details of the process that is running.</li></ol></div><p>The following screenshot depicts this process for a phone connected to the Linux machine on which ADB was run:</p><p>
</p><div class="mediaobject"><img src="graphics/image_01_004.jpg" alt="How to do it..."/></div><p>
</p></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec20"/>How it works...</h2></div></div></div><p>Take a while to analyze the preceding screenshot. Make a note of the first, second, and last columns which show <code class="literal">USER</code>, <code class="literal">PID</code>, and application <code class="literal">NAME</code> respectively. Note that each application has a unique <code class="literal">PID</code> and is run from a specific user. Only a few privileged processes run with the user root. Other applications run via specific users. For example, the <code class="literal">com.android.datapass</code> application with <code class="literal">PID 299</code> runs as user <code class="literal">app_47</code>. Also, <code class="literal">com.svox.pico</code> runs with user <code class="literal">app_28</code>.</p><p>Each application in Android runs in its own <span class="strong"><strong>sandbox</strong></span>. A sandbox is a virtual environment where the application runs within its limited context and is not allowed access to, or to be accessed from, other applications. The permissions model in Android (applications running with specific users) helps create a sandbox, thereby restricting applications within their own context and allowing no or limited interaction (as chosen by the application developer) with other applications. This also secures applications against data theft or other attacks from rogue applications and malware.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec21"/>There's more...</h2></div></div></div><p>The Android permissions model and sandbox implementation attempts to build in security by design. This has been the target of attackers and evangelists. Android sandbox bypass attacks and attacks originating from insecure code implementation are a couple of the types of attack against this security feature. Nevertheless, security by design is implemented in the Android OS itself in the form of the permissions model.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec22"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Refer to <a class="ulink" href="http://developer.android.com/tools/help/adb.html">http://developer.android.com/tools/help/adb.html</a> for more information</li></ul></div></div></div>
<div class="section" title="Bypassing Android lock screen protection"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec13"/>Bypassing Android lock screen protection</h1></div></div></div><p>Android users are advised to protect their devices by setting up a password, pin, or lock screen (graphical pattern). When users talk about lock screen bypass, they usually mean they have locked their phone or forgotten their pattern, not how to bypass the screen and get into the device. We are approaching the topic in a more aggressive fashion, as this book is about mobile device exploitation. As an attacker, how could we bypass a victim's lock screen? Now, this topic is widely spoken about and there is already a wide range of tricks to do it; various exploits/methods may work in specific Android or device versions but may not work with others.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec23"/>Getting ready</h2></div></div></div><p>We are going to take a case where we reset the lock pattern in a phone via ADB. So for this recipe, you need ADB ready. We learned about ADB in the previous recipe. Let's now use that what we learnt, to hack. Apart from ADB, you need to obtain an Android device with <span class="strong"><strong>USB debugging</strong></span> enabled, and has a that password needs to be reset.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec24"/>How to do it...</h2></div></div></div><p>Follow these steps to bypass the lock screen protection:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Connect to the target Android device using ADB. If we have obtained a phone with <span class="strong"><strong>USB debugging</strong></span> enabled and the phone is rooted, things are much easier. If the phone is not rooted, then there are hacks to do so as well. For this recipe, let's consider a rooted phone.</li><li class="listitem">Now that you are connected via ADB, type the following command:<pre class="programlisting">
<span class="strong"><strong>adb shell</strong></span>
</pre></li><li class="listitem">This gives you the shell in a connected Android device.</li><li class="listitem">Next, change the current working directory to /data/system, which is where keys are located. To do this, we have to type the following command to change the directory:<pre class="programlisting">
<span class="strong"><strong>cd /data/system</strong></span>
</pre></li><li class="listitem">Then finally you need to delete the relevant key. Simply run the remove command to delete it:<pre class="programlisting">
<span class="strong"><strong>rm *.key</strong></span>
</pre></li><li class="listitem">It can also be run as follows:<pre class="programlisting">
<span class="strong"><strong>rm &lt;correct-filename&gt;.key</strong></span>
</pre></li><li class="listitem">In case you are prompted for superuser permissions, you can run the <code class="literal">su</code> command. The preceding commands delete the key files containing lock screen information.</li><li class="listitem">Next, do a device reboot and the lock screen should have gone.</li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec25"/>How it works...</h2></div></div></div><p>This works because the key files in the <code class="literal">/data/system</code> folder contain system information, such as the lock screen's password information. If these key files are deleted, on reboot the device is not able to locate a lock screen setting, so effectively it allows access without a password.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note6"/>Note</h3><p>A device already in USB debugging mode, and rooted as well, allows this recipe to work quite easily.</p></div></div></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec26"/>There's more...</h2></div></div></div><p>The key message is; this is not the only way to bypass the lock screen, nor is this method guaranteed to work in all cases. Hackers have come up with multiple ways to bypass Android lock screens. To further complicate matters, not all methods work for all Android versions. So you may have to spend a lot of effort in certain cases to figure out how to bypass the Android lock screen.</p></div></div>
<div class="section" title="Setting up the iOS development environment - Xcode and iOS simulator"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec14"/>Setting up the iOS development environment - Xcode and iOS simulator</h1></div></div></div><p>By now, you have got the hang of Android development. Now it's time to be introduced to the iOS development environment. Apple's iPhone and iPad run on the iOS operating system. Application development for iOS requires the Xcode IDE, which runs on Mac OS X. Xcode, together with iOS simulator, can be used to develop and test iOS applications.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note7"/>Note</h3><p>Note we say emulators when we talk about Android, and we say simulators when talk about iOS. These two are similar to each other, but with one major difference. An emulator can use some OS features to test specific applications.</p><p>For example, an Emulator can use a laptop's webcam to run an application that requires a camera, whereas such application testing will be limited in an iOS simulator. Emulators can also send an SMS to other emulators.</p><p>Some people say that emulators are smarter than simulators. However, generalizing that much may not be fair, as long as both serve the job they are designed for.</p></div></div><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec27"/>Getting ready</h2></div></div></div><p>Xcode is the IDE for developing iOS applications. Xcode runs on Mac OS X, so a MacBook is required for iOS application development. So get a MacBook, install Xcode, install the iOS SDK, and start coding in iOS.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note8"/>Note</h3><p>Note that there are useful guidelines at 
<a class="ulink" href="https://developer.apple.com/programs/ios/gettingstarted/">https://developer.apple.com/programs/ios/gettingstarted/</a>
 to help you out with this.</p></div></div></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec28"/>How to do it...</h2></div></div></div><p>Follow these steps for setting up Xcode and iOS simulator:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Locate App Store on your MacBook. Now use App Store to download Xcode (this is just like any other App download on mobile phones). You will need an Apple ID to download from the App Store. Note that Xcode is free to download from Apple's App Store.</li><li class="listitem">Once Xcode is installed, you can explore the IDE. It can be used to develop Mac OS X applications. Xcode is a common IDE for both OS X applications and iOS application development. To be able to develop an iOS application, you also need to install the iOS SDK. The latest versions of Xcode include both OS X and the iOS SDK. Simulators and instruments are also part of Xcode now.<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Thankfully this is not complicated and the installation of Xcode takes care of everything.</li><li class="listitem" style="list-style-type: disc">Once you have everything set up, create a new project. Note that if things are properly installed, you get the option to create an iOS and OS X application, as shown here:</li></ul></div><p>
</p><p>
</p><div class="mediaobject"><img src="graphics/image_01_005.jpg" alt="How to do it..."/></div><p>
</p></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec29"/>How it works...</h2></div></div></div><p>Let's make ourselves familiar with the Xcode IDE.</p><p>From the preceding screenshot, let's create a project. We will choose the <span class="strong"><strong>Single View Application</strong></span> template for simplicity's sake. This action opens up the <span class="strong"><strong>Choose options for your new project</strong></span> window. Provide a name for your project, which appends the organization identifier to create a bundle identifier.</p><p>
</p><div class="mediaobject"><img src="graphics/image_01_006.jpg" alt="How it works..."/></div><p>
</p><p>Note we selected <span class="strong"><strong>Swift</strong></span>, which is a new language introduced in iOS 8. There is another option, to choose traditional <span class="strong"><strong>Objective-C</strong></span>.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note9"/>Note</h3><p>Swift is new programming language for iOS and OS X. It is interactive and is intended to make coding fun. Swift makes app development easier and can work alongside traditional Objective-C.</p></div></div><p>Some people say that emulators are smarter than simulators. However, generalizing that may not be fair, as long as both serve the job they are designed for.</p><p>Finally, it is also important that the appropriate device option is selected from <span class="strong"><strong>iPhone</strong></span>, <span class="strong"><strong>iPad</strong></span>, or <span class="strong"><strong>Universal</strong></span>. We select <span class="strong"><strong>iPhone</strong></span>, just for the sake of this demonstration.</p><p>Once you select <span class="strong"><strong>Next</strong></span> and <span class="strong"><strong>Create</strong></span>, we see our project window:</p><p>
</p><div class="mediaobject"><img src="graphics/image_01_007.jpg" alt="How it works..."/></div><p>
</p><p>The left-hand pane is the project navigator. You can find all your project files in this area. The center part of the workspace is the editor area. Depending on the type of file, Xcode shows different interfaces in the editing area.</p><p>The right-hand pane is the utility area. This area displays the properties of files, and allows you to access <span class="strong"><strong>Quick Help</strong></span>.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec30"/>There's more...</h2></div></div></div><p>Up to now we have written zero lines of code. Even so, we can run our app using the built-in simulator. In the toolbar, we can see the <span class="emphasis"><em>run</em></span> button (top left, the one resembling the traditional <span class="emphasis"><em>play</em></span> music icon):</p><p>
</p><div class="mediaobject"><img src="graphics/image_01_008.jpg" alt="There's more..."/></div><p>
</p><p>When we hit the run button, Xcode automatically builds the app and runs it on the default iPhone 6 simulator. Of course, since we haven't programmed our app to do anything, it will just display a white screen with nothing inside:</p><p>
</p><div class="mediaobject"><img src="graphics/image_01_009.jpg" alt="There's more..."/></div><p>
</p><p>The <span class="emphasis"><em>stop</em></span> button next to the <span class="emphasis"><em>run</em></span> button terminates the app.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec31"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="emphasis"><em>Setting up the iOS pentesting environment</em></span></li></ul></div></div></div>
<div class="section" title="Creating a simple iOS app and running it in the simulator"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec15"/>Creating a simple iOS app and running it in the simulator</h1></div></div></div><p>Having introduced you to Xcode and the simulator, now we will create our first iOS application.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec32"/>Getting ready</h2></div></div></div><p>To get ready to code the iOS application, you need Xcode and iOS Simulator in your MacBook and working. If you have followed the previous recipe, and know a little bit of Objective-C, you are all set to code your very first iOS application.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec33"/>How to do it...</h2></div></div></div><p>Now that we have a basic idea of Xcode, let's start by building the user interface:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">In the project navigator, select <code class="literal">Main.storyboard</code>. Xcode then brings up a visual editor for storyboards, called <span class="strong"><strong>interface builder</strong></span>.<p>
</p><div class="mediaobject"><img src="graphics/image_01_010.jpg" alt="How to do it..."/></div><p>
</p><p>A storyboard is used to lay out views and transition between different views. As we use a single-view application, the storyboard already includes a View Controller.</p></li><li class="listitem">Next, we will add a button to the view. The bottom part of the utility area shows the Object Library, as shown in the following screenshot:<p>
</p><div class="mediaobject"><img src="graphics/image_01_011.jpg" alt="How to do it..."/></div><p>
</p></li><li class="listitem">Drag the <span class="strong"><strong>Button</strong></span> object from the Object Library to the view:<p>
</p><div class="mediaobject"><img src="graphics/image_01_012.jpg" alt="How to do it..."/></div><p>
</p></li><li class="listitem">Stop dragging and move the button to the area of your choice. Double-click on the button and rename it <code class="literal">Click Me</code>.</li><li class="listitem">Next we will add a few lines of code to display our message. In the project navigator, you should find the <code class="literal">ViewController.swift</code> file. We will be adding a method to the already present <code class="literal">ViewController</code> class. When this method is called, our code will tell iOS to display a certain message.<p>
</p><div class="mediaobject"><img src="graphics/image_01_013.jpg" alt="How to do it..."/></div><p>
</p></li><li class="listitem">Now let's code our method. This is what our method looks like:<pre class="programlisting">@IBAction func showMessage(){ 
let alertController = UIAlertController(title: "My First App", message: "Hello World", preferredStyle: UIAlertControllerStyle.Alert) 
alertController.addAction(UIAlertAction(title: "OK", style: UIAlertActionStyle.Default, handler:nil)) 
self.presentViewController(alertController, animated: true, completion: nil) 
} 
</pre></li><li class="listitem">This is what the finished work will look like:<p>
</p><div class="mediaobject"><img src="graphics/image_01_014.jpg" alt="How to do it..."/></div><p>
</p></li><li class="listitem">Now we need to connect our <span class="strong"><strong>Click Me</strong></span> button in the storyboard to our <code class="literal">showMessage</code> method. This part is easy; we click on <code class="literal">Main.storyboard</code>, where we have displayed our screen.</li><li class="listitem">Press and hold the <span class="strong"><strong>Ctrl</strong></span> key on your keyboard, click the <span class="strong"><strong>Click Me</strong></span> button, and drag it to the <span class="strong"><strong>View Controller</strong></span> icon.</li><li class="listitem">Release both buttons, and we see a pop-up message with the <code class="literal">showMessage</code> option. Select it to make a connection between the button and our function:<p>
</p><div class="mediaobject"><img src="graphics/image_01_015.jpg" alt="How to do it..."/></div><p>
</p></li><li class="listitem">That's it! If everything is correct, we can now run our app perfectly when we click on the <span class="emphasis"><em>run</em></span> button:<p>
</p><div class="mediaobject"><img src="graphics/image_01_016.jpg" alt="How to do it..."/></div><p>
</p></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec34"/>How it works...</h2></div></div></div><p>The <code class="literal">@IBAction</code> attribute, introduced in Swift, is used to connect storyboard actions to the code. Here, we wanted to connect the click of a button to a message being displayed. So, we defined the function <code class="literal">showMessage</code> as <code class="literal">func</code>.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note10"/>Note</h3><p>Starting from iOS 8, <code class="literal">UIActionSheet</code> and <code class="literal">UIAlertView</code> were replaced by the new <code class="literal">UIAlertController</code>.</p></div></div><p>In our function, we call <code class="literal">UIAlertController</code> and ask it to display an alert popup, with the title <code class="literal">My First App</code> and the message <code class="literal">Hello World</code>. We also add an action:</p><pre class="programlisting">alertController.addAction(UIAlertAction(title: "OK", style: UIAlertActionStyle.Default, handler:nil)) 
</pre><p>This essentially means we add an option to close the popup when <span class="strong"><strong>OK</strong></span> is clicked on.</p><p>When we dragged our button to the <code class="literal">ViewController</code> and selected our <code class="literal">showMessage</code> function, we essentially linked the clicking of the button to the calling of our function.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec35"/>There's more...</h2></div></div></div><p>You can experiment by trying different styles of button, or using table views, links, and so on. Add more functionality to experiment in ways of learning iOS app development.</p><p>A good starting place would be the documentation from the creators of iOS:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><a class="ulink" href="https://developer.apple.com/library/ios/documentation/Swift/Conceptual/BuildingCocoaApps/index.html">https://developer.apple.com/library/ios/documentation/Swift/Conceptual/BuildingCocoaApps/index.html</a></li></ul></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec36"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">You can find a lot of resources on starting out with app development, along with videos, tutorials, and sample code, from <a class="ulink" href="https://developer.apple.com/swift/resources/">https://developer.apple.com/swift/resources/</a></li></ul></div></div></div>
<div class="section" title="Setting up the Android pentesting environment"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec16"/>Setting up the Android pentesting environment</h1></div></div></div><p>By this time, you will be familiar with the Android development environment, ADB, and emulators. You have also coded your first application. Now let's get into penetration testing. Penetration testing for mobile applications can be broadly classified under four categories:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Mobile application traffic-related attacks</li><li class="listitem" style="list-style-type: disc">Mobile device storage-related attacks</li><li class="listitem" style="list-style-type: disc">Mobile application source code-related attacks</li><li class="listitem" style="list-style-type: disc">Attacks involving mobile OS features used by mobile applications</li></ul></div><p>This is the most complicated category. There are various Android OS features that applications interact with, such as Bluetooth, NFC, intents, broadcast receivers, and so on. These also need to be covered in an offensive penetration test.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec37"/>Getting ready</h2></div></div></div><p>We have to set up a lab for Android pentesting, which should be sufficiently well equipped to be able to conduct testing for test cases that fall into the four categories listed previously.</p><p>To get going, we need the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The Android SDK, emulators, and ADB</li><li class="listitem" style="list-style-type: disc">Emulators with different Android versions configured</li><li class="listitem" style="list-style-type: disc">One or two Android handsets or tablets (rooted)</li><li class="listitem" style="list-style-type: disc">Proxy tools such as Charles, Burp Suite, and Fiddler</li><li class="listitem" style="list-style-type: disc">A Wi-Fi network</li><li class="listitem" style="list-style-type: disc">Tools such as SQLite browser, text editors, and XML viewers</li><li class="listitem" style="list-style-type: disc">A data cable</li><li class="listitem" style="list-style-type: disc">Tools such as a DEX to JAR convertor, jdgui, or Java decompilers</li><li class="listitem" style="list-style-type: disc">Tools such as DroidProxy or Autoproxy for Android</li></ul></div></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec38"/>How to do it...</h2></div></div></div><p>Let's look at each of these tools:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Android SDK, emulators, and ADB<p>We already learned about these in previous recipes in this chapter.</p></li><li class="listitem" style="list-style-type: disc">Emulators with different Android versions configured<p>Refer to the AVD Manager screenshot shown in a previous recipe. There, we used API level 21 and created an emulator for Android version 5.0.1. Using the new option there, we can create more emulators for different API levels and for different Android versions.</p><p>These different versions will come in handy when applications to be pentested are developed for specific versions. They also come in handy when specific mobile application features are present in specific Android versions.</p></li><li class="listitem" style="list-style-type: disc">One or two Android handsets or tablets (rooted)<p>It is optional to have physical devices, but they do come in handy. Sometimes we see that applications crash, emulators are slow, or proxy tools in combination with emulators are too slow/crash often, making it difficult to test the application with emulators. Having a physical mobile device comes in handy in such cases.</p></li><li class="listitem" style="list-style-type: disc">Proxy tools such as Charles, Burp Suite, and Fiddler<p>Various proxy tools can be downloaded from their websites. These are quite straightforward and there are guides and help forums about them as well. The installation of such tools is outside the scope of this book, but we will cover their configuration for mobile applications.</p><p>Here are some links to the most common proxy tools:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><a class="ulink" href="http://portswigger.net/burp/download.html">http://portswigger.net/burp/download.html</a></li><li class="listitem" style="list-style-type: disc"><a class="ulink" href="http://www.charlesproxy.com/download/">http://www.charlesproxy.com/download/</a></li><li class="listitem" style="list-style-type: disc"><a class="ulink" href="http://www.telerik.com/download/fiddler">http://www.telerik.com/download/fiddler</a></li></ul></div></li><li class="listitem" style="list-style-type: disc">A Wi-Fi network<p>We need a Wi-Fi network to intercept Wi-Fi traffic. We will later set up a proxy for a mobile device to a laptop running a proxy tool, both on the same Wi-Fi network.</p><p>You can either use a Wi-Fi router to set up your personal Wi-Fi network, or you can use one of the free tools available to create a hotspot from your laptop. In our experience, it is sometimes difficult to work with the latter option, so we prefer using the former.</p></li><li class="listitem" style="list-style-type: disc">Tools such as SQLite browser, text editors, and XML viewers<p>These are additional tools to read the data extracted from phones. Again, these are free downloads or you may already have them.</p></li><li class="listitem" style="list-style-type: disc">A data cable<p>It is also important to own a data cable. Later we will use it to connect the phone in order to read its data and conduct attacks that originate via USB.</p></li><li class="listitem" style="list-style-type: disc">Tools such as a DEX to JAR convertor, jdgui, or Java decompilers<p>It is also important that these tools are ready in our lab. These small tools help us in the decompilation of Android applications.</p></li><li class="listitem" style="list-style-type: disc">Tools such as DroidProxy or Autoproxy for Android<p>Since previous versions of Android did not have a feature to direct the OS to set a proxy, we need such tools to be downloaded from Google Play Store.</p></li></ul></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec39"/>How it works...</h2></div></div></div><p>With the tools ready in our pentesting lab, let's see how we can link the penetration testing use cases to different categories while using the tools:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Mobile application traffic-related attacks</strong></span>: This is where Wi-Fi network and proxy tools are going to come in handy. A laptop with a Charles or Burp proxy installed is connected to Wi-Fi. A mobile device running the application is directed to the laptop proxy, using the proxy configuration on the device. Since both the laptop and the mobile device are on the same Wi-Fi network, application traffic gets routed via the Charles or Burp proxy tool. Use tools like DroidProxy or Autoproxy for Android devices to set a proxy if required.<p>Effectively, this whole process makes application traffic readable and editable via proxy tools so we can conduct various attacks, which will be seen in another chapter.</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Mobile device storage-related attacks</strong></span>: We have a data cable to connect the phone to the laptop. We have the emulator on the laptop. Both of them can run mobile applications. We also have a very powerful tool, ADB, with us; it can connect to, and steal data from, devices or emulators, as well as performing many other possible attacks.</li></ul></div></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Mobile application source code-related attacks</strong></span>: Decompiling the Android application can be broken into two steps: APK to DEX conversion and DEX to JAR conversion.<p>APK is the Android application package. Once the Android application is developed and packed, the resulting file format is <code class="literal">.apk</code>. Mobile applications are named <code class="literal">&lt;filename&gt;.apk</code>.</p><p>APK to DEX conversion is quite straightforward; it just involves renaming and unzipping the archived files.</p><p><code class="literal">.dex</code> to <code class="literal">.jar</code> conversion is achieved via tools such as DEX to JAR converters.</p></li></ul></div></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec40"/>There's more...</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="emphasis"><em>Attacks involving mobile OS features used by mobile applications</em></span></li></ul></div></div></div>
<div class="section" title="Setting up the iOS pentesting environment"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec17"/>Setting up the iOS pentesting environment</h1></div></div></div><p>Now that you are well acquainted with the iOS development environment and simulators, and have coded your first application as well, it is time to learn about penetration testing for iOS applications. Penetration testing for mobile applications can be broadly classified into four categories, as we saw in the previous recipe:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Mobile application traffic-related attacks</li><li class="listitem" style="list-style-type: disc">Mobile device storage-related attacks</li><li class="listitem" style="list-style-type: disc">Mobile application source code-related attacks</li><li class="listitem" style="list-style-type: disc">Attacks involving mobile OS features used by mobile applications</li></ul></div><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec41"/>Getting ready</h2></div></div></div><p>We have to set up a lab for iOS pentesting, which should be sufficiently well equipped to be able to conduct testing for test cases that fall into the four categories listed previously.</p><p>To get going, we need a minimum of the following tools. The list is not very different from Android, but includes some specific tools:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">iOS simulators</li><li class="listitem" style="list-style-type: disc">Xcode</li><li class="listitem" style="list-style-type: disc">iExplorer</li><li class="listitem" style="list-style-type: disc">One or two iPhones or iPads (jailbroken)</li><li class="listitem" style="list-style-type: disc">Proxy tools such as Charles, Burp Suite, and Fiddler</li><li class="listitem" style="list-style-type: disc">A Wi-Fi network</li><li class="listitem" style="list-style-type: disc">Tools such as SQLite browser, text editors, XML viewers, and plist editors</li><li class="listitem" style="list-style-type: disc">A data cable</li><li class="listitem" style="list-style-type: disc">Tools such as otool and <span class="strong"><strong>classdump</strong></span></li></ul></div></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec42"/>How to do it...</h2></div></div></div><p>Let's look at each of these tools:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">iOS simulators<p>We will use iOS Simulators to run iOS applications where we have the application code available to us. In such cases, testing can be conducted from just one MacBook with all the tools installed (no need for Wi-Fi or mobile handsets).</p></li><li class="listitem" style="list-style-type: disc">Xcode<p>Xcode is the IDE for iOS applications. It is not only helpful for reviewing the source code of an iOS application, but also comes in handy in terms of viewing certain files, which open in Xcode only.</p></li><li class="listitem" style="list-style-type: disc">iExplorer<p>iExplorer can be downloaded on a MacBook from the Apple App Store. A Windows version of this can also be downloaded when working with iPhones or iPads connected to a Windows machine via a data cable.</p><p>iExplorer, like Windows Explorer, helps to navigate the filesystem. It can be used to explore, read files, and steal data from iOS devices.</p></li><li class="listitem" style="list-style-type: disc">One or two iPhones or iPads (jailbroken)<p>A jailbroken iOS device comes in handy. The applications installed on these devices can be pentested from the device itself, eliminating the requirement for Simulators.</p></li><li class="listitem" style="list-style-type: disc">Proxy tools such as Charles, Burp Suite, and Fiddler<p>Various proxy tools can be downloaded from their websites. These are quite straightforward and there are guides and help forums about them as well. The installation of such tools is outside the scope of this book, but we will cover the configuration of them for mobile applications.</p><p>Here are links to the most common proxy tools:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><a class="ulink" href="http://portswigger.net/burp/download.html">http://portswigger.net/burp/download.html</a></li><li class="listitem" style="list-style-type: disc"><a class="ulink" href="http://www.charlesproxy.com/download/">http://www.charlesproxy.com/download/</a></li><li class="listitem" style="list-style-type: disc"><a class="ulink" href="http://www.telerik.com/download/fiddler">http://www.telerik.com/download/fiddler</a></li></ul></div></li><li class="listitem" style="list-style-type: disc">A Wi-Fi network<p>We need a Wi-Fi network to intercept Wi-Fi traffic. We will later set up a proxy for a mobile device to a laptop running a proxy tool, with both on the same Wi-Fi network.</p><p>Either you can use a Wi-Fi router to set up your personal Wi-Fi network, or you can use one of the free tools available to create a hotspot from your laptop. In our experience, it is sometimes difficult to work with the latter option, so we prefer using the former.</p></li><li class="listitem" style="list-style-type: disc">Tools such as SQLite browser, text editors, XML viewers, and plist editors<p>These are additional tools for reading the data extracted from phones. Again these are free to download, or you may already have them.</p><p>plist files are used in iOS applications to store data, and plist editors are useful in reading such files.</p></li><li class="listitem" style="list-style-type: disc">A data cable<p>It is also important to own a data cable. Later, we will use it to connect to the phone in order to read data and conduct attacks that originate via USB.</p></li><li class="listitem" style="list-style-type: disc">Tools such as otool and classdump<p>These tools are decompilation tools for iOS applications.</p></li></ul></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec43"/>How it works...</h2></div></div></div><p>With the tools ready in our pentesting lab, let's see how we can link the penetration testing use cases to different categories while using these tools:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Mobile application traffic-related attacks</strong></span>: This is where a Wi-Fi network and proxy tools are going to come in handy. A laptop with a Charles or Burp proxy installed is connected to Wi-Fi. An iOS device running the application is directed to the laptop proxy, using the proxy configuration on the device. Since both the laptop and the mobile device are on the same Wi-Fi network, application traffic is routed via the Charles or Burp proxy tool. This setup does not require a MacBook (any other laptop will do), but an iOS device is needed.<p>Another possibility is that we can use a MacBook but not an iOS device. In this case, we will run the application via Xcode and the Simulator. The proxy is set to localhost on the MacBook, where we are running a proxy tool such as Burp or Charles.</p><p>Effectively, both approaches make application traffic readable and editable via proxy tools, and we can conduct various attacks, which will be seen in another chapter.</p></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Mobile device storage-related attacks</strong></span>: We have a data cable to connect the iPhone or iPad to the laptop. We can use the iExplorer tool on the laptop to read and steal files and other data.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Mobile application source code-related attacks</strong></span>: We discussed the otool and classdump tools. Only a limited decompilation is possible in the case of iOS applications, and these tools can help only up to a certain point. This will be covered in detail in one of the later chapters.</li></ul></div></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec44"/>There's more...</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="emphasis"><em>Attacks involving mobile OS features used by mobile applications</em></span></li></ul></div><p>This is the most complicated category and becomes further complicated in the case of the iOS platform. There are various iOS features that applications interact with, such as screenshot backgrounding, Bluetooth, NFC, and so on. The interaction of these features with the application, along with the insecure implementation of these features in the application, results in vulnerabilities. A popular example is the screenshot backgrounding vulnerability in iOS applications.</p></div></div>
<div class="section" title="Introduction to rooting and jailbreaking"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec18"/>Introduction to rooting and jailbreaking</h1></div></div></div><p>Fundamentally, rooting is obtaining root access to the underlying Linux system, in order to perform operations such as mounting/unmounting filesystems; running SSH, HTTP, DHCP, DNS or proxy daemons; killing system processes; and so on.</p><p>Being able to run commands as the root user allows us to do anything on Linux and thus, by extension, on an Android system.</p><p>Jailbreaking is the process of privilege escalation, by which we can remove the hardware level restrictions imposed by Apple on iOS devices. Jailbreaking permits root access to the iOS filesystem and manager, allowing the downloading of additional applications, extensions, and themes that are unavailable through the official Apple App Store.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec45"/>Getting ready</h2></div></div></div><p>All that is needed to root an Android device is a USB cable; an unrooted Android device; and an exploit code to be run on the device, either through ADB, one-click-root programs/apps, or a modified ROM that can be flashed onto the device.</p><p>The requirements for an iOS jailbreak are a USB Cable, an iOS device, and a jailbreaking program.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec46"/>How to do it...</h2></div></div></div><p>Here we will go through two steps; rooting and jailbreaking.</p><div class="section" title="Rooting"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec0"/>Rooting</h3></div></div></div><p>The actual rooting process itself should only take a single click. However, you'll need to do a few quick things first:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Download and install the Java JDK and Android SDK on your computer before continuing. Java must be installed before the Android SDK.</li><li class="listitem">Enable <span class="strong"><strong>USB debugging</strong></span> on your Android. On the device, go into the <span class="strong"><strong>Settings</strong></span> screen, tap <span class="strong"><strong>Applications</strong></span>, tap <span class="strong"><strong>Development</strong></span>, and enable the <span class="strong"><strong>USB debugging</strong></span> checkbox:<p>
</p><div class="mediaobject"><img src="graphics/image_01_017.jpg" alt="Rooting"/></div><p>
</p><p>After this, the rooting process essentially involves finding tested rooting methods for your specific device by searching the Internet. The rooting processes for most Android devices can be categorized into the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Using a rooting application</strong></span>: In this process you perform the following tasks:<div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Install the rooting application on your machine</li><li class="listitem">Connect the Android device with <span class="strong"><strong>USB debugging</strong></span> enabled</li><li class="listitem">Follow the simple instructions to root your device</li></ol></div><p>
</p></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Using rooting apps</strong></span>: In this process you perform the following tasks:<div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Download the rooting APK</li><li class="listitem">Enable <span class="strong"><strong>USB debugging</strong></span> mode and allow installation from unknown sources, from the development settings of the Android device</li><li class="listitem">Install the rooting APK using <code class="literal">adb install /path/to/apk</code></li><li class="listitem">Follow the onscreen instructions to root the Android device</li></ol></div><p>
</p></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Flashing a custom ROM</strong></span>: In this process you perform the following tasks:<div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Copy the modified ROM to the SD card of the Android device (as a <code class="literal">.zip</code> file)</li><li class="listitem">Reboot the device in recovery mode</li><li class="listitem">Head to the <span class="strong"><strong>install</strong></span> or <span class="strong"><strong>install zip from sdcard</strong></span> section of the recovery menu</li><li class="listitem">Navigate to the <code class="literal">.zip</code> file, and select it from the list to flash it</li></ol></div><p>
</p></li></ul></div></li></ol></div></div><div class="section" title="Jailbreaking"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec1"/>Jailbreaking</h3></div></div></div><p>Before performing a jailbreak, you should back up your device. If for any reason the jailbreak fails, you can restore the backup.</p><p>The jailbreaking process involves downloading the program to a Mac/Windows machine, connecting our iOS device to our machine via a USB cable, and running the tool. One such tool is <span class="strong"><strong>evasi0n</strong></span>:</p><p>
</p><div class="mediaobject"><img src="graphics/image_01_018.jpg" alt="Jailbreaking"/></div><p>
</p><p>The instructions are mentioned along with the tool, and should be followed methodically.</p><p>As a part of the jailbreaking process, the tool installs Cydia on the target iOS device.</p><p>Cydia is an alternative App store containing iOS apps other than ones provided and usually <span class="emphasis"><em>approved</em></span> by Apple. Most of these apps are developed by the jailbreaking community, such as tools for using custom themes and widgets, changing default apps, and so on.</p><p>
</p><div class="mediaobject"><img src="graphics/image_01_019.jpg" alt="Jailbreaking"/></div><p>
</p></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec47"/>How it works...</h2></div></div></div><p>Let's take a look at the details with reference to the processes individually.</p><div class="section" title="Rooting"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec2"/>Rooting</h3></div></div></div><p>Being able to run commands as the root user allows us to do anything on Linux and thus, by extension, on an Android system.</p><p>The process for rooting an Android device typically involves two steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Find an exploit that allows the execution of arbitrary code as <code class="literal">root</code>.</li><li class="listitem">Use the exploit to install <code class="literal">su</code>.</li></ol></div><p>If the target device has an unlocked <span class="strong"><strong>bootloader</strong></span>, the process is pretty easy. An unpackaged bootloader allows the flashing of arbitrary ROMs, so <code class="literal">su</code> can be added to a stock ROM and repackaged into a modified ROM. All the user needs to do is to reboot the device into flashing mode by pressing a combination of keys during bootup, and use the device's utilities to flash the modified ROM onto the device.</p><p>But, what about devices that have locked bootloaders? You can only interact with unprivileged programs on the system and they cannot help you execute any privileged code.</p><p>Many programs, such as system services, run as root on Android, to be able to access underlying hardware resources.</p><p>All one-click-root methods exploit vulnerabilities in one of these system processes running in privileged mode to execute a particular piece of code that mounts the system in read-write mode and installs the <code class="literal">su</code> binary on the system, thus gaining privileged access to the system.</p></div><div class="section" title="Jailbreaking"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec3"/>Jailbreaking</h3></div></div></div><p>The jailbreaking process differs from tool to tool, and different procedures are followed for different iOS versions. Here, we analyze the anatomy of one such tool, used to jailbreak an iPhone 5.</p><p>The jailbreaking program begins by running <code class="literal">libimobiledevice</code> to exploit a bug in iOS's mobile backup system in order to gain access to a normally restricted file containing the time zone settings.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note11"/>Note</h3><p>libimobiledevice is a cross-platform software library which "talks" the protocols that support iOS devices. It allows other software to easily access the device's filesystem; retrieve information about the device and its internals; back up and restore the device; manage installed applications; retrieve address books, calendars, notes and bookmarks; and synchronize music and video to the device.</p><p>More information can be found at <a class="ulink" href="http://www.libimobiledevice.org/">http://www.libimobiledevice.org/</a>.</p></div></div><p>It then inserts a "symbolic link" to a certain altered "socket," which allows programs to communicate with <span class="strong"><strong>launchd</strong></span>, a master process which is loaded whenever an iOS device boots up and can launch applications that require "root" privileges.</p><p>So now, whenever an iOS mobile backup runs, all programs will automatically be granted access to the time zone file, and therefore access to launchd.</p><p>Pretty neat, huh?</p><p>iOS implements code-signing as a safeguard to prevent any "untrusted" application from gaining access to launchd.</p><p>So to defeat code signing, the jailbreaking tool launches a new, unsigned, seemingly benign app. But when the user is prompted to tap the app's icon, the app uses a technique called shebang to call up code from another signed application, which in this case was launchd.</p><p>A shebang is a character sequence consisting of the hash symbol and exclamation mark characters (that is, <code class="literal">#!</code>) at the beginning of a script.</p><p>In Unix, when a script with a shebang is run as a program, the program loader parses the rest of the script's initial line as an interpreter directive; the specified interpreter program is run instead, passing to it as an argument the path that was initially used when attempting to run the script.</p><p>For example, if a code has the path <code class="literal">path/to/code</code>, and it starts with <code class="literal">#!/bin/sh</code>, then the program loader is instructed to run the program <code class="literal">/bin/sh</code> instead, passing <code class="literal">path/to/code</code> as the first argument.</p><p>launchd is then used to run the <code class="literal">remount</code> command, which changes the memory settings of the read-only root file system to be writable.</p><p>To make the jailbreak "persistent", the <code class="literal">launchd.conf</code> file is called to alter the launchd configurations. The user now does not need to re-run the program on every reboot.</p><p>The jailbreaking tool then moves on to its last feat, removing restrictions at the kernel level. The iOS kernel uses <span class="strong"><strong>Apple Mobile File Integrity Daemon</strong></span> (<span class="strong"><strong>AMFID</strong></span>) to run unapproved apps from using a process. The jailbreaking program leverages launchd once again, to load a library of functions into AMFID in order to always approve all apps.</p><p>The second restriction posed by the kernel is <span class="strong"><strong>Address Space Layout Randomization</strong></span> (<span class="strong"><strong>ASLR</strong></span>), used to prevent the alteration of memory by randomizing or "hiding" the device's code every time it boots. This would prevent someone from write over a particular part of the code.</p><p>The jailbreaking tool then uses a neat trick to locate one particular area in memory; the ARM exception vector. This part handles app crashes, indicating the part of memory where the crash occurred.</p><p>A crash is simulated by the jailbreaking tool, checking the ARM exception vector to see where the crash occurred and collecting minimal information, enough to map out the rest of the kernel.</p><p>The tool, as its final step, uses a bug in iOS's USB interface that passes an address in the kernel's memory to a program and expects the program to return it untampered.</p><p>This allows the tool to write to the part of the kernel that restricts code changes, thus taking complete control, and fulfilling its purpose successfully!</p></div></div></div></body></html>