<html><head></head><body>
<div id="sbo-rt-content"><div id="_idContainer004">
<h1 id="_idParaDest-5"><a id="_idTextAnchor004"/>Preface</h1>
<p>Almost every day we hear about new breaches, data leaks, or ransomware attacks. Cybercrime nowadays is a big business that constantly strives for improvement. It is no longer a one-man show; cybercriminals have their own methodology, tooling, and qualified staff. The way to defend against them is to understand how they attack, their tactics, and <span class="No-Break">their techniques.</span></p>
<p>We will apply this approach against various products of the most popular software vendor – Microsoft. This book is focused purely on Windows-based infrastructure because on-premises infrastructure is still a big thing for most companies. In this book, I will take you through an attack kill chain against<em class="italic"> </em><strong class="bold">Active Directory</strong><em class="italic"> (</em><strong class="bold">AD</strong><em class="italic">), </em>Active Directory Certificate Services, Microsoft Exchange Server, Microsoft SQL Server, and<em class="italic"> </em><strong class="bold">System Center Configuration Manager</strong><em class="italic"> (</em><strong class="bold">SCCM</strong><em class="italic">). </em>During the process, you will be introduced to known tactics and techniques with a lot of <span class="No-Break">hands-on exercises.</span></p>
<p>By the end of the book, you will be able to perform a hands-on comprehensive security assessment of Windows-based infrastructure. In addition, you will receive recommendations on how to detect adversary activity and <span class="No-Break">remediation suggestions.</span></p>
<h1 id="_idParaDest-6"><a id="_idTextAnchor005"/>Who this book is for</h1>
<p>This book is truly intended to be an all-in-one guide for security professionals who work with Windows-based infrastructure, especially AD. Penetration testers and red team operators will find practical attack scenarios that they may encounter during real-life assessments. Security and IT engineers, as well as blue teamers and incident responders, will benefit from detection and remediation guidelines. To get the most out of this book, you should have basic knowledge of Windows services <span class="No-Break">and AD.</span></p>
<h1 id="_idParaDest-7"><a id="_idTextAnchor006"/>What this book covers</h1>
<p><a href="B18964_01.xhtml#_idTextAnchor012"><span class="No-Break"><em class="italic">Chapter 1</em></span></a>, <em class="italic">Getting the Lab Ready and Attacking Exchange Server</em>, provides an overview of the attack kill chain, shows you how to deploy the lab environment, and focuses on Exchange Server attack surfaces with <span class="No-Break">practical examples.</span></p>
<p><a href="B18964_02.xhtml#_idTextAnchor025"><span class="No-Break"><em class="italic">Chapter 2</em></span></a>, <em class="italic">Defense Evasion</em>, teaches you about evading <strong class="bold">Antimalware Scan Interface</strong> (<strong class="bold">AMSI</strong>) and AppLocker, PowerShell enhanced logging, Sysmon, and <strong class="bold">Event Tracing for </strong><span class="No-Break"><strong class="bold">Windows</strong></span><span class="No-Break"> (</span><span class="No-Break"><strong class="bold">ETW</strong></span><span class="No-Break">).</span></p>
<p><a href="B18964_03.xhtml#_idTextAnchor040"><span class="No-Break"><em class="italic">Chapter 3</em></span></a>, <em class="italic">Domain Reconnaissance and Discovery</em>, is where you will learn how to perform reconnaissance in a domain, blend into environment traffic, and learn more about the internals of tools such as BloodHound and Microsoft <strong class="bold">Advanced Threat </strong><span class="No-Break"><strong class="bold">Analytics</strong></span><span class="No-Break"> (</span><span class="No-Break"><strong class="bold">ATA</strong></span><span class="No-Break">).</span></p>
<p><a href="B18964_04.xhtml#_idTextAnchor061"><span class="No-Break"><em class="italic">Chapter 4</em></span></a>, <em class="italic">Credential Access in a Domain</em>, covers ways to obtain credentials in the domain environment by capturing the hash, coercing authentication, “roasting” Kerberos, reading clear-text passwords if <strong class="bold">Local Administrator Password Solution</strong> (<strong class="bold">LAPS</strong>) is misconfigured, and collecting hashes of gMSA accounts or of a whole domain <span class="No-Break">via DCSync.</span></p>
<p><a href="B18964_05.xhtml#_idTextAnchor093"><span class="No-Break"><em class="italic">Chapter 5</em></span></a>, <em class="italic">Lateral Movement in Domain and Across Forests</em>, shows how an adversary can maneuver across an environment by abusing different types of delegation, passing different types of credential materials, relaying captured hashes, as well as moving to <span class="No-Break">other forests.</span></p>
<p><a href="B18964_06.xhtml#_idTextAnchor119"><span class="No-Break"><em class="italic">Chapter 6</em></span></a>, <em class="italic">Domain Privilege Escalation</em>, is where we will focus on ways to elevate privileges in a domain by abusing misconfigured <strong class="bold">Access Control Lists</strong> (<strong class="bold">ACL</strong>), <strong class="bold">Group Policy Objects</strong> (<strong class="bold">GPO</strong>), and special built-in groups, as well as moving from a child domain to a <span class="No-Break">parent domain.</span></p>
<p><a href="B18964_07.xhtml#_idTextAnchor146"><span class="No-Break"><em class="italic">Chapter 7</em></span></a>, <em class="italic">Persistence on Domain Level</em>, shows techniques to establish persistence on the domain level by forging tickets and manipulating ACLs and objects, as well as on the domain controller itself by adding a Skeleton Key, malicious SSP, a registry backdoor, and <span class="No-Break">so on.</span></p>
<p><a href="B18964_08.xhtml#_idTextAnchor163"><span class="No-Break"><em class="italic">Chapter 8</em></span></a>, <em class="italic">Abusing Active Directory Certificate Services</em>, covers the fundamentals of <strong class="bold">Public Key Infrastructure</strong> (<strong class="bold">PKI</strong>) implementation by Microsoft, along with ways to steal certificates, escalate privileges in the domain, and achieve persistence on account and <span class="No-Break">domain levels.</span></p>
<p><a href="B18964_09.xhtml#_idTextAnchor191"><span class="No-Break"><em class="italic">Chapter 9</em></span></a>, <em class="italic">Compromising Microsoft SQL Server</em>, is where we will focus on how to attack SQL Server, including enumeration, privilege escalation, lateral movement, <span class="No-Break">and persistence.</span></p>
<p><a href="B18964_10.xhtml#_idTextAnchor222"><span class="No-Break"><em class="italic">Chapter 10</em></span></a>, <em class="italic">Taking over WSUS and SCCM</em>, provides an overview of IT support management software and ways to abuse its functionality, leading to a complete takeover of the <span class="No-Break">whole environment.</span></p>
<h1 id="_idParaDest-8"><a id="_idTextAnchor007"/>To get the most out of this book</h1>
<table class="No-Table-Style" id="table001">
<colgroup>
<col/>
<col/>
</colgroup>
<tbody>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><strong class="bold">Software/hardware covered in </strong><span class="No-Break"><strong class="bold">the book</strong></span></p>
</td>
<td class="No-Table-Style">
<p><strong class="bold">Operating </strong><span class="No-Break"><strong class="bold">system requirements</strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p>Windows <span class="No-Break">Active Directory</span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break">Linux host</span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p>Windows Services – WSUS and <span class="No-Break">AD CS</span></p>
</td>
<td class="No-Table-Style">
<p>Kali <span class="No-Break">virtual machine</span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break">Exchange Server</span></p>
</td>
<td class="No-Table-Style"/>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break">SQL Server</span></p>
</td>
<td class="No-Table-Style"/>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break">SCCM</span></p>
</td>
<td class="No-Table-Style"/>
</tr>
</tbody>
</table>
<h1 id="_idParaDest-9"><a id="_idTextAnchor008"/>Conventions used</h1>
<p>There are a number of text conventions used throughout <span class="No-Break">this book.</span></p>
<p><strong class="source-inline">Code in text</strong>: Indicates code words in text, database table names, folder names, filenames, file extensions, pathnames, dummy URLs, user input, and Twitter handles. Here is an example: “<strong class="source-inline">MailSniper</strong> calculates the time difference between authentication <span class="No-Break">attempt responses.”</span></p>
<p>Any command-line input or output is written <span class="No-Break">as follows:</span></p>
<pre class="console">
[InternetShortcut]
URL=any
WorkingDirectory=any
IconFile=\\192.168.56.100\%USERNAME%.icon
IconIndex=1</pre> <p><strong class="bold">Bold</strong>: Indicates a new term, an important word, or words that you see on screen. For instance, words in menus or dialog boxes appear in <strong class="bold">bold</strong>. Here is an example: “We will cover attack detection and possible prevention measures, as well as offensive <strong class="bold">Operational </strong><span class="No-Break"><strong class="bold">Security</strong></span><span class="No-Break"> (</span><span class="No-Break"><strong class="bold">OpSec</strong></span><span class="No-Break">)</span><span class="No-Break">.”</span></p>
<p class="callout-heading">Tips or important notes</p>
<p class="callout">Appear like this.</p>
<h1 id="_idParaDest-10"><a id="_idTextAnchor009"/>Get in touch</h1>
<p>Feedback from our readers is <span class="No-Break">always welcome.</span></p>
<p><strong class="bold">General feedback</strong>: If you have questions about any aspect of this book, email us at <a href="mailto:customercare@packtpub.com">customercare@packtpub.com</a> and mention the book title in the subject of <span class="No-Break">your message.</span></p>
<p><strong class="bold">Errata</strong>: Although we have taken every care to ensure the accuracy of our content, mistakes do happen. If you have found a mistake in this book, we would be grateful if you would report this to us. Please visit <a href="http://www.packtpub.com/support/errata">www.packtpub.com/support/errata</a> and fill in <span class="No-Break">the form.</span></p>
<p><strong class="bold">Piracy</strong>: If you come across any illegal copies of our works in any form on the internet, we would be grateful if you would provide us with the location address or website name. Please contact us at <a href="mailto:copyright@packtpub.com">copyright@packtpub.com</a> with a link to <span class="No-Break">the material.</span></p>
<p><strong class="bold">If you are interested in becoming an author</strong>: If there is a topic that you have expertise in and you are interested in either writing or contributing to a book, please <span class="No-Break">visit </span><a href="http://authors.packtpub.com"><span class="No-Break">authors.packtpub.com</span></a><span class="No-Break">.</span></p>
<h1 id="_idParaDest-11"><a id="_idTextAnchor010"/>Share Your Thoughts</h1>
<p>Once you’ve read <em class="italic">Pentesting Active Directory and Windows-based Infrastructure</em>, we’d love to hear your thoughts! Please <a href="https://packt.link/r/1804611360">click here to go straight to the Amazon review page</a> for this book and share <span class="No-Break">your feedback.</span></p>
<p>Your review is important to us and the tech community and will help us make sure we’re delivering excellent <span class="No-Break">quality content.</span></p>
<h1 id="_idParaDest-12"><a id="_idTextAnchor011"/>Download a free PDF copy of this book</h1>
<p>Thanks for purchasing <span class="No-Break">this book!</span></p>
<p>Do you like to read on the go but are unable to carry your print <span class="No-Break">books everywhere?</span></p>
<p>Is your eBook purchase not compatible with the device of <span class="No-Break">your choice?</span></p>
<p>Don’t worry, now with every Packt book you get a DRM-free PDF version of that book at <span class="No-Break">no cost.</span></p>
<p>Read anywhere, any place, on any device. Search, copy, and paste code from your favorite technical books directly into <span class="No-Break">your application.</span></p>
<p>The perks don’t stop there, you can get exclusive access to discounts, newsletters, and great free content in your <span class="No-Break">inbox daily</span></p>
<p>Follow these simple steps to get <span class="No-Break">the benefits:</span></p>
<ol>
<li>Scan the QR code or visit the <span class="No-Break">link below</span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer003">
<img alt="" height="200" role="presentation" src="image/B18964_QR_Free_PDF.jpg" width="200"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><a href="https://packt.link/free-ebook/9781804611364">https://packt.link/free-ebook/9781804611364</a></p>
<ol>
<li value="2">Submit your proof <span class="No-Break">of purchase</span></li>
<li>That’s it! We’ll send your free PDF and other benefits to your <span class="No-Break">email directly</span></li>
</ol>
</div>
</div></body></html>