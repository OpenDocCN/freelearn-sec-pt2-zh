<html><head></head><body>
		<div id="_idContainer151">
			<h1 id="_idParaDest-33"><em class="italic"><a id="_idTextAnchor033"/>Chapter 3</em>: I Love My Bits – Lab Setup</h1>
			<p>So far, we have been mostly configuring the connectivity of the network. Now, we'll take it to the next level. In this chapter, we are going to configure a simple <strong class="bold">program</strong> and use the software installed on the Windows 7 <strong class="bold">virtual machine</strong> (<strong class="bold">VM</strong>) to physically change the <strong class="bold">I/O</strong> on the PLC. This will pass through the VM interface, through the virtual switch, to the physical adapter. Then, it will pass to a <em class="italic">physically</em> managed switch and out to the PLC. This chapter will expand on the lab that we started to set up earlier in <a href="B16321_02_Epub_AM.xhtml#_idTextAnchor027"><em class="italic">Chapter 2</em></a>, <em class="italic">Routing the Hardware</em>. We will go through a demo approach using <strong class="bold">Koyo Click PLC</strong> and <strong class="bold">Human Machine Interfaces</strong> (<strong class="bold">HMI</strong>) I and connect it to physical I/O to learn how to turn lights on and off, utilizing both the <strong class="bold">graphical user interface</strong> and <strong class="bold">scripting</strong>.</p>
			<p>In this chapter, we're going to cover the following main topics:</p>
			<ul>
				<li>Writing and downloading our first program</li>
				<li>Overriding and wiring the I/O</li>
				<li>Testing control</li>
			</ul>
			<h1 id="_idParaDest-34"><a id="_idTextAnchor034"/>Technical requirements </h1>
			<p>For this chapter, you will need the following: </p>
			<ul>
				<li>The <strong class="bold">Koyo Click</strong> software installed on our Windows 7 machine.</li>
				<li>A <strong class="bold">Koyo Click</strong> hardware power supply and PLC. </li>
				<li>A physical network switch to route traffic between PLC and ESXi.</li>
				<li>A Selector Switch Station Box to toggle power on/off to I/O.</li>
				<li>An Industrial Signal Tower Lamp to display visual feedback. </li>
				<li>A voltmeter to test continuity.</li>
				<li>A 14-gauge wire to wire both the Selector Switch Station Box and signal tower lamp to the PLC.</li>
				<li>Wire cutters and wire strippers to treat and prep the wire for installation.</li>
				<li>Screwdrivers (Phillips head and flathead) to open and close the terminal set screws.</li>
			</ul>
			<p>You can view this chapter's code in action here: <a href="https://bit.ly/3v5w61B">https://bit.ly/3v5w61B</a></p>
			<h1 id="_idParaDest-35"><a id="_idTextAnchor035"/>Writing and downloading our first program</h1>
			<p>Now comes the exciting part – writing our <em class="italic">hello world</em> program for the automation space. We are going to cover how to build a simple ladder logic program<a id="_idIndexMarker164"/> that will energize or de-energize a coil. This will help us establish a deeper understanding of how the Koyo Click software works. This is important as every PLC, SCADA, and <strong class="bold">Distributed Control System</strong> (<strong class="bold">DCS</strong>) follows the same set of guidelines and standards. Speaking of standards, one in particular that you should get familiar with is <em class="italic">IEC 61131-3</em>, as it helps define five core programming languages, as follows:</p>
			<ul>
				<li>Ladder diagram</li>
				<li>Functional block diagram</li>
				<li>Structured text</li>
				<li>Instruction list</li>
				<li>Sequential function chart</li>
			</ul>
			<p>Similar to software programming languages where the core fundamentals are common across all languages, only the syntax changes for the most part and with these five languages, three are graphical-based and two are text-based. The <strong class="bold">CLICK programming software</strong> utilizes a <strong class="bold">ladder diagram</strong> as the <a id="_idIndexMarker165"/>core programming language, also known<a id="_idIndexMarker166"/> as <strong class="bold">ladder logic</strong>, and it is the most common language that you will encounter in the process automation space. It mimics an electric circuit, allowing the inputs on the left-hand side to drive the outputs on the right-hand side. </p>
			<p>To start, we are going to open our Koyo Click software on our Windows 7 machine, as shown in the following screenshot:</p>
			<div>
				<div id="_idContainer100" class="IMG---Figure">
					<img src="image/Figure_3.01_B16321.jpg" alt="Figure 3.1 – Koyo Click software&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 3.1 – Koyo Click software</p>
			<p>Click the <strong class="bold">File</strong> option <a id="_idIndexMarker167"/>from the menu bar and then select <strong class="bold">New Project…</strong>, as shown here:</p>
			<div>
				<div id="_idContainer101" class="IMG---Figure">
					<img src="image/Figure_3.02_B16321.jpg" alt="Figure 3.2 – New Project…&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 3.2 – New Project…</p>
			<p>Next, you will be presented with a dialog box, as shown in the following screenshot. You need to double-click on the <strong class="bold">Start a new project</strong> icon:</p>
			<div>
				<div id="_idContainer102" class="IMG---Figure">
					<img src="image/Figure_3.03_B16321.jpg" alt="Figure 3.3 – Start a new project&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 3.3 – Start a new project</p>
			<p>At this point, we'll be <a id="_idIndexMarker168"/>taken to the <strong class="bold">Select a CPU Module</strong> window, as shown in the following screenshot. We will be using in the lab that was recommended in the previous chapter. Now, you might be asking yourself, "<em class="italic">Wait, wasn't there an easier way to do this?</em>", and you would be correct. In the previous chapter, we simply connected to the PLC and the software took care of auto detection and selecting the correct CPU for us. However, I want to show you that there is more than one way to establish a project. With that said, you will see a screen similar to the following, where you need to select <strong class="bold">C0-10ARE-D</strong>, which we discussed in the previous chapter:</p>
			<div>
				<div id="_idContainer103" class="IMG---Figure">
					<img src="image/Figure_3.04_B16321.jpg" alt="Figure 3.4 – Selecting a lab CPU&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 3.4 – Selecting a lab CPU</p>
			<p>From here, you can<a id="_idIndexMarker169"/> see detailed information about the CPU. We have eight AC inputs and six relay outputs, along with information about power consumption. Now, click <strong class="bold">OK</strong> to continue with the CPU selection process.</p>
			<p>Once you click it, you will be brought back to the programming screen, as shown here:</p>
			<div>
				<div id="_idContainer104" class="IMG---Figure">
					<img src="image/Figure_3.05_B16321.jpg" alt="Figure 3.5 – Main program&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 3.5 – Main program</p>
			<p>Before we start <a id="_idIndexMarker170"/>adding instructions to the ladder, we want to configure a few small details. Select the <strong class="bold">Setup</strong> menu option and then click <strong class="bold">System Configuration</strong>, as shown here:</p>
			<div>
				<div id="_idContainer105" class="IMG---Figure">
					<img src="image/Figure_3.06_B16321.jpg" alt="Figure 3.6 – System Configuration…&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 3.6 – System Configuration…</p>
			<p>This will take us to the<a id="_idIndexMarker171"/> following screen, which shows a graphical layout of<a id="_idIndexMarker172"/> our <strong class="bold">PLC chassis</strong>. Here, you can see that the CPU from our previous selection is shown and that a warning is displayed, indicating that we don't have enough power to supply to the CPU. This is simply because we have yet to set the <strong class="bold">Power Supply Unit</strong> (<strong class="bold">PSU</strong>) on this screen:</p>
			<div>
				<div id="_idContainer106" class="IMG---Figure">
					<img src="image/Figure_3.07_B16321.jpg" alt="Figure 3.7 – System Configuration window&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 3.7 – System Configuration window</p>
			<p>Click the <strong class="bold">Select</strong> button<a id="_idIndexMarker173"/> in the first column (the <strong class="bold">P/S</strong> column), as shown in the preceding screenshot. You will be presented with the option to select your power supply, as shown in the following screenshot. Select the power supply that you've purchased and installed in your lab:</p>
			<div>
				<div id="_idContainer107" class="IMG---Figure">
					<img src="image/Figure_3.08_B16321.jpg" alt="Figure 3.8 – The Select a Power Supply window&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 3.8 – The Select a Power Supply window</p>
			<p>Similar to the screen that<a id="_idIndexMarker174"/> we saw previously for the CPU, we can see more details in regard to the <strong class="bold">Power Supply</strong> we purchased, such as the input and output voltages and max power generated. Go ahead and click <strong class="bold">OK</strong> to select and apply the power supply to the chassis overview. You should now see an image that represents the power supply connected to the CPU. You will see that the warning has disappeared as the power is more than sufficient to power the CPU:</p>
			<div>
				<div id="_idContainer108" class="IMG---Figure">
					<img src="image/Figure_3.09_B16321.jpg" alt="Figure 3.9 – Updated System Configuration window&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 3.9 – Updated System Configuration window</p>
			<p>Now, click <strong class="bold">OK</strong> and jump<a id="_idIndexMarker175"/> right into the program. We want to create a simple program that allows us to push a button and turn on a light. However, before we start, I want to provide a very quick crash course on certain terminology:</p>
			<ul>
				<li><strong class="bold">Ladder</strong> and <strong class="bold">rungs</strong>: A ladder diagram<a id="_idIndexMarker176"/> is used to represent a control program in an electrical wiring framework. The power sources are the <em class="italic">vertical lines</em> (ladder), while the control circuits are the <em class="italic">horizontal lines</em> (rungs).</li>
				<li><strong class="bold">Instruction list</strong>: This is a<a id="_idIndexMarker177"/> list of graphical controls that are used to design the circuit for your program.</li>
				<li><strong class="bold">Contacts</strong>: A contact<a id="_idIndexMarker178"/> is a graphical representation of a binary selector, similar to that of a wall switch, for a lack of a better definition.</li>
				<li><strong class="bold">NO</strong>/<strong class="bold">NC</strong>: <strong class="bold">Normally Open</strong> and <strong class="bold">Normally Closed</strong> are terms for contacts where we want to control the <em class="italic">state</em> of the I/O. A normally open contact means that a circuit <a id="_idIndexMarker179"/>is running when the contact is open, and the inverse is true for normally closed.</li>
			</ul>
			<p>Now that we have a better understanding of the layout and terminology, the next step would be to drag a NO <strong class="bold">Contact</strong> to rung number one. Then, we should proceed to select the address by <a id="_idIndexMarker180"/>clicking the <strong class="bold">Address</strong> button on the right-hand side, as shown in the following screenshot: </p>
			<div>
				<div id="_idContainer109" class="IMG---Figure">
					<img src="image/Figure_3.10_B16321.jpg" alt="Figure 3.10 – Inserting a contact&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 3.10 – Inserting a contact</p>
			<p>A dialog box will appear, allowing us to select the address intended from the list of addresses available on Koyo Click. In the following screenshot, we can see the list options, including <strong class="bold">Address</strong>, <strong class="bold">Datatype</strong>, <strong class="bold">Nickname</strong>, and more:</p>
			<div>
				<div id="_idContainer110" class="IMG---Figure">
					<img src="image/Figure_3.11_B16321.jpg" alt="Figure 3.11 – Address Picker&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 3.11 – Address Picker</p>
			<p>Double-click the first <a id="_idIndexMarker181"/>address; that is, <strong class="source-inline">X001</strong>. This will populate your address choice, as shown in the following screenshot:</p>
			<div>
				<div id="_idContainer111" class="IMG---Figure">
					<img src="image/Figure_3.12_B16321.jpg" alt="Figure 3.12 – Address selected&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 3.12 – Address selected</p>
			<p>Once you have clicked the <strong class="bold">OK</strong> button, you should see that you now have a contact input with an address of <strong class="source-inline">X001</strong> on rung 1, as shown in the following screenshot: </p>
			<div>
				<div id="_idContainer112" class="IMG---Figure">
					<img src="image/Figure_3.13_B16321.jpg" alt="Figure 3.13 – Contact X001&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 3.13 – Contact X001</p>
			<p>So, now that we have <a id="_idIndexMarker182"/>an input, we are going to want an output. Grab the <strong class="source-inline">Out</strong> function under the <strong class="bold">Coil</strong> section of the <strong class="bold">Instruction List</strong> menu on the right-hand side of the user interface, as shown in the following screenshot:</p>
			<div>
				<div id="_idContainer113" class="IMG---Figure">
					<img src="image/Figure_3.14_B16321.jpg" alt="Figure 3.14 – Coil output&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 3.14 – Coil output</p>
			<p>Drag the <strong class="source-inline">Out</strong> function to the <strong class="bold">( NOP )</strong> location at the end of rung 1, as shown here:</p>
			<div>
				<div id="_idContainer114" class="IMG---Figure">
					<img src="image/Figure_3.15_B16321.jpg" alt="Figure 3.15 – Output&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 3.15 – Output</p>
			<p>Once the function locks in, it will create a dialog box, asking the programmer to configure <strong class="bold">Bit Memory</strong> addressing, as shown here:</p>
			<div>
				<div id="_idContainer115" class="IMG---Figure">
					<img src="image/Figure_3.16_B16321.jpg" alt="Figure 3.16 – Coil address&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 3.16 – Coil address</p>
			<p>Click the memory <a id="_idIndexMarker183"/>address picker icon; you will be presented with an <strong class="bold">Address Picker</strong> dialog box, similar to the once we encountered during the NO input contact step. The following screenshot shows that the address picker automatically displays the real-world list of output addresses:</p>
			<div>
				<div id="_idContainer116" class="IMG---Figure">
					<img src="image/Figure_3.17_B16321.jpg" alt="Figure 3.17 – Address Picker&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 3.17 – Address Picker</p>
			<p>Pick <strong class="source-inline">Y001</strong> as the output <a id="_idIndexMarker184"/>address for the coil that we placed onto rung 1 and select <strong class="bold">OK</strong>. As shown in the following screenshot, it has auto-populated the <strong class="bold">Bit Memory Address1:</strong> selection. You should see a green check mark next to the address to indicate that the address is a valid memory location:</p>
			<div>
				<div id="_idContainer117" class="IMG---Figure">
					<img src="image/Figure_3.18_B16321.jpg" alt="Figure 3.18 – Bit Memory Address&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 3.18 – Bit Memory Address</p>
			<p>Click <strong class="bold">OK</strong> to proceed and add the <strong class="bold">Coil</strong> to the output location, as shown in the following screenshot: </p>
			<div>
				<div id="_idContainer118" class="IMG---Figure">
					<img src="image/Figure_3.19_B16321.jpg" alt="Figure 3.19 – Coil output&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 3.19 – Coil output</p>
			<p>If you are wondering why we<a id="_idIndexMarker185"/> chose <strong class="source-inline">X001</strong> and <strong class="source-inline">Y001</strong> as the input and output addresses, look at the front of your CLICK PLC. On the terminal strip, find where the <strong class="bold">pin outs</strong> are labeled <strong class="bold">X1</strong> and <strong class="bold">Y1</strong>. These addresses relate directly to these I/O terminals, as shown in the following image:</p>
			<div>
				<div id="_idContainer119" class="IMG---Figure">
					<img src="image/Figure_3.20_B16321.jpg" alt="Figure 3.20 – Terminal pins&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 3.20 – Terminal pins</p>
			<p>Next, we need to add an <strong class="source-inline">END</strong> function to tell the program that we have concluded all operations. From the <strong class="bold">Instruction List</strong> menu, under the <strong class="bold">Program Control</strong> heading, select and drag the <strong class="bold">END</strong> function to the <strong class="bold">( NOP )</strong> location at the end of rung 2, as shown in the following screenshot:</p>
			<div>
				<div id="_idContainer120" class="IMG---Figure">
					<img src="image/Figure_3.21_B16321.jpg" alt="Figure 3.21 – Adding an END function&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 3.21 – Adding an END function</p>
			<p>After we add the <strong class="bold">END</strong> function, we <a id="_idIndexMarker186"/>want to check for syntax errors. It is a good idea to get into the habit of running <strong class="bold">syntax checks</strong> periodically so that you can catch any mistakes before they turn into major issues, as you develop more complex programs in the future. On the <strong class="bold">Program</strong> tab, double-click the <strong class="bold">Syntax Check</strong> option located in the <strong class="bold">Ladder Program</strong> folder, as shown here:</p>
			<div>
				<div id="_idContainer121" class="IMG---Figure">
					<img src="image/Figure_3.22_B16321.jpg" alt="Figure 3.22 – Syntax Check&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 3.22 – Syntax Check</p>
			<p>In the <strong class="bold">output window</strong>, you should see the outcome of the syntax check. If you have followed along closely, you should have similar results:</p>
			<div>
				<div id="_idContainer122" class="IMG---Figure">
					<img src="image/Figure_3.23_B16321.jpg" alt="Figure 3.23 – Syntax Check&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 3.23 – Syntax Check</p>
			<p>As you can see, there are <strong class="source-inline">0 error(s)</strong> and <strong class="source-inline">0 warning(s)</strong>. At this point, you should save the program and then write the project to your PLC. To write the project to your PLC, select the <strong class="bold">Write Project into PLC…</strong> option <a id="_idIndexMarker187"/>from the <strong class="bold">PLC</strong> menu, as shown in the following screenshot:</p>
			<div>
				<div id="_idContainer123" class="IMG---Figure">
					<img src="image/Figure_3.24_B16321.jpg" alt="Figure 3.24 – Write Project into PLC…&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 3.24 – Write Project into PLC…</p>
			<p>Once done, you will be presented with a dialog box that gives you a brief overview of a <strong class="bold">diff</strong> function, which we will use on the current PLC project versus the project that you will be writing into the PLC, as shown here:</p>
			<div>
				<div id="_idContainer124" class="IMG---Figure">
					<img src="image/Figure_3.25_B16321.jpg" alt="Figure 3.25 – Write Project into PLC window&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 3.25 – Write Project into PLC window</p>
			<p>If everything goes smoothly, you<a id="_idIndexMarker188"/> should see a <strong class="bold">Transfer completed</strong> dialog box, as shown here:</p>
			<div>
				<div id="_idContainer125" class="IMG---Figure">
					<img src="image/Figure_3.26_B16321.jpg" alt="Figure 3.26 – Transfer completed&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 3.26 – Transfer completed</p>
			<p>Next, you will be asked to change the <strong class="bold">PLC Modes</strong> setting from <strong class="bold">STOP</strong> to <strong class="bold">RUN</strong>, as shown here:</p>
			<div>
				<div id="_idContainer126" class="IMG---Figure">
					<img src="image/Figure_3.27_B16321.jpg" alt="Figure 3.27 – PLC Modes window&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 3.27 – PLC Modes window</p>
			<p>If everything worked<a id="_idIndexMarker189"/> correctly, you should see the following indicators:</p>
			<ul>
				<li>A green <strong class="bold">RUN</strong> status</li>
				<li>No <strong class="bold">PLC Error</strong> message</li>
				<li>The <strong class="bold">END</strong> function highlighted in blue</li>
				<li><strong class="bold">Output Window</strong> – <strong class="bold">Write Project to into PLC…</strong> </li>
				<li><strong class="bold">Output Window</strong> – <strong class="bold">Transfer completed</strong></li>
			</ul>
			<p>These indicators are shown in the following screenshot:</p>
			<div>
				<div id="_idContainer127" class="IMG---Figure">
					<img src="image/Figure_3.28_B16321.jpg" alt="Figure 3.28 – Running indicators&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 3.28 – Running indicators</p>
			<p>In this section, we learned how to create a simple program using inputs and outputs consisting of a Normally Open contact and a coil. We performed a syntax check and wrote the project to our PLC. This allowed us to get a deeper grasp of how the programming software <a id="_idIndexMarker190"/>works and some hands-on experience with creating and writing a project. These are the fundamentals to learn and are the building blocks of any automation and control-based project. In the next section, we are going to simulate a signal on our input to cause our program to produce an output. Then, we are going to energize the coil that we created in our program.</p>
			<h1 id="_idParaDest-36"><a id="_idTextAnchor036"/>Overriding and wiring the I/O </h1>
			<p>In the previous section, we created a simple <em class="italic">hello world</em> program and wrote it to our PLC. In this section, we are going to<a id="_idIndexMarker191"/> simulate a signal on our input contact to energize our coil on the <a id="_idIndexMarker192"/>output. We will be diving deeper into the functionality of the CLICK programming software, familiarizing ourselves with the data view, and <strong class="bold">overriding</strong> inputs to generate an energized coil. To do this, we are going to utilize a tool called <strong class="bold">Data View</strong>, which <a id="_idIndexMarker193"/>allows us to read and write values to the memory address that we selected for the Normally Open contact we created in the previous section.  </p>
			<p>To do this, open the <strong class="bold">Data View</strong> window from the <strong class="bold">Monitor</strong> menu, as shown in the following screenshot:</p>
			<div>
				<div id="_idContainer128" class="IMG---Figure">
					<img src="image/Figure_3.29_B16321.jpg" alt="Figure 3.29 – Data View selection&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 3.29 – Data View selection</p>
			<p>You will be presented with a blank table, as shown here:</p>
			<div>
				<div id="_idContainer129" class="IMG---Figure">
					<img src="image/Figure_3.30_B16321.jpg" alt="Figure 3.30 – Data View tool&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 3.30 – Data View tool</p>
			<p>Now, we are going<a id="_idIndexMarker194"/> to select the <strong class="bold">Address</strong> cell at row <strong class="source-inline">001</strong> and then click the <strong class="bold">Edit</strong> button in the left-hand corner of the dialog box, which will allow you to select the address picker we used previously. Here, we assigned addresses to<a id="_idIndexMarker195"/> both the <strong class="bold">contact input</strong> and the <strong class="bold">coil output</strong>. Next, you will see the auto populated address space starting at <strong class="source-inline">X001</strong>, and in the first memory address, you should see a <strong class="bold">Yes</strong> in the <strong class="bold">Used</strong> column for <strong class="source-inline">X001</strong>. This is feedback, telling us that we have used <strong class="source-inline">X001</strong> in our program. This can be seen in the following screenshot:</p>
			<div>
				<div id="_idContainer130" class="IMG---Figure">
					<img src="image/Figure_3.31_B16321.jpg" alt="Figure 3.31 – Address Picker&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 3.31 – Address Picker</p>
			<p>Go ahead <a id="_idIndexMarker196"/>and select <strong class="bold">X001</strong> and press the <strong class="bold">OK</strong> button. This will then<a id="_idIndexMarker197"/> populate the <strong class="bold">No.</strong> <strong class="bold">001</strong> row of our <strong class="bold">Data View</strong> tool. You will see the settings for <strong class="bold">Nickname</strong>, if you gave it one previously, our <strong class="bold">Current Value</strong>, our <strong class="bold">New Value</strong>, <strong class="bold">Write</strong> (for feedback), <strong class="bold">Viewing Format</strong>, and any address comments that you might have added. This is shown in the following screenshot:</p>
			<div>
				<div id="_idContainer131" class="IMG---Figure">
					<img src="image/Figure_3.32_B16321.jpg" alt="Figure 3.32 – X001 address selected&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 3.32 – X001 address selected</p>
			<p>Now, try <a id="_idIndexMarker198"/>selecting the <strong class="bold">ON</strong> button in the <strong class="bold">New Value</strong> column. An<a id="_idIndexMarker199"/> icon will appear in the <strong class="bold">Write</strong> column, which allows you to write the input value to the PLC. Double-click the icon to see what happens. Nothing should have happened at this point. The icon does write the value to PLC's memory space, but the pin I/O is primary and nothing has changed on the physical input on the PLC, so nothing has changed. It is because of this behavior that we must enable <strong class="bold">override</strong>. From the dialog box, we will see a selection for <strong class="bold">View Override</strong>. You need to enable this option. After doing so, you will see that a new column has been added next to the <strong class="bold">Write</strong> icon. An <strong class="bold">OVR</strong> button has been added, as shown in the following screenshot:</p>
			<div>
				<div id="_idContainer132" class="IMG---Figure">
					<img src="image/Figure_3.33_B16321.jpg" alt="Figure 3.33 – Override&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 3.33 – Override</p>
			<p>Double-click<a id="_idIndexMarker200"/> the <strong class="bold">OVR</strong> button, which will enable the <strong class="bold">Override</strong> functionality<a id="_idIndexMarker201"/> for this I/O.  The CLICK programming software turns on an <strong class="bold">Override</strong> indicator on the primary window, and also highlights the <strong class="bold">OVR</strong> button in yellow in the <strong class="bold">Data View</strong> window:</p>
			<div>
				<div id="_idContainer133" class="IMG---Figure">
					<img src="image/Figure_3.34_B16321.jpg" alt="Figure 3.34 – Override engaged&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 3.34 – Override engaged</p>
			<p>Now, try and rerun<a id="_idIndexMarker202"/> the operation we ran previously, select the <strong class="bold">ON</strong> button in the <strong class="bold">New Value</strong> column, and double-click the <strong class="bold">Write</strong> icon. You should hear the coil energizing on the PLC and visually see the lights enabled on it, as well as the programming<a id="_idIndexMarker203"/> software showing <strong class="bold">X001</strong> highlighted, along with <strong class="bold">Y001</strong>, as shown here:</p>
			<div>
				<div id="_idContainer134" class="IMG---Figure">
					<img src="image/Figure_3.35_B16321.jpg" alt="Figure 3.35 – Energized coil&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 3.35 – Energized coil</p>
			<p>If you do not see the highlighted input and output, as shown here, make sure to check that you have <strong class="bold">Status Monitor</strong> selected. It can be found in the <strong class="bold">Monitor</strong> menu, after selecting <strong class="bold">Status Monitor</strong>:</p>
			<div>
				<div id="_idContainer135" class="IMG---Figure">
					<img src="image/Figure_3.36_B16321.jpg" alt="Figure 3.36 – Status Monitor&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 3.36 – Status Monitor</p>
			<p>Go ahead and double-click the <strong class="bold">OFF</strong> button in the <strong class="bold">New Value</strong> column, as shown in the following screenshot. You should notice that by double-clicking the button, we save a step; this is simply to show that there are multiple ways to quickly override the input:</p>
			<div>
				<div id="_idContainer136" class="IMG---Figure">
					<img src="image/Figure_3.37_B16321.jpg" alt="Figure 3.37 – Input is off&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 3.37 – Input is off</p>
			<p>So far, everything<a id="_idIndexMarker204"/> we have done has been software focused. Now, we are <a id="_idIndexMarker205"/>going to use<a id="_idIndexMarker206"/> the <strong class="bold">Selector Switch Station Box</strong>, as shown here:</p>
			<div>
				<div id="_idContainer137" class="IMG---Figure">
					<img src="image/Figure_3.38_B16321.jpg" alt="Figure 3.38 – Selector Switch Station Box&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 3.38 – Selector Switch Station Box</p>
			<p>This switch, or a switch very similar to it, can be purchased on Amazon. We will be using the momentary <em class="italic">push button</em>, which is the green button, and wiring this to the <strong class="source-inline">X001</strong> input contact that we programmed and addressed in the previous section. </p>
			<p>Use your <em class="italic">Phillips</em> screwdriver to remove the four faceplate screws and the faceplate. When you open the <strong class="bold">Station Box</strong>, you will see the three switch blocks, each of which will contain four terminals. Focusing on the momentary switch, the two sets of terminals correlate to the action of the switch. Since I want power to pass through the switch when I press the button, I will use the bottom set of terminals. You can test the terminals by <a id="_idIndexMarker207"/>utilizing your <strong class="bold">voltmeter</strong> and test the continuity on <a id="_idIndexMarker208"/>either side of the block. Press the switch to see if the terminals create a short, causing your voltmeter to beep. I feel that checking continuity with my voltmeter over hundreds of projects has been the primary use case for it, which now that I think about it is kind of sad, since the voltmeter has so many other functions and features. Once you feel comfortable that you are using the correct terminals, cut and strip two wires. Screw an end from each wire to either side of the terminal. Then, on one side, extend to the power source and on the other side, extend this wire to the <strong class="source-inline">X1</strong> I/O on the <strong class="bold">PLC</strong>. This can be seen in the following diagram:</p>
			<div>
				<div id="_idContainer138" class="IMG---Figure">
					<img src="image/Figure_3.39_B16321.jpg" alt="Figure 3.39 – Wire diagram&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 3.39 – Wire diagram</p>
			<p>On the I/O terminal, you will notice <strong class="bold">C1</strong> and <strong class="bold">C2</strong>, which stand for <strong class="bold">Common 1</strong> and <strong class="bold">Common 2</strong>. Wire Common 1 to ground. If all the <strong class="bold">wiring</strong> is done correctly, pressing the momentary switch will cause the coil to energize and you should see a red light, as shown here:</p>
			<div>
				<div id="_idContainer139" class="IMG---Figure">
					<img src="image/Figure_3.40_B16321.jpg" alt="Figure 3.40 – Physical wire&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 3.40 – Physical wire</p>
			<p>We now have a push <a id="_idIndexMarker209"/>button controlling the input of <strong class="source-inline">X001</strong> and we also have visual feedback on <strong class="source-inline">Y001</strong>. Next, we are going to wire up the output<a id="_idIndexMarker210"/> to our <strong class="bold">Industrial Signal Tower Lamp</strong>, which <a id="_idIndexMarker211"/>will look similar to the following:</p>
			<div>
				<div id="_idContainer140" class="IMG---Figure">
					<img src="image/Figure_3.41_B16321.jpg" alt="Figure 3.41 – Industrial Signal Tower Lamp&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 3.41 – Industrial Signal Tower Lamp</p>
			<p class="callout-heading">Important note</p>
			<p class="callout">Wiring the output will require you to make a change to your program by duplicating rung 1 and creating a rung per light in your Signal Tower Lamp. I am using a four-light system, with <em class="italic">red</em>, <em class="italic">yellow</em>, <em class="italic">green</em>, and <em class="italic">blue</em> lights.</p>
			<p>The following diagram<a id="_idIndexMarker212"/> shows how to connect your Signal Tower Lamp to <a id="_idIndexMarker213"/>the output channels. Because I am using a four-light system, I will run red to <strong class="source-inline">Y001</strong>, yellow to <strong class="source-inline">Y002</strong>, green to <strong class="source-inline">Y003</strong>, and blue to <strong class="source-inline">Y004</strong>, as shown here:</p>
			<div>
				<div id="_idContainer141" class="IMG---Figure">
					<img src="image/Figure_3.42_B16321.jpg" alt="Figure 3.42 – Output wiring to the Tower Lamp&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 3.42 – Output wiring to the Tower Lamp</p>
			<p>At this point, you should have wired up your outputs and changed your program to accommodate the new light output, as well as written the changes to the CLICK PLC. This process is the same as what we did the previous section, when we wrote the single rung program to the PLC.  Your program should look as follows, in that you should have four distinct new inputs from <strong class="source-inline">X001</strong> – <strong class="source-inline">X004</strong> and four distinct outputs from <strong class="source-inline">Y001</strong> – <strong class="source-inline">Y004</strong>:</p>
			<div>
				<div id="_idContainer142" class="IMG---Figure">
					<img src="image/Figure_3.43_B16321.jpg" alt="Figure 3.43 – Program with four-light wiring&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 3.43 – Program with four-light wiring</p>
			<p>In this section, we learned how to override input values to simulate a signal on the output side of the controller. We wired up a pushbutton switch to X001 and wired up a Signal Tower Lamp four-light system to Y001, Y002, Y003, and Y004. We now have a fully functional physical demo for our lab, and have also had a little exposure to the trials and tribulations that automation engineers go through when they approach a new project with new components. In the next section, we are going to learn how to interact with our lab via scripts that we will write and launch.</p>
			<h1 id="_idParaDest-37"><a id="_idTextAnchor037"/>Testing control</h1>
			<p>In the previous section, we learned how to override the inputs and simulate a signal on contact X001, which allowed us to trigger an output on the Y001 coil. We then proceeded to wire up the input side of the PLC to a switch and reproduce the same results, but this time with a <a id="_idIndexMarker214"/>physical input. Finally, we wired up our four-light Signal Tower. In this section, we are going to test the <strong class="bold">Signal Tower</strong> both from the <strong class="bold">DataView</strong> and from our SCADA VM by utilizing <a id="_idIndexMarker215"/>the <strong class="bold">MBtget</strong> tool that we installed in <a href="B16321_02_Epub_AM.xhtml#_idTextAnchor027"><em class="italic">Chapter 2</em></a>, <em class="italic">Route the Hardware</em>.</p>
			<p>You will need to perform the following steps:</p>
			<ol>
				<li>Open <strong class="bold">DataView1</strong>, as we did in the previous section; as a refresher, check the following screenshot, where you will find it in the <strong class="bold">Monitor</strong> | <strong class="bold">Data View</strong> section: <div id="_idContainer143" class="IMG---Figure"><img src="image/Figure_3.44_B16321.jpg" alt="Figure 3.44 – Data View&#13;&#10;"/></div><p class="figure-caption">Figure 3.44 – Data View</p></li>
				<li>This will bring up the<a id="_idIndexMarker216"/> window for Data View. As we did previously, add the new contacts you created in the previous section. These contacts are <strong class="source-inline">X002</strong>, <strong class="source-inline">X003</strong>, and <strong class="source-inline">X004</strong> in the address space. Make sure to enable the <strong class="bold">View Override</strong> option. If everything has worked correctly, your screen should look similar to the following: <div id="_idContainer144" class="IMG---Figure"><img src="image/Figure_3.45_B16321.jpg" alt="Figure 3.45 – Data View&#13;&#10;"/></div><p class="figure-caption">Figure 3.45 – Data View</p></li>
				<li>Now, go ahead and toggle the inputs and move through each value, ensuring that your physical light tower turns on the matching light that you have configured for your output. You will notice that you have visual feedback on the face of the CLICK, much like you do inside your software, as shown here:<div id="_idContainer145" class="IMG---Figure"><img src="image/Figure_3.46_B16321.jpg" alt="Figure 3.46 – Overriding the lamp&#13;&#10;"/></div><p class="figure-caption">Figure 3.46 – Overriding the lamp</p></li>
				<li>Now that we have <a id="_idIndexMarker217"/>all the lights working, open the <strong class="bold">SCADA VM</strong> that we created it in previously. Go to <strong class="bold">Navigator</strong> &gt; <strong class="bold">Virtual Machines</strong> &gt; <strong class="bold">SCADA</strong> to find it, as shown here:</li>
			</ol>
			<div>
				<div id="_idContainer146" class="IMG---Figure">
					<img src="image/Figure_3.47_B16321.jpg" alt="Figure 3.47 – SCADA VM&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 3.47 – SCADA VM</p>
			<p>Launch the console for <a id="_idIndexMarker218"/>SCADA and open your <strong class="bold">Terminal</strong> program. Use the <strong class="source-inline">mbtget -h</strong> command to see details about the <strong class="bold">mbtget</strong> tool, as shown here:</p>
			<div>
				<div id="_idContainer147" class="IMG---Figure">
					<img src="image/Figure_3.48_B16321.jpg" alt="Figure 3.48 – mbtget tool&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 3.48 – mbtget tool</p>
			<p class="callout-heading">A good moment to explain mbtget</p>
			<p class="callout">mbtget is a <a id="_idIndexMarker219"/>tool written in Perl that allows us to directly interact with Koyo Click via <em class="italic">ModbusTCP</em> over port <strong class="source-inline">502</strong>. For more details go to the following link and view the project on GitHub: <a href="https://github.com/sourceperl/mbtget">https://github.com/sourceperl/mbtget</a>.</p>
			<p>OK; let's go back<a id="_idIndexMarker220"/> to our normal programming. Now that we have mbtget sitting on our SCADA machine, we can check the bits on the four coils that we configured in the previous section by running the following command:</p>
			<p class="source-code">mbtget -r1 -a 0 192.168.1.20</p>
			<p>Let's look at the arguments that are included in the command. We will cover the <strong class="bold">modbus</strong> protocol in greater detail in <a href="B16321_08_Epub_AM.xhtml#_idTextAnchor097"><em class="italic">Chapter 8</em></a><em class="italic">, Protocols 202</em>. For now, we need to know what the memory address is for the coils that we are using, and also whether we want to read or write to that memory address:</p>
			<ul>
				<li><strong class="source-inline">-r1</strong>: Reads bit(s) at function <strong class="source-inline">1</strong></li>
				<li><strong class="source-inline">-a</strong>: Address at <strong class="source-inline">0</strong></li>
				<li>The PLC address is <strong class="source-inline">192.168.1.20</strong></li>
			</ul>
			<p>If you have cleared all the overrides that have been set in the programming software, you should see the following output, where the value at address <strong class="source-inline">1</strong> is <strong class="source-inline">0</strong>:</p>
			<div>
				<div id="_idContainer148" class="IMG---Figure">
					<img src="image/Figure_3.49_B16321.jpg" alt="Figure 3.49 – Address 0 read output&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 3.49 – Address 0 read output</p>
			<p>Now, write a value<a id="_idIndexMarker221"/> to the coil using the following command:</p>
			<p class="source-code">mbtget -w5 1 -a 0 192.168.1.20</p>
			<p>The following are the arguments that are included in the command:</p>
			<ul>
				<li><strong class="source-inline">-w5</strong>: Writes a function value of <strong class="source-inline">1</strong> for on</li>
				<li><strong class="source-inline">-a</strong>: Address <strong class="source-inline">0</strong></li>
				<li>The PLC address is <strong class="source-inline">192.168.1.20</strong></li>
			</ul>
			<p>If everything worked, you should have turned on the first/top light in your signal tower and have the following result:</p>
			<div>
				<div id="_idContainer149" class="IMG---Figure">
					<img src="image/Figure_3.50_B16321.jpg" alt="Figure 3.50 – Writing the value to the coil&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 3.50 – Writing the value to the coil</p>
			<p>Now, to confirm the output using <strong class="source-inline">mbtget</strong>, run the read coil command again:</p>
			<p class="source-code">mbtget -r1 -a 0 192.168.1.20</p>
			<p>The following are the arguments in the command:</p>
			<ul>
				<li><strong class="source-inline">-r1</strong>: Reads bit(s) function <strong class="source-inline">1</strong></li>
				<li><strong class="source-inline">-a</strong>: Address <strong class="source-inline">0</strong></li>
				<li>The PLC address is <strong class="source-inline">192.168.1.20</strong></li>
			</ul>
			<p>If everything is working, you should the following output:</p>
			<div>
				<div id="_idContainer150" class="IMG---Figure">
					<img src="image/Figure_3.51_B16321.jpg" alt="Figure 3.51 – Reading coil address 0&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 3.51 – Reading coil address 0</p>
			<p>You should have seen that the address value has changed to <strong class="source-inline">1</strong> and that the light is on. Go ahead and test the remaining lights in your tower by going through the same steps we went through previously. Write a <strong class="source-inline">1</strong> to your next few addresses, read the coil bits, and make sure the output is as expected.</p>
			<p>You may have noticed how easy it was to randomly set a bit with a simple command-line function, and you might be wondering where the security features are. Why could you override a coil without having to enter a <em class="italic">key</em> or <em class="italic">password</em>? Is this truly how insecure the <em class="italic">industrial environment</em> is? Well, I have to say <em class="italic">yes and no</em>. Yes, the industrial environment has traditionally been this<a id="_idIndexMarker222"/> insecure, but there has been great progress in opening awareness to the security issues that reside in the field. The <em class="italic">vendors</em> have listened and started to embed security layers into their systems. However, this doesn't mean that customers have upgraded their legacy systems to the new technology. Now, for those of you who are curious, who might have realized what is going on… yes, yes, you caught me – the reason why this works is because we have the overrides enabled on the programming software still. Remove the overrides and try testing mbtget again by forcing a coil. What were the results? You shouldn't see an outcome – nothing should happen. This is because we have told the PLC to only react to localized input.</p>
			<h1 id="_idParaDest-38"><a id="_idTextAnchor038"/>Summary</h1>
			<p>In this chapter, we built an introductory functional lab, where we can develop logic inside our PLC and connect to real-world inputs and outputs to see how things react to certain environmental tests. This helps relay a fundamental understanding of how industrial systems operate and work. Building on these core concepts allows us to extend our lab to more complex scenarios. We used the <strong class="bold">engineering software</strong> to force inputs, and then we replicated the same behavior remotely with mbtget to convey how easy it is to change a simple on/off input on a controller.  </p>
			<p>Imagine what other industry processes operate this way, such as opening and closing valves on a water plant or opening a valve on a lye, also known as a sodium hydroxide, holding tank, and allowing it to flow into water treatment units, similar to the <em class="italic">Florida City Water Supply hack</em> on February 5, 2021. However, the Florida City Water Supply hack is more complex as it involved changing a concentration amount on an operator screen. This change runs through a recipe logic block and ultimately tells the valve to stay open longer until the concentration level matches the new setpoint change. This is an example of how real-world impacts can occur from making small changes to logic. This is a double-edged sword, and a cautionary tale when it comes to pentesting engagements. It's quite easy to break and cause downtime in a customer's process, resulting in heavy production and revenue losses.</p>
			<p>In the next chapter, we will be taking a break from building our ICS lab and discussing <strong class="bold">Open Source Intelligence </strong>(<strong class="bold">OSINT</strong>) gathering, since this is a critical step in any pentesting engagement.</p>
		</div>
	</body></html>