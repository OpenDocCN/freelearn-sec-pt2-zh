<html><head></head><body><div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Firewall Placement and Detection Techniques</h1>
                </header>
            
            <article>
                
<p><span>In the previous chapter, we learned all about</span> <span>SSL. We also explored how SSL provides the authentication, confidentiality, and integrity to achieve transport layer security.</span></p>
<p>This chapter provides a brief overview of firewall technology, looking at its placement in a network and the services it offers. In this chapter, you will explore a different generation of firewalls and use cases. You will also learn where a firewall fits into a network and what it can and cannot do. Furthermore, the chapter covers the basics of TCP/IP, Traceroute, scanner tools, setting up firewalls, testing, the best practices to maintain firewalls, and much more. We will be covering the following topics:</p>
<ul>
<li>Firewall and design considerations</li>
<li>DMZ secure design </li>
<li>TCP/IP &amp; OSI model</li>
<li>Firewall performance, capabilities, and functions </li>
</ul>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Technical requirements</h1>
                </header>
            
            <article>
                
<p>You will need a Unix or Linux machine with hping installation, as well as a basic knowledge of TCP/IP, firewalls and IP communication.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Firewall and design considerations</h1>
                </header>
            
            <article>
                
<p>Security is the most important consideration for any secure network design. There are many ways to secure the network, and firewall techniques are one of the most important ways to implement network security.</p>
<p>The term <em>firewall</em> was in use as early as 1764 to describe walls that isolate the parts of a building most likely to have a fire (for example, a kitchen) from the rest of a structure. There are two types of firewalls: one is based on hardware, and the second is based on software. Hardware-based firewalls are dedicated hardware units used to protect a piece of network or segment, while software-based firewalls run on top of the operating system to protect host machines.</p>
<p>A firewall protection strategy totally depends on the expertise of a firewall administrator and the efficiency of firewall hardware. Security rules and management policies are the most critical tasks for access control policies. IP communication is based on five basic tuples, and for each firewall rule you need a valid source address, destination address, source port, destination port, and transport protocol TCP or UDP, along with action or rejection <span>permits</span><span>.</span></p>
<p>The most commonly implemented solution for enterprise is based on the combination of firewall technologies such as packet filtering, <strong>Virtual Private Network</strong> (<strong>VPN</strong>) and <strong>Network Address Translation</strong> (<strong>NAT</strong>).</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Firewall terminology</h1>
                </header>
            
            <article>
                
<p>Before we discuss firewalls in detail, you must understand the basic terminology:</p>
<ul>
<li><strong>IP Address</strong>: An IP address is a host identity on the internet through which reachability is achieved via a routing protocol between networks. There are two types of IP address available—IPv4  (32 bit with class A, B, C, or D) and IPv6 (128 bit with unicast address, any cast address, or multicast address). For example, IPv4: <kbd>200.10.20.1</kbd> <span>and IPv6:</span> <kbd>2001:0db8:85a3:0000:0000:8a2e:0370:7334</kbd></li>
<li><strong>Ports</strong>:<strong> </strong>Any application that is hosted on an operating system makes its service available on a network using standard ports. When accessing any application on the internet, a dynamic port is opened on source and a standard known port for destination. For example, HTTP uses port <kbd>80</kbd>, FTP uses port <kbd>22</kbd>, and Telnet uses port <kbd>23</kbd>.</li>
</ul>
<div class="mce-root CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-957 image-border" src="Images/96d151d4-9c66-4d69-948c-f411b60c9959.png" style="width:28.92em;height:11.50em;" width="575" height="228"/></div>
<ul>
<li><strong>Protocol</strong>: A protocol is a standard method and mutual agreement for exchanging data over a network host on a local area network, internet, intranet, and WAN.</li>
<li><strong>Tuples</strong>: The term 5-tuple refers to the five items (<span>source and destination IP, source and destination port, and protocol) </span>in any given IP packet. The firewall policy uses these tuples to define the firewall rule of whether to block or allow traffic.</li>
</ul>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Firewall generations</h1>
                </header>
            
            <article>
                
<p>A firewall is a network security device that monitors and controls all incoming and outgoing network traffic based on a defined and advanced set of security rules. Let's discuss the evolution of firewalls and their capabilities. </p>
<ul>
<li><strong>Packet filtering: </strong>First-generation firewalls—these are relatively less expensive with a simple filter function called static packet filtering, also referred to as stateless firewalls. In firewall terminology, <em>stateless</em> refers to rule inspection in both directions in and out; hence, the firewall unit does not maintain any session or connection state.</li>
</ul>
<p style="padding-left: 60px">Basically, packet filtering is performed at Layer 3 (IP) and Layer 4 (Transport) by matching the header fields of the packet against four tuples: source and destination IP address, and ports and transport protocol (TCP/UDP). A good example would be to relate this to a router and an access control list to control traffic going in and out. </p>
<p style="padding-left: 60px"><span>In 1988, the <strong>Digital Equipment Corporation</strong> (</span><strong>DEC</strong><span>) developed the first firewall systems, known as packet filter </span>firewalls. <span>Basic packet filtering firewalls are vulnerable to IP spoofing as they do not maintain a connection state and can be exploited by attackers.</span></p>
<ul>
<li><strong>Stateful firewalls :</strong> Second-generation firewalls—these firewalls have the same capabilities as the first generation, but with the added ability to monitor and store the session along with the connection state. For any connection, packet matching works bidirectionally, which means  that a packet being sent is matched with the attribute of a returning packet, confirming that it belongs to the same packet flow. Unlike putting an access control list in a stateless device in both directions, the firewall allows the return packet based on the packet flow. It looks at the TCP header information for SYN, RST, ACK, and FIN to determine the state of the connection.</li>
<li><strong>Application Gateway</strong>: Third-generation firewalls—an application gateway firewall works based on deep packet inspection to understand the application (Layer 7) and to act as a proxy between the server and client. Suspicious data and connections are dropped by these proxies. Since they are application aware, they can handle more complex protocols like web, H.323, SIP, FTP, SQL Net, and so on. The disadvantage of an application gateway is establishing proxy connectivity, which requires two steps to connect to either an inbound or outbound connection. In simple terms, the user needs to connect to the application firewall, rather than connecting directly with the host. </li>
<li><strong>Next-Generation Firewalls (NGFW)</strong>:<strong> </strong>The core and backbone function for next-generation firewalls is <strong>Deep Packet Inspection</strong> (<strong>DPI</strong>), which comes with standard features like NAT, VPN, and content filtering. The DPI function allows the firewall to look deeply into the packet using protocol identification methods. These identifications are based on specific parameters of an application, rather than a port-based identification of applications. This can also block sophisticated cyberattacks based on IPS engines and signatures. Security policies or rules can be implemented based on application and network protocol.</li>
</ul>
<div class="packt_infobox">A very similar approach is being followed by SDN implementation, a controlled policy to block or allow traffic across multiple gateways installed in multiple locations. These policies are based on applications rather than being IP and port based. The flexibility we get means that we can centralize controllers and applications routed on the network.</div>
<p style="padding-left: 60px">The different security services of the NGFW offering can work together to provide a higher level of security than <strong>Stateful Packet Inspection</strong> (<strong>SPI</strong>) firewalls, due to DPI capability:</p>
<div class="mce-root CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-961 image-border" src="Images/8add3e97-d20c-43c2-83b5-6388f2f0f7a5.png" style="width:32.42em;height:19.67em;" width="706" height="427"/></div>
<p class="mce-root">Let's take a look at how to choose a firewall fit for business and performance criteria.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Firewall performance</h1>
                </header>
            
            <article>
                
<p>The performance of a ﬁrewall is tested under diﬀerent traﬃc loads when considering different metrics to evaluate the ﬁrewall performance. The metrics are as follows:</p>
<ul>
<li><strong>Throughput</strong>: This is the actual payload that is received per unit of time</li>
<li><strong>Delay</strong>: This is the transit time for a packet to be transmitted from the source to the destination</li>
<li><strong>Jitter</strong>: This measures the variation in delay of the received packets</li>
<li><strong>Packet-loss-rate (PLR)</strong>: This is the ratio of the lost packets to the total transmitted packets</li>
</ul>
<p>If you're upgrading your firewall or buying a new next-generation firewall, how do you select one that's appropriate for your business? Vendors will always tell you how great their firewall product is and downplay others, so it would be difficult to approach them directly for advice. </p>
<p>You should first determine a list of features and a level of performance, then decide what extended functionality or feature you would like to have on top of that. Of course, you should also consider budget.</p>
<p><strong>Security consideration questions</strong>:</p>
<ul>
<li>Is traffic always being scanned in both directions?</li>
<li>Are all ports left open by default?</li>
<li>Is deep packet inspection turned on by default?</li>
<li>Can IPS and application control run together?</li>
</ul>
<p><strong>Management consideration question</strong>:</p>
<ul>
<li class="mce-root">Is an event analysis dashboard provided?</li>
</ul>
<p><strong>Performance consideration questions</strong>:</p>
<ul>
<li>Is the performance claimed by a vendor based on real traffic?</li>
<li>Is testing performed with a large number of security policies?</li>
</ul>
<p><strong>Feature consideration question</strong>:</p>
<ul>
<li>Do I need a VPN?</li>
<li>What would be the throughput for my network?</li>
<li>Which license and size do I need for my network—SOHO or Enterprise?</li>
<li>Do I need high availability?</li>
<li>Should I use a software appliance or a hardware appliance?</li>
<li>Does the firewall support virtualization and routing?</li>
<li>What is the total number of sessions?</li>
<li>Is the SSL throughput and remote access connection provided by Firewall?</li>
</ul>
<p>These are a few sample questions. Based on the answers to these, you can choose the best firewall for your network.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Firewall placement  and design network topology</h1>
                </header>
            
            <article>
                
<p>When we talk about firewall placement architecture, you have two options: a single firewall or a multilayer firewall. </p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Single firewall architecture</h1>
                </header>
            
            <article>
                
<p>The placement of a single firewall on a network depends upon a number of factors such as the number of IP subnets and services offered and hosted behind firewall. Let's take a look at a few scenarios. </p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Single firewall architecture with a single IP subnet</h1>
                </header>
            
            <article>
                
<p>In the following diagram, a single firewall is placed under a WAN router and all traffic travels via this firewall. All servers are hosted on a single subnet and given equal security protection provided by the firewall, which provides isolation from the internet. A firewall having a single subnet may be justified when further isolation is not required between the servers and does not cause a significant risk:</p>
<div class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-962 image-border" src="Images/abfd57da-3b80-48ce-99f1-4e52230a035a.png" style="width:29.42em;height:25.83em;" width="605" height="532"/></div>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Single firewall architecture with multiple IP subnets</h1>
                </header>
            
            <article>
                
<p>As shown in the diagram below, a simple way to isolate the network resources without introducing another set of firewalls is to use multiple interfaces configured with multiple subnets. In the design, the web, application and database servers are placed in different subnets using different IP subnets with different security levels configured on interfaces. Let's assume that only one web server has to be exposed to the internet and the rest of the server will talk to the web server internally. This can be easily configured and controlled by inputting firewall rules. This can be achieved by exposing the web server to the internet and allowing an internet subnet policy. An attacker could only gain access to all subnets if a firewall is compromised due to a missed configuration:</p>
<div class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-963 image-border" src="Images/d0704adb-d57e-47c3-b1e6-112378a0740e.png" style="width:32.00em;height:24.75em;" width="631" height="488"/></div>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Multilayer firewall architecture</h1>
                </header>
            
            <article>
                
<p><span>The placement of multilayer firewall security is part of  the network security strategy. Keeping everything behind one firewall that offers all services can be risky and a single point of failure. Let's take a look at the firewall sandwich security design to protect highly critical assets behind the multilayer security:</span></p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Firewall sandwich design</h1>
                </header>
            
            <article>
                
<p>You will often see a multi-tier firewall or sandwich design topology deployed by an enterprise network. Instead of interfaces being dedicated to different subnets, a separate firewall can also be dedicated to server roles. In such a design, applications based on roles are <em>sandwiched</em> between firewalls, and a dedicated firewall moderates communications between adjacent subnets according to the application's architecture and security policy. The basic idea behind this architecture is to dedicate firewall roles for simple management and to look for the best size of hardware to support the amount of traffic expected on different application segments:</p>
<div class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-964 image-border" src="Images/2d8b195a-1ede-4fbd-96eb-d2d8f0539040.png" style="width:18.75em;height:29.33em;" width="366" height="572"/></div>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Demilitarized Zone</h1>
                </header>
            
            <article>
                
<p><strong>Demilitarized Zone</strong> (<strong><span>DMZ</span></strong>) is your front line, which protects valuables from direct exposure to an untrusted environment. In other words, a DMZ is generally a secure network segment that is exposed to the internet, where you keep valuable resources like a web server (the most common internet application) to enhance application security by adding an extra layer of security. It's very important to carefully plan and design a DMZ because it may not be easy task to fix loopholes when handling production traffic.</p>
<p>So how do you design a DMZ? Most of the time, an administrator puts the energy into securing and concentrating on DMZ security <span>only</span><span> </span><span>and forgets about the rest of the internal data communications designed to access valuable information. Access to the DMZ from an internal application should be locked down as tightly as possible.</span></p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">DMZ to Internal Access Policy </h1>
                </header>
            
            <article>
                
<p>Internal systems hold valuable data and are not exposed directly to the internet, but a DMZ plays a proxy role in between. Just imagine that a DMZ server is compromised and the internal LAN is wide open. In this situation, attackers could find a way into your network.</p>
<p>Let's take a look at the example for setting up a web server in DMZ.</p>
<p>You must set a baseline for what you want to protect and consider scalability, availability, and agility. You have the freedom to choose the number of firewalls for setting up a DMZ, but two firewalls would be a good start. With two firewalls, you can put front-line servers behind a perimeter firewall (DMZ) and internal resources under a different firewall.</p>
<p>You can <span>also</span><span> </span><span>have multiple scenarios in this design. I will try to cover those as well. A web server can be configured using a private IP and further natted with public IP for internet readability. However, you can also configure public IP directly on a server. Web servers can be configured with dual NIC , FE NIC and BE NIC. A connection coming from the internet will be terminated on FE NIC, and a new connection will be made to access app and database servers. Since this is a web server, the only rule for port</span> <kbd>80</kbd> <span>or</span> <kbd>443</kbd> <span>is required on DMZ firewall. Port</span> <kbd>1433</kbd> <span>on Tier-1 firewall will allow a connection from web to app and database servers, assuming it is a SQL server.</span></p>
<p>In this diagram, you can see that a new connection has been made for a web server on port <kbd>80</kbd> on public IP <kbd>2.2.2.2</kbd>. Once this connection hits the front-line firewall, the NAT rule will translate this connection to the real IP of the web server, which is <kbd>10.10.10.1</kbd>. The decision of whether single or dual interface IPs should be used in order to connect further to database servers will now depend upon the NIC design: </p>
<div class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-965 image-border" src="Images/f2159b32-5a4b-4de7-91f9-fa585b3593f6.png" style="width:31.25em;height:24.25em;" width="708" height="549"/></div>
<p><strong>Do I really need dual NIC</strong>?  This design is also possible when based on single or dual NIC. A dual NIC design is more secure, considering the fact that with a single NIC you might need to adjust the routing, switching, and NAT statement in order to talk between a private IP space. Dual NICs give an extra physical layer of separation to achieve higher security.</p>
<p>Having said that, a DMZ is an important part of your network security architecture.<br/>
You need a way to expose services to the internet world, but in a controlled and secure manner. To create a DMZ  successfully, a proper understanding of access policies and configuration is required for firewall detection.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">OSI model versus TCP/IP model</h1>
                </header>
            
            <article>
                
<p>Before discussing how a firewall works, we must first understand how the different layers of a network interact. Network communication is based on a seven-layer model, and each layer has its own set of responsibilities in order to make the communication happen. Firewalls can operate on different layers in order to use different criteria to block or permit the traffic.</p>
<p>In general, a firewall is going to have to operate at the network layer (L3) and transport layer (L4). The upper layers are more like scanning for viruses in data payloads and doing deep packet inspection. The Layer-1 physical layer is basically <span>just</span><span> </span><span> a network connectivity requirement.</span></p>
<p>TCP/IP, also known as the internet model developed by the <strong>Department of Defense</strong> (<strong>DoD</strong>), is a simplified and practical version of the <strong>Open System Interconnection</strong> (<strong>OSI</strong>) model (1984), which is based on a theoretical concept.</p>
<p>The OSI model is based on server layers and its specific function. The following diagram shows layers along with their functions: </p>
<div class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-966 image-border" src="Images/d8d22905-bc8a-46e8-b549-be5876d1e93a.png" style="width:45.75em;height:20.83em;" width="902" height="410"/></div>
<p>The layers in the preceding diagram are as follows:</p>
<ul>
<li><strong>Physical layer</strong>: This layer connects networking nodes over physical media and encodes bits into electrical signals</li>
<li><strong>Data Link layer</strong>: This layer is responsible for error detection and flow control over physical media</li>
<li><strong>Network layer</strong>: This layer is responsible for IP routing, switching, and network IP addressing</li>
<li><strong>Transport layer</strong>: This layer is responsible for transport protocol TCP/UDP and error handling</li>
<li><strong>Session layer</strong>: This layer is responsible for connection establishment and data flow</li>
<li><strong>Presentation layer</strong>: This layer is responsible for the standard format of data as well as encryption and decryption</li>
<li><strong>Application layer</strong>: This layer provides services directly to user application over the network to end users.</li>
</ul>
<p>Let's take a look at the difference between OSI and TCP/IP models. On the right hand side of the diagram, we can see that the TCP/IP model has four layers, including the network interface, internet, transport, and application layers. <span>TCP/IP follows a top-to-bottom approach, and the OSI model follows a bottom-up approach. Of course, it appears simple due to a smaller number of layers:</span></p>
<div class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-967 image-border" src="Images/4bc349cc-f7f2-4ae4-9bd0-487b82fc3310.png" style="width:42.67em;height:14.25em;" width="891" height="298"/></div>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Firewall performance, capabilities, and function</h1>
                </header>
            
            <article>
                
<p>So far, we have discussed the basic features of a firewall. There are many more functions that can be used for multiple purposes. Let's list these below:</p>
<ul>
<li><strong>URL filtering</strong>: Random web surfing  may expose your network to malware that can cause security risks to your organization. URL filtering is a way to limit access by comparing web traffic in a database to prevent employees from accessing unproductive URLs or contents.</li>
<li><strong>Antivirus and malware protection</strong>: NGFW comes with an inbuilt antivirus engine and malware protection, which is capable of inspecting traffic along with malicious infected files.</li>
<li><strong>Integrated IPS/IDS</strong>: In a traditional enterprise network, the deployment of IPS/IDS is very common as a separate appliance. A next-generation firewall comes with an IPS/IDS module and can be enabled or disabled according to requirements. The biggest thing to consider is how much traffic we want to pass through the IPS/IDS device and that should be supported by these modules.</li>
<li><strong>Quality of Service (QoS)</strong>: QoS is a framework on a network to guarantee bandwidth ability for high-priority applications. Traffic can be classified based on DSCP packet marking, application port, source and destination IP, and deep packet detection to detect application based approaches.</li>
<li><strong>Remote Access (VPN)</strong>: Instead of going to a separate unit for terminating a VPN, a firewall can be used for the same purpose. There are multiple versions of VPN— corporate HQ networks connectivity to their remote location is often built on site-to-site VPNs. Remote access VPNs  such as SSL, web VPN, and IPsec VPN Client allow individual  users to connect to the corporate network remotely.</li>
<li><strong>High Availability <span>(</span>HA<span>)</span></strong>: This is a deployment in which two or more firewalls are placed into a group and their configuration is synchronized to prevent a single point of failure on a network. High availability can be achieved by putting firewall in active-passive mode or active-active mode by sharing traffic.</li>
<li><strong>Virtualization</strong>: This is another important function or feature of a firewall to operate in a virtual context mode. Topology can be formed based on requirements, and context can operate in active-passive or active-active. This works best in a hosting environment where separation between customers is required. Please refer to the product documentation to check which features are supported in a virtualized environment.</li>
</ul>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Firewall management</h1>
                </header>
            
            <article>
                
<p>Firewall protects the enterprise network and plays a critical role on perimeter defense. The majority of data breaches take place due to misconfiguration. Consequently, it becomes very important for enterprises to leave admin access in the hands of experts and not to leave security in auto-pilot mode. A real-time dashboard is absolutely required to monitor network firewall traffic continuously to identify and respond to threats before the damage is done.</p>
<p>There are couple of best practices that must be implemented to operate firewall properly:</p>
<ul>
<li><strong>Change control policy</strong>: Firewall rules or policy changes are very dynamic in nature and are mostly inevitable when it comes to accommodating new changes in the infrastructure environment and responding to new threats or vulnerabilities.</li>
<li><strong>Perform periodic audit of the configurations</strong>: Auditing is a requirement to keep firewall patches up to date and to make sure that a device is compliant with standards like <span>SOX, PCI-DSS, and HIPAA.</span></li>
<li><strong>Firewall rule consolidation and optimization</strong>: Over time your firewalls will accumulate thousands of rules and policies, and many of these rules will become out of date or obsolete. This adds complexity to daily tasks, troubleshooting, and auditing, and may also cause performance issues to firewall appliances. It's always recommended to consolidate rules in a group based on application and remove unused rules from policies.</li>
<li><strong>Threat detection signature updates</strong>: Threat detection is based on patterns found in an attack. In an ever growing internet environment, new threats are detected every day. Because of this, it becomes important to update signatures and fine tune policies to avoid false alarms.</li>
</ul>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Application proxies</h1>
                </header>
            
            <article>
                
<p>An application proxy (sometimes called an application-level gateway) often acts as a middle layer. These proxy applications are run on top of the firewall. The users connect the gateway using applications like Telnet, FTP, or web connect. Users are prompted to enter resources they want to access and are also asked to validate their credentials. After successful authentication, the gateway will establish a connection to a remote application and relay data between the application and end user. Since application gateways are application aware, it becomes very easy from a gateway management point of view. In a typical firewall, either ports will be closed or open, and policies are defined by the administrator.</p>
<p>In the following diagram, you can see that Tom will be authenticated against the rule configured as ALG firewall<span>, which allows Tom to</span> access an application running on <kbd>20.20.20.1</kbd> . All other connections will be denied:</p>
<div class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-968 image-border" src="Images/80c1f1f8-9bc8-43a8-8e17-b1158088d634.png" style="width:69.83em;height:32.58em;" width="838" height="391"/></div>
<p>One of the biggest limitations of an application gateway is that it requires a separate application for each network service. Consequently, it is mandatory to check <span>which services are supported </span><span>with the firewall vendor. Another disadvantage of ALG is an additional processing overhead on each connection. </span></p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Detecting firewalls</h1>
                </header>
            
            <article>
                
<p>Firewalls secure small to large infrastructure networks from malicious attacks and unwanted traffic. But it would be wrong to assume that inputting a firewall will solve everything. Vulnerabilities are part of any hardware and software appliance. The biggest vulnerability is a misconfiguration of the firewall. A well-configured, architecturally designed, updated, and well-maintained firewall is almost impossible to penetrate.</p>
<p>There are several methods available that can help you to detect the location of<br/>
the firewall. A very easy method to locate a firewall is through <kbd>traceroute</kbd> (Unix utility) or <kbd>tracert</kbd> (Windows utility).  </p>
<p>Let's take a brief look at the background of <kbd>traceroute</kbd> and how it works. People commonly say that traceroute uses ICMP, and this is partially true because ICMP is used for error message reporting. ICMP, UDP, and TCP are all Layer 4 protocols, and IP packets contain a field <strong><span>Time To Live</span></strong> (<span><strong>TTL</strong>)</span>. The TTL field is 8 bit and can reach a maximum of 255 hops. Different operating systems use different values. For example, Windows 10 uses 128 by default. Here is quick way to find a default value and ping localhosts from a command prompt. Every time a packet passes via a router or L3 device, the TTL value decrements by 1.</p>
<div class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-1186 image-border" src="Images/ed087eca-383f-4783-85dc-41366afb525b.png" style="width:157.58em;height:47.67em;" width="1891" height="572"/></div>
<p><span>Here is a quick way to find the default value and ping localhosts from a command prompt. I did this on my Windows 10 machine. You can also get or adjust the value from a Windows registry:</span></p>
<div class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-969 image-border" src="Images/e91d60f3-40b2-4d19-b4a6-67d91f2c2b9a.png" style="width:73.92em;height:12.08em;" width="887" height="145"/></div>
<p>Let's assume ICMP is open: take a look at traceroute results. I have taken this from an online trace portal, which shows that the last hop is <kbd>182.168.6.81</kbd>. After that, ICMP seems to be blocked by a firewall:</p>
<div class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-970 image-border" src="Images/ab05c506-3013-485c-82fe-a7cb5a48b8e7.png" style="width:113.33em;height:33.75em;" width="1360" height="405"/></div>
<p>This is another trace which is not based on ICMP but TCP on port <kbd>80</kbd> and reaches the end server. When you compare both you can see that ICMP is being filtered by a firewall:</p>
<div class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-971 image-border" src="Images/4ff69216-7a6b-4408-96d0-2bc33afb1cbf.png" style="width:82.25em;height:52.25em;" width="987" height="627"/></div>
<p>In fact, no method is 100% accurate. They just provide you with more information so that you can guess  which machine is filtering packets <span>more accurately</span><span>.</span></p>
<div class="packt_infobox">A very popular firewall Cisco ASA does not do TTL decrements by default, we have to do them manually to see the interfaces of ASA when doing traceroutes. </div>
<p><strong>Firewalking</strong> is a technique used to discover information about a remote network protected by a firewall. Firewalking uses a traceroute analysis in backend to determine whether or not a data packet can pass a destination host via a packet filtering appliance.</p>
<p>The firewall fulfils a NAT/PAT function, and multiple applications can be served over one single public IP from the internet. You can see one public <kbd>20.20.20.10</kbd>, which is mapped with internal IPs on different port numbers. This is called a NAT operation and is performed by a firewall. This way you can create a network topology of remote networks:</p>
<div class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-211 image-border" src="Images/8c04116a-cee9-4d21-b6c3-9f914287bf7c.png" style="width:33.58em;height:20.25em;" width="548" height="330"/></div>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Debugging tools</h1>
                </header>
            
            <article>
                
<p>The following debugging tools are used:</p>
<ul>
<li><strong>ICMP ping scan</strong>: When checking any device on a network, the first thing that comes to mind is to test ICMP-based scanning. The way it works is that you send an ICMP request packet and expect ICMP echo to reply. The basic idea behind this is to get the live host on the network and then launch a port scanner against those live hosts. <span>Angry IP Scanner is a very popular tool used for network scanning. The problem with ICMP is a network administrator can block ICMP on the network or host layers. You can also easily create a script for an IP scanner which can scan IPs for their defined range.</span></li>
<li><strong>TCP ping scan</strong>: We have learned that ICMP can be blocked and is therefore not very reliable nowadays. However, instead of using ICMP, a ping probe can be sent by a  remote host to a specific port by sending TCP syn. You will then get a reply as a TCP syn-ack. If you want to keep your application alive, this cannot be be blocked by the network administrator.</li>
<li><strong>Arp ping</strong>: You can use utilities like NMAP for ping sweep, and if you use it on a local subnet, it uses an ARP Ping instead of ICMP. NMAP does this by default.</li>
<li><strong>NAMP</strong>: NAMP can do multiple things for you, starting with scanning a host. It can even detect the operating system of a remote host using the light capability of vulnerability scanning.</li>
<li><strong>Hping</strong>: Hping was mainly used as a security tool and can be used for firewall testing, port scanning, network testing, MTU discovery, advance traceroute,and OS fingerprinting. This tool gives you the ability to craft a packet. I am using the Ubuntu server, and you need to install the hping package:</li>
</ul>
<p><img class="alignnone size-full wp-image-212 image-border" src="Images/581eac22-0add-4f4f-a119-d3b3463c0cd7.png" style="width:80.42em;height:9.25em;" width="965" height="111"/></p>
<p style="padding-left: 60px"><span>Let's look at how to run this tool in port scan mode. Syntax has an argument of 0-100 (port range to be scanned), -S (Send Syn Packet) and <kbd>4.2.2.2</kbd> (IP address for host) to be scanned. Results show that one port is opened for DNS and this is true, <kbd>4.2.2.2</kbd> is a DNS server and hence the result is as expected:</span></p>
<p><img class="alignnone size-full wp-image-972 image-border" src="Images/b81c0597-393b-4f60-baa3-8c57c41b1a72.png" style="width:84.75em;height:37.42em;" width="1017" height="449"/></p>
<ul>
<li><strong>TCP connect scan</strong>: TCP connect can be used as port scanning, a simpler form of probing a remote host. This involves a full TCP/IP connection, which is established with all TCP ports and one of the target hosts in an incremental manner. A TCP/IP is reliable as a protocol and such port scanning is a very reliable way to determine which TCP services are accessible on a given target host.</li>
</ul>
<p style="padding-left: 60px">In this example, the <kbd>nmap</kbd> tool will try to connect to the remote host in two ways. The first way is through a syntax argument (<kbd>-sS</kbd>) , which means that a 3-way handshake will be completed. With the other method, an (<kbd>-sT</kbd>) tool will use an application like a  browser in the backend to connect to a remote host:</p>
<div class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-214 image-border" src="Images/8eed260e-38a6-434d-bf7c-844501aa1384.png" style="width:102.33em;height:42.25em;" width="1228" height="507"/></div>
<p style="padding-left: 60px">In case the target port is closed, the source receives an RST/ACK packet directly. </p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Summary</h1>
                </header>
            
            <article>
                
<p>This chapter showed you the basics of firewalls and design considerations in firewall systems. You were introduced to different generations of firewalls and their functions, and you learned how to design a good firewall system. This can be something as simple as setting up a basic packet filtering firewall, to something as complex as using a stateful firewall with DMZs, <span>ALG authenticated user connections, </span><span>authenticating user connections, using different scanning techniques to probe host behind firewalls, and making use of many other features.</span></p>
<p>In the next chapter, we will discuss VPNs in a public internet infrastructure, as well as different attributes within an IPsec framework. </p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Questions</h1>
                </header>
            
            <article>
                
<ol>
<li>Which of the following are firewall types?
<ol>
<li>Packet filtering firewall</li>
<li> Application-layer gateway</li>
<li>Screen Host Firewall</li>
<li>All of the mentioned</li>
</ol>
</li>
</ol>
<ol start="2">
<li>An application proxy firewall filters at:
<ol>
<li>Physical layer 1</li>
<li>Data link layer 2</li>
<li>Network layer 3</li>
<li>Application layer 7</li>
</ol>
</li>
<li>This 8-bit value identifies the maximum time the packet can remain in the system before it is dropped:
<ol>
<li>Fragment</li>
<li>Time to live</li>
<li>Protocol</li>
<li>Checksum</li>
</ol>
</li>
</ol>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Further Reading</h1>
                </header>
            
            <article>
                
<p>For more information, visit the following links:</p>
<ul>
<li><a href="https://www.juniper.net/documentation/en_US/learn-about/LA_FIrewallEvolution.pdf">https://www.juniper.net/documentation/en_US/learn-about/LA_FIrewallEvolution.pdf</a></li>
<li><a href="https://www.ietf.org/rfc/rfc1122.txt">https://www.ietf.org/rfc/rfc1122.txt</a></li>
<li><a href="https://www.sans.org/reading-room/whitepapers/firewalls/intrusion-detection-response-leveraging-generation-firewall-technology-33053">https://www.sans.org/reading-room/whitepapers/firewalls/intrusion-detection-response-leveraging-generation-firewall-technology-33053</a></li>
</ul>
<p> </p>
<p> </p>


            </article>

            
        </section>
    </div>



  </body></html>