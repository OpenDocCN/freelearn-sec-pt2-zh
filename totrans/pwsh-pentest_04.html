<html><head></head><body>
<div id="_idContainer030">
<h1 class="chapter-number" id="_idParaDest-60"><a id="_idTextAnchor058"/><span class="koboSpan" id="kobo.1.1">4</span></h1>
<h1 id="_idParaDest-61"><a id="_idTextAnchor059"/><span class="koboSpan" id="kobo.2.1">Network Enumeration and Port Scanning</span></h1>
<p><span class="koboSpan" id="kobo.3.1">In this chapter, we will explore how PowerShell can be used as part of a penetration test to perform TCP/UDP port scanning. </span><span class="koboSpan" id="kobo.3.2">Through practical examples, we will explore how specific cmdlets can be used and how PowerShell can use functions in other frameworks such as .NET. </span><span class="koboSpan" id="kobo.3.3">Finally, we will examine some open source tools that can be used to perform a port scan. </span><span class="koboSpan" id="kobo.3.4">We will now begin this chapter by looking at how various cmdlets can be used to perform </span><span class="No-Break"><span class="koboSpan" id="kobo.4.1">network enumeration.</span></span></p>
<p><span class="koboSpan" id="kobo.5.1">The following are the main topics we will cover in </span><span class="No-Break"><span class="koboSpan" id="kobo.6.1">this chapter:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.7.1">Network enumeration </span><span class="No-Break"><span class="koboSpan" id="kobo.8.1">using PowerShell</span></span></li>
<li><span class="koboSpan" id="kobo.9.1">TCP port scanning </span><span class="No-Break"><span class="koboSpan" id="kobo.10.1">using PowerShell</span></span></li>
<li><span class="koboSpan" id="kobo.11.1">UDP port scanning </span><span class="No-Break"><span class="koboSpan" id="kobo.12.1">using PowerShell</span></span></li>
<li><span class="koboSpan" id="kobo.13.1">Using PowerShell tools for </span><span class="No-Break"><span class="koboSpan" id="kobo.14.1">port scanning</span></span></li>
</ul>
<h1 id="_idParaDest-62"><a id="_idTextAnchor060"/><span class="koboSpan" id="kobo.15.1">Network enumeration using PowerShell</span></h1>
<p><span class="koboSpan" id="kobo.16.1">Network enumeration</span><a id="_idIndexMarker189"/><span class="koboSpan" id="kobo.17.1"> is a crucial phase in a</span><a id="_idIndexMarker190"/><span class="koboSpan" id="kobo.18.1"> penetration test, where security professionals assess the vulnerabilities and weaknesses of a target network. </span><span class="koboSpan" id="kobo.18.2">PowerShell, a powerful scripting language and framework in Windows environments, can be an invaluable tool to conduct network enumeration. </span><span class="koboSpan" id="kobo.18.3">Here, we’ll delve into how PowerShell can be used for this purpose in a </span><span class="No-Break"><span class="koboSpan" id="kobo.19.1">penetration test:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.20.1">Discovery of network assets</span></strong><span class="koboSpan" id="kobo.21.1">: PowerShell allows testers to discover network assets such as hosts, servers, and devices. </span><span class="koboSpan" id="kobo.21.2">Commands such as </span><strong class="source-inline"><span class="koboSpan" id="kobo.22.1">Test-Connection</span></strong><span class="koboSpan" id="kobo.23.1"> can be employed to ping hosts and check their availability. </span><strong class="source-inline"><span class="koboSpan" id="kobo.24.1">Resolve-DnsName</span></strong><span class="koboSpan" id="kobo.25.1"> can help identify hostnames, while </span><strong class="source-inline"><span class="koboSpan" id="kobo.26.1">Test-NetConnection</span></strong><span class="koboSpan" id="kobo.27.1"> can assess open ports </span><span class="No-Break"><span class="koboSpan" id="kobo.28.1">and services.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.29.1">Active Directory enumeration</span></strong><span class="koboSpan" id="kobo.30.1">: With PowerShell, testers can gather valuable information about the</span><a id="_idIndexMarker191"/><span class="koboSpan" id="kobo.31.1"> target’s </span><strong class="bold"><span class="koboSpan" id="kobo.32.1">Active Directory</span></strong><span class="koboSpan" id="kobo.33.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.34.1">AD</span></strong><span class="koboSpan" id="kobo.35.1">) environment. </span><span class="koboSpan" id="kobo.35.2">Tools such as </span><strong class="source-inline"><span class="koboSpan" id="kobo.36.1">Get-ADUser, Get-ADComputer</span></strong><span class="koboSpan" id="kobo.37.1">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.38.1">Get-ADGroupMember</span></strong><span class="koboSpan" id="kobo.39.1"> can be used to retrieve user, computer, and group data. </span><span class="koboSpan" id="kobo.39.2">This data aids in understanding the network’s structure and potential entry points. </span><span class="koboSpan" id="kobo.39.3">This will be covered in greater detail in </span><a href="B21364_06.xhtml#_idTextAnchor100"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.40.1">Chapter 6</span></em></span></a><span class="No-Break"><span class="koboSpan" id="kobo.41.1">.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.42.1">Network shares and permissions</span></strong><span class="koboSpan" id="kobo.43.1">: PowerShell scripts can be crafted to enumerate network shares and their permissions. </span><span class="koboSpan" id="kobo.43.2">Commands such as </span><strong class="source-inline"><span class="koboSpan" id="kobo.44.1">Get-SmbShare</span></strong><span class="koboSpan" id="kobo.45.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.46.1">Get-Acl</span></strong><span class="koboSpan" id="kobo.47.1"> can be employed to identify open shares and their associated access rights, providing insights into potential areas of exploitation. </span><span class="koboSpan" id="kobo.47.2">This will be covered in greater detail in </span><a href="B21364_06.xhtml#_idTextAnchor100"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.48.1">Chapter 6</span></em></span></a><span class="No-Break"><span class="koboSpan" id="kobo.49.1">.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.50.1">Enumeration of network shares and user information</span></strong><span class="koboSpan" id="kobo.51.1">: PowerShell can facilitate the enumeration of network shares and users’ information by querying LDAP and SMB services. </span><span class="koboSpan" id="kobo.51.2">Tools like </span><strong class="source-inline"><span class="koboSpan" id="kobo.52.1">NetView</span></strong><span class="koboSpan" id="kobo.53.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.54.1">NetUser</span></strong><span class="koboSpan" id="kobo.55.1"> can reveal additional </span><a id="_idIndexMarker192"/><span class="koboSpan" id="kobo.56.1">information about the network’s</span><a id="_idIndexMarker193"/><span class="koboSpan" id="kobo.57.1"> structure and potential vulnerabilities. </span><span class="koboSpan" id="kobo.57.2">This will be covered in greater detail in </span><a href="B21364_06.xhtml#_idTextAnchor100"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.58.1">Chapter 6</span></em></span></a><span class="No-Break"><span class="koboSpan" id="kobo.59.1">.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.60.1">Enumeration of running services</span></strong><span class="koboSpan" id="kobo.61.1">: PowerShell allows testers to identify running services on target hosts. </span><span class="koboSpan" id="kobo.61.2">By using </span><strong class="source-inline"><span class="koboSpan" id="kobo.62.1">Get-Service</span></strong><span class="koboSpan" id="kobo.63.1"> or querying the </span><strong class="bold"><span class="koboSpan" id="kobo.64.1">Windows Management Instrumentation</span></strong><span class="koboSpan" id="kobo.65.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.66.1">WMI</span></strong><span class="koboSpan" id="kobo.67.1">) repository with </span><strong class="source-inline"><span class="koboSpan" id="kobo.68.1">Get-WmiObject</span></strong><span class="koboSpan" id="kobo.69.1">, testers</span><a id="_idIndexMarker194"/><span class="koboSpan" id="kobo.70.1"> can gather information about services, their configurations, and potential vulnerabilities. </span><span class="koboSpan" id="kobo.70.2">These types of services include databases. </span><span class="koboSpan" id="kobo.70.3">This will be covered in </span><a href="B21364_07.xhtml#_idTextAnchor135"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.71.1">Chapter 7</span></em></span></a><span class="koboSpan" id="kobo.72.1">, </span><a href="B21364_08.xhtml#_idTextAnchor164"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.73.1">Chapter 8</span></em></span></a><span class="koboSpan" id="kobo.74.1">, and </span><a href="B21364_09.xhtml#_idTextAnchor183"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.75.1">Chapter 9</span></em></span></a><span class="No-Break"><span class="koboSpan" id="kobo.76.1">.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.77.1">Vulnerability scanning</span></strong><span class="koboSpan" id="kobo.78.1">: PowerShell can be used to initiate vulnerability scans on target systems, employing scripts that check for known vulnerabilities or outdated software versions. </span><span class="koboSpan" id="kobo.78.2">This aids in prioritizing potential </span><span class="No-Break"><span class="koboSpan" id="kobo.79.1">attack vectors.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.80.1">Port scanning and banner grabbing</span></strong><span class="koboSpan" id="kobo.81.1">: PowerShell’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.82.1">Test-NetConnection</span></strong><span class="koboSpan" id="kobo.83.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.84.1">Invoke-WebRequest</span></strong><span class="koboSpan" id="kobo.85.1"> can be used to perform port scans and banner grabbing. </span><span class="koboSpan" id="kobo.85.2">This information helps testers identify open ports, services, and potentially outdated software versions that may be susceptible to </span><span class="No-Break"><span class="koboSpan" id="kobo.86.1">known exploits.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.87.1">Hence, PowerShell is an indispensable tool for network enumeration during a penetration test in Windows environments. </span><span class="koboSpan" id="kobo.87.2">Its versatility, scripting capabilities, and access to system resources enable testers to gather critical information about the target network, helping them</span><a id="_idIndexMarker195"/><span class="koboSpan" id="kobo.88.1"> identify potential weaknesses</span><a id="_idIndexMarker196"/><span class="koboSpan" id="kobo.89.1"> and entry points for further exploitation. </span><span class="koboSpan" id="kobo.89.2">However, it’s essential to conduct these activities ethically and with proper authorization to ensure the security of the </span><span class="No-Break"><span class="koboSpan" id="kobo.90.1">assessed network.</span></span></p>
<h1 id="_idParaDest-63"><a id="_idTextAnchor061"/><span class="koboSpan" id="kobo.91.1">TCP port scanning using PowerShell</span></h1>
<p><span class="koboSpan" id="kobo.92.1">Port scanning is </span><a id="_idIndexMarker197"/><span class="koboSpan" id="kobo.93.1">the practice of systematically </span><a id="_idIndexMarker198"/><span class="koboSpan" id="kobo.94.1">checking the open, closed, or filtered ports on a target system. </span><span class="koboSpan" id="kobo.94.2">Open ports represent potential entry points for attackers, while closed or filtered ports may indicate security measures in place. </span><span class="koboSpan" id="kobo.94.3">By conducting a port scan, penetration testers can gather crucial information about a network or system’s </span><span class="No-Break"><span class="koboSpan" id="kobo.95.1">security posture.</span></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.96.1">Test-NetConnection</span></strong><span class="koboSpan" id="kobo.97.1"> is a versatile cmdlet available in Windows PowerShell (version 4.0 and later) that primarily serves to diagnose network connectivity. </span><span class="koboSpan" id="kobo.97.2">However, it can be repurposed to perform port scanning in a </span><span class="No-Break"><span class="koboSpan" id="kobo.98.1">penetration-testing context.</span></span></p>
<h2 id="_idParaDest-64"><a id="_idTextAnchor062"/><span class="koboSpan" id="kobo.99.1">Single port scanning with Test-NetConnection</span></h2>
<p><span class="koboSpan" id="kobo.100.1">To perform </span><a id="_idIndexMarker199"/><span class="koboSpan" id="kobo.101.1">a simple port scan on</span><a id="_idIndexMarker200"/><span class="koboSpan" id="kobo.102.1"> a target host using </span><strong class="source-inline"><span class="koboSpan" id="kobo.103.1">Test-NetConnection</span></strong><span class="koboSpan" id="kobo.104.1">, follow </span><span class="No-Break"><span class="koboSpan" id="kobo.105.1">this example:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.106.1">
Test-NetConnection -ComputerName 192.168.1.100 -Port 80
ComputerName           : 192.168.1.100
RemoteAddress          : 192.168.1.100
RemotePort             : 80
InterfaceAlias         : Ethernet
SourceAddress          : 192.168.1.101
TcpTestSucceeded       : True</span></pre> <p><span class="koboSpan" id="kobo.107.1">In this example, </span><strong class="source-inline"><span class="koboSpan" id="kobo.108.1">Test-NetConnection</span></strong><span class="koboSpan" id="kobo.109.1"> confirms that port </span><strong class="source-inline"><span class="koboSpan" id="kobo.110.1">80</span></strong><span class="koboSpan" id="kobo.111.1"> on the target system is open, which</span><a id="_idIndexMarker201"/><span class="koboSpan" id="kobo.112.1"> is indicative of</span><a id="_idIndexMarker202"/><span class="koboSpan" id="kobo.113.1"> a </span><span class="No-Break"><span class="koboSpan" id="kobo.114.1">web server.</span></span></p>
<h2 id="_idParaDest-65"><a id="_idTextAnchor063"/><span class="koboSpan" id="kobo.115.1">Multiple port scanning with Test-NetConnection</span></h2>
<p><span class="koboSpan" id="kobo.116.1">A penetration </span><a id="_idIndexMarker203"/><span class="koboSpan" id="kobo.117.1">tester often needs </span><a id="_idIndexMarker204"/><span class="koboSpan" id="kobo.118.1">to scan multiple ports on a target system. </span><strong class="source-inline"><span class="koboSpan" id="kobo.119.1">Test-NetConnection</span></strong><span class="koboSpan" id="kobo.120.1"> can be used in a loop to scan a range of ports or a list of </span><span class="No-Break"><span class="koboSpan" id="kobo.121.1">specific ports:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.122.1">
$RemoteHost = "192.168.1.100"
$Ports = 80, 443
foreach ($Port in $Ports) {
    Test-NetConnection -ComputerName $RemoteHost -Port $Port }
ComputerName           : 192.168.1.100
RemoteAddress          : 192.168.1.100
RemotePort             : 80
InterfaceAlias         : Ethernet
SourceAddress          : 192.168.1.101
TcpTestSucceeded       : True
ComputerName           : 192.168.1.100
RemoteAddress          : 192.168.1.100
RemotePort             : 443
InterfaceAlias         : Ethernet
SourceAddress          : 192.168.1.101
TcpTestSucceeded       : False</span></pre> <p><span class="koboSpan" id="kobo.123.1">In this case, </span><strong class="source-inline"><span class="koboSpan" id="kobo.124.1">Test-NetConnection</span></strong><span class="koboSpan" id="kobo.125.1"> scans ports </span><strong class="source-inline"><span class="koboSpan" id="kobo.126.1">80</span></strong><span class="koboSpan" id="kobo.127.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.128.1">443</span></strong><span class="koboSpan" id="kobo.129.1"> on the target system. </span><span class="koboSpan" id="kobo.129.2">The results </span><a id="_idIndexMarker205"/><span class="koboSpan" id="kobo.130.1">show whether each </span><a id="_idIndexMarker206"/><span class="koboSpan" id="kobo.131.1">port is open </span><span class="No-Break"><span class="koboSpan" id="kobo.132.1">or not.</span></span></p>
<h2 id="_idParaDest-66"><a id="_idTextAnchor064"/><span class="koboSpan" id="kobo.133.1">Enumerating open ports with Test-NetConnection</span></h2>
<p><span class="koboSpan" id="kobo.134.1">One of the </span><a id="_idIndexMarker207"/><span class="koboSpan" id="kobo.135.1">primary objectives </span><a id="_idIndexMarker208"/><span class="koboSpan" id="kobo.136.1">of a penetration test is to enumerate open ports. </span><span class="koboSpan" id="kobo.136.2">You can utilize PowerShell to filter and display only the </span><span class="No-Break"><span class="koboSpan" id="kobo.137.1">open ports:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.138.1">
$RemoteHost = "192.168.1.100"
$Ports = 1..65535
$OpenPorts = foreach ($Port in $Ports) {
    $Result = Test-NetConnection -ComputerName $RemoteHost -Port $Port
    if ($Result.TcpTestSucceeded) {
        $Port
    }
}</span></pre> <p><span class="koboSpan" id="kobo.139.1">In this example, </span><strong class="source-inline"><span class="koboSpan" id="kobo.140.1">Test-NetConnection</span></strong><span class="koboSpan" id="kobo.141.1"> scans all possible ports and identifies the open ones. </span><strong class="source-inline"><span class="koboSpan" id="kobo.142.1">Test-NetConnection</span></strong><span class="koboSpan" id="kobo.143.1">, while primarily designed for diagnosing network connectivity, can be a valuable tool for penetration testers to perform port scanning. </span><span class="koboSpan" id="kobo.143.2">By utilizing its capabilities to check the status of specific ports on a target system, penetration testers can gather crucial information about potential vulnerabilities and security weaknesses. </span><span class="koboSpan" id="kobo.143.3">However, it’s important to note that penetration testing should always be conducted with proper authorization and in a responsible, ethical manner to avoid any legal or ethical issues. </span><strong class="source-inline"><span class="koboSpan" id="kobo.144.1">Test-NetConnection</span></strong><span class="koboSpan" id="kobo.145.1">, when used within these guidelines, can be an asset in a penetration </span><span class="No-Break"><span class="koboSpan" id="kobo.146.1">tester’s toolkit.</span></span></p>
<h2 id="_idParaDest-67"><a id="_idTextAnchor065"/><span class="koboSpan" id="kobo.147.1">Single port scanning with .NET</span></h2>
<p><span class="koboSpan" id="kobo.148.1">PowerShell </span><a id="_idIndexMarker209"/><span class="koboSpan" id="kobo.149.1">can create a .NET socket object to </span><a id="_idIndexMarker210"/><span class="koboSpan" id="kobo.150.1">establish a connection with a single port on a target host. </span><span class="koboSpan" id="kobo.150.2">Here’s </span><span class="No-Break"><span class="koboSpan" id="kobo.151.1">an example:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.152.1">
$RHost = "192.168.1.100"
$Port = 80
$TcpClient = New-Object System.Net.Sockets.TcpClient
try {
    $TcpClient.Connect($RHost, $Port)
    Write-Host "Port $Port on $RHost is open."
</span><span class="koboSpan" id="kobo.152.2">}
catch {
    Write-Host "Port $Port on $RHost is closed or filtered."
</span><span class="koboSpan" id="kobo.152.3">}
finally {
    $TcpClient.Close()}</span></pre> <p><span class="koboSpan" id="kobo.153.1">In this example, PowerShell creates a TCP client object and attempts to connect to the specified port</span><a id="_idIndexMarker211"/><span class="koboSpan" id="kobo.154.1"> on the target host. </span><span class="koboSpan" id="kobo.154.2">It then reports whether the port is open </span><span class="No-Break"><span class="koboSpan" id="kobo.155.1">or closed.</span></span></p>
<h2 id="_idParaDest-68"><a id="_idTextAnchor066"/><span class="koboSpan" id="kobo.156.1">Multiple port scanning with .NET</span></h2>
<p><span class="koboSpan" id="kobo.157.1">A typical </span><a id="_idIndexMarker212"/><span class="koboSpan" id="kobo.158.1">penetration test involves scanning </span><a id="_idIndexMarker213"/><span class="koboSpan" id="kobo.159.1">multiple ports on a target system. </span><span class="koboSpan" id="kobo.159.2">PowerShell can iterate through a list of ports and check </span><span class="No-Break"><span class="koboSpan" id="kobo.160.1">their status:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.161.1">
$RHost = "192.168.1.100"
$Ports = 80, 443, 22
foreach ($Port in $Ports) {
    $TcpClient = New-Object System.Net.Sockets.TcpClient
    try {
        $TcpClient.Connect($RHost, $Port)
        Write-Host "Port $Port on $RHost is open."
</span><span class="koboSpan" id="kobo.161.2">    }
    catch {
        Write-Host "Port $Port on $RHost is closed or filtered."
</span><span class="koboSpan" id="kobo.161.3">    }
    finally {
        $TcpClient.Close()}}</span></pre> <p><span class="koboSpan" id="kobo.162.1">This PowerShell</span><a id="_idIndexMarker214"/><span class="koboSpan" id="kobo.163.1"> script scans a list of ports on the</span><a id="_idIndexMarker215"/><span class="koboSpan" id="kobo.164.1"> target host and reports </span><span class="No-Break"><span class="koboSpan" id="kobo.165.1">their status.</span></span></p>
<h2 id="_idParaDest-69"><a id="_idTextAnchor067"/><span class="koboSpan" id="kobo.166.1">Enumerating all open ports with .NET</span></h2>
<p><span class="koboSpan" id="kobo.167.1">In some cases, it’s </span><a id="_idIndexMarker216"/><span class="koboSpan" id="kobo.168.1">essential to enumerate all </span><a id="_idIndexMarker217"/><span class="koboSpan" id="kobo.169.1">open ports on a target system. </span><span class="koboSpan" id="kobo.169.2">PowerShell can be used to scan a range of </span><span class="No-Break"><span class="koboSpan" id="kobo.170.1">ports systematically:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.171.1">
$RHost = "192.168.1.100"
$StartPort = 1
$EndPort = 65535
for ($Port = $StartPort; $Port -le $EndPort; $Port++) {
    $TcpClient = New-Object System.Net.Sockets.TcpClient
    try {
        $TcpClient.Connect($RHost, $Port)
        Write-Host "Port $Port on $RHost is open."
</span><span class="koboSpan" id="kobo.171.2">    }
    catch {# Port is closed or filtered.}
    finally {
        $TcpClient.Close()}}</span></pre> <p><span class="koboSpan" id="kobo.172.1">PowerShell systematically scans all possible ports on the target host and reports the </span><span class="No-Break"><span class="koboSpan" id="kobo.173.1">open ones.</span></span></p>
<p><span class="koboSpan" id="kobo.174.1">Leveraging .NET Socket Objects in PowerShell provides penetration testers with a versatile and programmable approach to conducting port scanning, as a vital part of ethical hacking assessments. </span><span class="koboSpan" id="kobo.174.2">Port scanning plays a pivotal role in identifying potential vulnerabilities within a target system, and .NET Socket Objects empower testers to automate and customize this process effectively. </span><span class="koboSpan" id="kobo.174.3">However, it’s imperative to conduct penetration tests responsibly, adhering to legal and ethical guidelines and obtaining proper authorization. </span><span class="koboSpan" id="kobo.174.4">When used responsibly, .NET Socket Objects in PowerShell serve as powerful tools</span><a id="_idIndexMarker218"/><span class="koboSpan" id="kobo.175.1"> for penetration testers to assess the security posture of systems and networks, ultimately </span><a id="_idIndexMarker219"/><span class="No-Break"><span class="koboSpan" id="kobo.176.1">enhancing cybersecurity.</span></span></p>
<h1 id="_idParaDest-70"><a id="_idTextAnchor068"/><span class="koboSpan" id="kobo.177.1">UDP port scanning using PowerShell</span></h1>
<p><span class="koboSpan" id="kobo.178.1">Performing UDP </span><a id="_idIndexMarker220"/><span class="koboSpan" id="kobo.179.1">port scanning in PowerShell involves</span><a id="_idIndexMarker221"/><span class="koboSpan" id="kobo.180.1"> sending UDP packets to specific ports on a target host to determine whether those ports are open or closed. </span><span class="koboSpan" id="kobo.180.2">Unlike TCP, UDP is connectionless, which makes UDP port scanning a bit more challenging, as there are no handshakes to confirm the port’s status. </span><span class="koboSpan" id="kobo.180.3">Here’s a simplified method </span><span class="No-Break"><span class="koboSpan" id="kobo.181.1">using PowerShell:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.182.1">
$RHost = "192.168.1.100"
$Ports = 53, 67, 123
foreach ($Port in $Ports) {
    $UdpClient = New-Object System.Net.Sockets.UdpClient
    try {
        $UdpClient.Connect($RHost, $Port)
        $UdpClient.Send([byte[]](0), 0, 0)
        Write-Host "UDP Port $Port open - $RHost"
    }
    catch {
        Write-Host "UDP Port $Port closed - $Host."
</span><span class="koboSpan" id="kobo.182.2">    }
    finally {
        $UdpClient.Close()}}</span></pre> <p><span class="koboSpan" id="kobo.183.1">This script iterates through the specified UDP ports, creates a UDP client object, and sends an empty UDP packet to each port. </span><span class="koboSpan" id="kobo.183.2">If an exception is caught during the process, it means the port is closed or filtered. </span><span class="koboSpan" id="kobo.183.3">If no exception is raised, the port is </span><span class="No-Break"><span class="koboSpan" id="kobo.184.1">considered open.</span></span></p>
<p><span class="koboSpan" id="kobo.185.1">Note that UDP scanning can be less reliable than TCP scanning, as UDP does not provide the same acknowledgment and response mechanisms as TCP. </span><span class="koboSpan" id="kobo.185.2">Some open UDP ports may not respond to empty UDP packets, which could lead to false negatives. </span><span class="koboSpan" id="kobo.185.3">Additionally, firewalls and network filtering can affect the accuracy of UDP port scanning. </span><span class="koboSpan" id="kobo.185.4">Always </span><a id="_idIndexMarker222"/><span class="koboSpan" id="kobo.186.1">ensure</span><a id="_idIndexMarker223"/><span class="koboSpan" id="kobo.187.1"> you have proper authorization, and consider using more specialized tools for comprehensive </span><span class="No-Break"><span class="koboSpan" id="kobo.188.1">penetration-testing tasks.</span></span></p>
<h1 id="_idParaDest-71"><a id="_idTextAnchor069"/><span class="koboSpan" id="kobo.189.1">Using PowerShell tools for port scanning</span></h1>
<p><span class="koboSpan" id="kobo.190.1">There are </span><a id="_idIndexMarker224"/><span class="koboSpan" id="kobo.191.1">several open source PowerShell tools </span><a id="_idIndexMarker225"/><span class="koboSpan" id="kobo.192.1">that support TCP/UDP port scanning. </span><span class="koboSpan" id="kobo.192.2">The following is an example of a PowerShell Scanning </span><span class="No-Break"><span class="koboSpan" id="kobo.193.1">tool: </span></span><a href="https://github.com/BornToBeRoot/PowerShell_IPv4PortScanner"><span class="No-Break"><span class="koboSpan" id="kobo.194.1">https://github.com/BornToBeRoot/PowerShell_IPv4PortScanner</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.195.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.196.1">The IPv4PortScan is an asynchronous TCP scanning tool that allows a user to define the port range to be scanned. </span><span class="koboSpan" id="kobo.196.2">The command line for the tool is </span><span class="No-Break"><span class="koboSpan" id="kobo.197.1">as follows:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.198.1">
.\IPv4PortScan.ps1 [-ComputerName] &lt;String&gt; [[-StartPort] &lt;Int32&gt;] [[-EndPort] &lt;Int32&gt;] [[-Threads] &lt;Int32&gt;] [[-Force]] [&lt;CommonParameters&gt;]</span></pre> <p><span class="koboSpan" id="kobo.199.1">In the following, we will use this tool to scan the first 500 ports on the </span><span class="No-Break"><span class="koboSpan" id="kobo.200.1">computer </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.201.1">www.snowcapcyber.com</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.202.1">:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.203.1">
PS&gt; .\IPv4PortScan.ps1 -ComputerName www.snowcapcyber.com -EndPort 500
Port Protocol ServiceName  ServiceDescription   Status
---- -------- -----------  ------------------   ------
  53  tcp     domain       Domain Name Server   open
  80 tcp      http         World Wide Web HTTP  open</span></pre> <p><span class="koboSpan" id="kobo.204.1">The PS2 tool is a TCP port scanner tool that mimics some of the functions of Nmap. </span><span class="koboSpan" id="kobo.204.2">This tool can be downloaded </span><span class="No-Break"><span class="koboSpan" id="kobo.205.1">at </span></span><a href="https://github.com/nccgroup/PS2"><span class="No-Break"><span class="koboSpan" id="kobo.206.1">https://github.com/nccgroup/PS2</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.207.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.208.1">The tool supports TCP and UDP scanning as well as mapping out a network using a traceroute function. </span><span class="koboSpan" id="kobo.208.2">In the following, we will use this tool to scan the top 1,000 commonly used </span><span class="No-Break"><span class="koboSpan" id="kobo.209.1">TCP ports:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.210.1">
PS C:\&gt;ps2.ps1 -sT -i 192.168.1.1</span></pre> <p><span class="koboSpan" id="kobo.211.1">In the following example, we will use the tool to scan all the </span><span class="No-Break"><span class="koboSpan" id="kobo.212.1">TCP ports:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.213.1">
PS C:\&gt;ps2.ps1 -sT -p (1..65535) -i 192.168.1.1</span></pre> <p><span class="koboSpan" id="kobo.214.1">Finally, we will use the tool to scan the top 1,000 commonly used </span><span class="No-Break"><span class="koboSpan" id="kobo.215.1">UDP ports:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.216.1">
PS C:\&gt;ps2.ps1 -sU -i 192.168.1.1</span></pre> <p><span class="koboSpan" id="kobo.217.1">In summary, PowerShell provides us with the ability to create simple, and powerful, TCP/UDP port scanning tools. </span><span class="koboSpan" id="kobo.217.2">We have shown how cmdlets can be used and scripted and how </span><a id="_idIndexMarker226"/><span class="koboSpan" id="kobo.218.1">PowerShell </span><a id="_idIndexMarker227"/><span class="koboSpan" id="kobo.219.1">can make use of .NET functions. </span><span class="koboSpan" id="kobo.219.2">These tools enable us to live off the land within a penetration test and minimize the number of tools we are required to support within a </span><span class="No-Break"><span class="koboSpan" id="kobo.220.1">security test.</span></span></p>
<h1 id="_idParaDest-72"><a id="_idTextAnchor070"/><span class="koboSpan" id="kobo.221.1">Summary</span></h1>
<p><span class="koboSpan" id="kobo.222.1">This chapter was a comprehensive exploration of leveraging PowerShell for robust network reconnaissance and security assessment. </span><span class="koboSpan" id="kobo.222.2">Detailing the significance of understanding network structures, the chapter illuminated how PowerShell can be harnessed to enumerate devices and services efficiently. </span><span class="koboSpan" id="kobo.222.3">You were guided through the intricacies of network enumeration, gaining insights into PowerShell techniques to discover active hosts, identify live systems, and map </span><span class="No-Break"><span class="koboSpan" id="kobo.223.1">network architectures.</span></span></p>
<p><span class="koboSpan" id="kobo.224.1">The chapter further delved into the realm of port scanning, emphasizing the critical role it plays in vulnerability assessment. </span><span class="koboSpan" id="kobo.224.2">Demonstrating the power of PowerShell for port scanning, the chapter unveiled strategies to identify open ports, services, and potential vulnerabilities. </span><span class="koboSpan" id="kobo.224.3">Practical examples and real-world scenarios equipped you with hands-on experience, empowering you to strengthen network security. </span><span class="koboSpan" id="kobo.224.4">Whether for defensive purposes or ethical hacking, this chapter serves as a valuable resource, providing a nuanced understanding of network enumeration and port scanning using the versatile capabilities </span><span class="No-Break"><span class="koboSpan" id="kobo.225.1">of PowerShell.</span></span></p>
<p><span class="koboSpan" id="kobo.226.1">In the next chapter, we will learn how to use PowerShell when performing penetration testing on REST and </span><span class="No-Break"><span class="koboSpan" id="kobo.227.1">SOAP APIs.</span></span></p>
</div>
</body></html>