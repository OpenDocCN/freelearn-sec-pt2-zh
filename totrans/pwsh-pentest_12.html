<html><head></head><body>
<div id="_idContainer049">
<h1 class="chapter-number" id="_idParaDest-298"><a id="_idTextAnchor296"/><span class="koboSpan" id="kobo.1.1">12</span></h1>
<h1 id="_idParaDest-299"><a id="_idTextAnchor297"/><span class="koboSpan" id="kobo.2.1">Using PowerShell in Azure</span></h1>
<p><span class="koboSpan" id="kobo.3.1">In this chapter, we delve into the strategic utilization of PowerShell to execute a comprehensive penetration test on Azure environments. </span><span class="koboSpan" id="kobo.3.2">PowerShell, a versatile scripting language, empowers penetration testers to analyze Azure’s intricate ecosystem, including Identity Management, Role-Based Access Control, Data Storage, SQL, Web Services, and more. </span><span class="koboSpan" id="kobo.3.3">From gathering detailed information on Azure resources to automating complex analyses, this chapter demonstrates how PowerShell is a key ally in identifying vulnerabilities, assessing security configurations, and fortifying Azure against potential threats. </span><span class="koboSpan" id="kobo.3.4">Harness the full potential of PowerShell to enhance the efficiency and efficacy of penetration testing in Azure, ensuring a robust and resilient cloud </span><span class="No-Break"><span class="koboSpan" id="kobo.4.1">security posture.</span></span></p>
<p><span class="koboSpan" id="kobo.5.1">The following are the main topics to be covered in </span><span class="No-Break"><span class="koboSpan" id="kobo.6.1">this chapter:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.7.1">Introduction </span><span class="No-Break"><span class="koboSpan" id="kobo.8.1">to Azure</span></span></li>
<li><span class="koboSpan" id="kobo.9.1">Azure architecture </span><span class="No-Break"><span class="koboSpan" id="kobo.10.1">and governance</span></span></li>
<li><span class="No-Break"><span class="koboSpan" id="kobo.11.1">Accessing Azure</span></span></li>
<li><span class="koboSpan" id="kobo.12.1">Networking </span><span class="No-Break"><span class="koboSpan" id="kobo.13.1">in Azure</span></span></li>
<li><span class="koboSpan" id="kobo.14.1">Identity Management and Role-Based </span><span class="No-Break"><span class="koboSpan" id="kobo.15.1">Access Control</span></span></li>
<li><span class="koboSpan" id="kobo.16.1">Azure Data Storage </span><span class="No-Break"><span class="koboSpan" id="kobo.17.1">and permissions</span></span></li>
<li><span class="koboSpan" id="kobo.18.1">Azure </span><span class="No-Break"><span class="koboSpan" id="kobo.19.1">and SQL</span></span></li>
<li><span class="koboSpan" id="kobo.20.1">Azure and </span><span class="No-Break"><span class="koboSpan" id="kobo.21.1">key vaults</span></span></li>
<li><span class="koboSpan" id="kobo.22.1">Azure and </span><span class="No-Break"><span class="koboSpan" id="kobo.23.1">virtual machines</span></span></li>
<li><span class="koboSpan" id="kobo.24.1">Azure and </span><span class="No-Break"><span class="koboSpan" id="kobo.25.1">Web Services</span></span></li>
</ul>
<h1 id="_idParaDest-300"><a id="_idTextAnchor298"/><span class="koboSpan" id="kobo.26.1">Introduction to Azure</span></h1>
<p><strong class="bold"><span class="koboSpan" id="kobo.27.1">Azure</span></strong><span class="koboSpan" id="kobo.28.1"> is the Microsoft Cloud computing </span><a id="_idIndexMarker655"/><span class="koboSpan" id="kobo.29.1">platform. </span><span class="koboSpan" id="kobo.29.2">Azure is built around the concepts of Identity Management and Role-Based Access Control. </span><span class="koboSpan" id="kobo.29.3">Within Azure, we have various resources of various types that we can control. </span><span class="koboSpan" id="kobo.29.4">At the </span><a id="_idIndexMarker656"/><span class="koboSpan" id="kobo.30.1">heart of Azure is the </span><strong class="bold"><span class="koboSpan" id="kobo.31.1">Azure Active Directory</span></strong><span class="koboSpan" id="kobo.32.1">. </span><span class="koboSpan" id="kobo.32.2">This is used to perform Identity Management. </span><span class="koboSpan" id="kobo.32.3">Azure testing can be broken down into </span><span class="No-Break"><span class="koboSpan" id="kobo.33.1">the following:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.34.1">Accessing Azure and reconnaissance</span></strong><span class="koboSpan" id="kobo.35.1">: This concerns accessing</span><a id="_idIndexMarker657"/><span class="koboSpan" id="kobo.36.1"> the Azure environment and starting to profile the </span><span class="No-Break"><span class="koboSpan" id="kobo.37.1">Azure Tenancy</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.38.1">Investigating networks and DNS</span></strong><span class="koboSpan" id="kobo.39.1">: This involved profiling the Azure infrastructure</span><a id="_idIndexMarker658"/><span class="koboSpan" id="kobo.40.1"> to identify what systems have been deployed and how the network infrastructure has </span><span class="No-Break"><span class="koboSpan" id="kobo.41.1">been configured</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.42.1">Identity Management and Role-Based Access Control</span></strong><span class="koboSpan" id="kobo.43.1">: This is concerned with</span><a id="_idIndexMarker659"/><span class="koboSpan" id="kobo.44.1"> profiling and identifying</span><a id="_idIndexMarker660"/><span class="koboSpan" id="kobo.45.1"> the weaknesses in the Identity Management deployed within the </span><span class="No-Break"><span class="koboSpan" id="kobo.46.1">Azure Tenancy</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.47.1">Examining storage</span></strong><span class="koboSpan" id="kobo.48.1">: This focuses on the analysis</span><a id="_idIndexMarker661"/><span class="koboSpan" id="kobo.49.1"> and vulnerability identification of the Storage Structures used within </span><span class="No-Break"><span class="koboSpan" id="kobo.50.1">Azure Tenancy</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.51.1">Virtual machines</span></strong><span class="koboSpan" id="kobo.52.1">: This focuses on the analysis</span><a id="_idIndexMarker662"/><span class="koboSpan" id="kobo.53.1"> and vulnerability identification of the virtual machines used within </span><span class="No-Break"><span class="koboSpan" id="kobo.54.1">Azure Tenancy</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.55.1">Azure and SQL</span></strong><span class="koboSpan" id="kobo.56.1">: This concerns identifying</span><a id="_idIndexMarker663"/><span class="koboSpan" id="kobo.57.1"> and profiling the types of SQL systems used within </span><span class="No-Break"><span class="koboSpan" id="kobo.58.1">Azure Tenancy</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.59.1">Azure Key Vaults</span></strong><span class="koboSpan" id="kobo.60.1">: This examines how the key</span><a id="_idIndexMarker664"/><span class="koboSpan" id="kobo.61.1"> vaults used to store passwords for Azure have </span><span class="No-Break"><span class="koboSpan" id="kobo.62.1">been configured</span></span></li>
</ul>
<h1 id="_idParaDest-301"><a id="_idTextAnchor299"/><span class="koboSpan" id="kobo.63.1">Azure architecture and governance</span></h1>
<p><span class="koboSpan" id="kobo.64.1">Azure architecture encompasses</span><a id="_idIndexMarker665"/><span class="koboSpan" id="kobo.65.1"> a comprehensive set of cloud computing services, building blocks, and resources designed to facilitate various applications and services’ development, deployment, and management. </span><span class="koboSpan" id="kobo.65.2">Microsoft Azure provides a flexible and scalable platform that supports diverse workloads, from simple web applications to complex enterprise solutions. </span><span class="koboSpan" id="kobo.65.3">Here’s an overview of key components</span><a id="_idIndexMarker666"/><span class="koboSpan" id="kobo.66.1"> within </span><span class="No-Break"><span class="koboSpan" id="kobo.67.1">Azure’s architecture:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.68.1">Global data center presence</span></strong><span class="koboSpan" id="kobo.69.1">: Azure operates a vast network</span><a id="_idIndexMarker667"/><span class="koboSpan" id="kobo.70.1"> of data centers strategically distributed across the globe. </span><span class="koboSpan" id="kobo.70.2">This global presence ensures low-latency access to services and high availability </span><span class="No-Break"><span class="koboSpan" id="kobo.71.1">for applications.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.72.1">Regions</span></strong><span class="koboSpan" id="kobo.73.1">: Azure is divided into geographical</span><a id="_idIndexMarker668"/><span class="koboSpan" id="kobo.74.1"> regions, each comprising multiple data centers. </span><span class="koboSpan" id="kobo.74.2">The regions are isolated from each other to provide redundancy and enable users to deploy resources in proximity to their </span><span class="No-Break"><span class="koboSpan" id="kobo.75.1">target audience.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.76.1">Availability zones</span></strong><span class="koboSpan" id="kobo.77.1">: Azure offers availability zones</span><a id="_idIndexMarker669"/><span class="koboSpan" id="kobo.78.1"> within regions in the form of physically separate data centers with independent power, cooling, and networking. </span><span class="koboSpan" id="kobo.78.2">Deploying resources across availability zones enhances resiliency and </span><span class="No-Break"><span class="koboSpan" id="kobo.79.1">fault tolerance.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.80.1">Resource groups</span></strong><span class="koboSpan" id="kobo.81.1">: Resource groups are logical</span><a id="_idIndexMarker670"/><span class="koboSpan" id="kobo.82.1"> containers that organize and manage related resources within Azure. </span><span class="koboSpan" id="kobo.82.2">Grouping resources simplifies management, monitoring, and the application </span><span class="No-Break"><span class="koboSpan" id="kobo.83.1">of policies.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.84.1">Virtual networks</span></strong><span class="koboSpan" id="kobo.85.1">: Azure virtual networks allow </span><a id="_idIndexMarker671"/><span class="koboSpan" id="kobo.86.1">users to create private, isolated networks within the Azure cloud. </span><span class="koboSpan" id="kobo.86.2">They facilitate the connection of resources, such as virtual machines and databases, while enabling control over </span><span class="No-Break"><span class="koboSpan" id="kobo.87.1">network configurations.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.88.1">Virtual Machines</span></strong><span class="koboSpan" id="kobo.89.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.90.1">VMs</span></strong><span class="koboSpan" id="kobo.91.1">): Azure VMs provide scalable</span><a id="_idIndexMarker672"/><span class="koboSpan" id="kobo.92.1"> computing power in the cloud. </span><span class="koboSpan" id="kobo.92.2">Users can deploy and manage VMs running various operating systems tailored to their specific </span><span class="No-Break"><span class="koboSpan" id="kobo.93.1">application needs.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.94.1">Azure Blob Storage</span></strong><span class="koboSpan" id="kobo.95.1">: Azure Blob Storage is a scalable</span><a id="_idIndexMarker673"/><span class="koboSpan" id="kobo.96.1"> and secure object storage solution for large amounts of unstructured data, such as documents, images, and videos. </span><span class="koboSpan" id="kobo.96.2">It offers different storage tiers to </span><span class="No-Break"><span class="koboSpan" id="kobo.97.1">optimize costs.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.98.1">Azure app service</span></strong><span class="koboSpan" id="kobo.99.1">: The Azure app service enables the deployment</span><a id="_idIndexMarker674"/><span class="koboSpan" id="kobo.100.1"> of web, mobile, and API applications without managing the underlying infrastructure. </span><span class="koboSpan" id="kobo.100.2">It supports various programming languages </span><span class="No-Break"><span class="koboSpan" id="kobo.101.1">and frameworks.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.102.1">Azure SQL database</span></strong><span class="koboSpan" id="kobo.103.1">: The Azure SQL database</span><a id="_idIndexMarker675"/><span class="koboSpan" id="kobo.104.1"> is a fully managed relational database service that provides high availability, security, and scalability for applications requiring structured </span><span class="No-Break"><span class="koboSpan" id="kobo.105.1">Data Storage.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.106.1">Azure Kubernetes Service</span></strong><span class="koboSpan" id="kobo.107.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.108.1">AKS</span></strong><span class="koboSpan" id="kobo.109.1">): For containerized applications, Azure</span><a id="_idIndexMarker676"/><span class="koboSpan" id="kobo.110.1"> offers AKS—a managed Kubernetes service. </span><span class="koboSpan" id="kobo.110.2">It simplifies the deployment, management, and scaling of </span><span class="No-Break"><span class="koboSpan" id="kobo.111.1">containerized applications.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.112.1">Azure Active Directory</span></strong><span class="koboSpan" id="kobo.113.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.114.1">AAD</span></strong><span class="koboSpan" id="kobo.115.1">): Azure Active Directory is a cloud-based Identity and access management</span><a id="_idIndexMarker677"/><span class="koboSpan" id="kobo.116.1"> service. </span><span class="koboSpan" id="kobo.116.2">It provides authentication, authorization, and single sign-on capabilities, enhancing security and </span><span class="No-Break"><span class="koboSpan" id="kobo.117.1">user management.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.118.1">Azure Functions</span></strong><span class="koboSpan" id="kobo.119.1">: Azure Functions allow</span><a id="_idIndexMarker678"/><span class="koboSpan" id="kobo.120.1"> users to run event-triggered</span><a id="_idIndexMarker679"/><span class="koboSpan" id="kobo.121.1"> code without provisioning or managing servers. </span><span class="koboSpan" id="kobo.121.2">It supports serverless computing, enabling the efficient execution of small, </span><span class="No-Break"><span class="koboSpan" id="kobo.122.1">isolated functions.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.123.1">Azure Security Center</span></strong><span class="koboSpan" id="kobo.124.1">: Azure Security Center provides</span><a id="_idIndexMarker680"/><span class="koboSpan" id="kobo.125.1"> advanced threat protection across all Azure resources. </span><span class="koboSpan" id="kobo.125.2">It monitors security configurations, identifies potential threats, and provides actionable insights to enhance </span><span class="No-Break"><span class="koboSpan" id="kobo.126.1">security posture.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.127.1">Azure DevOps</span></strong><span class="koboSpan" id="kobo.128.1">: Azure DevOps is a set of development </span><a id="_idIndexMarker681"/><span class="koboSpan" id="kobo.129.1">tools and services for building, testing, and deploying applications. </span><span class="koboSpan" id="kobo.129.2">It includes features such as version control, continuous integration, and </span><span class="No-Break"><span class="koboSpan" id="kobo.130.1">release management.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.131.1">In conclusion, Azure’s architecture provides a robust foundation for building and scaling applications in the cloud. </span><span class="koboSpan" id="kobo.131.2">With its diverse services, global infrastructure, and strong security features, Azure caters to the needs of a wide range of businesses and industries, enabling them to innovate and transform their </span><span class="No-Break"><span class="koboSpan" id="kobo.132.1">IT landscape.</span></span></p>
<p><span class="koboSpan" id="kobo.133.1">PowerShell plays a crucial role</span><a id="_idIndexMarker682"/><span class="koboSpan" id="kobo.134.1"> in Azure governance, enabling administrators to efficiently manage, enforce policies, and maintain compliance across Azure resources. </span><span class="koboSpan" id="kobo.134.2">Here’s a detailed explanation with examples of how PowerShell can be utilized for governance </span><span class="No-Break"><span class="koboSpan" id="kobo.135.1">within Azure:</span></span></p>
<h2 id="_idParaDest-302"><a id="_idTextAnchor300"/><span class="koboSpan" id="kobo.136.1">Azure Policy enforcement</span></h2>
<p><span class="koboSpan" id="kobo.137.1">Azure Policy allows </span><a id="_idIndexMarker683"/><span class="koboSpan" id="kobo.138.1">you to enforce rules and standards across resources. </span><span class="koboSpan" id="kobo.138.2">PowerShell’s AzPolicy module provides cmdlets to work with </span><span class="No-Break"><span class="koboSpan" id="kobo.139.1">Azure Policy:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.140.1">
# Assign a policy to deny the creation of resources without tags
New-AzPolicyAssignment -Name "DenyResourceWithoutTags" -DisplayName "Deny Resources Without Tags" -Scope "/subscriptions/{subscriptionId}" -PolicyDefinitionReferenceId "/providers/Microsoft.Authorization/policyDefinitions/{policyDefinitionId}" -EnforcementMode DoNotEnforce</span></pre> <p><span class="koboSpan" id="kobo.141.1">The PowerShell cmdlet </span><strong class="source-inline"><span class="koboSpan" id="kobo.142.1">New-AzPolicyAssignment</span></strong><span class="koboSpan" id="kobo.143.1"> is used to create a new policy assignment in Azure. </span><span class="koboSpan" id="kobo.143.2">The command you provided seems to be creating a new policy assignment named “</span><strong class="source-inline"><span class="koboSpan" id="kobo.144.1">DenyResourceWithoutTags</span></strong><span class="koboSpan" id="kobo.145.1">” with the display name “</span><strong class="source-inline"><span class="koboSpan" id="kobo.146.1">Deny Resources Without Tags</span></strong><span class="koboSpan" id="kobo.147.1">”. </span><span class="koboSpan" id="kobo.147.2">Here’s a breakdown of the </span><span class="No-Break"><span class="koboSpan" id="kobo.148.1">parameters used:</span></span></p>
<ul>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.149.1">Name</span></strong><span class="koboSpan" id="kobo.150.1">: Specifies the name of the policy assignment. </span><span class="koboSpan" id="kobo.150.2">In this case, </span><span class="No-Break"><span class="koboSpan" id="kobo.151.1">it’s “</span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.152.1">DenyResourceWithoutTags</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.153.1">”.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.154.1">DisplayName</span></strong><span class="koboSpan" id="kobo.155.1">: Specifies the display name for the policy assignment. </span><span class="koboSpan" id="kobo.155.2">This is the name that will be shown in Azure Portal and </span><span class="No-Break"><span class="koboSpan" id="kobo.156.1">other interfaces.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.157.1">Scope</span></strong><span class="koboSpan" id="kobo.158.1">: Specifies the scope at which the policy assignment will be applied. </span><span class="koboSpan" id="kobo.158.2">In this example, it’s set to a subscription-level scope: </span><strong class="source-inline"><span class="koboSpan" id="kobo.159.1">(/subscriptions/{subscriptionId})</span></strong><span class="koboSpan" id="kobo.160.1">. </span><span class="koboSpan" id="kobo.160.2">You need to replace </span><strong class="source-inline"><span class="koboSpan" id="kobo.161.1">{subscriptionId}</span></strong><span class="koboSpan" id="kobo.162.1"> with the actual </span><span class="No-Break"><span class="koboSpan" id="kobo.163.1">subscription ID.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.164.1">PolicyDefinitionReferenceId</span></strong><span class="koboSpan" id="kobo.165.1">: Specifies the ID of the policy definition to be assigned. </span><span class="koboSpan" id="kobo.165.2">This references an existing policy definition. </span><span class="koboSpan" id="kobo.165.3">The value should be in the format </span><strong class="source-inline"><span class="koboSpan" id="kobo.166.1">/providers/Microsoft.Authorization/policyDefinitions/{policyDefinitionId}</span></strong><span class="koboSpan" id="kobo.167.1">. </span><span class="koboSpan" id="kobo.167.2">You need to replace </span><strong class="source-inline"><span class="koboSpan" id="kobo.168.1">{policyDefinitionId}</span></strong><span class="koboSpan" id="kobo.169.1"> with the actual ID of the policy definition you want </span><span class="No-Break"><span class="koboSpan" id="kobo.170.1">to assign.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.171.1">EnforcementMode</span></strong><span class="koboSpan" id="kobo.172.1">: Specifies the enforcement mode for the policy assignment. </span><span class="koboSpan" id="kobo.172.2">In this case, it’s set to </span><strong class="source-inline"><span class="koboSpan" id="kobo.173.1">DoNotEnforce</span></strong><span class="koboSpan" id="kobo.174.1">, which means the policy is created but not enforced. </span><span class="koboSpan" id="kobo.174.2">This is useful for testing or rolling out policies gradually. </span><span class="koboSpan" id="kobo.174.3">The possible values</span><a id="_idIndexMarker684"/><span class="koboSpan" id="kobo.175.1"> for enforcement mode are </span><strong class="source-inline"><span class="koboSpan" id="kobo.176.1">Default</span></strong><span class="koboSpan" id="kobo.177.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.178.1">DoNotEnforce</span></strong><span class="koboSpan" id="kobo.179.1">, </span><span class="No-Break"><span class="koboSpan" id="kobo.180.1">and </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.181.1">Enforce</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.182.1">.</span></span></li>
</ul>
<h2 id="_idParaDest-303"><a id="_idTextAnchor301"/><span class="koboSpan" id="kobo.183.1">Role-based access control (RBAC)</span></h2>
<p><span class="koboSpan" id="kobo.184.1">PowerShell’s AzRole</span><a id="_idIndexMarker685"/><span class="koboSpan" id="kobo.185.1"> module helps manage RBAC </span><a id="_idIndexMarker686"/><span class="koboSpan" id="kobo.186.1">assignments, ensuring proper permissions for users </span><span class="No-Break"><span class="koboSpan" id="kobo.187.1">or applications:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.188.1">
# Assign a user the contributor role to a specific resource group
New-AzRoleAssignment -ObjectId "{userObjectId}" -RoleDefinitionName "Contributor" -Scope "/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}"</span></pre> <h2 id="_idParaDest-304"><a id="_idTextAnchor302"/><span class="koboSpan" id="kobo.189.1">Resource tagging</span></h2>
<p><span class="koboSpan" id="kobo.190.1">Enforcing resource tagging</span><a id="_idIndexMarker687"/><span class="koboSpan" id="kobo.191.1"> enhances organization and cost management. </span><span class="koboSpan" id="kobo.191.2">PowerShell can be used to automate </span><span class="No-Break"><span class="koboSpan" id="kobo.192.1">tagging processes:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.193.1">
# Add tags to a virtual machine
Set-AzResource -ResourceId "/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.Compute/virtualMachines/{vmName}" -Tag @{ "Environment" = "Production"; "Project" = "XYZ" }</span></pre> <h2 id="_idParaDest-305"><a id="_idTextAnchor303"/><span class="koboSpan" id="kobo.194.1">Resource locking</span></h2>
<p><span class="koboSpan" id="kobo.195.1">Prevent the accidental deletion</span><a id="_idIndexMarker688"/><span class="koboSpan" id="kobo.196.1"> or modification of critical resources by using PowerShell to apply </span><span class="No-Break"><span class="koboSpan" id="kobo.197.1">resource locks:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.198.1">
# Apply a read-only lock to a storage account
New-AzResourceLock -LockLevel ReadOnly -LockNotes "Critical Resource" -ResourceId "/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.Storage/storageAccounts/{storageAccountName}"</span></pre> <h2 id="_idParaDest-306"><a id="_idTextAnchor304"/><span class="koboSpan" id="kobo.199.1">Azure blueprint deployment</span></h2>
<p><span class="koboSpan" id="kobo.200.1">Define and deploy Azure Blueprints, which</span><a id="_idIndexMarker689"/><span class="koboSpan" id="kobo.201.1"> contain templates for resources, policies, and RBAC assignments, ensuring </span><span class="No-Break"><span class="koboSpan" id="kobo.202.1">consistent governance:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.203.1">
# Create and assign a blueprint
New-AzBlueprint -Name "MyBlueprint" -SubscriptionId "{subscriptionId}" -BlueprintFile "C:\Path\To\Blueprint.json"</span></pre> <h2 id="_idParaDest-307"><a id="_idTextAnchor305"/><span class="koboSpan" id="kobo.204.1">Compliance reporting</span></h2>
<p><span class="koboSpan" id="kobo.205.1">PowerShell can be used</span><a id="_idIndexMarker690"/><span class="koboSpan" id="kobo.206.1"> to generate compliance reports, providing insights into the adherence of resources to </span><span class="No-Break"><span class="koboSpan" id="kobo.207.1">organizational policies:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.208.1">
# Get compliance status for all resources in a subscription
Get-AzPolicyState -SubscriptionId "{subscriptionId}" | Where-Object { $_.ComplianceState -eq "NonCompliant" }</span></pre> <p><span class="koboSpan" id="kobo.209.1">In summary, PowerShell in Azure governance empowers administrators to automate policy enforcement, manage access control, implement resource tagging, apply locks, deploy blueprints, and generate compliance reports. </span><span class="koboSpan" id="kobo.209.2">This ensures a well-organized, secure, and compliant Azure environment aligned with </span><span class="No-Break"><span class="koboSpan" id="kobo.210.1">organizational standards.</span></span></p>
<h1 id="_idParaDest-308"><a id="_idTextAnchor306"/><span class="koboSpan" id="kobo.211.1">Accessing Azure</span></h1>
<p><span class="koboSpan" id="kobo.212.1">Our goal in this section</span><a id="_idIndexMarker691"/><span class="koboSpan" id="kobo.213.1"> is to describe how PowerShell can be used to connect a query with a resource </span><span class="No-Break"><span class="koboSpan" id="kobo.214.1">within Azure.</span></span></p>
<h2 id="_idParaDest-309"><a id="_idTextAnchor307"/><span class="koboSpan" id="kobo.215.1">Install and import the Azure PowerShell module</span></h2>
<p><span class="koboSpan" id="kobo.216.1">Before diving into</span><a id="_idIndexMarker692"/><span class="koboSpan" id="kobo.217.1"> reconnaissance, installing</span><a id="_idIndexMarker693"/><span class="koboSpan" id="kobo.218.1"> and importing the Azure PowerShell module is essential. </span><span class="koboSpan" id="kobo.218.2">This module provides cmdlets designed explicitly for interacting with </span><span class="No-Break"><span class="koboSpan" id="kobo.219.1">Azure resources:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.220.1">
Install-Module -Name Az -Force -AllowClobber -Scope CurrentUser
Import-Module Az</span></pre> <h2 id="_idParaDest-310"><a id="_idTextAnchor308"/><span class="koboSpan" id="kobo.221.1">Authenticate and connect to Azure</span></h2>
<p><span class="koboSpan" id="kobo.222.1">Authenticate and connect</span><a id="_idIndexMarker694"/><span class="koboSpan" id="kobo.223.1"> to your Azure </span><a id="_idIndexMarker695"/><span class="koboSpan" id="kobo.224.1">subscription to access the resources within </span><span class="No-Break"><span class="koboSpan" id="kobo.225.1">the environment:</span></span></p>
<pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.226.1">PS C:\&gt; $Creds = Get-Credential</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.227.1">PS C:\&gt; Connect-AzAccount -Credential $Creds</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.228.1">Account                      SubscriptionName   TennantID                              Environment</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.229.1">-------                      ----------------   ------------------------------------   -----------</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.230.1">ajcblyth@snowcapcyber.com    Infinity           749a36a1-402a-481c-a0c0-66f677504ea8   AzureCloud</span></strong></pre> <p><span class="koboSpan" id="kobo.231.1">Once we have connected to an Azure Tenancy, we can query it to ensure it </span><span class="No-Break"><span class="koboSpan" id="kobo.232.1">is correct:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.233.1">
PS C:\&gt; Get-AzTenant
Id                                       Name              Category Domains
--                                       ----              -------- -------
749a36a1-402a-481c-a0c0-66f677504ea8     SnowCap Cyber     Home     {snowcapcyber.onmicrosoft.com, snowcapcyber.com}</span></pre> <h1 id="_idParaDest-311"><a id="_idTextAnchor309"/><span class="koboSpan" id="kobo.234.1">Networking in Azure</span></h1>
<p><span class="koboSpan" id="kobo.235.1">Our goal in this section is to describe</span><a id="_idIndexMarker696"/><span class="koboSpan" id="kobo.236.1"> how PowerShell can be used with Azure to perform network reconnaissance and profiling as part of a penetration test. </span><span class="koboSpan" id="kobo.236.2">Our goal is to use this information to construct a network map. </span><span class="koboSpan" id="kobo.236.3">Once we have a public IP address and name, we can start to use nslookup to explore the type of </span><span class="No-Break"><span class="koboSpan" id="kobo.237.1">DNS services:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.238.1">
PS C:\&gt; nslookup devtest.snowcapcyber.com
Server:          192.168.1.254
Address:    192.168.1.254#53
Non-authoritative answer:
devtest.snowcapcyber.com    canonical name = snowcapcyber.z13.web.core.windows.net.
</span><span class="koboSpan" id="kobo.238.2">snowcapcyber.z16.web.core.windows.net    canonical name = web.s768fd45.store.core.windows.net.
</span><span class="koboSpan" id="kobo.238.3">Name:    web.s768fd45.store.core.windows.net
Address: 52.239.123.45</span></pre> <p><span class="koboSpan" id="kobo.239.1">From the analysis of the DNS names, we can identify the type of service. </span><span class="koboSpan" id="kobo.239.2">The following table lists the available </span><span class="No-Break"><span class="koboSpan" id="kobo.240.1">DNS suffixes:</span></span></p>
<table class="No-Table-Style _idGenTablePara-1" id="table001-1">
<colgroup>
<col/>
<col/>
</colgroup>
<tbody>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.241.1">DNS Suffix</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><strong class="bold"><span class="koboSpan" id="kobo.242.1">Associated </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.243.1">Azure Service</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.244.1">file.core.windows.net</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.245.1">Storage accounts – </span><span class="No-Break"><span class="koboSpan" id="kobo.246.1">Files</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.247.1">blob.core.windows.net</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.248.1">Storage accounts – </span><span class="No-Break"><span class="koboSpan" id="kobo.249.1">Blobs</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.250.1">azurewebsites.net</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.251.1">App Service and </span><span class="No-Break"><span class="koboSpan" id="kobo.252.1">Functions App</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.253.1">scm.azurewebsites.net</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.254.1">App Services – </span><span class="No-Break"><span class="koboSpan" id="kobo.255.1">Management</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.256.1">database.windows.net</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.257.1">Databases – </span><span class="No-Break"><span class="koboSpan" id="kobo.258.1">MSSQL</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.259.1">documents.azure.com</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.260.1">Databases – </span><span class="No-Break"><span class="koboSpan" id="kobo.261.1">Cosmos DB</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.262.1">cloudapp.azure.com</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.263.1">Customer – Assigned public </span><span class="No-Break"><span class="koboSpan" id="kobo.264.1">IP DNS</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.265.1">vault.azure.net</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.266.1">Key Vault</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.267.1">azurecontainer.io</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.268.1">Container instances</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.269.1">azurecr.io</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.270.1">Container registry</span></span></p>
</td>
</tr>
</tbody>
</table>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.271.1">Table 12.1 – List of available DNS suffixes</span></p>
<h2 id="_idParaDest-312"><a id="_idTextAnchor310"/><span class="koboSpan" id="kobo.272.1">Resource discovery</span></h2>
<p><span class="koboSpan" id="kobo.273.1">Begin by discovering Azure</span><a id="_idIndexMarker697"/><span class="koboSpan" id="kobo.274.1"> resources using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.275.1">Get-AzResource</span></strong><span class="koboSpan" id="kobo.276.1"> cmdlet. </span><span class="koboSpan" id="kobo.276.2">This provides information about various resources, including virtual machines, databases, and </span><span class="No-Break"><span class="koboSpan" id="kobo.277.1">networking components:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.278.1">
Get-AzResource | Select-Object ResourceGroupName, ResourceType, ResourceName</span></pre> <h2 id="_idParaDest-313"><a id="_idTextAnchor311"/><span class="koboSpan" id="kobo.279.1">Virtual network enumeration</span></h2>
<p><span class="koboSpan" id="kobo.280.1">To understand the network</span><a id="_idIndexMarker698"/><span class="koboSpan" id="kobo.281.1"> structure, use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.282.1">Get-AzVirtualNetwork </span></strong><span class="koboSpan" id="kobo.283.1">cmdlet. </span><span class="koboSpan" id="kobo.283.2">This retrieves details about virtual networks, including subnets and </span><span class="No-Break"><span class="koboSpan" id="kobo.284.1">associated resources:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.285.1">
Get-AzVirtualNetwork | Select-Object ResourceGroupName, Name, AddressSpace, @{Name="Subnets"; Expression={$_.Subnets.Name -join ", "}}</span></pre> <h2 id="_idParaDest-314"><a id="_idTextAnchor312"/><span class="koboSpan" id="kobo.286.1">Subnet analysis</span></h2>
<p><span class="koboSpan" id="kobo.287.1">Dig deeper into subnet</span><a id="_idIndexMarker699"/><span class="koboSpan" id="kobo.288.1"> configurations within virtual networks to identify IP address ranges and the </span><span class="No-Break"><span class="koboSpan" id="kobo.289.1">associated resources:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.290.1">
Get-AzVirtualNetwork -ResourceGroupName "YourResourceGroup" | Get-AzVirtualNetworkSubnetConfig | Select-Object Name, AddressPrefix</span></pre> <h2 id="_idParaDest-315"><a id="_idTextAnchor313"/><span class="koboSpan" id="kobo.291.1">Network security group exploration</span></h2>
<p><span class="koboSpan" id="kobo.292.1">Examine </span><strong class="bold"><span class="koboSpan" id="kobo.293.1">Network Security Groups</span></strong><span class="koboSpan" id="kobo.294.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.295.1">NSGs</span></strong><span class="koboSpan" id="kobo.296.1">) using </span><strong class="source-inline"><span class="koboSpan" id="kobo.297.1">Get-AzNetworkSecurityGroup</span></strong><span class="koboSpan" id="kobo.298.1">. </span><span class="koboSpan" id="kobo.298.2">NSGs act </span><a id="_idIndexMarker700"/><span class="koboSpan" id="kobo.299.1">as firewalls, controlling</span><a id="_idIndexMarker701"/><span class="koboSpan" id="kobo.300.1"> traffic to and </span><span class="No-Break"><span class="koboSpan" id="kobo.301.1">from resources:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.302.1">
Get-AzNetworkSecurityGroup -ResourceGroupName "YourResourceGroup" | Get-AzNetworkSecurityRuleConfig</span></pre> <h2 id="_idParaDest-316"><a id="_idTextAnchor314"/><span class="koboSpan" id="kobo.303.1">Public IP address enumeration</span></h2>
<p><span class="koboSpan" id="kobo.304.1">Identify the public IP addresses</span><a id="_idIndexMarker702"/><span class="koboSpan" id="kobo.305.1"> associated with resources to understand potential </span><span class="No-Break"><span class="koboSpan" id="kobo.306.1">external-facing points:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.307.1">
Get-AzPublicIpAddress | Select-Object ResourceGroupName, Name, IpAddress</span></pre> <h2 id="_idParaDest-317"><a id="_idTextAnchor315"/><span class="koboSpan" id="kobo.308.1">Azure Active Directory (AAD) reconnaissance</span></h2>
<p><span class="koboSpan" id="kobo.309.1">Understand the Identity</span><a id="_idIndexMarker703"/><span class="koboSpan" id="kobo.310.1"> landscape using AAD commands. </span><span class="koboSpan" id="kobo.310.2">This includes retrieving information about users, groups, and applications. </span><span class="koboSpan" id="kobo.310.3">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.311.1">Get-AzureADUSer</span></strong><span class="koboSpan" id="kobo.312.1"> command retrieves users from the </span><span class="No-Break"><span class="koboSpan" id="kobo.313.1">AAD (Entra):</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.314.1">
Get-AzureADUser | Select-Object DisplayName, UserPrincipalName
Get-AzureADGroup | Select-Object DisplayName, Description
Get-AzureADApplication | Select-Object DisplayName, AppId</span></pre> <h2 id="_idParaDest-318"><a id="_idTextAnchor316"/><span class="koboSpan" id="kobo.315.1">Service principal enumeration</span></h2>
<p><span class="koboSpan" id="kobo.316.1">Identify service principals, which are used</span><a id="_idIndexMarker704"/><span class="koboSpan" id="kobo.317.1"> for authenticating Azure services, by </span><span class="No-Break"><span class="koboSpan" id="kobo.318.1">using </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.319.1">Get-AzADServicePrincipal</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.320.1">:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.321.1">
Get-AzADServicePrincipal | Select-Object DisplayName, ApplicationId, ServicePrincipalNames</span></pre> <h2 id="_idParaDest-319"><a id="_idTextAnchor317"/><span class="koboSpan" id="kobo.322.1">Constructing the network map</span></h2>
<p><span class="koboSpan" id="kobo.323.1">With the collected</span><a id="_idIndexMarker705"/><span class="koboSpan" id="kobo.324.1"> information, you can start building a network map. </span><span class="koboSpan" id="kobo.324.2">Use tools such as Graphviz to visualize the relationships between different resources, subnets, and </span><span class="No-Break"><span class="koboSpan" id="kobo.325.1">security groups:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.326.1">
$dotContent = @"
digraph NetworkMap {
  subgraph cluster_vnet {
    label="Virtual Network: YourVNet"
    "Subnet A" -&gt; "Subnet B"
  }
  "Subnet B" -&gt; "Web Server"
  "Subnet B" -&gt; "Database Server"
  "Web Server" -&gt; "DB Server"
  "Web Server" -&gt; "Public IP"
}
"@
$dotContent | Out-File -FilePath "NetworkMap.dot"</span></pre> <p><span class="koboSpan" id="kobo.327.1">After generating the DOT file, you can use Graphviz tools to convert it into a visual representation, providing a comprehensive </span><span class="No-Break"><span class="koboSpan" id="kobo.328.1">network map.</span></span></p>
<p><span class="koboSpan" id="kobo.329.1">PowerShell and Azure cmdlets offer penetration testers a robust toolkit for network reconnaissance and profiling in Azure environments. </span><span class="koboSpan" id="kobo.329.2">You can construct a detailed network map by collecting information about resources, virtual networks, security configurations, and Identity components. </span><span class="koboSpan" id="kobo.329.3">This map is valuable for understanding the Azure landscape, identifying</span><a id="_idIndexMarker706"/><span class="koboSpan" id="kobo.330.1"> potential attack surfaces, and making informed decisions during a penetration test. </span><span class="koboSpan" id="kobo.330.2">Always ensure proper authorization and adhere to ethical guidelines when conducting penetration tests in </span><span class="No-Break"><span class="koboSpan" id="kobo.331.1">any environment.</span></span></p>
<h1 id="_idParaDest-320"><a id="_idTextAnchor318"/><span class="koboSpan" id="kobo.332.1">Identity Management and Role-Based Access Control</span></h1>
<p><span class="koboSpan" id="kobo.333.1">Penetration testing involves assessing</span><a id="_idIndexMarker707"/><span class="koboSpan" id="kobo.334.1"> the security of a system, and PowerShell is a valuable tool for analyzing </span><strong class="bold"><span class="koboSpan" id="kobo.335.1">Identity Management</span></strong><span class="koboSpan" id="kobo.336.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.337.1">IDM</span></strong><span class="koboSpan" id="kobo.338.1">) and </span><strong class="bold"><span class="koboSpan" id="kobo.339.1">Role-Based Access Control</span></strong><span class="koboSpan" id="kobo.340.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.341.1">RBAC</span></strong><span class="koboSpan" id="kobo.342.1">) in Azure environments. </span><span class="koboSpan" id="kobo.342.2">With its extensive set of cmdlets, PowerShell</span><a id="_idIndexMarker708"/><span class="koboSpan" id="kobo.343.1"> allows penetration testers to gather information, identify potential vulnerabilities, and simulate scenarios to evaluate the security posture of an </span><span class="No-Break"><span class="koboSpan" id="kobo.344.1">Azure environment.</span></span></p>
<h2 id="_idParaDest-321"><a id="_idTextAnchor319"/><span class="koboSpan" id="kobo.345.1">Gathering information about users and Identity Management</span></h2>
<p><span class="koboSpan" id="kobo.346.1">PowerShell can retrieve</span><a id="_idIndexMarker709"/><span class="koboSpan" id="kobo.347.1"> detailed information</span><a id="_idIndexMarker710"/><span class="koboSpan" id="kobo.348.1"> about users</span><a id="_idIndexMarker711"/><span class="koboSpan" id="kobo.349.1"> and their attributes</span><a id="_idIndexMarker712"/><span class="koboSpan" id="kobo.350.1"> AAD. </span><span class="koboSpan" id="kobo.350.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.351.1">Get-AzADUser</span></strong><span class="koboSpan" id="kobo.352.1"> cmdlet is a powerful tool for </span><span class="No-Break"><span class="koboSpan" id="kobo.353.1">this task:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.354.1">
# Retrieve all users in Azure AD
Get-AzADUser -All $true | Select-Object DisplayName, UserPrincipalName, UserType, ObjectId</span></pre> <p><span class="koboSpan" id="kobo.355.1">This command fetches information such as display name, user principal name, user type, and object ID for all users in Azure AD. </span><span class="koboSpan" id="kobo.355.2">Penetration testers can use this data to identify privileged accounts and potential targets </span><span class="No-Break"><span class="koboSpan" id="kobo.356.1">for exploitation.</span></span></p>
<h2 id="_idParaDest-322"><a id="_idTextAnchor320"/><span class="koboSpan" id="kobo.357.1">Exploring RBAC assignments</span></h2>
<p><span class="koboSpan" id="kobo.358.1">PowerShell facilitates the examination</span><a id="_idIndexMarker713"/><span class="koboSpan" id="kobo.359.1"> of RBAC assignments, enabling penetration testers to understand who has access to what resources. </span><span class="koboSpan" id="kobo.359.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.360.1">Get-AzRoleAssignment</span></strong><span class="koboSpan" id="kobo.361.1"> cmdlet retrieves information about </span><span class="No-Break"><span class="koboSpan" id="kobo.362.1">role assignments:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.363.1">
# List role assignments within a specific subscription
Get-AzRoleAssignment -Scope "/subscriptions/{subscription-id}" | Select-Object DisplayName, SignInName, RoleDefinitionName</span></pre> <p><span class="koboSpan" id="kobo.364.1">This command displays the display name, sign-in name, and role definition name for each role assignment within the specified</span><a id="_idIndexMarker714"/><span class="koboSpan" id="kobo.365.1"> subscription. </span><span class="koboSpan" id="kobo.365.2">It helps testers identify users with elevated privileges and understand the overall </span><span class="No-Break"><span class="koboSpan" id="kobo.366.1">RBAC configuration.</span></span></p>
<h2 id="_idParaDest-323"><a id="_idTextAnchor321"/><span class="koboSpan" id="kobo.367.1">Reviewing access control settings for resources</span></h2>
<p><span class="koboSpan" id="kobo.368.1">PowerShell can review access </span><a id="_idIndexMarker715"/><span class="koboSpan" id="kobo.369.1">control settings to assess the effectiveness </span><a id="_idIndexMarker716"/><span class="koboSpan" id="kobo.370.1">of RBAC configurations for specific resources. </span><span class="koboSpan" id="kobo.370.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.371.1">Get-AzRoleDefinition</span></strong><span class="koboSpan" id="kobo.372.1"> cmdlet provides details about built-in roles and </span><span class="No-Break"><span class="koboSpan" id="kobo.373.1">their permissions:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.374.1">
# Retrieve information about the "Contributor" built-in role
Get-AzRoleDefinition -Name "Contributor" | Select-Object Name, Description, Actions</span></pre> <p><span class="koboSpan" id="kobo.375.1">This command fetches information about the “</span><strong class="source-inline"><span class="koboSpan" id="kobo.376.1">Contributor</span></strong><span class="koboSpan" id="kobo.377.1">” role, including its name, description, and the actions it permits. </span><span class="koboSpan" id="kobo.377.2">Penetration testers can use this information to evaluate the impact of specific role assignments and identify potential </span><span class="No-Break"><span class="koboSpan" id="kobo.378.1">security risks.</span></span></p>
<h2 id="_idParaDest-324"><a id="_idTextAnchor322"/><span class="koboSpan" id="kobo.379.1">Modifying RBAC assignments for simulation</span></h2>
<p><span class="koboSpan" id="kobo.380.1">PowerShell allows</span><a id="_idIndexMarker717"/><span class="koboSpan" id="kobo.381.1"> penetration testers</span><a id="_idIndexMarker718"/><span class="koboSpan" id="kobo.382.1"> to simulate scenarios by modifying RBAC assignments. </span><span class="koboSpan" id="kobo.382.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.383.1">New-AzRoleAssignment</span></strong><span class="koboSpan" id="kobo.384.1"> cmdlet can be used to create temporary assignments for </span><span class="No-Break"><span class="koboSpan" id="kobo.385.1">testing purposes:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.386.1">
# Create a temporary role assignment for testing
New-AzRoleAssignment -ObjectId "{user-object-id}" -RoleDefinitionName "Reader" -Scope "/subscriptions/{subscription-id}"</span></pre> <p><span class="koboSpan" id="kobo.387.1">This command assigns the “</span><strong class="source-inline"><span class="koboSpan" id="kobo.388.1">Reader</span></strong><span class="koboSpan" id="kobo.389.1">” role to a specific user for the specified subscription. </span><span class="koboSpan" id="kobo.389.2">Testers can use this capability</span><a id="_idIndexMarker719"/><span class="koboSpan" id="kobo.390.1"> to assess the impact of changes to RBAC configurations without</span><a id="_idIndexMarker720"/><span class="koboSpan" id="kobo.391.1"> affecting the </span><span class="No-Break"><span class="koboSpan" id="kobo.392.1">production environment.</span></span></p>
<h2 id="_idParaDest-325"><a id="_idTextAnchor323"/><span class="koboSpan" id="kobo.393.1">Automating Identity Management and RBAC analysis</span></h2>
<p><span class="koboSpan" id="kobo.394.1">PowerShell scripts can be written</span><a id="_idIndexMarker721"/><span class="koboSpan" id="kobo.395.1"> to automate the analysis of Identity</span><a id="_idIndexMarker722"/><span class="koboSpan" id="kobo.396.1"> Management and RBAC. </span><span class="koboSpan" id="kobo.396.2">For example, a script could iterate through users and their roles, generate reports, and highlight anomalies or potential </span><span class="No-Break"><span class="koboSpan" id="kobo.397.1">security issues:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.398.1">
# Sample script to automate RBAC analysis
$users = Get-AzADUser -All $true
foreach ($user in $users) {
    $roleAssignments = Get-AzRoleAssignment -ObjectId $user.ObjectId
    Write-Output "User: $($user.DisplayName)"
    Write-Output "Role Assignments:"
    $roleAssignments | Select-Object RoleDefinitionName, Scope
    Write-Output "`n"
}</span></pre> <p><span class="koboSpan" id="kobo.399.1">This script iterates through all users, retrieves their role assignments, and outputs relevant information. </span><span class="koboSpan" id="kobo.399.2">Automation can significantly enhance the efficiency of the penetration </span><span class="No-Break"><span class="koboSpan" id="kobo.400.1">testing process.</span></span></p>
<p><span class="koboSpan" id="kobo.401.1">PowerShell is an invaluable tool for penetration testers when analyzing Identity Management and RBAC in Azure environments. </span><span class="koboSpan" id="kobo.401.2">By leveraging its capabilities, testers can gather information, evaluate</span><a id="_idIndexMarker723"/><span class="koboSpan" id="kobo.402.1"> configurations, and simulate </span><a id="_idIndexMarker724"/><span class="koboSpan" id="kobo.403.1">scenarios to effectively identify and address </span><span class="No-Break"><span class="koboSpan" id="kobo.404.1">security vulnerabilities.</span></span></p>
<h1 id="_idParaDest-326"><a id="_idTextAnchor324"/><span class="koboSpan" id="kobo.405.1">Azure Data Storage and permissions</span></h1>
<p><span class="koboSpan" id="kobo.406.1">PowerShell is a powerful tool for penetration testers to analyze Identity and Data Storage permissions in Azure environments. </span><span class="koboSpan" id="kobo.406.2">In a penetration test scenario, understanding and scrutinizing Azure Data Storage and associated permissions is crucial for identifying potential security vulnerabilities. </span><span class="koboSpan" id="kobo.406.3">Here’s how PowerShell can be employed for </span><span class="No-Break"><span class="koboSpan" id="kobo.407.1">this purpose:</span></span></p>
<h2 id="_idParaDest-327"><a id="_idTextAnchor325"/><span class="koboSpan" id="kobo.408.1">Analyzing Azure Data Storage</span></h2>
<p><span class="koboSpan" id="kobo.409.1">Azure offers various </span><a id="_idIndexMarker725"/><span class="koboSpan" id="kobo.410.1">storage services, such as Blob Storage, Table Storage, and Queue Storage. </span><span class="koboSpan" id="kobo.410.2">PowerShell can gather information about these services, configurations, </span><span class="No-Break"><span class="koboSpan" id="kobo.411.1">and data:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.412.1">
# Get information about Blob Storage accounts
Get-AzStorageAccount | ForEach-Object {
    $account = $_
    Write-Output "Storage Account Name: $($account.StorageAccountName)"
    Get-AzStorageContainer -Context $_.Context | ForEach-Object {
        Write-Output "   Container Name: $($_.Name)"
        # Additional commands to analyze blobs within the container
    }
    Write-Output "`n"
}</span></pre> <p><span class="koboSpan" id="kobo.413.1">This script lists all Azure storage accounts and their associated containers, providing a starting point for penetration testers to analyze Data </span><span class="No-Break"><span class="koboSpan" id="kobo.414.1">Storage configurations.</span></span></p>
<h2 id="_idParaDest-328"><a id="_idTextAnchor326"/><span class="koboSpan" id="kobo.415.1">Investigating data permissions</span></h2>
<p><span class="koboSpan" id="kobo.416.1">PowerShell enables testers</span><a id="_idIndexMarker726"/><span class="koboSpan" id="kobo.417.1"> to examine permissions and access the control settings associated with Azure Data Storage. </span><span class="koboSpan" id="kobo.417.2">Understanding who has access to the data and what level of permissions they possess is critical for identifying potential </span><span class="No-Break"><span class="koboSpan" id="kobo.418.1">security risks:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.419.1">
# Get Blob Container permissions for a specific storage account
$storageAccount = Get-AzStorageAccount -ResourceGroupName "YourResourceGroup" -AccountName "YourStorageAccountName"
$container = "YourBlobContainer"
Get-AzStorageContainerAcl -Context $storageAccount.Context -Name $container | Select-Object Id, Access</span></pre> <p><span class="koboSpan" id="kobo.420.1">This script retrieves and displays the </span><strong class="bold"><span class="koboSpan" id="kobo.421.1">Access Control Lists</span></strong><span class="koboSpan" id="kobo.422.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.423.1">ACLs</span></strong><span class="koboSpan" id="kobo.424.1">) for a specific Blob Container, providing insights</span><a id="_idIndexMarker727"/><span class="koboSpan" id="kobo.425.1"> into who has access and what level of access </span><span class="No-Break"><span class="koboSpan" id="kobo.426.1">they have.</span></span></p>
<h2 id="_idParaDest-329"><a id="_idTextAnchor327"/><span class="koboSpan" id="kobo.427.1">Checking RBAC settings</span></h2>
<p><span class="koboSpan" id="kobo.428.1">Azure uses RBAC to manage</span><a id="_idIndexMarker728"/><span class="koboSpan" id="kobo.429.1"> access to resources, including Data Storage. </span><span class="koboSpan" id="kobo.429.2">PowerShell can be employed to review RBAC assignments </span><span class="No-Break"><span class="koboSpan" id="kobo.430.1">and configurations:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.431.1">
# Get RBAC assignments for a specific storage account
$storageAccount = Get-AzStorageAccount -ResourceGroupName "YourResourceGroup" -AccountName "YourStorageAccountName"
Get-AzRoleAssignment -Scope $storageAccount.Id | Select-Object DisplayName, SignInName, RoleDefinitionName</span></pre> <p><span class="koboSpan" id="kobo.432.1">This script provides information about the role assignments associated with the specified storage account, helping testers identify users with </span><span class="No-Break"><span class="koboSpan" id="kobo.433.1">elevated privileges.</span></span></p>
<h2 id="_idParaDest-330"><a id="_idTextAnchor328"/><span class="koboSpan" id="kobo.434.1">Analyzing data security with Azure Key Vault</span></h2>
<p><span class="koboSpan" id="kobo.435.1">Azure Key Vault is often</span><a id="_idIndexMarker729"/><span class="koboSpan" id="kobo.436.1"> used to securely store and manage</span><a id="_idIndexMarker730"/><span class="koboSpan" id="kobo.437.1"> sensitive information, such as storage account keys. </span><span class="koboSpan" id="kobo.437.2">PowerShell can interact with Azure Key Vault and assess the security of </span><span class="No-Break"><span class="koboSpan" id="kobo.438.1">key management:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.439.1">
# Retrieve secrets from Azure Key Vault
$keyVault = Get-AzKeyVault -VaultName "YourKeyVaultName" -ResourceGroupName "YourResourceGroup"
Get-AzKeyVaultSecret -VaultName $keyVault.VaultName | Select-Object Name, Value</span></pre> <p><span class="koboSpan" id="kobo.440.1">This script fetches and displays</span><a id="_idIndexMarker731"/><span class="koboSpan" id="kobo.441.1"> secrets stored in the specified</span><a id="_idIndexMarker732"/><span class="koboSpan" id="kobo.442.1"> Azure Key Vault, allowing testers to identify sensitive information that may impact the security of Azure </span><span class="No-Break"><span class="koboSpan" id="kobo.443.1">Data Storage.</span></span></p>
<h2 id="_idParaDest-331"><a id="_idTextAnchor329"/><span class="koboSpan" id="kobo.444.1">Automating Data Storage and permissions analysis</span></h2>
<p><span class="koboSpan" id="kobo.445.1">PowerShell scripts can be written</span><a id="_idIndexMarker733"/><span class="koboSpan" id="kobo.446.1"> to automate the analysis of Azure Data Storage</span><a id="_idIndexMarker734"/><span class="koboSpan" id="kobo.447.1"> and the associated permissions. </span><span class="koboSpan" id="kobo.447.2">These scripts can iterate through storage accounts, containers, and access settings, providing comprehensive insights into the </span><span class="No-Break"><span class="koboSpan" id="kobo.448.1">security landscape:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.449.1">
# Automated analysis of Azure Storage Accounts
Get-AzStorageAccount | ForEach-Object {
    $account = $_
    Write-Output "Storage Account Name: $($account.StorageAccountName)"
    # Additional commands for analyzing containers, permissions, etc.
</span><span class="koboSpan" id="kobo.449.2">    Write-Output "`n"
}</span></pre> <p><span class="koboSpan" id="kobo.450.1">This script automates retrieving and analyzing information about all Azure storage accounts, streamlining the penetration </span><span class="No-Break"><span class="koboSpan" id="kobo.451.1">testing workflow.</span></span></p>
<p><span class="koboSpan" id="kobo.452.1">In conclusion, PowerShell </span><a id="_idIndexMarker735"/><span class="koboSpan" id="kobo.453.1">proves to be a versatile and efficient tool</span><a id="_idIndexMarker736"/><span class="koboSpan" id="kobo.454.1"> for penetration testers when analyzing Identity and Data Storage permissions in Azure. </span><span class="koboSpan" id="kobo.454.2">By leveraging its capabilities, testers can gather information, assess configurations, and identify the potential security risks associated with Azure Data Storage. </span><span class="koboSpan" id="kobo.454.3">Automation further enhances the effectiveness of penetration testing, allowing for a thorough examination of Azure resources in a scalable and </span><span class="No-Break"><span class="koboSpan" id="kobo.455.1">efficient manner.</span></span></p>
<h1 id="_idParaDest-332"><a id="_idTextAnchor330"/><span class="koboSpan" id="kobo.456.1">Azure and SQL</span></h1>
<p><span class="koboSpan" id="kobo.457.1">PowerShell is a powerful tool for penetration testers to analyze the Identity and SQL components within Azure environments. </span><span class="koboSpan" id="kobo.457.2">Azure Identity services, such as AAD and SQL databases, are crucial in securing and managing access to resources. </span><span class="koboSpan" id="kobo.457.3">Here’s how PowerShell can be employed for analyzing Identity in Azure and SQL in Azure during a </span><span class="No-Break"><span class="koboSpan" id="kobo.458.1">penetration test.</span></span></p>
<h2 id="_idParaDest-333"><a id="_idTextAnchor331"/><span class="koboSpan" id="kobo.459.1">Analyzing Azure Identity</span></h2>
<p><span class="koboSpan" id="kobo.460.1">The following</span><a id="_idIndexMarker737"/><span class="koboSpan" id="kobo.461.1"> are the </span><span class="No-Break"><span class="koboSpan" id="kobo.462.1">steps involved:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.463.1">Retrieving user information: PowerShell can fetch information about users in Azure Active Directory, providing insights into potential targets </span><span class="No-Break"><span class="koboSpan" id="kobo.464.1">for exploitation:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.465.1">
# Retrieve user information from Azure AD
Get-AzADUser -All $true | Select-Object DisplayName, UserPrincipalName, UserType, ObjectId</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.466.1">This command fetches details such as display name, user principal name, user type, and object ID for all users in Azure AD. </span><span class="koboSpan" id="kobo.466.2">Penetration testers can analyze this data to identify privileged accounts or potential </span><span class="No-Break"><span class="koboSpan" id="kobo.467.1">attack points.</span></span></p></li> <li><span class="koboSpan" id="kobo.468.1">Examining service principals: Service principals represent non-human accounts that are often used for automation tasks. </span><span class="koboSpan" id="kobo.468.2">PowerShell allows testers to investigate service principals and </span><span class="No-Break"><span class="koboSpan" id="kobo.469.1">their permissions:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.470.1">
# List service principals in Azure AD
Get-AzADServicePrincipal | Select-Object DisplayName, ServicePrincipalNames, AppId, ObjectType</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.471.1">This command lists service principals, providing details about their display names, service principal names, application IDs, and object types. </span><span class="koboSpan" id="kobo.471.2">Testers can scrutinize these details</span><a id="_idIndexMarker738"/><span class="koboSpan" id="kobo.472.1"> to identify potential </span><span class="No-Break"><span class="koboSpan" id="kobo.473.1">security risks.</span></span></p></li> </ol>
<h2 id="_idParaDest-334"><a id="_idTextAnchor332"/><span class="koboSpan" id="kobo.474.1">Analyzing Azure SQL</span></h2>
<p><span class="koboSpan" id="kobo.475.1">The following</span><a id="_idIndexMarker739"/><span class="koboSpan" id="kobo.476.1"> are the </span><span class="No-Break"><span class="koboSpan" id="kobo.477.1">steps involved:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.478.1">Retrieving SQL server information: PowerShell enables testers to gather information about Azure SQL servers, including their configurations and </span><span class="No-Break"><span class="koboSpan" id="kobo.479.1">associated databases:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.480.1">
# Get information about Azure SQL servers
Get-AzSqlServer | Select-Object ServerName, ResourceGroupName, Location, Version</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.481.1">This command lists details such as SQL server name, resource group, location, and version. </span><span class="koboSpan" id="kobo.481.2">Testers can use this information to assess the SQL server’s configuration and potential </span><span class="No-Break"><span class="koboSpan" id="kobo.482.1">security risks.</span></span></p></li> <li><span class="koboSpan" id="kobo.483.1">Examining database permissions: PowerShell can analyze permissions within Azure SQL databases, helping testers identify users with </span><span class="No-Break"><span class="koboSpan" id="kobo.484.1">elevated privileges:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.485.1">
# List users and their roles in an Azure SQL database
$server = Get-AzSqlServer -ResourceGroupName "YourResourceGroup" -ServerName "YourSqlServer"
$database = "YourDatabase"
Get-AzSqlDatabase -ServerName $server.ServerName -ResourceGroupName $server.ResourceGroupName -DatabaseName $database | Get-AzSqlDatabaseServerActiveDirectoryAdministrator | Select-Object DisplayName, SignInName</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.486.1">This script retrieves information about Active Directory administrators for a specific SQL database. </span><span class="koboSpan" id="kobo.486.2">It provides details such as display and sign-in names, helping testers identify users with </span><span class="No-Break"><span class="koboSpan" id="kobo.487.1">administrative roles.</span></span></p></li> <li><span class="koboSpan" id="kobo.488.1">Auditing SQL database activity: PowerShell can enable and review auditing settings for Azure SQL databases, helping testers track and analyze </span><span class="No-Break"><span class="koboSpan" id="kobo.489.1">database activity:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.490.1">
# Enable auditing for an Azure SQL database
$database = "YourDatabase"
Set-AzSqlDatabaseAuditing -ServerName $server.ServerName -ResourceGroupName $server.ResourceGroupName -DatabaseName $database -StorageAccountName "YourStorageAccount" -AuditActionGroup "SUCCESSFUL_DATABASE_AUTHENTICATION_GROUP", "FAILED_DATABASE_AUTHENTICATION_GROUP"</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.491.1">This command enables auditing for successful and failed database authentications. </span><span class="koboSpan" id="kobo.491.2">Testers</span><a id="_idIndexMarker740"/><span class="koboSpan" id="kobo.492.1"> can then review audit logs to analyze </span><span class="No-Break"><span class="koboSpan" id="kobo.493.1">user activity.</span></span></p></li> </ol>
<h2 id="_idParaDest-335"><a id="_idTextAnchor333"/><span class="koboSpan" id="kobo.494.1">Automating Identity and SQL analysis</span></h2>
<p><span class="koboSpan" id="kobo.495.1">PowerShell scripts</span><a id="_idIndexMarker741"/><span class="koboSpan" id="kobo.496.1"> can automate</span><a id="_idIndexMarker742"/><span class="koboSpan" id="kobo.497.1"> the analysis of Azure Identity and SQL components. </span><span class="koboSpan" id="kobo.497.2">These scripts can be iterated through users, service principals, SQL servers, and databases, providing a comprehensive overview of the </span><span class="No-Break"><span class="koboSpan" id="kobo.498.1">security landscape.</span></span></p>
<p><span class="koboSpan" id="kobo.499.1">In summary, PowerShell proves to be an indispensable tool for penetration testers when analyzing Identity in Azure and SQL in Azure. </span><span class="koboSpan" id="kobo.499.2">By utilizing its capabilities, testers can gather information, scrutinize configurations, and identify the potential security risks associated with Azure Identity services and SQL databases. </span><span class="koboSpan" id="kobo.499.3">Automation further streamlines the penetration testing process, allowing for a thorough examination of Azure resources in a scalable and efficient manner. </span><span class="koboSpan" id="kobo.499.4">Here’s how you can leverage PowerShell for testing Azure and </span><span class="No-Break"><span class="koboSpan" id="kobo.500.1">Key Vaults:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.501.1">Azure Resource Management</span></strong><span class="koboSpan" id="kobo.502.1">: PowerShell provides cmdlets to interact with Azure resources, allowing you to test resource provisioning, configuration, and management. </span><span class="koboSpan" id="kobo.502.2">For instance, you can use cmdlets such as </span><strong class="source-inline"><span class="koboSpan" id="kobo.503.1">New-AzResourceGroup</span></strong><span class="koboSpan" id="kobo.504.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.505.1">New-AzStorageAccount</span></strong><span class="koboSpan" id="kobo.506.1">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.507.1">New-AzVM</span></strong><span class="koboSpan" id="kobo.508.1"> to create resource groups, storage accounts, and virtual machines, respectively. </span><span class="koboSpan" id="kobo.508.2">You can then validate if the resources are created correctly using cmdlets such </span><span class="No-Break"><span class="koboSpan" id="kobo.509.1">as </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.510.1">Get-AzResource</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.511.1">.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.512.1">Azure Key Vault management</span></strong><span class="koboSpan" id="kobo.513.1">: PowerShell offers cmdlets for managing Azure Key Vaults, enabling you to test access policies, key management, and secrets. </span><span class="koboSpan" id="kobo.513.2">For example, you can use </span><strong class="source-inline"><span class="koboSpan" id="kobo.514.1">New-AzKeyVault</span></strong><span class="koboSpan" id="kobo.515.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.516.1">Set-AzKeyVaultAccessPolicy</span></strong><span class="koboSpan" id="kobo.517.1">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.518.1">Set-AzKeyVaultSecret</span></strong><span class="koboSpan" id="kobo.519.1"> to create a Key Vault, set access policies, and store secrets, respectively. </span><span class="koboSpan" id="kobo.519.2">You can verify the existence of secrets and keys using </span><strong class="source-inline"><span class="koboSpan" id="kobo.520.1">Get-AzKeyVaultSecret</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.521.1">and </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.522.1">Get-AzKeyVaultKey</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.523.1">.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.524.1">Testing Azure Functions with PowerShell</span></strong><span class="koboSpan" id="kobo.525.1">: Azure Functions </span><a id="_idIndexMarker743"/><span class="koboSpan" id="kobo.526.1">can be tested and managed using PowerShell</span><a id="_idIndexMarker744"/><span class="koboSpan" id="kobo.527.1"> scripts. </span><span class="koboSpan" id="kobo.527.2">You can use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.528.1">New-AzFunctionApp</span></strong><span class="koboSpan" id="kobo.529.1"> cmdlet to create a new Function App and </span><strong class="source-inline"><span class="koboSpan" id="kobo.530.1">Publish-AzWebapp</span></strong><span class="koboSpan" id="kobo.531.1"> to deploy your function code. </span><span class="koboSpan" id="kobo.531.2">Then, you can test the function by triggering it with sample input data and validating </span><span class="No-Break"><span class="koboSpan" id="kobo.532.1">the output.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.533.1">Integration testing Azure APIs</span></strong><span class="koboSpan" id="kobo.534.1">: PowerShell can be utilized for the integration testing of Azure APIs. </span><span class="koboSpan" id="kobo.534.2">By using cmdlets such as </span><strong class="source-inline"><span class="koboSpan" id="kobo.535.1">Invoke-RestMethod</span></strong><span class="koboSpan" id="kobo.536.1">, you can make HTTP requests to Azure REST APIs and validate responses. </span><span class="koboSpan" id="kobo.536.2">For example, you can test Azure resource manager APIs by sending requests to manage Azure </span><span class="No-Break"><span class="koboSpan" id="kobo.537.1">resources programmatically.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.538.1">Automated testing of Azure Policies</span></strong><span class="koboSpan" id="kobo.539.1">: PowerShell scripts can be employed to test Azure Policies. </span><span class="koboSpan" id="kobo.539.2">You can use cmdlets such as </span><strong class="source-inline"><span class="koboSpan" id="kobo.540.1">New-AzPolicyDefinition</span></strong><span class="koboSpan" id="kobo.541.1"> to define policies, </span><strong class="source-inline"><span class="koboSpan" id="kobo.542.1">Test-AzPolicyAssignment</span></strong><span class="koboSpan" id="kobo.543.1"> to evaluate policy</span><a id="_idIndexMarker745"/><span class="koboSpan" id="kobo.544.1"> compliance, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.545.1">Get-AzPolicyEvent</span></strong><span class="koboSpan" id="kobo.546.1"> to retrieve</span><a id="_idIndexMarker746"/><span class="koboSpan" id="kobo.547.1"> policy </span><span class="No-Break"><span class="koboSpan" id="kobo.548.1">evaluation results.</span></span></li>
</ul>
<h1 id="_idParaDest-336"><a id="_idTextAnchor334"/><span class="koboSpan" id="kobo.549.1">Azure and key vaults</span></h1>
<p><span class="koboSpan" id="kobo.550.1">PowerShell is a powerful scripting language and command line shell that can be instrumental in analyzing Azure resources</span><a id="_idIndexMarker747"/><span class="koboSpan" id="kobo.551.1"> and Key Vaults during a penetration test. </span><span class="koboSpan" id="kobo.551.2">Azure services, such as </span><strong class="bold"><span class="koboSpan" id="kobo.552.1">Azure Resource Manager</span></strong><span class="koboSpan" id="kobo.553.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.554.1">ARM</span></strong><span class="koboSpan" id="kobo.555.1">) and Azure Key Vault, are critical components that store sensitive information. </span><span class="koboSpan" id="kobo.555.2">Here’s how PowerShell can be employed to analyze Azure and Key Vaults in Azure during </span><span class="No-Break"><span class="koboSpan" id="kobo.556.1">penetration testing.</span></span></p>
<h2 id="_idParaDest-337"><a id="_idTextAnchor335"/><span class="koboSpan" id="kobo.557.1">Analyzing Azure resources</span></h2>
<p><span class="koboSpan" id="kobo.558.1">The following are the </span><span class="No-Break"><span class="koboSpan" id="kobo.559.1">steps</span></span><span class="No-Break"><a id="_idIndexMarker748"/></span><span class="No-Break"><span class="koboSpan" id="kobo.560.1"> involved:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.561.1">Retrieving information about </span><span class="No-Break"><span class="koboSpan" id="kobo.562.1">Azure resources:</span></span><p class="list-inset"><span class="koboSpan" id="kobo.563.1">PowerShell can retrieve detailed information about various Azure resources, including virtual machines, storage accounts, and </span><span class="No-Break"><span class="koboSpan" id="kobo.564.1">networking components:</span></span></p><pre class="source-code"><span class="koboSpan" id="kobo.565.1">
# Retrieve information about virtual machines in a specific resource group
Get-AzVM -ResourceGroupName "YourResourceGroup" | Select-Object Name, ResourceGroupName, Location, PowerState</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.566.1">This command lists the virtual machines in a specified resource group, displaying details such as VM name, resource group, location, and power state. </span><span class="koboSpan" id="kobo.566.2">Penetration testers can analyze this information to identify potential targets </span><span class="No-Break"><span class="koboSpan" id="kobo.567.1">for exploitation.</span></span></p></li> <li><span class="koboSpan" id="kobo.568.1">Examining </span><strong class="bold"><span class="koboSpan" id="kobo.569.1">Network Security Groups</span></strong><span class="koboSpan" id="kobo.570.1"> (</span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.571.1">NSGs</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.572.1">) rules:</span></span><p class="list-inset"><span class="koboSpan" id="kobo.573.1">Network Security Groups</span><a id="_idIndexMarker749"/><span class="koboSpan" id="kobo.574.1"> control inbound and outbound traffic to Azure resources. </span><span class="koboSpan" id="kobo.574.2">PowerShell enables testers to review NSGs rules for potential </span><span class="No-Break"><span class="koboSpan" id="kobo.575.1">security risks:</span></span></p><pre class="source-code"><span class="koboSpan" id="kobo.576.1">
# List NSG rules for a specific subnet
$subnet = "YourSubnet"
(Get-AzNetworkSecurityGroup -ResourceGroupName "YourResourceGroup" | Get-AzNetworkSecurityRuleConfig | Where-Object { $_.SourcePortRange -eq '*' -and $_.DestinationPortRange -eq '*' -and $_.Direction -eq 'Inbound' -and $_.SourceAddressPrefix -eq '*' -and $_.DestinationAddressPrefix -eq "$subnet" }) | Select-Object Name, Priority, Access, Direction, Protocol</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.577.1">This script fetches and displays inbound NSGs rules for a specific subnet, providing insights</span><a id="_idIndexMarker750"/><span class="koboSpan" id="kobo.578.1"> into the configured </span><span class="No-Break"><span class="koboSpan" id="kobo.579.1">security policies.</span></span></p></li> </ol>
<h2 id="_idParaDest-338"><a id="_idTextAnchor336"/><span class="koboSpan" id="kobo.580.1">Analyzing Azure Key Vaults</span></h2>
<p><span class="koboSpan" id="kobo.581.1">The following</span><a id="_idIndexMarker751"/><span class="koboSpan" id="kobo.582.1"> are the </span><span class="No-Break"><span class="koboSpan" id="kobo.583.1">steps involved:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.584.1">Retrieving Key </span><span class="No-Break"><span class="koboSpan" id="kobo.585.1">Vault secrets:</span></span><p class="list-inset"><span class="koboSpan" id="kobo.586.1">PowerShell can retrieve and analyze the secrets stored in Azure Key Vaults, helping testers identify sensitive information that may </span><span class="No-Break"><span class="koboSpan" id="kobo.587.1">impact security:</span></span></p><pre class="source-code"><span class="koboSpan" id="kobo.588.1">
# Retrieve secrets from Azure Key Vault
$keyVault = Get-AzKeyVault -VaultName "YourKeyVaultName" -ResourceGroupName "YourResourceGroup"
Get-AzKeyVaultSecret -VaultName $keyVault.VaultName | Select-Object Name, Version, Enabled</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.589.1">This command fetches and displays details about secrets in the specified Azure Key Vault, including their name, version, and whether they are enabled. </span><span class="koboSpan" id="kobo.589.2">Penetration testers can use this information to assess the security of </span><span class="No-Break"><span class="koboSpan" id="kobo.590.1">stored secrets.</span></span></p></li> <li><span class="koboSpan" id="kobo.591.1">Auditing Key </span><span class="No-Break"><span class="koboSpan" id="kobo.592.1">Vault access:</span></span><p class="list-inset"><span class="koboSpan" id="kobo.593.1">PowerShell enables testers to audit access to Key Vaults, providing insights into who accessed the Key Vault </span><span class="No-Break"><span class="koboSpan" id="kobo.594.1">and when:</span></span></p><pre class="source-code"><span class="koboSpan" id="kobo.595.1">
# Enable auditing for an Azure Key Vault
Set-AzKeyVault -VaultName "YourKeyVaultName" -ResourceGroupName "YourResourceGroup" -EnableSoftDelete $true -EnablePurgeProtection $true -EnableRbacAuthorization $true -Sku Premium</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.596.1">This command enables</span><a id="_idIndexMarker752"/><span class="koboSpan" id="kobo.597.1"> various security features, including auditing, for an Azure Key Vault. </span><span class="koboSpan" id="kobo.597.2">Testers can then review audit logs to analyze </span><span class="No-Break"><span class="koboSpan" id="kobo.598.1">access patterns.</span></span></p></li> </ol>
<h2 id="_idParaDest-339"><a id="_idTextAnchor337"/><span class="koboSpan" id="kobo.599.1">Automating the analysis of Azure resources and Key Vaults</span></h2>
<p><span class="koboSpan" id="kobo.600.1">PowerShell scripts can automate</span><a id="_idIndexMarker753"/><span class="koboSpan" id="kobo.601.1"> the Azure resources and Key Vaults</span><a id="_idIndexMarker754"/><span class="koboSpan" id="kobo.602.1"> analysis. </span><span class="koboSpan" id="kobo.602.2">These scripts can iterate through various resource types, Key Vaults, and configurations, providing comprehensive insights into the </span><span class="No-Break"><span class="koboSpan" id="kobo.603.1">security landscape.</span></span></p>
<p><span class="koboSpan" id="kobo.604.1">In conclusion, PowerShell is a valuable tool for penetration testers when analyzing Azure resources and Key Vaults. </span><span class="koboSpan" id="kobo.604.2">By leveraging its capabilities, testers can gather information, scrutinize configurations, and identify potential security risks associated with Azure services and stored secrets. </span><span class="koboSpan" id="kobo.604.3">Automation further streamlines the penetration testing process, enabling a thorough examination of Azure resources and Key Vaults in a scalable and </span><span class="No-Break"><span class="koboSpan" id="kobo.605.1">efficient manner.</span></span></p>
<h1 id="_idParaDest-340"><a id="_idTextAnchor338"/><span class="koboSpan" id="kobo.606.1">Azure and virtual machines</span></h1>
<p><span class="koboSpan" id="kobo.607.1">The basic method that Azure</span><a id="_idIndexMarker755"/><span class="koboSpan" id="kobo.608.1"> uses to develop a service is that of a virtual machine. </span><span class="koboSpan" id="kobo.608.2">We can query an Azure Tenancy to identify all associated VM machines. </span><span class="koboSpan" id="kobo.608.3">By using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.609.1">Get-AzVM</span></strong><span class="koboSpan" id="kobo.610.1"> command, we can get a list of all the VM machines associated with </span><span class="No-Break"><span class="koboSpan" id="kobo.611.1">the tenancy:</span></span></p>
<pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.612.1">PS C:\&gt; Get-AzVM</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.613.1">ResourceGroupName                  Name Location            VmSize  OsType        NIC           ProvisioningState</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.614.1">-----------------                  ---- --------            ------  ------        ---           -----------------</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.615.1">SNOWCAPCLOUD                 SNOWUNIX01  UKWales   Standard_D8s_v3   Linux        SNOWUNIX01268         Succeeded</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.616.1">SNOWWINCLOUD                  SNOWWIN01  UKWales   Standard_D8s_v3 Windows        SNOWWIN01789          Succeeded</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.617.1">SNOWWINCLOUD                  SNOWWIN02  UKCardiff Standard_D8s_v3 Windows        SNOWWIN02906          Succeeded</span></strong></pre> <p><span class="koboSpan" id="kobo.618.1">We can use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.619.1">Get-AzVM</span></strong><span class="koboSpan" id="kobo.620.1"> command </span><a id="_idIndexMarker756"/><span class="koboSpan" id="kobo.621.1">to query the virtual machines by name and by location </span><span class="No-Break"><span class="koboSpan" id="kobo.622.1">as follows:</span></span></p>
<pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.623.1">PS C:\&gt; Get-AzVM -Name *UNIX* | Where-Object { $_.StorageProfile.OsDisk.OsType -eq "Linux" -or $_.StorageProfile.OsDisk.OsType -eq "Linux" }</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.624.1">ResourceGroupName                  Name Location            VmSize  OsType        NIC           ProvisioningState</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.625.1">-----------------                  ---- --------            ------  ------        ---           -----------------</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.626.1">SNOWCAPCLOUD                 SNOWUNIX01  UKWales   Standard_D8s_v3   Linux        SNOWUNIX01268         Succeeded</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.627.1">PS C:\&gt; Get-AzVM -Location "UKCardiff"</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.628.1">ResourceGroupName                  Name Location            VmSize  OsType        NIC           ProvisioningState</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.629.1">-----------------                  ---- --------            ------  ------        ---           -----------------</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.630.1">SNOWWINCLOUD                  SNOWWIN02  UKCardiff Standard_D8s_v3 Windows        SNOWWIN02906          Succeeded</span></strong></pre> <p><span class="koboSpan" id="kobo.631.1">Once we know the names</span><a id="_idIndexMarker757"/><span class="koboSpan" id="kobo.632.1"> of all the virtual machines within a tenancy, we can query the tenancy and extract the public IP address for a virtual machine. </span><span class="koboSpan" id="kobo.632.2">We achieve this as follows. </span><span class="koboSpan" id="kobo.632.3">Then, once we have identified all public IP addresses associated with a tenancy, we can start to attack/probe these </span><span class="No-Break"><span class="koboSpan" id="kobo.633.1">IP addresses:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.634.1">
PS C:\&gt; Get-azpublicipaddress -Name SNOWUNIX01 | select IpAddress
IpAddress
137.135.55.253</span></pre> <p><span class="koboSpan" id="kobo.635.1">Once we have identified the IP addresses that we can use to access Microsoft Azure, we can start to make use of the various features that </span><span class="No-Break"><span class="koboSpan" id="kobo.636.1">it provides.</span></span></p>
<h1 id="_idParaDest-341"><a id="_idTextAnchor339"/><span class="koboSpan" id="kobo.637.1">Azure and Web Services</span></h1>
<p><span class="koboSpan" id="kobo.638.1">PowerShell is a versatile</span><a id="_idIndexMarker758"/><span class="koboSpan" id="kobo.639.1"> tool for penetration testers to analyze Azure resources and Web Services as part of a comprehensive security assessment. </span><span class="koboSpan" id="kobo.639.2">Azure, Microsoft’s cloud computing platform, hosts a wide range of services, and penetration testers can leverage PowerShell to assess the security of these services. </span><span class="koboSpan" id="kobo.639.3">Here’s a detailed guide on how PowerShell can be utilized for analyzing Azure resources and Web Services during a </span><span class="No-Break"><span class="koboSpan" id="kobo.640.1">penetration test:</span></span></p>
<h2 id="_idParaDest-342"><a id="_idTextAnchor340"/><span class="koboSpan" id="kobo.641.1">Analyzing Azure resources</span></h2>
<p><span class="koboSpan" id="kobo.642.1">The following</span><a id="_idIndexMarker759"/><span class="koboSpan" id="kobo.643.1"> are the </span><span class="No-Break"><span class="koboSpan" id="kobo.644.1">steps involved:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.645.1">Retrieving information about </span><span class="No-Break"><span class="koboSpan" id="kobo.646.1">Azure resources:</span></span><p class="list-inset"><span class="koboSpan" id="kobo.647.1">PowerShell can gather information about various Azure resources, such as virtual machines, storage accounts, </span><span class="No-Break"><span class="koboSpan" id="kobo.648.1">and databases:</span></span></p><pre class="source-code"><span class="koboSpan" id="kobo.649.1">
# Retrieve information about virtual machines in a specific resource group
Get-AzVM -ResourceGroupName "YourResourceGroup" | Select-Object Name, ResourceGroupName, Location, PowerState</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.650.1">This command fetches details such as VM name, resource group, location, and power state. </span><span class="koboSpan" id="kobo.650.2">It provides insights into the current state of virtual machines, helping penetration testers identify </span><span class="No-Break"><span class="koboSpan" id="kobo.651.1">potential targets.</span></span></p></li> <li><span class="koboSpan" id="kobo.652.1">Analyzing </span><span class="No-Break"><span class="koboSpan" id="kobo.653.1">storage accounts:</span></span><p class="list-inset"><span class="koboSpan" id="kobo.654.1">PowerShell allows testers to examine storage accounts and </span><span class="No-Break"><span class="koboSpan" id="kobo.655.1">associated configurations:</span></span></p><pre class="source-code"><span class="koboSpan" id="kobo.656.1">
# List storage accounts and their properties
Get-AzStorageAccount | Select-Object StorageAccountName, ResourceGroupName, Location, AccountType</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.657.1">This script lists storage accounts along with details such as account name, resource group, location, and account type. </span><span class="koboSpan" id="kobo.657.2">It aids testers in assessing the security posture of </span><span class="No-Break"><span class="koboSpan" id="kobo.658.1">Azure Storage.</span></span></p></li> <li><span class="koboSpan" id="kobo.659.1">Investigating </span><span class="No-Break"><span class="koboSpan" id="kobo.660.1">Azure databases:</span></span><p class="list-inset"><span class="koboSpan" id="kobo.661.1">For databases hosted in Azure, PowerShell can provide information on their configurations </span><span class="No-Break"><span class="koboSpan" id="kobo.662.1">and settings:</span></span></p><pre class="source-code"><span class="koboSpan" id="kobo.663.1">
# Get information about Azure SQL databases
Get-AzSqlDatabase -ResourceGroupName "YourResourceGroup" -ServerName "YourSqlServer" | Select-Object DatabaseName, Collation, Edition, ServiceObjectiveName</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.664.1">This command retrieves details</span><a id="_idIndexMarker760"/><span class="koboSpan" id="kobo.665.1"> such as database name, collation, edition, and service objective. </span><span class="koboSpan" id="kobo.665.2">Testers can use this information to assess the security configurations of Azure </span><span class="No-Break"><span class="koboSpan" id="kobo.666.1">SQL databases.</span></span></p></li> </ol>
<h2 id="_idParaDest-343"><a id="_idTextAnchor341"/><span class="koboSpan" id="kobo.667.1">Analyzing Web Services in Azure</span></h2>
<p><span class="koboSpan" id="kobo.668.1">The following</span><a id="_idIndexMarker761"/><span class="koboSpan" id="kobo.669.1"> are the </span><span class="No-Break"><span class="koboSpan" id="kobo.670.1">steps</span></span><span class="No-Break"><a id="_idIndexMarker762"/></span><span class="No-Break"><span class="koboSpan" id="kobo.671.1"> involved:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.672.1">Retrieving information about Azure </span><span class="No-Break"><span class="koboSpan" id="kobo.673.1">App Services:</span></span><p class="list-inset"><span class="koboSpan" id="kobo.674.1">Azure App Services host web applications and APIs. </span><span class="koboSpan" id="kobo.674.2">PowerShell allows testers to fetch details about </span><span class="No-Break"><span class="koboSpan" id="kobo.675.1">these services:</span></span></p><pre class="source-code"><span class="koboSpan" id="kobo.676.1">
# List Azure App Services and their configurations
Get-AzWebApp | Select-Object Name, ResourceGroupName, Location, DefaultHostName</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.677.1">This command lists Azure App Services, including details such as service name, resource group, location, and default hostname. </span><span class="koboSpan" id="kobo.677.2">It provides insights into the web applications hosted </span><span class="No-Break"><span class="koboSpan" id="kobo.678.1">in Azure.</span></span></p></li> <li><span class="koboSpan" id="kobo.679.1">Analyzing web </span><span class="No-Break"><span class="koboSpan" id="kobo.680.1">application configurations:</span></span><p class="list-inset"><span class="koboSpan" id="kobo.681.1">PowerShell can be used to retrieve configurations and settings for web applications hosted on Azure </span><span class="No-Break"><span class="koboSpan" id="kobo.682.1">App Services:</span></span></p><pre class="source-code"><span class="koboSpan" id="kobo.683.1">
# Get web application configurations
$webAppName = "YourWebAppName"
(Get-AzWebApp -ResourceGroupName "YourResourceGroup" -Name $webAppName).SiteConfig</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.684.1">This script fetches the site configuration for a specific web application, including the settings related to authentication, CORS, and other </span><span class="No-Break"><span class="koboSpan" id="kobo.685.1">security-related parameters.</span></span></p></li> <li><span class="koboSpan" id="kobo.686.1">Investigating </span><span class="No-Break"><span class="koboSpan" id="kobo.687.1">Azure Functions:</span></span><p class="list-inset"><span class="koboSpan" id="kobo.688.1">Azure Functions provide serverless computing capabilities. </span><span class="koboSpan" id="kobo.688.2">PowerShell can help testers analyze the configurations of </span><span class="No-Break"><span class="koboSpan" id="kobo.689.1">Azure Functions:</span></span></p><pre class="source-code"><span class="koboSpan" id="kobo.690.1">
# List Azure Functions and their configurations
Get-AzFunctionApp | Select-Object Name, ResourceGroupName, Location, Kind</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.691.1">This command lists Azure Functions, providing details such as function app name, resource group, location, and kind. </span><span class="koboSpan" id="kobo.691.2">Testers</span><a id="_idIndexMarker763"/><span class="koboSpan" id="kobo.692.1"> can use this information to assess </span><span class="No-Break"><span class="koboSpan" id="kobo.693.1">serverless</span></span><span class="No-Break"><a id="_idIndexMarker764"/></span><span class="No-Break"><span class="koboSpan" id="kobo.694.1"> components.</span></span></p></li> </ol>
<h2 id="_idParaDest-344"><a id="_idTextAnchor342"/><span class="koboSpan" id="kobo.695.1">Automating the analysis of Azure resources and Web Services</span></h2>
<p><span class="koboSpan" id="kobo.696.1">PowerShell scripts can be written</span><a id="_idIndexMarker765"/><span class="koboSpan" id="kobo.697.1"> to automate the analysis</span><a id="_idIndexMarker766"/><span class="koboSpan" id="kobo.698.1"> of Azure resources and Web Services. </span><span class="koboSpan" id="kobo.698.2">Automation enhances efficiency and allows penetration testers to scale </span><span class="No-Break"><span class="koboSpan" id="kobo.699.1">their assessments.</span></span></p>
<p><span class="koboSpan" id="kobo.700.1">In summary, by leveraging PowerShell capabilities, testers can gather detailed information, scrutinize configurations, and identify any potential security risks associated with Azure services and hosted web applications. </span><span class="koboSpan" id="kobo.700.2">Automation further streamlines the penetration testing process, enabling a thorough examination of Azure resources and Web Services in a scalable and </span><span class="No-Break"><span class="koboSpan" id="kobo.701.1">efficient manner.</span></span></p>
<h1 id="_idParaDest-345"><a id="_idTextAnchor343"/><span class="koboSpan" id="kobo.702.1">Summary</span></h1>
<p><span class="koboSpan" id="kobo.703.1">In this chapter, we explored the pivotal role of PowerShell in conducting a penetration test on Azure. </span><span class="koboSpan" id="kobo.703.2">By leveraging PowerShell’s capabilities, we navigated through Azure’s multifaceted landscape, dissecting Identity Management, Role-Based Access Control, Data Storage, SQL, and Web Services. </span><span class="koboSpan" id="kobo.703.3">By employing PowerShell scripts, testers gained granular insights into Azure resources, executed automated analyses, and identified potential security vulnerabilities. </span><span class="koboSpan" id="kobo.703.4">The chapter emphasized the importance of cross-service analysis and showcased PowerShell’s efficiency in fortifying Azure against </span><span class="No-Break"><span class="koboSpan" id="kobo.704.1">cyber threats.</span></span></p>
<p><span class="koboSpan" id="kobo.705.1">With this comprehensive exploration, you are equipped to harness PowerShell’s prowess for effective penetration testing, ensuring a resilient and secure </span><span class="No-Break"><span class="koboSpan" id="kobo.706.1">Azure environment.</span></span></p>
</div>
</body></html>