<html><head></head><body>
		<div id="_idContainer464">
			<h1 id="_idParaDest-166" class="chapter-number"><a id="_idTextAnchor165"/>10</h1>
			<h1 id="_idParaDest-167"><a id="_idTextAnchor166"/>Implementing Recon Monitoring and Detection Systems</h1>
			<p>The longer an organization takes to discover that its network infrastructure and systems are compromised, the more time adversaries spend in their network compromising additional systems to expand their foothold within the victim’s network. Implementing and working <a id="_idIndexMarker1029"/>with network security tools helps <strong class="bold">Security Operation Centers</strong> (<strong class="bold">SOCs</strong>) and <strong class="bold">Digital Forensic and Incident Response</strong> (<strong class="bold">DFIR</strong>) teams <a id="_idIndexMarker1030"/>to effectively monitor network traffic, detect potential threats, and provide real-time alerts for faster response times, containment, and eradication <span class="No-Break">of threats.</span></p>
			<p>In this chapter, you will learn the fundamentals of using Wireshark to perform packet analysis as an ethical hacker. Additionally, you will learn how to deploy and use Security Onion to monitor a network and detect suspicious activities to further determine whether it’s a security event or an incident within <span class="No-Break">your organization.</span></p>
			<p>In this chapter, we will cover the <span class="No-Break">following topics:</span></p>
			<ul>
				<li>Wireshark for <span class="No-Break">ethical hackers</span></li>
				<li>Monitoring and <span class="No-Break">detection systems</span></li>
			</ul>
			<p>Let’s <span class="No-Break">dive in!</span></p>
			<h1 id="_idParaDest-168"><a id="_idTextAnchor167"/>Technical requirements</h1>
			<p>To follow along with the exercises in this chapter, please ensure that you have met the following hardware and <span class="No-Break">software requirements:</span></p>
			<ul>
				<li>Wireshark – <a href="https://www.wireshark.org/"><span class="No-Break">https://www.wireshark.org/</span></a></li>
				<li>Security Onion – <a href="https://securityonionsolutions.com/"><span class="No-Break">https://securityonionsolutions.com/</span></a></li>
				<li>VMware Workstation Pro – <a href="https://www.vmware.com/products/workstation-pro.html"><span class="No-Break">https://www.vmware.com/products/workstation-pro.html</span></a></li>
			</ul>
			<h1 id="_idParaDest-169"><a id="_idTextAnchor168"/>Wireshark for ethical hackers</h1>
			<p>Wireshark is a popular and very powerful network protocol analyzer that’s commonly used by both <a id="_idIndexMarker1031"/>networking and cybersecurity professionals in the industry to identify networking issues and threats within an organization’s network. Wireshark enables professionals to capture network packets and perform analysis to gain better insights into what’s happening in the network by viewing the contents of each packet <span class="No-Break">or frame.</span></p>
			<p>As you <a id="_idIndexMarker1032"/>may know, the <strong class="bold">Network Interface Card</strong> (<strong class="bold">NIC</strong>) of a sender device is responsible for converting data into a signal that can be transported over a certain form of media, such as electrical signals for copper wires, light signals for fiber optics, and radio frequency for wireless communication. Wireshark can capture these signal types and convert them into human-readable language, helping us to better analyze <span class="No-Break">network traffic.</span></p>
			<p>Wireshark helps ethical hackers to detect security vulnerabilities within network-based applications, services, and protocols that can be exploited by threat actors. The following are common reasons why ethical hackers use Wireshark during <span class="No-Break">security assessments:</span></p>
			<ul>
				<li><strong class="bold">Packet sniffing</strong> – Ethical hackers can set up a network implant on the network to capture <a id="_idIndexMarker1033"/>sensitive and confidential data sent over an organization’s network, which can be leveraged to perform future operations. In addition, ethical hackers can identify whether the organization is using any insecure network protocols that transmit messages <span class="No-Break">in plaintext.</span></li>
				<li><strong class="bold">Protocol analysis</strong> – Protocol analysis enables ethical hackers to better understand <a id="_idIndexMarker1034"/>the behavior of the network, employees, and devices by observing network protocols and identifying services and applications that are running on critical systems such as servers. By identifying network protocols, ethical hackers can research whether there are any known security vulnerabilities within a protocol and how they can be exploited by <span class="No-Break">an adversary.</span></li>
				<li><strong class="bold">Malware analysis</strong> – Cybersecurity professionals such as threat hunters and incident <a id="_idIndexMarker1035"/>response teams use Wireshark to identify whether there’s malware on their network, the type of malware, and whether it <a id="_idIndexMarker1036"/>has established a <strong class="bold">Command and Control</strong> (<strong class="bold">C2</strong>) communication channel to an <span class="No-Break">online server.</span></li>
				<li><strong class="bold">Exploit development</strong> – An important stage when developing an exploit is testing to <a id="_idIndexMarker1037"/>ensure it’s working as expected and determining its threat level. For instance, if a threat actor creates and delivers an exploit that establishes a remote connection to the attacker’s machine, the network connection may be detected as suspicious activity and blocked by the organization’s security team. Using Wireshark helps you better understand what is seen by networking and <span class="No-Break">cybersecurity professionals.</span></li>
			</ul>
			<p>Wireshark can be a bit daunting for beginners as it provides a lot of details of everything it has captured on the network, and its filters enable you to fully leverage the capabilities of this tool to analyze <span class="No-Break">network traffic.</span></p>
			<p>The following <a id="_idIndexMarker1038"/>are Wireshark operators and <span class="No-Break">their descriptions:</span></p>
			<ul>
				<li><strong class="source-inline">==</strong> – This operator enables you to specify an exact match. For instance, if you want to filter packets with TCP port <strong class="source-inline">80</strong>, the filter will be <strong class="source-inline">tcp.port == </strong><span class="No-Break"><strong class="source-inline">80</strong></span><span class="No-Break">.</span></li>
				<li><strong class="source-inline">!=</strong> – This operator means <em class="italic">not equal to</em> and it’s commonly used to exclude something. For instance, if you want to filter traffic that does not include TCP port <strong class="source-inline">22</strong>, the filter will be <strong class="source-inline">tcp.port != </strong><span class="No-Break"><strong class="source-inline">22</strong></span><span class="No-Break">.</span></li>
				<li><strong class="source-inline">&lt;</strong> or <strong class="source-inline">&gt;</strong> – The <em class="italic">less than</em> or <em class="italic">greater than</em> operators are used to specify a value either less than or greater than within a packet. For instance, if you want to filter TCP packets that are greater than 150 bytes, the filter will be <strong class="source-inline">tcp.len &gt; </strong><span class="No-Break"><strong class="source-inline">150</strong></span><span class="No-Break">.</span></li>
				<li><strong class="source-inline">&amp;&amp;</strong> – The <em class="italic">and</em> operator is used to combine multiple criteria that are all true. For instance, if you want to filter traffic from a specific sender to a destination address, the filter will be <strong class="source-inline">(ip.src == 172.16.254.128) &amp;&amp; (ip.dst == </strong><span class="No-Break"><strong class="source-inline">8.8.8.8)</strong></span><span class="No-Break">.</span></li>
				<li><strong class="source-inline">||</strong> – The <em class="italic">or</em> operator is <a id="_idIndexMarker1039"/>used to specify multiple criteria where only one must be true. For instance, if you want to filter either HTTP (port <strong class="source-inline">80</strong>) or HTTPS (port <strong class="source-inline">443</strong>) packets, the filter will be <strong class="source-inline">(tcp.port == 80 ) || (tcp.port == </strong><span class="No-Break"><strong class="source-inline">443)</strong></span><span class="No-Break">.</span></li>
			</ul>
			<p>The following <a id="_idIndexMarker1040"/>are common Wireshark <span class="No-Break">display filters:</span></p>
			<ul>
				<li>To filter <a id="_idIndexMarker1041"/>traffic based on a specific device with the <strong class="bold">Media Access Control</strong> (<strong class="bold">MAC</strong>) <span class="No-Break">address </span><span class="No-Break"><strong class="source-inline">00:0c:29:b6:b5:48</strong></span><span class="No-Break">:</span><pre class="source-code">
eth.src == 00:0c:29:b6:b5:48</pre></li>
				<li>To filter <strong class="bold">Address Resolution Protocol</strong> (<strong class="bold">ARP</strong>) messages from a device with a source <a id="_idIndexMarker1042"/>MAC address <span class="No-Break">of </span><span class="No-Break"><strong class="source-inline">00:0c:29:b6:b5:48</strong></span><span class="No-Break">:</span><pre class="source-code">
arp.src.hw_mac == 00:0c:29:b6:b5:48</pre></li>
				<li>To filter traffic based on a specific device with an IP address <span class="No-Break">of </span><span class="No-Break"><strong class="source-inline">172.16.254.128</strong></span><span class="No-Break">:</span><pre class="source-code">
ip.src == 172.16.254.128</pre></li>
				<li>To filter ARP messages from a device with the IP <span class="No-Break">address </span><span class="No-Break"><strong class="source-inline">172.16.254.128</strong></span><span class="No-Break">:</span><pre class="source-code">
arp.src.proto_ipv4 == 172.16.254.128</pre></li>
				<li>The following common operators to filter <span class="No-Break">traffic types:</span><ul><li><strong class="source-inline">eth</strong> – Filters <span class="No-Break">Ethernet messages</span></li><li><strong class="source-inline">ip</strong> – Filters <span class="No-Break">IPv4 packets</span></li><li><strong class="source-inline">ipv6</strong> – Filters <a id="_idIndexMarker1043"/><span class="No-Break">IPv6 packets</span></li><li><strong class="source-inline">icmp</strong> – Filters <strong class="bold">Internet Control Message Protocol</strong> (<strong class="bold">ICMP</strong>) <span class="No-Break">v4 messages</span></li><li><strong class="source-inline">icmpv6</strong> – Filters <a id="_idIndexMarker1044"/><span class="No-Break">ICMPv6 messages</span></li><li><strong class="source-inline">tcp</strong> – Filters <strong class="bold">Transmission Control Protocol</strong> (<span class="No-Break"><strong class="bold">TCP</strong></span><span class="No-Break">) messages</span></li><li><strong class="source-inline">udp</strong> – Filters <strong class="bold">User Datagram Protocol</strong> (<span class="No-Break"><strong class="bold">UDP</strong></span><span class="No-Break">) messages</span></li><li><strong class="source-inline">http</strong>, <strong class="source-inline">http2</strong>, and <strong class="source-inline">http3</strong> – Filters HTTP, HTTP/2 and <span class="No-Break">HTTP/3 protocols</span></li><li>Common <a id="_idIndexMarker1045"/>application layer protocols such <a id="_idIndexMarker1046"/>as <strong class="bold">Domain Name System</strong> (<strong class="bold">DNS</strong>), <strong class="bold">Simple Mail Transfer Protocol</strong> (<strong class="bold">SMTP</strong>), and <strong class="bold">Secure Shell</strong> (<strong class="bold">SSH</strong>) are also <a id="_idIndexMarker1047"/>filters when written in <a id="_idIndexMarker1048"/>lowercase letters, such as <strong class="source-inline">dns</strong>, <strong class="source-inline">smtp</strong>, <strong class="source-inline">ssh</strong>, and <span class="No-Break">so on.</span></li></ul></li>
			</ul>
			<p class="callout-heading">Tip</p>
			<p class="callout">To learn <a id="_idIndexMarker1049"/>more about Wireshark display filters, please <span class="No-Break">see </span><a href="https://wiki.wireshark.org/DisplayFilters/"><span class="No-Break">https://wiki.wireshark.org/DisplayFilters/</span></a><span class="No-Break">.</span></p>
			<p>To get started with using Wireshark, please use the <span class="No-Break">following instructions:</span></p>
			<ol>
				<li>Go to the <a id="_idIndexMarker1050"/>official Wireshark website at <a href="https://www.wireshark.org/">https://www.wireshark.org/</a> to download and install Wireshark on your computer, or you can open the Wireshark application within the Kali Linux <span class="No-Break">virtual machine.</span></li>
				<li>Let’s download a sample packet capture file, go to <a href="https://www.honeynet.org/challenges/forensics-challenge-14-weird-python/">https://www.honeynet.org/challenges/forensics-challenge-14-weird-python/</a> and download the <strong class="source-inline">conference.pcapng</strong> file. Additionally, you can download more Wireshark sample files <span class="No-Break">from </span><a href="https://wiki.wireshark.org/SampleCaptures"><span class="No-Break">https://wiki.wireshark.org/SampleCaptures</span></a><span class="No-Break">.</span></li>
				<li>Next, when you launch the Wireshark application on your computer, you will see a list of available network adapters <span class="No-Break">as shown:</span></li>
			</ol>
			<div>
				<div id="_idContainer395" class="IMG---Figure">
					<img src="image/Figure_10.01_B19448.jpg" alt="Figure 10.1 – Wireshark interface"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.1 – Wireshark interface</p>
			<p>If you double-click <a id="_idIndexMarker1051"/>on an interface, Wireshark will begin to capture packets on that same interface and show you the <span class="No-Break">live traffic.</span></p>
			<ol>
				<li value="4">To capture traffic, it’s important to set your monitoring/capturing interface to <em class="italic">promiscuous mode</em> by clicking on <strong class="bold">Capture</strong> | <strong class="bold">Options</strong>, then enabling <strong class="bold">Promiscuous</strong> mode on your <span class="No-Break">preferred interface:</span></li>
			</ol>
			<div>
				<div id="_idContainer396" class="IMG---Figure">
					<img src="image/Figure_10.02_B19448.jpg" alt="Figure 10.2 – Network adapters"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.2 – Network adapters</p>
			<p>Additionally, the <strong class="bold">Output</strong> tab enables <a id="_idIndexMarker1052"/>you to customize the duration, number of packets, and location when storing the <span class="No-Break">captured data:</span></p>
			<div>
				<div id="_idContainer397" class="IMG---Figure">
					<img src="image/Figure_10.03_B19448.jpg" alt="Figure 10.3 – Capture options"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.3 – Capture options</p>
			<p>Once you click on <strong class="bold">Start</strong>, the packet capture will begin on the selected interface. However, do not <a id="_idIndexMarker1053"/>start the capture; instead, we’ll use the <strong class="source-inline">conference.pcapng</strong> file for <span class="No-Break">our analysis.</span></p>
			<ol>
				<li value="5">To load the <strong class="source-inline">conference.pcapng</strong> file, click on <strong class="bold">File</strong> | <strong class="bold">Open</strong>, and select the sample file; then the packets will populate in Wireshark <span class="No-Break">as shown:</span></li>
			</ol>
			<div>
				<div id="_idContainer398" class="IMG---Figure">
					<img src="image/Figure_10.04_B19448.jpg" alt="Figure 10.4 – Wireshark"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.4 – Wireshark</p>
			<p>As shown in <a id="_idIndexMarker1054"/>the preceding snippet, <strong class="bold">A</strong> shows the Packet List pane, <strong class="bold">B</strong> shows the Packet Details pane and <strong class="bold">C</strong> shows the Packet Bytes pane. When a packet is selected in the Packet List, its details are shown in the Packet <span class="No-Break">Details pane.</span></p>
			<ol>
				<li value="6">To filter packets with a source IP address of <strong class="source-inline">172.16.254.128</strong>, select packet 5 from the <strong class="bold">Packet List</strong> pane, then expand the <strong class="bold">Internet Protocol Version 4</strong> header, and right-click on the <strong class="bold">Source Address</strong> field <span class="No-Break">as shown:</span></li>
			</ol>
			<div>
				<div id="_idContainer399" class="IMG---Figure">
					<img src="image/Figure_10.05_B19448.jpg" alt="Figure 10.5 – Packet details"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.5 – Packet details</p>
			<p>Then, click <a id="_idIndexMarker1055"/>on <strong class="bold">Apply as Filter</strong> | <strong class="bold">Selected</strong> <span class="No-Break">as shown:</span></p>
			<div>
				<div id="_idContainer400" class="IMG---Figure">
					<img src="image/Figure_10.06_B19448.jpg" alt="Figure 10.6 – Creating filters"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.6 – Creating filters</p>
			<p>As shown in the preceding snippet, the <strong class="bold">Apply as Filter</strong> options will immediately apply the display filter. The <strong class="bold">Prepare as Filter</strong> options enable you to create filters without applying <span class="No-Break">them immediately.</span></p>
			<p>The following snippet shows the display filter was applied and shows all the packets with a source IP address <span class="No-Break">of </span><span class="No-Break"><strong class="source-inline">172.16.254.128</strong></span><span class="No-Break">:</span></p>
			<div>
				<div id="_idContainer401" class="IMG---Figure">
					<img src="image/Figure_10.07_B19448.jpg" alt="Figure 10.7 – Filtering traffic based on the source IP address"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.7 – Filtering traffic based on the source IP address</p>
			<ol>
				<li value="7">Next, to filter <a id="_idIndexMarker1056"/>traffic between <strong class="source-inline">172.16.254.128</strong> and <strong class="source-inline">8.8.8.8</strong>, expand Packet Details for packet 5 again, right-click on <strong class="bold">Destination Address: 8.8.8.8</strong>, and select <strong class="bold">Apply as Filter</strong> | <span class="No-Break"><strong class="bold">Selected</strong></span><span class="No-Break">:</span></li>
			</ol>
			<div>
				<div id="_idContainer402" class="IMG---Figure">
					<img src="image/Figure_10.08_B19448.jpg" alt="Figure 10.8 – Creating display filters"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.8 – Creating display filters</p>
			<p>As shown in the preceding snippet, the amended display filters help us to view conversations between specific source and destination hosts on <span class="No-Break">a network.</span></p>
			<ol>
				<li value="8">To perform <a id="_idIndexMarker1057"/>automatic name resolution of IP addresses, port numbers, and MAC addresses, click on <strong class="bold">Edit</strong> | <strong class="bold">Preferences</strong> | <strong class="bold">Name Resolution</strong> to enable these features <span class="No-Break">as shown:</span></li>
			</ol>
			<div>
				<div id="_idContainer403" class="IMG---Figure">
					<img src="image/Figure_10.09_B19448.jpg" alt="Figure 10.9 – Name resolution"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.9 – Name resolution</p>
			<ol>
				<li value="9">To view all network conversations using Wireshark, click on <strong class="bold">Statistics</strong> | <span class="No-Break"><strong class="bold">Conversations</strong></span><span class="No-Break">:</span></li>
			</ol>
			<div>
				<div id="_idContainer404" class="IMG---Figure">
					<img src="image/Figure_10.10_B19448.jpg" alt="Figure 10.10 – Ethernet conversations"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.10 – Ethernet conversations</p>
			<p>As shown in the preceding snippet, Wireshark shows all the source and destination <a id="_idIndexMarker1058"/>MAC addresses, the numbers of frames, and the traffic within this <span class="No-Break">sample file.</span></p>
			<p>Next, click on <strong class="bold">IPv4</strong> to view all IP addresses that are detected within the sample file and <span class="No-Break">traffic flows:</span></p>
			<div>
				<div id="_idContainer405" class="IMG---Figure">
					<img src="image/Figure_10.11_B19448.jpg" alt="Figure 10.11 – IPv4 addresses and traffic flows"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.11 – IPv4 addresses and traffic flows</p>
			<p>Additionally, the <strong class="bold">TCP</strong> and <strong class="bold">UDP</strong> tabs show the network services and protocols of the <span class="No-Break">packet capture:</span></p>
			<div>
				<div id="_idContainer406" class="IMG---Figure">
					<img src="image/Figure_10.12_B19448.jpg" alt="Figure 10.12 – Port numbers"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.12 – Port numbers</p>
			<ol>
				<li value="10">Lastly, to view <a id="_idIndexMarker1059"/>and export files that are found within the capture file, click on <strong class="bold">File</strong> | <strong class="bold">Export Objects</strong> | <span class="No-Break"><strong class="bold">HTTP</strong></span><span class="No-Break">:</span></li>
			</ol>
			<div>
				<div id="_idContainer407" class="IMG---Figure">
					<img src="image/Figure_10.13_B19448.jpg" alt="Figure 10.13 – Objects"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.13 – Objects</p>
			<p>You have the option to select a file or all files to extract from this sample capture and save on <span class="No-Break">your desktop.</span></p>
			<p>During this section, you have gained an introduction to leveraging Wireshark to capture network traffic <a id="_idIndexMarker1060"/>as a cybersecurity professional. In the next section, you will learn how to use security tools to detect <span class="No-Break">suspicious activities.</span></p>
			<h1 id="_idParaDest-170"><a id="_idTextAnchor169"/>Monitoring and detection systems</h1>
			<p>Actively monitoring network traffic within an organization helps cybersecurity professionals to detect whether there’s a threat on their system and which systems are compromised. For instance, the security team may notice an increase in DNS queries from an internal <a id="_idIndexMarker1061"/>server that’s sending packets to an unknown DNS server on the internet. By analyzing the network traffic, it seems the internal server was compromised by malware that has established a C2 channel to a C2 server on the internet and is <a id="_idIndexMarker1062"/>using a common network protocol such as DNS to reduce its threat level and detection. Without monitoring network traffic, this security incident may have gone unnoticed and the adversary would continue to expand <span class="No-Break">their attack.</span></p>
			<p>Furthermore, cybersecurity professionals need to monitor host systems to detect potential threats at an early stage. Once a threat is found, the security team can apply immediate actions to contain and eradicate the threat before it can spread and exploit additional systems and cause more damage. The data collected during this security incident can be used to improve incident response and handling, and threat detection on <span class="No-Break">other systems.</span></p>
			<p>Many free and commercial threat monitoring and detection tools are widely available from trusted providers on the internet. However, it’s important for organizations to implement <a id="_idIndexMarker1063"/>the core tools and perform <a id="_idIndexMarker1064"/>the <span class="No-Break">core tasks:</span></p>
			<ul>
				<li><strong class="bold">Host-based Intrusion Detection </strong><span class="No-Break"><strong class="bold">Systems</strong></span><span class="No-Break"> (</span><span class="No-Break"><strong class="bold">HIDSes</strong></span><span class="No-Break">)</span></li>
				<li><strong class="bold">Network-based Intrusion Detection </strong><span class="No-Break"><strong class="bold">Systems</strong></span><span class="No-Break"> (</span><span class="No-Break"><strong class="bold">NIDSes</strong></span><span class="No-Break">)</span></li>
				<li>Network traffic and <span class="No-Break">packet analysis</span></li>
				<li><span class="No-Break">Data visualization</span></li>
			</ul>
			<p>The following are popular free and open source network security tools that help organizations monitor and <span class="No-Break">detect threats:</span></p>
			<ul>
				<li><strong class="bold">Zeek</strong> – This is <a id="_idIndexMarker1065"/>an open source network security tool that’s used to monitor and analyze <span class="No-Break">network traffic</span></li>
				<li><strong class="bold">Wazuh</strong> – This is <a id="_idIndexMarker1066"/>an open source security platform that’s used to collect and analyze data from <span class="No-Break">host devices</span></li>
				<li><strong class="bold">Suricata</strong> – This is <a id="_idIndexMarker1067"/>an open source network analysis tool that is used to monitor network traffic and provide alerts on <span class="No-Break">potential threats</span></li>
			</ul>
			<p class="callout-heading">Note</p>
			<p class="callout">You can find links on how to set up Zeek, Wazuh, and Suricata in the <em class="italic">Further </em><span class="No-Break"><em class="italic">reading</em></span><span class="No-Break"> section.</span></p>
			<p>Setting up the <a id="_idIndexMarker1068"/>preceding tools can be quite fun and is a good learning <a id="_idIndexMarker1069"/>experience to ensure each tool is working as expected and sharing data. However, it can be quite a time-consuming process, especially if there’s any troubleshooting that needs to resolve any issues along <span class="No-Break">the way.</span></p>
			<p><strong class="bold">Security Onion</strong> is an all-in-one <a id="_idIndexMarker1070"/>security platform that has Zeek, Wazuh, Suricata, and many more open source tools already installed and configured to work together to help cybersecurity professionals and security teams get up and running quickly with threat monitoring, detection, <span class="No-Break">and hunting.</span></p>
			<p>The following host-based tools can be installed on host/client devices that enable Security Onion to collect additional data <span class="No-Break">from assets:</span></p>
			<ul>
				<li><strong class="bold">Wazuh</strong> – This is <a id="_idIndexMarker1071"/>a HIDS platform on Security Onion, enabling security professionals to install the Wazuh agent on a host to collect additional data and logs <span class="No-Break">for analysis</span></li>
				<li><strong class="bold">Osquery</strong> – This is <a id="_idIndexMarker1072"/>an endpoint agent that’s installed on a host device and used for monitoring and <span class="No-Break">collecting analytics</span></li>
				<li><strong class="bold">Beats</strong> – This is <a id="_idIndexMarker1073"/>a data shipping component for Elasticsearch that’s used to collect logs and metrics from host devices and send them to Security Onion <span class="No-Break">for analysis</span></li>
			</ul>
			<p>The following are network-based tools that enable Security Onion to identify suspicious activities on <span class="No-Break">a network:</span></p>
			<ul>
				<li><strong class="bold">Google Stenographer</strong> – This tool <a id="_idIndexMarker1074"/>enables Security Onion to perform full packet capture of <span class="No-Break">network traffic</span></li>
				<li><strong class="bold">Suricata</strong> – This performs <a id="_idIndexMarker1075"/>network traffic analysis and generates alerts for <span class="No-Break">potential threats</span></li>
				<li><strong class="bold">Zeek</strong> – It provides <a id="_idIndexMarker1076"/>connection logs and metadata on network traffic and extracts files from network data for <span class="No-Break">further analysis</span></li>
				<li><strong class="bold">Strelka</strong> – This performs <a id="_idIndexMarker1077"/>file analysis to <span class="No-Break">detect threats</span></li>
			</ul>
			<p>The following are analyst tools that are used by cybersecurity professionals on <span class="No-Break">Security Onion:</span></p>
			<ul>
				<li><strong class="bold">SOC</strong> –Security <a id="_idIndexMarker1078"/>Onion Console, which provides the user access to all <span class="No-Break">other tools</span></li>
				<li><strong class="bold">Hunt</strong> – Provides <a id="_idIndexMarker1079"/>a dashboard that’s used to perform queries for <span class="No-Break">threat hunting</span></li>
				<li><strong class="bold">Kibana</strong> – Used to <a id="_idIndexMarker1080"/>provide data visualization on network traffic <span class="No-Break">and threats</span></li>
				<li><strong class="bold">Cases</strong> – Allows the <a id="_idIndexMarker1081"/>user to escalate an alert to a case for tracking the investigation during its <span class="No-Break">life cycle</span></li>
				<li><strong class="bold">CyberChef</strong> – Allows you <a id="_idIndexMarker1082"/>to decode and analyze <span class="No-Break">artifact data</span></li>
				<li><strong class="bold">Playbook</strong> – Enables <a id="_idIndexMarker1083"/>users to create detection playbooks for identifying threats based <span class="No-Break">on rules</span></li>
				<li><strong class="bold">FleetDM</strong> – Allows <a id="_idIndexMarker1084"/>you to run live and scheduled queries <span class="No-Break">on endpoints</span></li>
				<li><strong class="bold">Navigator</strong> – Provides <a id="_idIndexMarker1085"/>visualization on the MITRE <span class="No-Break">ATT&amp;CK framework</span></li>
			</ul>
			<p>When setting up Security Onion on a network, it’s important to ensure there’s a dedicated network adapter for management and another for monitoring. The management interface is used to administratively access Security Onion and leverage its pre-installed tools for monitoring and detecting threats. The monitor interface is used to collect data and <a id="_idIndexMarker1086"/>traffic from the network such as from a network tap or <strong class="bold">Switched Port Analyzer</strong> (<strong class="bold">SPAN</strong>) port on <span class="No-Break">a switch.</span></p>
			<p>The following is a simplified diagram showing the placement of <span class="No-Break">Security Onion:</span></p>
			<div>
				<div id="_idContainer408" class="IMG---Figure">
					<img src="image/Figure_10.14_B19448.jpg" alt="Figure 10.14 – Security Onion"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.14 – Security Onion</p>
			<p>As shown in the preceding diagram, the switch is configured with a mirrored or SPAN interface to send <a id="_idIndexMarker1087"/>a copy of network traffic between the <strong class="bold">Local Area Network</strong> (<strong class="bold">LAN</strong>) and the firewall to the monitor interface on Security Onion. This enables Security Onion to monitor and analyze the traffic that’s flowing between the internet and the internal network. However, a network tap needs to be implemented between the firewall <a id="_idIndexMarker1088"/>and the <strong class="bold">Demilitarized Zone</strong> (<strong class="bold">DMZ</strong>) to enable Security Onion to monitor traffic within that area of <span class="No-Break">the network.</span></p>
			<p>The following are the recommended specifications and considerations for a Security Onion <span class="No-Break">virtual environment:</span></p>
			<ul>
				<li><strong class="bold">CPU</strong>: <span class="No-Break">4 cores</span></li>
				<li><strong class="bold">Memory</strong>: 12 <span class="No-Break">GB RAM</span></li>
				<li><strong class="bold">Storage</strong>: <span class="No-Break">200 GB</span></li>
				<li><span class="No-Break">2 NICs</span></li>
			</ul>
			<p>To get started with setting up Security Onion, please use the <span class="No-Break">following instructions:</span></p>
			<h2 id="_idParaDest-171"><a id="_idTextAnchor170"/>Part 1 – setting up the environment</h2>
			<ol>
				<li>Firstly, download <a id="_idIndexMarker1089"/>the <strong class="bold">Security Onion</strong> ISO image from <a href="https://securityonionsolutions.com/software/">https://securityonionsolutions.com/software/</a> <span class="No-Break">or </span><a href="https://github.com/Security-Onion-Solutions/securityonion/blob/master/VERIFY_ISO.md"><span class="No-Break">https://github.com/Security-Onion-Solutions/securityonion/blob/master/VERIFY_ISO.md</span></a><span class="No-Break">.</span></li>
				<li>Next, open <strong class="bold">VMware Workstation Pro</strong> and click on <strong class="bold">File</strong> | <strong class="bold">New Virtual Machine…</strong> <span class="No-Break">as shown:</span></li>
			</ol>
			<div>
				<div id="_idContainer409" class="IMG---Figure">
					<img src="image/Figure_10.15_B19448.jpg" alt="Figure 10.15 – VMware Workstation"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.15 – VMware Workstation</p>
			<ol>
				<li value="3">Next, the <strong class="bold">New Virtual Machine Wizard</strong> window <a id="_idIndexMarker1090"/>will appear; select <strong class="bold">Custom (advanced)</strong> and click <span class="No-Break">on </span><span class="No-Break"><strong class="bold">Next</strong></span><span class="No-Break">:</span></li>
			</ol>
			<div>
				<div id="_idContainer410" class="IMG---Figure">
					<img src="image/Figure_10.16_B19448.jpg" alt="Figure 10.16 – Type of configuration"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.16 – Type of configuration</p>
			<ol>
				<li value="4">In the <strong class="bold">Choose the Virtual Machine Hardware Compatibility</strong> menu, use the default option and click on <span class="No-Break"><strong class="bold">Next &gt;</strong></span><span class="No-Break">:</span></li>
			</ol>
			<div>
				<div id="_idContainer411" class="IMG---Figure">
					<img src="image/Figure_10.17_B19448.jpg" alt="Figure 10.17 – Hardware compatibility"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.17 – Hardware compatibility</p>
			<ol>
				<li value="5">In <a id="_idIndexMarker1091"/>the <strong class="bold">Guest Operating System Installation</strong> window, select <strong class="bold">Browse…</strong> under <strong class="bold">Installer disc image file (iso)</strong> to attach the Security Onion ISO and then click on <span class="No-Break"><strong class="bold">Next &gt;</strong></span><span class="No-Break">:</span></li>
			</ol>
			<div>
				<div id="_idContainer412" class="IMG---Figure">
					<img src="image/Figure_10.18_B19448.jpg" alt="Figure 10.18 – Attaching the ISO file"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.18 – Attaching the ISO file</p>
			<ol>
				<li value="6">In <a id="_idIndexMarker1092"/>the <strong class="bold">Select a Guest Operating System</strong> window, select <strong class="bold">Linux</strong> and <strong class="bold">CentOS 8 64-bit</strong> and click on <span class="No-Break"><strong class="bold">Next &gt;</strong></span><span class="No-Break">:</span></li>
			</ol>
			<div>
				<div id="_idContainer413" class="IMG---Figure">
					<img src="image/Figure_10.19_B19448.jpg" alt="Figure 10.19 – Guest operating system"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.19 – Guest operating system</p>
			<ol>
				<li value="7">Next, create <a id="_idIndexMarker1093"/>a name for this new virtual machine and click on <span class="No-Break"><strong class="bold">Next &gt;</strong></span><span class="No-Break">:</span></li>
			</ol>
			<div>
				<div id="_idContainer414" class="IMG---Figure">
					<img src="image/Figure_10.20_B19448.jpg" alt="Figure 10.20 – Naming the virtual machine"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.20 – Naming the virtual machine</p>
			<ol>
				<li value="8">In the <strong class="bold">Processor Configuration</strong> window, it’s recommended to assign <strong class="bold">4</strong> CPU cores to the virtual machine; then, click on <span class="No-Break"><strong class="bold">Next &gt;</strong></span><span class="No-Break">:</span></li>
			</ol>
			<div>
				<div id="_idContainer415" class="IMG---Figure">
					<img src="image/Figure_10.21_B19448.jpg" alt="Figure 10.21 – Assigning processor cores"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.21 – Assigning processor cores</p>
			<ol>
				<li value="9">In the <strong class="bold">Memory for the Virtual Machine</strong> window, it’s recommended to assign 12 GB (<strong class="bold">12288</strong> MB) of <a id="_idIndexMarker1094"/>memory to the virtual machine and click on <span class="No-Break"><strong class="bold">Next &gt;</strong></span><span class="No-Break">:</span></li>
			</ol>
			<div>
				<div id="_idContainer416" class="IMG---Figure">
					<img src="image/Figure_10.22_B19448.jpg" alt="Figure 10.22 – Memory allocation"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.22 – Memory allocation</p>
			<ol>
				<li value="10">In the <strong class="bold">Network Type</strong> window, select <strong class="bold">Use bridged networking</strong> and click on <span class="No-Break"><strong class="bold">Next &gt;</strong></span><span class="No-Break">:</span></li>
			</ol>
			<div>
				<div id="_idContainer417" class="IMG---Figure">
					<img src="image/Figure_10.23_B19448.jpg" alt="Figure 10.23 – Network type"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.23 – Network type</p>
			<ol>
				<li value="11">Under <strong class="bold">Select I/O Controller Types</strong>, use <a id="_idIndexMarker1095"/>the default option and click on <span class="No-Break"><strong class="bold">Next &gt;</strong></span><span class="No-Break">:</span></li>
			</ol>
			<div>
				<div id="_idContainer418" class="IMG---Figure">
					<img src="image/Figure_10.24_B19448.jpg" alt="Figure 10.24 – I/O controller type"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.24 – I/O controller type</p>
			<ol>
				<li value="12">In the <strong class="bold">Select a Disk Type</strong> window, use the default option and click on <span class="No-Break"><strong class="bold">Next &gt;</strong></span><span class="No-Break">:</span></li>
			</ol>
			<div>
				<div id="_idContainer419" class="IMG---Figure">
					<img src="image/Figure_10.25_B19448.jpg" alt="Figure 10.25 – Disk type"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.25 – Disk type</p>
			<ol>
				<li value="13">In <a id="_idIndexMarker1096"/>the <strong class="bold">Select a Disk</strong> window, select <strong class="bold">Create a new virtual disk</strong> and click on <span class="No-Break"><strong class="bold">Next &gt;</strong></span><span class="No-Break">:</span></li>
			</ol>
			<div>
				<div id="_idContainer420" class="IMG---Figure">
					<img src="image/Figure_10.26_B19448.jpg" alt="Figure 10.26 – Selecting a disk option"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.26 – Selecting a disk option</p>
			<ol>
				<li value="14">In the <strong class="bold">Specify Disk Capacity</strong> window, set the maximum disk size to <strong class="bold">200.0</strong> GB, select <strong class="bold">Split virtual disk into multiple files</strong>, then click on <span class="No-Break"><strong class="bold">Next &gt;</strong></span><span class="No-Break">:</span></li>
			</ol>
			<div>
				<div id="_idContainer421" class="IMG---Figure">
					<img src="image/Figure_10.27_B19448.jpg" alt="Figure 10.27 – Disk capacity"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.27 – Disk capacity</p>
			<ol>
				<li value="15">In <a id="_idIndexMarker1097"/>the <strong class="bold">Specify Disk File</strong> window, use the default option and click on <span class="No-Break"><strong class="bold">Next &gt;</strong></span><span class="No-Break">:</span></li>
			</ol>
			<div>
				<div id="_idContainer422" class="IMG---Figure">
					<img src="image/Figure_10.28_B19448.jpg" alt="Figure 10.28 – Disk file"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.28 – Disk file</p>
			<ol>
				<li value="16">In the <strong class="bold">Ready to Create Virtual Machine</strong> window, click <span class="No-Break">on </span><span class="No-Break"><strong class="bold">Finish</strong></span><span class="No-Break">:</span></li>
			</ol>
			<div>
				<div id="_idContainer423" class="IMG---Figure">
					<img src="image/Figure_10.29_B19448.jpg" alt="Figure 10.29 – Virtual machine summary"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.29 – Virtual machine summary</p>
			<p>After <a id="_idIndexMarker1098"/>clicking on <strong class="bold">Finish</strong>, the virtual machine environment will automatically be saved within <span class="No-Break">VMware Workstation.</span></p>
			<h2 id="_idParaDest-172"><a id="_idTextAnchor171"/>Part 2 – attaching an additional network adapter</h2>
			<ol>
				<li>Within <strong class="bold">VMware Workstation</strong>, select <a id="_idIndexMarker1099"/>the <strong class="bold">Security Onion</strong> virtual machine and click on <strong class="bold">Edit virtual machine settings</strong> <span class="No-Break">as shown:</span></li>
			</ol>
			<div>
				<div id="_idContainer424" class="IMG---Figure">
					<img src="image/Figure_10.30_B19448.jpg" alt="Figure 10.30 – Virtual machine"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.30 – Virtual machine</p>
			<ol>
				<li value="2">In <a id="_idIndexMarker1100"/>the <strong class="bold">Virtual Machine Settings</strong> menu, click <span class="No-Break">on </span><span class="No-Break"><strong class="bold">Add…</strong></span><span class="No-Break">:</span></li>
			</ol>
			<div>
				<div id="_idContainer425" class="IMG---Figure">
					<img src="image/Figure_10.31_B19448.jpg" alt="Figure 10.31 – Virtual Machine Settings menu"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.31 – Virtual Machine Settings menu</p>
			<ol>
				<li value="3">In the <strong class="bold">Add Hardware Wizard</strong> menu, select <strong class="bold">Network Adapter</strong> and click <span class="No-Break">on </span><span class="No-Break"><strong class="bold">Finish</strong></span><span class="No-Break">:</span></li>
			</ol>
			<div>
				<div id="_idContainer426" class="IMG---Figure">
					<img src="image/Figure_10.32_B19448.jpg" alt="Figure 10.32 – Add Hardware Wizard"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.32 – Add Hardware Wizard</p>
			<ol>
				<li value="4">Next, you’ll <a id="_idIndexMarker1101"/>return to the <strong class="bold">Virtual Machine Settings</strong> window, select <strong class="bold">Network Adapter 2</strong>, choose <strong class="bold">Bridged: Connected directly to the physical network</strong> mode, and click <span class="No-Break">on </span><span class="No-Break"><strong class="bold">OK</strong></span><span class="No-Break">:</span></li>
			</ol>
			<div>
				<div id="_idContainer427" class="IMG---Figure">
					<img src="image/Figure_10.33_B19448.jpg" alt="Figure 10.33 – Network connection type"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.33 – Network connection type</p>
			<p>This <a id="_idIndexMarker1102"/>network adapter will be used as the monitor interface in <span class="No-Break">Security Onion.</span></p>
			<ol>
				<li value="5">To ensure your physical network adapter is associated with the bridge connection on VMware Workstation, on the menu bar, click on <strong class="bold">Edit</strong> &gt; <strong class="bold">Virtual Network Editor</strong> &gt; <strong class="bold">Change Settings</strong> <span class="No-Break">as shown:</span></li>
			</ol>
			<div>
				<div id="_idContainer428" class="IMG---Figure">
					<img src="image/Figure_10.34_B19448.jpg" alt="Figure 10.34 – Network editor"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.34 – Network editor</p>
			<p>As shown <a id="_idIndexMarker1103"/>in the preceding snippet, <strong class="bold">VMnet0</strong> is the <strong class="bold">Bridged</strong> network adapter; ensure it’s bridged to your physical network adapter on your <span class="No-Break">host machine.</span></p>
			<h2 id="_idParaDest-173"><a id="_idTextAnchor172"/>Part 3 – installing Security Onion</h2>
			<ol>
				<li value="1">In VMware <a id="_idIndexMarker1104"/>Workstation, select the <strong class="bold">Security Onion</strong> virtual machine and power on this <span class="No-Break">virtual machine.</span></li>
				<li>Next, the Security Onion installation menu will appear; use the default option and <span class="No-Break">hit </span><span class="No-Break"><em class="italic">Enter</em></span><span class="No-Break">:</span></li>
			</ol>
			<div>
				<div id="_idContainer429" class="IMG---Figure">
					<img src="image/Figure_10.35_B19448.jpg" alt="Figure 10.35 – Security Onion installation type"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.35 – Security Onion installation type</p>
			<ol>
				<li value="3">Next, the installation <a id="_idIndexMarker1105"/>wizard will appear; hit <em class="italic">Enter</em> to begin the <span class="No-Break">initialization process:</span></li>
			</ol>
			<div>
				<div id="_idContainer430" class="IMG---Figure">
					<img src="image/Figure_10.36_B19448.jpg" alt="Figure 10.36 – Starting the installation"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.36 – Starting the installation</p>
			<ol>
				<li value="4">Next, type <strong class="source-inline">yes</strong> to continue and create a user account <span class="No-Break">as shown:</span></li>
			</ol>
			<div>
				<div id="_idContainer431" class="IMG---Figure">
					<img src="image/Figure_10.37_B19448.jpg" alt="Figure 10.37 – Installing Security Onion"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.37 – Installing Security Onion</p>
			<p>The username and password created in this step are used to log in to the <span class="No-Break">console only.</span></p>
			<ol>
				<li value="5">Next, the installation <a id="_idIndexMarker1106"/>of the base operating system and software packages will start. This process will take a few minutes and the virtual machine will automatically reboot <span class="No-Break">when finished.</span></li>
			</ol>
			<h2 id="_idParaDest-174"><a id="_idTextAnchor173"/>Part 4 – configuring networking in Security Onion</h2>
			<ol>
				<li value="1">After the <a id="_idIndexMarker1107"/>Security Onion virtual machine reboots, log in using the username and password you created in the previous steps. The <strong class="bold">Security Onion Setup</strong> wizard will appear on the Terminal/Console; using the direction keys (arrows) on your keyboard to select <strong class="bold">&lt;Yes&gt;</strong> and <span class="No-Break">hit </span><span class="No-Break"><em class="italic">Enter</em></span><span class="No-Break">:</span></li>
			</ol>
			<div>
				<div id="_idContainer432" class="IMG---Figure">
					<img src="image/Figure_10.38_B19448.jpg" alt="Figure 10.38 – Security Onion Setup"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.38 – Security Onion Setup</p>
			<ol>
				<li value="2">Next, click <strong class="bold">Install</strong> to start <a id="_idIndexMarker1108"/>the standard installation of <span class="No-Break">Security Onion:</span></li>
			</ol>
			<div>
				<div id="_idContainer433" class="IMG---Figure">
					<img src="image/Figure_10.39_B19448.jpg" alt="Figure 10.39 – Selecting a setup option"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.39 – Selecting a setup option</p>
			<p>As shown in the preceding figure, you have the choice to proceed with the installation and setup or configure the network addresses and settings in <span class="No-Break">Security Onion.</span></p>
			<ol>
				<li value="3">Next, using the down arrow key on your keyboard, select <strong class="bold">STANDALONE</strong>, press the spacebar to place an asterisk (<strong class="source-inline">*</strong>), and then <span class="No-Break">hit </span><span class="No-Break"><em class="italic">Enter</em></span><span class="No-Break">:</span></li>
			</ol>
			<div>
				<div id="_idContainer434" class="IMG---Figure">
					<img src="image/Figure_10.40_B19448.jpg" alt="Figure 10.40 – Installation type"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.40 – Installation type</p>
			<ol>
				<li value="4">Next, you will <a id="_idIndexMarker1109"/>need to type <strong class="source-inline">agree</strong> within the input field to accept the terms and agreement to use Elastic Stack within Security Onion and then <span class="No-Break">hit </span><span class="No-Break"><em class="italic">Enter</em></span><span class="No-Break">:</span></li>
			</ol>
			<div>
				<div id="_idContainer435" class="IMG---Figure">
					<img src="image/Figure_10.41_B19448.jpg" alt="Figure 10.41 – Elastic Stack license agreement"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.41 – Elastic Stack license agreement</p>
			<ol>
				<li value="5">Next, insert a hostname for the Security Onion virtual machine and <span class="No-Break">hit </span><span class="No-Break"><em class="italic">Enter</em></span><span class="No-Break">:</span></li>
			</ol>
			<div>
				<div id="_idContainer436" class="IMG---Figure">
					<img src="image/Figure_10.42_B19448.jpg" alt="Figure 10.42 – Setting a hostname"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.42 – Setting a hostname</p>
			<ol>
				<li value="6">Next, you’ll be <a id="_idIndexMarker1110"/>provided with an option to insert a description for this instance of Security Onion. This is optional but recommended if you’re doing a distributed installation in a network. Since we’re doing a standalone setup, leave it as the default and <span class="No-Break">hit </span><span class="No-Break"><em class="italic">Enter</em></span><span class="No-Break">:</span></li>
			</ol>
			<div>
				<div id="_idContainer437" class="IMG---Figure">
					<img src="image/Figure_10.43_B19448.jpg" alt="Figure 10.43 – The description window"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.43 – The description window</p>
			<ol>
				<li value="7">Next, select the first network adapter as the management NIC in Security Onion and <span class="No-Break">hit </span><span class="No-Break"><em class="italic">Enter</em></span><span class="No-Break">:</span></li>
			</ol>
			<div>
				<div id="_idContainer438" class="IMG---Figure">
					<img src="image/Figure_10.44_B19448.jpg" alt="Figure 10.44 – Management interface"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.44 – Management interface</p>
			<ol>
				<li value="8">Next, you are <a id="_idIndexMarker1111"/>provided with the option to statically assign an IP address to the management interface or dynamically <a id="_idIndexMarker1112"/>receive an address from the <strong class="bold">Dynamic Host Configuration Server</strong> (<strong class="bold">DHCP</strong>) server on the network. Select <strong class="bold">STATIC</strong> and <span class="No-Break">hit </span><span class="No-Break"><em class="italic">Enter</em></span><span class="No-Break">:</span></li>
			</ol>
			<div>
				<div id="_idContainer439" class="IMG---Figure">
					<img src="image/Figure_10.45_B19448.jpg" alt="Figure 10.45 – Management interface setup"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.45 – Management interface setup</p>
			<ol>
				<li value="9">Next, enter an unused/unallocated IP address and network prefix from your network and <span class="No-Break">hit </span><span class="No-Break"><em class="italic">Enter</em></span><span class="No-Break">:</span></li>
			</ol>
			<div>
				<div id="_idContainer440" class="IMG---Figure">
					<img src="image/Figure_10.46_B19448.jpg" alt="Figure 10.46 – Setting a network address"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.46 – Setting a network address</p>
			<ol>
				<li value="10">Next, insert <a id="_idIndexMarker1113"/>your default gateway address and <span class="No-Break">hit </span><span class="No-Break"><em class="italic">Enter</em></span><span class="No-Break">:</span></li>
			</ol>
			<div>
				<div id="_idContainer441" class="IMG---Figure">
					<img src="image/Figure_10.47_B19448.jpg" alt="Figure 10.47 – Default gateway address"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.47 – Default gateway address</p>
			<ol>
				<li value="11">Next, Google’s DNS server addresses are automatically set; you can leave them as the default or change them if needed and <span class="No-Break">hit </span><span class="No-Break"><em class="italic">Enter</em></span><span class="No-Break">:</span></li>
			</ol>
			<div>
				<div id="_idContainer442" class="IMG---Figure">
					<img src="image/Figure_10.48_B19448.jpg" alt="Figure 10.48 – DNS server settings"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.48 – DNS server settings</p>
			<ol>
				<li value="12">Next, create <a id="_idIndexMarker1114"/>a DNS search domain and <span class="No-Break">hit </span><span class="No-Break"><em class="italic">Enter</em></span><span class="No-Break">:</span></li>
			</ol>
			<div>
				<div id="_idContainer443" class="IMG---Figure">
					<img src="image/Figure_10.49_B19448.jpg" alt="Figure 10.49 – Setting a search domain"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.49 – Setting a search domain</p>
			<ol>
				<li value="13">Next, hit <em class="italic">Enter</em> to confirm the <span class="No-Break">setup process:</span></li>
			</ol>
			<div>
				<div id="_idContainer444" class="IMG---Figure">
					<img src="image/Figure_10.50_B19448.jpg" alt="Figure 10.50 – Confirmation"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.50 – Confirmation</p>
			<ol>
				<li value="14">Lastly, the setup process will take a few minutes to complete. Once completed, the Security Onion virtual machine will automatically reboot. Then, log in and use the following command to check the status of each process <span class="No-Break">and container:</span><pre class="source-code">
[glen@soc ~]$ <strong class="bold">sudo so-status</strong></pre></li>
			</ol>
			<p>After a <a id="_idIndexMarker1115"/>few minutes, all the processes and containers will be running as shown in the <span class="No-Break">following snippet:</span></p>
			<div>
				<div id="_idContainer445" class="IMG---Figure">
					<img src="image/Figure_10.51_B19448.jpg" alt="Figure 10.51 – Verifying the status"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.51 – Verifying the status</p>
			<p>Ensure all containers and processes are running and OK before proceeding to the <span class="No-Break">next phase.</span></p>
			<h2 id="_idParaDest-175"><a id="_idTextAnchor174"/>Part 5 – detecting suspicious activities</h2>
			<ol>
				<li value="1">To access <a id="_idIndexMarker1116"/>the Security Onion user interface and leverage the security tools, open your web browser and go to <span class="hidden">https://&lt;ip-address-security-onion&gt;</span>. Here, you will create a user account to log in and access the security tools within Security Onion. This account will be used to access all the tools in <span class="No-Break">Security Onion.</span></li>
			</ol>
			<p class="callout-heading">Tip</p>
			<p class="callout">To find the IP address of the Security Onion virtual machine, login to its console and execute the <strong class="source-inline">ifconfig</strong> or <strong class="source-inline">ip address</strong> command to view the IP address on the <span class="No-Break">management interface.</span></p>
			<ol>
				<li value="2">Once you’ve <a id="_idIndexMarker1117"/>logged in, you’ll see the main dashboard. Click on <strong class="bold">Alerts</strong> to see any security events and potential threats that have <span class="No-Break">been detected:</span></li>
			</ol>
			<div>
				<div id="_idContainer446" class="IMG---Figure">
					<img src="image/Figure_10.52_B19448.jpg" alt="Figure 10.52 – Security alerts"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.52 – Security alerts</p>
			<p>As shown in the preceding snippet, Suricata identified a potential threat with high severity and provided the name of the rule that was used for detection. Furthermore, Suricata recorded 136 counts (events) for <span class="No-Break">this alert.</span></p>
			<ol>
				<li value="3">To view all related events for an alert, click on the alert name to open the drop-down menu and select <strong class="bold">Drilldown</strong> <span class="No-Break">as shown:</span></li>
			</ol>
			<div>
				<div id="_idContainer447" class="IMG---Figure">
					<img src="image/Figure_10.53_B19448.jpg" alt="Figure 10.53 – Alert options"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.53 – Alert options</p>
			<p>Next, Security Onion will show a list of each count (event) for the alert while providing <a id="_idIndexMarker1118"/>the timestamps, detection rules, severity levels, source IP addresses, and source port numbers <span class="No-Break">as shown:</span></p>
			<div>
				<div id="_idContainer448" class="IMG---Figure">
					<img src="image/Figure_10.54_B19448.jpg" alt="Figure 10.54 – Viewing alerts"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.54 – Viewing alerts</p>
			<p>The information shown in the preceding snippet helps cybersecurity professionals to identify the source of the threat and the sequence of events that occurred using <span class="No-Break">the timestamps.</span></p>
			<ol>
				<li value="4">Next, click on one of the events to view event data such as its source and destination IP addresses and port numbers, the security sensor that triggered the alert, the <a id="_idIndexMarker1119"/>event severity, and a message that contains specific details about the threat, <span class="No-Break">as shown:</span></li>
			</ol>
			<div>
				<div id="_idContainer449" class="IMG---Figure">
					<img src="image/Figure_10.55_B19448.jpg" alt="Figure 10.55 – Viewing alert data"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.55 – Viewing alert data</p>
			<p>The <strong class="bold">message</strong> field contains the following information, which can be used by cybersecurity professionals to better understand <span class="No-Break">the event:</span></p>
			<ul>
				<li>The time and date of <span class="No-Break">the event</span></li>
				<li>The monitoring interface in Security Onion which detected <span class="No-Break">the event</span></li>
				<li>The source and destination <span class="No-Break">IP addresses</span></li>
				<li>The source and destination <span class="No-Break">port numbers</span></li>
				<li>The signature that was found to trigger <span class="No-Break">the event</span></li>
				<li>A description of the <span class="No-Break">potential threat</span></li>
			</ul>
			<ol>
				<li value="5">To determine the trajectory of the threat and correlate all related events, click on an event and select <strong class="bold">Correlate</strong> <span class="No-Break">as shown:</span></li>
			</ol>
			<div>
				<div id="_idContainer450" class="IMG---Figure">
					<img src="image/Figure_10.56_B19448.jpg" alt="Figure 10.56 – Correlating events"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.56 – Correlating events</p>
			<p>Next, Security <a id="_idIndexMarker1120"/>Onion will provide a correlation of all events that belong to the same alert <span class="No-Break">as shown:</span></p>
			<div>
				<div id="_idContainer451" class="IMG---Figure">
					<img src="image/Figure_10.57_B19448.jpg" alt="Figure 10.57 – Correlation of events"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.57 – Correlation of events</p>
			<p>Additionally, clicking on an alert will provide the option to escalate an alert to a case. This case can be used by a security analyst to track the event while performing <span class="No-Break">further analysis:</span></p>
			<div>
				<div id="_idContainer452" class="IMG---Figure">
					<img src="image/Figure_10.58_B19448.jpg" alt="Figure 10.58 – Creating a case"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.58 – Creating a case</p>
			<ol>
				<li value="6">Next, click on the <strong class="bold">Hunt</strong> category to view all network traffic that’s associated with the <a id="_idIndexMarker1121"/>threat. Then, click on a traffic flow from the list to open the additional menu and select <strong class="bold">PCAP</strong> to view the <span class="No-Break">packet contents:</span></li>
			</ol>
			<div>
				<div id="_idContainer453" class="IMG---Figure">
					<img src="image/Figure_10.59_B19448.jpg" alt="Figure 10.59 – Traffic flow"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.59 – Traffic flow</p>
			<p>Next, Security <a id="_idIndexMarker1122"/>Onion will provide a list of network packets for the selected flow <span class="No-Break">as shown:</span></p>
			<div>
				<div id="_idContainer454" class="IMG---Figure">
					<img src="image/Figure_10.60_B19448.jpg" alt="Figure 10.60 – Network packets per flow"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.60 – Network packets per flow</p>
			<p>Clicking on the <strong class="bold">Expand and Detailed</strong> icon will display the details within each packet <span class="No-Break">as shown:</span></p>
			<div>
				<div id="_idContainer455" class="IMG---Figure">
					<img src="image/Figure_10.61_B19448.jpg" alt="Figure 10.61 – View packet details"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.61 – View packet details</p>
			<p>To export <a id="_idIndexMarker1123"/>the packet capture file for offline analysis, click on the <span class="No-Break">download icon.</span></p>
			<ol>
				<li value="7">The <strong class="bold">Dashboards</strong> category shows a summary of all events and alerts that were detected using Security Onion <span class="No-Break">as shown:</span></li>
			</ol>
			<div>
				<div id="_idContainer456" class="IMG---Figure">
					<img src="image/Figure_10.62_B19448.jpg" alt="Figure 10.62 – Dashboards"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.62 – Dashboards</p>
			<ol>
				<li value="8">To collect <a id="_idIndexMarker1124"/>security intelligence from hosts on the network, you can download and install <strong class="bold">Wazuh Agents</strong> from the <strong class="bold">Downloads</strong> page <span class="No-Break">as shown:</span></li>
			</ol>
			<div>
				<div id="_idContainer457" class="IMG---Figure">
					<img src="image/Figure_10.63_B19448.jpg" alt="Figure 10.63 – Wazuh Agents"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.63 – Wazuh Agents</p>
			<ol>
				<li value="9">For data visualization on all alerts and threats detected by Security Onion, click on <strong class="bold">Tools</strong> | <strong class="bold">Kibana</strong> and log in using your account. The following snippet shows the default <span class="No-Break">Kibana dashboard:</span></li>
			</ol>
			<div>
				<div id="_idContainer458" class="IMG---Figure">
					<img src="image/Figure_10.64_B19448.jpg" alt="Figure 10.64 – Kibana dashboard"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.64 – Kibana dashboard</p>
			<p>As shown <a id="_idIndexMarker1125"/>in the preceding snippet, the Kibana dashboard provides cybersecurity professionals with an overall view of events and incidents, enabling a security analyst to drill down further into the activity <span class="No-Break">during analysis.</span></p>
			<ol>
				<li value="10">To view all network connections and traffic flows, click on <strong class="bold">Security Onion</strong> | <strong class="bold">Dataset</strong> | <strong class="bold">conn</strong> <span class="No-Break">as shown:</span></li>
			</ol>
			<div>
				<div id="_idContainer459" class="IMG---Figure">
					<img src="image/Figure_10.65_B19448.jpg" alt="Figure 10.65 – Datasets"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.65 – Datasets</p>
			<p>The connections dashboard will appear, enabling you to click on IP addresses and port <a id="_idIndexMarker1126"/>numbers to gain additional information <span class="No-Break">as shown:</span></p>
			<div>
				<div id="_idContainer460" class="IMG---Figure">
					<img src="image/Figure_10.66_B19448.jpg" alt="Figure 10.66 – Connections dashboard"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.66 – Connections dashboard</p>
			<ol>
				<li value="11">Expand the left-hidden menu and click on <strong class="bold">Analytics</strong> to access more data visualization tools <span class="No-Break">within Kibana:</span></li>
			</ol>
			<div>
				<div id="_idContainer461" class="IMG---Figure">
					<img src="image/Figure_10.67_B19448.jpg" alt="Figure 10.67 – Analytics menu"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.67 – Analytics menu</p>
			<p>The <strong class="bold">Discover</strong> dashboard helps you determine when an event has been detected <a id="_idIndexMarker1127"/>and how often it is occurring, <span class="No-Break">as shown:</span></p>
			<div>
				<div id="_idContainer462" class="IMG---Figure">
					<img src="image/Figure_10.68_B19448.jpg" alt="Figure 10.68 – Discovery"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.68 – Discovery</p>
			<p>Lastly, <strong class="bold">Visualize Library</strong> provides the option to create custom dashboards or use the existing dashboards to view specific details <span class="No-Break">as shown:</span></p>
			<div>
				<div id="_idContainer463" class="IMG---Figure">
					<img src="image/Figure_10.69_B19448.jpg" alt="Figure 10.69 – Visualize Library"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.69 – Visualize Library</p>
			<p>Be sure to <a id="_idIndexMarker1128"/>explore all the features and dashboards within Security Onion, as it uses many open source security tools to help cybersecurity professionals to monitor their network infrastructure to identify potential threats on <span class="No-Break">their systems.</span></p>
			<p>Having completed this section, you have learned how to set up and use Security Onion and its tools to monitor a network and identify <span class="No-Break">potential threats.</span></p>
			<h1 id="_idParaDest-176"><a id="_idTextAnchor175"/>Summary</h1>
			<p>Over the course of this chapter, you gained the skills and hands-on experience in using Wireshark to perform packet analysis to identify potentially malicious traffic, and learned how to set up and use Security Onion to monitor and detect potential threats in <span class="No-Break">a network.</span></p>
			<p>Lastly, I know the journey of becoming a cybersecurity professional, such as an ethical hacker and penetration tester, has many challenges; there are so many new things to learn and keeping up to date with the ever-changing cyber-threat landscape can be tough. These challenges will help you expand your potential and become an industry expert in your field of study and carry you along the path to success, as long as there’s a balance of prioritization, focus, dedication, and <span class="No-Break">time management.</span></p>
			<p>I would personally like to thank you very much for your support in purchasing a copy of my book and congratulations on making it to the end and acquiring all these amazing new skills in performing reconnaissance as an ethical hacker. I do hope everything you have learned throughout this book has been informative for you and helpful in your journey to becoming super-awesome in the cybersecurity industry <span class="No-Break">and beyond.</span></p>
			<h1 id="_idParaDest-177"><a id="_idTextAnchor176"/>Further reading</h1>
			<ul>
				<li>Wireshark documentation – <a href="https://www.wireshark.org/docs/"><span class="No-Break">https://www.wireshark.org/docs/</span></a></li>
				<li>Security Onion documentation – <a href="https://docs.securityonion.net/en/2.3/index.html"><span class="No-Break">https://docs.securityonion.net/en/2.3/index.html</span></a></li>
				<li>Setting up Zeek – <a href="https://docs.zeek.org/en/master/"><span class="No-Break">https://docs.zeek.org/en/master/</span></a></li>
				<li>Setting up Suricata – <a href="https://suricata.io/documentation/"><span class="No-Break">https://suricata.io/documentation/</span></a></li>
				<li>Setting up Wazuh – <a href="https://documentation.wazuh.com/current/index.html"><span class="No-Break">https://documentation.wazuh.com/current/index.html</span></a></li>
			</ul>
		</div>
	</body></html>