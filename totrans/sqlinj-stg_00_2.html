<html><head></head><body>
		<div id="_idContainer016">
			<p><a id="_idTextAnchor019"/></p>
			<h1 id="_idParaDest-18"><a id="_idTextAnchor020"/><em class="italic">Chapter 1</em>: Structured Query Language for SQL Injection</h1>
			<p>Today's world relies on the concept of cyberspace every day: the internet allows people all around the globe to connect to computers in any part of the world. This enables instant fruition of many services that rely on a plethora of technologies, protocols, and mechanisms that constitute the basis for whatever is available on the World Wide Web. Unfortunately, the theme of security is relevant for this intricate web of connections and services in the same way it is for the real world. </p>
			<p>Malicious agents perform attacks against computers worldwide every day, mostly just for personal gain or advantage. By exploiting online applications and services, in fact, it may be possible to gain control of computers or entire networks, thereby taking advantage of specific of the intrinsic vulnerabilities of some technologies, protocols, frameworks, or just applications. One of the most common – and notorious – ways to do so is through SQL injection, which is a specific type of attack that tries to exploit the syntax of a language used in databases – <strong class="bold">SQL</strong>, which stands for <strong class="bold">Structured Query Language</strong> – in order to access otherwise unobtainable information present on a database, including the ones responsible for account authentication, which contain usernames and passwords used to access services. Despite being a well-known attack, vulnerable applications are still present today, hinting to the fact that, sometimes, security in the context of application development is not considered enough.</p>
			<p>This book aims to give insight on the matter of SQL injection by explaining what it is all about both in terms of theory and practice. </p>
			<p>This chapter serves as a theoretical introduction to the matter, describing at a high-level what SQL is, what it is used for, and its possible weaknesses that lead to SQL injection. This theoretical overview is crucial in order to understand the concepts behind SQL injection that will be further explored in the next chapter.</p>
			<p>After introducing the concepts of databases, database management systems and models, queries, and SQL specifically, aspects of syntax and logic will be covered, quickly showing the main constructs and items that can lead to security weaknesses in the use of SQL, ultimately leading to the core matter: SQL injection.</p>
			<p>In this chapter, the following topics will be covered:</p>
			<ul>
				<li><strong class="bold">An overview of SQL – a relational query language</strong>: A preliminary overview of SQL, our main language of reference that SQL injection is traditionally based on, and the relational model versus other DBMS models.</li>
				<li><strong class="bold">Syntax and logic of SQL</strong>: An explanation of the main concepts and constructs behind SQL, some of which could be exploited by malicious attackers.</li>
				<li><strong class="bold">Security implications of SQL</strong>: A brief introduction to the concept of security in SQL and its use in applications.</li>
				<li><strong class="bold">Weakness in the use of SQL</strong>: An explanation of the main pitfalls an application relying on SQL can have, highlighting some general advice in secure development.</li>
			</ul>
			<h1 id="_idParaDest-19"><a id="_idTextAnchor021"/>Technical requirements</h1>
			<p>For this chapter and the next, the topics we will cover will mostly be theoretical. However, we suggest that you read the SQL technical documentation. Here, we have provided, for reference, the MySQL, Oracle, and Microsoft SQL Server documentation:</p>
			<ul>
				<li><a href="https://dev.mysql.com/doc/refman/8.0/en/">https://dev.mysql.com/doc/refman/8.0/en/</a></li>
				<li><a href="https://docs.oracle.com/en/database/oracle/oracle-database/index.html">https://docs.oracle.com/en/database/oracle/oracle-database/index.html</a></li>
				<li><a href="https://docs.microsoft.com/en-us/sql/sql-server/?view=sql-server-ver15">https://docs.microsoft.com/en-us/sql/sql-server/?view=sql-server-ver15</a></li>
			</ul>
			<h1 id="_idParaDest-20"><a id="_idTextAnchor022"/>An overview of SQL – a relational query language</h1>
			<p>One of the most common ways to keep data memorized in computer systems is by relying on <strong class="bold">databases</strong>. Databases <a id="_idIndexMarker000"/>can be seen as large <a id="_idIndexMarker001"/>software containers that can hold lots of information in a structured and accessible way, in order to optimize how to store data and access their operations.</p>
			<p>Depending on the approach and model used, the way in which this is achieved can vary in terms of implementation. One of the most common ways is to use the relational model, which is based on relational algebra, for which data is a collected as a series of records that describe the relationships that exist among objects. SQL is a query language that is based on such concepts, and it is widely adopted in many database systems. This section will deal with these topics in depth by first explaining database management systems, relational databases, and SQL.</p>
			<h2 id="_idParaDest-21"><a id="_idTextAnchor023"/>Database management systems and relational databases</h2>
			<p>The implementation of a database, as we mentioned earlier, relies on an underlying system, or a <strong class="bold">database nanagement system</strong> (<strong class="bold">DBMS</strong>). A DBMS is basically a piece of software responsible <a id="_idIndexMarker002"/>for storing, accessing, manipulating and, in general, managing data through a specific definition of the collected and managed information. </p>
			<p>For <a id="_idIndexMarker003"/>the purpose of this book, we will now divide database systems into two large families to better understand <a id="_idIndexMarker004"/>the differences between them. We can distinguish between database models in terms of relational databases and non-relational databases due to the relevance of the relational model in data management.</p>
			<h3>Relational databases</h3>
			<p>Relational databases have been widely considered as a standard due to their many advantages. Data is collected in tables, in which rows represent objects, memorized as records, and columns <a id="_idIndexMarker005"/>represent their attributes. The name is derived from the way in which data can be correlated and connected, that is, through relations based on common attributes among tables. Thus, the concept of relational algebra becomes relevant as it describes the way in which, through a structured procedural language, data tables can be managed. SQL is the most popular representative of this model as it takes advantage of most of the concepts of relational algebra, thus providing a model that is easy to use by anyone without any coding experience, while maintaining its overall efficiency:</p>
			<div>
				<div id="_idContainer007" class="IMG---Figure">
					<img src="image/B15632_01_001.jpg" alt="Figure 1.1 – A simple relational schema made up of three tables describing cars and owners, with the IDs (unique) put into a relationship&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 1.1 – A simple relational schema made up of three tables describing cars and owners, with the IDs (unique) put into a relationship</p>
			<h3>Non-relational databases</h3>
			<p><strong class="bold">No-rel</strong>, which stands for <strong class="bold">non-relational</strong>, databases are a family of DBMS models considered as an alternative to the relational model and are usually much more prominent among database systems. Originally, the term NoSQL was used to define this family of systems, but it was <a id="_idIndexMarker006"/>considered misleading: some of the first attempts at building non-relational databases actually used some concepts of the relational model. No-rel databases include many models, some of which are as follows:</p>
			<ul>
				<li><strong class="bold">Network databases</strong> model <a id="_idIndexMarker007"/>the data as connected nodes in a network: </li>
			</ul>
			<div>
				<div id="_idContainer008" class="IMG---Figure">
					<img src="image/B15632_01_002.jpg" alt="Figure 1.2 – A simple network schema to represent ownership relations between owners and cars&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 1.2 – A simple network schema to represent ownership relations between owners and cars</p>
			<ul>
				<li><strong class="bold">Graph-based databases</strong> highlight <a id="_idIndexMarker008"/>the connections among data using a graph-like navigable structure: </li>
			</ul>
			<div>
				<div id="_idContainer009" class="IMG---Figure">
					<img src="image/B15632_01_003.jpg" alt="Figure 1.3 – The same ownership relation as in the relational example, this time represented in a graph-based model schema&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 1.3 – The same ownership relation as in the relational example, this time represented in a graph-based model schema</p>
			<ul>
				<li><strong class="bold">Object-oriented databases</strong> model <a id="_idIndexMarker009"/>data as objects, in a similar fashion as in programming languages such as Java: </li>
			</ul>
			<div>
				<div id="_idContainer010" class="IMG---Figure">
					<img src="image/B15632_01_004.jpg" alt="Figure 1.4 – The ownership relationship represented in an object-oriented model schema&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 1.4 – The ownership relationship represented in an object-oriented model schema</p>
			<ul>
				<li><strong class="bold">Document-based databases</strong> describe data within documents containing key-value pairs, specify the way in which data is memorized and managed, and provide a flexible <a id="_idIndexMarker010"/>approach that does not rely on a defined schema. Document-based models can usually include embedded objects as collections within a single key, as shown in the following image:</li>
			</ul>
			<div>
				<div id="_idContainer011" class="IMG---Figure">
					<img src="image/B15632_01_005.jpg" alt="Figure 1.5 – A document-based model schema that can represent the ownership relationship&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 1.5 – A document-based model schema that can represent the ownership relationship</p>
			<p>Despite <a id="_idIndexMarker011"/>the name, SQL injection, in some form or another, might affect all existing database models. We will now focus on relational databases and SQL.</p>
			<h2 id="_idParaDest-22"><a id="_idTextAnchor024"/>SQL – Structured Query Language</h2>
			<p>SQL stands for Structured Query Language, and it is the main tool used to access, navigate, and manage <a id="_idIndexMarker012"/>a relational database. SQL provides a well-structured language that is easy to understand, thanks to its natural language-like commands and the clarity of the operations it executes corresponding to specific language strings, which will be described in the following sections.</p>
			<p>SQL has many different implementations, depending on the system it resides on, with some slight differences, some of which will be explained in the next chapter in more detail, as they are directly relevant for the SQL injection attack. Let's take a look at the most popular SQL implementations.</p>
			<h3>MySQL </h3>
			<p>MySQL is an open source version of SQL that's used in many web application frameworks and famous <a id="_idIndexMarker013"/>websites. It is considered one of the main representatives of SQL technologies, as well as an overall well-performing implementation.</p>
			<p>MySQL is <a id="_idIndexMarker014"/>considered probably the best implementation in terms of open source SQL engines, and it is often taken as a reference for SQL syntax in general.</p>
			<p>Here, we will list some peculiarities to remember about MySQL.</p>
			<p>There is more than one way to insert comments in terms of character sequences: </p>
			<ul>
				<li><strong class="source-inline">#</strong></li>
				<li><strong class="source-inline">/*comment*/</strong></li>
				<li><strong class="source-inline">--</strong> (This requires a blank space followed by any character in order to be interpreted as a comment. In practical tests, we use the combination <strong class="source-inline">-- -</strong>.)</li>
				<li><strong class="source-inline">;%00</strong> (<strong class="source-inline">%00</strong> is the null character, here shown in URL encoding. This is an unofficial method for inserting comments as it's not shown in the official documentation.)</li>
				<li><strong class="source-inline">`</strong> (Reverse single quote, another unofficial method.)</li>
			</ul>
			<p>In general, MySQL systems have two default databases that are always present in the schema:</p>
			<ul>
				<li><strong class="source-inline">mysql</strong> (only available to privileged users)</li>
				<li><strong class="source-inline">information_schema</strong> (only available from MySQL version 5 onward)</li>
			</ul>
			<p>MySQL supports functions and variables such as <strong class="source-inline">VERSION()</strong> and <strong class="source-inline">@@VERSION</strong> to retrieve MySQL server versioning.</p>
			<h3>SQLite</h3>
			<p>SQLite provides a different approach by presenting an implementation that is directly embedded <a id="_idIndexMarker015"/>in the application code, without the client-server architecture being used. While it is recommended for lightweight applications, such as mobile apps, it may have <a id="_idIndexMarker016"/>some shortcomings due to some intrinsic simplifications.</p>
			<p>The main peculiarity about SQLite is that it stores information within a SQLite database file, without requiring the client-server infrastructure. Thus, being standalone, it's best not to use it for sensitive operations, such as authentication, or, in general, storing sensitive information: anyone with access to the filesystem can easily get a full view of the database.</p>
			<h3>Oracle Database </h3>
			<p>Oracle Database, often referred to as just Oracle, is one of the main proprietary SQL systems. Despite being <a id="_idIndexMarker017"/>born as a SQL relational DBMS, it started supporting different models over time. Thus, it is considered a multi-model DBMS.</p>
			<p>In terms of <a id="_idIndexMarker018"/>proprietary database systems, Oracle is the most popular model among enterprises thanks to its wide compatibility with many technologies, programming languages, and database models.</p>
			<p>Like MySQL, Oracle Database also has some peculiarities you need to remember in terms of database structure and syntax.</p>
			<p>Unlike other database systems, Oracle Database supports only one way to insert comments in terms of character sequences: <strong class="source-inline">--</strong>.</p>
			<p>Oracle Database systems also have two default databases:</p>
			<ul>
				<li><strong class="source-inline">SYSTEM</strong></li>
				<li><strong class="source-inline">SYSAUX</strong></li>
			</ul>
			<h3>Microsoft SQL Server</h3>
			<p>Microsoft <a id="_idIndexMarker019"/>SQL Server is one of the most common <a id="_idIndexMarker020"/>solutions in the enterprise world. It is a SQL DBMS optimized for running on the Windows Server OS, which is one of the most widely adopted server operating systems. </p>
			<p><strong class="bold">Microsoft SQL Server</strong> (<strong class="bold">MSSQL</strong>) also has its own share of peculiarities.</p>
			<p>MSSQL supports three ways to insert comments in terms of character sequences: </p>
			<ul>
				<li><strong class="source-inline">/*comment*/</strong></li>
				<li><strong class="source-inline">--</strong></li>
				<li><strong class="source-inline">%00</strong></li>
			</ul>
			<p>MSSQL systems have many default databases that are always present in the schema:</p>
			<ul>
				<li><strong class="source-inline">pubs</strong></li>
				<li><strong class="source-inline">model</strong></li>
				<li><strong class="source-inline">msdb</strong></li>
				<li><strong class="source-inline">tempdb</strong></li>
				<li><strong class="source-inline">northwind</strong></li>
				<li><strong class="source-inline">information_schema</strong> (from MSSQL Server 2000 onward)</li>
			</ul>
			<p>MSSQL allows the use of the <strong class="source-inline">@@VERSION</strong> command for retrieving the database system version.</p>
			<p>SQL is, in general, a high-performance language capable of querying structured data. Queries follow <a id="_idIndexMarker021"/>a specific readable syntax and allow users and database managers to perform various operations, ranging from <a id="_idIndexMarker022"/>creating and deleting tables to extracting data according to specific conditions. The following section focuses on showing the basic SQL syntax and capabilities, setting language implementation differences aside for the moment, while also examining the logic behind the commands mentioned. </p>
			<h1 id="_idParaDest-23"><a id="_idTextAnchor025"/>The syntax and logic of SQL</h1>
			<p>As mentioned earlier, SQL is an easy to use and understand language capable of many different <a id="_idIndexMarker023"/>types of operations. Like all languages, it is based on interpreting command strings that are inserted with an expected syntax, with <a id="_idIndexMarker024"/>specific statements corresponding to one and only possible operation. SQL's main statements can be of many types. Let's take a look at the most important ones:</p>
			<ul>
				<li><strong class="bold">SELECT statement</strong>: <strong class="source-inline">SELECT</strong> is the most common SQL command. Its purpose is to allow <a id="_idIndexMarker025"/>the database to be searched, showing the specified attributes from the records that satisfy (optionally) a specific condition; for example:<p class="source-code">SELECT color, shape FROM objects </p><p>This statement shows the <strong class="source-inline">color</strong> and <strong class="source-inline">shape</strong> attributes of all the records from the <strong class="source-inline">objects</strong> table. SQL also allows for a wildcard – in this case, the character <strong class="source-inline">*</strong> – to make general selections:</p><p class="source-code">SELECT * FROM objects </p></li>
				<li>This statement will return all the records from <strong class="source-inline">objects</strong> table, showing all the attributes. This search <a id="_idIndexMarker026"/>can also be refined by adding a <strong class="source-inline">WHERE</strong> clause, which specifies a condition:<p class="source-code">SELECT color, shape FROM objects WHERE color='blue' </p><p>This statement will only show records with the value <strong class="source-inline">blue</strong> within the <strong class="source-inline">color</strong> field:</p></li>
			</ul>
			<div>
				<div id="_idContainer012" class="IMG---Figure">
					<img src="image/B15632_01_006.jpg" alt="Figure 1.6 – A SELECT query in SQL, with a view of its result&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 1.6 – A SELECT query in SQL, with a view of its result</p>
			<p>Other clauses can be utilized within a <strong class="source-inline">SELECT</strong> statement:</p>
			<p><strong class="bold">- DISTINCT clause</strong>: Used to <a id="_idIndexMarker027"/>return <a id="_idIndexMarker028"/>results without duplicates (<strong class="source-inline">SELECT DISTINCT color FROM objects</strong>)</p>
			<p><strong class="bold">- ORDER BY clause</strong>: Used <a id="_idIndexMarker029"/>to order <a id="_idIndexMarker030"/>results based on an attribute (<strong class="source-inline">SELECT * FROM objects ORDER BY color ASC</strong> for ascending order, or <strong class="source-inline">DESC</strong> for descending order)</p>
			<p>Having a clear understanding about how the <strong class="source-inline">SELECT</strong> statement works is very important for mastering SQL injection. Being the most common statement, the abuse of its structure is the prime enabler of a SQL injection attack, allowing for other SQL commands to be inserted within an apparently harmless instruction. We will see further details of this in the next chapter.</p>
			<ul>
				<li><strong class="bold">INSERT statement</strong>: The <strong class="source-inline">INSERT</strong> statement is used to add data to a database in a very simple way, that is, by specifying the values to insert into the attributes of choice. Let's take <a id="_idIndexMarker031"/>a look at an example:<p class="source-code">INSERT INTO objects (shape, color) VALUES (square, blue)</p><p>The preceding statement adds new data to the database through the <strong class="source-inline">square</strong> and <strong class="source-inline">blue</strong> attribute values for the <strong class="source-inline">shape</strong> and <strong class="source-inline">color</strong> attributes, respectively:</p></li>
			</ul>
			<div>
				<div id="_idContainer013" class="IMG---Figure">
					<img src="image/B15632_01_007.jpg" alt="Figure 1.7 – An INSERT query in SQL, with a view of its result&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 1.7 – An INSERT query in SQL, with a view of its result</p>
			<p>Alternatively, you can add data without specifying the attributes (<strong class="source-inline">INSERT INTO objects VALUES (square, blue)</strong>), but bear in mind that since unspecified attributes are set to <strong class="source-inline">null</strong>, this option is only recommended if entire records are inserted in the correct attribute order. The <strong class="source-inline">INSERT</strong> statement could also be used maliciously, for example, to insert account credentials that could be used by attackers to gain access to a system.</p>
			<ul>
				<li><strong class="bold">CREATE and DROP statements</strong>: The <strong class="source-inline">CREATE</strong> and <strong class="source-inline">DROP</strong> statements are, as their names suggest, made to create or delete entire SQL tables or even databases. <strong class="source-inline">DROP</strong> has a <a id="_idIndexMarker032"/>very simple syntax, because it just deletes all the <a id="_idIndexMarker033"/>records in a specified table or database (<strong class="source-inline">DROP TABLE objects</strong>, <strong class="source-inline">DROP DATABASE db</strong>), while <strong class="source-inline">CREATE</strong> can be used in various ways, depending on the objective. Creating a database is similar as in the <strong class="source-inline">DROP</strong> statement, that is, just using <strong class="source-inline">CREATE DATABASE db</strong>, while tables obviously need specific information for the attribute's creation. Referring to the <strong class="source-inline">objects</strong> example, we could use the following code: <p class="source-code">CREATE TABLE objects (objID int, shape varchar(32), color varchar(32)) </p><p>This statement will create a table named <strong class="source-inline">objects</strong> with <strong class="source-inline">objID</strong> as an integer and <strong class="source-inline">shape</strong> and <strong class="source-inline">colors</strong> as strings with their maximum lengths set to 32 characters.</p></li>
				<li><strong class="bold">ALTER statements</strong>: The <strong class="source-inline">ALTER</strong> statement is used to modify general information regarding <a id="_idIndexMarker034"/>databases or tables:<p class="source-code">ALTER DATABASE dbname1 MODIFY NAME=dbname2 </p><p>The preceding statement will rename the <strong class="source-inline">dbname1</strong> database <strong class="source-inline">dbname2</strong>. The following statement will also add, to an existing table (<strong class="source-inline">objects</strong>), a new string field named <strong class="source-inline">newcolumn</strong>, which will store a maximum of 32 characters:</p><p class="source-code">ALTER TABLE objects ADD newcolumn varchar(32) </p><p><strong class="source-inline">ALTER TABLE</strong> can also be used to drop entire attributes (<strong class="source-inline">ALTER TABLE objects DROP newcolumn</strong>) or modify columns to change their data type. The <strong class="source-inline">ALTER</strong> statement is not typically used in SQL injection since the <strong class="source-inline">DROP</strong> statement is often preferred for disabling application functionalities.</p></li>
			</ul>
			<p>The statements listed here only comprise a subset of what is possible in SQL, but in order to better understand the main issue of this book, these should provide a sufficient basis for what we will cover next.</p>
			<p>Besides statements, SQL also provides a wide range of clauses that can be used to integrate commands to refine data searches and include constraints in the operations on the database. We have already seen the <strong class="source-inline">WHERE</strong>, <strong class="source-inline">DISTINCT</strong>, and <strong class="source-inline">ORDER BY</strong> clauses for the <strong class="source-inline">SELECT</strong> statement. More advanced examples will be examined in the following chapters.</p>
			<h1 id="_idParaDest-24"><a id="_idTextAnchor026"/>Security implications of SQL</h1>
			<p>As we've seen, SQL allows us to perform a very large set of instructions, making interacting with the whole <a id="_idIndexMarker035"/>database possible at many different levels. We can do this by modifying its structure too. With such a powerful language that can be used to perform any sort of operation on a database, it is natural to start wondering, <em class="italic">what could go wrong?</em> With a vast array of possible statements and operations, of course, a malicious attacker could have a wide selection of tools that could be used to damage databases, stored data, and applications using such data, in different ways. One simple instruction, such as <strong class="source-inline">DROP DATABASE &lt;database name&gt;</strong>, for example, could entirely compromise the functionality of an application that relies on databases to query data or even authentication data (that is, usernames and passwords). </p>
			<p>For this reason, SQL code is never, at least directly, conceived to be interacted with inside an application. Instead, it is the application that, given user input, prepares the SQL code needed to be sent to the database to extract (or modify) the data requested.</p>
			<p>However, there are ways for potential attackers to abuse SQL syntax and insert arbitrary instructions. This way <a id="_idIndexMarker036"/>of attacking is, in general, called <strong class="bold">code injection</strong>, and involves inserting code of a language recognized by a computer or a system into existing code, making it possible to perform otherwise not envisioned tasks. </p>
			<p>Being a simple (yet very powerful) language, injecting code within SQL statements is relatively easy and can also produce quite damaging results, varying from granting authenticated <a id="_idIndexMarker037"/>access to anybody to utterly destroying a web application relying on databases. The preceding example is just one of many destructive commands that could be injected. </p>
			<p>The main issue behind the use of SQL is that code is evaluated by the application while it's running: if no controls are in place, the program itself, which has already started, does not evaluate the statements in terms of content or correctness. A malicious attacker could exploit this by inserting arbitrary commands within user-provided input, such as in authentication forms or string fields that are evaluated by the application by inserting those within running code.</p>
			<p>In the following section, we will see how this is possible in a vulnerable application.</p>
			<h1 id="_idParaDest-25"><a id="_idTextAnchor027"/>Weaknesses in the use of SQL</h1>
			<p>The main problem that leads to code injection – and obviously SQL injection too – is the way programming (and query) languages themselves inherently work. </p>
			<p>Since commands <a id="_idIndexMarker038"/>are just strings of characters that are interpreted as code, and user input is made of text, we could, in principle, insert code syntax within user input. If not correctly validated and simply accepted without us applying any control, this injected code could result in the execution of arbitrary commands that have been manually inserted by a malicious user. </p>
			<p>This is because a naïve string reader does not make any distinction between text and code as it is essentially binary data coded as text – the same is done from the standpoint of a computer program or an application. Usually, in order to inject specific instructions or code objects, specific characters are used to trick the parser – the software component in charge of reading the text input – into interpreting the inserted code as unintended commands. Traditionally, the most trivial way to inject code is by inserting the line termination character – the semicolon in most programming languages – so that, besides the intended operation, the new one is considered as an entirely different instruction. Other characters can be used to manipulate the application's behavior, such as the comment separator, which is used to exclude altogether parts of code following the instruction.</p>
			<p>SQL is no exception to this: many techniques used in code injection also apply to SQL. In fact, this vulnerability was discovered over 20 years ago by commands being injected into SQL queries, resulting in unintended operations. We will see specific forms of this exploitation in later chapters, all of which can be used to cause damage to applications or to help the attacker gain strategic advantage, both in terms of data and in some cases accessing otherwise restricted systems.</p>
			<p>Luckily, SQL injection only applies to applications that are poorly coded. Adding specific controls for <a id="_idIndexMarker039"/>the user-provided input – and inner application streams – can prevent this problem altogether. Besides improving the security controls on the input, dropping suspicious web traffic could also help avoid the exploitation of the vulnerability. Ideally, this being a coding error, you should develop secure code in accordance with the best practices available. Here are some general suggestions that will be further explored later in this book:</p>
			<ul>
				<li><strong class="bold">Do not allow unnecessary special characters in queries</strong>: Usually, it's through the use of special characters that SQL injection is enabled. If special characters are allowed in queries, those could also be encoded in a way that is not interpreted by SQL, thus foiling SQL injection attempts based on special characters such as string separators (single or double quote), instruction separators (semicolon), and comment separators.</li>
				<li><strong class="bold">Do not allow specific suspicious commands</strong>: Some commands are often used in SQL injection attacks. Allowing specific authorized commands only, through the means of a whitelist, helps us avoid the insertion of arbitrary commands within an application, according to the expected behavior of the software component.</li>
				<li><strong class="bold">Do not give carte blanche to the user</strong>: While we would love users to be respectful and responsible, to us, they could be anybody – even malicious users as far as we know. It's a good idea to limit their actions as much as possible, thereby never trusting user input. Query input should always be converted into parameters and serialized accordingly.</li>
			</ul>
			<p>These points help in protecting against SQL injection, at least as a guideline. The topic of defending against SQL injection with a more low-level and specific meaning will be thoroughly examined in later chapters and sections of this book. In general, it's by enabling a security-driven approach to application coding that most vulnerabilities and security issues can be solved altogether. Also, including security controls during development can help save time and effort as reworking code can be much harder than writing the code from scratch with such controls that are included by design.</p>
			<h1 id="_idParaDest-26"><a id="_idTextAnchor028"/>SQL for SQL injection – a recap</h1>
			<p>This chapter served as an introduction to, in a general sense, the basic topics behind SQL injection. The following is a summary of the main points to focus on in this first chapter so <a id="_idIndexMarker040"/>that you can memorize the main concepts we have mentioned thus far:</p>
			<ul>
				<li>SQL injection is a software weakness of SQL, a specific language and engine for interacting with database structures based on the relational model that treats data in a structured format using tables. It can allow malicious users to execute arbitrary commands, thus interacting with the database of an application in a way that is not originally intended by the application SQL injection can be used by attackers in many ways:</li>
			</ul>
			<div>
				<div id="_idContainer014" class="IMG---Figure">
					<img src="image/Chapter_1_Table_1.jpg" alt=""/>
				</div>
			</div>
			<ul>
				<li>SQL provides a simple language that can be used to perform operations on relational databases. SQL processes statements with simple structures in most cases. Some SQL statements are as follows:<p><strong class="source-inline">-SELECT</strong>, to extract information from the database returning records</p><p><strong class="source-inline">-INSERT</strong>, to insert records within the database</p><p><strong class="source-inline">-CREATE</strong>, to create data tables or databases</p><p><strong class="source-inline">-DROP</strong>, to delete entire tables or databases</p><p><strong class="source-inline">-DELETE</strong>, to delete records within the database</p><p><strong class="source-inline">-ALTER</strong>, to modify databases or tables</p><p>Some of these statements can be more effective than others in terms of injection, but the most important is <strong class="source-inline">SELECT</strong> since it is the main enabler of injection and is the most common command used in applications. It is through the insertion of SQL commands within <strong class="source-inline">SELECT</strong> statements that almost all SQL injections take place. </p><p>Some specific advanced SQL commands can also put different tables in relation based on, for example, common attributes. This is one of the main advantages of the relational model, which can separate data records into different tables that describe relations, while at the same time being connected and increasing the range of operations that can be performed.</p></li>
				<li>SQL-based <a id="_idIndexMarker041"/>systems can vary in terms of their implementation and can have some minor differences in terms of syntax (comments) and structure (default database names):<p>- MySQL, an open source implementation, is the most popular version available. It can be considered as the basic SQL implementation for reference.</p><p>- SQLite is designed to be a standalone version of SQL, storing the database in the same filesystem as the client application that's running. It uses the basic SQL syntax without major differences.</p><p>- Oracle Database is one of the most popular SQL database systems in the enterprise environment as it also supports other database models, making it a multi-model system.</p><p><strong class="bold">- Microsoft SQL</strong> (<strong class="bold">MSSQL</strong>) server is another popular solution in the enterprise environment <a id="_idIndexMarker042"/>thanks to its integration with the Microsoft Windows environment, which is very widespread in the IT world.</p><p>In general, the underlying engine works in the same way in terms of query processing, but there are some minor differences in terms of language and default database schema.</p><p>For this recap, we have prepared a reference table highlighting some basic differences among the main SQL engines. This will help you memorize the main differences we described in this chapter:</p><div id="_idContainer015" class="IMG---Figure"><img src="image/Chapter_1_Table_2.jpg" alt=""/></div></li>
			</ul>
			<p>SQL is used within coded applications to allow interaction with databases, which can be used <a id="_idIndexMarker043"/>to store and access data, while also providing means for obtaining authenticated access. Databases usually store access information, such as username and password, that's evaluated for matching purposes in a specific table of the database. For this reason, being a component of applications, SQL could be exploited by possible malicious actors who could abuse its expressive power.</p>
			<ul>
				<li>If there are no security controls in place, an application will evaluate every possible text string that is sent to it, thus possibly allowing a malicious user to insert arbitrary commands that weren't originally intended. To contrast the action of possible malicious users, the best solution would be to implement a security-focused approach in application development so that attacks such as SQL injection (and many other) are prevented by the use of security controls that implement a secure-by-design pattern that follows the existing best practices for secure coding. As a general blueprint, we can summarize some security-by-design principles into three major points:<p>- Do not allow <a id="_idIndexMarker044"/>unnecessary special characters in queries so that SQL syntax cannot be abused.</p><p>- Do not allow suspicious commands in queries by whitelisting only specific instructions.</p><p>- Do not give the user too much freedom, thereby preventing a malicious user from injecting arbitrary code.</p></li>
			</ul>
			<p>We will see more specific security principles in later chapters, both in the form of countermeasures and existing best practices for what concerns application security.</p>
			<h1 id="_idParaDest-27"><a id="_idTextAnchor029"/>Summary</h1>
			<p>So, to sum this up, let's take a look at what we covered in this chapter. SQL works using relationships, and it accepts a wide range of commands. We've also seen that, in general, some of these can be abused by malicious attackers. For this reason, we should keep security in mind when designing and developing applications that rely on databases. This chapter gave you a taste of the main security issues and possible solutions.</p>
			<p>The next chapter will focus on what a malicious attacker can do by taking advantage of SQL capabilities. We will provide examples of this, all while dealing with aspects related to non-relational databases.</p>
			<p>This first chapter, despite being more abstract, is essential for focusing on the main concepts behind SQL injection. Of course, this just an introduction to what we are going to cover throughout this book, but with more concrete examples. Be sure to keep these topics in mind when dealing with the practical aspects of SQL injection.</p>
			<p>Our journey into SQL injection has only just begun!</p>
			<h1 id="_idParaDest-28"><a id="_idTextAnchor030"/>Questions</h1>
			<ol>
				<li>What is a database?</li>
				<li>What is a relational database?</li>
				<li>What is SQL? What is it used for?</li>
				<li>Can you name some examples of SQL implementations in terms of database systems?</li>
				<li>What does <strong class="source-inline">SELECT</strong> mean in SQL? Why is it so important?</li>
				<li>Can you describe SQL injection in your own words?</li>
			</ol>
		</div>
	</body></html>