<html><head></head><body>
<div id="sbo-rt-content"><div id="_idContainer033">
<h1 id="_idParaDest-15"><em class="italic"><a id="_idTextAnchor014"/>Chapter 1</em>: Open Source Intelligence</h1>
<p>What separates <strong class="bold">penetration testing</strong> (<strong class="bold">pen testing</strong>) from hacking of the illegal variety? The simple answer is <em class="italic">permission</em>, but how do you define this? Asking for a pen test does <em class="italic">not</em> mean an open invitation to hack to your heart’s content. I know of at least one pen testing organization that found itself in legal trouble for touching a server that was not supposed to be part of the test. This is part of the <em class="italic">scope</em> of the pen test, and it is defined in the planning phase of the engagement. Its importance can’t be overstated. However, this is a hands-on technical book – we won’t be covering scoping and engagement letters here.</p>
<p>Now, you’re double-checking the name of the chapter to make sure you’re in the right place. <em class="italic">Is this not about open source intel</em>, you wonder? Indeed, it is, and I mention scope because <strong class="bold">open source intelligence</strong> (<strong class="bold">OSINT</strong>) is an area where you need not worry about the frustration of a skinny scope. <em class="italic">Open source</em> means the information is already out in the open, ready for your retrieval. You only need to know the tips and tricks needed to step beyond the run-of-the-mill <strong class="bold">Google</strong> user. In this chapter, we’ll define OSINT more carefully – we’ll learn how to take advantage of Google’s sophisticated features to dig deep enough to surprise your client before you’ve sent a single packet to their network, and we’ll introduce how <strong class="bold">Kali</strong> functions as your OSINT sidekick. We’ll cover this and more in the following topics:</p>
<ul>
<li>Hiding in plain sight – OSINT and passive recon</li>
<li>The world of <strong class="bold">Shodan</strong></li>
<li>Google’s dark side</li>
<li>Diving into OSINT with Kali</li>
</ul>
<h1 id="_idParaDest-16"><a id="_idTextAnchor015"/>Technical requirements</h1>
<p>You’ll need a <strong class="bold">virtual machine</strong> (<strong class="bold">VM</strong>) or standalone PC running <strong class="bold">Kali</strong> <strong class="bold">Linux</strong>. We’ll run our demonstrations on <strong class="bold">Kali</strong> <strong class="bold">2021.1</strong>, but the first section can be completed on any internet-connected computer.</p>
<h1 id="_idParaDest-17"><a id="_idTextAnchor016"/>Hiding in plain sight – OSINT and passive recon</h1>
<p>We’ll be making heavy use of Kali Linux throughout this book, but some of the most important work you’ll do <a id="_idIndexMarker000"/>for many clients can be done from any device, regardless of a specialized toolset. You might be waiting in line at Starbucks with your personal smartphone, punching in some slick Google queries, and bam – you have a surprising head start before you’ve even arrived at your desk. Then, you sit down at Kali and spend half an hour digging up even more, and you haven’t sent a single packet across the wire to your target. But now, I can hear you at the back: <em class="italic">You've said "OSINT" and "passive recon" — is there a difference?</em> That’s a good question, with an annoying answer: <em class="italic">It depends on whom you ask</em>. These terms are often used synonymously, but the important distinction is where you’re sending your packets:</p>
<ul>
<li>With pure <strong class="bold">passive reconnaissance</strong>, your packets are going to a myriad of resources that are <a id="_idIndexMarker001"/>available on the public internet to anyone willing to ask. But they are not going to your target’s network. This can also <a id="_idIndexMarker002"/>mean that you aren’t sending any packets at all – you’re merely listening, as we do with <strong class="bold">wardriving</strong>.</li>
<li>OSINT can mean both this purely passive task where no contact is made with your target and using your target’s resources that are explicitly meant for public use. Does your target allow a potential customer to create a free account? It behooves the pen tester to create an account as a potential customer would, but this probably means you’re directly communicating with your target’s network. The “<em class="italic">meant for public use</em>” part is what makes it OSINT.</li>
</ul>
<p>Sounds like a pretty important distinction, right? The reason why they’re often treated as the same thing is that they both fall under the umbrella of a <strong class="bold">black box</strong> – our experience with the <a id="_idIndexMarker003"/>environment is like an ordinary outsider, as opposed to a <strong class="bold">white box</strong>, where, as pen testers, we fully understand the inner workings of the environment and we’re informing <a id="_idIndexMarker004"/>our efforts accordingly (of course, we can conduct our testing with only partial knowledge of the environment, which will be a blend of black and white, or a gray box). We’re touching on pen testing philosophy at this point – how realistic is the test in representing a real-world potential attack? For those of us passionate about security, we stand by <strong class="bold">Shannon's Maxim</strong>. That is, <em class="italic">we should always assume that the enemy will have full knowledge of how our system works</em>. A real-world enemy will have scoured the internet for any tidbits about their target. A real-world enemy will have created accounts with the target’s services and spent a considerable amount of time gaining the same level of familiarity as any old hand. This being said, your client may need to understand how their environment works from different perspectives, and you might very well be prohibited from using information gained from the view of a registered user. Another consideration is time – you will be operating on a schedule, and you don’t want to put the other phases of the assessment in a crunch.</p>
<h2 id="_idParaDest-18"><a id="_idTextAnchor017"/>Walking right in – what the target intends to show the world</h2>
<p>The nature of your target will tell you how much is meant to be shown to the world. For example, if your target is a bank, then they will provide comprehensive resources for both their current customers and in their efforts to attract new account holders. Even a more private entity needs to put themselves out there in some regard (for example, a private network that needs to be remotely accessed). There’s an old saying in computer security: <em class="italic">the most secure computer is sealed in a concrete box and sits on the ocean floor</em>. If no one can actually use the computer, it seems like a waste of concrete, and so our clients will host services and websites anyway.</p>
<h3>Examining the target’s websites</h3>
<p>One of the first things I do with a target is browse their website and <strong class="bold">View page source</strong>. This screenshot <a id="_idIndexMarker005"/>shows how to grab it in <strong class="bold">Microsoft</strong> <strong class="bold">Edge</strong>, but right-clicking on a <a id="_idIndexMarker006"/>page will bring up the option in any of the major browsers:</p>
<div>
<div class="IMG---Figure" id="_idContainer006">
<img alt="Figure 1.1 – The right-click menu while viewing a page in Microsoft Edge " height="438" src="image/Figure_1.01_B17616.jpg" width="392"/>
</div>
</div>
<p class="figure-caption">Figure 1.1 – The right-click menu while viewing a page in Microsoft Edge</p>
<p>This option will open a new tab and display the <strong class="bold">HTML</strong> source for the page. Often, this won’t reveal anything that isn’t already <a id="_idIndexMarker007"/>visible (it is a markup language, after all). But there may be comments <a id="_idIndexMarker008"/>in the source and other treats not intended to be displayed by the browser, and these can give us morsels of information about our target that will inform our attack.</p>
<p>With this client, the page source revealed a folder called <strong class="source-inline">assets</strong>:</p>
<div>
<div class="IMG---Figure" id="_idContainer007">
<img alt="Figure 1.2 – Examining the page source in Microsoft Edge " height="117" src="image/Figure_1.02_B17616.jpg" width="1094"/>
</div>
</div>
<p class="figure-caption">Figure 1.2 – Examining the page source in Microsoft Edge</p>
<p>We see references to scripts that can be found on the host under the <strong class="source-inline">assets</strong> folder. So, just drop this into your address bar and see what happens –  <a href="http://www.your-client.com/assets">http://www.your-client.com/assets</a>:</p>
<div>
<div class="IMG---Figure" id="_idContainer008">
<img alt="Figure 1.3 – The result of manually typing in the assets URL " height="230" src="image/Figure_1.03_B17616.jpg" width="712"/>
</div>
</div>
<p class="figure-caption">Figure 1.3 – The result of manually typing in the assets URL</p>
<p>We haven’t even done anything yet – just pulled up the public site in an ordinary browser – but we see this host is telling us a couple of things:</p>
<ul>
<li>It’s an <strong class="bold">Apache</strong> server, version 2.4.41, running <a id="_idIndexMarker009"/>on <strong class="bold">Unix</strong> (or Unix-like).</li>
<li>It wasn’t <a id="_idIndexMarker010"/>configured in the most secure manner.</li>
</ul>
<p>That second point is the most important observation. Does revealing the server version like this really matter that much? Sure, it gives us a heads-up for our research, but it’s not exactly a welcome mat either. What it tells us about is the administrator’s general approach to operational <a id="_idIndexMarker011"/>security. The kind of server administrator who either doesn’t know or doesn’t care about the risk, regardless of how tiny, is more likely to be the kind of administrator who, for example, asks people in public forums for help with <em class="italic">some new hardware at work</em>, even providing logs that you’d be lucky to get during the assessment.</p>
<h3>Don’t be so antisocial – examining the target’s presence on social media</h3>
<p>We live in funny times, when it seems like everyone and their grandparents are willingly sharing all their <a id="_idIndexMarker012"/>personal details with social media companies. Back in my day, you’d hear about the cool kids having a party at their parents’ house and you’d think, <em class="italic">now that's the place to be on Friday night</em>. Your target is <a id="_idIndexMarker013"/>hearing the same thing about social media today – everyone’s <a id="_idIndexMarker014"/>on <strong class="bold">Facebook</strong>, <strong class="bold">Twitter</strong>, <strong class="bold">Instagram</strong>, and <strong class="bold">TikTok</strong>, so that’s where you’re going to <a id="_idIndexMarker015"/>meet the <a id="_idIndexMarker016"/>cool kids (or potential customers, as the case may be). In this screenshot, we see how our target is encouraging engagement:</p>
<div>
<div class="IMG---Figure" id="_idContainer009">
<img alt="Figure 1.4 – Social media links on our target’s home page " height="486" src="image/Figure_1.04_B17616.jpg" width="657"/>
</div>
</div>
<p class="figure-caption">Figure 1.4 – Social media links on our target’s home page</p>
<p>You’re not likely to find juicy tidbits about your target from posts that they made on social media. You’re likely to find the good stuff from <em class="italic">other</em> users of the social media platform in question. For example, you click the Facebook button and end up on a page set up by your target. You browse the comments: <em class="italic">Jane is the GM at the Highland branch and she was really responsive to my needs</em>. Or maybe a photo from a company picnic <a id="_idIndexMarker017"/>with 14 likes, and one of the likes is Jane’s, and she loves to share pictures of her pets, kids, car, home, and her favorite latte at Starbucks over on her profile page.</p>
<p>I probably sound like a ranting lunatic (I am, but that’s not important right now), but the point is to soak up all of this information and <em class="italic">take good notes</em>. We’re in the first chapter of the book, discussing what will probably be chapter one of your assessment with a client. That Jane names her dog Mr. Scruffles might seem useless, until day four, when you’re prompted with the security question for <em class="italic">pet's name</em>. Also consider that Jane’s IT guy, Dave, is a member of a popular Facebook group for IT admins to vent about their jobs; Dave just <a id="_idIndexMarker018"/>had a hard day working with your <strong class="bold">Cisco</strong> appliances and he’s ready to upload a diagnostic file.</p>
<p class="callout-heading">Tread carefully! </p>
<p class="callout">We’re looking for information that’s already there. Do not attempt to communicate with any of the individuals you find during your social media searches, unless you’re conducting a social engineering assessment – this would most certainly <em class="italic">not</em> be passive!</p>
<h2 id="_idParaDest-19"><a id="_idTextAnchor018"/>Just browsing, thanks – stepping into the target’s environment</h2>
<p>Wait a sec. Stepping into the target’s environment? <em class="italic">Now I know I'm in the wrong chapter</em>, you think. Indeed, this is where passive recon starts to blend into the broader term OSINT. The keyword <a id="_idIndexMarker019"/>so far has been <em class="italic">passive</em> – listening from the sidelines or taking a peek in the proverbial windows as we drive by. Now, the keywords are <em class="italic">open source</em> – we’re taking a look at things that are meant to be out in the open. We’re going to start getting a little braver with our efforts. Instead of figuratively driving by, we’ll park and walk into the shop and look around. It’s a door for the public and it says <em class="italic">Open</em> on the front, so we haven’t stepped outside the realm of open source. Sometimes, however, we can get interesting information about what’s going on behind the counter of our metaphorical shop.</p>
<h3>Summoning the daemon – the fat-fingered email address</h3>
<p>We’ve all misspelled someone’s name at some point. Perhaps you’re trying to send an email to the administrator of a domain and, gosh darn it, you misspelled <strong class="source-inline">administrator</strong>. Oh, these pesky fingers of mine. As my mother-in-law would say, <em class="italic">schlimazel</em> (an unlucky or clumsy person). Let’s take a look at our outgoing email:</p>
<div>
<div class="IMG---Figure" id="_idContainer010">
<img alt="Figure 1.5 – The header from our sent probe email " height="435" src="image/Figure_1.05_B17616.jpg" width="1394"/>
</div>
</div>
<p class="figure-caption">Figure 1.5 – The header from our sent probe email</p>
<p>The point is to send an email to the target domain but to a recipient we know doesn’t exist. You could very well let your cat walk across the keyboard and use that as the recipient – the result would be the same. However, there’s a bit of a social engineering angle going  on here. Just in case someone is reviewing these, my message is more likely to look like a legitimate attempt to communicate with the business or government agency. A smashed-keyboard email address and message body will look like a deliberate attempt to provoke a response. Bonus points if you actually do engage in a friendly conversation posing as a customer, but just let one of your messages have a fat-fingered recipient address. By sending an email to a nonexistent email address, we provoke a <em class="italic">bounce message</em>. Unlike sending an email to a nonexistent domain, only the target environment is going to know <a id="_idIndexMarker020"/>whether or not the user exists. The bounce will come from the target environment and often contains troubleshooting information with tasty tidbits for us fledgling hackers. Let’s take a peek at the non-delivery report from our client:</p>
<div>
<div class="IMG---Figure" id="_idContainer011">
<img alt="Figure 1.6 – The header from the bounce message " height="723" src="image/Figure_1.06_B17616.jpg" width="1324"/>
</div>
</div>
<p class="figure-caption">Figure 1.6 – The header from the bounce message</p>
<p>My favorite part of this bounce message is <strong class="bold">Diagnostic information for administrators</strong>. Golly, that sure is helpful of you, thank you! </p>
<p>I said this earlier, and it should be a mantra throughout the OSINT phase: <em class="italic">this isn't exactly a welcome mat</em>. It isn’t the keys to the kingdom, and this isn’t a movie – no amount of furious typing is going to change our position in the assessment. But let’s take a look at what we learned, step by step:</p>
<ul>
<li>The server that generated this report is <strong class="source-inline">ME-VM-MBX02</strong> and its IP address is <strong class="source-inline">10.255.134.142</strong>. It’s reasonable to guess that this is a virtual machine, as the VM initialism is often incorporated into internal naming conventions by IT folks. It makes it easier to determine what troubleshooting may entail, at a glance.</li>
<li>The server that passed on this information to <strong class="source-inline">ME-VM-MBX02</strong>, our report-generating server, is <strong class="source-inline">ME-VM-CAS02</strong>, and its IP addresses are <strong class="source-inline">10.255.134.140</strong> and <strong class="source-inline">10.255.27.36</strong>.</li>
<li>The server that passed this information on to the <strong class="source-inline">CAS02</strong> host is <strong class="source-inline">ME-VM-MAILGW01</strong> and its IP address is <strong class="source-inline">10.255.134.160</strong>. <em class="italic">GW</em> probably means <em class="italic">gateway</em>.</li>
</ul>
<p>Hopefully, you have already picked up on the important part. That’s right – those are <em class="italic">ten-dot</em> addresses. As a refresher, addresses in the <strong class="source-inline">10.0.0.0/8</strong> block are reserved as private address space as defined by the <strong class="bold">Internet Assigned Numbers Authority</strong> (<strong class="bold">IANA</strong>) (refer to them as <em class="italic">ten-dot</em> or <em class="italic">ten slash eight</em> and you’ll be one of the cool kids). Addresses <a id="_idIndexMarker021"/>in the <strong class="source-inline">10.0.0.0/8</strong> block are not publicly routable, so why do we care, as uninformed outsiders? We’re clearly getting information from behind the perimeter. What else did we notice? Examine this line: </p>
<p class="source-code">Microsoft SMTP Server (TLS) id 15.0.1497.2</p>
<p>Let’s jump back into our trusty search engine and look for <strong class="source-inline">Microsoft</strong> and <strong class="source-inline">15.0.1497.2</strong>. Top result? Exchange Server build numbers and release dates. Search the page for that build number and we end up with Exchange Server 2013 CU (cumulative update) 23, released on June 18, 2019. Well, I’m writing this in 2021, almost 2 years later, so it’s back to the search engine to try this: <strong class="source-inline">vulnerabilities</strong> and <strong class="source-inline">2013 CU23</strong>. We end up finding <strong class="source-inline">CVE-2021-28480</strong>, <strong class="source-inline">CVE-2021-28481</strong>, <strong class="source-inline">CVE-2021-28482</strong>, and <strong class="source-inline">CVE-2021-28483</strong> – <em class="italic">remote code execution vulnerabilities</em>. We already have an internal subnet to investigate: <strong class="source-inline">10.255.0.0/16</strong>. You have to admit this isn’t too shabby when you consider that all we did was send an email. Thus, here comes yet another reminder: <em class="italic">take good notes</em>. Write down everything you do. Don’t skimp on the screen captures – I would sometimes record my screen while I worked.</p>
<h2 id="_idParaDest-20"><a id="_idTextAnchor019"/>I know a guy – services doing the probing for you</h2>
<p>Back in my day, we had to walk 15 miles through the snow to get to the pen test. We didn’t even have computers – we used empty bean cans with a string tied between them to send and receive packets. Okay, I’m joking, but things are definitely different these days for the younglings. There’s a lot of work that can be taken out of your hands in today’s world of what I like to call <strong class="bold">EaaS</strong>: <strong class="bold">Everything-as-a-Service</strong>. This is important for pen testers because it allows you to do more with a small amount of time – you’re only with <a id="_idIndexMarker022"/>your client for a set window of time and it won’t feel like enough. You’ll be taking advantage of time-saving measures at all phases of an assessment (hello, scripting ability) but OSINT is no exception – even though we haven’t sat down with Kali yet. Let’s take a look.</p>
<h3>Security header scanners</h3>
<p>There are a few of these <a id="_idIndexMarker023"/>online. Try typing into a search engine <strong class="source-inline">security header scanners</strong>. One of the better ones is <a href="https://SecurityHeaderScanner.com">SecurityHeaderScanner.com</a>, a service I used for this client example:</p>
<div>
<div class="IMG---Figure" id="_idContainer012">
<img alt="Figure 1.7 – The result from SecurityHeaderScanner.com after scanning my client " height="1163" src="image/Figure_1.07_B17616.jpg" width="1650"/>
</div>
</div>
<p class="figure-caption">Figure 1.7 – The result from SecurityHeaderScanner.com after scanning my client</p>
<p>Yikes. That looks like my report card from my sophomore year of high school (sorry, Mom and Dad). In this <a id="_idIndexMarker024"/>particular assessment, I was able to use this information to pull off some successful <strong class="bold">cross-site scripting</strong>, <strong class="bold">clickjacking</strong>, and <strong class="bold">formjacking</strong> attacks. I could have figured this out <a id="_idIndexMarker025"/>manually, of course, but the <em class="italic">time saved</em> increases the value you <a id="_idIndexMarker026"/>provide to your client.</p>
<p>This is an example of a real-time test of public resources provided by your target – we asked this particular service <a id="_idIndexMarker027"/>to visit the website <em class="italic">now</em> and tell us what it sees. Another way to look at this pre-Kali stage of OSINT is to gather the information that has already been gathered by all of those crawlers taking peeks at every corner of the internet, 24/7/365. We need to be aware of the difference, as the information we find from such resources is not real-time and may not be accurate at the time of your assessment.</p>
<h3>Open source wireless analysis with WIGLE</h3>
<p>I would never forgive myself if I didn’t mention <a href="https://wigle.net">wigle.net</a> in the context of open source digging with <a id="_idIndexMarker028"/>sites that did the probing for us already. This one is special, though – it’s a true <a id="_idIndexMarker029"/>crowd-sourced initiative. Resources like Shodan are organizations that own their probing and crawling machines. Their game <a id="_idIndexMarker030"/>is to give you access to the database they built with their own hardware. <strong class="bold">WIGLE</strong>, on the other hand, is a collection of what the world of volunteer wardrivers have gathered with their own hardware and mode of transportation.</p>
<p class="callout-heading">Note</p>
<p class="callout">If the term is unfamiliar, <em class="italic">wardriving</em> refers to the practice of moving around an area with a device configured <a id="_idIndexMarker031"/>to detect and report wireless networks. The name suggests driving a car, as that’s a great way to cover larger areas, but you can also go warbiking, warwalking, or even send out a wardrone or a warkitteh (a man attached Wi-Fi sniffing hardware to his outdoor cat’s collar). I’m still not sure if warscooting is a thing yet.</p>
<p>At the time of writing, wigle.net contains information about 745 <em class="italic">million</em> networks, gathered from 10.5 <em class="italic">billion</em> individual observations. The key to the observations is the combination of <a id="_idIndexMarker032"/>device reconnaissance <a id="_idIndexMarker033"/>and <strong class="bold">GPS</strong> data, allowing you to place the <a id="_idIndexMarker034"/>observation on a map. Keep in mind, these locations are where the observation was made, not the location of the access point. This becomes clear when you zoom in on the map, as shown here:</p>
<div>
<div class="IMG---Figure" id="_idContainer013">
<img alt="Figure 1.8 – Zooming in on a neighborhood on wigle.net " height="560" src="image/Figure_1.08_B17616.jpg" width="889"/>
</div>
</div>
<p class="figure-caption">Figure 1.8 – Zooming in on a neighborhood on wigle.net</p>
<p>You can see the observations largely center on roads, suggesting that the observers are driving around <a id="_idIndexMarker035"/>with their laptops or smartphones. But you <a id="_idIndexMarker036"/>can also see spots in the middle of wide-open spaces, like <strong class="bold">Firefighters Park</strong> in the preceding screenshot, or even in the middle of the ocean, as shown in the following screenshot:</p>
<div>
<div class="IMG---Figure" id="_idContainer014">
<img alt="Figure 1.9 – Wardriving observations from the North Atlantic " height="690" src="image/Figure_1.09_B17616.jpg" width="1027"/>
</div>
</div>
<p class="figure-caption">Figure 1.9 – Wardriving observations from the North Atlantic</p>
<p>These observations likely correspond to shipping lanes or even airways. This should give you an idea of the sheer size of this dataset.</p>
<p>Where it will be useful to you, as an intrepid open source investigator, is gathering information about wireless networks without setting foot near the site. With some clients, this won’t really mean much. But for others who may be physically spread out, like with a massive <a id="_idIndexMarker037"/>data center or numerous individual <a id="_idIndexMarker038"/>facilities, some recon on the location of certain networks may come in useful. Again, by <em class="italic">location</em>, we mean the area where an observation was possible. Wireless networks are low-power, and most wardrivers aren’t packing exceptionally high-gain antennas while driving around, so you can assume you’ll be within a block or two, if not closer.</p>
<h1 id="_idParaDest-21"><a id="_idTextAnchor020"/>The world of Shodan</h1>
<p>There is a site you probably already know about, and if you don’t, prepare to spend a few hours exploring its <a id="_idIndexMarker039"/>treasures: <a href="https://shodan.io">shodan.io</a>. Back in my day, when you saw a device firing off frames on the wire, you knew <a id="_idIndexMarker040"/>it was a computer. Today, a surprising variety of devices are network-capable, and your refrigerator may very well be another budding leaf at the end of sprawling branches of this global tree we call the internet. The rapid proliferation of this connectedness and its penetration into our daily lives is concerning for us security nerds, but we’re not going to wax philosophical today. The point is, it occurred to some clever folks along the way that crawling the internet to see what’s open and ready to chat will be <em class="italic">very</em> interesting as new leaves start popping up. Enter Shodan.</p>
<p>The name started as an acronym from a classic 1990s video game series, <em class="italic">System Shock</em>. <strong class="bold">SHODAN</strong> stands for <strong class="bold">Sentient Hyper-Optimized Data Access Network</strong>. In a classic sci-fi turn of events, SHODAN was originally artificial intelligence whose purpose <a id="_idIndexMarker041"/>was to help people …<em class="italic">but something went wrong</em>. You get the idea. Think <em class="italic">Skynet</em> from the <em class="italic">Terminator</em> series or <em class="italic">V.I.K.I.</em> from <em class="italic">I, Robot</em>. The AI goes wonky and decides humans are mere infestuous bugs for squashing. The common thread is that the AI was granted entirely too much access to global systems in order for it to do its job. As SHODAN grabbed control over numerous disparate systems, shodan.io’s creator John Matherly figured it’s an appropriate reference.</p>
<p>To be clear, Shodan isn’t a website that is hell-bent on the annihilation of all humankind (but that would be an awesome movie). The “<em class="italic">disparate systems</em>” part is the all-too-creepy reference here, as Shodan crawls the internet, just poking around the unlocked doors tucked away in the back alleyways. If you want to find webcams, a fridge that’s running low on milk, or – more terrifyingly – <strong class="bold">SCADA</strong> systems inside massive plants, then Shodan is the <a id="_idIndexMarker042"/>place to check it out. What the hacker in you should be realizing is something like, <em class="italic">what about an SSH server on unexpected ports, in an attempt to hide in plain sight?</em> Excellent thinking. We want to focus on our client’s resources that were already sniffed by someone else. Suppose your client really is running SSH on port <strong class="source-inline">2222</strong> (this is surprisingly common, as Shodan will show you). We have a head start on the discovery phase of our assessment, and once again, we didn’t send any packets. A Shodan crawler sent the packets.</p>
<p>The general principle here is <em class="italic">banner grabbing</em>. Banners are nothing more than text-based messages that greet the client connecting to a particular service. They’re useful for the rightful administrators of these servers to catalog assets and troubleshoot problems. Suppose you have a large inventory of servers hosting a particular service and you want to validate the version that’s running on each host. You could type up a small script that will initiate those connections, find the version number in the banner, and put it all in a tidy list on your screen. They are also extremely useful for narrowing our focus while we are developing the attack on our target. We’ll see hands-on banner grabbing later when we’re sitting down at Kali. In the meantime, we’re going to take advantage of the fact that someone has already taken a look at what the internet looks like down to <a id="_idIndexMarker043"/>the service level, and our job is to see what our client is telling the world. You’ll be surprised again and again during assessments by how much the clients do <em class="italic">not</em> know about what’s floating around out there with their name on it.</p>
<p class="callout-heading">Is banner grabbing a worthy finding for a pen test? </p>
<p class="callout">Findings are graded by their overall risk rating. Businesses consider a couple of things when it comes to risk management: how likely and how impactful a compromise would be. Is a vulnerability very unlikely to be exploited, and if it is, will it threaten the entire organization? That’s going to be considered higher risk. Banner grabbing would fall in the category of <em class="italic">very likely</em> (due to its simplicity), and <em class="italic">very low impact</em>. Remember that an important part of your job is educating your client on how these things work. Yes, it will be one of the low-risk findings. But if your banner grab narrowed your focus and saved you time, thus giving you more time after the compromise to do even more movement and loot-grabbing, it belongs in the report. It’s a part of the attack!</p>
<h2 id="_idParaDest-22"><a id="_idTextAnchor021"/>Shodan search filters</h2>
<p>You can start simple, such as punching in an IP address or a service name. For example, we could try <strong class="bold">Remote Desktop Protocol</strong> (<strong class="bold">RDP</strong>) or <strong class="bold">Samba</strong>. To turn this global eye into a fine-tuned <a id="_idIndexMarker044"/>microscope, however, we need to apply <a id="_idIndexMarker045"/>search filters. The format is very simple: you merely separate the name of the filter from its query with a colon (<strong class="source-inline">:</strong>). A real handy way to fine-tune your results is to <em class="italic">negate</em> a particular query by putting a dash (<strong class="source-inline">-</strong>) before the filter name. Let’s take a look at the filters available to us, and then we’ll go over some examples. </p>
<ul>
<li><strong class="source-inline">asn</strong>: Search by autonomous system number. An <strong class="bold">autonomous system</strong> (<strong class="bold">AS</strong>) is a group of IP <a id="_idIndexMarker046"/>prefixes operated by one or more entities for maintaining one clear routing policy, allowing these entities to exchange routes with other ISPs. This search is useful when you are looking for hosts under the control of one or more such entities as defined by their assigned ASN.</li>
<li><strong class="source-inline">city</strong>: Search by the city where the host is located.</li>
<li><strong class="source-inline">country</strong>: Search by <a id="_idIndexMarker047"/>country <a id="_idIndexMarker048"/>with <strong class="bold">alpha-2</strong> codes as per the <strong class="bold">ISO</strong> <strong class="bold">3166</strong> standard.</li>
<li><strong class="source-inline">geo</strong>: Allows you to specify geographical coordinates. Linking a specific host to its geographical coordinates is notoriously iffy, so it’s best to establish a <em class="italic">range</em> with <a id="_idIndexMarker049"/>this filter. Draw a box over the area you want to search and grab the lat/lon pairs for the top-left corner of the box and the lower-right corner of the box. For example, searching <strong class="source-inline">geo:12.63,-70.10,12.38,-69.82</strong> will return results anywhere on the island of Aruba.</li>
<li><strong class="source-inline">has_ipv6</strong>: Searches for IPv6 support; expects <strong class="source-inline">true</strong> (or <strong class="source-inline">1</strong>) or <strong class="source-inline">false</strong> (or <strong class="source-inline">0</strong>).</li>
<li><strong class="source-inline">has_screenshot</strong>: Returns results where a screenshot was captured. This is useful for things such as <strong class="bold">RDP</strong> and <strong class="bold">VNC</strong>. Expects the Boolean <strong class="source-inline">true</strong>/<strong class="source-inline">false</strong> (<strong class="source-inline">1</strong>/<strong class="source-inline">0</strong>).</li>
<li><strong class="source-inline">has_ssl</strong>: Shows services with SSL support. Expects <strong class="source-inline">true</strong> (or <strong class="source-inline">1</strong>) or <strong class="source-inline">false</strong> (or <strong class="source-inline">0</strong>).</li>
<li><strong class="source-inline">hash</strong>: Each page that’s grabbed by Shodan is hashed. This could be handy for looking for pages with the exact same text on them, but you’ll probably use this with the negation dash (<strong class="source-inline">-</strong>) and a zero to skip results where the banners are blank, like this: <strong class="source-inline">-hash:0</strong>.</li>
<li><strong class="source-inline">hostname</strong>: Specify the hostname or just a part of it.</li>
<li><strong class="source-inline">ip</strong>: The same as <strong class="source-inline">net</strong>, this lets you specify an IP range in <strong class="bold">CIDR</strong> format.</li>
<li><strong class="source-inline">isp</strong>: Take a look at a specific ISP’s networks.</li>
<li><strong class="source-inline">net</strong>: The same as <strong class="source-inline">ip</strong> – this lets you specify an IP range in CIDR format.</li>
<li><strong class="source-inline">org</strong>: This is where you specify the organization’s name.</li>
<li><strong class="source-inline">os</strong>: Very handy indeed – specify the operating system.</li>
<li><strong class="source-inline">port</strong>: Check specific ports. Negating this filter is especially useful for finding services that are operating on non-standard ports. For example, <strong class="source-inline">ssh -port:22</strong> will find all instances of SSH on anything other than the standard SSH port.</li>
<li><strong class="source-inline">product</strong>: A crucial option for narrowing down a specific product running the service. For example, <strong class="source-inline">product:Apache -port:80,443</strong> will find any Apache server on non-standard ports.</li>
<li><strong class="source-inline">version</strong>: Useful for targeting specific product version numbers.<p class="callout-heading">Note</p><p class="callout">We’re covering the filters that are available to basic users. There are more sophisticated filters available to small business and enterprise accounts if such a thing is within your budget.</p></li>
</ul>
<p>Let’s take a look at how we can whittle away at our results and home in on what we need. First, let’s say our target is in Mexico City:</p>
<pre class="source-code">city:"Mexico City"</pre>
<p>On second <a id="_idIndexMarker050"/>thought, I want to make sure I cover the region around and including Mexico City. So, I’ll try this instead:</p>
<pre class="source-code">geo:19.58,-99.37,19.21,-98.79</pre>
<p>Now, I want to look for SSH on any non-standard port:</p>
<pre class="source-code">geo:19.58,-99.37,19.21,-98.79 ssh -port:22</pre>
<p>And I only want <strong class="bold">Debian</strong> hosts:</p>
<pre class="source-code">geo:19.58,-99.37,19.21,-98.79 ssh -port:22 os:Debian</pre>
<p>Finally, suppose I know the subnet for my target is <strong class="source-inline">187.248.0.0/17</strong>:</p>
<pre class="source-code">geo:19.58,-99.37,19.21,-98.79 ssh -port:22 os:Debian net:187.248.0.0/17</pre>
<p>With that, I hit <em class="italic">Enter</em> and see what Shodan has in store for me:</p>
<div>
<div class="IMG---Figure" id="_idContainer015">
<img alt="Figure 1.10 – Homing in on my targets " height="509" src="image/Figure_1.10_B17616.jpg" width="1050"/>
</div>
</div>
<p class="figure-caption">Figure 1.10 – Homing in on my targets</p>
<p>When I started looking at the Mexico City region, I had 1.5 <em class="italic">million</em> results to sift through. My fine-tuning <a id="_idIndexMarker051"/>reduced that list to only two servers. This is a fully random example for demonstration purposes – when you’re researching for a specific client, you’ll be trying the <strong class="source-inline">org</strong> filter, perhaps the <strong class="source-inline">asn</strong> filter, and whatever else you have to go on.</p>
<h1 id="_idParaDest-23"><a id="_idTextAnchor022"/>Google’s dark side</h1>
<p>Our last stop for goodies before we arrive at the desk where Kali eagerly awaits is Google. No, we’re not <a id="_idIndexMarker052"/>going to check the weather or find out why we call those spiky animals <em class="italic">porcupines</em> (apparently, it’s the Latin <em class="italic">porcus</em> (hog) and <em class="italic">spina</em> (thorn, spine) –<em class="italic"> </em>who knew?). We’ll leverage the surgical scalpel of Google searching: <em class="italic">operators</em>. Keep the same spirit from Shodan – separate the operator from the query with a colon (<strong class="source-inline">:</strong>) and no spaces. Google, however, allows us to get pretty advanced.</p>
<p class="callout-heading">Badda-bing</p>
<p class="callout">The concepts here apply to the <strong class="bold">Bing</strong> search engine as well (though you’ll want to review the operator <a id="_idIndexMarker053"/>specifics on their help pages). As a distinct search engine, you may find results on Bing that you won’t find on Google, and vice versa. It’s worth checking all your options!</p>
<h2 id="_idParaDest-24"><a id="_idTextAnchor023"/>Google’s advanced operators</h2>
<p>Let’s first discuss what makes up an ordinary web page. Of course, you have the URL to type into your browser and <a id="_idIndexMarker054"/>to share with your friends. Then, you have the title of the page, and the distinction is technical – it will be explicitly formatted this way with the <strong class="source-inline">&lt;title&gt;</strong> tag in HTML. You’ll also have the text of the page, which is basically everything written on the page that isn’t the title or the URL. There are three reasons why we pen testers care about this: </p>
<ul>
<li>Google can find stuff left on pages by administrators who may have neglected to understand the public nature of their posts – including talking about specific clients and the products they manage.</li>
<li>Google can find stuff left on pages by bad guys who may have already compromised your client, a partner, or an employee.</li>
<li>Services with web portals will have signatures that can distinguish them. The use of specific words (such as <strong class="source-inline">admin</strong>) in the URL, or a product, version, or company name in the text of the page, and so on.</li>
</ul>
<p>Google is designed for the average user, using its snazzy algorithm to find what you want, and even what you didn’t realize you wanted. However, it is ready for the advanced user, too. You <a id="_idIndexMarker055"/>just need to know what to say to it. There are two ways of doing this: with operators directly, or within the <strong class="bold">Advanced Search</strong> feature. Let’s take a look at the different operators for direct use:</p>
<ul>
<li><strong class="source-inline">intitle</strong>: Return pages with your query within the page title.</li>
<li><strong class="source-inline">inurl</strong>: Return pages with your query inside the URL to the page itself.</li>
<li><strong class="source-inline">allintitle</strong>: The <strong class="source-inline">allin</strong> queries are special – they will only return results that contain all of your multiple keywords. For example, <strong class="source-inline">allintitle:"Satoshi" "identity" "bitcoin" "conspiracy"</strong> will return pages that contain all four words somewhere in the title, but <em class="italic">not</em> pages that have only three of those words in the title.</li>
<li><strong class="source-inline">allinurl</strong>: This will only return results where all of your terms are contained in the URL.</li>
<li><strong class="source-inline">allintext</strong>: Return only the pages that contain all of your terms in the text of the page.</li>
<li><strong class="source-inline">filetype</strong>: A particularly powerful option that lets you specify the file type. For example, <strong class="source-inline">filetype:pdf</strong> will return PDF documents with your search criteria.</li>
<li><strong class="source-inline">link</strong>: Another special fine-tuning option, this searches for pages that contain links to the URL or domain you specify here.</li>
</ul>
<p>Just like with Shodan, you can negate an option with a dash (<strong class="source-inline">-</strong>). For example, I can look for the word <strong class="source-inline">explorer</strong> and avoid pages about the car with <strong class="source-inline">explorer –ford</strong>. You can also look for <a id="_idIndexMarker056"/>the pages that maybe contain one or more of several terms (as opposed to the <strong class="source-inline">allin</strong> options) with the <strong class="source-inline">OR</strong> operator. For example, the following will only return pages with <em class="italic">all four</em> terms in quotation marks:</p>
<pre class="source-code">allintext:"Satoshi" "identity" "bitcoin" "conspiracy"</pre>
<p>However, the next example will return pages that mention <em class="italic">any</em> of the terms:</p>
<pre class="source-code">"Satoshi" OR "identity" OR "bitcoin" OR "conspiracy"</pre>
<p>A useful shorthand for <strong class="source-inline">OR</strong>, by the way, is the pipe character (<strong class="source-inline">|</strong>). So, this is identical to the previous search:</p>
<pre class="source-code">"Satoshi" | "identity" | "bitcoin" | "conspiracy"</pre>
<h2 id="_idParaDest-25"><a id="_idTextAnchor024"/>The Advanced Search page</h2>
<p>Google has made things <a id="_idIndexMarker057"/>a little more user-friendly – just add <strong class="source-inline">advanced_search</strong> after the <a href="https://google.com">google.com</a> URL, as shown in the following screenshot:</p>
<div>
<div class="IMG---Figure" id="_idContainer016">
<img alt="Figure 1.11 – Google’s Advanced Search window " height="1266" src="image/Figure_1.11_B17616.jpg" width="1338"/>
</div>
</div>
<p class="figure-caption">Figure 1.11 – Google’s Advanced Search window</p>
<p>For some advanced search capabilities, this accomplishes the same thing as putting the operators directly <a id="_idIndexMarker058"/>into the search box. However, narrowing results down to a specific <em class="italic">date range</em> is best done from the results page. First, enter your search query, then, click <strong class="bold">Tools</strong> followed by the <strong class="bold">Any time</strong> dropdown to select a custom range, as shown here:</p>
<div>
<div class="IMG---Figure" id="_idContainer017">
<img alt="Figure 1.12 – Customizing the date range for my results " height="497" src="image/Figure_1.12_B17616.jpg" width="876"/>
</div>
</div>
<p class="figure-caption">Figure 1.12 – Customizing the date range for my results</p>
<p>I remember needing to use the <strong class="source-inline">daterange:</strong> operator with Julian dates. In other words, Christmas Day <a id="_idIndexMarker059"/>of 2020 was on Julian Day <strong class="source-inline">2,459,209</strong>. Trust me, using a graphical calendar is much less annoying.</p>
<h2 id="_idParaDest-26"><a id="_idTextAnchor025"/>Thinking like a dark Googler</h2>
<p>I’ve had a lot of financial organizations as pen test clients. The nature of their business involves a lot of paperwork, so it’s particularly tricky to keep everything tidy. Let’s take a look at a possible Google hacking mission, in this case, digging up financial information. Of course, for your needs, you’ll be using your client’s name or the name of an employee to accompany your fine-tuned search terms.</p>
<p>First, I try the following:</p>
<pre class="source-code">intitle:"index of" "Parent Directory" ".pdf" "statement"</pre>
<p>Let’s break this down. By looking for <strong class="source-inline">index of</strong> with the words <strong class="source-inline">Parent Directory</strong> somewhere on the page, I’ll be finding exposed file directories that are hosted via <strong class="bold">HTTP</strong>/<strong class="bold">S</strong>. I’m also looking for any text with <strong class="source-inline">.pdf</strong> in it, which will catch directories hosting <strong class="bold">PDF</strong> files. Finally, I’m hoping <a id="_idIndexMarker060"/>someone will have put the word <strong class="source-inline">statement</strong> somewhere in their filename. As you can imagine, we’ll probably grab some false positives with this. But you may also find things like this, which I’m fairly certain was <em class="italic">not</em> intended to be sitting on the open web:</p>
<div>
<div class="IMG---Figure" id="_idContainer018">
<img alt="Figure 1.13– The result of searching through public directories " height="825" src="image/Figure_1.13_B17616.jpg" width="745"/>
</div>
</div>
<p class="figure-caption">Figure 1.13– The result of searching through public directories</p>
<p>Looks like someone’s going on a trip! This find didn’t have <strong class="source-inline">statement</strong> in its filename, but the files next to it did. When I click <strong class="bold">Parent Directory</strong> on some of these pages, I end up at the home page for the domain or a <strong class="source-inline">404</strong> page, strongly suggesting that these exposed directories are accidents. There’s nothing quite like a false sense of security to help you out in your endeavor. Finding an employee’s passports, tax returns, and the like, before you even sit down with your Kali toolkit, is a powerful message for your client’s management.</p>
<p>There are plenty of resources <a id="_idIndexMarker061"/>online to help you with sneaky Google searches. The <strong class="bold">Google Hacking Database</strong> over at the <strong class="bold">Exploit Database</strong> (<a href="https://exploit-db.com">exploit-db.com</a>) is an excellent place to check out. I won’t rehash all the different searches you could try. The key lesson here is to apply whatever information you have on your client <a id="_idIndexMarker062"/>and try thinking in terms of how a resource presents <a id="_idIndexMarker063"/>itself to the internet. For example, I had a client for whom my initial research suggested the presence of a <strong class="bold">Remote Desktop</strong> portal. Searching the client’s domain with this was helpful:</p>
<pre class="source-code">inurl:RDWeb/Pages/en-US/login.aspx</pre>
<p>How did I come up with that? Simple: I researched how these devices work. Find one, talk to it with your browser, and build a Google query with your client’s information. Have you considered your client’s IT support? We all need to ask for help now and then. Perhaps some of the IT staff at your client have asked for support online. <em class="italic">Hmm, I'm not sure</em>, a helpful compatriot replies, <em class="italic">can you upload a packet dump from the device? </em>Next thing you know, information deeply internal to your client has been exfiltrated to the web. I’ve seen it with clients more times than I’d like to admit. Just look for those communities and try combining parts of the URLs with <strong class="source-inline">inurl</strong>. For example, if you see your client’s name pop up along with the following, then you have a head start on the security software they may be using:</p>
<pre class="source-code">inurl:"broadcom.com/enterprisesoftware/communities" </pre>
<p>An important skill with something as inherently hit-or-miss as OSINT is <em class="italic">outside-the-box</em> thinking. Suppose you’ve tried all of the Google tricks you can think of, looking for different vendors and URL strings, and you’ve come up dry. Well, do you know anything about the people who work there? I once had a client whose IT administrator had a unique name in her personal email address. </p>
<p>It didn’t take long before I linked this to a different username that she had used on Yahoo! in the past. I took this username and tried all kinds of search combinations, and boom – an obscure forum for the administrators of a highly specific operating system in an enterprise environment had posts from a user with this same name. She was careful enough to avoid mentioning her employer, which is why the usual searches described previously didn’t get me there. But I was able to connect the dots and determine she was indeed referring to the configuration of these hosts inside the network of my client, and later I could even correlate independent findings with information in these public posts. The connection that brought me to that information was just her use of an old <strong class="bold">Yahoo!</strong> <strong class="bold">Messenger</strong> name when anonymously <a id="_idIndexMarker064"/>discussing her IT work. Needless to say, she was a bit surprised that I had found it. On a different engagement, I took to Google from the other direction – I was already inside the network and had a foothold on a domain controller. I started grabbing password hashes, which is a massive finding in its own right for my report. However, I wondered what would happen if I tried punching some of these hashes into Google. Sure enough, I found a site where hackers share their loot and my client had been compromised. This was an additional tidbit to enhance the report and helped them get the ball rolling on determining how that unauthorized access had occurred.</p>
<p class="callout-heading">Here’s an idea! </p>
<p class="callout">Think about how people create passwords, generate some hashes corresponding to your guesses, and search Google for those hashes. Usually (and hopefully), you’ll come up dry. The most common passwords, such as <strong class="source-inline">12345</strong> and <strong class="source-inline">iloveyou</strong>, are already out there, so think like someone who works for your client and lives near there. For example, one thing I learned while working with companies in the state of Ohio is that Ohioans <em class="italic">love</em> college football. Hey, most Midwesterners do. I had a disturbing number of positive hits when I generated hashes based on the word <strong class="source-inline">Buckeyes</strong>.</p>
<p>Hey, order’s up. Grab your coffee and bagel, leave the drive-thru, and get to the office – we got a good amount of recon done with Google and our smartphone, but now it’s time to sit down at the <a id="_idIndexMarker065"/>helm of Kali and see how the folks at <strong class="bold">Offensive Security</strong> have moved its toolset into this decade.</p>
<h1 id="_idParaDest-27"><a id="_idTextAnchor026"/>Diving into OSINT with Kali</h1>
<p>Finally, we have arrived at our desk. Kali Linux has been waiting patiently while we played around with the search engines, but now it’s time to get down to business. As we continue our OSINT journey with Kali, it’s helpful to understand the fundamentals. For example, you may have <a id="_idIndexMarker066"/>noticed during your time playing with Shodan that there is an API available. You may have also thought to yourself, <em class="italic">this is cool, but can't we automate it?</em> Perhaps, while you were playing with Google searches, you were stopped by a CAPTCHA with the <em class="italic">suspicious traffic</em> alert. Indeed, Google knows that their search engine can be used for nefarious purposes and some of the methods discussed in older Google hacking textbooks don’t even work anymore (for example, you’ll get zero results when looking for numbers in a range from <strong class="source-inline">4,147,000,000,000,000</strong> to <strong class="source-inline">4,147,999,999,999,999</strong>, since that could pick up on <strong class="bold">Visa</strong> card dumps). Well, this is a Kali book and there is a comprehensive OSINT toolkit available to you. Let’s get <a id="_idIndexMarker067"/>to work and take this open source stuff to the next level.</p>
<h2 id="_idParaDest-28"><a id="_idTextAnchor027"/>The OSINT analysis tools folder</h2>
<p>There’s a simple reason why Kali Linux is the premier pen testing distro: it just makes things so easy. Everything is neatly organized with just a right-click on the desktop, ordered by the <a id="_idIndexMarker068"/>different phases of your assessment. It’s like hacking candy from a baby. Another thing to note about Kali 2021.1 is that it puts emphasis on looking slick. If Neo from <em class="italic">The Matrix</em>, wearing his iconic trench coat and black glasses, was an operating system, it would probably have these same appearance settings. It’s a looker, but it doesn’t really do much for printing examples for you, dear reader. Not to mention, the dark blue on a black background with transparency enabled, giving us that blue-black dragon wallpaper bleeding through our terminal window? Hello, eye doctor. So, I have tweaked mine to make it easier to look at in our book. In the terminal, I’m going with BlackOnWhite with 0% transparency. You don’t have to change yours – just know it’s Kali 2021.1 and it should work the same.</p>
<p>Without further ado, let’s right-click on our desktop and find <strong class="source-inline">OSINT Analysis</strong>, a folder found under <strong class="source-inline">01 – Information Gathering</strong>, as shown here:</p>
<div>
<div class="IMG---Figure" id="_idContainer019">
<img alt="Figure 1.14 – Right-clicking the menu on Kali’s desktop " height="929" src="image/Figure_1.14_B17616.jpg" width="1650"/>
</div>
</div>
<p class="figure-caption">Figure 1.14 – Right-clicking the menu on Kali’s desktop</p>
<p>First, let’s clarify the distinction that renders <strong class="source-inline">OSINT Analysis</strong> a subfolder of <strong class="source-inline">Information Gathering</strong>. This goes back to the beginning of the chapter when we talked about passive versus active information gathering. Look at the other subfolders under <strong class="source-inline">01 – Information Gathering</strong>: <strong class="source-inline">Live Host Identification</strong>, <strong class="source-inline">Network &amp; Port Scanners</strong>, the various protocol analysis folders, and so on. There’s nothing passive and quiet about firing off thousands of <strong class="source-inline">SYN</strong> packets at your target’s network, and importantly, it isn’t open source analysis because <em class="italic">you</em> are conducting the analysis in real time – you aren’t <a id="_idIndexMarker069"/>relying on open source data sources. From the perspective of your target, the information gathering phase is like hearing rustling in the bushes. The <strong class="source-inline">OSINT Analysis</strong> toolset will not make any noise that your client can hear.</p>
<p>Keep in mind, just because most of the other tools in Kali aren’t under <strong class="source-inline">01 – Information Gathering</strong>, doesn’t mean they are all noisy and only to be used during active phases of the engagement. A notable example that we will discuss is wireless analysis: all the Wi-Fi goodies are contained under <strong class="source-inline">06 – Wireless Attacks</strong>, and indeed, the tools there can be used for active attacking. However, there’s nothing to stop us from merely listening to the radio signals around us (or as the old-school users of American Citizens Band radio would say, <em class="italic">gettin' our ears on</em>), and this would qualify as passive reconnaissance. But enough about gathering information about low-level network stuff. Let’s take a look at a true magician of OSINT.</p>
<h2 id="_idParaDest-29"><a id="_idTextAnchor028"/>Transforming your perspective – Maltego</h2>
<p>OSINT isn’t just for pen-testers – it’s an important part of projects ranging from market research to private investigations to criminal investigations. Accordingly, some smart folks realized that <a id="_idIndexMarker070"/>providing an automated, intuitive, and just downright beautiful interface for this activity is a product in demand. Enter <strong class="bold">Maltego</strong>.</p>
<p>I remember Maltego’s more humble years, but these days, it’s a fully-fledged professional product. Indeed, if you have the money and it’s part of your work, it’s a worthy investment. Thankfully, Maltego caters to its community of faithful users with its Community Edition (<strong class="bold">Maltego</strong> <strong class="bold">CE</strong>). Maltego CE is completely free, but there are some feature limitations, and the <a id="_idIndexMarker071"/>software licensing requires that it is not used for commercial purposes. We’re going to work on the free Community Edition in our book, as it’s immediately accessible to any Kali user – but if you are (or planning to become) a professional pen-tester with commercial needs, make sure you review and abide by any software licensing agreements. With that said, dig into <strong class="source-inline">01 – Information Gathering</strong> | <strong class="source-inline">OSINT Analysis</strong>, and click <strong class="bold">maltego</strong>. You should see this splash screen:</p>
<div>
<div class="IMG---Figure" id="_idContainer020">
<img alt="Figure 1.15 – The Maltego splash screen " height="699" src="image/Figure_1.15_B17616.jpg" width="843"/>
</div>
</div>
<p class="figure-caption">Figure 1.15 – The Maltego splash screen</p>
<p>Of course, we’re going to click the <strong class="bold">Run</strong> button under <strong class="bold">Maltego CE (Free)</strong>. Then, you’ll have the opportunity to read and agree to the license agreement and get your community account <a id="_idIndexMarker072"/>registered. During this phase, you’ll see the word <strong class="bold">transforms</strong>: the product is downloading and installing transforms, and you’ll end up in the transforms hub. Transforms are the soul of Maltego, so let’s explore what they are and how we leverage them.</p>
<h2 id="_idParaDest-30"><a id="_idTextAnchor029"/>Entities and transforms and graphs, oh my</h2>
<p>Put simply, a <em class="italic">transform</em> is a little program that takes some piece of information that we already have about <a id="_idIndexMarker073"/>our target (for example, a person’s name) and digs up more information. Each of these <a id="_idIndexMarker074"/>pieces of information is an <em class="italic">entity</em>, and when we supply our entity information to Maltego and it spits out more entities, that process is called <em class="italic">running a transform</em>. This is the process that ultimately allows us to visualize any relationships between <a id="_idIndexMarker075"/>entities. It’s useful to remember that this transform program isn’t actually local to your machine (hence the necessity to register for an account). It runs on a Maltego server, which is using the transform code plus the entities you provided it with against open source data. Finally, the canvas on which you will paint your OSINT masterpiece is the <em class="italic">graph</em>, a workspace where the relationships between entities are visualized and you can point-and-click to run additional transforms. Let’s jump in.</p>
<p>Once you’re up and running, you should be looking at a <strong class="bold">Home</strong> tab with a <strong class="bold">Start Page</strong> and a <strong class="bold">Transform Hub </strong>button, as shown in the following screenshot:</p>
<div>
<div class="IMG---Figure" id="_idContainer021">
<img alt="Figure 1.16 – The rather busy Home tab " height="872" src="image/Figure_1.16_B17616.jpg" width="1096"/>
</div>
</div>
<p class="figure-caption">Figure 1.16 – The rather busy Home tab</p>
<p>Your installation already comes with the basics, but other organizations or individuals are often working on <a id="_idIndexMarker076"/>their own transforms that may be available to you. It’s worth checking <a id="_idIndexMarker077"/>out what you can grab. Use the <strong class="bold">FILTER</strong> box at the top to select all <strong class="bold">Data Categories</strong>, and then <a id="_idIndexMarker078"/>select <strong class="bold">Free</strong> under <strong class="bold">Pricing</strong>. Finally, click <strong class="bold">[NOT INSTALLED]</strong> at the top. Let’s see what pops up:</p>
<div>
<div class="IMG---Figure" id="_idContainer022">
<img alt="Figure 1.17 – Transform Hub partners in Maltego " height="432" src="image/Figure_1.17_B17616.jpg" width="1091"/>
</div>
</div>
<p class="figure-caption">Figure 1.17 – Transform Hub partners in Maltego</p>
<p>What you pick will depend on your needs. Pay close attention to something like <strong class="bold">Social Links CE</strong> for social engineering efforts, <strong class="bold">OCCRP Aleph</strong> for information gathering, and <strong class="bold">ATT&amp;CK – MISP</strong> for the analysis of your target’s attack surface. For now, let’s run through the basics with a real-world client. Hit <em class="italic">Ctrl</em> + <em class="italic">T</em> to create a new graph. A blank workspace will appear where your graph will be built. Look over to the left at the <strong class="bold">Entity Palette</strong>, as shown here:</p>
<div>
<div class="IMG---Figure" id="_idContainer023">
<img alt="Figure 1.18 – The Entity Palette in Maltego " height="539" src="image/Figure_1.18_B17616.jpg" width="380"/>
</div>
</div>
<p class="figure-caption">Figure 1.18 – The Entity Palette in Maltego</p>
<p>Go ahead and browse the different entities. Here we can see just how powerfully Maltego caters to different investigation types (anyone want to dig up information on a robbery?), and some of these you may never use. For the pen-tester, a very common entity category is <strong class="bold">Infrastructure</strong>. For my example, I’m going to click and drag <strong class="bold">Domain</strong> over into the blank graph space. This will <a id="_idIndexMarker079"/>create an entity icon with a domain in the middle. Whenever you create <a id="_idIndexMarker080"/>an entity in your graph, it will have a default <a id="_idIndexMarker081"/>entry for it (it doesn’t prompt you). So, you’ll double-click on the default text to put in the domain you’re researching. Now, right-click on your domain entity to see the transforms available for it, as shown here:</p>
<div>
<div class="IMG---Figure" id="_idContainer024">
<img alt="Figure 1.19 – The Run Transforms menu " height="378" src="image/Figure_1.19_B17616.jpg" width="416"/>
</div>
</div>
<p class="figure-caption">Figure 1.19 – The Run Transforms menu</p>
<p>At the top of the list, you’ll <a id="_idIndexMarker082"/>see transforms built by Maltego’s transform <a id="_idIndexMarker083"/>partners (other organizations). Some of them require an account <a id="_idIndexMarker084"/>or an API key to run the transform, and some of them are free. As always, your needs will <a id="_idIndexMarker085"/>dictate how deep this gets.</p>
<p>Let’s start exploring with my example domain entity. I tried <strong class="source-inline">To DNS Name – MX (mail server)</strong>. Here are my results:</p>
<div>
<div class="IMG---Figure" id="_idContainer025">
<img alt="Figure 1.20 – The graph after running the MX transform " height="660" src="image/Figure_1.20_B17616.jpg" width="829"/>
</div>
</div>
<p class="figure-caption">Figure 1.20 – The graph after running the MX transform</p>
<p>Now, we see a new entity has appeared – an MX server. An arrow is drawn from our original domain entity to <a id="_idIndexMarker086"/>demonstrate the <em class="italic">relationship</em> between the two. I’m confident that you have a <a id="_idIndexMarker087"/>good idea of where to go next: that’s right, run some more <a id="_idIndexMarker088"/>transforms! Click on the domain entity that you provided. Then, check out the <strong class="bold">Run View</strong> menu over at the lower left. Try running one of the <strong class="bold">Footprint</strong> transforms, as shown here:</p>
<div>
<div class="IMG---Figure" id="_idContainer026">
<img alt="Figure 1.21 – Finding the Footprint transforms after selecting the domain entity " height="279" src="image/Figure_1.21_B17616.jpg" width="654"/>
</div>
</div>
<p class="figure-caption">Figure 1.21 – Finding the Footprint transforms after selecting the domain entity</p>
<p>Maltego will start doing some of the basic digging for you. What’s nice about the Footprint transforms is that you’ll get to validate some of the returned data while it’s running, as shown here:</p>
<div>
<div class="IMG---Figure" id="_idContainer027">
<img alt="Figure 1.22 – Picking and choosing the relevant entities " height="242" src="image/Figure_1.22_B17616.jpg" width="398"/>
</div>
</div>
<p class="figure-caption">Figure 1.22 – Picking and choosing the relevant entities</p>
<p>Now, watch as all of these <a id="_idIndexMarker089"/>new tasty entities appear. In my testing shown here, I discovered email<a id="_idIndexMarker090"/> addresses, IP addresses, netblocks, and ASNs. I even discovered the <a id="_idIndexMarker091"/>location of a satellite dish responsible for one of their remote locations – that one was surprising.</p>
<p>At this point, I don’t even need to tell you what to do next – you’ve just discovered the start of a long and scenic path of discovery for your client. Try jumping into those other transforms. The important <a id="_idIndexMarker092"/>lesson here, young hackerlings, is discovering perspectives about your <a id="_idIndexMarker093"/>target that will inform other efforts. Let’s look at <strong class="bold">social engineering</strong> (<strong class="bold">SE</strong>) as an example. After running a few transforms <a id="_idIndexMarker094"/>and adjusting my graph layout a bit, I found this company tech’s email address linked to <a id="_idIndexMarker095"/>numerous domains, including ones I was just learning about at the time:</p>
<div>
<div class="IMG---Figure" id="_idContainer028">
<img alt="Figure 1.23 – Different entity types and their relationships exposed " height="596" src="image/Figure_1.23_B17616.jpg" width="1183"/>
</div>
</div>
<p class="figure-caption">Figure 1.23 – Different entity types and their relationships exposed</p>
<p>Imagine the SE attacks I could leverage with that address, exploiting knowledge that the target may not even realize is associated with these entities, as laid out by Maltego. Consider that satellite dish I mentioned earlier – I even found a <strong class="bold">Federal Communications Commission</strong> (<strong class="bold">FCC</strong>) filing related to the company that owns the dish. The FCC document was a public notice, and hence readily available on the internet – but it doesn’t contain <a id="_idIndexMarker096"/>any information about my client! It’s <em class="italic">linked</em> to my client via an ASN discovered with Maltego. Why should we care? Once again, social engineering. A well-formed email or well-placed telephone call (I found dozens of phone numbers with Maltego, by the way), pretending to be affiliated with the company that provides the satellite communications? Heck, maybe it wouldn’t work at all. Doesn’t matter – it’s the <em class="italic">brainstorming</em> that matters, and Maltego can fuel your imagination.</p>
<h2 id="_idParaDest-31"><a id="_idTextAnchor030"/>OSINT with Spiderfoot</h2>
<p><em class="italic">Surely there's some sort of open source alternative to manually poking around the internet</em>, you wonder. <em class="italic">Maltego is cool, but it's a bit much for my needs</em>, you bemoan. Have no fear, for I have saved the best for last: my personal go-to, <strong class="bold">Spiderfoot</strong>. Some of you may <a id="_idIndexMarker097"/>have already clicked it, considering it’s right there in the <strong class="source-inline">OSINT Analysis</strong> menu. All that happens is it executes <strong class="source-inline">spiderfoot –-help</strong>, so you can review the options in the command window. I think this is <a id="_idIndexMarker098"/>just Kali’s way of reminding us that Spiderfoot is indeed there. From there, you may have even executed <strong class="source-inline">spiderfoot –M</strong> so you can get a look at the available modules and started to build your first command. I’m going to stop you right there – the real prize in this tool is its web interface. Just run this command: <strong class="source-inline">spiderfoot –l 127.0.0.1:5009</strong>. Then, pull out a web browser and visit <strong class="source-inline">http://127.0.0.1:5009</strong>. You can also host this across the network, as I did here:</p>
<div>
<div class="IMG---Figure" id="_idContainer029">
<img alt="Figure 1.24 – Starting the Spiderfoot listener " height="482" src="image/Figure_1.24_B17616.jpg" width="866"/>
</div>
</div>
<p class="figure-caption">Figure 1.24 – Starting the Spiderfoot listener</p>
<p class="callout-heading">Note</p>
<p class="callout">Be aware that access is not authenticated – run over your private network at your own risk.</p>
<p>Once you’re in the web interface, click <strong class="bold">New Scan</strong>. You’ll see three tabs that allow you to define how your scan will work: <strong class="bold">By Use Case</strong>, <strong class="bold">By Required Data</strong>, and <strong class="bold">By Module</strong>. The <strong class="bold">By Module</strong> tab is useful for your own custom modules or when you need to fine-tune Spiderfoot’s behavior, and <strong class="bold">By Required Data</strong> is basically like a modules listing, but in a more descriptive way. My standard choice is one of the <em class="italic">use cases</em>. Notice how it <a id="_idIndexMarker099"/>distinguishes the <strong class="bold">Passive</strong> option – perfect for removing the guesswork about whether your target is getting touched or not. For my assessment, I’m running a quick footprint:</p>
<div>
<div class="IMG---Figure" id="_idContainer030">
<img alt="Figure 1.25 – Spiderfoot use cases " height="1194" src="image/Figure_1.25_B17616.jpg" width="1477"/>
</div>
</div>
<p class="figure-caption">Figure 1.25 – Spiderfoot use cases</p>
<p>Just click <strong class="bold">Run Scan</strong>, sit back, and relax. This is a good time for a coffee break. You can also watch the progress of the scan in real time. The individual data points are called <em class="italic">elements</em>, and you can review them while the scan is running, if you’d like. I prefer to let it run in full so that any relationships between the elements can be established. The <strong class="bold">Status</strong> screen will categorize elements by the module type that discovered them, as shown here:</p>
<div>
<div class="IMG---Figure" id="_idContainer031">
<img alt="Figure 1.26 – The Status graph during a Spiderfoot scan " height="637" src="image/Figure_1.26_B17616.jpg" width="1098"/>
</div>
</div>
<p class="figure-caption">Figure 1.26 – The Status graph during a Spiderfoot scan</p>
<p>Finally, for the visual geek in all of us, there is a graph layout as well. Each element displayed can be <a id="_idIndexMarker100"/>dragged, so with a little work, you can create your own layout to highlight relationships between elements. For those larger clients, however, it can look like a mess:</p>
<div>
<div class="IMG---Figure" id="_idContainer032">
<img alt="Figure 1.27 – Spiderfoot’s web of relationships " height="986" src="image/Figure_1.27_B17616.jpg" width="1650"/>
</div>
</div>
<p class="figure-caption">Figure 1.27 – Spiderfoot’s web of relationships</p>
<p>The visual representation of your OSINT data points and their relationships is definitely something at which <a id="_idIndexMarker101"/>Maltego excels. Spiderfoot is fast and easy, however, so it might be perfect for getting the ball rolling on your intelligence gathering.</p>
<h1 id="_idParaDest-32"><a id="_idTextAnchor031"/>Summary</h1>
<p>In this chapter, we jumped into the fun (and disconcerting) world of OSINT. We started our journey by taking a look at what we can find with just our web browser: examining our target’s sites, sending weird requests to see whether we can prompt some funny response that reveals information, and checking out social media and other public resources. We reviewed a few services on the internet that scan and gather this information for us to see whether we can get a head start on our enumeration phase, looking for things such as insecure <strong class="bold">SSL</strong>/<strong class="bold">TLS</strong>, open ports, and just generally anything that’s exposed to the web that would usually take some time and probing to discover on our own. We took a look at what Google can find for us if we’re willing to think outside of the box, and finally, we cracked open our copy of Kali to see what kind of automation is available to us for applying these principles. Of course, this is just the surface of what can be a very sophisticated and surprisingly effective phase of any assessment, but we’ve started training our brains to think a little bit differently about the things our client may take for granted. We’ve dipped our toes into the waters of our client’s information – now, let’s get a little splashy. In the next chapter, we’re going to start probing the network and getting a feel for the insider’s perspective.</p>
<h1 id="_idParaDest-33"><a id="_idTextAnchor032"/>Questions</h1>
<p>Answer the following questions to test your knowledge of this chapter:</p>
<ol>
<li>What is the distinction, if any, between “passive recon” and “OSINT?”</li>
<li>What are the two primary considerations when evaluating the risk of a vulnerability?</li>
<li>The program that works within Maltego by taking an entity as input and outputs more related entities is called a ______.</li>
<li>The maxim which states that we should always assume the enemy knows the system is called _______.</li>
<li>Banner grabbing is never considered a finding on a pen test report. (True | False)</li>
</ol>
</div>
</div></body></html>