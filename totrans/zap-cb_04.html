<html><head></head><body>
<div class="IMG---Figure" id="_idContainer126">
<h1 class="chapter-number" id="_idParaDest-121"><a id="_idTextAnchor142"/><span class="koboSpan" id="kobo.1.1">4</span></h1>
<h1 id="_idParaDest-122"><a id="_idTextAnchor143"/><span class="koboSpan" id="kobo.2.1">Authentication and Authorization Testing</span></h1>
<p><span class="koboSpan" id="kobo.3.1">Welcome to </span><a href="B18829_04.xhtml#_idTextAnchor142"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.4.1">Chapter 4</span></em></span></a><span class="koboSpan" id="kobo.5.1">! </span><span class="koboSpan" id="kobo.5.2">We are as excited as you that you have gotten to this chapter. </span><span class="koboSpan" id="kobo.5.3">In this chapter, we will cover numerous topics surrounding authentication and authorization testing to learn more about the varying ways to attack these mechanisms. </span><span class="koboSpan" id="kobo.5.4">Authentication is the process of verifying the validity of the identity of who’s attempting to access a system or application. </span><span class="koboSpan" id="kobo.5.5">Authorization also helps us verify that a requested action or service is approved for a </span><span class="No-Break"><span class="koboSpan" id="kobo.6.1">specific entity.</span></span></p>
<p><span class="koboSpan" id="kobo.7.1">In this chapter, we will cover the </span><span class="No-Break"><span class="koboSpan" id="kobo.8.1">following recipes:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.9.1">Testing for </span><span class="No-Break"><span class="koboSpan" id="kobo.10.1">Bypassing Authentication</span></span></li>
<li><span class="koboSpan" id="kobo.11.1">Testing for Credentials Transported over an </span><span class="No-Break"><span class="koboSpan" id="kobo.12.1">Encrypted Channel</span></span></li>
<li><span class="koboSpan" id="kobo.13.1">Testing for </span><span class="No-Break"><span class="koboSpan" id="kobo.14.1">Default Credentials</span></span></li>
<li><span class="koboSpan" id="kobo.15.1">Testing Directory Traversal </span><span class="No-Break"><span class="koboSpan" id="kobo.16.1">File Include</span></span></li>
<li><span class="koboSpan" id="kobo.17.1">Testing for Privilege Escalation and Bypassing </span><span class="No-Break"><span class="koboSpan" id="kobo.18.1">Authorization Schema</span></span></li>
<li><span class="koboSpan" id="kobo.19.1">Testing for Insecure Direct </span><span class="No-Break"><span class="koboSpan" id="kobo.20.1">Object References</span></span></li>
</ul>
<h1 id="_idParaDest-123"><a id="_idTextAnchor144"/><span class="koboSpan" id="kobo.21.1">Technical requirements</span></h1>
<p><span class="koboSpan" id="kobo.22.1">For this chapter, it is required that you install the OWASP ZAP and OWASP Juice Shop on your machine, as you want to be able to intercept the traffic between your browser and OWASP Juice Shop </span><span class="No-Break"><span class="koboSpan" id="kobo.23.1">using ZAP.</span></span></p>
<h1 id="_idParaDest-124"><a id="_idTextAnchor145"/><span class="koboSpan" id="kobo.24.1">Testing for Bypassing Authentication</span></h1>
<p><span class="koboSpan" id="kobo.25.1">The goal of an authentication schema is to validate the identity of the user being authenticated. </span><span class="koboSpan" id="kobo.25.2">Examining the authentication function starts with understanding how the authentication </span><a id="_idIndexMarker219"/><span class="koboSpan" id="kobo.26.1">process validates the user account. </span><span class="koboSpan" id="kobo.26.2">When an authentication schema is vulnerable, attackers are able to bypass the </span><span class="No-Break"><span class="koboSpan" id="kobo.27.1">authentication process.</span></span></p>
<p><span class="koboSpan" id="kobo.28.1">There are multiple methods that can be used to bypass the authentication schema. </span><span class="koboSpan" id="kobo.28.2">Some of the methods to bypass include (but are not limited to) intercepting authentication requests if the application utilizes weak encryption, not correctly implementing input validation (which makes injection attacks possible), predicting session IDs if they follow a certain pattern, </span><span class="No-Break"><span class="koboSpan" id="kobo.29.1">and misconfigurations.</span></span><a id="_idTextAnchor146"/></p>
<h2 id="_idParaDest-125"><a id="_idTextAnchor147"/><span class="koboSpan" id="kobo.30.1">Getting ready</span></h2>
<p><span class="koboSpan" id="kobo.31.1">To prepare for this recipe, Juice Shop must be running, and ZAP should be intercepting the traffic between the browser and </span><span class="No-Break"><span class="koboSpan" id="kobo.32.1">Juice Shop.</span></span><a id="_idTextAnchor148"/></p>
<h2 id="_idParaDest-126"><a id="_idTextAnchor149"/><span class="koboSpan" id="kobo.33.1">How to do it…</span></h2>
<p><span class="koboSpan" id="kobo.34.1">In this recipe, we will bypass the authentication schema by performing a basic SQL injection attack to log in to the </span><span class="No-Break"><span class="koboSpan" id="kobo.35.1">administrator account.</span></span></p>
<p><span class="koboSpan" id="kobo.36.1">To start the lab, please follow </span><span class="No-Break"><span class="koboSpan" id="kobo.37.1">these steps:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.38.1">Navigate to the login page of </span><span class="No-Break"><span class="koboSpan" id="kobo.39.1">Juice Shop.</span></span></li>
<li><span class="koboSpan" id="kobo.40.1">Open ZAP and </span><em class="italic"><span class="koboSpan" id="kobo.41.1">set break on all requests and responses</span></em><span class="koboSpan" id="kobo.42.1"> by clicking on the green circle on the top menu, which will make it change color to red, as seen in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.43.1">Figure 4</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.44.1">.1</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.45.1">:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer104">
<span class="koboSpan" id="kobo.46.1"><img alt="Figure 4.1 – Set breakpoint button" src="image/Figure_04.01_B18829.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.47.1">Figure 4.1 – Set breakpoint button</span></p>
<ol>
<li value="3"><span class="koboSpan" id="kobo.48.1">Open the Juice Shop application again, enter an apostrophe (</span><strong class="source-inline"><span class="koboSpan" id="kobo.49.1">'</span></strong><span class="koboSpan" id="kobo.50.1">) in the username and password section, and press </span><em class="italic"><span class="koboSpan" id="kobo.51.1">Enter</span></em><span class="koboSpan" id="kobo.52.1"> (</span><em class="italic"><span class="koboSpan" id="kobo.53.1">return</span></em><span class="koboSpan" id="kobo.54.1"> in macOS). </span><span class="koboSpan" id="kobo.54.2">You will see the request </span><span class="No-Break"><span class="koboSpan" id="kobo.55.1">is stopped.</span></span></li>
<li><span class="koboSpan" id="kobo.56.1">Click on </span><strong class="bold"><span class="koboSpan" id="kobo.57.1">Step</span></strong><span class="koboSpan" id="kobo.58.1"> four or </span><span class="No-Break"><span class="koboSpan" id="kobo.59.1">five times.</span></span></li>
</ol>
<p><span class="koboSpan" id="kobo.60.1">The goal is </span><a id="_idIndexMarker220"/><span class="koboSpan" id="kobo.61.1">to see the response of the request that contains the apostrophe username and password. </span><span class="koboSpan" id="kobo.61.2">In </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.62.1">Figure 4</span></em></span><em class="italic"><span class="koboSpan" id="kobo.63.1">.2</span></em><span class="koboSpan" id="kobo.64.1">, we can see </span><span class="No-Break"><span class="koboSpan" id="kobo.65.1">the request:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer105">
<span class="koboSpan" id="kobo.66.1"><img alt="Figure 4.2 – Request with username and password fields" src="image/Figure_04.02_B18829.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.67.1">Figure 4.2 – Request with username and password fields</span></p>
<p><span class="koboSpan" id="kobo.68.1">In </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.69.1">Figure 4</span></em></span><em class="italic"><span class="koboSpan" id="kobo.70.1">.3</span></em><span class="koboSpan" id="kobo.71.1">, we can see </span><span class="No-Break"><span class="koboSpan" id="kobo.72.1">the response:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer106">
<span class="koboSpan" id="kobo.73.1"><img alt="Figure 4.3 – Response showcasing an error" src="image/Figure_04.03_B18829.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.74.1">Figure 4.3 – Response showcasing an error</span></p>
<p><span class="koboSpan" id="kobo.75.1">You can see </span><a id="_idIndexMarker221"/><span class="koboSpan" id="kobo.76.1">that the response contains the type of database that is being used and the SQL </span><span class="No-Break"><span class="koboSpan" id="kobo.77.1">query submitted.</span></span></p>
<ol>
<li value="5"><span class="koboSpan" id="kobo.78.1">This information should not be shown to a user. </span><span class="koboSpan" id="kobo.78.2">Click on </span><strong class="bold"><span class="koboSpan" id="kobo.79.1">Continue</span></strong><span class="koboSpan" id="kobo.80.1">, and you will see the </span><strong class="source-inline"><span class="koboSpan" id="kobo.81.1">"[object Object]"</span></strong><span class="koboSpan" id="kobo.82.1"> error </span><span class="No-Break"><span class="koboSpan" id="kobo.83.1">under </span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.84.1">Login</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.85.1">.</span></span></li>
</ol>
<p><span class="koboSpan" id="kobo.86.1">By seeing all of this, we can tell that the website is vulnerable to </span><span class="No-Break"><span class="koboSpan" id="kobo.87.1">SQL injections.</span></span></p>
<ol>
<li value="6"><span class="koboSpan" id="kobo.88.1">Now, enter </span><strong class="source-inline"><span class="koboSpan" id="kobo.89.1">' or 1=1 --+</span><a id="_idTextAnchor150"/></strong><span class="koboSpan" id="kobo.90.1"> in the username field and any character in the </span><span class="No-Break"><span class="koboSpan" id="kobo.91.1">password field.</span></span></li>
</ol>
<p><span class="koboSpan" id="kobo.92.1">Because the </span><strong class="source-inline"><span class="koboSpan" id="kobo.93.1">1=1</span></strong><span class="koboSpan" id="kobo.94.1"> statement is true, the SQL injection works. </span><span class="koboSpan" id="kobo.94.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.95.1">--</span></strong><span class="koboSpan" id="kobo.96.1"> symbols (dashes) comment everything after the query statement from the backend. </span><span class="koboSpan" id="kobo.96.2">In this case, the password will be </span><span class="No-Break"><span class="koboSpan" id="kobo.97.1">commented out.</span></span></p>
<ol>
<li value="7"><span class="koboSpan" id="kobo.98.1">Click on </span><strong class="bold"><span class="koboSpan" id="kobo.99.1">Login</span></strong><span class="koboSpan" id="kobo.100.1"> to see that the SQL injection worked by showing whether the login </span><span class="No-Break"><span class="koboSpan" id="kobo.101.1">was successful.</span></span></li>
</ol>
<p><span class="koboSpan" id="kobo.102.1">If you click on </span><strong class="bold"><span class="koboSpan" id="kobo.103.1">Account</span></strong><span class="koboSpan" id="kobo.104.1"> in the top-right menu, you can see that we are logged in as </span><strong class="source-inline"><span class="koboSpan" id="kobo.105.1">admin@juice-sh.op</span></strong><span class="koboSpan" id="kobo.106.1">, as seen in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.107.1">Figure 4</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.108.1">.4</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.109.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer107">
<span class="koboSpan" id="kobo.110.1"><img alt="Figure 4.4 – Account login" src="image/Figure_04.04_B18829.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.111.1">Figure 4.4 – Account login</span></p>
<h2 id="_idParaDest-127"><span class="koboSpan" id="kobo.112.1">H</span><a id="_idTextAnchor151"/><span class="koboSpan" id="kobo.113.1">ow it works…</span></h2>
<p><span class="koboSpan" id="kobo.114.1">In this recipe, we performed a SQL injection to bypass the authentication schema. </span><span class="koboSpan" id="kobo.114.2">SQL injection is </span><a id="_idIndexMarker222"/><span class="koboSpan" id="kobo.115.1">one of the methods used to bypass the authentication process. </span><span class="koboSpan" id="kobo.115.2">It is possible to perform SQL injection to bypass the authentication if the application does not validate the </span><span class="No-Break"><span class="koboSpan" id="kobo.116.1">user’s input.</span></span></p>
<h1 id="_idParaDest-128"><a id="_idTextAnchor152"/><span class="koboSpan" id="kobo.117.1">Testing for Credentials Transported over an Encrypted Channel</span></h1>
<p><span class="koboSpan" id="kobo.118.1">In this recipe, we will walk through how to verify that the user’s login username and password </span><a id="_idIndexMarker223"/><span class="koboSpan" id="kobo.119.1">are transmitted </span><a id="_idIndexMarker224"/><span class="koboSpan" id="kobo.120.1">to the web server from the browser over an encrypted channel. </span><span class="koboSpan" id="kobo.120.2">It is crucial for an application to send login information or any sensitive data such as session IDs over an encrypted channel. </span><span class="koboSpan" id="kobo.120.3">The data transmitted between the application server and the user’s browser can be intercepted by an attacker, and if the traffic is encrypted, the attacker will not be able to read the data </span><span class="No-Break"><span class="koboSpan" id="kobo.121.1">being transmitted.</span></span><a id="_idTextAnchor153"/></p>
<h2 id="_idParaDest-129"><a id="_idTextAnchor154"/><span class="koboSpan" id="kobo.122.1">Getting ready</span></h2>
<p><span class="koboSpan" id="kobo.123.1">To prepare for this recipe, please start ZAP and OWASP Juice Shop. </span><span class="koboSpan" id="kobo.123.2">Make sure that ZAP intercepts traffic at the OWASP Juice Shop application </span><span class="No-Break"><span class="koboSpan" id="kobo.124.1">home page</span><a id="_idTextAnchor155"/><span class="koboSpan" id="kobo.125.1">.</span></span></p>
<h2 id="_idParaDest-130"><a id="_idTextAnchor156"/><span class="koboSpan" id="kobo.126.1">How to do it…</span></h2>
<p><span class="koboSpan" id="kobo.127.1">To know </span><a id="_idIndexMarker225"/><span class="koboSpan" id="kobo.128.1">whether a website </span><a id="_idIndexMarker226"/><span class="koboSpan" id="kobo.129.1">is accessible and transmits data over </span><strong class="bold"><span class="koboSpan" id="kobo.130.1">Hypertext Transfer Protocol</span></strong><span class="koboSpan" id="kobo.131.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.132.1">HTTP</span></strong><span class="koboSpan" id="kobo.133.1">) or </span><strong class="bold"><span class="koboSpan" id="kobo.134.1">Hypertext Transfer Protocol Secure</span></strong><span class="koboSpan" id="kobo.135.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.136.1">HTTPS</span></strong><span class="koboSpan" id="kobo.137.1">), we have to intercept the login HTTP request. </span><span class="koboSpan" id="kobo.137.2">Let’s look at </span><span class="No-Break"><span class="koboSpan" id="kobo.138.1">the steps:</span></span></p>
<ol>
<li value="1"><span class="koboSpan" id="kobo.139.1">Configure ZAP to intercept traffic, and then log in to </span><span class="No-Break"><span class="koboSpan" id="kobo.140.1">the website.</span></span></li>
</ol>
<p><span class="koboSpan" id="kobo.141.1">After intercepting the </span><strong class="source-inline"><span class="koboSpan" id="kobo.142.1">login</span></strong><span class="koboSpan" id="kobo.143.1"> request, search for and open it in ZAP. </span><span class="koboSpan" id="kobo.143.2">It will be in the </span><strong class="bold"><span class="koboSpan" id="kobo.144.1">History</span></strong><span class="koboSpan" id="kobo.145.1"> tab of the Information window. </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.146.1">Figure 4</span></em></span><em class="italic"><span class="koboSpan" id="kobo.147.1">.5</span></em><span class="koboSpan" id="kobo.148.1"> shows the </span><strong class="source-inline"><span class="koboSpan" id="kobo.149.1">login</span></strong><span class="koboSpan" id="kobo.150.1"> request’s header, which contains the fields you want to examine for </span><span class="No-Break"><span class="koboSpan" id="kobo.151.1">this test:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer108">
<span class="koboSpan" id="kobo.152.1"><img alt=" Figure 4.5 – Login request header" src="image/Figure_04.05_B18829.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.153.1"> Figure 4.5 – Login request header</span></p>
<ol>
<li value="2"><span class="koboSpan" id="kobo.154.1">Examine the HTTP method and the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.155.1">Referer</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.156.1"> field.</span></span></li>
</ol>
<p><span class="koboSpan" id="kobo.157.1">The HTTP method field is the first line, which is used to transmit the data. </span><span class="koboSpan" id="kobo.157.2">The start of the address will determine whether HTTPS is used versus HTTP. </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.158.1">Figure 4</span></em></span><em class="italic"><span class="koboSpan" id="kobo.159.1">.5</span></em> <span class="No-Break"><span class="koboSpan" id="kobo.160.1">shows </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.161.1">http</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.162.1">.</span></span></p>
<ol>
<li value="3"><span class="koboSpan" id="kobo.163.1">Next, examine the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.164.1">Referer</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.165.1"> field.</span></span></li>
</ol>
<p><span class="koboSpan" id="kobo.166.1">This field shows the address of the page the request started from. </span><span class="koboSpan" id="kobo.166.2">Just like in the HTTP method field, the start of the address in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.167.1">Referer</span></strong><span class="koboSpan" id="kobo.168.1"> field determines whether the originating web page is accessible through HTTP </span><span class="No-Break"><span class="koboSpan" id="kobo.169.1">or HTTP</span><a id="_idTextAnchor157"/><span class="koboSpan" id="kobo.170.1">S.</span></span></p>
<h2 id="_idParaDest-131"><a id="_idTextAnchor158"/><span class="koboSpan" id="kobo.171.1">How it works…</span></h2>
<p><span class="koboSpan" id="kobo.172.1">There </span><a id="_idIndexMarker227"/><span class="koboSpan" id="kobo.173.1">are two main internet </span><a id="_idIndexMarker228"/><span class="koboSpan" id="kobo.174.1">protocols that are used to </span><a id="_idIndexMarker229"/><span class="koboSpan" id="kobo.175.1">transmit web application data. </span><span class="koboSpan" id="kobo.175.2">The first protocol is HTTP, which transmits data unencrypted. </span><span class="koboSpan" id="kobo.175.3">The </span><a id="_idIndexMarker230"/><span class="koboSpan" id="kobo.176.1">second protocol is an extension of HTTP – HTTPS, which is used to </span><a id="_idIndexMarker231"/><span class="koboSpan" id="kobo.177.1">encrypt web traffic. </span><span class="koboSpan" id="kobo.177.2">HTTPS uses </span><strong class="bold"><span class="koboSpan" id="kobo.178.1">Transport Layer Security</span></strong><span class="koboSpan" id="kobo.179.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.180.1">TLS</span></strong><span class="koboSpan" id="kobo.181.1">), which superseded </span><strong class="bold"><span class="koboSpan" id="kobo.182.1">Secure Sockets Layer</span></strong><span class="koboSpan" id="kobo.183.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.184.1">SSL</span></strong><span class="koboSpan" id="kobo.185.1">), to encrypt </span><a id="_idIndexMarker232"/><span class="koboSpan" id="kobo.186.1">web communications. </span><span class="koboSpan" id="kobo.186.2">Using HTTP will unintentionally expose the end user’s data by sending requests in plaintext that can easily be read and manipulated by </span><span class="No-Break"><span class="koboSpan" id="kobo.187.1">the a</span><a id="_idTextAnchor159"/><span class="koboSpan" id="kobo.188.1">ttacker.</span></span></p>
<h1 id="_idParaDest-132"><a id="_idTextAnchor160"/><span class="koboSpan" id="kobo.189.1">Testing for Default Credentials</span></h1>
<p><span class="koboSpan" id="kobo.190.1">In this recipe, we will </span><a id="_idIndexMarker233"/><span class="koboSpan" id="kobo.191.1">go over how to test an application for default credentials. </span><span class="koboSpan" id="kobo.191.2">Often, newly provisioned applications, servers, routers, hosts, and so on come with default passwords for system administrators to log in and configure. </span><span class="koboSpan" id="kobo.191.3">If these are left as defaults, when attackers run brute-force attacks, the likelihood of a successful login is higher. </span><span class="koboSpan" id="kobo.191.4">We will go through how to conduct a simple brute-force attack using </span><span class="No-Break"><span class="koboSpan" id="kobo.192.1">a w</span><a id="_idTextAnchor161"/><span class="koboSpan" id="kobo.193.1">ordlist.</span></span></p>
<h2 id="_idParaDest-133"><a id="_idTextAnchor162"/><span class="koboSpan" id="kobo.194.1">Getting ready</span></h2>
<p><span class="koboSpan" id="kobo.195.1">To prepare for this recipe, please start ZAP and OWASP Juice Shop. </span><span class="koboSpan" id="kobo.195.2">Make sure that ZAP intercepts traffic at the OWASP Juice Shop application home page. </span><span class="koboSpan" id="kobo.195.3">In addition, you will need to create </span><a id="_idIndexMarker234"/><span class="koboSpan" id="kobo.196.1">an account in OWASP Juice Shop using any dummy email, but ensure that the password is </span><strong class="source-inline"><span class="koboSpan" id="kobo.197.1">password</span></strong><span class="koboSpan" id="kobo.198.1"> for this section. </span><span class="koboSpan" id="kobo.198.2">In addition, obtain the password-cracking wordlist (</span><strong class="source-inline"><span class="koboSpan" id="kobo.199.1">'top-passwords-shortlist'</span></strong><span class="koboSpan" id="kobo.200.1">) from GitHub or a </span><span class="No-Break"><span class="koboSpan" id="kobo.201.1">Goog</span><a id="_idTextAnchor163"/><span class="koboSpan" id="kobo.202.1">le search.</span></span></p>
<h2 id="_idParaDest-134"><a id="_idTextAnchor164"/><span class="koboSpan" id="kobo.203.1">How to do it…</span></h2>
<ol>
<li value="1"><span class="koboSpan" id="kobo.204.1">Intercept the traffic, then log in to </span><span class="No-Break"><span class="koboSpan" id="kobo.205.1">the application.</span></span></li>
</ol>
<p><span class="koboSpan" id="kobo.206.1">By logging in to the application, you will see the </span><strong class="source-inline"><span class="koboSpan" id="kobo.207.1">POST</span></strong><span class="koboSpan" id="kobo.208.1"> request, as shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.209.1">Figure 4</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.210.1">.6</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.211.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer109">
<span class="koboSpan" id="kobo.212.1"><img alt="Figure 4.6 – Site's tree window POST request location" src="image/Figure_04.06_B18829.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.213.1">Figure 4.6 – Site's tree window POST request location</span></p>
<p><span class="koboSpan" id="kobo.214.1">From here, we’ll begin our brute force of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.215.1">login</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.216.1">request credentials.</span></span></p>
<ol>
<li value="2"><span class="koboSpan" id="kobo.217.1">Right-click on the </span><strong class="source-inline"><span class="koboSpan" id="kobo.218.1">POST:login()</span></strong><span class="koboSpan" id="kobo.219.1"> request, select </span><strong class="bold"><span class="koboSpan" id="kobo.220.1">Attack</span></strong><span class="koboSpan" id="kobo.221.1">, and then </span><span class="No-Break"><span class="koboSpan" id="kobo.222.1">select </span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.223.1">Fuzz…</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.224.1">:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer110">
<span class="koboSpan" id="kobo.225.1"><img alt="Figure 4.7 – Site's tree window" src="image/Figure_04.07_B18829.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.226.1">Figure 4.7 – Site's tree window</span></p>
<ol>
<li value="3"><span class="koboSpan" id="kobo.227.1">Highlight the </span><a id="_idIndexMarker235"/><span class="koboSpan" id="kobo.228.1">field to brute-force and click </span><strong class="bold"><span class="koboSpan" id="kobo.229.1">Add…</span></strong><span class="koboSpan" id="kobo.230.1">, as shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.231.1">Figure 4</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.232.1">.8</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.233.1">:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer111">
<span class="koboSpan" id="kobo.234.1"><img alt="Figure 4.8 – Fuzzer dialog and locations" src="image/Figure_04.08_B18829.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.235.1">Figure 4.8 – Fuzzer dialog and locations</span></p>
<ol>
<li value="4"><span class="koboSpan" id="kobo.236.1">Then, click on the </span><strong class="bold"><span class="koboSpan" id="kobo.237.1">Add…</span></strong><span class="koboSpan" id="kobo.238.1"> button, as shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.239.1">Figure 4</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.240.1">.9</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.241.1">:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer112">
<span class="koboSpan" id="kobo.242.1"><img alt="Figure 4.9 – Payloads dialog list" src="image/Figure_04.09_B18829.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.243.1">Figure 4.9 – Payloads dialog list</span></p>
<p><span class="koboSpan" id="kobo.244.1">This opens </span><a id="_idIndexMarker236"/><span class="koboSpan" id="kobo.245.1">the window to allow you to select </span><span class="No-Break"><span class="koboSpan" id="kobo.246.1">your payloads.</span></span></p>
<ol>
<li value="5"><span class="koboSpan" id="kobo.247.1"> Click on the </span><strong class="bold"><span class="koboSpan" id="kobo.248.1">Type</span></strong><span class="koboSpan" id="kobo.249.1"> dropdown and select </span><strong class="bold"><span class="koboSpan" id="kobo.250.1">File</span></strong><span class="koboSpan" id="kobo.251.1">, as shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.252.1">Figure 4</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.253.1">.10</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.254.1">:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer113">
<span class="koboSpan" id="kobo.255.1"><img alt="Figure 4.10 – Add Payload dialog file drop-down menu" src="image/Figure_04.10_B18829.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.256.1">Figure 4.10 – Add Payload dialog file drop-down menu</span></p>
<p><span class="koboSpan" id="kobo.257.1">Once you </span><a id="_idIndexMarker237"/><span class="koboSpan" id="kobo.258.1">have the window open, select the wordlist we downloaded earlier in </span><span class="No-Break"><span class="koboSpan" id="kobo.259.1">this section.</span></span></p>
<ol>
<li value="6"><span class="koboSpan" id="kobo.260.1">Select </span><strong class="source-inline"><span class="koboSpan" id="kobo.261.1">worldlist</span></strong><span class="koboSpan" id="kobo.262.1">, as shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.263.1">Figure 4</span></em></span><em class="italic"><span class="koboSpan" id="kobo.264.1">.11</span></em><span class="koboSpan" id="kobo.265.1">, and click </span><strong class="bold"><span class="koboSpan" id="kobo.266.1">Open</span></strong><span class="koboSpan" id="kobo.267.1">, </span><strong class="bold"><span class="koboSpan" id="kobo.268.1">Add</span></strong><span class="koboSpan" id="kobo.269.1">, and </span><strong class="bold"><span class="koboSpan" id="kobo.270.1">OK</span></strong><span class="koboSpan" id="kobo.271.1">. </span><span class="koboSpan" id="kobo.271.2">After that, your </span><strong class="bold"><span class="koboSpan" id="kobo.272.1">Fuzzer</span></strong><span class="koboSpan" id="kobo.273.1"> window will look like </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.274.1">Figure 4</span></em></span><em class="italic"><span class="koboSpan" id="kobo.275.1">.8</span></em><span class="koboSpan" id="kobo.276.1">. </span><span class="koboSpan" id="kobo.276.2">Now, you are ready to launch </span><span class="No-Break"><span class="koboSpan" id="kobo.277.1">your fuzzer.</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer114">
<span class="koboSpan" id="kobo.278.1"><img alt="Figure 4.11 – Add Payload dialog file directory view" src="image/Figure_04.11_B18829.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.279.1">Figure 4.11 – Add Payload dialog file directory view</span></p>
<ol>
<li value="7"><span class="koboSpan" id="kobo.280.1">Click </span><strong class="bold"><span class="koboSpan" id="kobo.281.1">Start Fuzzer</span></strong><span class="koboSpan" id="kobo.282.1">. </span><span class="koboSpan" id="kobo.282.2">A new </span><a id="_idIndexMarker238"/><span class="koboSpan" id="kobo.283.1">tab opens, and ZAP starts testing the field you highlighted, containing the payloads that </span><span class="No-Break"><span class="koboSpan" id="kobo.284.1">were added.</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer115">
<span class="koboSpan" id="kobo.285.1"><img alt="Figure 4.12 – Fuzzer information﻿ window" src="image/Figure_04.12_B18829.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.286.1">Figure 4.12 – Fuzzer information</span><a id="_idTextAnchor165"/><span class="koboSpan" id="kobo.287.1"> window</span></p>
<h2 id="_idParaDest-135"><a id="_idTextAnchor166"/><span class="koboSpan" id="kobo.288.1">How it works…</span></h2>
<p><span class="koboSpan" id="kobo.289.1">As you notice, the payload “password” works. </span><span class="koboSpan" id="kobo.289.2">This is because the application returns a </span><strong class="source-inline"><span class="koboSpan" id="kobo.290.1">200</span></strong><span class="koboSpan" id="kobo.291.1"> code, as shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.292.1">Figure 4</span></em></span><em class="italic"><span class="koboSpan" id="kobo.293.1">.12</span></em><span class="koboSpan" id="kobo.294.1">, which lets you know that the password the fuzzer used to test the password field works. </span><span class="koboSpan" id="kobo.294.2">This example can be applied to any other login screen and </span><a id="_idIndexMarker239"/><span class="koboSpan" id="kobo.295.1">any application that uses a password. </span><span class="koboSpan" id="kobo.295.2">When using it with an application that has default credentials, you can test multiple credentials at a time to try to brute-force the </span><span class="No-Break"><span class="koboSpan" id="kobo.296.1">log</span><a id="_idTextAnchor167"/><span class="koboSpan" id="kobo.297.1">in page.</span></span></p>
<h2 id="_idParaDest-136"><a id="_idTextAnchor168"/><span class="koboSpan" id="kobo.298.1">There’s more…</span></h2>
<p><span class="koboSpan" id="kobo.299.1">When choosing the wordlist to include for attacks such as brute-force, understand who and what your target is to craft specific lists (i.e., Apache Tomcat having the username and password of </span><strong class="source-inline"><span class="koboSpan" id="kobo.300.1">tomcat</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.301.1">and </span><a id="_idTextAnchor169"/></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.302.1">tomcat</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.303.1">).</span></span></p>
<h2 id="_idParaDest-137"><a id="_idTextAnchor170"/><span class="koboSpan" id="kobo.304.1">See also</span></h2>
<ul>
<li><a href="https://github.com/danielmiessler/SecLists"><span class="No-Break"><span class="koboSpan" id="kobo.305.1">https://github.com/danielmiessler/S</span><span id="_idTextAnchor171"/><span class="koboSpan" id="kobo.306.1">ecLists</span></span></a></li>
</ul>
<h1 id="_idParaDest-138"><a id="_idTextAnchor172"/><span class="koboSpan" id="kobo.307.1">Testing Directory Traversal File Include</span></h1>
<p><span class="koboSpan" id="kobo.308.1">Directory traversal, also known </span><a id="_idIndexMarker240"/><span class="koboSpan" id="kobo.309.1">as path traversal, file include is where an attacker looks to exploit a lack of input validation or weakly deployed methods to </span><a id="_idIndexMarker241"/><span class="koboSpan" id="kobo.310.1">read or write files that are not authorized or warranted to be accessible. </span><span class="koboSpan" id="kobo.310.2">In this recipe, we will discover the method of how attackers conduct such an attack, which is known as the “dot dot slash” (</span><strong class="source-inline"><span class="koboSpan" id="kobo.311.1">../</span><a id="_idTextAnchor173"/></strong><span class="koboSpan" id="kobo.312.1">) </span><span class="No-Break"><span class="koboSpan" id="kobo.313.1">attack.</span></span></p>
<h2 id="_idParaDest-139"><a id="_idTextAnchor174"/><span class="koboSpan" id="kobo.314.1">Getting ready</span></h2>
<p><span class="koboSpan" id="kobo.315.1">To start, ensure that ZAP is started and use the PortSwigger Academy lab, </span><strong class="source-inline"><span class="koboSpan" id="kobo.316.1">File path traversal, </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.317.1">si</span><a id="_idTextAnchor175"/><span class="koboSpan" id="kobo.318.1">mple case</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.319.1">.</span></span></p>
<h2 id="_idParaDest-140"><a id="_idTextAnchor176"/><span class="koboSpan" id="kobo.320.1">How to do it…</span></h2>
<p><span class="koboSpan" id="kobo.321.1">To determine which part of the application is vulnerable to input validation bypassing, you need to enumerate all parts of the application that accept content from the user’s perspective. </span><span class="koboSpan" id="kobo.321.2">This includes HTTP </span><strong class="source-inline"><span class="koboSpan" id="kobo.322.1">GET</span></strong><span class="koboSpan" id="kobo.323.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.324.1">POST</span></strong><span class="koboSpan" id="kobo.325.1"> queries and common options such as file uploads and HTML forms. </span><span class="koboSpan" id="kobo.325.2">Let’s look at </span><span class="No-Break"><span class="koboSpan" id="kobo.326.1">the steps:</span></span></p>
<ol>
<li value="1"><span class="koboSpan" id="kobo.327.1">Capture the web application </span><span class="No-Break"><span class="koboSpan" id="kobo.328.1">in ZAP.</span></span></li>
<li><span class="koboSpan" id="kobo.329.1">Spider the </span><a id="_idIndexMarker242"/><span class="koboSpan" id="kobo.330.1">web application and look for any areas where there’s an image file or other </span><span class="No-Break"><span class="koboSpan" id="kobo.331.1">input parameter:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer116">
<span class="koboSpan" id="kobo.332.1"><img alt="Figure 4.13 – Get:image(filename)" src="image/Figure_04.13_B18829.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.333.1">Figure 4.13 – Get:image(filename)</span></p>
<p><span class="koboSpan" id="kobo.334.1">In the case of the PortSwigger Academy lab, view any image on the web page or open the </span><strong class="source-inline"><span class="koboSpan" id="kobo.335.1">GET</span></strong><span class="koboSpan" id="kobo.336.1"> request for </span><strong class="source-inline"><span class="koboSpan" id="kobo.337.1">image(filename)</span></strong><span class="koboSpan" id="kobo.338.1"> in the Request editor to see the request of </span><span class="No-Break"><span class="koboSpan" id="kobo.339.1">the filename.</span></span></p>
<ol>
<li value="3"><span class="koboSpan" id="kobo.340.1">Open the </span><strong class="bold"><span class="koboSpan" id="kobo.341.1">Request editor</span></strong><span class="koboSpan" id="kobo.342.1"> on the </span><strong class="source-inline"><span class="koboSpan" id="kobo.343.1">GET</span></strong><span class="koboSpan" id="kobo.344.1"> request for </span><strong class="source-inline"><span class="koboSpan" id="kobo.345.1">image(filename)</span></strong><span class="koboSpan" id="kobo.346.1"> and modify the filename to inject the file traversal attack, as shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.347.1">Figure 4</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.348.1">.14</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.349.1">:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer117">
<span class="koboSpan" id="kobo.350.1"><img alt="Figure 4.14 – Request Editor for file path traversal" src="image/Figure_04.14_B18829.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.351.1">Figure 4.14 – Request Editor for file path traversal</span></p>
<ol>
<li value="4"><span class="koboSpan" id="kobo.352.1">When a file path is vulnerable, the response will reflect the newly requested file; in our example, the attack called for the </span><strong class="source-inline"><span class="koboSpan" id="kobo.353.1">/etc/passwd</span></strong><span class="koboSpan" id="kobo.354.1"> file, as shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.355.1">Figure 4</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.356.1">.15</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.357.1">:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer118">
<span class="koboSpan" id="kobo.358.1"><img alt="Figure 4.15 – Response reflected /et﻿c/passwd" src="image/Figure_04.15_B18829.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.359.1">Figure 4.15 – Response reflected /et</span><a id="_idTextAnchor177"/><span class="koboSpan" id="kobo.360.1">c/passwd</span></p>
<h2 id="_idParaDest-141"><a id="_idTextAnchor178"/><span class="koboSpan" id="kobo.361.1">How it works…</span></h2>
<p><span class="koboSpan" id="kobo.362.1">Directory traversal attacks aim to access files or other directories that sit outside of the web root </span><a id="_idIndexMarker243"/><span class="koboSpan" id="kobo.363.1">directory. </span><span class="koboSpan" id="kobo.363.2">Web servers and web applications usually employ authentication controls for accessing files and resources. </span><span class="koboSpan" id="kobo.363.3">Administrators attempt to identify the users and groups allowed to access, modify, or execute specific files on the server. </span><span class="koboSpan" id="kobo.363.4">To protect against malicious intent, an </span><strong class="bold"><span class="koboSpan" id="kobo.364.1">Access Control List</span></strong><span class="koboSpan" id="kobo.365.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.366.1">ACL</span></strong><span class="koboSpan" id="kobo.367.1">) is used </span><a id="_idIndexMarker244"/><span class="koboSpan" id="kobo.368.1">to prevent access to sensitive files (i.e., </span><strong class="source-inline"><span class="koboSpan" id="kobo.369.1">/etc/passwd</span></strong><span class="koboSpan" id="kobo.370.1">) or avoid the execution of </span><span class="No-Break"><span class="koboSpan" id="kobo.371.1">system commands.</span></span></p>
<p><span class="koboSpan" id="kobo.372.1">ACLs are a common method to manage images and templates, load static texts, and so on, and unfortunately, improper validation of the input parameters (i.e., forms and cookie values) will expose the applications to </span><span class="No-Break"><span class="koboSpan" id="kobo.373.1">security vulner</span><a id="_idTextAnchor179"/><span class="koboSpan" id="kobo.374.1">abilities.</span></span></p>
<h2 id="_idParaDest-142"><a id="_idTextAnchor180"/><span class="koboSpan" id="kobo.375.1">See also</span></h2>
<p><span class="koboSpan" id="kobo.376.1">At times, some parameters are blocked and the attacker needs to use other methods in their input, such as HTML encoding or double encoding. </span><span class="koboSpan" id="kobo.376.2">For these other strings, refer to GitHub and look for cheat sheets or other payloads to help build your word list. </span><span class="koboSpan" id="kobo.376.3">Then, use the fuzzer to quickly load and attack the parameter </span><span class="No-Break"><span class="koboSpan" id="kobo.377.1">of choice.</span></span></p>
<p><span class="koboSpan" id="kobo.378.1">See also the </span><em class="italic"><span class="koboSpan" id="kobo.379.1">Fuzzing with Fuzzer</span></em><span class="koboSpan" id="kobo.380.1"> section in </span><a href="B18829_02.xhtml#_idTextAnchor062"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.381.1">Chapter 2</span></em></span></a><span class="koboSpan" id="kobo.382.1">, </span><em class="italic"><span class="koboSpan" id="kobo.383.1">Navigati</span><a id="_idTextAnchor181"/><span class="koboSpan" id="kobo.384.1">ng </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.385.1">the UI</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.386.1">.</span></span></p>
<h1 id="_idParaDest-143"><a id="_idTextAnchor182"/><span class="koboSpan" id="kobo.387.1">Testing for Privilege Escalation and Bypassing Authorization Schema</span></h1>
<p><span class="koboSpan" id="kobo.388.1">In this recipe, we are going to talk about two vulnerability types: the first is privilege escalation </span><a id="_idIndexMarker245"/><span class="koboSpan" id="kobo.389.1">and the second is bypassing authorization schema. </span><span class="koboSpan" id="kobo.389.2">The lab will be for both vulnerabilities because once we escalate privilege, we will perform </span><span class="No-Break"><span class="koboSpan" id="kobo.390.1">unauthorized actions.</span></span></p>
<p><span class="koboSpan" id="kobo.391.1">In a privilege escalation attack, an attacker gains elevated permissions or performs actions intended for different users. </span><span class="koboSpan" id="kobo.391.2">Typically, this attack is possible due to a misconfiguration, software bug, or a vulnerability that allows the attacker to escalate their permissions. </span><span class="koboSpan" id="kobo.391.3">There are two types of privilege escalation: the first is vertical privilege escalation. </span><span class="koboSpan" id="kobo.391.4">In this attack, the attacker successfully gains more permissions (such as user-to-administrator permissions) than their account is supposed to have. </span><span class="koboSpan" id="kobo.391.5">The second type is horizontal privilege escalation. </span><span class="koboSpan" id="kobo.391.6">In this attack, the attacker performs an action that is not intended for their user account but for an account with a similar level </span><span class="No-Break"><span class="koboSpan" id="kobo.392.1">of permissions.</span></span></p>
<p><span class="koboSpan" id="kobo.393.1">Bypassing authorization </span><a id="_idIndexMarker246"/><span class="koboSpan" id="kobo.394.1">comes into play when an attacker obtains the ability to access the resources of a user when they are not authenticated, hence bypassing them. </span><span class="koboSpan" id="kobo.394.2">This vulnerability presents itself when access to resources is achievable, either after logging out of an application or accessing functions and resources that are only accessible and intended for a user with the proper role </span><span class="No-Break"><span class="koboSpan" id="kobo.395.1">or</span><a id="_idTextAnchor183"/><span class="koboSpan" id="kobo.396.1"> privileges.</span></span></p>
<h2 id="_idParaDest-144"><a id="_idTextAnchor184"/><span class="koboSpan" id="kobo.397.1">Getting ready</span></h2>
<p><span class="koboSpan" id="kobo.398.1">To follow along in this lab, you should have OWASP Juice Shop running and ZAP intercepting </span><span class="No-Break"><span class="koboSpan" id="kobo.399.1">t</span><a id="_idTextAnchor185"/><span class="koboSpan" id="kobo.400.1">he traffic.</span></span></p>
<h2 id="_idParaDest-145"><a id="_idTextAnchor186"/><span class="koboSpan" id="kobo.401.1">How to do it…</span></h2>
<p><span class="koboSpan" id="kobo.402.1">In this lab, we will perform a horizontal privilege escalation by viewing the items in another </span><a id="_idIndexMarker247"/><span class="koboSpan" id="kobo.403.1">user’s cart. </span><span class="koboSpan" id="kobo.403.2">The following steps will guide you in performing </span><a id="_idIndexMarker248"/><span class="koboSpan" id="kobo.404.1">privilege escalation in </span><span class="No-Break"><span class="koboSpan" id="kobo.405.1">Juice Shop:</span></span></p>
<ol>
<li value="1"><span class="koboSpan" id="kobo.406.1">Log in as </span><span class="No-Break"><span class="koboSpan" id="kobo.407.1">the administrator.</span></span></li>
</ol>
<p><span class="koboSpan" id="kobo.408.1">The admin email (in this case, used as a username) is </span><a href="mailto:admin@juice-sh.op"><span class="koboSpan" id="kobo.409.1">admin@juice-sh.op</span></a><span class="koboSpan" id="kobo.410.1"> and the password is </span><strong class="source-inline"><span class="koboSpan" id="kobo.411.1">admin123</span></strong><span class="koboSpan" id="kobo.412.1">. </span><span class="koboSpan" id="kobo.412.2">The username is obtained from the </span><strong class="bold"><span class="koboSpan" id="kobo.413.1">Reviews</span></strong><span class="koboSpan" id="kobo.414.1"> section when </span><strong class="bold"><span class="koboSpan" id="kobo.415.1">Apple Juice</span></strong><span class="koboSpan" id="kobo.416.1"> is selected. </span><span class="koboSpan" id="kobo.416.2">We obtained the password by brute-forcing the password using a common </span><span class="No-Break"><span class="koboSpan" id="kobo.417.1">password list.</span></span></p>
<ol>
<li value="2"><span class="koboSpan" id="kobo.418.1">Navigate to the admin page at </span><strong class="source-inline"><span class="koboSpan" id="kobo.419.1">https://[Your IP address </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.420.1">or localhost]:3000/#/administration</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.421.1">.</span></span></li>
</ol>
<p><span class="koboSpan" id="kobo.422.1">The path to the administrator page was obtained by using the developer tools of the browser and reading the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.423.1">main.js</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.424.1"> file.</span></span></p>
<ol>
<li value="3"><span class="koboSpan" id="kobo.425.1">Obtain the user ID by clicking on the </span><em class="italic"><span class="koboSpan" id="kobo.426.1">eye</span></em><span class="koboSpan" id="kobo.427.1"> symbol next to </span><span class="No-Break"><span class="koboSpan" id="kobo.428.1">the user.</span></span></li>
</ol>
<p><span class="koboSpan" id="kobo.429.1">The user ID is needed in order to view the shopping cart of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.430.1">bender@juice-sh.op</span></strong><span class="koboSpan" id="kobo.431.1"> user. </span><span class="koboSpan" id="kobo.431.2">Once the eye is clicked, you can see the user ID after the </span><strong class="source-inline"><span class="koboSpan" id="kobo.432.1">#</span></strong><span class="koboSpan" id="kobo.433.1"> sign, which is </span><strong class="source-inline"><span class="koboSpan" id="kobo.434.1">3</span></strong><span class="koboSpan" id="kobo.435.1"> in this case, as seen in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.436.1">Figure 4</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.437.1">.16</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.438.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer119">
<span class="koboSpan" id="kobo.439.1"><img alt="Figure 4.16 – User ID" src="image/Figure_04.16_B18829.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.440.1">Figure 4.16 – User ID</span></p>
<p><span class="koboSpan" id="kobo.441.1">Now that we have obtained the user ID, we have to create a new user account to get an account with normal </span><span class="No-Break"><span class="koboSpan" id="kobo.442.1">user permissions.</span></span></p>
<ol>
<li value="4"><span class="koboSpan" id="kobo.443.1">Log out of the admin account, click on </span><strong class="bold"><span class="koboSpan" id="kobo.444.1">Account</span></strong><span class="koboSpan" id="kobo.445.1"> | </span><strong class="bold"><span class="koboSpan" id="kobo.446.1">Login</span></strong><span class="koboSpan" id="kobo.447.1">, click on </span><strong class="bold"><span class="koboSpan" id="kobo.448.1">Not yet a customer?</span></strong><span class="koboSpan" id="kobo.449.1">, and fill out the information required for the user account. </span><span class="koboSpan" id="kobo.449.2">Once you have created the user account, log in </span><span class="No-Break"><span class="koboSpan" id="kobo.450.1">to it.</span></span></li>
<li><span class="koboSpan" id="kobo.451.1">Open ZAP, add </span><strong class="bold"><span class="koboSpan" id="kobo.452.1">Juice Shop</span></strong><span class="koboSpan" id="kobo.453.1"> to the scope, and </span><em class="italic"><span class="koboSpan" id="kobo.454.1">set break on all requests and responses</span></em><span class="koboSpan" id="kobo.455.1"> by clicking the green circle on the top menu bar, which will make it turn red, as seen in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.456.1">Figure 4</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.457.1">.17</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.458.1">:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer120">
<span class="koboSpan" id="kobo.459.1"><img alt="Figure 4.17 – Setting break" src="image/Figure_04.17_B18829.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.460.1">Figure 4.17 – Setting break</span></p>
<ol>
<li value="6"><span class="koboSpan" id="kobo.461.1">Click on </span><strong class="bold"><span class="koboSpan" id="kobo.462.1">Your Basket</span></strong><span class="koboSpan" id="kobo.463.1"> on the top menu. </span><span class="koboSpan" id="kobo.463.2">When you click on it, you will see the request </span><a id="_idIndexMarker249"/><span class="koboSpan" id="kobo.464.1">stopped by ZAP and available for you to edit. </span><span class="koboSpan" id="kobo.464.2">The </span><a id="_idIndexMarker250"/><span class="koboSpan" id="kobo.465.1">first line starts with </span><strong class="source-inline"><span class="koboSpan" id="kobo.466.1">GET</span></strong><span class="koboSpan" id="kobo.467.1"> (the HTTP method used); immediately after that, you can see the path followed by the protocol version. </span><span class="koboSpan" id="kobo.467.2">Notice that the end of the path contains the number, which refers to the user ID. </span><span class="koboSpan" id="kobo.467.3">See </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.468.1">Figure 4</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.469.1">.18</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.470.1">:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer121">
<span class="koboSpan" id="kobo.471.1"><img alt="Figure 4.18 – Request header of userID" src="image/Figure_04.18_B18829.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.472.1">Figure 4.18 – Request header of userID</span></p>
<ol>
<li value="7"><span class="koboSpan" id="kobo.473.1">Replace 6 with the user ID 3, as seen in </span><span class="No-Break"><span class="koboSpan" id="kobo.474.1">Figure 4</span></span><span class="koboSpan" id="kobo.475.1">.19. </span><span class="koboSpan" id="kobo.475.2">Click </span><span class="No-Break"><span class="koboSpan" id="kobo.476.1">on </span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.477.1">Continue</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.478.1">:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer122">
<span class="koboSpan" id="kobo.479.1"><img alt="Figure 4.19 – Replace request header" src="image/Figure_04.19_B18829.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.480.1">Figure 4.19 – Replace request header</span></p>
<p><span class="koboSpan" id="kobo.481.1">Now, you </span><a id="_idIndexMarker251"/><span class="koboSpan" id="kobo.482.1">can see the </span><strong class="source-inline"><span class="koboSpan" id="kobo.483.1">bender@juice-sh.op</span></strong><span class="koboSpan" id="kobo.484.1"> basket, as </span><a id="_idIndexMarker252"/><span class="koboSpan" id="kobo.485.1">seen in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.486.1">Figure 4</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.487.1">.20</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.488.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer123">
<span class="koboSpan" id="kobo.489.1"><img alt="Figure 4.20 – OWASP Juice Shop basket" src="image/Figure_04.20_B18829.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.490.1">Figure 4.20 – OWASP Juice Shop basket</span></p>
<ol>
<li value="8"><span class="koboSpan" id="kobo.491.1">To further perform unauthorized actions, let’s delete </span><strong class="bold"><span class="koboSpan" id="kobo.492.1">Raspberry Juice</span></strong><span class="koboSpan" id="kobo.493.1"> from mailto:</span><a href="mailto:bender@juice-sh.op"><span class="koboSpan" id="kobo.494.1">bende</span><span id="_idTextAnchor187"/><span class="koboSpan" id="kobo.495.1">r@juice-sh.op</span></a><span class="koboSpan" id="kobo.496.1"> basket. </span><span class="koboSpan" id="kobo.496.2">Refresh and repeat </span><em class="italic"><span class="koboSpan" id="kobo.497.1">steps 5</span></em><span class="koboSpan" id="kobo.498.1"> to </span><em class="italic"><span class="koboSpan" id="kobo.499.1">7</span></em><span class="koboSpan" id="kobo.500.1"> to check that the basket is empty now, as seen in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.501.1">Figure 4</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.502.1">.21</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.503.1">:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer124">
<span class="koboSpan" id="kobo.504.1"><img alt="Figure 4.21 – ﻿Empty basket" src="image/Figure_04.21_B18829.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.505.1">Figure 4.21 – </span><a id="_idTextAnchor188"/><span class="koboSpan" id="kobo.506.1">Empty basket</span></p>
<h2 id="_idParaDest-146"><a id="_idTextAnchor189"/><span class="koboSpan" id="kobo.507.1">How it works…</span></h2>
<p><span class="koboSpan" id="kobo.508.1">This lab </span><a id="_idIndexMarker253"/><span class="koboSpan" id="kobo.509.1">showed you how privilege escalation works. </span><span class="koboSpan" id="kobo.509.2">In this specific lab, we viewed another user’s basket by changing the ID in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.510.1">GET</span></strong><span class="koboSpan" id="kobo.511.1"> request. </span><span class="koboSpan" id="kobo.511.2">These types </span><a id="_idIndexMarker254"/><span class="koboSpan" id="kobo.512.1">of attacks are dangerous because an attacker could perform an action on behalf of others, and if the escalation is vertical, the attacker will have permission that could allow them to compromise an entire system or </span><span class="No-Break"><span class="koboSpan" id="kobo.513.1">an</span><a id="_idTextAnchor190"/><span class="koboSpan" id="kobo.514.1"> application.</span></span></p>
<h1 id="_idParaDest-147"><a id="_idTextAnchor191"/><span class="koboSpan" id="kobo.515.1">Testing for Insecure Direct Object References</span></h1>
<p><strong class="bold"><span class="koboSpan" id="kobo.516.1">Insecure Direct Object References</span></strong><span class="koboSpan" id="kobo.517.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.518.1">IDOR</span></strong><span class="koboSpan" id="kobo.519.1">) occur when an application references objects </span><a id="_idIndexMarker255"/><span class="koboSpan" id="kobo.520.1">in an insecure way that allows user-supplied input to manipulate and directly access those objects. </span><span class="koboSpan" id="kobo.520.2">Attackers that exploit this vulnerability are able to bypass authorization and directly access resources on the server (i.e, database reco</span><a id="_idTextAnchor192"/><span class="koboSpan" id="kobo.521.1">rds </span><span class="No-Break"><span class="koboSpan" id="kobo.522.1">or files).</span></span></p>
<h2 id="_idParaDest-148"><a id="_idTextAnchor193"/><span class="koboSpan" id="kobo.523.1">Getting ready</span></h2>
<p><span class="koboSpan" id="kobo.524.1">To start, ensure that ZAP is started and use the PortSwigger Academy lab, </span><strong class="source-inline"><span class="koboSpan" id="kobo.525.1">Insecure direct </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.526.1">obj</span><a id="_idTextAnchor194"/><span class="koboSpan" id="kobo.527.1">ect references</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.528.1">.</span></span></p>
<h2 id="_idParaDest-149"><a id="_idTextAnchor195"/><span class="koboSpan" id="kobo.529.1">How to do it…</span></h2>
<p><span class="koboSpan" id="kobo.530.1">Here, we’ll attack a live chat feature of the application, which will allow us to view other users’ messages </span><a id="_idIndexMarker256"/><span class="koboSpan" id="kobo.531.1">to the fictitious web app support. </span><span class="koboSpan" id="kobo.531.2">Let’s look at </span><span class="No-Break"><span class="koboSpan" id="kobo.532.1">the steps:</span></span></p>
<ol>
<li value="1"><span class="koboSpan" id="kobo.533.1">Start by navigating in the PortSwigger Academy lab to the </span><strong class="bold"><span class="koboSpan" id="kobo.534.1">Live </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.535.1">Chat</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.536.1"> feature.</span></span></li>
<li><span class="koboSpan" id="kobo.537.1">While capturing the traffic, click the </span><strong class="bold"><span class="koboSpan" id="kobo.538.1">View </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.539.1">Transcript</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.540.1"> button.</span></span></li>
</ol>
<p><span class="koboSpan" id="kobo.541.1">You will notice that this downloads a numbered text file. </span><span class="koboSpan" id="kobo.541.2">When you look at the response in ZAP’s Manual Request Editor, you are able to manipulate the number of the file, as seen in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.542.1">Figure 4</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.543.1">.22</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.544.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer125">
<span class="koboSpan" id="kobo.545.1"><img alt="Figure 4.22 – Request and response of the IDOR attack" src="image/Figure_04.22_B18829.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.546.1">Figure 4.22 – Request and response of the IDOR attack</span></p>
<ol>
<li value="3"><span class="koboSpan" id="kobo.547.1">Change the number to </span><strong class="source-inline"><span class="koboSpan" id="kobo.548.1">1</span></strong><span class="koboSpan" id="kobo.549.1"> and observe </span><span class="No-Break"><span class="koboSpan" id="kobo.550.1">the response.</span></span></li>
</ol>
<p><span class="koboSpan" id="kobo.551.1">Within the response, you will notice the chat between the support bot and someone else. </span><span class="koboSpan" id="kobo.551.2">Revealed within is the user sending their passwor</span><a id="_idTextAnchor196"/><span class="koboSpan" id="kobo.552.1">d </span><span class="No-Break"><span class="koboSpan" id="kobo.553.1">in cleartext.</span></span></p>
<h2 id="_idParaDest-150"><a id="_idTextAnchor197"/><span class="koboSpan" id="kobo.554.1">How it works…</span></h2>
<p><span class="koboSpan" id="kobo.555.1">The most basic IDOR scenario happens when the application references objects using easy-to-guess numerical values, such as incremental integers, as we saw and conducted our test on. </span><span class="koboSpan" id="kobo.555.2">These fields can also contain probable words, such as a user’s email address, or a directory name. </span><span class="koboSpan" id="kobo.555.3">Other times, poor encoding methods are used, allowing the attacker to decode something – for example, the use of base64 encoding on the incremental integer, or a profile image name </span><span class="No-Break"><span class="koboSpan" id="kobo.556.1">hash reference.</span></span></p>
<p><span class="koboSpan" id="kobo.557.1">The best </span><a id="_idIndexMarker257"/><span class="koboSpan" id="kobo.558.1">way to test for IDOR would be to request or create at least two users to cover different owned objects and functions – for example, two users each having access to different objects (such as purchase information, private messages, etc.) – and (if relevant and able) creating users with different privileges (i.e., admin versus auditor) to see whether there are direct references to application functionality. </span><span class="koboSpan" id="kobo.558.2">With multiple users, the tester is able to save time by not having to guess what the different object names are when attempting to access those objects that belong</span><a id="_idTextAnchor198"/><span class="koboSpan" id="kobo.559.1"> to </span><span class="No-Break"><span class="koboSpan" id="kobo.560.1">other users.</span></span></p>
<h2 id="_idParaDest-151"><a id="_idTextAnchor199"/><span class="koboSpan" id="kobo.561.1">There’s more…</span></h2>
<p><span class="koboSpan" id="kobo.562.1">Some other areas to look for when testing are </span><span class="No-Break"><span class="koboSpan" id="kobo.563.1">as follows:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.564.1">Whether the value of a parameter is used directly to retrieve a </span><span class="No-Break"><span class="koboSpan" id="kobo.565.1">database record</span></span></li>
<li><span class="koboSpan" id="kobo.566.1">Whether the value of a parameter is used directly to perform an operation in </span><span class="No-Break"><span class="koboSpan" id="kobo.567.1">the system</span></span></li>
<li><span class="koboSpan" id="kobo.568.1">Whether the value of a parameter is used directly to retrieve a </span><span class="No-Break"><span class="koboSpan" id="kobo.569.1">filesystem resource</span></span></li>
<li><span class="koboSpan" id="kobo.570.1">Whether the value of a parameter is used directly to access </span><span class="No-Break"><span class="koboSpan" id="kobo.571.1">application functionality</span></span></li>
</ul>
</div>
</body></html>