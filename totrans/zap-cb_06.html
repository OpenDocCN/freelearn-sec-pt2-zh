<html><head></head><body>
<div id="_idContainer168">
<h1 class="chapter-number" id="_idParaDest-176"><a id="_idTextAnchor229"/><span class="koboSpan" id="kobo.1.1">6</span></h1>
<h1 id="_idParaDest-177"><a id="_idTextAnchor230"/><span class="koboSpan" id="kobo.2.1">Validating (Data) Inputs – Part 1</span></h1>
<p><span class="koboSpan" id="kobo.3.1">You made it to </span><a href="B18829_06.xhtml#_idTextAnchor229"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.4.1">Chapter 6</span></em></span></a><span class="koboSpan" id="kobo.5.1">, the meat and potatoes of hacking! </span><span class="koboSpan" id="kobo.5.2">In this chapter are the attack vectors that everyone comes to know, love, hate, and want to recreate. </span><span class="koboSpan" id="kobo.5.3">Here, we’ll begin digging our hands into attack methods that exploit fields or objects susceptible to input validation issues, poor encoding practices, or lack of parameterization on the backend with </span><span class="No-Break"><span class="koboSpan" id="kobo.6.1">database inputs.</span></span></p>
<p><span class="koboSpan" id="kobo.7.1">Though many are aware of attacks such as </span><strong class="bold"><span class="koboSpan" id="kobo.8.1">cross-site scripting</span></strong><span class="koboSpan" id="kobo.9.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.10.1">XSS</span></strong><span class="koboSpan" id="kobo.11.1">) that can exploit sessions or </span><strong class="bold"><span class="koboSpan" id="kobo.12.1">Structured Query Language</span></strong><span class="koboSpan" id="kobo.13.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.14.1">SQL</span></strong><span class="koboSpan" id="kobo.15.1">) Injection attacks to bypass authentication or pull data across from databases, we’ll also dig into many more attacks that capitalize on the same poor </span><span class="No-Break"><span class="koboSpan" id="kobo.16.1">coding practices.</span></span></p>
<p><span class="koboSpan" id="kobo.17.1">In this chapter, we will cover the </span><span class="No-Break"><span class="koboSpan" id="kobo.18.1">following recipes:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.19.1">Testing for </span><span class="No-Break"><span class="koboSpan" id="kobo.20.1">reflected XSS</span></span></li>
<li><span class="koboSpan" id="kobo.21.1">Testing for HTTP </span><span class="No-Break"><span class="koboSpan" id="kobo.22.1">verb tampering</span></span></li>
<li><span class="koboSpan" id="kobo.23.1">Testing for </span><strong class="bold"><span class="koboSpan" id="kobo.24.1">HTTP Parameter </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.25.1">Pollution</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.26.1"> (</span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.27.1">HPP</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.28.1">)</span></span></li>
<li><span class="koboSpan" id="kobo.29.1">Testing for </span><span class="No-Break"><span class="koboSpan" id="kobo.30.1">SQL Injection</span></span></li>
</ul>
<h1 id="_idParaDest-178"><a id="_idTextAnchor231"/><span class="koboSpan" id="kobo.31.1">Technical requirements</span></h1>
<p><span class="koboSpan" id="kobo.32.1">For this chapter, it is required that you install </span><strong class="bold"><span class="koboSpan" id="kobo.33.1">OWASP Zed Attack Proxy</span></strong><span class="koboSpan" id="kobo.34.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.35.1">OWASP ZAP</span></strong><span class="koboSpan" id="kobo.36.1">) and OWASP Juice Shop on your machine to intercept traffic between the browser and OWASP Juice Shop. </span><span class="koboSpan" id="kobo.36.2">In addition, utilize your PortSwigger account for access to the PortSwigger Academy labs that will be used in this chapter’s recipes. </span><span class="koboSpan" id="kobo.36.3">Last, the use of the Mutillidae II Docker environment is required to complete some of </span><span class="No-Break"><span class="koboSpan" id="kobo.37.1">the attacks.</span></span></p>
<h1 id="_idParaDest-179"><a id="_idTextAnchor232"/><span class="koboSpan" id="kobo.38.1">Testing for reflected XSS</span></h1>
<p><span class="koboSpan" id="kobo.39.1">The XSS vulnerability</span><a id="_idIndexMarker301"/><span class="koboSpan" id="kobo.40.1"> is one of the most common web application injection attacks. </span><span class="koboSpan" id="kobo.40.2">This attack falls into number 3 in the </span><em class="italic"><span class="koboSpan" id="kobo.41.1">OWASP Top 10:2021 – Injection</span></em><span class="koboSpan" id="kobo.42.1"> category. </span><span class="koboSpan" id="kobo.42.2">XSS tricks the user’s browser into running malicious JavaScript code that an attacker has crafted to steal a user’s sensitive information, such as session cookies or passwords. </span><span class="koboSpan" id="kobo.42.3">In some cases, the attacker could take over the entire application if the session information of an administrator account were to be compromised. </span><span class="koboSpan" id="kobo.42.4">XSS attacks are possible in any application that uses input data from a user to produce an output. </span><span class="koboSpan" id="kobo.42.5">There are multiple XSS vulnerability types: Reflected XSS, Stored XSS, and DOM XSS. </span><span class="koboSpan" id="kobo.42.6">DOM XSS will be discussed in </span><a href="B18829_09.xhtml#_idTextAnchor320"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.43.1">Chapter 9</span></em></span></a><span class="koboSpan" id="kobo.44.1">, </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.45.1">Client-Side Testing</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.46.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.47.1">In this recipe, we will attack the OWASP Juice Shop application with a Reflected XSS payload and intercept the traffic using ZAP to manipulate the request and see the attack reflected, back in </span><span class="No-Break"><span class="koboSpan" id="kobo.48.1">the browser.</span></span></p>
<h2 id="_idParaDest-180"><a id="_idTextAnchor233"/><span class="koboSpan" id="kobo.49.1">Getting ready</span></h2>
<p><span class="koboSpan" id="kobo.50.1">This lab requires a running Juice Shop application and ZAP being able to intercept requests and responses from the server to </span><span class="No-Break"><span class="koboSpan" id="kobo.51.1">your browser.</span></span></p>
<h2 id="_idParaDest-181"><a id="_idTextAnchor234"/><span class="koboSpan" id="kobo.52.1">How to do it…</span></h2>
<p><span class="koboSpan" id="kobo.53.1">A Reflected XSS vulnerability happens when the application accepts the user’s input and displays it in the response output. </span><span class="koboSpan" id="kobo.53.2">Reflected XSS is not stored in the application permanently (non-persistent), unlike Stored </span><span class="No-Break"><span class="koboSpan" id="kobo.54.1">XSS (persistent).</span></span></p>
<p><span class="koboSpan" id="kobo.55.1">The following steps are used to exploit an </span><span class="No-Break"><span class="koboSpan" id="kobo.56.1">XSS vulnerability:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.57.1">Open OWASP </span><span class="No-Break"><span class="koboSpan" id="kobo.58.1">Juice Shop.</span></span></li>
<li><span class="koboSpan" id="kobo.59.1">Intercept the web application with OWASP ZAP with </span><strong class="bold"><span class="koboSpan" id="kobo.60.1">Set </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.61.1">Break</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.62.1"> enabled.</span></span></li>
<li><span class="koboSpan" id="kobo.63.1">Enter the following payload into the </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.64.1">Search</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.65.1"> field:</span></span><pre class="console"><span class="koboSpan" id="kobo.66.1">
&lt;image src=1 href=1 onerror="javascript:alert(1)"&gt;&lt;/image&gt;</span></pre></li>
<li><span class="koboSpan" id="kobo.67.1">Observe the reflected payload pop-up alert in the browser, as seen in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.68.1">Figure 6</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.69.1">.1</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.70.1">:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer153">
<span class="koboSpan" id="kobo.71.1"><img alt="Figure 6.1 – XSS payload reflected" src="image/Figure_06.01_B18829.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.72.1">Figure 6.1 – XSS payload reflected</span></p>
<h2 id="_idParaDest-182"><a id="_idTextAnchor235"/><span class="koboSpan" id="kobo.73.1">How it works…</span></h2>
<p><span class="koboSpan" id="kobo.74.1">Whether an XSS attack</span><a id="_idIndexMarker302"/><span class="koboSpan" id="kobo.75.1"> is reflected or stored, the result is always the same. </span><span class="koboSpan" id="kobo.75.2">The payload’s entry into the server’s system is what makes these two different. </span><span class="koboSpan" id="kobo.75.3">Never assume that a “read-only” website is immune to reflected XSS attacks. </span><span class="koboSpan" id="kobo.75.4">The end user may experience a range of issues as a result of XSS, from minor annoyances to full account compromise. </span><span class="koboSpan" id="kobo.75.5">By disclosing the user’s session cookie, XSS attacks provide the attacker access to the user’s session and account. </span><span class="koboSpan" id="kobo.75.6">Depending upon the level of privilege a user has, such as administrator-level privileges, this could increase </span><span class="No-Break"><span class="koboSpan" id="kobo.76.1">the risk.</span></span></p>
<h2 id="_idParaDest-183"><a id="_idTextAnchor236"/><span class="koboSpan" id="kobo.77.1">There’s more…</span></h2>
<p><span class="koboSpan" id="kobo.78.1">XSS attacks are common, and preventing them is critical. </span><span class="koboSpan" id="kobo.78.2">The following are two methods of protecting against XSS attacks. </span><span class="koboSpan" id="kobo.78.3">Keep in mind that these are not the only options to protect against </span><span class="No-Break"><span class="koboSpan" id="kobo.79.1">XSS attacks:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.80.1">Encoding non-alphanumeric characters to prevent the browser from executing the code</span></strong><span class="koboSpan" id="kobo.81.1">: You can utilize a library or framework that automatically encodes or escapes user input so that it is not perceived as code. </span><span class="koboSpan" id="kobo.81.2">In an HTML environment, for example, you may use Python’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.82.1">html.escape()</span></strong><span class="koboSpan" id="kobo.83.1"> method or JavaScript’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.84.1">HTMLElement.textContent</span></strong><span class="koboSpan" id="kobo.85.1"> property to encode user input so that it is interpreted as plaintext rather than </span><span class="No-Break"><span class="koboSpan" id="kobo.86.1">executable code.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.87.1">Validating the user’s input submitted by the user and allowing a specific list or type of input</span></strong><span class="koboSpan" id="kobo.88.1">: Using a whitelist of permitted characters rather than a blacklist of prohibited characters is one technique for doing this. </span><span class="koboSpan" id="kobo.88.2">You may, for instance, restrict input to alphanumeric letters and a few basic symbols while disallowing any input that comprises HTML or </span><span class="No-Break"><span class="koboSpan" id="kobo.89.1">JavaScript elements.</span></span></li>
<li><span class="koboSpan" id="kobo.90.1">It’s also a good idea to employ a </span><strong class="bold"><span class="koboSpan" id="kobo.91.1">Content Security Policy</span></strong><span class="koboSpan" id="kobo.92.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.93.1">CSP</span></strong><span class="koboSpan" id="kobo.94.1">) to indicate which sources </span><a id="_idIndexMarker303"/><span class="koboSpan" id="kobo.95.1">are permitted to execute scripts on your site, as well as to include input sanitization in your server-side validation process. </span><span class="koboSpan" id="kobo.95.2">Even if an attacker succeeds in circumventing your client-side validation, this can assist in </span><span class="No-Break"><span class="koboSpan" id="kobo.96.1">avoiding XSS.</span></span></li>
</ul>
<p class="callout-heading"><span class="koboSpan" id="kobo.97.1">Important note</span></p>
<p class="callout"><strong class="bold"><span class="koboSpan" id="kobo.98.1">Stored XSS</span></strong><span class="koboSpan" id="kobo.99.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.100.1">XSS Type II</span></strong><span class="koboSpan" id="kobo.101.1">) is a persistent attack also known as second-order XSS. </span><span class="koboSpan" id="kobo.101.2">It occurs </span><a id="_idIndexMarker304"/><span class="koboSpan" id="kobo.102.1">when an application obtains malicious data from an unreliable source, stores it in its servers, and then includes that data inadvertently in subsequent HTTP responses. </span><span class="koboSpan" id="kobo.102.2">This attack utilizes the same methods as </span><span class="No-Break"><span class="koboSpan" id="kobo.103.1">Reflected XSS.</span></span></p>
<h2 id="_idParaDest-184"><a id="_idTextAnchor237"/><span class="koboSpan" id="kobo.104.1">See also</span></h2>
<p><span class="koboSpan" id="kobo.105.1">For more information</span><a id="_idIndexMarker305"/><span class="koboSpan" id="kobo.106.1"> on XSS, go to the </span><span class="No-Break"><span class="koboSpan" id="kobo.107.1">following links:</span></span></p>
<ul>
<li><a href="https://cheatsheetseries.owasp.org/cheatsheets/Cross_Site_Scripting_Prevention_Cheat_Sheet.html"><span class="No-Break"><span class="koboSpan" id="kobo.108.1">https://cheatsheetseries.owasp.org/cheatsheets/Cross_Site_Scripting_Prevention_Cheat_Sheet.html</span></span></a></li>
<li><a href="https://owasp.org/www-community/attacks/xss/"><span class="No-Break"><span class="koboSpan" id="kobo.109.1">https://owasp.org/www-community/attacks/xss/</span></span></a></li>
</ul>
<p><span class="koboSpan" id="kobo.110.1">For more payloads, visit GitHub to search for more, or go to the </span><span class="No-Break"><span class="koboSpan" id="kobo.111.1">following link:</span></span></p>
<ul>
<li><a href="https://github.com/payloadbox/xss-payload-list"><span class="No-Break"><span class="koboSpan" id="kobo.112.1">https://github.com/payloadbox/xss-payload-li</span><span id="_idTextAnchor238"/><span class="koboSpan" id="kobo.113.1">st</span></span></a></li>
</ul>
<h1 id="_idParaDest-185"><a id="_idTextAnchor239"/><span class="koboSpan" id="kobo.114.1">Testing for HTTP verb tampering</span></h1>
<p><span class="koboSpan" id="kobo.115.1">When using various HTTP methods</span><a id="_idIndexMarker306"/><span class="koboSpan" id="kobo.116.1"> to access system objects, HTTP Verb Tampering evaluates how the web application reacts. </span><span class="koboSpan" id="kobo.116.2">The tester should attempt to reach each system object found during spidering using each </span><span class="No-Break"><span class="koboSpan" id="kobo.117.1">HTTP method.</span></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.118.1">GET</span></strong><span class="koboSpan" id="kobo.119.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.120.1">POST</span></strong><span class="koboSpan" id="kobo.121.1"> requests aren’t the only request types that the HTTP specification supports. </span><span class="koboSpan" id="kobo.121.2">Developers may not have anticipated how a standard-compliant web server will react to these alternate approaches. </span><span class="koboSpan" id="kobo.121.3">Although </span><em class="italic"><span class="koboSpan" id="kobo.122.1">verb tampering</span></em><span class="koboSpan" id="kobo.123.1"> is the usual term for these requests, the </span><em class="italic"><span class="koboSpan" id="kobo.124.1">RFC 9110</span></em><span class="koboSpan" id="kobo.125.1"> specification refers to them as various </span><span class="No-Break"><span class="koboSpan" id="kobo.126.1">HTTP methods.</span></span></p>
<p><span class="koboSpan" id="kobo.127.1">In this recipe, we’ll explore the use of a few of these HTTP verbs to understand the response that occurs from the server and how this can </span><span class="No-Break"><span class="koboSpan" id="kobo.128.1">be exploited.</span></span></p>
<h2 id="_idParaDest-186"><a id="_idTextAnchor240"/><span class="koboSpan" id="kobo.129.1">Getting ready</span></h2>
<p><span class="koboSpan" id="kobo.130.1">This lab requires an account with PortSwigger Academy and a working copy of ZAP to intercept requests and responses from the server to your browser. </span><span class="koboSpan" id="kobo.130.2">We will be utilizing the </span><em class="italic"><span class="koboSpan" id="kobo.131.1">Information disclosure due to insecure configuration</span></em><span class="koboSpan" id="kobo.132.1"> lab for </span><span class="No-Break"><span class="koboSpan" id="kobo.133.1">this recipe.</span></span></p>
<h2 id="_idParaDest-187"><a id="_idTextAnchor241"/><span class="koboSpan" id="kobo.134.1">How to do it…</span></h2>
<p><span class="koboSpan" id="kobo.135.1">In this recipe, the administrative interface has an authentication bypass flaw. </span><span class="koboSpan" id="kobo.135.2">In order to take advantage of it, the attacker must understand the specific HTTP header that the </span><span class="No-Break"><span class="koboSpan" id="kobo.136.1">frontend uses.</span></span></p>
<p><span class="koboSpan" id="kobo.137.1">The following steps are used to exploit HTTP </span><span class="No-Break"><span class="koboSpan" id="kobo.138.1">verb tampering:</span></span></p>
<ol>
<li value="1"><span class="koboSpan" id="kobo.139.1">Start by intercepting web traffic in ZAP using </span><strong class="bold"><span class="koboSpan" id="kobo.140.1">Manual Explore</span></strong><span class="koboSpan" id="kobo.141.1"> from the </span><strong class="bold"><span class="koboSpan" id="kobo.142.1">Quick Start</span></strong><span class="koboSpan" id="kobo.143.1"> menu, and within </span><strong class="bold"><span class="koboSpan" id="kobo.144.1">Manual Explore</span></strong><span class="koboSpan" id="kobo.145.1">, enable </span><strong class="bold"><span class="koboSpan" id="kobo.146.1">Set Break</span></strong><span class="koboSpan" id="kobo.147.1"> and refresh the </span><span class="No-Break"><span class="koboSpan" id="kobo.148.1">web page.</span></span></li>
<li><span class="koboSpan" id="kobo.149.1">By browsing to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.150.1">/admin</span></strong><span class="koboSpan" id="kobo.151.1"> path, notice the </span><strong class="source-inline"><span class="koboSpan" id="kobo.152.1">GET</span></strong><span class="koboSpan" id="kobo.153.1"> request. </span><span class="koboSpan" id="kobo.153.2">The response will disclose an </span><strong class="bold"><span class="koboSpan" id="kobo.154.1">Admin interface only available to local </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.155.1">users</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.156.1"> message.</span></span></li>
<li><span class="koboSpan" id="kobo.157.1">Resend the request, but replace </span><strong class="source-inline"><span class="koboSpan" id="kobo.158.1">GET</span></strong><span class="koboSpan" id="kobo.159.1"> with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.160.1">TRACE</span></strong><span class="koboSpan" id="kobo.161.1"> method (see </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.162.1">Figure 6</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.163.1">.2</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.164.1">):</span></span><pre class="console"><span class="koboSpan" id="kobo.165.1">
TRACE /admin</span></pre></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer154">
<span class="koboSpan" id="kobo.166.1"><img alt="Figure 6.2 – TRACE request" src="image/Figure_06.02_B18829.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.167.1">Figure 6.2 – TRACE request</span></p>
<ol>
<li value="4"><span class="koboSpan" id="kobo.168.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.169.1">X-Custom-IP-Authorization</span></strong><span class="koboSpan" id="kobo.170.1"> header will now contain your IP address, appended</span><a id="_idIndexMarker307"/><span class="koboSpan" id="kobo.171.1"> to your request. </span><span class="koboSpan" id="kobo.171.2">This is used to determine whether the request came from</span><a id="_idTextAnchor242"/><span class="koboSpan" id="kobo.172.1"> the localhost IP address, as shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.173.1">Figure 6</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.174.1">.3</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.175.1">:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer155">
<span class="koboSpan" id="kobo.176.1"><img alt="Figure 6.3 – Response containing the IP address" src="image/Figure_06.03_B18829.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.177.1">Figure 6.3 – Response containing the IP address</span></p>
<ol>
<li value="5"><span class="koboSpan" id="kobo.178.1">Open </span><strong class="bold"><span class="koboSpan" id="kobo.179.1">Replacer</span></strong><span class="koboSpan" id="kobo.180.1"> (</span><em class="italic"><span class="koboSpan" id="kobo.181.1">Ctrl</span></em><span class="koboSpan" id="kobo.182.1"> + </span><em class="italic"><span class="koboSpan" id="kobo.183.1">R</span></em><span class="koboSpan" id="kobo.184.1">). </span><span class="koboSpan" id="kobo.184.2">This will be used to match and replace a header. </span><span class="koboSpan" id="kobo.184.3">Create a description, and leave </span><strong class="bold"><span class="koboSpan" id="kobo.185.1">Match Type</span></strong><span class="koboSpan" id="kobo.186.1"> as </span><strong class="bold"><span class="koboSpan" id="kobo.187.1">Response Body String</span></strong><span class="koboSpan" id="kobo.188.1">. </span><span class="koboSpan" id="kobo.188.2">Add the following to the </span><strong class="bold"><span class="koboSpan" id="kobo.189.1">Replacement </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.190.1">String</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.191.1"> field:</span></span><pre class="console">
<strong class="bold"><span class="koboSpan" id="kobo.192.1">X-Custom-IP-Authorization: 127.0.0.1</span></strong></pre></li>
</ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.193.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.194.1">The IP address is the same IP address seen in the HTTP Response when you tried visiting the /admin page in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.195.1">Step 3</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.196.1">.</span></span></p>
<ol>
<li value="6"><span class="koboSpan" id="kobo.197.1">Add the following to the </span><strong class="bold"><span class="koboSpan" id="kobo.198.1">Replacement String</span></strong><span class="koboSpan" id="kobo.199.1"> field as seen in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.200.1">Figure 6</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.201.1">.4</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.202.1">:</span></span><pre class="console">
<strong class="bold"><span class="koboSpan" id="kobo.203.1">X-Custom-IP-Authorization: 127.0.0.1</span></strong></pre></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer156">
<span class="koboSpan" id="kobo.204.1"><img alt="Figure 6.4 – Match / Replace String" src="image/Figure_06.04_B18829.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.205.1">Figure 6.4 – Match / Replace String</span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.206.1">Important note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.207.1">For the </span><strong class="bold"><span class="koboSpan" id="kobo.208.1">Replace</span></strong><span class="koboSpan" id="kobo.209.1"> rule per the </span><span class="No-Break"><span class="koboSpan" id="kobo.210.1">OWASP documentation:</span></span></p>
<p class="callout"><strong class="bold"><span class="koboSpan" id="kobo.211.1">Response </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.212.1">Body String:</span></strong></span></p>
<p class="callout"><em class="italic"><span class="koboSpan" id="kobo.213.1">In this case, the Match String instance will be treated as a string or regular expression (regex).If it is present in the response body, then it will be replaced by the </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.214.1">replacement text.</span></em></span></p>
<ol>
<li value="7"><span class="koboSpan" id="kobo.215.1">Check the </span><strong class="bold"><span class="koboSpan" id="kobo.216.1">Enable</span></strong><span class="koboSpan" id="kobo.217.1"> check box and click </span><strong class="bold"><span class="koboSpan" id="kobo.218.1">Save</span></strong><span class="koboSpan" id="kobo.219.1">. </span><span class="koboSpan" id="kobo.219.2">ZAP</span><a id="_idIndexMarker308"/><span class="koboSpan" id="kobo.220.1"> will now add this to every request </span><span class="No-Break"><span class="koboSpan" id="kobo.221.1">you send.</span></span></li>
<li><span class="koboSpan" id="kobo.222.1">Browse back to the home page. </span><span class="koboSpan" id="kobo.222.2">Notice that you now have access to the </span><strong class="bold"><span class="koboSpan" id="kobo.223.1">Admin panel</span></strong><span class="koboSpan" id="kobo.224.1"> link (displayed in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.225.1">Figure 6</span></em></span><em class="italic"><span class="koboSpan" id="kobo.226.1">.5</span></em><span class="koboSpan" id="kobo.227.1">) and can then delete the </span><span class="No-Break"><span class="koboSpan" id="kobo.228.1">user, </span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.229.1">Carlos</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.230.1">:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer157">
<span class="koboSpan" id="kobo.231.1"><img alt="Figure 6.5 – Admin panel" src="image/Figure_06.05_B18829.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.232.1">Figure 6.5 – Admin panel</span></p>
<h2 id="_idParaDest-188"><a id="_idTextAnchor243"/><span class="koboSpan" id="kobo.233.1">How it works…</span></h2>
<p><span class="koboSpan" id="kobo.234.1">The HTTP </span><strong class="source-inline"><span class="koboSpan" id="kobo.235.1">TRACE</span></strong><span class="koboSpan" id="kobo.236.1"> method is intended for troubleshooting. </span><span class="koboSpan" id="kobo.236.2">When you enable the </span><strong class="source-inline"><span class="koboSpan" id="kobo.237.1">TRACE</span></strong><span class="koboSpan" id="kobo.238.1"> method, the web server will run a message loopback test along the path to the </span><span class="No-Break"><span class="koboSpan" id="kobo.239.1">target resource.</span></span></p>
<p><span class="koboSpan" id="kobo.240.1">Although this behavior is usually harmless and often used by developers for useful debugging purposes, if configured incorrectly, it can result in the leaking of private data, including internal authentication headers added by </span><span class="No-Break"><span class="koboSpan" id="kobo.241.1">reverse proxies.</span></span></p>
<p><span class="koboSpan" id="kobo.242.1">The following are other standard methods </span><span class="No-Break"><span class="koboSpan" id="kobo.243.1">commonly used:</span></span></p>
<ul>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.244.1">GET</span></strong><span class="koboSpan" id="kobo.245.1">: Transfer a current representation of the </span><span class="No-Break"><span class="koboSpan" id="kobo.246.1">target resource</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.247.1">HEAD</span></strong><span class="koboSpan" id="kobo.248.1">: Same as </span><strong class="source-inline"><span class="koboSpan" id="kobo.249.1">GET</span></strong><span class="koboSpan" id="kobo.250.1">, but do not transfer the </span><span class="No-Break"><span class="koboSpan" id="kobo.251.1">response content</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.252.1">POST</span></strong><span class="koboSpan" id="kobo.253.1">: Perform resource-specific processing on the </span><span class="No-Break"><span class="koboSpan" id="kobo.254.1">request content</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.255.1">PUT</span></strong><span class="koboSpan" id="kobo.256.1">: Replace all current representations of the target resource with the </span><span class="No-Break"><span class="koboSpan" id="kobo.257.1">requested content</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.258.1">DELETE</span></strong><span class="koboSpan" id="kobo.259.1">: Remove all current representations of the </span><span class="No-Break"><span class="koboSpan" id="kobo.260.1">target resource</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.261.1">CONNECT</span></strong><span class="koboSpan" id="kobo.262.1">: Establish a tunnel to the server identified by the </span><span class="No-Break"><span class="koboSpan" id="kobo.263.1">target resource</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.264.1">OPTIONS</span></strong><span class="koboSpan" id="kobo.265.1">: Describe the communication options for the </span><span class="No-Break"><span class="koboSpan" id="kobo.266.1">target resource</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.267.1">TRACK</span></strong><span class="koboSpan" id="kobo.268.1">: Define text tracks</span><a id="_idIndexMarker309"/><span class="koboSpan" id="kobo.269.1"> for components with </span><strong class="source-inline"><span class="koboSpan" id="kobo.270.1">audio&gt;</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.271.1">or </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.272.1">video&gt;</span></strong></span></li>
</ul>
<h2 id="_idParaDest-189"><a id="_idTextAnchor244"/><span class="koboSpan" id="kobo.273.1">There’s more…</span></h2>
<p><span class="koboSpan" id="kobo.274.1">Remember that the web server handles the </span><strong class="source-inline"><span class="koboSpan" id="kobo.275.1">TRACE</span></strong><span class="koboSpan" id="kobo.276.1"> verb. </span><span class="koboSpan" id="kobo.276.2">Your request may be routed through additional components</span><a id="_idIndexMarker310"/><span class="koboSpan" id="kobo.277.1"> on its way to the web server, such as a </span><strong class="bold"><span class="koboSpan" id="kobo.278.1">web application firewall</span></strong><span class="koboSpan" id="kobo.279.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.280.1">WAF</span></strong><span class="koboSpan" id="kobo.281.1">) or load balancer. </span><span class="koboSpan" id="kobo.281.2">If that WAF includes headers, your </span><strong class="source-inline"><span class="koboSpan" id="kobo.282.1">TRACE</span></strong><span class="koboSpan" id="kobo.283.1"> response will include those headers, allowing you to obtain </span><span class="No-Break"><span class="koboSpan" id="kobo.284.1">more information.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.285.1">Important note</span></p>
<p class="callout"><strong class="source-inline"><span class="koboSpan" id="kobo.286.1">XMLHttpRequest</span></strong><span class="koboSpan" id="kobo.287.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.288.1">XHR</span></strong><span class="koboSpan" id="kobo.289.1">) will no longer send a </span><strong class="source-inline"><span class="koboSpan" id="kobo.290.1">"TRACE"</span></strong><span class="koboSpan" id="kobo.291.1"> request in modern</span><a id="_idIndexMarker311"/><span class="koboSpan" id="kobo.292.1"> browsers, and the </span><strong class="bold"><span class="koboSpan" id="kobo.293.1">Cross-Origin Resource Sharing</span></strong><span class="koboSpan" id="kobo.294.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.295.1">CORS</span></strong><span class="koboSpan" id="kobo.296.1">) framework prevents XHR</span><a id="_idIndexMarker312"/><span class="koboSpan" id="kobo.297.1"> requests to foreign sites that do not explicitly allow them. </span><span class="koboSpan" id="kobo.297.2">As a result, old</span><a id="_idIndexMarker313"/><span class="koboSpan" id="kobo.298.1"> attacks seen in </span><strong class="bold"><span class="koboSpan" id="kobo.299.1">cross-site tracing</span></strong><span class="koboSpan" id="kobo.300.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.301.1">XST</span></strong><span class="koboSpan" id="kobo.302.1">) are no </span><span class="No-Break"><span class="koboSpan" id="kobo.303.1">longer effective.</span></span></p>
<h2 id="_idParaDest-190"><a id="_idTextAnchor245"/><span class="koboSpan" id="kobo.304.1">See also</span></h2>
<p><span class="koboSpan" id="kobo.305.1">For further</span><a id="_idIndexMarker314"/><span class="koboSpan" id="kobo.306.1"> information on </span><em class="italic"><span class="koboSpan" id="kobo.307.1">RFC 9110</span></em><span class="koboSpan" id="kobo.308.1">, please </span><span class="No-Break"><span class="koboSpan" id="kobo.309.1">visit </span></span><a href="https://www.rfc-editor.org/rfc/rfc9110.html#method.overview"><span class="No-Break"><span class="koboSpan" id="kobo.310.1">https://www.rfc-editor.org/rfc/rfc9110.html#method.overview</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.311.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.312.1">For</span><a id="_idIndexMarker315"/><span class="koboSpan" id="kobo.313.1"> more reading on </span><strong class="bold"><span class="koboSpan" id="kobo.314.1">Web Distributed Authoring and Version</span></strong><span class="koboSpan" id="kobo.315.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.316.1">WebDAV</span></strong><span class="koboSpan" id="kobo.317.1">), please visit </span><a href="http://www.webdav.org/specs/rfc2518.html"><span class="koboSpan" id="kobo.318.1">http://www.webdav.org/specs/rfc2518.html</span></a><span class="koboSpan" id="kobo.319.1"> or </span><a href="https://datatracker.ietf.org/doc/html/rfc4918"><span class="koboSpan" id="kobo.320.1">https://datatracker.ietf.org/doc/html/rfc4918</span></a><span class="koboSpan" id="kobo.321.1"> (</span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.322.1">RFC 4918</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.323.1">).</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.324.1">Important note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.325.1">If WebDAV extensions are enabled, these may permit several more HTTP methods: </span><strong class="source-inline"><span class="koboSpan" id="kobo.326.1">PROPFIND</span></strong><span class="koboSpan" id="kobo.327.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.328.1">PROPPATCH</span></strong><span class="koboSpan" id="kobo.329.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.330.1">MKCOL</span></strong><span class="koboSpan" id="kobo.331.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.332.1">COPY</span></strong><span class="koboSpan" id="kobo.333.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.334.1">MOVE</span></strong><span class="koboSpan" id="kobo.335.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.336.1">LOCK</span></strong><span class="koboSpan" id="kobo.337.1">, </span><a id="_idTextAnchor246"/><span class="No-Break"><span class="koboSpan" id="kobo.338.1">a</span><a id="_idTextAnchor247"/><span class="koboSpan" id="kobo.339.1">nd </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.340.1">UNLOCK</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.341.1">.</span></span></p>
<h1 id="_idParaDest-191"><a id="_idTextAnchor248"/><span class="koboSpan" id="kobo.342.1">Testing for HTTP Parameter Pollution (HPP)</span></h1>
<p><span class="koboSpan" id="kobo.343.1">In this recipe, we are going</span><a id="_idIndexMarker316"/><span class="koboSpan" id="kobo.344.1"> to go over HPP, and you will learn that by polluting a parameter, an attacker could take advantage of creating an account and take over another user’s account for </span><span class="No-Break"><span class="koboSpan" id="kobo.345.1">their use.</span></span></p>
<h2 id="_idParaDest-192"><a id="_idTextAnchor249"/><span class="koboSpan" id="kobo.346.1">Getting ready</span></h2>
<p><span class="koboSpan" id="kobo.347.1">To prepare for this recipe, please start ZAP and OWASP Juice Shop. </span><span class="koboSpan" id="kobo.347.2">Make sure that ZAP intercepts traffic at the OWASP Juice Shop application </span><span class="No-Break"><span class="koboSpan" id="kobo.348.1">home page.</span></span></p>
<h2 id="_idParaDest-193"><a id="_idTextAnchor250"/><span class="koboSpan" id="kobo.349.1">How to do it…</span></h2>
<p><span class="koboSpan" id="kobo.350.1">In this recipe, we’ll lead you through the steps on how to conduct HPP in OWASP Juice Shop. </span><span class="koboSpan" id="kobo.350.2">We are going to pollute the email field by adding a second value, which will allow the account creation process to establish an account with the attacker’s email in place of the </span><span class="No-Break"><span class="koboSpan" id="kobo.351.1">victim’s email.</span></span></p>
<p><span class="koboSpan" id="kobo.352.1">The following steps guide you through </span><span class="No-Break"><span class="koboSpan" id="kobo.353.1">this process:</span></span></p>
<ol>
<li value="1"><span class="koboSpan" id="kobo.354.1">Open ZAP and enable interception on ZAP by clicking </span><strong class="bold"><span class="koboSpan" id="kobo.355.1">Set break on all requests and responses</span></strong><span class="koboSpan" id="kobo.356.1">, which will turn from green to red when enabled. </span><span class="koboSpan" id="kobo.356.2">See </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.357.1">Figure 6</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.358.1">.</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.359.1">6</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.360.1">:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer158">
<span class="koboSpan" id="kobo.361.1"><img alt="Figure 6.6 – Setting a break" src="image/Figure_06.06_B18829.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.362.1">Figure 6.6 – Setting a break</span></p>
<p><span class="koboSpan" id="kobo.363.1">You also will need to step</span><a id="_idIndexMarker317"/><span class="koboSpan" id="kobo.364.1"> through each request since this configuration will stop all requests sent by the browser </span><span class="No-Break"><span class="koboSpan" id="kobo.365.1">and responses.</span></span></p>
<ol>
<li value="2"><span class="koboSpan" id="kobo.366.1">Start by going to </span><strong class="bold"><span class="koboSpan" id="kobo.367.1">Account</span></strong><span class="koboSpan" id="kobo.368.1"> then </span><strong class="bold"><span class="koboSpan" id="kobo.369.1">Login</span></strong><span class="koboSpan" id="kobo.370.1"> then </span><strong class="bold"><span class="koboSpan" id="kobo.371.1">Not Yet </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.372.1">a Customer</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.373.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.374.1">Create a </span><strong class="source-inline"><span class="koboSpan" id="kobo.375.1">victim@email.com</span></strong><span class="koboSpan" id="kobo.376.1"> email address with any password and anything for the </span><span class="No-Break"><span class="koboSpan" id="kobo.377.1">security question.</span></span></li>
<li><span class="koboSpan" id="kobo.378.1">After you click </span><strong class="bold"><span class="koboSpan" id="kobo.379.1">Register</span></strong><span class="koboSpan" id="kobo.380.1">, go to ZAP and look at the request, then enter the attacker email by copying the field name and the value, as shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.381.1">Figure 6</span></em></span><em class="italic"><span class="koboSpan" id="kobo.382.1">.7</span></em><span class="koboSpan" id="kobo.383.1">, and forward the request </span><span class="No-Break"><span class="koboSpan" id="kobo.384.1">on ZAP:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer159">
<span class="koboSpan" id="kobo.385.1"><img alt="Figure 6.7 – Request to change to attacker email" src="image/Figure_06.07_B18829.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.386.1">Figure 6.7 – Request to change to attacker email</span></p>
<ol>
<li value="5"><span class="koboSpan" id="kobo.387.1">After you send the request, the response will show the successful registration of the account but now with the attacker’s email</span><a id="_idIndexMarker318"/><span class="koboSpan" id="kobo.388.1"> instead of the victim’s email. </span><span class="koboSpan" id="kobo.388.2">See </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.389.1">Figure 6</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.390.1">.8</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.391.1">:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer160">
<span class="koboSpan" id="kobo.392.1"><img alt="Figure 6.8 – Response of successful attacker registration of the account" src="image/Figure_06.08_B18829.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.393.1">Figure 6.8 – Response of successful attacker registration of the account</span></p>
<ol>
<li value="6"><span class="koboSpan" id="kobo.394.1">Lastly, log in with the attacker’s email address and password you created. </span><span class="koboSpan" id="kobo.394.2">Notice that the account showing under the profile is the attacker’s email. </span><span class="koboSpan" id="kobo.394.3">See </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.395.1">Figure 6</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.396.1">.9</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.397.1">:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer161">
<span class="koboSpan" id="kobo.398.1"><img alt="Figure 6.9 – Login of attacker account" src="image/Figure_06.09_B18829.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.399.1">Figure 6.9 – Login of attacker account</span></p>
<h2 id="_idParaDest-194"><a id="_idTextAnchor251"/><span class="koboSpan" id="kobo.400.1">How it works…</span></h2>
<p><span class="koboSpan" id="kobo.401.1">The attack works due to the application</span><a id="_idIndexMarker319"/><span class="koboSpan" id="kobo.402.1"> accepting multiple parameters with the same name. </span><span class="koboSpan" id="kobo.402.2">Since there is no standard on how an application should handle multiple parameters with the same name, this can cause an application to process the parameter in </span><span class="No-Break"><span class="koboSpan" id="kobo.403.1">unanticipated ways.</span></span></p>
<p><span class="koboSpan" id="kobo.404.1">In addition, HPP attacks include inserting several contradictory values into the query string parameters of an HTTP request in order to confuse or manipulate the server-side program that processes </span><span class="No-Break"><span class="koboSpan" id="kobo.405.1">the request.</span></span></p>
<p><span class="koboSpan" id="kobo.406.1">An attacker might try to leverage this approach by converting arguments into an array. </span><span class="koboSpan" id="kobo.406.2">For example, an attacker may make the </span><span class="No-Break"><span class="koboSpan" id="kobo.407.1">following request:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.408.1">
GET /search?q[]=var1&amp;q[]=var2 HTTP/1.1
Host: example.com</span></pre>
<p><span class="koboSpan" id="kobo.409.1">In this case, the attacker is attempting to inject two contradictory values into the </span><strong class="source-inline"><span class="koboSpan" id="kobo.410.1">q</span></strong><span class="koboSpan" id="kobo.411.1"> argument by converting it to an array. </span><span class="koboSpan" id="kobo.411.2">This might be exploited to circumvent input validation or cause the program to </span><span class="No-Break"><span class="koboSpan" id="kobo.412.1">act unexpectedly.</span></span></p>
<h2 id="_idParaDest-195"><a id="_idTextAnchor252"/><span class="koboSpan" id="kobo.413.1">See also</span></h2>
<p><span class="koboSpan" id="kobo.414.1">Consider further reading</span><a id="_idIndexMarker320"/><span class="koboSpan" id="kobo.415.1"> to understand HPP and remediations for this type of attack. </span><span class="koboSpan" id="kobo.415.2">Here’s a resource you could look </span><span class="No-Break"><span class="koboSpan" id="kobo.416.1">at: </span></span><a href="https://owasp.org/www-project-web-security-testing-guide/latest/4-Web_Application_Security_Testing/07-Input_Validation_Testing/04-Testing_for_HTTP_Parameter_Pollution"><span class="No-Break"><span class="koboSpan" id="kobo.417.1">https://owasp.org/www-project-web-security-testing-guide/latest/4-Web_Application_Security_Testing/07-Input_Validation_Testing/04-Testing_for_HTTP_Parameter</span><span id="_idTextAnchor253"/><span class="koboSpan" id="kobo.418.1">_Pollution</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.419.1">.</span></span></p>
<h1 id="_idParaDest-196"><a id="_idTextAnchor254"/><span class="koboSpan" id="kobo.420.1">Testing for SQL Injection</span></h1>
<p><span class="koboSpan" id="kobo.421.1">SQL Injection</span><a id="_idIndexMarker321"/><span class="koboSpan" id="kobo.422.1"> is an attack that injects a SQL query</span><a id="_idIndexMarker322"/><span class="koboSpan" id="kobo.423.1"> mainly in input fields to unauthorizedly view database data, perform modifications to database data, or execute commands to control the underlying infrastructure. </span><span class="koboSpan" id="kobo.423.2">SQL Injection is considered one of the most common web application attacks. </span><span class="koboSpan" id="kobo.423.3">SQL Injection is a critical web application vulnerability; a successful attack can enable the attacker to make modifications (delete, view, or edit) to all the data stored in the database or execute commands on the </span><span class="No-Break"><span class="koboSpan" id="kobo.424.1">underlying system.</span></span></p>
<p><span class="koboSpan" id="kobo.425.1">It is important to prevent</span><a id="_idIndexMarker323"/><span class="koboSpan" id="kobo.426.1"> SQL Injection attacks; some of the techniques to prevent them are </span><span class="No-Break"><span class="koboSpan" id="kobo.427.1">listed here:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.428.1">Using parameterized queries, which prevents the application from adding the user’s input directly to the database query. </span><span class="koboSpan" id="kobo.428.2">This enables the developer to hardcode the SQL query and then pass the user’s input as parameters to </span><span class="No-Break"><span class="koboSpan" id="kobo.429.1">the query.</span></span></li>
<li><span class="koboSpan" id="kobo.430.1">Escaping user input, which escapes special characters in the query. </span><span class="koboSpan" id="kobo.430.2">SQL Injection attacks are dependent on special characters to complete the SQL </span><a id="_idTextAnchor255"/><span class="koboSpan" id="kobo.431.1">query, such as </span><strong class="source-inline"><span class="koboSpan" id="kobo.432.1">'</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.433.1">or </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.434.1">"</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.435.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.436.1">Input sanitization, which programmatically specifies which types of characters are accepted—for example, only accepting </span><span class="No-Break"><span class="koboSpan" id="kobo.437.1">alphabetic characters.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.438.1">Keep in mind that these techniques are not the only methods to prevent SQL </span><span class="No-Break"><span class="koboSpan" id="kobo.439.1">Injection attacks.</span></span></p>
<h2 id="_idParaDest-197"><a id="_idTextAnchor256"/><span class="koboSpan" id="kobo.440.1">Getting ready</span></h2>
<p><span class="koboSpan" id="kobo.441.1">To follow along in this lab, ensure that Juice Shop is running and ZAP is intercepting </span><span class="No-Break"><span class="koboSpan" id="kobo.442.1">the requests.</span></span></p>
<h2 id="_idParaDest-198"><a id="_idTextAnchor257"/><span class="koboSpan" id="kobo.443.1">How to do it…</span></h2>
<p><span class="koboSpan" id="kobo.444.1">The following instructions</span><a id="_idIndexMarker324"/><span class="koboSpan" id="kobo.445.1"> walk you through steps to exploit a SQL Injection vulnerability in the login page of the OWASP Juice Shop application. </span><span class="koboSpan" id="kobo.445.2">In this lab, we will perform an SQL Injection attack to bypass the authentication mechanism and log in as the administrator. </span><span class="koboSpan" id="kobo.445.3">Before following the steps, ensure that the OWASP Juice Shop application is running and ZAP is intercepting the traffic between the application and </span><span class="No-Break"><span class="koboSpan" id="kobo.446.1">the browser:</span></span></p>
<ol>
<li value="1"><span class="koboSpan" id="kobo.447.1">When we open OWASP Juice Shop, we must find the email/username of the administrator account. </span><span class="koboSpan" id="kobo.447.2">On the home page (the </span><strong class="bold"><span class="koboSpan" id="kobo.448.1">All Products</span></strong><span class="koboSpan" id="kobo.449.1"> page), click on </span><strong class="bold"><span class="koboSpan" id="kobo.450.1">Apple Juice</span></strong><span class="koboSpan" id="kobo.451.1">, and in the </span><strong class="bold"><span class="koboSpan" id="kobo.452.1">Reviews</span></strong><span class="koboSpan" id="kobo.453.1"> section, you can see that the administrator wrote a review and their email is shown, as seen in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.454.1">Figure 6</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.455.1">.</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.456.1">10</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.457.1">:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer162">
<span class="koboSpan" id="kobo.458.1"><img alt="Figure 6.10 – Administrator email in Reviews" src="image/Figure_06.10_B18829.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.459.1">Figure 6.10 – Administrator email in Reviews</span></p>
<ol>
<li value="2"><span class="koboSpan" id="kobo.460.1">Navigate to the login page by clicking on </span><strong class="bold"><span class="koboSpan" id="kobo.461.1">Account</span></strong><span class="koboSpan" id="kobo.462.1"> and then </span><strong class="bold"><span class="koboSpan" id="kobo.463.1">Login</span></strong><span class="koboSpan" id="kobo.464.1">, as seen in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.465.1">Figure 6</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.466.1">.11</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.467.1">:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer163">
<span class="koboSpan" id="kobo.468.1"><img alt="Figure 6.11 – Login" src="image/Figure_06.11_B18829.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.469.1">Figure 6.11 – Login</span></p>
<ol>
<li value="3"><span class="koboSpan" id="kobo.470.1">Enter </span><strong class="source-inline"><span class="koboSpan" id="kobo.471.1">admin@juice-sh.op</span></strong><span class="koboSpan" id="kobo.472.1"> as the email</span><a id="_idIndexMarker325"/><span class="koboSpan" id="kobo.473.1"> and any value as the password. </span><span class="koboSpan" id="kobo.473.2">The login </span><span class="No-Break"><span class="koboSpan" id="kobo.474.1">will fail.</span></span></li>
<li><span class="koboSpan" id="kobo.475.1">Once the login fails, open ZAP. </span><span class="koboSpan" id="kobo.475.2">In the </span><strong class="bold"><span class="koboSpan" id="kobo.476.1">History</span></strong><span class="koboSpan" id="kobo.477.1"> tab, find the login request. </span><span class="koboSpan" id="kobo.477.2">The request will be a </span><strong class="source-inline"><span class="koboSpan" id="kobo.478.1">POST</span></strong><span class="koboSpan" id="kobo.479.1"> request, the URL will be </span><strong class="source-inline"><span class="koboSpan" id="kobo.480.1">/rest/user/login</span></strong><span class="koboSpan" id="kobo.481.1">, and the code will be a </span><strong class="bold"><span class="koboSpan" id="kobo.482.1">401</span></strong><span class="koboSpan" id="kobo.483.1"> code. </span><span class="koboSpan" id="kobo.483.2">Right-click the request and select </span><strong class="bold"><span class="koboSpan" id="kobo.484.1">Open/Resend with Request Editor…</span></strong><span class="koboSpan" id="kobo.485.1">, as seen in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.486.1">Figure 6</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.487.1">.12</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.488.1">:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer164">
<span class="koboSpan" id="kobo.489.1"><img alt="Figure 6.12 – Open/Resend with Request Editor…" src="image/Figure_06.12_B18829.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.490.1">Figure 6.12 – Open/Resend with Request Editor…</span></p>
<ol>
<li value="5"><span class="koboSpan" id="kobo.491.1">Once </span><strong class="bold"><span class="koboSpan" id="kobo.492.1">Request Editor</span></strong><span class="koboSpan" id="kobo.493.1"> opens, in the bottom window you will see the email. </span><span class="koboSpan" id="kobo.493.2">After the last character</span><a id="_idIndexMarker326"/><span class="koboSpan" id="kobo.494.1"> in the email, add </span><strong class="source-inline"><span class="koboSpan" id="kobo.495.1">' OR 1=1 --</span></strong><span class="koboSpan" id="kobo.496.1"> to exploit the SQL vulnerability and bypass the login mechanism, as seen in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.497.1">Figure 6</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.498.1">.13</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.499.1">:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer165">
<span class="koboSpan" id="kobo.500.1"><img alt="Figure 6.13 – SQL Injection attack" src="image/Figure_06.13_B18829.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.501.1">Figure 6.13 – SQL Injection attack</span></p>
<ol>
<li value="6"><span class="koboSpan" id="kobo.502.1">Click on the </span><strong class="bold"><span class="koboSpan" id="kobo.503.1">Send</span></strong><span class="koboSpan" id="kobo.504.1"> button on the top right of the editor. </span><span class="koboSpan" id="kobo.504.2">The HTTP response will open, showcasing a successful HTTP</span><a id="_idIndexMarker327"/><span class="koboSpan" id="kobo.505.1"> response status code of </span><strong class="bold"><span class="koboSpan" id="kobo.506.1">200 OK</span></strong><span class="koboSpan" id="kobo.507.1"> along with a created </span><strong class="bold"><span class="koboSpan" id="kobo.508.1">JSON Web Token</span></strong><span class="koboSpan" id="kobo.509.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.510.1">JWT</span></strong><span class="koboSpan" id="kobo.511.1">) authentication token, shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.512.1">Figure 6</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.513.1">.14</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.514.1">:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer166">
<span class="koboSpan" id="kobo.515.1"><img alt="Figure 6.14 – HTTP 200 response status" src="image/Figure_06.14_B18829.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.516.1">Figure 6.14 – HTTP 200 response status</span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.517.1">Important note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.518.1">The SQL Injection</span><a id="_idIndexMarker328"/><span class="koboSpan" id="kobo.519.1"> vulnerability can be exploited directly from the login web page as well, by entering a login username </span><a id="_idTextAnchor258"/><span class="koboSpan" id="kobo.520.1">along with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.521.1">' OR 1 = 1 –</span></strong><span class="koboSpan" id="kobo.522.1"> injection code, as seen in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.523.1">Figure 6</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.524.1">.15</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.525.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer167">
<span class="koboSpan" id="kobo.526.1"><img alt="Figure 6.15 – Login bypass" src="image/Figure_06.15_B18829.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.527.1">Figure 6.15 – Login bypass</span></p>
<h2 id="_idParaDest-199"><a id="_idTextAnchor259"/><span class="koboSpan" id="kobo.528.1">How it works…</span></h2>
<p><span class="koboSpan" id="kobo.529.1">A Boolean value</span><a id="_idIndexMarker329"/><span class="koboSpan" id="kobo.530.1"> in SQL can be either </span><strong class="source-inline"><span class="koboSpan" id="kobo.531.1">TRUE</span></strong><span class="koboSpan" id="kobo.532.1"> or </span><strong class="source-inline"><span class="koboSpan" id="kobo.533.1">FALSE</span></strong><span class="koboSpan" id="kobo.534.1">. </span><span class="koboSpan" id="kobo.534.2">In SQL, Boolean logic is used to combine numerous criteria in a </span><strong class="source-inline"><span class="koboSpan" id="kobo.535.1">WHERE</span></strong><span class="koboSpan" id="kobo.536.1"> clause to filter down a query’s set </span><span class="No-Break"><span class="koboSpan" id="kobo.537.1">of results.</span></span></p>
<p><span class="koboSpan" id="kobo.538.1">The SQL Injection vulnerability comes into play when a page or parameter, such as the Juice Shop login page, connects to a backend database. </span><span class="koboSpan" id="kobo.538.2">As such, for the query added, in the statement ' OR </span><strong class="source-inline"><span class="koboSpan" id="kobo.539.1">1=1 --</span></strong><span class="koboSpan" id="kobo.540.1">, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.541.1">1=1</span></strong><span class="koboSpan" id="kobo.542.1"> condition is always a True query statement. </span><span class="koboSpan" id="kobo.542.2">When interpreted by the database, along with the OR statement added onto the username for the database to attempt to match any records of said username. </span><span class="koboSpan" id="kobo.542.3">The statement is also telling the database, if no match, to make the query true. </span><span class="koboSpan" id="kobo.542.4">A true statement will be the expected database input, even if the attacker does not have the correct username, which results in a successful login. </span><span class="koboSpan" id="kobo.542.5">On the backend, in the database, the SQL query would look </span><span class="No-Break"><span class="koboSpan" id="kobo.543.1">like this:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.544.1">
admin' - SELECT * FROM users WHERE useranme = '' OR 1=1 --' AND password = 'anything';</span></pre>
<p><span class="koboSpan" id="kobo.545.1">Then, followed by the </span><strong class="source-inline"><span class="koboSpan" id="kobo.546.1">"--"</span></strong><span class="koboSpan" id="kobo.547.1"> comment, it ignores any further query statements after the </span><strong class="source-inline"><span class="koboSpan" id="kobo.548.1">True</span></strong><span class="koboSpan" id="kobo.549.1"> statement. </span><span class="koboSpan" id="kobo.549.2">Thus, an attacker would never need to know the real password. </span><span class="koboSpan" id="kobo.549.3">The attacker inputs a single quote to close out the original query statement on the backend that’s looking for the input of the username. </span><span class="koboSpan" id="kobo.549.4">Then, the database server goes on to read the rest of the Boolean statement. </span><span class="koboSpan" id="kobo.549.5">In this simple scenario, the attacker will successfully bypass </span><span class="No-Break"><span class="koboSpan" id="kobo.550.1">the authentication.</span></span></p>
<p><span class="koboSpan" id="kobo.551.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.552.1">' OR 1=1 --</span></strong><span class="koboSpan" id="kobo.553.1"> query is one of the most common queries </span><a id="_idIndexMarker330"/><span class="koboSpan" id="kobo.554.1">and statements used when initially testing potential vulnerabilities. </span><span class="koboSpan" id="kobo.554.2">In addition, adding </span><strong class="source-inline"><span class="koboSpan" id="kobo.555.1">' -- </span></strong><span class="koboSpan" id="kobo.556.1">will work in simple cases as it will also result in a </span><strong class="source-inline"><span class="koboSpan" id="kobo.557.1">True</span></strong><span class="koboSpan" id="kobo.558.1"> statement, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.559.1">--</span></strong><span class="koboSpan" id="kobo.560.1"> will comment out the rest of the query statement that requires </span><span class="No-Break"><span class="koboSpan" id="kobo.561.1">the password.</span></span></p>
<h2 id="_idParaDest-200"><a id="_idTextAnchor260"/><span class="koboSpan" id="kobo.562.1">There’s more…</span></h2>
<p><span class="koboSpan" id="kobo.563.1">To exploit SQL vulnerabilities, it will be very helpful to become familiar with databases and how to write database queries. </span><span class="koboSpan" id="kobo.563.2">All SQL servers have slightly different syntaxes. </span><span class="koboSpan" id="kobo.563.3">However, if you learn one, you will understand the underlying structure of all of them. </span><span class="koboSpan" id="kobo.563.4">Some of the most common SQL servers are MySQL Microsoft SQL Server, MySQL, PostgreSQL, and Oracle. </span><span class="koboSpan" id="kobo.563.5">While the injection attack used in this recipe is SQLite, other common bypass techniques are </span><span class="No-Break"><span class="koboSpan" id="kobo.564.1">as such:</span></span></p>
<ul>
<li><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.565.1">admin' -</span></strong></span></li>
<li><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.566.1">admin' #</span></strong></span></li>
<li><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.567.1">admin'/*</span></strong></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.568.1">' </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.569.1">or 1=1--+</span></strong></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.570.1">' </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.571.1">or 1=1#</span></strong></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.572.1">' </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.573.1">or 1=1/*</span></strong></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.574.1">') </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.575.1">or '1'='1–</span></strong></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.576.1">') </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.577.1">or ('1'='1–-</span></strong></span></li>
</ul>
<p><span class="koboSpan" id="kobo.578.1">In addition to common SQL databases, </span><strong class="bold"><span class="koboSpan" id="kobo.579.1">Lightweight Directory Access Protocol</span></strong><span class="koboSpan" id="kobo.580.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.581.1">LDAP</span></strong><span class="koboSpan" id="kobo.582.1">) is attacked in the same manner</span><a id="_idIndexMarker331"/><span class="koboSpan" id="kobo.583.1"> as showcased in this recipe. </span><span class="koboSpan" id="kobo.583.2">LDAP is a directory service based on a client-server model, which functions similarly to a database but contains attribute-based data. </span><span class="koboSpan" id="kobo.583.3">A bypass technique can be used for LDAP Injection in a similar way to </span><span class="No-Break"><span class="koboSpan" id="kobo.584.1">SQL Injection:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.585.1">
user=*)(uid=*))(|(uid=*
pass=password</span></pre>
<h2 id="_idParaDest-201"><a id="_idTextAnchor261"/><span class="koboSpan" id="kobo.586.1">See also</span></h2>
<p><span class="koboSpan" id="kobo.587.1">There are many tools that specialize in finding and exploiting SQL Injection vulnerabilities. </span><span class="koboSpan" id="kobo.587.2">One notable tool (and my personal favorite) is SQLMap. </span><span class="koboSpan" id="kobo.587.3">SQLMap</span><a id="_idIndexMarker332"/><span class="koboSpan" id="kobo.588.1"> allows you to fingerprint </span><strong class="bold"><span class="koboSpan" id="kobo.589.1">database management systems</span></strong><span class="koboSpan" id="kobo.590.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.591.1">DBMS</span></strong><span class="koboSpan" id="kobo.592.1">), retrieve usernames and database tables or columns, and enumerate and exploit potentially existing SQL</span><a id="_idIndexMarker333"/><span class="koboSpan" id="kobo.593.1"> vulnerabilities. </span><span class="koboSpan" id="kobo.593.2">For more information about SQLMap, visit the Kali Linux website </span><span class="No-Break"><span class="koboSpan" id="kobo.594.1">at </span></span><span class="No-Break"><span class="koboSpan" id="kobo.595.1">www.kali.org/tools/sqlmap/</span></span><span class="No-Break"><span class="koboSpan" id="kobo.596.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.597.1">For more information</span><a id="_idIndexMarker334"/><span class="koboSpan" id="kobo.598.1"> on LDAP Injection attacks, </span><span class="No-Break"><span class="koboSpan" id="kobo.599.1">visit </span></span><a href="https://owasp.org/www-project-web-security-testing-guide/v41/4-Web_Application_Security_Testing/07-Input_Validation_Testing/06-Testing_for_LDAP_Injection"><span class="No-Break"><span class="koboSpan" id="kobo.600.1">https://owasp.org/www-project-web-security-testing-guide/v41/4-Web_Application_Security_Testing/07-Input_Validation_Testing/06-Testing_for_LDAP_Injection</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.601.1">.</span></span></p>
</div>
</body></html>