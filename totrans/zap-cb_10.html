<html><head></head><body>
<div id="_idContainer268">
<h1 class="chapter-number" id="_idParaDest-284"><a id="_idTextAnchor362"/><span class="koboSpan" id="kobo.1.1">10</span></h1>
<h1 id="_idParaDest-285"><a id="_idTextAnchor363"/><span class="koboSpan" id="kobo.2.1">Advanced Attack Techniques</span></h1>
<p><span class="koboSpan" id="kobo.3.1">Welcome to </span><a href="B18829_10.xhtml#_idTextAnchor362"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.4.1">Chapter 10</span></em></span></a><span class="koboSpan" id="kobo.5.1">, </span><em class="italic"><span class="koboSpan" id="kobo.6.1">Advanced Attack Techniques</span></em><span class="koboSpan" id="kobo.7.1">. </span><span class="koboSpan" id="kobo.7.2">In this chapter, we will cover some advanced attacks, such as </span><strong class="bold"><span class="koboSpan" id="kobo.8.1">XML external entity</span></strong><span class="koboSpan" id="kobo.9.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.10.1">XXE</span></strong><span class="koboSpan" id="kobo.11.1">) attacks and Java deserialization, where we will explain and demonstrate exploiting these vulnerabilities on the testing applications. </span><span class="koboSpan" id="kobo.11.2">We will also have fun brute-forcing the password change on one of the applications, conducting web cache poisoning, and working with JSON </span><span class="No-Break"><span class="koboSpan" id="kobo.12.1">Web Tokens.</span></span></p>
<p><a id="_idTextAnchor364"/><span class="koboSpan" id="kobo.13.1">In this chapter, we will cover the </span><span class="No-Break"><span class="koboSpan" id="kobo.14.1">following recipes:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.15.1">Performing </span><span class="No-Break"><span class="koboSpan" id="kobo.16.1">XXE attacks</span></span></li>
<li><span class="koboSpan" id="kobo.17.1">Working with JSON </span><span class="No-Break"><span class="koboSpan" id="kobo.18.1">Web Tokens</span></span></li>
<li><span class="koboSpan" id="kobo.19.1">Performing Java </span><span class="No-Break"><span class="koboSpan" id="kobo.20.1">deserialization attacks</span></span></li>
<li><span class="koboSpan" id="kobo.21.1">Password brute-force via </span><span class="No-Break"><span class="koboSpan" id="kobo.22.1">password change</span></span></li>
<li><span class="koboSpan" id="kobo.23.1">Web </span><span class="No-Break"><span class="koboSpan" id="kobo.24.1">cache poisoning</span></span></li>
</ul>
<h1 id="_idParaDest-286"><a id="_idTextAnchor365"/><span class="koboSpan" id="kobo.25.1">Technical requirements</span></h1>
<p><span class="koboSpan" id="kobo.26.1">For this chapter, you need to utilize a common browser such as Mozilla Firefox. </span><span class="koboSpan" id="kobo.26.2">You will also utilize your PortSwigger account for access to the PortSwigger Academy labs that will be used in this </span><span class="No-Break"><span class="koboSpan" id="kobo.27.1">chapter’s recipes.</span></span></p>
<h1 id="_idParaDest-287"><a id="_idTextAnchor366"/><span class="koboSpan" id="kobo.28.1">Performing XXE attacks</span></h1>
<p><span class="koboSpan" id="kobo.29.1">In an XXE attack, the</span><a id="_idIndexMarker463"/><span class="koboSpan" id="kobo.30.1"> attacker sends XML input that includes a reference to an external entity to an application. </span><span class="koboSpan" id="kobo.30.2">The XML input causes the application to behave in a manner that it was not intended to. </span><span class="koboSpan" id="kobo.30.3">Successful exploitation of an XXE attack can lead to an attacker viewing the content of files, exfiltrating data, </span><strong class="bold"><span class="koboSpan" id="kobo.31.1">server-side request forgery</span></strong><span class="koboSpan" id="kobo.32.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.33.1">SSRF</span></strong><span class="koboSpan" id="kobo.34.1">), and</span><a id="_idIndexMarker464"/><span class="koboSpan" id="kobo.35.1"> remote </span><span class="No-Break"><span class="koboSpan" id="kobo.36.1">code executions.</span></span></p>
<h2 id="_idParaDest-288"><a id="_idTextAnchor367"/><span class="koboSpan" id="kobo.37.1">Getting ready</span></h2>
<p><span class="koboSpan" id="kobo.38.1">This lab requires a PortSwigger Academy account and ZAP to be able to intercept requests and responses from the server to </span><span class="No-Break"><span class="koboSpan" id="kobo.39.1">your browser.</span></span></p>
<h2 id="_idParaDest-289"><a id="_idTextAnchor368"/><span class="koboSpan" id="kobo.40.1">How to do it...</span></h2>
<p><span class="koboSpan" id="kobo.41.1">In this lab, we will walk through performing an XXE attack to retrieve the contents of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.42.1">passwd</span></strong><span class="koboSpan" id="kobo.43.1"> file. </span><span class="koboSpan" id="kobo.43.2">Please follow </span><span class="No-Break"><span class="koboSpan" id="kobo.44.1">these instructions:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.45.1">Navigate to the URL with the browser proxied to ZAP and log into the PortSwigger Academy </span><a id="_idIndexMarker465"/><span class="koboSpan" id="kobo.46.1">website to launch the lab. </span><span class="koboSpan" id="kobo.46.2">The lab we will work on in this section is </span><em class="italic"><span class="koboSpan" id="kobo.47.1">Exploiting XXE Using External Entities to Retrieve Files</span></em><span class="koboSpan" id="kobo.48.1">. </span><span class="koboSpan" id="kobo.48.2">The link to the lab is accessed </span><span class="No-Break"><span class="koboSpan" id="kobo.49.1">here: </span></span><a href="https://portswigger.net/web-security/xxe/lab-exploiting-xxe-to-retrieve-files"><span class="No-Break"><span class="koboSpan" id="kobo.50.1">https://portswigger.net/web-security/xxe/lab-exploiting-xxe-to-retrieve-files</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.51.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.52.1">Start the lab, add it to the context, and click on </span><strong class="bold"><span class="koboSpan" id="kobo.53.1">Show only URLs </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.54.1">in Scope</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.55.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.56.1">On the lab home page, click on </span><strong class="bold"><span class="koboSpan" id="kobo.57.1">View details</span></strong><span class="koboSpan" id="kobo.58.1"> under any product. </span><span class="koboSpan" id="kobo.58.2">Then click on </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.59.1">Check stock</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.60.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.61.1">Clicking on </span><strong class="bold"><span class="koboSpan" id="kobo.62.1">Check stock</span></strong><span class="koboSpan" id="kobo.63.1"> sends a </span><strong class="source-inline"><span class="koboSpan" id="kobo.64.1">POST</span></strong><span class="koboSpan" id="kobo.65.1"> request to the application. </span><span class="koboSpan" id="kobo.65.2">Let’s find the </span><strong class="source-inline"><span class="koboSpan" id="kobo.66.1">POST</span></strong><span class="koboSpan" id="kobo.67.1"> request. </span><span class="koboSpan" id="kobo.67.2">Right-click the request and select </span><strong class="bold"><span class="koboSpan" id="kobo.68.1">Open/Resend with </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.69.1">Request Editor</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.70.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.71.1">Once the </span><strong class="bold"><span class="koboSpan" id="kobo.72.1">Request Editor</span></strong><span class="koboSpan" id="kobo.73.1"> window opens, add the following payload after the XML declaration and replace the product ID with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.74.1">xxe</span></strong><span class="koboSpan" id="kobo.75.1"> external entity reference, as shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.76.1">Figure 10</span></em></span><em class="italic"><span class="koboSpan" id="kobo.77.1">.1</span></em><span class="koboSpan" id="kobo.78.1">. </span><span class="koboSpan" id="kobo.78.2">Then, </span><span class="No-Break"><span class="koboSpan" id="kobo.79.1">click </span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.80.1">Send</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.81.1">:</span></span><pre class="console"><span class="koboSpan" id="kobo.82.1">
&lt;!DOCTYPE test [ &lt;!ENTITY xxe SYSTEM "file:///etc/passwd"&gt; ]&gt;</span></pre></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer248">
<span class="koboSpan" id="kobo.83.1"><img alt="Figure 10.1 – XXE attack" src="image/Figure_10.1_B18829.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.84.1">Figure 10.1 – XXE attack</span></p>
<ol>
<li value="6"><span class="koboSpan" id="kobo.85.1">As you can see in the </span><strong class="bold"><span class="koboSpan" id="kobo.86.1">Response</span></strong><span class="koboSpan" id="kobo.87.1"> tab, the content of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.88.1">passwd</span></strong><span class="koboSpan" id="kobo.89.1"> file is listed in the returned response, as shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.90.1">Figure 10</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.91.1">.2</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.92.1">:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer249">
<span class="koboSpan" id="kobo.93.1"><img alt="Figure 10.2 – The passwd file" src="image/Figure_10.2_B18829.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.94.1">Figure 10.2 – The passwd file</span></p>
<p><span class="koboSpan" id="kobo.95.1">This concludes </span><span class="No-Break"><span class="koboSpan" id="kobo.96.1">this lab.</span></span></p>
<h2 id="_idParaDest-290"><a id="_idTextAnchor369"/><span class="koboSpan" id="kobo.97.1">How it works...</span></h2>
<p><span class="koboSpan" id="kobo.98.1">An XXE attack is a</span><a id="_idIndexMarker466"/><span class="koboSpan" id="kobo.99.1"> type of vulnerability that can be found in applications that process XML input. </span><span class="koboSpan" id="kobo.99.2">This type of attack occurs when an attacker is able to inject malicious external entities into an XML document, which can then be used to compromise the security of the application or the </span><span class="No-Break"><span class="koboSpan" id="kobo.100.1">underlying system.</span></span></p>
<p><span class="koboSpan" id="kobo.101.1">In an XXE attack, the attacker first creates an XML document containing a reference to an external entity, typically a remote file or resource. </span><span class="koboSpan" id="kobo.101.2">The attacker then submits this malicious XML document to the vulnerable application, which attempts to process it and access the external entity. </span><span class="koboSpan" id="kobo.101.3">This can cause the application to either crash or disclose sensitive information, such as internal network addresses or </span><span class="No-Break"><span class="koboSpan" id="kobo.102.1">system files.</span></span></p>
<p><span class="koboSpan" id="kobo.103.1">In this recipe, we viewed the content of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.104.1">/etc/passwd</span></strong><span class="koboSpan" id="kobo.105.1"> file by performing an XXE injection attack. </span><span class="koboSpan" id="kobo.105.2">And to perform the XXE injection attack, we changed the XML input by adding the </span><strong class="source-inline"><span class="koboSpan" id="kobo.106.1">DOCTYPE</span></strong><span class="koboSpan" id="kobo.107.1"> element to add the external entity that includes the </span><strong class="source-inline"><span class="koboSpan" id="kobo.108.1">passwd</span></strong><span class="koboSpan" id="kobo.109.1"> file path. </span><span class="koboSpan" id="kobo.109.2">Then the external entity was used in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.110.1">productId</span></strong><span class="koboSpan" id="kobo.111.1"> value, which caused the application to return the </span><strong class="source-inline"><span class="koboSpan" id="kobo.112.1">passwd</span></strong><span class="koboSpan" id="kobo.113.1"> file</span><a id="_idIndexMarker467"/><span class="koboSpan" id="kobo.114.1"> content in the response, which enabled us to gather more information about the accounts in </span><span class="No-Break"><span class="koboSpan" id="kobo.115.1">the syste</span><a id="_idTextAnchor370"/><span class="koboSpan" id="kobo.116.1">m.</span></span></p>
<h1 id="_idParaDest-291"><a id="_idTextAnchor371"/><span class="koboSpan" id="kobo.117.1">Working with JSON Web Tokens</span></h1>
<p><strong class="bold"><span class="koboSpan" id="kobo.118.1">JSON Web Tokens</span></strong><span class="koboSpan" id="kobo.119.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.120.1">JWTs</span></strong><span class="koboSpan" id="kobo.121.1">) are</span><a id="_idIndexMarker468"/><span class="koboSpan" id="kobo.122.1"> used for authentication, session handling, and authorization of data between systems. </span><span class="koboSpan" id="kobo.122.2">JWT vulnerabilities are usually design flaws, misconfigurations, or the use of insecure libraries. </span><span class="koboSpan" id="kobo.122.3">When testing for JWT flaws, the tester attempts to bypass the signature verification process, which bypasses the authentication or authorization mechanism. </span><span class="koboSpan" id="kobo.122.4">The information sent in the JWTs are called claims and are cryptographically signed JSON objects. </span><span class="koboSpan" id="kobo.122.5">Each JWT is made out of three sections; the first is a header, the second is the payload, and the third is a signature. </span><span class="koboSpan" id="kobo.122.6">Each section is divided by a </span><strong class="source-inline"><span class="koboSpan" id="kobo.123.1">.</span></strong><span class="koboSpan" id="kobo.124.1"> (dot) and encoded using </span><strong class="source-inline"><span class="koboSpan" id="kobo.125.1">base64</span></strong><span class="koboSpan" id="kobo.126.1"> encoding. </span><span class="koboSpan" id="kobo.126.2">The header contains information about the token, the payload section includes the claims, and the signature is usually a hashed value of the header and the payload section combined and used for </span><span class="No-Break"><span class="koboSpan" id="kobo.127.1">integrity checks.</span></span></p>
<p><span class="koboSpan" id="kobo.128.1">In this recipe, you will attack a misconfigured server that issues JWTs to accept unsigned tokens. </span><span class="koboSpan" id="kobo.128.2">To finish the lab, we will walk you through deactivating the user – Carlos – and change the session token so that you can access the </span><span class="No-Break"><span class="koboSpan" id="kobo.129.1">admin panel.</span></span></p>
<h2 id="_idParaDest-292"><a id="_idTextAnchor372"/><span class="koboSpan" id="kobo.130.1">Getting ready</span></h2>
<p><span class="koboSpan" id="kobo.131.1">This lab requires a PortSwigger Academy account, a </span><strong class="source-inline"><span class="koboSpan" id="kobo.132.1">Base64</span></strong><span class="koboSpan" id="kobo.133.1"> encoder/decoder, and ZAP should be able to intercept requests and responses from the server to </span><span class="No-Break"><span class="koboSpan" id="kobo.134.1">your browser.</span></span></p>
<h2 id="_idParaDest-293"><a id="_idTextAnchor373"/><span class="koboSpan" id="kobo.135.1">How to do it...</span></h2>
<p><span class="koboSpan" id="kobo.136.1">In this section, we will complete the PortSwigger Academy’s </span><em class="italic"><span class="koboSpan" id="kobo.137.1">JWT authentication bypass via flawed signature verification</span></em><span class="koboSpan" id="kobo.138.1"> lab to demonstrate how to change the values in the JWT payload to log in as the administrator and delete a user account. </span><span class="koboSpan" id="kobo.138.2">Take the following steps to start </span><span class="No-Break"><span class="koboSpan" id="kobo.139.1">the lab:</span></span></p>
<ol>
<li value="1"><span class="koboSpan" id="kobo.140.1">Navigate to the URL with the browser proxied to ZAP and log into the PortSwigger Academy website to launch the </span><em class="italic"><span class="koboSpan" id="kobo.141.1">JWT authentication bypass via flawed signature verification</span></em> <span class="No-Break"><span class="koboSpan" id="kobo.142.1">lab (</span></span><a href="https://portswigger.net/web-security/jwt/lab-jwt-authentication-bypass-via-flawed-signature-verification"><span class="No-Break"><span class="koboSpan" id="kobo.143.1">https://portswigger.net/web-security/jwt/lab-jwt-authentication-bypass-via-flawed-signature-verification</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.144.1">).</span></span></li>
<li><span class="koboSpan" id="kobo.145.1">Once you access the lab, click on </span><strong class="bold"><span class="koboSpan" id="kobo.146.1">My account</span></strong><span class="koboSpan" id="kobo.147.1"> and log in with the credentials provided in the </span><span class="No-Break"><span class="koboSpan" id="kobo.148.1">lab description.</span></span></li>
<li><span class="koboSpan" id="kobo.149.1">Open ZAP and find the </span><strong class="source-inline"><span class="koboSpan" id="kobo.150.1">GET</span></strong><span class="koboSpan" id="kobo.151.1"> request to </span><strong class="source-inline"><span class="koboSpan" id="kobo.152.1">/my-account page</span></strong><span class="koboSpan" id="kobo.153.1">. </span><span class="koboSpan" id="kobo.153.2">Right-click the request and select </span><strong class="bold"><span class="koboSpan" id="kobo.154.1">Open/Resend with </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.155.1">Request Editor…</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.156.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.157.1">You can see in the request that the cookie session is a JWT, as it is separated by a dot. </span><span class="koboSpan" id="kobo.157.2">The goal in this lab</span><a id="_idIndexMarker469"/><span class="koboSpan" id="kobo.158.1"> is to access the admin portal by manipulating the JWT cookie. </span><span class="koboSpan" id="kobo.158.2">We will need a </span><strong class="source-inline"><span class="koboSpan" id="kobo.159.1">Base64</span></strong><span class="koboSpan" id="kobo.160.1"> encoder/decoder; in this lab, I am using CyberChef (</span><a href="https://gchq.github.io/CyberChef"><span class="koboSpan" id="kobo.161.1">https://gchq.github.io/CyberChef</span></a><span class="koboSpan" id="kobo.162.1">). </span><span class="koboSpan" id="kobo.162.2">Copy the header from the token, which is the first part before the dot and after </span><strong class="source-inline"><span class="koboSpan" id="kobo.163.1">session=</span></strong><span class="koboSpan" id="kobo.164.1">. </span><span class="koboSpan" id="kobo.164.2">Open your favorite Base64 decoder and encode the header. </span><span class="koboSpan" id="kobo.164.3">Change the </span><strong class="source-inline"><span class="koboSpan" id="kobo.165.1">alg</span></strong><span class="koboSpan" id="kobo.166.1"> value from </span><strong class="source-inline"><span class="koboSpan" id="kobo.167.1">RS256</span></strong><span class="koboSpan" id="kobo.168.1"> to </span><strong class="source-inline"><span class="koboSpan" id="kobo.169.1">none</span></strong><span class="koboSpan" id="kobo.170.1"> and encode it again, as seen in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.171.1">Figure 10</span></em></span><em class="italic"><span class="koboSpan" id="kobo.172.1">.3</span></em><span class="koboSpan" id="kobo.173.1">. </span><span class="koboSpan" id="kobo.173.2">Copy the encoded value and save it so we can use it later in </span><span class="No-Break"><span class="koboSpan" id="kobo.174.1">the lab:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer250">
<span class="koboSpan" id="kobo.175.1"><img alt="Figure 10.3 – The none algorithm" src="image/Figure_10.3_B18829.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.176.1">Figure 10.3 – The none algorithm</span></p>
<ol>
<li value="5"><span class="koboSpan" id="kobo.177.1">Now, copy the payload</span><a id="_idIndexMarker470"/><span class="koboSpan" id="kobo.178.1"> from the JWT; it is the second part located between two dots in the token. </span><span class="koboSpan" id="kobo.178.2">Decode it in a Base64 decoder, and change the </span><strong class="source-inline"><span class="koboSpan" id="kobo.179.1">sub</span></strong><span class="koboSpan" id="kobo.180.1"> value from the username you used to </span><strong class="source-inline"><span class="koboSpan" id="kobo.181.1">administrator</span></strong><span class="koboSpan" id="kobo.182.1">, as seen in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.183.1">Figure 10</span></em></span><em class="italic"><span class="koboSpan" id="kobo.184.1">.4</span></em><span class="koboSpan" id="kobo.185.1">. </span><span class="koboSpan" id="kobo.185.2">Encode the payload and copy and save the encoded payload to be used in the </span><span class="No-Break"><span class="koboSpan" id="kobo.186.1">next step:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer251">
<span class="koboSpan" id="kobo.187.1"><img alt="Figure 10.4 – Changing the user account" src="image/Figure_10.4_B18829.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.188.1">Figure 10.4 – Changing the user account</span></p>
<ol>
<li value="6"><span class="koboSpan" id="kobo.189.1">In the </span><strong class="bold"><span class="koboSpan" id="kobo.190.1">Request Editor</span></strong><span class="koboSpan" id="kobo.191.1"> in ZAP, change </span><strong class="source-inline"><span class="koboSpan" id="kobo.192.1">/my-account</span></strong><span class="koboSpan" id="kobo.193.1"> to </span><strong class="source-inline"><span class="koboSpan" id="kobo.194.1">/admin</span></strong><span class="koboSpan" id="kobo.195.1">. </span><span class="koboSpan" id="kobo.195.2">Delete everything after </span><strong class="source-inline"><span class="koboSpan" id="kobo.196.1">session=</span></strong><span class="koboSpan" id="kobo.197.1">, and</span><a id="_idIndexMarker471"/><span class="koboSpan" id="kobo.198.1"> add the encoded header value we created earlier. </span><span class="koboSpan" id="kobo.198.2">Add a dot, then add the encoded payload value we created earlier. </span><span class="koboSpan" id="kobo.198.3">Add a dot after the payload. </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.199.1">Figure 10</span></em></span><em class="italic"><span class="koboSpan" id="kobo.200.1">.5</span></em><span class="koboSpan" id="kobo.201.1"> shows the </span><span class="No-Break"><span class="koboSpan" id="kobo.202.1">values added:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer252">
<span class="koboSpan" id="kobo.203.1"><img alt="Figure 10.5 – Session cookie" src="image/Figure_10.5_B18829.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.204.1">Figure 10.5 – Session cookie</span></p>
<ol>
<li value="7"><span class="koboSpan" id="kobo.205.1">Click on </span><strong class="bold"><span class="koboSpan" id="kobo.206.1">Send</span></strong><span class="koboSpan" id="kobo.207.1">; as you can see in the </span><strong class="bold"><span class="koboSpan" id="kobo.208.1">Response</span></strong><span class="koboSpan" id="kobo.209.1"> tab, the application responded with the Admin </span><a id="_idIndexMarker472"/><span class="No-Break"><span class="koboSpan" id="kobo.210.1">Panel code.</span></span></li>
<li><span class="koboSpan" id="kobo.211.1">Open your browser, and go to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.212.1">/admin</span></strong><span class="koboSpan" id="kobo.213.1"> page, as you can see, you can’t view the Admin page. </span><span class="koboSpan" id="kobo.213.2">To view the Admin page, we will have to change the cookie value. </span><span class="koboSpan" id="kobo.213.3">I am using Chrome to change the cookie value. </span><span class="koboSpan" id="kobo.213.4">I have to open </span><strong class="bold"><span class="koboSpan" id="kobo.214.1">Developer Tools</span></strong><span class="koboSpan" id="kobo.215.1">, navigate to the </span><strong class="bold"><span class="koboSpan" id="kobo.216.1">Application</span></strong><span class="koboSpan" id="kobo.217.1"> tab, and find the cookie under </span><strong class="bold"><span class="koboSpan" id="kobo.218.1">Cookies</span></strong><span class="koboSpan" id="kobo.219.1">. </span><span class="koboSpan" id="kobo.219.2">In the </span><strong class="bold"><span class="koboSpan" id="kobo.220.1">Value</span></strong><span class="koboSpan" id="kobo.221.1"> column, I double-clicked the value and pasted the JWT </span><span class="No-Break"><span class="koboSpan" id="kobo.222.1">we created.</span></span></li>
<li><span class="koboSpan" id="kobo.223.1">After adding the JWT we created, refresh the page. </span><span class="koboSpan" id="kobo.223.2">As you can see, we can view the admin page, as shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.224.1">Figure 10</span></em></span><em class="italic"><span class="koboSpan" id="kobo.225.1">.6</span></em><span class="koboSpan" id="kobo.226.1">. </span><span class="koboSpan" id="kobo.226.2">Let’s delete the </span><span class="No-Break"><span class="koboSpan" id="kobo.227.1">user </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.228.1">carlos</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.229.1">.</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer253">
<span class="koboSpan" id="kobo.230.1"><img alt="Figure 10.6 – The Users page" src="image/Figure_10.6_B18829.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.231.1">Figure 10.6 – The Users page</span></p>
<p><span class="koboSpan" id="kobo.232.1">This concludes the lab for this recipe. </span><span class="koboSpan" id="kobo.232.2">We have bypassed the authentication and authorization mechanism to view the </span><span class="No-Break"><span class="koboSpan" id="kobo.233.1">admin page.</span></span></p>
<h2 id="_idParaDest-294"><a id="_idTextAnchor374"/><span class="koboSpan" id="kobo.234.1">How it works...</span></h2>
<p><span class="koboSpan" id="kobo.235.1">In this lab, we decoded the header of the token and changed the value of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.236.1">alg</span></strong><span class="koboSpan" id="kobo.237.1"> attribute to </span><strong class="source-inline"><span class="koboSpan" id="kobo.238.1">none</span></strong><span class="koboSpan" id="kobo.239.1">. </span><span class="koboSpan" id="kobo.239.2">By changing the </span><strong class="source-inline"><span class="koboSpan" id="kobo.240.1">alg</span></strong><span class="koboSpan" id="kobo.241.1"> attribute to </span><strong class="source-inline"><span class="koboSpan" id="kobo.242.1">none</span></strong><span class="koboSpan" id="kobo.243.1">, we can bypass the verification of the signature in the token. </span><span class="koboSpan" id="kobo.243.2">Then, we decoded the payload and changed the value of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.244.1">sub</span></strong><span class="koboSpan" id="kobo.245.1"> attribute to </span><strong class="source-inline"><span class="koboSpan" id="kobo.246.1">administrator</span></strong><span class="koboSpan" id="kobo.247.1"> to be able to use the administrator account. </span><span class="koboSpan" id="kobo.247.2">After that, we encoded the header and the payload and used them as our session cookie value. </span><span class="koboSpan" id="kobo.247.3">By</span><a id="_idIndexMarker473"/><span class="koboSpan" id="kobo.248.1"> doing that, we were able to bypass the authentication and authorization mechanism of </span><span class="No-Break"><span class="koboSpan" id="kobo.249.1">the website.</span></span></p>
<h2 id="_idParaDest-295"><a id="_idTextAnchor375"/><span class="koboSpan" id="kobo.250.1">There’s more...</span></h2>
<p><span class="koboSpan" id="kobo.251.1">Using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.252.1">none</span></strong><span class="koboSpan" id="kobo.253.1"> value for the </span><strong class="source-inline"><span class="koboSpan" id="kobo.254.1">alg</span></strong><span class="koboSpan" id="kobo.255.1"> attribute is not the only way to make the application server accept the JWT you create. </span><span class="koboSpan" id="kobo.255.2">Another method to bypass authentication and authorization is to find or brute force the secret key. </span><strong class="source-inline"><span class="koboSpan" id="kobo.256.1">HS256</span></strong><span class="koboSpan" id="kobo.257.1"> is another </span><strong class="source-inline"><span class="koboSpan" id="kobo.258.1">alg</span></strong><span class="koboSpan" id="kobo.259.1"> value that uses a secret key. </span><span class="koboSpan" id="kobo.259.2">If an attacker finds the secret key, they could sign any JWT they create and pass it to the server. </span><span class="koboSpan" id="kobo.259.3">Tools such as Hashcat can brute force the secret key using </span><span class="No-Break"><span class="koboSpan" id="kobo.260.1">a wordl</span><a id="_idTextAnchor376"/><span class="koboSpan" id="kobo.261.1">ist.</span></span></p>
<h1 id="_idParaDest-296"><a id="_idTextAnchor377"/><span class="koboSpan" id="kobo.262.1">Performing Java deserialization attacks</span></h1>
<p><span class="koboSpan" id="kobo.263.1">Java employs a process</span><a id="_idIndexMarker474"/><span class="koboSpan" id="kobo.264.1"> called </span><strong class="bold"><span class="koboSpan" id="kobo.265.1">serialization</span></strong><span class="koboSpan" id="kobo.266.1"> that </span><a id="_idIndexMarker475"/><span class="koboSpan" id="kobo.267.1">turns an object into a byte stream. </span><span class="koboSpan" id="kobo.267.2">On the flip side, </span><strong class="bold"><span class="koboSpan" id="kobo.268.1">deserialization</span></strong><span class="koboSpan" id="kobo.269.1"> is the process of returning a serialized stream of bytes to</span><a id="_idIndexMarker476"/><span class="koboSpan" id="kobo.270.1"> an object in the machine’s memory. </span><span class="koboSpan" id="kobo.270.2">In this type of attack, the attacker introduces malicious data into the application code by modifying serialized objects. </span><span class="koboSpan" id="kobo.270.3">This attack is only possible if the website deserializes data provided by the user. </span><span class="koboSpan" id="kobo.270.4">If user-provided data or any data from sources you don’t trust must be deserialized, checks and safeguards must be implemented to prevent the untrusted sources from altering the data. </span><span class="koboSpan" id="kobo.270.5">Checks and safeguards must be done before the start of the deserialization process; otherwise, it will not be effective. </span><span class="koboSpan" id="kobo.270.6">Due to the difficulties in preventing deserialization attacks, data deserialization should only be used if it can’t </span><span class="No-Break"><span class="koboSpan" id="kobo.271.1">be avoided.</span></span></p>
<p><span class="koboSpan" id="kobo.272.1">Within this recipe, you will attack a susceptible serialization-based session mechanism that’s vulnerable to privilege escalation. </span><span class="koboSpan" id="kobo.272.2">To conduct this attack, you will edit the serialized object in the session cookie to take advantage of this flaw and gain administrator rights to remove </span><span class="No-Break"><span class="koboSpan" id="kobo.273.1">Carlos’ account.</span></span></p>
<h2 id="_idParaDest-297"><a id="_idTextAnchor378"/><span class="koboSpan" id="kobo.274.1">Getting ready</span></h2>
<p><span class="koboSpan" id="kobo.275.1">This lab requires a PortSwigger Academy account and ZAP to intercept requests and responses from the server to </span><span class="No-Break"><span class="koboSpan" id="kobo.276.1">your browser.</span></span></p>
<h2 id="_idParaDest-298"><a id="_idTextAnchor379"/><span class="koboSpan" id="kobo.277.1">How to do it...</span></h2>
<p><span class="koboSpan" id="kobo.278.1">The following steps walk</span><a id="_idIndexMarker477"/><span class="koboSpan" id="kobo.279.1"> you through solving the PortSwigger Academy </span><em class="italic"><span class="koboSpan" id="kobo.280.1">Modifying serialized objects</span></em><span class="koboSpan" id="kobo.281.1"> lab. </span><span class="koboSpan" id="kobo.281.2">In this lab, you will modify the session cookie’s serialized object to escalate your account privileges and be able to delete a user account. </span><span class="koboSpan" id="kobo.281.3">Please follow </span><span class="No-Break"><span class="koboSpan" id="kobo.282.1">these instructions:</span></span></p>
<ol>
<li value="1"><span class="koboSpan" id="kobo.283.1">Navigate to the URL with the browser proxied to ZAP and log into the PortSwigger Academy website to launch the </span><span class="No-Break"><span class="koboSpan" id="kobo.284.1">lab (</span></span><a href="https://portswigger.net/web-security/deserialization/exploiting/lab-deserialization-modifying-serialized-objects"><span class="No-Break"><span class="koboSpan" id="kobo.285.1">https://portswigger.net/web-security/deserialization/exploiting/lab-deserialization-modifying-serialized-objects</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.286.1">).</span></span></li>
<li><span class="koboSpan" id="kobo.287.1">Open ZAP and go to </span><strong class="bold"><span class="koboSpan" id="kobo.288.1">Manual Explorer</span></strong><span class="koboSpan" id="kobo.289.1">. </span><span class="koboSpan" id="kobo.289.2">Enter the lab URL in the </span><span class="No-Break"><span class="koboSpan" id="kobo.290.1">Firefox launcher.</span></span></li>
<li><span class="koboSpan" id="kobo.291.1">Log in to the lab application using the credentials provided </span><span class="No-Break"><span class="koboSpan" id="kobo.292.1">by PortSwigger.</span></span></li>
<li><span class="koboSpan" id="kobo.293.1">Click the response after the login </span><strong class="source-inline"><span class="koboSpan" id="kobo.294.1">GET /my-account</span></strong><span class="koboSpan" id="kobo.295.1"> request, which contains a session cookie. </span><span class="koboSpan" id="kobo.295.2">This cookie appears to be URL </span><span class="No-Break"><span class="koboSpan" id="kobo.296.1">and Base64-encoded.</span></span></li>
<li><span class="koboSpan" id="kobo.297.1">To understand what data is in this string, send it over to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.298.1">Encode/Decode/Hash</span></strong><span class="koboSpan" id="kobo.299.1"> tool by right-clicking the selected cookie value. </span><span class="koboSpan" id="kobo.299.2">Click the </span><strong class="bold"><span class="koboSpan" id="kobo.300.1">Decode</span></strong><span class="koboSpan" id="kobo.301.1"> tab and look at the </span><strong class="bold"><span class="koboSpan" id="kobo.302.1">Base64 Decode</span></strong><span class="koboSpan" id="kobo.303.1"> row. </span><span class="koboSpan" id="kobo.303.2">You’ll see the </span><span class="No-Break"><span class="koboSpan" id="kobo.304.1">following values:</span></span><pre class="console"><span class="koboSpan" id="kobo.305.1">
O:4:"User":2:{s:8:"username";s:6:"wiener";s:5:"admin";b:0;}</span></pre></li>
<li><span class="koboSpan" id="kobo.306.1">The cookie is actually a serialized PHP object. </span><span class="koboSpan" id="kobo.306.2">String values are always contained within double quotes. </span><strong class="source-inline"><span class="koboSpan" id="kobo.307.1">s</span></strong><span class="koboSpan" id="kobo.308.1"> is the size of the object followed by the object name in double quotes. </span><span class="koboSpan" id="kobo.308.2">At the end of the code string, the admin attribute contains </span><strong class="source-inline"><span class="koboSpan" id="kobo.309.1">b:0</span></strong><span class="koboSpan" id="kobo.310.1">, indicating a Boolean value of </span><strong class="source-inline"><span class="koboSpan" id="kobo.311.1">false</span></strong><span class="koboSpan" id="kobo.312.1">. </span><span class="koboSpan" id="kobo.312.2">Open this request in </span><strong class="bold"><span class="koboSpan" id="kobo.313.1">Manual </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.314.1">Request Editor</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.315.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.316.1">In its decoded form, open CyberChef to change the value of </span><strong class="source-inline"><span class="koboSpan" id="kobo.317.1">b:0</span></strong><span class="koboSpan" id="kobo.318.1"> to </span><strong class="source-inline"><span class="koboSpan" id="kobo.319.1">b:1</span></strong><span class="koboSpan" id="kobo.320.1"> to equal </span><strong class="source-inline"><span class="koboSpan" id="kobo.321.1">true</span></strong><span class="koboSpan" id="kobo.322.1"> and re-encode in base64 as well as URL encoded </span><strong class="source-inline"><span class="koboSpan" id="kobo.323.1">=</span></strong><span class="koboSpan" id="kobo.324.1">. </span><span class="koboSpan" id="kobo.324.2">Insert this encoded string back </span><a id="_idIndexMarker478"/><span class="koboSpan" id="kobo.325.1">into the cookie and send the request. </span><span class="koboSpan" id="kobo.325.2">See </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.326.1">Figure 10</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.327.1">.7</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.328.1">:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer254">
<span class="koboSpan" id="kobo.329.1"><img alt="Figure 10.7 – CyberChef encoded session data" src="image/Figure_10.7_B18829.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.330.1">Figure 10.7 – CyberChef encoded session data</span></p>
<ol>
<li value="8"><span class="koboSpan" id="kobo.331.1">When you receive the response, scroll through the content of the HTML code, as shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.332.1">Figure 10</span></em></span><em class="italic"><span class="koboSpan" id="kobo.333.1">.8</span></em><span class="koboSpan" id="kobo.334.1">, to find a link that shows </span><strong class="source-inline"><span class="koboSpan" id="kobo.335.1">/admin</span></strong><span class="koboSpan" id="kobo.336.1">. </span><span class="koboSpan" id="kobo.336.2">This shows that you accessed a page with </span><span class="No-Break"><span class="koboSpan" id="kobo.337.1">admin privileges:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer255">
<span class="koboSpan" id="kobo.338.1"><img alt="Figure 10.8 – Response with the /admin path" src="image/Figure_10.8_B18829.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.339.1">Figure 10.8 – Response with the /admin path</span></p>
<ol>
<li value="9"><span class="koboSpan" id="kobo.340.1">In our next step, go back to the </span><strong class="bold"><span class="koboSpan" id="kobo.341.1">Request</span></strong><span class="koboSpan" id="kobo.342.1"> tab and update the </span><strong class="source-inline"><span class="koboSpan" id="kobo.343.1">GET</span></strong><span class="koboSpan" id="kobo.344.1"> request path to </span><strong class="source-inline"><span class="koboSpan" id="kobo.345.1">/admin,</span></strong><span class="koboSpan" id="kobo.346.1"> and hit </span><strong class="bold"><span class="koboSpan" id="kobo.347.1">Send</span></strong><span class="koboSpan" id="kobo.348.1"> again. </span><span class="koboSpan" id="kobo.348.2">You’ll receive a </span><strong class="source-inline"><span class="koboSpan" id="kobo.349.1">200</span></strong><span class="koboSpan" id="kobo.350.1"> HTTP status and then see a specific </span><strong class="source-inline"><span class="koboSpan" id="kobo.351.1">href</span></strong><span class="koboSpan" id="kobo.352.1"> to </span><a id="_idIndexMarker479"/><span class="koboSpan" id="kobo.353.1">delete </span><span class="No-Break"><span class="koboSpan" id="kobo.354.1">user accounts:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer256">
<span class="koboSpan" id="kobo.355.1"><img alt="Figure 10.9 – /admin response" src="image/Figure_10.9_B18829.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.356.1">Figure 10.9 – /admin response</span></p>
<ol>
<li value="10"><span class="koboSpan" id="kobo.357.1">Update the path to include </span><strong class="source-inline"><span class="koboSpan" id="kobo.358.1">/admin/delete?username=carlos</span></strong><span class="koboSpan" id="kobo.359.1"> and send the request once more to complete this recipe. </span><span class="koboSpan" id="kobo.359.2">You may need to refresh the browser page to see the completion status of </span><span class="No-Break"><span class="koboSpan" id="kobo.360.1">the lab.</span></span></li>
</ol>
<h2 id="_idParaDest-299"><a id="_idTextAnchor380"/><span class="koboSpan" id="kobo.361.1">How it works...</span></h2>
<p><span class="koboSpan" id="kobo.362.1">When using Java to build objects and these objects are no longer in use, they get saved in memory to be later deleted by the garbage collector. </span><span class="koboSpan" id="kobo.362.2">Java must convert these objects into a byte stream before transferring that data, storing it on a disk, or transmitting it over a network. </span><span class="koboSpan" id="kobo.362.3">The class of that object must implement the Serializable interface in order to do this. </span><span class="koboSpan" id="kobo.362.4">As was already said, serialization enables us to transform an object’s state into a stream of bytes. </span><span class="koboSpan" id="kobo.362.5">The actual code is not included in this </span><span class="No-Break"><span class="koboSpan" id="kobo.363.1">byte stream.</span></span></p>
<p><span class="koboSpan" id="kobo.364.1">A malicious user trying to introduce a changed serialized object into the system to compromise the system or its </span><a id="_idIndexMarker480"/><span class="koboSpan" id="kobo.365.1">data results in a Java </span><span class="No-Break"><span class="koboSpan" id="kobo.366.1">deserialization vulnerability.</span></span></p>
<h2 id="_idParaDest-300"><a id="_idTextAnchor381"/><span class="koboSpan" id="kobo.367.1">There’s more...</span></h2>
<p><span class="koboSpan" id="kobo.368.1">Java applications automatically manage their memory using a process known as </span><strong class="bold"><span class="koboSpan" id="kobo.369.1">garbage collection</span></strong><span class="koboSpan" id="kobo.370.1">. </span><span class="koboSpan" id="kobo.370.2">Java</span><a id="_idIndexMarker481"/><span class="koboSpan" id="kobo.371.1"> applications can be executed</span><a id="_idIndexMarker482"/><span class="koboSpan" id="kobo.372.1"> on a </span><strong class="bold"><span class="koboSpan" id="kobo.373.1">Java virtual machine</span></strong><span class="koboSpan" id="kobo.374.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.375.1">JVM</span></strong><span class="koboSpan" id="kobo.376.1">) by compiling to bytecode. </span><span class="koboSpan" id="kobo.376.2">Objects are produced on the heap, a section of memory reserved for the application when Java programs are launched on the JVM. </span><span class="koboSpan" id="kobo.376.3">Some objects will eventually become obsolete. </span><span class="koboSpan" id="kobo.376.4">To free up memory, the garbage collector discovers these useless objects and </span><span class="No-Break"><span class="koboSpan" id="kobo.377.1">deletes them.</span></span></p>
<p><span class="koboSpan" id="kobo.378.1">As for the Serializable interface, this is contained within the </span><strong class="source-inline"><span class="koboSpan" id="kobo.379.1">java.io</span></strong><span class="koboSpan" id="kobo.380.1"> package. </span><span class="koboSpan" id="kobo.380.2">It is a marker interface that contains no methods or fields. </span><span class="koboSpan" id="kobo.380.3">Therefore, classes that incorporate it don’t need to define any methods. </span><span class="koboSpan" id="kobo.380.4">If classes wish to be able to serialize or deserialize their instances, they must </span><span class="No-Break"><span class="koboSpan" id="kobo.381.1">implement it.</span></span></p>
<h2 id="_idParaDest-301"><a id="_idTextAnchor382"/><span class="koboSpan" id="kobo.382.1">See also</span></h2>
<p><span class="koboSpan" id="kobo.383.1">For more information</span><a id="_idIndexMarker483"/><span class="koboSpan" id="kobo.384.1"> on PHP serialization, </span><span class="No-Break"><span class="koboSpan" id="kobo.385.1">visit </span></span><a href="https://www.php.net/manual/en/function.serialize.php"><span class="No-Break"><span class="koboSpan" id="kobo.386.1">https://www.php.net/manual/en/function.serialize.php</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.387.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.388.1">For CyberChef, </span><span class="No-Break"><span class="koboSpan" id="kobo.389.1">visit </span></span><a href="https://gchq.github.io/CyberChef/"><span class="No-Break"><span class="koboSpan" id="kobo.390.1">https://gchq.github.io/</span><span id="_idTextAnchor383"/><span class="koboSpan" id="kobo.391.1">CyberChef/</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.392.1">.</span></span></p>
<h1 id="_idParaDest-302"><a id="_idTextAnchor384"/><span class="koboSpan" id="kobo.393.1">Password brute-force via password change</span></h1>
<p><span class="koboSpan" id="kobo.394.1">A brute force </span><a id="_idIndexMarker484"/><span class="koboSpan" id="kobo.395.1">attack is a cracking method that uses trial and error to compromise login information, encryption keys, and passwords. </span><span class="koboSpan" id="kobo.395.2">It is a simple yet effective method for gaining unauthorized access to user accounts, business systems, or networks. </span><span class="koboSpan" id="kobo.395.3">Until they discover the proper login details, a malicious user attempts a wide variety of usernames and password combinations to obtain the right </span><span class="No-Break"><span class="koboSpan" id="kobo.396.1">authentication credentials.</span></span></p>
<p><span class="koboSpan" id="kobo.397.1">In this recipe, we will attack a vulnerable password change function within the application using </span><span class="No-Break"><span class="koboSpan" id="kobo.398.1">brute-force attacks.</span></span></p>
<h2 id="_idParaDest-303"><a id="_idTextAnchor385"/><span class="koboSpan" id="kobo.399.1">Getting ready</span></h2>
<p><span class="koboSpan" id="kobo.400.1">This lab requires a PortSwigger Academy account and ZAP to intercept requests and responses from the server to </span><span class="No-Break"><span class="koboSpan" id="kobo.401.1">your browser.</span></span></p>
<h2 id="_idParaDest-304"><a id="_idTextAnchor386"/><span class="koboSpan" id="kobo.402.1">How to do it...</span></h2>
<p><span class="koboSpan" id="kobo.403.1">In this recipe, we will demonstrate a brute-force attack by completing the PortSwigger Academy </span><em class="italic"><span class="koboSpan" id="kobo.404.1">Password brute-force via password change</span></em><span class="koboSpan" id="kobo.405.1"> lab to find the correct credentials. </span><span class="koboSpan" id="kobo.405.2">To start the lab, follow </span><span class="No-Break"><span class="koboSpan" id="kobo.406.1">these instructions:</span></span></p>
<ol>
<li value="1"><span class="koboSpan" id="kobo.407.1">Navigate to the URL with the browser proxied to ZAP and log into the PortSwigger Academy website to launch the </span><span class="No-Break"><span class="koboSpan" id="kobo.408.1">lab </span></span><span class="No-Break"><span class="koboSpan" id="kobo.409.1">(</span></span><a href="https://portswigger.net/web-security/authentication/other-mechanisms/lab-password-brute-force-via-password-change"><span class="No-Break"><span class="koboSpan" id="kobo.410.1">https://portswigger.net/web-security/authentication/other-mechanisms/lab-password-brute-force-via-password-change</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.411.1">).</span></span></li>
<li><span class="koboSpan" id="kobo.412.1">Download the Authentication lab passwords provided by PortSwigger to a text file on your computer. </span><span class="koboSpan" id="kobo.412.2">You will be using these specifically for the </span><span class="No-Break"><span class="koboSpan" id="kobo.413.1">recipe (</span></span><a href="https://portswigger.net/web-security/authentication/auth-lab-passwords"><span class="No-Break"><span class="koboSpan" id="kobo.414.1">https://portswigger.net/web-security/authentication/auth-lab-passwords</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.415.1">).</span></span></li>
<li><span class="koboSpan" id="kobo.416.1">With ZAP open, go to </span><strong class="bold"><span class="koboSpan" id="kobo.417.1">Manual Explore</span></strong><span class="koboSpan" id="kobo.418.1">, open Firefox via the launcher, and resolve the PortSwigger lab URL. </span><span class="koboSpan" id="kobo.418.2">Continue to the PortSwigger </span><span class="No-Break"><span class="koboSpan" id="kobo.419.1">Authentication lab.</span></span></li>
</ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.420.1">Important note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.421.1">In ZAP, to view the request and response more easily, be sure to add the URL being tested to </span><strong class="bold"><span class="koboSpan" id="kobo.422.1">Context</span></strong><span class="koboSpan" id="kobo.423.1"> by right-clicking on the web URL in the </span><strong class="bold"><span class="koboSpan" id="kobo.424.1">Sites</span></strong><span class="koboSpan" id="kobo.425.1"> window and </span><strong class="bold"><span class="koboSpan" id="kobo.426.1">Include Site in Context</span></strong><span class="koboSpan" id="kobo.427.1">, then click the bullseye to remove any other sites from view. </span><span class="koboSpan" id="kobo.427.2">This can be done in the </span><strong class="bold"><span class="koboSpan" id="kobo.428.1">History</span></strong><span class="koboSpan" id="kobo.429.1"> tab of the </span><strong class="bold"><span class="koboSpan" id="kobo.430.1">Information</span></strong><span class="koboSpan" id="kobo.431.1"> window and elsewhere that has </span><span class="No-Break"><span class="koboSpan" id="kobo.432.1">a bullseye.</span></span></p>
<ol>
<li value="4"><span class="koboSpan" id="kobo.433.1">Log in to the</span><a id="_idIndexMarker485"/><span class="koboSpan" id="kobo.434.1"> lab application using the credentials provided and set the Breakpoint in </span><span class="No-Break"><span class="koboSpan" id="kobo.435.1">the HUD.</span></span></li>
<li><span class="koboSpan" id="kobo.436.1">Once logged in, you will be at the web page where you can update your current password. </span><span class="koboSpan" id="kobo.436.2">Here, we’ll begin to test its functionality. </span><span class="koboSpan" id="kobo.436.3">Keep in mind that the username is provided in the request as a </span><span class="No-Break"><span class="koboSpan" id="kobo.437.1">hidden input.</span></span></li>
<li><span class="koboSpan" id="kobo.438.1">We’ll mess around with this feature to enumerate correct passwords but first, let’s look at varying ways to gain </span><span class="No-Break"><span class="koboSpan" id="kobo.439.1">different responses:</span></span><ol><li><span class="koboSpan" id="kobo.440.1">Enter an incorrect current password followed by two matching passwords. </span><span class="koboSpan" id="kobo.440.2">If you enter passwords like this twice, the account will log you out and lock. </span><span class="koboSpan" id="kobo.440.3">Then, when attempting to log back in, you’ll get an error of being locked out for one minute, as shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.441.1">Figure 10</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.442.1">.10</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.443.1">:</span></span></li></ol></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer257">
<span class="koboSpan" id="kobo.444.1"><img alt="Figure 10.10 – Locked account message" src="image/Figure_10.10_B18829.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.445.1">Figure 10.10 – Locked account message</span></p>
<ol>
<li value="2"><span class="koboSpan" id="kobo.446.1">But if you use an incorrect current password, but the new passwords do not match, you will</span><a id="_idIndexMarker486"/><span class="koboSpan" id="kobo.447.1"> not be logged out and locked out. </span><span class="koboSpan" id="kobo.447.2">A </span><strong class="bold"><span class="koboSpan" id="kobo.448.1">Current password is incorrect</span></strong><span class="koboSpan" id="kobo.449.1"> error </span><span class="No-Break"><span class="koboSpan" id="kobo.450.1">will appear.</span></span></li>
<li><span class="koboSpan" id="kobo.451.1">Lastly, if you use the correct, current password but you enter two different new passwords, you will get a </span><strong class="bold"><span class="koboSpan" id="kobo.452.1">New passwords do not match</span></strong><span class="koboSpan" id="kobo.453.1"> error message splashed on the </span><span class="No-Break"><span class="koboSpan" id="kobo.454.1">web page.</span></span></li>
</ol>
<ol>
<li value="7"><span class="koboSpan" id="kobo.455.1">In the </span><strong class="bold"><span class="koboSpan" id="kobo.456.1">History</span></strong><span class="koboSpan" id="kobo.457.1"> tab, open the request where you entered the correct, current password and two different new passwords in </span><strong class="bold"><span class="koboSpan" id="kobo.458.1">Fuzzer</span></strong><span class="koboSpan" id="kobo.459.1">, as shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.460.1">Figure 10</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.461.1">.11</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.462.1">:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer258">
<span class="koboSpan" id="kobo.463.1"><img alt="Figure 10.11 – The POST request change password" src="image/Figure_10.11_B18829.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.464.1">Figure 10.11 – The POST request change password</span></p>
<ol>
<li value="8"><span class="koboSpan" id="kobo.465.1">Click on </span><strong class="bold"><span class="koboSpan" id="kobo.466.1">Edit</span></strong><span class="koboSpan" id="kobo.467.1"> to </span><a id="_idIndexMarker487"/><span class="koboSpan" id="kobo.468.1">change the username parameter </span><span class="No-Break"><span class="koboSpan" id="kobo.469.1">to </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.470.1">carlos</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.471.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.472.1">Next, select </span><strong class="source-inline"><span class="koboSpan" id="kobo.473.1">password</span></strong><span class="koboSpan" id="kobo.474.1"> in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.475.1">current-password</span></strong><span class="koboSpan" id="kobo.476.1"> parameter and click </span><strong class="bold"><span class="koboSpan" id="kobo.477.1">Add</span></strong><span class="koboSpan" id="kobo.478.1">, </span><strong class="bold"><span class="koboSpan" id="kobo.479.1">Add</span></strong><span class="koboSpan" id="kobo.480.1"> again, and then drop down the menu to </span><strong class="bold"><span class="koboSpan" id="kobo.481.1">File</span></strong><span class="koboSpan" id="kobo.482.1">. </span><span class="koboSpan" id="kobo.482.2">This will add our password list to use for brute-forcing. </span><span class="koboSpan" id="kobo.482.3">Ensure the other two new </span><strong class="source-inline"><span class="koboSpan" id="kobo.483.1">password</span></strong><span class="koboSpan" id="kobo.484.1"> parameters are different values, as shown in the previous example, </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.485.1">Figure 10</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.486.1">.11</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.487.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.488.1">In the </span><strong class="bold"><span class="koboSpan" id="kobo.489.1">File</span></strong><span class="koboSpan" id="kobo.490.1"> payload, click on </span><strong class="bold"><span class="koboSpan" id="kobo.491.1">Select...</span></strong><span class="koboSpan" id="kobo.492.1"> to open your computer’s directory and navigate to where you saved </span><span class="No-Break"><span class="koboSpan" id="kobo.493.1">the file.</span></span></li>
<li><span class="koboSpan" id="kobo.494.1">Next, add a second payload, </span><strong class="source-inline"><span class="koboSpan" id="kobo.495.1">strings</span></strong><span class="koboSpan" id="kobo.496.1">, in an empty space in the body just after the second password. </span><span class="koboSpan" id="kobo.496.2">Add the </span><strong class="source-inline"><span class="koboSpan" id="kobo.497.1">New passwords do not match</span></strong><span class="koboSpan" id="kobo.498.1"> line, check the </span><strong class="bold"><span class="koboSpan" id="kobo.499.1">Multiline</span></strong><span class="koboSpan" id="kobo.500.1"> box, click </span><strong class="bold"><span class="koboSpan" id="kobo.501.1">Add</span></strong><span class="koboSpan" id="kobo.502.1">, </span><span class="No-Break"><span class="koboSpan" id="kobo.503.1">then </span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.504.1">OK</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.505.1">.</span></span></li>
</ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.506.1">Important note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.507.1">Adding a Stings payload type helps you </span><em class="italic"><span class="koboSpan" id="kobo.508.1">grep match</span></em><span class="koboSpan" id="kobo.509.1"> on content in the body of </span><span class="No-Break"><span class="koboSpan" id="kobo.510.1">the response.</span></span></p>
<p><span class="koboSpan" id="kobo.511.1">Yours should have </span><a id="_idIndexMarker488"/><span class="koboSpan" id="kobo.512.1">two payloads, as shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.513.1">Figure 10</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.514.1">.12</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.515.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer259">
<span class="koboSpan" id="kobo.516.1"><img alt="Figure 10.12 – Fuzzer payloads" src="image/Figure_10.12_B18829.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.517.1">Figure 10.12 – Fuzzer payloads</span></p>
<ol>
<li value="12"><span class="No-Break"><span class="koboSpan" id="kobo.518.1">Start Fuzzing.</span></span></li>
<li><span class="koboSpan" id="kobo.519.1">The attack will run for a little and once it stops, look for a response that contains the word </span><strong class="source-inline"><span class="koboSpan" id="kobo.520.1">Reflected</span></strong><span class="koboSpan" id="kobo.521.1"> in the </span><strong class="bold"><span class="koboSpan" id="kobo.522.1">Fuzzer</span></strong><span class="koboSpan" id="kobo.523.1"> tab of the </span><strong class="bold"><span class="koboSpan" id="kobo.524.1">Information</span></strong><span class="koboSpan" id="kobo.525.1"> window. </span><span class="koboSpan" id="kobo.525.2">Sort the </span><strong class="bold"><span class="koboSpan" id="kobo.526.1">State</span></strong><span class="koboSpan" id="kobo.527.1"> column, as shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.528.1">Figure 10</span></em></span><em class="italic"><span class="koboSpan" id="kobo.529.1">.13</span></em><span class="koboSpan" id="kobo.530.1">. </span><span class="koboSpan" id="kobo.530.2">When scrolling through the payloads, look at the body of the response for </span><strong class="source-inline"><span class="koboSpan" id="kobo.531.1">&lt;p class=is-warning&gt;New passwords do not match</span></strong><span class="koboSpan" id="kobo.532.1">. </span><span class="koboSpan" id="kobo.532.2">This payload will be </span><span class="No-Break"><span class="koboSpan" id="kobo.533.1">your password:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer260">
<span class="koboSpan" id="kobo.534.1"><img alt="Figure 10.13 – Fuzzer history" src="image/Figure_10.13_B18829.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.535.1">Figure 10.13 – Fuzzer history</span></p>
<ol>
<li value="14"><span class="koboSpan" id="kobo.536.1">Go back to the </span><a id="_idIndexMarker489"/><span class="koboSpan" id="kobo.537.1">application in the browser, log out of the current account you’re logged into, and then log back in using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.538.1">carlos</span></strong><span class="koboSpan" id="kobo.539.1"> username and the newly </span><span class="No-Break"><span class="koboSpan" id="kobo.540.1">found password.</span></span></li>
</ol>
<h2 id="_idParaDest-305"><a id="_idTextAnchor387"/><span class="koboSpan" id="kobo.541.1">How it works...</span></h2>
<p><span class="koboSpan" id="kobo.542.1">Attackers look for areas within an application to forcefully attempt numerous usernames or passwords and conduct varying techniques to do so. </span><span class="koboSpan" id="kobo.542.2">The four most common are </span><span class="No-Break"><span class="koboSpan" id="kobo.543.1">as follows:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.544.1">Simple brute force attacks are where attackers attempt to guess a user’s login by manually typing them in one at </span><span class="No-Break"><span class="koboSpan" id="kobo.545.1">a time.</span></span></li>
<li><span class="koboSpan" id="kobo.546.1">A dictionary attack is a type of password guessing attack that inputs a list of potential passwords, consisting of swapping some of the letters with symbols or numbers and comparing it to a username of the target. </span><span class="koboSpan" id="kobo.546.2">Typically, this attack takes much longer to succeed and thus has a decreased likelihood </span><span class="No-Break"><span class="koboSpan" id="kobo.547.1">of working.</span></span></li>
<li><span class="koboSpan" id="kobo.548.1">A rainbow table attack comprises a database that is made up of passwords and their hash values, which are then compared against the target hash for a match. </span><span class="koboSpan" id="kobo.548.2">This takes less time </span><span class="No-Break"><span class="koboSpan" id="kobo.549.1">to crack.</span></span></li>
<li><span class="koboSpan" id="kobo.550.1">Hybrid attacks combine both dictionary and </span><span class="No-Break"><span class="koboSpan" id="kobo.551.1">rainbow tables.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.552.1">Many of these </span><a id="_idIndexMarker490"/><span class="koboSpan" id="kobo.553.1">passwords and tables come from underground sources from previous breaches being sold or passed around the internet and help form more accurate attacks </span><span class="No-Break"><span class="koboSpan" id="kobo.554.1">on networks.</span></span></p>
<h2 id="_idParaDest-306"><a id="_idTextAnchor388"/><span class="koboSpan" id="kobo.555.1">See also</span></h2>
<p><span class="koboSpan" id="kobo.556.1">Other sources to help build lists can be searched for via search engines for default credentials for the technology being used, or utilize one of </span><span class="No-Break"><span class="koboSpan" id="kobo.557.1">these links:</span></span></p>
<p><span class="No-Break"><span class="koboSpan" id="kobo.558.1">Credentials:</span></span></p>
<ul>
<li><a href="https://github.com/ihebski/DefaultCreds-cheat-sheet"><span class="No-Break"><span class="koboSpan" id="kobo.559.1">https://github.com/ihebski/DefaultCreds-cheat-sheet</span></span></a></li>
<li><a href="http://www.vulnerabilityassessment.co.uk/passwordsC.htm"><span class="No-Break"><span class="koboSpan" id="kobo.560.1">http://www.vulnerabilityassessment.co.uk/passwordsC.htm</span></span></a></li>
<li><a href="https://192-168-1-1ip.mobi/default-router-passwords-list/"><span class="No-Break"><span class="koboSpan" id="kobo.561.1">https://192-168-1-1ip.mobi/default-router-passwords-list/</span></span></a></li>
<li><a href="https://datarecovery.com/rd/default-passwords/"><span class="No-Break"><span class="koboSpan" id="kobo.562.1">https://datarecovery.com/rd/default-passwords/</span></span></a></li>
<li><a href="https://bizuns.com/default-passwords-list"><span class="No-Break"><span class="koboSpan" id="kobo.563.1">https://bizuns.com/default-passwords-list</span></span></a></li>
<li><a href="https://github.com/danielmiessler/SecLists/blob/master/Passwords/Default-Credentials/default-passwords.csv"><span class="No-Break"><span class="koboSpan" id="kobo.564.1">https://github.com/danielmiessler/SecLists/blob/master/Passwords/Default-Credentials/default-passwords.csv</span></span></a></li>
<li><a href="https://www.cirt.net/passwords"><span class="No-Break"><span class="koboSpan" id="kobo.565.1">https://www.cirt.net/passwords</span></span></a></li>
<li><a href="https://www.passwordsdatabase.com/"><span class="No-Break"><span class="koboSpan" id="kobo.566.1">https://www.passwordsdatabase.com/</span></span></a></li>
<li><a href="https://many-passwords.github.io/"><span class="No-Break"><span class="koboSpan" id="kobo.567.1">https://many-passwords.github.io/</span></span></a></li>
</ul>
<p><span class="No-Break"><span class="koboSpan" id="kobo.568.1">Wordlists:</span></span></p>
<ul>
<li><a href="https://github.com/Dormidera/WordList-Compendium"><span class="No-Break"><span class="koboSpan" id="kobo.569.1">https://github.com/Dormidera/WordList-Compendium</span></span></a></li>
<li><a href="https://github.com/danielmiessler/SecLists"><span class="No-Break"><span class="koboSpan" id="kobo.570.1">https://github.com/danielmiessler/SecLists</span></span></a></li>
<li><a href="https://github.com/kaonashi-passwords/Kaonashi"><span class="No-Break"><span class="koboSpan" id="kobo.571.1">https://github.com/kaonashi-passwords/Kaonashi</span></span></a></li>
<li><a href="https://crackstation.net/crackstation-wordlist-password-cracking-dictionary.htm"><span class="No-Break"><span class="koboSpan" id="kobo.572.1">https://crackstation.net/crackstation-wordlist-password-cracking-</span><span id="_idTextAnchor389"/><span class="koboSpan" id="kobo.573.1">dictionary.htm</span></span></a></li>
</ul>
<h1 id="_idParaDest-307"><a id="_idTextAnchor390"/><span class="koboSpan" id="kobo.574.1">Web cache poisoning</span></h1>
<p><strong class="bold"><span class="koboSpan" id="kobo.575.1">Web cache poisoning</span></strong><span class="koboSpan" id="kobo.576.1"> is a</span><a id="_idIndexMarker491"/><span class="koboSpan" id="kobo.577.1"> sophisticated technique whereby an attacker manipulates a web server and its cache functionality to send other users a malicious HTTP response. </span><span class="koboSpan" id="kobo.577.2">In this recipe, we’ll exploit a vulnerable lab that does not properly validate input within an unkeyed header susceptible to web cache poisoning. </span><span class="koboSpan" id="kobo.577.3">This attack will take advantage of the web application’s home page, where unsuspecting visitors will be open to the attack. </span><span class="koboSpan" id="kobo.577.4">We’ll walk you through web cache poisoning in a response that causes the visitor’s browser to execute malicious </span><span class="No-Break"><span class="koboSpan" id="kobo.578.1">JavaScript code.</span></span></p>
<h2 id="_idParaDest-308"><a id="_idTextAnchor391"/><span class="koboSpan" id="kobo.579.1">Getting ready</span></h2>
<p><span class="koboSpan" id="kobo.580.1">This lab requires a PortSwigger Academy account and ZAP to intercept requests and responses from the server to </span><span class="No-Break"><span class="koboSpan" id="kobo.581.1">your browser.</span></span></p>
<h2 id="_idParaDest-309"><a id="_idTextAnchor392"/><span class="koboSpan" id="kobo.582.1">How to do it...</span></h2>
<p><span class="koboSpan" id="kobo.583.1">In this section, we will lay out the steps you can take to complete the PortSwigger Academy </span><em class="italic"><span class="koboSpan" id="kobo.584.1">Web cache poisoning with an unkeyed header</span></em><span class="koboSpan" id="kobo.585.1"> lab and poison the cache to display the cookie. </span><span class="koboSpan" id="kobo.585.2">To start the lab, take the </span><span class="No-Break"><span class="koboSpan" id="kobo.586.1">following steps:</span></span></p>
<ol>
<li value="1"><span class="koboSpan" id="kobo.587.1">Navigate to the URL with the browser proxied to ZAP and log into the PortSwigger Academy website to launch </span><span class="No-Break"><span class="koboSpan" id="kobo.588.1">the lab:</span></span><pre class="console">
<a href="https://portswigger.net/web-security/web-cache-poisoning/exploiting-design-flaws/lab-web-cache-poisoning-with-an-unkeyed-header"><span class="koboSpan" id="kobo.589.1">https://portswigger.net/web-security/web-cache-poisoning/exploiting-design-flaws/lab-web-cache-poisoning-with-an-unkeyed-header</span></a></pre></li>
<li><span class="koboSpan" id="kobo.590.1">Capture the website’s home page. </span><span class="koboSpan" id="kobo.590.2">To reiterate this response, refresh the web page or click the home </span><span class="No-Break"><span class="koboSpan" id="kobo.591.1">page button.</span></span></li>
<li><span class="koboSpan" id="kobo.592.1">Look for the </span><strong class="source-inline"><span class="koboSpan" id="kobo.593.1">GET</span></strong><span class="koboSpan" id="kobo.594.1"> request that is generated from the home page and open it in the </span><strong class="bold"><span class="koboSpan" id="kobo.595.1">Manual Request Editor</span></strong><span class="koboSpan" id="kobo.596.1">, as </span><a id="_idIndexMarker492"/><span class="koboSpan" id="kobo.597.1">shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.598.1">Figure 10</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.599.1">.14</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.600.1">:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer261">
<span class="koboSpan" id="kobo.601.1"><img alt="Figure 10.14 – The GET request" src="image/Figure_10.14_B18829.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.602.1">Figure 10.14 – The GET request</span></p>
<ol>
<li value="4"><span class="koboSpan" id="kobo.603.1">Next, add a cache-buster query parameter after the </span><span class="No-Break"><span class="koboSpan" id="kobo.604.1">URL (</span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.605.1">/?cb=1337</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.606.1">).</span></span></li>
</ol>
<p><span class="koboSpan" id="kobo.607.1">A </span><strong class="bold"><span class="koboSpan" id="kobo.608.1">cache-buster header</span></strong><span class="koboSpan" id="kobo.609.1"> is a </span><a id="_idIndexMarker493"/><span class="koboSpan" id="kobo.610.1">type of HTTP response header that is used to prevent web browsers from caching specific resources on a web page. </span><span class="koboSpan" id="kobo.610.2">This can be useful in situations where you want to ensure that users always see the latest version of a resource rather than a potentially outdated version that might have been stored in the browser’s cache. </span><span class="koboSpan" id="kobo.610.3">Cache-buster headers typically contain a unique identifier or timestamp that changes each time the resource is requested, which forces the browser to download the latest version of the resource rather than using a cached version. </span><span class="koboSpan" id="kobo.610.4">This can help to ensure that users always have access to the most up-to-date content on </span><span class="No-Break"><span class="koboSpan" id="kobo.611.1">a website.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.612.1">Important note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.613.1">The process to locate vulnerable parameters to web cache poison can be automated using an extension called </span><strong class="bold"><span class="koboSpan" id="kobo.614.1">Parameter Digger</span></strong><span class="koboSpan" id="kobo.615.1">. </span><span class="koboSpan" id="kobo.615.2">Refer</span><a id="_idIndexMarker494"/><span class="koboSpan" id="kobo.616.1"> to the </span><em class="italic"><span class="koboSpan" id="kobo.617.1">See also</span></em><span class="koboSpan" id="kobo.618.1"> section </span><span class="No-Break"><span class="koboSpan" id="kobo.619.1">for reference.</span></span></p>
<ol>
<li value="5"><span class="koboSpan" id="kobo.620.1">In</span><a id="_idIndexMarker495"/><span class="koboSpan" id="kobo.621.1"> addition, add the </span><strong class="source-inline"><span class="koboSpan" id="kobo.622.1">X-Forwarded-Host</span></strong><span class="koboSpan" id="kobo.623.1"> header with any random hostname, as shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.624.1">Figure 10</span></em></span><em class="italic"><span class="koboSpan" id="kobo.625.1">.15</span></em><span class="koboSpan" id="kobo.626.1">, such as </span><strong class="source-inline"><span class="koboSpan" id="kobo.627.1">zaproxy.org</span></strong><span class="koboSpan" id="kobo.628.1">, and </span><span class="No-Break"><span class="koboSpan" id="kobo.629.1">click </span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.630.1">Send</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.631.1">.</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer262">
<span class="koboSpan" id="kobo.632.1"><img alt="Figure 10.15 – Cache buster query and the X-Forwarded-Host header" src="image/Figure_10.15_B18829.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.633.1">Figure 10.15 – Cache buster query and the X-Forwarded-Host header</span></p>
<ol>
<li value="6"><span class="koboSpan" id="kobo.634.1">When the </span><strong class="source-inline"><span class="koboSpan" id="kobo.635.1">X-Forwarded-Host</span></strong><span class="koboSpan" id="kobo.636.1"> header is used, a dynamically generated reference is shown in the web app’s source code for importing a JavaScript file that’s stored </span><span class="No-Break"><span class="koboSpan" id="kobo.637.1">at </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.638.1">/resources/js/tracking.js</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.639.1">.</span></span></li>
</ol>
<p><span class="koboSpan" id="kobo.640.1">All the details required to find a resource are in this absolute URL, as shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.641.1">Figure 10</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.642.1">.16</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.643.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer263">
<span class="koboSpan" id="kobo.644.1"><img alt="Figure 10.16 – Dynamic URL in the web app source code" src="image/Figure_10.16_B18829.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.645.1">Figure 10.16 – Dynamic URL in the web app source code</span></p>
<ol>
<li value="7"><span class="koboSpan" id="kobo.646.1">In addition, when looking </span><a id="_idIndexMarker496"/><span class="koboSpan" id="kobo.647.1">at the response, as in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.648.1">Figure 10</span></em></span><em class="italic"><span class="koboSpan" id="kobo.649.1">.16</span></em><span class="koboSpan" id="kobo.650.1">, the response contains the </span><strong class="source-inline"><span class="koboSpan" id="kobo.651.1">X-Cache: hit</span></strong><span class="koboSpan" id="kobo.652.1"> header. </span><span class="koboSpan" id="kobo.652.2">If you see the </span><strong class="source-inline"><span class="koboSpan" id="kobo.653.1">X-Cache: miss</span></strong><span class="koboSpan" id="kobo.654.1"> header, continue to click </span><strong class="bold"><span class="koboSpan" id="kobo.655.1">Send</span></strong><span class="koboSpan" id="kobo.656.1"> to get </span><span class="No-Break"><span class="koboSpan" id="kobo.657.1">a hit:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer264">
<span class="koboSpan" id="kobo.658.1"><img alt="Figure 10.17 – The X-Cache: miss response" src="image/Figure_10.17_B18829.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.659.1">Figure 10.17 – The X-Cache: miss response</span></p>
<p><span class="koboSpan" id="kobo.660.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.661.1">X-Cache</span></strong><span class="koboSpan" id="kobo.662.1"> header is a type of HTTP response header that is used to indicate whether a resource was served from the cache of a web server or from the origin server itself. </span><span class="koboSpan" id="kobo.662.2">If the header contains the value </span><strong class="source-inline"><span class="koboSpan" id="kobo.663.1">hit</span></strong><span class="koboSpan" id="kobo.664.1">, the resource was served from the cache, which can be faster and more efficient than serving the resource directly from the origin server. </span><span class="koboSpan" id="kobo.664.2">This can be useful for improving a website’s performance by reducing the amount of data that needs to be transferred between the server and </span><span class="No-Break"><span class="koboSpan" id="kobo.665.1">the client.</span></span></p>
<ol>
<li value="8"><span class="koboSpan" id="kobo.666.1">With this information, click the link to go to the exploit server and update the filename to be the path to the JavaScript from the </span><span class="No-Break"><span class="koboSpan" id="kobo.667.1">absolute URL:</span></span><pre class="console"><span class="koboSpan" id="kobo.668.1">
/resources/js/tracking.js</span></pre></li>
<li><span class="koboSpan" id="kobo.669.1">Next, enter a JavaScript XSS payload into the body and click </span><strong class="bold"><span class="koboSpan" id="kobo.670.1">Store</span></strong><span class="koboSpan" id="kobo.671.1"> to save </span><span class="No-Break"><span class="koboSpan" id="kobo.672.1">the exploit:</span></span><pre class="console"><span class="koboSpan" id="kobo.673.1">
alert(document.cookie)</span></pre></li>
<li><span class="koboSpan" id="kobo.674.1">Again, open the </span><strong class="source-inline"><span class="koboSpan" id="kobo.675.1">GET</span></strong><span class="koboSpan" id="kobo.676.1"> request for the home page in </span><strong class="bold"><span class="koboSpan" id="kobo.677.1">Manual Response Editor</span></strong><span class="koboSpan" id="kobo.678.1"> and remove the cache buster parameter and then add the </span><strong class="source-inline"><span class="koboSpan" id="kobo.679.1">X-Forwarded-Host</span></strong><span class="koboSpan" id="kobo.680.1"> header that points to the exploit server (ensure to use your </span><strong class="source-inline"><span class="koboSpan" id="kobo.681.1">EXPLOIT-SERVER-ID</span></strong><span class="koboSpan" id="kobo.682.1"> that is</span><a id="_idIndexMarker497"/><span class="koboSpan" id="kobo.683.1"> provided in the URL on top of the </span><span class="No-Break"><span class="koboSpan" id="kobo.684.1">exploit page):</span></span><pre class="console"><span class="koboSpan" id="kobo.685.1">
X-Forwarded-Host: EXPLOIT-SERVER-ID.exploit-server.net</span></pre></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer265">
<span class="koboSpan" id="kobo.686.1"><img alt="Figure 10.18 – The GET request for web cache poisoning" src="image/Figure_10.18_B18829.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.687.1">Figure 10.18 – The GET request for web cache poisoning</span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.688.1">Important note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.689.1">When crafting the </span><strong class="source-inline"><span class="koboSpan" id="kobo.690.1">GET</span></strong><span class="koboSpan" id="kobo.691.1"> request, be sure to remove the cache-buster header, and when adding the exploit server URL, do not include </span><strong class="source-inline"><span class="koboSpan" id="kobo.692.1">https://</span></strong><span class="koboSpan" id="kobo.693.1"> or the </span><span class="No-Break"><span class="koboSpan" id="kobo.694.1">trailing </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.695.1">/</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.696.1">.</span></span></p>
<ol>
<li value="11"><span class="koboSpan" id="kobo.697.1">Click </span><strong class="bold"><span class="koboSpan" id="kobo.698.1">Send</span></strong><span class="koboSpan" id="kobo.699.1">, and continue sending the request until the exploit server URL is reflected in the response along with </span><strong class="source-inline"><span class="koboSpan" id="kobo.700.1">X-Cache: hit</span></strong><span class="koboSpan" id="kobo.701.1"> in the headers, as shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.702.1">Figure 10</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.703.1">.19</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.704.1">:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer266">
<span class="koboSpan" id="kobo.705.1"><img alt="Figure 10.19 – A successful exploit request" src="image/Figure_10.19_B18829.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.706.1">Figure 10.19 – A successful exploit request</span></p>
<ol>
<li value="12"><span class="koboSpan" id="kobo.707.1">Once you have a </span><a id="_idIndexMarker498"/><span class="koboSpan" id="kobo.708.1">hit, go to the web app in the browser and refresh the page. </span><span class="koboSpan" id="kobo.708.2">This will load the web cache poisoned URL into the browser that triggers the</span><strong class="source-inline"><span class="koboSpan" id="kobo.709.1"> alert()</span></strong><span class="koboSpan" id="kobo.710.1"> JavaScript payload, as shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.711.1">Figure 10</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.712.1">.20</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.713.1">.</span></span></li>
</ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.714.1">Important note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.715.1">The web cache for this lab will expire every 30 seconds. </span><span class="koboSpan" id="kobo.715.2">It’s important to perform the </span><span class="No-Break"><span class="koboSpan" id="kobo.716.1">test quickly.</span></span></p>
<ol>
<li value="13"><span class="koboSpan" id="kobo.717.1">You may need to continue sending the malicious </span><strong class="source-inline"><span class="koboSpan" id="kobo.718.1">GET</span></strong><span class="koboSpan" id="kobo.719.1"> request, followed by refreshing the web app browser page to get the web-poisoned page to load and execute </span><span class="No-Break"><span class="koboSpan" id="kobo.720.1">the payload:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer267">
<span class="koboSpan" id="kobo.721.1"><img alt="Figure 10.20 – The XSS payload execution" src="image/Figure_10.20_B18829.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.722.1">Figure 10.20 – The XSS payload execution</span></p>
<h2 id="_idParaDest-310"><a id="_idTextAnchor393"/><span class="koboSpan" id="kobo.723.1">How it works...</span></h2>
<p><span class="koboSpan" id="kobo.724.1">Web cache poisoning typically involves manipulating the HTTP headers of a request to a web server in such a way that the server will cache a malicious or false version of the response. </span><span class="koboSpan" id="kobo.724.2">For example, an attacker might send a request with a forged </span><strong class="source-inline"><span class="koboSpan" id="kobo.725.1">Last-Modified</span></strong><span class="koboSpan" id="kobo.726.1"> header</span><a id="_idIndexMarker499"/><span class="koboSpan" id="kobo.727.1"> that indicates that the response should be considered fresh and cached by the server, even if it contains malicious or false content. </span><span class="koboSpan" id="kobo.727.2">When subsequent requests are made to the same resource, the server will serve the poisoned response from its cache instead of requesting a fresh copy from the </span><span class="No-Break"><span class="koboSpan" id="kobo.728.1">origin server.</span></span></p>
<h2 id="_idParaDest-311"><a id="_idTextAnchor394"/><span class="koboSpan" id="kobo.729.1">See also</span></h2>
<p><span class="koboSpan" id="kobo.730.1">Parameter Digger, a tool for finding parameters, is called</span><a id="_idIndexMarker500"/><span class="koboSpan" id="kobo.731.1"> the </span><strong class="bold"><span class="koboSpan" id="kobo.732.1">Param Digger</span></strong><span class="koboSpan" id="kobo.733.1">. </span><span class="koboSpan" id="kobo.733.2">It reveals obscure, unconnected, and hidden characteristics that can help broaden the attack surface and make it simpler to uncover vulnerabilities. </span><span class="koboSpan" id="kobo.733.3">It employs brute-force guessing techniques to find parameters using a seed URL that has been provided </span><span class="No-Break"><span class="koboSpan" id="kobo.734.1">here: </span></span><a href="https://www.zaproxy.org/docs/desktop/addons/parameter-digger/"><span class="No-Break"><span class="koboSpan" id="kobo.735.1">https://www.zaproxy.org/docs/desktop/addons/parameter-digger/</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.736.1">.</span></span></p>
</div>
</body></html>